$.cookie.defaults.expires=365;var svgList=[],svgViewIDList=[],processAjax=0,ajaxList=[],trackInfo=[],selectedGeneSymbol="",selectedID="",trackSettings=[],overSelectable=0,zoomUpdateHandle=Math.NaN,ratOnly=[],mouseOnly=[],history=[[],[]],customTrackCount=0,testChrome=/chrom(e|ium)/.test(navigator.userAgent.toLowerCase()),testSafari=/safari/.test(navigator.userAgent.toLowerCase()),testFireFox=/firefox/.test(navigator.userAgent.toLowerCase()),testIE=/(wow|.net|ie)/.test(navigator.userAgent.toLowerCase());
testChrome&&testSafari&&(testSafari=!1);!testIE||testChrome||testFireFox||testSafari||$("#IEproblem").show();ratOnly.snpSHRJ=1;ratOnly.snpF344=1;ratOnly.snpSHRH=1;ratOnly.snpBNLX=1;ratOnly.helicos=1;ratOnly.spliceJnct=1;ratOnly.illuminaTotal=1;ratOnly.illuminaSmall=1;ratOnly.illuminaPolyA=1;ratOnly.liverTotal=1;ratOnly.liverspliceJnct=1;ratOnly.liverilluminaTotalPlus=1;ratOnly.liverilluminaTotalMinus=1;ratOnly.polyASite=1;ratOnly.braincoding=1;ratOnly.brainnoncoding=1;ratOnly.brainsmallnc=1;
ratOnly.heartTotal=1;ratOnly.heartilluminaTotalPlus=1;ratOnly.heartilluminaTotalMinus=1;ratOnly.probe=1;ratOnly.mergedTotal=1;"rn5"===genomeVer&&(mouseOnly.brainTotal=1);mouseOnly.brainilluminaTotalPlus=1;mouseOnly.brainilluminaTotalMinus=1;mouseOnly.brainspliceJnct=1;mouseOnly.probeMouse=1;
var mmVer='Mouse(<span id="verSelect"></span>) Strain:C57BL/6J',rnVer='Rat(<span id="verSelect"></span>) Strain:BN',siteVer="PhenoGen v3.7.5(12/11/2020)",trackBinCutoff=1E4,customTrackLevel=-1,mouseTTOver=0,ttHideHandle=0,tt=d3.select("body").append("div").attr("class","testToolTip").style("z-index",1001).style("opacity",0);tt.append("span").style("float","right").append("img").attr("src","web/images/icons/close.png").on("click",function(){tt.style("opacity",0)});
var tsDialog=d3.select("body").append("div").attr("class","trackSetting").attr("id","trackSettingDialog").style("z-index",1001).style("margin-left","15px").style("margin-right","15px");tsDialog.append("div").attr("id","trackSettingContent").append("table").attr("cellpadding","0").attr("cellspacing","0").append("tbody");
function updatePage(p){var n=Math.round(p.xScale.domain()[0]),r=Math.round(p.xScale.domain()[1]);if((n<p.prevMinCoord||r>p.prevMaxCoord)&&(n<p.dataMinCoord||r>p.dataMaxCoord)){processAjax=1;var u=n;var f=r;n>=p.dataMinCoord&&r>p.dataMaxCoord?u=p.dataMaxCoord+1:n<p.dataMinCoord&&r<=p.dataMaxCoord&&(f=p.dataMinCoord-1);p.setLoading();$.ajax({url:pathPrefix+"updateRegion.jsp",type:"GET",data:{chromosome:chr,minCoord:u,maxCoord:f,fullminCoord:n,fullmaxCoord:r,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,
myOrganism:organism,genomeVer:genomeVer},dataType:"json",success:function(b){p.prevMinCoord=n;p.prevMaxCoord=r;n<p.dataMinCoord&&(p.dataMinCoord=n);r>p.dataMaxCoord&&(p.dataMaxCoord=r);p.folderName=b.folderName;p.updateData();processAjax=0;gtag("event","outsideLoadedRegion",{event_category:"updatePage"})},error:function(b,a,d){console.log(d)}})}}
function back(p){if(history&&history[p]){var n=1<history[p].length?history[p].pop():history[p][0];chr==n.chr&&(n.start==svgList[p].xScale.domain()[0]&&n.stop==svgList[p].xScale.domain()[1]&&(n=1<history[p].length?history[p].pop():history[p][0]),0==p&&$("#geneTxt").val(n.chr+":"+n.start+"-"+n.stop),svgList[p].xScale.domain([n.start,n.stop]),svgList[p].scaleSVG.select(".x.axis").call(svgList[p].xAxis),svgList[p].redraw(),0===p&&updatePage(svgList[p]),svgList[p].updateFullData())}gtag("event","navigateBack",
{event_category:"stepBackSVGNaviation"})}
function zoomIn(p,n){var r={};r.chr=chr;r.start=svgList[p].xScale.domain()[0];r.stop=svgList[p].xScale.domain()[1];var u=Math.floor((r.stop-r.start)*n);1>u&&(u=1);r.start+=u;r.stop-=u;20>r.stop-r.start&&(r.start-=u,r.stop+=u);svgList[p].xScale.domain([r.start,r.stop]);history[p]||(history[p]=[]);history[p].push(r);svgList[p].scaleSVG.select(".x.axis").call(svgList[p].xAxis);svgList[p].redraw();isNaN(zoomUpdateHandle)||(clearTimeout(zoomUpdateHandle),zoomUpdateHandle=Math.NaN);zoomUpdateHandle=setTimeout(function(){0===
p&&updatePage(svgList[p]);svgList[p].updateFullData();0===p&&setTimeout(function(){DisplayRegionReport()},100)},300);0===p&&$("#geneTxt").val(chr+":"+r.start+"-"+r.stop);gtag("event",p,{event_category:"calledZoomIn"})}
function zoomOut(p,n){var r={};r.chr=chr;r.start=svgList[p].xScale.domain()[0];r.stop=svgList[p].xScale.domain()[1];var u=Math.floor((r.stop-r.start)*n);1>u&&(u=1);r.start-=u;r.stop+=u;svgList[p].xScale.domain([r.start,r.stop]);history[p]||(history[p]=[]);history[p].push(r);svgList[p].scaleSVG.select(".x.axis").call(svgList[p].xAxis);svgList[p].redraw();isNaN(zoomUpdateHandle)||(clearTimeout(zoomUpdateHandle),zoomUpdateHandle=Math.NaN);zoomUpdateHandle=setTimeout(function(){0===p&&updatePage(svgList[p]);
svgList[p].updateFullData();0===p&&setTimeout(function(){DisplayRegionReport()},100)},300);0===p&&$("#geneTxt").val(chr+":"+r.start+"-"+r.stop);gtag("event",p,{event_category:"calledZoomOut"})}
function mup(){var p=0;for(p=0;p<svgList.length;p++)if(svgList[p]&&"undefined"!==typeof svgList[p])if(history[p]||0!=p&&1!=p||(history[p]=[]),!(svgList[p].overSettings&&0!=svgList[p].overSettings||isNaN(svgList[p].downx)&&isNaN(svgList[p].downPanx))){if(0===p&&updatePage(svgList[p]),svgList[p].downx=Math.NaN,svgList[p].downPanx=Math.NaN,svgList[p].updateFullData(),0===p&&setTimeout(function(){DisplayRegionReport()},300),0==p||1==p){var n={};n.chr=chr;n.start=svgList[p].xScale.domain()[0];n.stop=svgList[p].xScale.domain()[1];
history[p].push(n)}}else if(!(svgList[p].overSettings&&0!=svgList[p].overSettings||isNaN(svgList[p].downZoomx))){var r=svgList[p].downZoomx;var u=d3.mouse(svgList[p].vis.node());svgList[p].downZoomxEnd=u[0];n=1;u[0]<r?(r=u[0],n=svgList[p].downZoomx-r):n=u[0]-r;u=Math.round(svgList[p].xScale.invert(r));r=Math.round(svgList[p].xScale.invert(r+n));svgList[p].downZoomx=Math.NaN;svgList[p].downZoomxEnd=Math.NaN;0===p&&$("#geneTxt").val(chr+":"+u+"-"+r);d3.select("#Level"+svgList[p].levelNumber).selectAll("svg rect.zoomRect").remove();
d3.select("#Level"+svgList[p].levelNumber).selectAll("svg text#zoomTextStart").remove();d3.select("#Level"+svgList[p].levelNumber).selectAll("svg text#zoomTextEnd").remove();svgList[p].xScale.domain([u,r]);svgList[p].scaleSVG.select(".x.axis").call(svgList[p].xAxis);svgList[p].redraw();svgList[p].updateFullData();0===p&&setTimeout(function(){DisplayRegionReport()},300);if(0==p||1==p)n={},n.chr=chr,n.start=u,n.stop=r,history[p].push(n)}gtag("event","mouseUpFromDrag",{event_category:"dragMouseUp"})}
function mmove(){var p;for(p=0;p<svgList.length;p++)if(svgList[p]&&(!svgList[p].overSettings||0===svgList[p].overSettings))if(!isNaN(svgList[p].downx)){var n=d3.mouse(svgList[p].vis.node());rupx=n[0];if(0!==rupx){var r=Math.round(svgList[p].downscalex.domain()[0]);var u=Math.round(svgList[p].mw*(svgList[p].downx-svgList[p].downscalex.domain()[0])/rupx+svgList[p].downscalex.domain()[0]);u<=svgList[p].xMax&&r>=svgList[p].xMin&&(0===p&&$("#geneTxt").val(chr+":"+r+"-"+u),svgList[p].xScale.domain([r,u]),
svgList[p].scaleSVG.select(".x.axis").call(svgList[p].xAxis),svgList[p].redraw())}}else if(isNaN(svgList[p].downPanx))isNaN(svgList[p].downZoomx)||(f=svgList[p].downZoomx,n=d3.mouse(svgList[p].vis.node()),svgList[p].downZoomxEnd=n[0],n[0]<f?(f=n[0],n=svgList[p].downZoomx-f):n=n[0]-f,r=Math.round(svgList[p].xScale.invert(f)),u=Math.round(svgList[p].xScale.invert(f+n)),d3.select("#Level"+svgList[p].levelNumber).selectAll("svg rect.zoomRect").attr("x",f).attr("width",n),d3.select("#Level"+svgList[p].levelNumber).selectAll("svg text#zoomTextStart").attr("x",
f).attr("y",15).text(numberWithCommas(r)),d3.select("#Level"+svgList[p].levelNumber).selectAll("svg text#zoomTextEnd").attr("x",f+n).attr("y",50).text(numberWithCommas(u)));else if(n=d3.mouse(svgList[p].vis.node()),rupx=n[0],0!==rupx){u=svgList[p].downPanx-rupx;var f=(svgList[p].downscalex.domain()[1]-svgList[p].downscalex.domain()[0])/svgList[p].mw;r=Math.round(svgList[p].downscalex.domain()[0]+u*f);u=Math.round(u*f+svgList[p].downscalex.domain()[1]);u<=svgList[p].xMax&&r>=svgList[p].xMin&&(0===
p&&$("#geneTxt").val(chr+":"+r+"-"+u),svgList[p].xScale.domain([r,u]),svgList[p].scaleSVG.select(".x.axis").call(svgList[p].xAxis),svgList[p].redraw(),svgList[p].downPanx=n[0])}}d3.select("html").on("mousemove",mmove).on("mouseup",mup);$(window).resize(function(){for(var p=0;p<svgList.length;p++)svgList[p]&&svgList[p].resize($(window).width()-25)});
$(document).on("click",".closeBtn",function(){var p=new String($(this).attr("id"));p=p.substr(6);$("."+p).fadeOut("fast");if(-1<p.indexOf("viewsLevel")){var n=p.substr(p.length-1);$("div#nameView"+n).hide();$("div#selection"+n).show();$("span#viewMenuLbl"+n).html("Select/Edit Views");$("div.trackLevel"+n).fadeOut("fast")}gtag("event",p,{event_category:"closeSettings"});return!1});
$(document).on("click",".viewSelect",function(){var p=$(this).attr("id");p=p.substr(p.length-1);if($(".viewsLevel"+p).is(":visible"))$(".viewsLevel"+p).fadeOut("fast");else{var n=$(this).parent().parent().position().top;$(".viewsLevel"+p).css("top",n).css("left",$(window).width()-610);$(".viewsLevel"+p).fadeIn("fast");$("#trackSettingDialog").hide();tt.transition().duration(200).style("opacity",0);gtag("event",p,{event_category:"openViews"})}return!1});
$(document).on("change","input[name='optioncbx']",function(){var p=new String($(this).attr("id")),n=p.indexOf("CBX"),r=new String(p.substr(0,n));n=p.substr(n+3,1);redrawTrack(n,r);gtag("event",p,{event_category:"changeSettingView"})});$(document).on("change","input[name='imgCBX']",function(){var p=new String($(this).attr("id")),n=p.indexOf("CBX");new String(p.substr(0,n));n=p.substr(n+3,1);svgList[n].redraw();setTimeout(function(){DisplayRegionReport()},300);gtag("event",p,{event_category:"clickCbx"})});
$(document).on("click",".reset",function(){var p=new String($(this).attr("id")),n=p.substr(p.length-1);0===p.indexOf("resetImage")?0===n&&($("#geneTxt").val(chr+":"+initMin+"-"+initMax),svgList[0].xScale.domain([initMin,initMax]),svgList[0].scaleSVG.select(".x.axis").call(svgList[0].xAxis),svgList[0].redraw()):0===p.indexOf("resetTracks")&&(svgList[n].removeAllTracks(),setupDefaultView(n));gtag("event",p,{event_category:"resetImage"})});
function numberWithCommas(p){return p.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}
function displayHelpFirstTime(){if(-1===navigator.userAgent.toLowerCase().indexOf("phantomjs"))if($.cookie("genomeBrowserHelp")){var p=$.cookie("genomeBrowserHelp"),n=p.indexOf("v")+1,r=p.indexOf(".",p.indexOf(".")+1);p=p.substr(n,r-n);n=siteVer.indexOf("v")+1;r=siteVer.indexOf(".",siteVer.indexOf(".")+1);n=siteVer.substr(n,r-n);p!==n&&(setTimeout(function(){$("a#fbhelp1").click()},1E3),$.cookie("genomeBrowserHelp",siteVer))}else setTimeout(function(){$("a#fbhelp1").click()},1E3),$.cookie("genomeBrowserHelp",
siteVer)}function removeTrack(p,n){"undefined"!==typeof svgList[p]&&svgList[p].removeTrack(n);gtag("event",p,{event_category:"removeTrack",event_label:n})}function redrawTrack(p,n){svgList[p].redrawTrack(n);gtag("event",p,{event_category:"redrawTrack",event_label:n})}function changeTrackHeight(p,n){if(0<n){var r=n+"px";$("#Scroll"+p).css({"max-height":r,overflow:"auto"})}else $("#Scroll"+p).css({"max-height":"",overflow:"hidden"})}
registerKeyboardHandler=function(p){d3.select(window).on("keydown",p)};function getAllChildrenByName(p,n){var r=[],u=0;if("undefined"!==typeof p&&null!==p&&"undefined"!==typeof p.childNodes)for(var f=p.childNodes,b=0;b<f.length;b++)f.item(b).nodeName==n&&(r[u]=f.item(b),u++);return r}
function getFirstChildByName(p,n){var r=null;if(null!==p&&"undefined"!==typeof p&&"undefined"!==typeof p.childNodes)for(var u=p.childNodes,f=!1,b=0;b<u.length&&!f;b++)u.item(b).nodeName==n&&(r=u.item(b),f=!0);return r}
function getAddMenuDiv(p,n){var r="/"+pathPrefix;""==pathPrefix&&(r="");$.ajax({url:r+"settingsMenu.jsp",type:"GET",cache:!1,data:{level:p,organism:organism,type:n},dataType:"html",success:function(u){$("#imageMenu"+p).remove();d3.select("div#imageMenu").append("div").attr("id","imageMenu"+p);$("#imageMenu"+p).html(u)},error:function(u,f,b){$("#imageMenu"+p).remove();d3.select("div#imageMenu").append("div").attr("id","imageMenu"+p);$("#imageMenu"+p).append('<div class="settingsLevel'+p+'">An error occurred generating this menu.  Please try back later.</div>')},
async:!1})}function loadStateFromString(p,n,r,u){loadSavedConfigTracks(p,r,u);loadImageState(n,r)}
function loadSavedConfigTracks(p,n,r){p=p.split(";");var u=0;r=90>n?svgList[n]:r;for(var f=0;f<p.length;f++){var b=p[f].split(",");if(("Rn"==organism&&"undefined"===typeof mouseOnly[b[0]]||"Mm"==organism&&"undefined"===typeof ratOnly[b[0]])&&""!=b[0]){u++;var a="";if(2<b.length)for(var d=2;d<b.length;d++)a=2==d?b[d]:a+","+b[d];1==n&&(a+=",DrawTrx");r.addTrack(b[0],b[1],a,0)}}0==u&&setupDefaultView(n)}
function loadImageState(p,n){if("undefined"!==typeof p&&""!=p)for(var r=p.split(";"),u=0;u<r.length;u++){var f=r[u].split("=");0==(new String(f[0])).indexOf("displaySelect")&&changeTrackHeight("Level"+n,f[1])}}function calculateBin(p,n){var r=new String(Math.floor(p/n));r=r.substr(0,1)*Math.pow(10,r.length-1);r=Math.floor(r/2);5>r&&(r=0);return r}function key(p){return"undefined"!==typeof p?p.getAttribute("ID"):"unknown"}
function keyName(p){return"undefined"!==typeof p?p.getAttribute("name"):"unknown"}function keyStart(p){return"undefined"!==typeof p?p.getAttribute("start"):"unknown"}function keyTissue(p,n){return"undefined"!==typeof p?p.getAttribute("ID")+n:"unknown"}function keyPos(p){return"undefined"!==typeof p?p.pos:"unknown"}function keyID(p){return"undefined"!==typeof p?p.id:"unknown"}function keySNP(p){return"undefined"!==typeof p?p.getAttribute("strain")+"_"+p.getAttribute("start"):"unknown"}
function GenomeSVG(p,n,r,u,f,b,a,d){var c={isToolTip:0,folderName:"",selectedTrackSetting:"",trackListHash:{},overSettings:0,zoomFactor:.05};c.strainSpecificCountColors=d3.scaleOrdinal(d3.schemeCategory20);0==f&&(c.folderName=regionfolderName);var h={};h.chr=chr;h.start=r;h.stop=u;c.allowSelectGenomeVer="undefined"===typeof d?!0:d;if(20>f){history[f]||(history[f]=[]);try{history[f].push(h)}catch(e){Rollbar.error("history["+f+"] not defined")}}c.get=function(e){return c[e]};c.getTrackData=function(e){for(var g=
[],l=0;l<c.trackList.length;l++)"undefined"!==typeof c.trackList[l]&&c.trackList[l].trackClass==e&&(g=c.trackList[l].data);return g};c.getTrack=function(e){return c.trackListHash[e]};c.addTrackErrorRemove=function(e,g){if("undefined"!==typeof e){var l=g.substr(7);e.select(".infoIcon").style("opacity",0);e.select(".settings").style("opacity",0);e.append("g").attr("class","removeErrorTrack").attr("id","remove"+l+c.levelNumber).attr("transform","translate("+(c.width-40)+",0)").append("image").attr("width",
"16px").attr("height","16px").attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAARBJREFUeNpi/P//PwMlgBHZgNNajGCO6bX/jNgUY5UHGQDCpzSB1Jn/YAxmQ8UJyaNKNitAMJoifPJMIFecvA4ktitCnPT7DwPDJlkG08X/wU4GYRAbJAaWY4CoBetBDoMpjIz/c4rlIKI/v0HohNcQeoEohGbngqjtfcSQ8x8SDiiBCDYkAar41zfUEGSDal7wGq4ZwwC4IT48WKNsypYvKJpBgAVdkbkmkHj3DasBYDk0wIQez+AA+/kPK4YFLNaEBNccC3QhF45kB3IYyBCgGnhiQolnEA3CxhA8mQGCYXwwhqqFpQOwAWBFWDTDEhKGIUjy8KQ6mwG7ZmyGIMtjpAMQjR5V+OQZKc3OAAEGAInHQgT+/r+xAAAAAElFTkSuQmCC").attr("pointer-events",
"all").style("cursor","pointer").on("click",function(m){d3.select(g).remove();gtag("event",g,{event_category:"removeErrorTrack"})}).on("mouseover",function(){c.overSettings=1;$("#mouseHelp").html("");gtag("event",g,{event_category:"mouseHelp"})}).on("mouseout",function(){c.overSettings=0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");gtag("event",g,{event_category:"hideMouseHelp"})})}};c.addTrack=function(e,g,l,m){"Trx"==c.forceDrawAsValue&&-1==
(new String(l)).indexOf("DrawTrx")&&(l=","===l.substr(l.length-1)?l+"DrawTrx,":l+",DrawTrx,");var q=new String(c.folderName);if(0>q.indexOf(chr)||0>q.indexOf(c.xScale.domain()[0]+"_")||0>q.indexOf("_"+c.xScale.domain()[1]))c.folderName="/"+chr+"/"+c.xScale.domain()[0]+"_"+c.xScale.domain()[1],0==c.levelNumber&&regionfolderName!=c.folderName&&(regionfolderName=c.folderName),$.ajax({url:pathPrefix+"getFullPath.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:c.xScale.domain()[0],maxCoord:c.xScale.domain()[1],
panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer},dataType:"json",success:function(E){},error:function(E,D,z){console.log(z)}});q=null;q=d3.select("#Level"+c.levelNumber+e).nodes();if(0===q.length||null==q){q=c.topLevel.append("li").attr("class","draggable"+c.levelNumber).attr("id","li"+e).style("margin-bottom","-3px").append("svg").attr("width",c.width).attr("height",30).attr("class","track").attr("id","Level"+c.levelNumber+e).style("cursor","move").on("mouseover",
function(){0===overSelectable&&("dragzoom"===c.defaultMouseFunct?$("#mouseHelp").html("<B>Zoom:</B> Click and drag to select a region to zoom in. <B>Navigate or Reorder Tracks:</B> Select the appropriate function at the top left of the image."):"pan"===c.defaultMouseFunct?$("#mouseHelp").html("<B>Navigate:</B> Move along Genome by clicking and dragging in desired direction. <B>Zoom or Reorder Tracks:</B> Select the appropriate function at the top left of the image."):"reorder"===c.defaultMouseFunct&&
$("#mouseHelp").html("<B>Reorder Tracks:</B> Click on the track and drag up or down to desired location. <B>Zoom or Navigate:</B> Select the appropriate function at the top left of the image."));gtag("event","",{event_category:"mouseOverTrack"})}).on("mouseout",function(){0===overSelectable&&$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mousemove",function(){d3.event.shiftKey?c.changeTrackCursor("ns-resize"):d3.event.altKey&&"dragzoom"!==
c.defaultMouseFunct?c.changeTrackCursor("crosshair"):d3.event.altKey&&"dragzoom"===c.defaultMouseFunct?c.changeTrackCursor("move"):d3.event.altKey||"dragzoom"!==c.defaultMouseFunct?d3.event.altKey||"dragzoom"===c.defaultMouseFunct||c.changeTrackCursor("move"):c.changeTrackCursor("crosshair")});var t=new String("Loading...");q.append("text").text(t).attr("x",c.width/2-t.length/2*7.5).attr("y",12).attr("id","trkLbl");t=q.append("g").attr("class","infoIcon").attr("transform","translate("+(c.width-20)+
",0)").style("cursor","pointer").attr("track",e).attr("title",e).on("mouseover",function(){var E=$(this).attr("track"),D=trackInfo[E];E=$(this).tooltipster({position:"top-right",maxWidth:250,offsetX:24,offsetY:5,contentAsHTML:!0,interactive:!0,interactiveTolerance:350});E.tooltipster("content",function(){var z="";"undefined"!==typeof D&&"undefined"!==typeof D.Description&&(z=D.Description);return z});E.tooltipster("show");gtag("event",e,{event_category:"trackInfo"})}).on("mouseout",function(){$(this).tooltipster("hide")});
t.append("rect").attr("x",0).attr("y",0).attr("rx",3).attr("ry",3).attr("height",14).attr("width",14).attr("fill","#A7C5E2").attr("stroke","#7795B2");t.append("text").attr("x",2.5).attr("y",12).attr("style","font-family:monospace;font-weight:bold;").attr("fill","#FFFFFF").text("i");q.append("g").attr("class","settings").attr("id",e+"_"+c.levelNumber).attr("transform","translate("+(c.width-40)+",0)").append("image").attr("width","16px").attr("height","16px").attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAAAJdnBBZwAAABAAAAAQAFzGrcMAAAGASURBVCjPlZGxaxNhAMV/9128JF/uLsndaVoPhEopFW2RGAXpKOpQHNwEHXTVf0Chm6OL4OhccFHoYKGFQgMOLoIUEQfBSZCUBtI2yaVt8hwarI6+5cF7v+HBg/+RH1U3q2/+zdxjK0znO0EhWgru20t2J/fZnXInjrYBHAD/ut30OkW3FBURfXrtLDroduf2f4ABaARlLzkdRwFFLCFxFBMdPezDGLj5PT/yMChLNqLm6MDFI2eSvT9Dzj2/qLqu7q4+0mXVlx83BnVdUPrC9wEor6Sa0awW38oCKLy1NqsZpap8AgP5BTgk41fP6QE4u60s4xCwCQArDxofUk2q1i5NAJSmantnlWphvXkXABXf3U6GsSrytwsvC6+CTlWxat2v1+SNR96ZLA9ChSrJyspXqFDlwfkUIAfwcbrvGRwEwAgzEjLDlJ9joPXl6VK639h5cm9rEebfv14emOaZZ9+ck0uUKJTXnretfHvrik7JU+W4+QsCOdzAsOEMT7LfaTGJVMIWBCwAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTAtMDItMTFUMDA6NTM6MDItMDY6MDDZzrlFAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDA5LTA4LTE4VDAyOjI2OjEwLTA1OjAw2ytpkgAAAABJRU5ErkJggg==").attr("pointer-events",
"all").style("cursor","pointer").on("click",function(E){e!=c.selectedTrackSetting?(c.getTrack(e).generateSettingsDiv("div#trackSettingContent"),c.selectedTrackSetting=e,E=$(this).position(),$("#trackSettingDialog").css("top",E.top).css("left",$(window).width()-380),$("#trackSettingDialog").fadeIn("fast")):(c.selectedTrackSetting="",$("#trackSettingDialog").fadeOut("fast"));gtag("event","click",{event_category:"trackSettings"});return!1}).on("mouseover",function(){c.overSettings=1;$("#mouseHelp").html("Track Settings: Click to access track settings or quickly remove the track from the current view.")}).on("mouseout",
function(){c.overSettings=0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")})}if("genomeSeq"==e)q=SequenceTrack(c,e,"Reference Genomic Sequence",l),c.addTrackList(q);else if(-1<e.indexOf("noncoding"))d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/"+e+".xml",function(E,D){if(E)if(60>m){var z=1500;1==m&&(z=2500);setTimeout(function(){c.addTrack(e,g,l,m+1)},z)}else d3.select("#Level"+c.levelNumber+e).select("#trkLbl").text("An errror occurred loading Track:"+
e),d3.select("#Level"+c.levelNumber+e).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+e),"#Level"+c.levelNumber+e);else if(null==D)if(11<=m){z=[];var B=GeneTrack(c,z,e,"Long Non-Coding / Non-PolyA+ Genes",l);c.addTrackList(B)}else setTimeout(function(){c.addTrack(e,g,l,10)},5E3);else{z=D.documentElement.getElementsByTagName("Gene");var G=0,H=D.documentElement.getElementsByTagName("GeneList");0<H.length&&"undefined"!==typeof H[0].getAttribute("ver")&&(G=H[0].getAttribute("ver"));
try{B=GeneTrack(c,z,e,"Long Non-Coding / Non-PolyA+ Genes",l),B.dataVer=G,c.addTrackList(B)}catch(I){}}});else if(-1<e.indexOf("coding"))d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/"+e+".xml",function(E,D){if(E)if(60>m){var z=1500;1==m&&(z=2500);setTimeout(function(){c.addTrack(e,g,l,m+1)},z)}else d3.select("#Level"+c.levelNumber+e).select("#trkLbl").text("An errror occurred loading Track:"+e),d3.select("#Level"+c.levelNumber+e).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+
c.levelNumber+e),"#Level"+c.levelNumber+e);else if(null==D)if(11<=m){z=[];var B=GeneTrack(c,z,e,"Protein Coding / PolyA+",l);c.addTrackList(B)}else setTimeout(function(){c.addTrack(e,g,l,11)},5E3);else{z=D.documentElement.getElementsByTagName("Gene");var G=0,H=D.documentElement.getElementsByTagName("GeneList");0<H.length&&"undefined"!==typeof H[0].getAttribute("ver")&&(G=H[0].getAttribute("ver"));try{B=GeneTrack(c,z,e,"Protein Coding / PolyA+",l),B.dataVer=G,c.addTrackList(B)}catch(I){console.log(I)}}});
else if(-1<e.indexOf("smallnc"))d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/"+e+".xml",function(E,D){if(E){if(0===m){var z=c.xScale.domain()[0],B=c.xScale.domain()[1],G="/"+pathPrefix;pathPrefix||(G="");$.ajax({url:G+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:z,maxCoord:B,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:e,folder:c.folderName},dataType:"json",success:function(H){gtag("event",
"generateTrack"+e,{event_category:"browser"})},error:function(H,I,J){}})}60>m?(z=1500,1==m&&(z=2500),setTimeout(function(){c.addTrack(e,g,l,m+1)},z)):(d3.select("#Level"+c.levelNumber+e).select("#trkLbl").text("An errror occurred loading Track:"+e),d3.select("#Level"+c.levelNumber+e).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+e),"#Level"+c.levelNumber+e))}else if(null==D)11<=m?(z=[],B=GeneTrack(c,z,e,"Small RNA (<200 bp) Genes",l),c.addTrackList(B)):setTimeout(function(){c.addTrack(e,
g,l,11)},5E3);else{z="rn5"===genomeVer?D.documentElement.getElementsByTagName("smnc"):D.documentElement.getElementsByTagName("Gene");try{B=GeneTrack(c,z,e,"Small RNA (<200 bp) Genes",l),c.addTrackList(B),""!=selectGene&&B.setSelected(selectGene)}catch(H){}}});else if(0===e.indexOf("liverTotal")||"heartTotal"===e||0===e.indexOf("brainTotal")||"mergedTotal"===e){var v="Liver Reconstructed";"heartTotal"===e?v="Heart Reconstructed":"brainTotal"===e?v="Whole Brain Reconstructed":"mergedTotal"===e&&(v=
"Merged (Brain,Heart,Liver) Reconstructed");if((0===e.indexOf("liverTotal")||0===e.indexOf("brainTotal"))&&0<e.indexOf("_")){var y=e.substr(e.indexOf("_")+1);v="LEStm"===y?"LE-Stm "+v:"F344Stm"===y?"F344-Stm "+v:v+" v"+y}d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/"+e+".xml",function(E,D){if(E){if(1===m&&("mergedTotal"===e||0===e.indexOf("liverTotal")||0===e.indexOf("brainTotal"))){var z=c.xScale.domain()[0],B=c.xScale.domain()[1],G="/"+pathPrefix;pathPrefix||
(G="");var H=panel;(0===e.indexOf("liverTotal")||0===e.indexOf("brainTotal"))&&0<e.indexOf("_")&&(H=e.substr(e.indexOf("_")+1),"LEStm"===H&&(H="LE-Stm"),"F344Stm"===H&&(H="F344-Stm"));$.ajax({url:G+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:z,maxCoord:B,panel:H,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:e,folder:c.folderName},dataType:"json",success:function(I){gtag("event","generateTrack"+e,{event_category:"browser"})},
error:function(I,J,K){}})}60>m?(z=1500,1==m&&(z=2500),setTimeout(function(){c.addTrack(e,g,l,m+1)},z)):(d3.select("#Level"+c.levelNumber+e).select("#trkLbl").text("An errror occurred loading Track:"+e),d3.select("#Level"+c.levelNumber+e).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+e),"#Level"+c.levelNumber+e))}else if(null==D)11<=m?(z=[],B=GeneTrack(c,z,e,v,l),c.addTrackList(B)):setTimeout(function(){c.addTrack(e,g,l,11)},5E3);else{z=D.documentElement.getElementsByTagName("Gene");
G=0;H=D.documentElement.getElementsByTagName("GeneList");0<H.length&&"undefined"!==typeof H[0].getAttribute("ver")&&(G=H[0].getAttribute("ver"));try{B=GeneTrack(c,z,e,v,l),B.dataVer=G,c.addTrackList(B),""!=selectGene&&B.setSelected(selectGene)}catch(I){}}})}else if(0===e.indexOf("refSeq")){$("#"+e+c.levelNumber+"Select").val();var w=c.xScale.domain()[0],A=c.xScale.domain()[1];y=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/"+e+".xml";d3.xml(y,function(E,D){if(E){console.log(E);
if(0===m){var z="/"+pathPrefix;pathPrefix||(z="");$.ajax({url:z+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:w,maxCoord:A,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:e,folder:c.folderName},dataType:"json",success:function(G){gtag("event","generateTrack"+e,{event_category:"browser"})},error:function(G,H,I){}})}60>m?(z=1500,1===m&&(z=2500),setTimeout(function(){c.addTrack(e,g,l,m+1)},z)):(d3.select("#Level"+
c.levelNumber+e).select("#trkLbl").text("An errror occurred loading Track:"+e),d3.select("#Level"+c.levelNumber+e).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+e),"#Level"+c.levelNumber+e))}else if(null==D)if(11<=m){z=[];var B=RefSeqTrack(c,z,e,"Ref Seq Genes",l);c.addTrackList(B)}else setTimeout(function(){c.addTrack(e,g,l,11)},5E3);else{z=D.documentElement.getElementsByTagName("Gene");try{B=RefSeqTrack(c,z,e,"Ref Seq Genes",l),c.addTrackList(B)}catch(G){console.log(G)}}})}else if(0==
e.indexOf("snp"))w=c.xScale.domain()[0],A=c.xScale.domain()[1],y=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/"+e+".xml",d3.xml(y,function(E,D){if(E){console.log(E);if(0==m){var z="/"+pathPrefix;pathPrefix||(z="");$.ajax({url:z+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:w,maxCoord:A,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:e,folder:c.folderName},dataType:"json",success:function(G){gtag("event",
"generateTrack"+e,{event_category:"browser"})},error:function(G,H,I){}})}60>m?(z=1500,1===m&&(z=2500),setTimeout(function(){c.addTrack(e,g,l,m+1)},z)):(d3.select("#Level"+c.levelNumber+e).select("#trkLbl").text("An errror occurred loading Track:"+e),d3.select("#Level"+c.levelNumber+e).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+e),"#Level"+c.levelNumber+e))}else if(null==D)if(11<=m){z=[];var B=SNPTrack(c,z,e,g,l);c.addTrackList(B)}else setTimeout(function(){c.addTrack(e,
g,l,11)},5E3);else{z=D.documentElement.getElementsByTagName("Snp");try{B=SNPTrack(c,z,e,g,l),c.addTrackList(B)}catch(G){}}});else if("qtl"===e)d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/qtl.xml",function(E,D){if(E)if(60>m){var z=1500;1===m&&(z=2500);setTimeout(function(){c.addTrack(e,g,l,m+1)},z)}else d3.select("#Level"+c.levelNumber+e).select("#trkLbl").text("An errror occurred loading Track:"+e),d3.select("#Level"+c.levelNumber+e).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+
c.levelNumber+e),"#Level"+c.levelNumber+e);else if(null==D)if(11<=m){z=[];var B=QTLTrack(c,z,e,g);c.addTrackList(B)}else setTimeout(function(){c.addTrack(e,g,l,11)},5E3);else{z=D.documentElement.getElementsByTagName("QTL");try{B=QTLTrack(c,z,e,g),c.addTrackList(B)}catch(G){}}});else if("trx"===e)y=getAllChildrenByName(getFirstChildByName(c.selectedData,"TranscriptList"),"Transcript"),q=TranscriptTrack(c,y,e,g),c.addTrackList(q);else if("probe"===e||"probeMouse"==e)d3.xml(dataPrefix+"tmpData/browserCache/"+
genomeVer+"/regionData/"+c.folderName+"/probe.xml",function(E,D){if(E)if(60>m){var z=1500;1===m&&(z=2500);setTimeout(function(){c.addTrack(e,g,l,m+1)},z)}else d3.select("#Level"+c.levelNumber+e).select("#trkLbl").text("An errror occurred loading Track:"+e),d3.select("#Level"+c.levelNumber+e).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+e),"#Level"+c.levelNumber+e);else if(null==D)11<=m?(B=[],z=ProbeTrack(c,B,e,"Affy Exon 1.0 ST Probe Sets",g+","+l),c.addTrackList(z)):setTimeout(function(){c.addTrack(e,
g,l,11)},5E3);else{var B=D.documentElement.getElementsByTagName("probe");try{z=ProbeTrack(c,B,e,"Affy Exon 1.0 ST Probe Sets",g+","+l),c.addTrackList(z)}catch(G){}}});else if("helicos"===e||-1<e.indexOf("illuminaTotal")||-1<e.indexOf("illuminaSmall")||"illuminaPolyA"===e){w=c.xScale.domain()[0];A=c.xScale.domain()[1];var C=calculateBin(A-w,c.width);y=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/tmp/"+w+"_"+A+".count."+e+".xml";0<C&&(w-=w%C,A+=C-A%C,y=dataPrefix+"tmpData/browserCache/"+
genomeVer+"/regionData/"+c.folderName+"/tmp/"+w+"_"+A+".bincount."+C+"."+e+".xml");d3.xml(y,function(E,D){if(E){if(0===m||3===m){var z="/"+pathPrefix;pathPrefix||(z="");tmpPanel=panel;-1<e.indexOf("-")&&(tmpPanel=e.substr(e.indexOf("-")+1));$.ajax({url:z+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:w,maxCoord:A,panel:tmpPanel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:e,folder:c.folderName,binSize:C},dataType:"json",
success:function(G){gtag("event","generateTrack"+e,{event_category:"browser"})},error:function(G,H,I){}});z=1E4}60>m?(z=1E3,0===m&&(z=2500),setTimeout(function(){c.addTrack(e,g,l,m+1)},z)):(d3.select("#Level"+c.levelNumber+e).select("#trkLbl").text("An errror occurred loading Track:"+e),d3.select("#Level"+c.levelNumber+e).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+e),"#Level"+c.levelNumber+e))}else if(null==D)4<=m?(z=[],"helicos"==e?B=HelicosTrack(c,z,e,g):"illuminaTotal"==
e?B=IlluminaTotalTrack(c,z,e,g):"illuminaSmall"==e?B=IlluminaSmallTrack(c,z,e,g):"illuminaPolyA"==e?B=IlluminaPolyATrack(c,z,e,g):"liverilluminaTotalPlus"==e?B=LiverIlluminaTotalPlusTrack(c,z,e,g):"liverilluminaTotalMinus"==e?B=LiverIlluminaTotalMinusTrack(c,z,e,g):"heartilluminaTotalPlus"==e?B=HeartIlluminaTotalPlusTrack(c,z,e,g):"heartilluminaTotalMinus"==e?B=HeartIlluminaTotalMinusTrack(c,z,e,g):"brainilluminaTotalPlus"==e?B=BrainIlluminaTotalPlusTrack(c,z,e,g):"brainilluminaTotalMinus"==e?B=BrainIlluminaTotalMinusTrack(c,
z,e,g):"liverilluminaSmall"==e?B=LiverIlluminaSmallTrack(c,z,e,g):"heartilluminaSmall"==e?B=HeartIlluminaSmallTrack(c,z,e,g):-1<e.indexOf("illuminaTotal")&&(B=StrainSpecificIlluminaTotalTrack(c,z,e,g,l)),c.addTrackList(B)):setTimeout(function(){c.addTrack(e,g,l,4)},3E3);else{z=D.documentElement.getElementsByTagName("Count");var B;try{"helicos"===e?B=HelicosTrack(c,z,e,g):"illuminaTotal"===e?B=IlluminaTotalTrack(c,z,e,g):"illuminaSmall"===e?B=IlluminaSmallTrack(c,z,e,g):"illuminaPolyA"===e?B=IlluminaPolyATrack(c,
z,e,g):"liverilluminaTotalPlus"===e?B=LiverIlluminaTotalPlusTrack(c,z,e,g):"liverilluminaTotalMinus"===e?B=LiverIlluminaTotalMinusTrack(c,z,e,g):"heartilluminaTotalPlus"===e?B=HeartIlluminaTotalPlusTrack(c,z,e,g):"heartilluminaTotalMinus"===e?B=HeartIlluminaTotalMinusTrack(c,z,e,g):"brainilluminaTotalPlus"===e?B=BrainIlluminaTotalPlusTrack(c,z,e,g):"brainilluminaTotalMinus"===e?B=BrainIlluminaTotalMinusTrack(c,z,e,g):"liverilluminaSmall"===e?B=LiverIlluminaSmallTrack(c,z,e,g):"heartilluminaSmall"===
e?B=HeartIlluminaSmallTrack(c,z,e,g):-1<e.indexOf("illuminaTotal")&&(B=StrainSpecificIlluminaTotalTrack(c,z,e,g,l)),c.addTrackList(B)}catch(G){}}})}else if(-1<e.indexOf("spliceJnct")){w=c.xScale.domain()[0];A=c.xScale.domain()[1];y=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/"+e+".xml";var F="Brain ";"liverspliceJnct"==e?F="Liver ":"heartspliceJnct"==e&&(F="Heart ");d3.xml(y,function(E,D){if(E){console.log(E);if(0==m){var z="/"+pathPrefix;pathPrefix||(z="");$.ajax({url:z+
"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:w,maxCoord:A,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:e,folder:c.folderName},dataType:"json",success:function(G){gtag("event","generateTrack"+e,{event_category:"browser"})},error:function(G,H,I){}})}60>m?(z=1500,1===m&&(z=2500),setTimeout(function(){c.addTrack(e,g,l,m+1)},z)):(d3.select("#Level"+c.levelNumber+e).select("#trkLbl").text("An errror occurred loading Track:"+
e),d3.select("#Level"+c.levelNumber+e).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+e),"#Level"+c.levelNumber+e))}else if(null==D)if(11<=m){z=[];var B=SpliceJunctionTrack(c,z,e,F+"Splice Junctions",1,"");c.addTrackList(B)}else setTimeout(function(){c.addTrack(e,g,l,11)},5E3);else{z=D.documentElement.getElementsByTagName("Feature");console.log(z);try{B=SpliceJunctionTrack(c,z,e,F+"Splice Junctions",3,""),c.addTrackList(B)}catch(G){console.log(G)}}})}else if("polyASite"==
e)d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/polyASite.xml",function(E,D){if(E)if(60>m){var z=1E3;1===m&&(z=2500);setTimeout(function(){c.addTrack(e,g,l,m+1)},z)}else d3.select("#Level"+c.levelNumber+e).select("#trkLbl").text("An errror occurred loading Track:"+e),d3.select("#Level"+c.levelNumber+e).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+e),"#Level"+c.levelNumber+e);else if(null==D)if(4<=m){z=[];var B=PolyATrack(c,z,e,"Predicted PolyA Sites",
l);c.addTrackList(B)}else setTimeout(function(){c.addTrack(e,g,l,4)},5E3);else{z=D.documentElement.getElementsByTagName("Feature");try{B=PolyATrack(c,z,e,"Predicted PolyA Sites",l),c.addTrackList(B)}catch(G){}}});else if(0===e.indexOf("repeatMask"))$("#"+e+c.levelNumber+"Select").val(),w=c.xScale.domain()[0],A=c.xScale.domain()[1],y=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/"+e+".xml",d3.xml(y,function(E,D){if(E){console.log(E);if(0===m){var z="/"+pathPrefix;pathPrefix||
(z="");$.ajax({url:z+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:w,maxCoord:A,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:e,folder:c.folderName},dataType:"json",success:function(G){gtag("event","generateTrack"+e,{event_category:"browser"})},error:function(G,H,I){}})}60>m?(z=1500,1===m&&(z=2500),setTimeout(function(){c.addTrack(e,g,l,m+1)},z)):(d3.select("#Level"+c.levelNumber+e).select("#trkLbl").text("An errror occurred loading Track:"+
e),d3.select("#Level"+c.levelNumber+e).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+e),"#Level"+c.levelNumber+e))}else if(null==D)if(11<=m){z=[];var B=RepeatMaskTrack(c,z,e,"Repeat Masker",g,l);c.addTrackList(B)}else setTimeout(function(){c.addTrack(e,g,l,11)},5E3);else{z=D.documentElement.getElementsByTagName("Feature");try{B=RepeatMaskTrack(c,z,e,"Repeat Masker",g,l),c.addTrackList(B)}catch(G){console.log(G)}}});else if(0==e.indexOf("custom"))if(q=trackInfo[e],l=l+",Name="+
q.Name,l="DataFile="+q.Location+","+l,"bed"==q.Type||"bb"==q.Type)y=[],q=CustomTranscriptTrack(c,y,e,q.Name,3,l),c.addTrackList(q),q.updateFullData(0,0);else{if("bg"==q.Type||"bw"==q.Type)y=[],q=CustomCountTrack(c,y,e,3,l),c.addTrackList(q)}else 0<=e.indexOf("cirRNA")&&(q=trackInfo[e],q=CircRNATrack(c,y,e,q.Name,3,l),c.addTrackList(q));$(".sortable"+c.levelNumber).sortable("refresh");gtag("event",e,{event_category:"trackAdded"})};c.addTrackList=function(e){null!=e&&(c.trackList[c.trackCount]=e,c.trackCount++,
c.trackListHash[e.trackClass]=e,setTimeout(function(){DisplayRegionReport()},300))};c.updateLinks=function(){1===c.levelNumber&&d3.select("#probeSetDetailLink1").each(function(){var e=new String(d3.select(this).attr("href"));e=e.substr(0,e.lastIndexOf("=")+1);e+=c.currentView.ViewID;d3.select(this).attr("href",e)})};c.changeTrackHeight=function(e,g){0<g?d3.select("#"+e+"Scroll").style("max-height",g+"px").style("overflow","auto"):d3.select("#"+e+"Scroll").style("max-height","none").style("overflow",
"hidden")};c.removeAllTracks=function(){d3.selectAll("li.draggable"+c.levelNumber).remove();c.trackList=[];setTimeout(function(){DisplayRegionReport()},300);gtag("event",c.levelNumber,{event_category:"SVGremoveAllTracks"})};c.removeTrack=function(e){d3.select("#Level"+c.levelNumber+e).remove();for(var g=0;g<c.trackList.length;g++)"undefined"!==typeof c.trackList[g]&&c.trackList[g].trackClass==e&&(c.trackList.splice(g,1),c.trackCount--);c.trackListHash[e]=void 0;setTimeout(function(){DisplayRegionReport()},
300);gtag("event",c.levelNumber,{event_category:"removeTrack",event_label:e})};c.redrawTrack=function(e){for(var g=0;g<c.trackList.length;g++)"undefined"!==typeof c.trackList[g]&&c.trackList[g].trackClass==e&&c.trackList[g].redraw();setTimeout(function(){DisplayRegionReport()},300)};c.redraw=function(){for(var e=0;e<c.trackList.length;e++)"undefined"!==typeof c.trackList[e]&&"undefined"!==typeof c.trackList[e].redraw&&c.trackList[e].redraw();c.selectSvg.redraw()};c.update=function(){for(var e=0;e<
c.trackList.length;e++)"undefined"!==typeof c.trackList[e].update&&c.trackList[e].update();setTimeout(function(){DisplayRegionReport()},300);gtag("event","genomeSVG.update",{event_category:"gsvgUpdate"})};c.updateData=function(){for(var e=0;e<c.trackList.length;e++)"undefined"!==typeof c.trackList[e]&&"undefined"!==typeof c.trackList[e].updateData&&c.trackList[e].updateData(0);c.updateFullData();setTimeout(function(){DisplayRegionReport()},300);gtag("event","genomeSVG.updateData",{event_category:"gsvgUpdateData"})};
c.updateFullData=function(){-1<(new String(c.folderName)).indexOf("img")&&(c.folderName="/"+chr+"/"+c.xScale.domain()[0]+"_"+c.xScale.domain()[1],0==c.levelNumber&&regionfolderName!=c.folderName&&(regionfolderName=c.folderName),setTimeout(function(){DisplayRegionReport()},300));for(var e=0;e<c.trackList.length;e++)"undefined"!==typeof c.trackList[e]&&"undefined"!==typeof c.trackList[e].updateFullData&&c.trackList[e].updateFullData(0,1);gtag("event","genomeSVG.updateFullData",{event_category:"gsvgUpdateFullData"})};
c.setLoading=function(){for(var e=0;e<c.trackList.length;e++)"undefined"===typeof c.trackList[e]||"undefined"===typeof c.trackList[e].updateData&&"undefined"===typeof c.trackList[e].updateFullData||c.trackList[e].showLoading()};c.clearSelection=function(){c.selectionStart=-1;c.selectionEnd=-1;c.scaleSVG.selectAll("rect.selectedArea").remove();c.selectSvg.setVis(!1);for(var e=0;e<c.trackList.length;e++)"undefined"!==typeof c.trackList[e]&&"undefined"!==typeof c.trackList[e].clearSelection&&c.trackList[e].clearSelection()};
c.mdown=function(){if(0==c.overSettings)if("dragzoom"!==c.defaultMouseFunct&&d3.event.altKey||"dragzoom"===c.defaultMouseFunct&&!d3.event.altKey){var e=d3.mouse(c.vis.node());c.downZoomx=e[0];c.scaleSVG.append("rect").attr("class","zoomRect").attr("x",e[0]).attr("y",0).attr("height",c.scaleSVG.attr("height")).attr("width",1).attr("fill","#CECECE").attr("opacity",.3);c.scaleSVG.append("text").attr("id","zoomTextStart").attr("x",c.downZoomx).attr("y",15).text(numberWithCommas(Math.round(c.xScale.invert(c.downZoomx))));
c.scaleSVG.append("text").attr("id","zoomTextEnd").attr("x",c.downZoomx).attr("y",50).text(numberWithCommas(Math.round(c.xScale.invert(c.downZoomx))))}else 0==processAjax&&(c.prevMinCoord=c.xScale.domain()[0],c.prevMaxCoord=c.xScale.domain()[1],e=d3.mouse(c.vis.node()),c.downx=c.xScale.invert(e[0]),c.downscalex=c.xScale)};c.forceDrawAs=function(e){for(var g=0;g<c.trackList.length;g++)"undefined"!==typeof c.trackList[g]&&"undefined"!==typeof c.trackList[g].drawAs&&(c.trackList[g].drawAs=e,c.trackList[g].draw(c.trackList[g].data));
c.forceDrawAsValue=e};c.resize=function(e){c.width=e;c.xScale.range([0,c.width]);c.xAxis=d3.axisTop(c.xScale).ticks(6).tickSize(8).tickPadding(10);c.scaleSVG.attr("width",c.width);c.scaleSVG.select(".x.axis").call(c.xAxis);d3.select("#Level"+c.levelNumber).select(".axisLbl").attr("x",(c.width-2*c.margin)/2);c.topLevel.style("width",c.width+18+"px");for(var g=0;g<c.trackList.length;g++)"undefined"!==typeof c.trackList[g]&&"undefined"!==typeof c.trackList[g].redraw&&c.trackList[g].resize();c.selectSvg.width=
e;c.selectSvg.draw()};c.updateCountScales=function(e,g){for(var l=0;l<c.trackList.length;l++)"undefined"!==typeof c.trackList[l]&&"undefined"!==typeof c.trackList[l].updateCountScale&&c.trackList[l].updateCountScale(e,g)};c.resetDefaultMouse=function(e){var g="/web/images/icons/"+e+"_dark.png";d3.select("span#"+e+c.levelNumber+" img").attr("src",g);d3.select("span#"+e+c.levelNumber).style("background","#DCDCDC")};c.changeTrackCursor=function(e){for(var g=0;g<c.trackList.length;g++)"undefined"!==typeof c.trackList[g]&&
"undefined"!==typeof c.trackList[g].svg&&c.trackList[g].svg.style("cursor",e)};c.changeScaleCursor=function(e){"undefined"!==typeof c.scaleSVG&&c.scaleSVG.style("cursor",e)};c.updateTrackSelectedArea=function(e,g){c.selectionStart=e;c.selectionEnd=g;var l=c.xScale(e),m=c.xScale(g)-l;c.scaleSVG.selectAll("rect.selectedArea").remove();if((0<l||0<l+m)&&l<c.width)for(1>m&&(m=1),c.scaleSVG.append("rect").attr("class","selectedArea").attr("x",l).attr("y",15).attr("height",c.scaleSVG.attr("height")-15).attr("width",
m).attr("fill","#CECECE").attr("opacity",.3).attr("pointer-events","none"),l=0;l<c.trackList.length;l++)"undefined"!==typeof c.trackList[l]&&"undefined"!==typeof c.trackList[l].setSelectedArea&&c.trackList[l].setSelectedArea(e,g)};c.getAddMenus=function(){var e="/"+pathPrefix;""==pathPrefix&&(e="");$.ajax({url:e+"trackMenu.jsp",type:"GET",cache:!1,data:{level:c.levelNumber,organism:organism},dataType:"html",success:function(g){$("#trackMenu"+c.levelNumber).remove();d3.select("div#trackMenu").append("div").attr("id",
"trackMenu"+c.levelNumber);$("#trackMenu"+c.levelNumber).html(g)},error:function(g,l,m){$("#trackMenu"+c.levelNumber).remove();d3.select("div#trackMenu").append("div").attr("id","trackMenu"+c.levelNumber);$("#trackMenu"+c.levelNumber).append('<div class="viewsLevel'+c.levelNumber+'">An error occurred generating this menu.  Please try back later.</div>')},async:!1});$.ajax({url:e+"viewMenu.jsp",type:"GET",cache:!1,data:{level:c.levelNumber,organism:organism},dataType:"html",success:function(g){$("#viewMenu"+
c.levelNumber).remove();d3.select("div#viewMenu").append("div").attr("id","viewMenu"+c.levelNumber);$("#viewMenu"+c.levelNumber).html(g)},error:function(g,l,m){$("#viewMenu"+c.levelNumber).remove();d3.select("div#viewMenu").append("div").attr("id","viewMenu"+c.levelNumber);$("#viewMenu"+c.levelNumber).append('<div class="viewsLevel'+c.levelNumber+'">An error occurred generating this menu.  Please try back later.</div>')},async:!1})};c.zoomMenuChange=function(e){d3.select("#zoomSelectMenu"+c.levelNumber).selectAll("li").style("background",
"#FFFFFF");c.zoomFactor=parseFloat(d3.select(e).attr("value"));d3.select(e).style("background","#CECECE")};c.setupFunctionBar=function(){d3.selectAll("span.shrt-button").on("click",function(){nameSpan=d3.select(this).attr("name");-1<nameSpan.toLowerCase().indexOf("gene")?(console.log(":"+selectedID+":"),""!==selectedID?($("div#selectedDetail").is(":visible")||0!==selectedID.indexOf("ENS")||c.getTrack("ensemblcoding").setSelected(selectedID),$("span[name='"+nameSpan+"']").click(),$("html, body").animate({scrollTop:$("#selectedReport").offset().top},
1E3)):alert("You must select a gene from an Ensembl Track before clicking on the gene shortcut.")):($("span.closeDetail").click(),$("span#"+nameSpan).click(),$("html, body").animate({scrollTop:$("#regionDiv").offset().top},1E3))});d3.select(p).select("#functLevel"+c.levelNumber).remove();c.functionBar=c.vis.append("div").attr("class","functionBar").attr("id","functLevel"+c.levelNumber).style("float","left");var e=c.functionBar.append("div").attr("class","defaultMouse").attr("id","defaultMouse"+c.levelNumber);
e.append("span").attr("id","dragzoom"+c.levelNumber).style("height","24px").style("display","inline-block").style("cursor","pointer").append("img").attr("class","mouseOpt dragzoom").attr("src","/web/images/icons/dragzoom_dark.png").attr("pointer-events","all").on("click",function(){c.resetDefaultMouse(c.defaultMouseFunct);c.defaultMouseFunct="dragzoom";d3.select(this).attr("src","/web/images/icons/dragzoom_white.png");d3.select("span#dragzoom"+c.levelNumber).style("background","#989898");c.changeTrackCursor("crosshair");
c.changeScaleCursor("crosshair");gtag("event","",{event_category:"clickDragZoom"})}).on("mouseout",function(){"dragzoom"!=c.defaultMouseFunct&&(d3.select(this).attr("src","/web/images/icons/dragzoom_dark.png"),d3.select("span#dragzoom"+c.levelNumber).style("background","#DCDCDC"))}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/dragzoom_white.png");d3.select("span#dragzoom"+c.levelNumber).style("background","#989898");$("#mouseHelp").html("Click to set default mouse function to allow click and drag to select a region to zoom in on.")});
e.append("span").attr("id","pan"+c.levelNumber).style("height","24px").style("display","inline-block").style("cursor","pointer").append("img").attr("class","mouseOpt pan").attr("src","/web/images/icons/pan_dark.png").attr("pointer-events","all").on("click",function(){c.resetDefaultMouse(c.defaultMouseFunct);c.defaultMouseFunct="pan";d3.select(this).attr("src","/web/images/icons/pan_white.png");d3.select("span#pan"+c.levelNumber).style("background","#989898");c.changeTrackCursor("move");c.changeScaleCursor("ew-resize");
gtag("event","",{event_category:"clickPan"})}).on("mouseout",function(){"pan"!=c.defaultMouseFunct&&(d3.select(this).attr("src","/web/images/icons/pan_dark.png"),d3.select("span#pan"+c.levelNumber).style("background","#DCDCDC"))}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/pan_white.png");d3.select("span#pan"+c.levelNumber).style("background","#989898");$("#mouseHelp").html("Click to set default mouse function to allow click and drag to navigate along the genome.")});
e.append("span").attr("id","reorder"+c.levelNumber).style("height","24px").style("display","inline-block").style("cursor","pointer").append("img").attr("class","mouseOpt pan").attr("src","/web/images/icons/reorder_dark.png").attr("pointer-events","all").on("click",function(){c.resetDefaultMouse(c.defaultMouseFunct);c.defaultMouseFunct="reorder";d3.select(this).attr("src","/web/images/icons/reorder_white.png");d3.select("span#reorder"+c.levelNumber).style("background","#989898");c.changeTrackCursor("ns-resize");
c.changeScaleCursor("ew-resize");gtag("event","",{event_category:"clickReorder"})}).on("mouseout",function(){"reorder"!=c.defaultMouseFunct&&(d3.select(this).attr("src","/web/images/icons/reorder_dark.png"),d3.select("span#reorder"+c.levelNumber).style("background","#DCDCDC"))}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/reorder_white.png");d3.select("span#reorder"+c.levelNumber).style("background","#989898");$("#mouseHelp").html("Click to set default mouse function to reorder image tracks. <strong>Optionally hold down shift in any mode.</strong>")});
$("span#"+c.defaultMouseFunct+c.levelNumber+" img").click();c.functionBar.append("span").attr("class","saveImage control").style("display","inline-block").attr("id","saveLevel"+c.levelNumber).style("cursor","pointer").append("img").attr("src","/web/images/icons/savePic_dark.png").attr("pointer-events","all").attr("cursor","pointer").on("click",function(){var g=$(this).parent().attr("id"),l=(new String(g)).substr(9);g=$("div#Level"+l).html();$.ajax({url:pathPrefix+"saveBrowserImage.jsp",type:"POST",
contentType:"text/html",data:g+"\n",processData:!1,dataType:"json",success:function(m){var q=new Date;q=q.getMonth()+1+"_"+q.getDate()+"_"+q.getFullYear();var t="http://";"https:"===location.protocol&&(t="https://");var v=t+urlprefix+"/tmpData/download/"+m.imageFile;m=new String($("#geneTxt").val());m=m.replace(/:/g,"_");m=m.replace(/-/g,"_");m=m.replace(/,/g,"");"Level1"==l&&(m=svgList[1].selectedData.getAttribute("geneSymbol"));var y=m+"_"+q+".png",w=new XMLHttpRequest;w.open("GET",v);w.responseType=
"blob";w.send();w.onreadystatechange=function(){if(4!=w.readyState||200!=w.status)return!1;var A=document.createElement("a");A.href=window.URL.createObjectURL(w.response);A.download=y;A.style.display="none";document.body.appendChild(A);try{A.click()}catch(C){$("#mouseHelp").html("<span style='color:#FF0000;'>Your browser will not save the image directly. Image will open in a popup, in the new window right click to save image.</span>"),window.open(v)}return!0};gtag("event","saveBrowserImage",{event_category:"browser"})},
error:function(m,q,t){console.log(t)}});gtag("event","",{event_category:"saveImage"})}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/savePic_white.png");d3.select("span#savePic"+c.levelNumber).style("background","#DCDCDC");$("#mouseHelp").html("Click to download a PNG image of the current view.")}).on("mouseout",function(){d3.select(this).attr("src","/web/images/icons/savePic_dark.png");d3.select("span#savePic"+c.levelNumber).style("background","#989898");$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});
c.functionBar.append("span").attr("class","reset control").style("display","inline-block").attr("id","resetImage"+c.levelNumber).style("cursor","pointer").append("img").attr("src","/web/images/icons/reset_dark.png").attr("pointer-events","all").attr("cursor","pointer").on("click",function(){var g=new String($(this).parent().attr("id"));g=g.substr(g.length-1);0==g?($("#geneTxt").val(chr+":"+initMin+"-"+initMax),svgList[0].xScale.domain([initMin,initMax]),svgList[0].scaleSVG.select(".x.axis").call(svgList[0].xAxis),
svgList[0].redraw()):(svgList[g].xScale.domain([svgList[g].initMin,svgList[g].initMax]),svgList[g].scaleSVG.select(".x.axis").call(svgList[g].xAxis),svgList[g].redraw());svgList[0].updateFullData();gtag("event","",{event_category:"clickResetImage"})}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/reset_white.png");d3.select("span#reset"+c.levelNumber).style("background","#DCDCDC");$("#mouseHelp").html("Click to reset image zoom to initial region.")}).on("mouseout",function(){d3.select(this).attr("src",
"/web/images/icons/reset_dark.png");d3.select("span#reset"+c.levelNumber).style("background","#989898");$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});c.functionBar.append("span").attr("class","back control").style("display","inline-block").attr("id","backButton"+c.levelNumber).style("cursor","pointer").append("img").attr("src","/web/images/icons/back_dark2.png").attr("pointer-events","all").attr("cursor","pointer").on("click",function(){back(c.levelNumber);
gtag("event","",{event_category:"clickBack"})}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/back_white2.png");$("#mouseHelp").html("Click to undo last zoom/pan.")}).on("mouseout",function(){d3.select(this).attr("src","/web/images/icons/back_dark2.png");$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});e=c.functionBar.append("span").style("display","inline-block").style("position","relative").style("top","-9px").attr("id",
"zoom"+c.levelNumber);e.append("button").attr("id","zoomInButton"+c.levelNumber).attr("class","zoomIn").style("height","2.3em").append("img").style("position","relative").style("top","-5px").attr("src","/web/images/icons/magPlus_dark_32.png").attr("pointer-events","all").attr("cursor","pointer");e.append("button").attr("id","zoomOutButton"+c.levelNumber).attr("class","zoomOut").style("height","2.3em").append("img").style("position","relative").style("top","-5px").attr("src","/web/images/icons/magMinus_dark_32.png").attr("pointer-events",
"all").attr("cursor","pointer");e.append("button").attr("id","zoomMenuSelect"+c.levelNumber).attr("class","zoomSelectMenu");testChrome?(console.log("CHROME"),d3.select("#zoomSelect"+c.levelNumber).style("height","2.3em")):testSafari&&d3.select("#zoomSelect"+c.levelNumber).style("height","2.3em");e=c.functionBar.append("ul").attr("id","zoomSelectMenu"+c.levelNumber);e.append("li").attr("id","zoom1"+c.levelNumber).attr("value","0.025").on("click",function(){c.zoomMenuChange(this)}).text("0.5x");e.append("li").attr("id",
"zoom2"+c.levelNumber).attr("value","0.05").style("background","#CECECE").on("click",function(){c.zoomMenuChange(this)}).text("1x");e.append("li").attr("id","zoom3"+c.levelNumber).attr("value","0.1").on("click",function(){c.zoomMenuChange(this)}).text("2x");e.append("li").attr("id","zoom4"+c.levelNumber).attr("value","0.25").on("click",function(){c.zoomMenuChange(this)}).text("5x");e.append("li").attr("id","zoom5"+c.levelNumber).attr("value","0.5").on("click",function(){c.zoomMenuChange(this)}).text("10x");
$("#zoomInButton"+c.levelNumber).button().click(function(){zoomIn(c.levelNumber,c.zoomFactor);gtag("event","",{event_category:"clickZoomIn"})}).on("mouseover",function(){$(this).css("background","#989898");$("img",this).attr("src","/web/images/icons/magPlus_light_32.png");$("#mouseHelp").html("Click to zoom in on the center of the region.  Click and drag the scale to zoom in or out more quickly or select the region select tool to highlight a specific region.")}).on("mouseout",function(){$(this).css("background",
"#e6e6e6");$("img",this).attr("src","/web/images/icons/magPlus_dark_32.png");$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).next().button().click(function(){zoomOut(c.levelNumber,c.zoomFactor);gtag("event","",{event_category:"clickZoomOut"})}).on("mouseover",function(){$(this).css("background","#989898");$("img",this).attr("src","/web/images/icons/magMinus_light_32.png");$("#mouseHelp").html("Click to zoom out from the center of the region.  Click and drag the scale to zoom in or out more quickly or select the region select tool to highlight a specific region.")}).on("mouseout",
function(){$(this).css("background","#e6e6e6");$("img",this).attr("src","/web/images/icons/magMinus_dark_32.png");$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).next().button({text:!1,icons:{primary:"ui-icon-triangle-1-s"}}).click(function(){var g=$(this).parent().next().show().position({my:"left top",at:"left bottom",of:this});$(document).on("click",function(){g.hide()});return!1}).parent().buttonset().next().hide().menu()};c.generateSettingsString=
function(){ret="";$("#ScrollLevel"+c.levelNumber+" li.draggable"+c.levelNumber).each(function(){var e=new String($(this).attr("id"));e=e.substr(2);"undefined"!==typeof c.trackListHash[e]&&(ret+=c.trackListHash[e].generateTrackSettingString())});return ret};c.setCurrentViewModified=function(){c.currentView.modified=1;$("span#viewModifiedCtl"+c.levelNumber).show()};c.clearCurrentView=function(){c.currentView.modified=0;$("span#viewModifiedCtl"+c.levelNumber).hide()};c.type=a;c.div=p;c.margin=0;c.halfWindowWidth=
$(window).width()/2;c.mh=400;c.downx=Math.NaN;c.downscalex;c.downPanx=Math.NaN;c.downZoomx=Math.NaN;c.downZoomxEnd=Math.NaN;c.defaultMouseFunct="pan";c.xMax=29E7;c.xMin=1;c.prevMinCoord=r;c.prevMaxCoord=u;c.initMin=r;c.initMax=u;c.dataMinCoord=r;c.dataMaxCoord=u;c.y=0;c.xScale=null;c.xAxis=null;c.vis=null;c.level=null;c.svg=null;c.txType=null;c.txList=null;c.tt=null;c.trackList=[];c.trackCount=0;c.levelNumber=f;c.selectedData=null;c.txType=null;c.selectionStart=-1;c.selectionEnd=-1;c.scrollSize=350;
c.width=n;c.mw=c.width-c.margin;d3.select(p).select("#viewsLevel"+f).remove();d3.select(p).select("#Level"+f).remove();c.vis=d3.select(p);c.setupFunctionBar();0==$("#viewSelect"+c.levelNumber).length&&(n=c.vis.append("div").style("float","right").style("display","inline-block").style("margin-right","5px"),a=n.append("div"),a.append("button").attr("id","viewSelect"+c.levelNumber).attr("class","viewSelect").text("Select/Edit Views").on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",
function(){$("#mouseHelp").html("Click to select another view or edit the current view.")}),a.append("button").attr("id","viewMenuSelect"+c.levelNumber).attr("class","viewSelectMenu").on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",function(){$("#mouseHelp").html("Click for options to quickly save and delete your current view.")}),testChrome?d3.select("#viewSelect"+c.levelNumber).style("height","2.3em"):
testSafari?d3.select("#viewSelect"+c.levelNumber).style("height","2.3em"):testFireFox||testIE&&d3.select("#viewSelect"+c.levelNumber).style("position","relative").style("top","-8px").style("height","2.3em"),n=n.append("ul").attr("id","viewSelectMenu"+c.levelNumber),n.append("li").attr("id","menusaveView"+c.levelNumber).on("click",function(){viewMenu[c.levelNumber].saveView(c.currentView.ViewID,c,!1);$("#viewModifiedCtl"+c.level).hide();gtag("event","",{event_category:"menuSaveView"})}).text("Save"),
n.append("li").attr("id","menusaveAsView"+c.levelNumber).on("click",function(){viewMenu[c.levelNumber].saveAsView(c.currentView,svgList[c.levelNumber]);$(".viewsLevel"+c.levelNumber).css("top",250).css("left",$(window).width()-610);$(".viewsLevel"+c.levelNumber).fadeIn("fast");$("#viewModifiedCtl"+c.level).hide();gtag("event","",{event_category:"menuSaveAsView"})}).text("Save As"),n.append("li").attr("id","menudeleteView"+c.levelNumber).on("click",function(){viewMenu[c.levelNumber].confirmDeleteView(c.currentView);
$(".viewsLevel"+c.levelNumber).css("top",250).css("left",$(window).width()-610);$(".viewsLevel"+c.levelNumber).fadeIn("fast");gtag("event","",{event_category:"menuDeleteView"})}).text("Delete"),$("#viewSelect"+c.levelNumber).button().click(function(){}).next().button({text:!1,icons:{primary:"ui-icon-triangle-1-s"}}).click(function(){var e=$(this).parent().next().show().position({my:"left top",at:"left bottom",of:this});$(document).on("click",function(){e.hide()});return!1}).parent().buttonset().next().hide().menu(),
c.vis.append("span").style("float","right").style("margin-right","5px").append("span").attr("id","mainAddTrack"+c.levelNumber).attr("class","control").style("height","24px").style("display","inline-block").style("cursor","pointer").append("img").attr("class","mainAddTrack").attr("src","/web/images/icons/addTrack_dark_32.png").attr("pointer-events","all").style("height","37px").style("position","relative").style("top","-8px").on("click",function(){if($(".trackLevel"+c.levelNumber).is(":visible"))$(".trackLevel"+
c.levelNumber).fadeOut("fast");else{var e=$(this).parent().parent().position();trackMenu[c.levelNumber].standalone=!0;$(".trackLevel"+c.levelNumber).css("top",e.top).css("left",e.left+-561);$(".trackLevel"+c.levelNumber+" span#selectedViewName").html(c.currentView.Name);$(".trackLevel"+c.levelNumber).fadeIn("fast");$("div#selectTrack"+c.levelNumber).show();$("div#addUsrTrack"+c.levelNumber).hide();$("div#addUsrTrack"+c.levelNumber).hide();$("div#deleteUsrTrack"+c.levelNumber).hide();setTimeout(function(){trackMenu[c.levelNumber].generateTrackTable()},
250);gtag("event","",{event_category:"clickAddTrack"})}}).on("mouseout",function(){d3.select(this).attr("src","/web/images/icons/addTrack_dark_32.png");d3.select("span#mainAddTrack"+c.levelNumber).style("background","#DCDCDC");$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/addTrack_light_32.png");d3.select("span#mainAddTrack"+c.levelNumber).style("background","#989898");$("#mouseHelp").html("Click to quickly add other tracks to the current view.")}),
n=c.vis.append("span").style("float","right").style("margin-right","5px"),n.append("input").attr("type","checkbox").attr("name","imgCBX").attr("id","forceTrxCBX"+c.levelNumber),n.append("label").attr("for","forceTrxCBX"+c.levelNumber).text("Draw Genes as Transcripts").on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",function(){$("#mouseHelp").html("Click to display Gene Tracks as Transcripts. Note: in smaller regions this occurs automatically.")}),
$("input#forceTrxCBX"+c.levelNumber).button(),n=c.vis.append("span").style("float","right").style("margin-right","5px"),a=n.append("div").attr("class","defaultMouse").style("width","64px").attr("id","scrollSize"+c.levelNumber),a.append("span").attr("id","scrollIncr"+c.levelNumber).style("height","24px").style("display","inline-block").style("cursor","pointer").append("img").attr("class","mouseOpt ").attr("src","/web/images/icons/scroll_smaller.png").attr("pointer-events","all").on("click",function(){c.scrollSize-=
100;100>c.scrollSize&&(c.scrollSize=100);changeTrackHeight("Level"+c.levelNumber,c.scrollSize);gtag("event","",{event_category:"changeScrollHeight"})}).on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",function(){$("#mouseHelp").html("Decrease the vertical length of the scrollable browser image on the page.")}),a.append("span").attr("id","pan"+c.levelNumber).style("height","24px").style("display","inline-block").style("cursor",
"pointer").append("img").attr("class","mouseOpt pan").attr("src","/web/images/icons/scroll_larger.png").attr("pointer-events","all").on("click",function(){0<$("#ScrollLevel"+c.levelNumber).length&&"undefined"!==typeof $("#ScrollLevel"+c.levelNumber)[0]&&c.scrollSize<$("#ScrollLevel"+c.levelNumber)[0].scrollHeight&&(c.scrollSize+=100,changeTrackHeight("Level"+c.levelNumber,c.scrollSize))}).on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",
function(){$("#mouseHelp").html("Increase the vertical length of the scrollable browser image on the page.")}),n.append("span").attr("class","scrollBtn control").style("display","inline-block").attr("id","scrollImage"+c.levelNumber).style("cursor","pointer").append("img").attr("src","/web/images/icons/scroll.png").attr("pointer-events","all").attr("cursor","pointer").on("click",function(){"/web/images/icons/no_scroll.png"==d3.select(this).attr("src")?(d3.select(this).attr("src","/web/images/icons/scroll.png"),
d3.select("span#reset"+c.levelNumber).style("background","#989898"),$("#scrollSize"+c.levelNumber).show(),changeTrackHeight("Level"+c.levelNumber,c.scrollSize)):(d3.select(this).attr("src","/web/images/icons/no_scroll.png"),d3.select("span#reset"+c.levelNumber).style("background","#DCDCDC"),$("#scrollSize"+c.levelNumber).hide(),changeTrackHeight("Level"+c.levelNumber,0));gtag("event","",{event_category:"toggleImageScroll"})}).on("mouseover",function(){$("#mouseHelp").html("Click to toggle browser image scrolling on/off.  <b>Off</b> the image takes as much space as needed. <b>On</b> you can adjust the maximum length of the image.")}).on("mouseout",
function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}));c.topDiv=c.vis.append("div").attr("id","Level"+f).style("text-align","left");c.xScale=d3.scaleLinear().domain([r,u]).range([0,c.width]);n={};n.chr=chr;n.start=r;n.stop=u;history[c.levelNumber]||(history[c.levelNumber]=[]);history[c.levelNumber].push(n);c.xAxis=d3.axisTop(c.xScale).ticks(6).tickSize(8).tickPadding(10);c.scaleSVG=c.topDiv.append("svg:svg").attr("width",c.width).attr("height",
60).attr("pointer-events","all").attr("class","scale").on("mousedown",c.mdown).on("mouseup",mup).on("mouseover",function(){"dragzoom"!=c.defaultMouseFunct?$("#mouseHelp").html("<B>Zoom:</b> Click and Drag right to zoom in or left to zoom out. <B>OR</B> Hold the Alt/Option Key while clicking, then drag to select a specific area."):$("#mouseHelp").html("<B>Zoom:</b> Click and Drag to select an area to zoom in on it. <B>OR</B> Hold the Alt/Option Key while clicking and drag right to zoom in or left to zoom out.");
d3.event.altKey&&"dragzoom"!=c.defaultMouseFunct?c.changeScaleCursor("crosshair"):d3.event.altKey&&"dragzoom"==c.defaultMouseFunct&&c.changeScaleCursor("ew-resize")}).on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mousemove",function(){d3.event.altKey&&"dragzoom"!=c.defaultMouseFunct?c.changeScaleCursor("crosshair"):d3.event.altKey&&"dragzoom"==c.defaultMouseFunct?c.changeScaleCursor("ew-resize"):d3.event.altKey||
"dragzoom"!=c.defaultMouseFunct?d3.event.altKey||"dragzoom"==c.defaultMouseFunct||c.changeScaleCursor("ew-resize"):c.changeScaleCursor("crosshair")}).style("cursor","ew-resize");c.scaleSVG.append("text").text(b).attr("x",(c.width-2*c.margin)/2).attr("y",10).attr("class","axisLbl");c.scaleSVG.append("g").attr("class","x axis").attr("transform","translate(0,55)").attr("shape-rendering","crispEdges").call(c.xAxis);c.topLevel=c.topDiv.append("div").attr("id","ScrollLevel"+f).attr("class","scroll").style("max-height",
"350px").style("overflow","auto").style("width","100%").append("ul").attr("id","sortable"+f);c.getAddMenus();svgList[f]=c;$("#sortable"+f).sortable({appendTo:"parent",containment:"parent",stop:function(){}}).disableSelection();$(".draggable"+f).draggable({connectToSortable:"#sortable"+f,scroll:!0,revert:"invalid",axis:"y"});r=mmVer;"Rn"==organism&&(r=rnVer);d3.select("div#imageHeader").html("Organism: "+r+"&nbsp&nbsp&nbsp&nbsp"+siteVer);0<$("span#verSelect").length&&(r=d3.select("span#verSelect").append("select"),
c.allowSelectGenomeVer?(r.on("change",function(){displayWorking();!0===isLocalStorage()?localStorage.setItem(organism+"DefGenomeVer",$(this).val()):$.cookie(organism+"DefGenomeVer",$(this).val());changeGenome($(this).val(),c.currentView);setTimeout(function(){$("form#geneCentricForm").submit()},1500)}),"Rn"===organism?(u=r.append("option").attr("value","rn6").html("rn6"),"rn6"===genomeVer&&u.attr("selected","selected"),r=r.append("option").attr("value","rn5").html("rn5"),"rn5"===genomeVer&&r.attr("selected",
"selected")):"Mm"===organism&&(r=r.append("option").attr("value","mm10").html("mm10"),"mm10"===genomeVer&&r.attr("selected","selected"))):r.append("option").attr("value",genomeVer).html(genomeVer));c.addTrack("genomeSeq",3,"both",0);c.selectSvg=selectionSVG("#Level"+c.levelNumber,c.width,c.levelNumber,c);return c}
function toolTipSVG(p,n,r,u,f,b,a){var d={isToolTip:1};d.folderName=regionfolderName;d.updateTimeoutHandle={};d.timeoutTrack=-1;d.forLevel=-1;d.strainSpecificCountColors=d3.scaleOrdinal(d3.schemeCategory20);d.get=function(c){return d[c]};d.getTrack=function(c){for(var h,e=0;e<d.trackList.length;e++)"undefined"!==typeof d.trackList[e]&&d.trackList[e].trackClass===c&&(h=d.trackList[e]);return h};d.addTrackErrorRemove=function(c,h){};d.addTrack=function(c,h,e,g){"Trx"==d.forceDrawAsValue&&-1==(new String(e)).indexOf("DrawTrx")&&
(e+="DrawTrx,");var l=d3.select("#Level"+d.levelNumber+c).nodes();if(0===l.length||null==l){l=d.topLevel.append("li").attr("class","draggable"+d.levelNumber).append("svg:svg").attr("width",d.get("width")).attr("height",30).attr("class","track").attr("id","Level"+d.levelNumber+c);var m=new String("Loading...");l.append("text").text(m).attr("x",d.width/2-m.length/2*7.5).attr("y",12).attr("id","trkLbl")}l="";-1<d.forLevel&&99==d.levelNumber&&"undefined"!==typeof svgList[d.forLevel]&&(l=svgList[d.forLevel].getTrack(c).generateTrackSettingString(),
e=l=l.substr(l.indexOf(",")+1));if("genomeSeq"===c){var q=SequenceTrack(d,c,"Reference Genomic Sequence",e);q.seqRegionSize=10;d.addTrackList(q)}else if(-1<c.indexOf("noncoding"))q=GeneTrack(d,g,c,"Non-Coding/Non-PolyA+ Transcripts",e),d.addTrackList(q);else if(-1<c.indexOf("coding"))q=GeneTrack(d,g,c,"Protein Coding/PolyA+ Transcripts",e),d.addTrackList(q);else if(0===c.indexOf("liverTotal")||"heartTotal"===c||0===c.indexOf("brainTotal")||"mergedTotal"===c)h="Liver Total RNA Transcripts","heartTotal"===
c?h="Heart Total RNA Transcripts":"brainTotal"===c?h="Brain Total RNA Transcripts":"mergedTotal"===c&&(h="Merged (Brain,Heart,Liver) Reconstructed"),q=GeneTrack(d,g,c,h,e),d.addTrackList(q);else if(-1<c.indexOf("smallnc"))q=GeneTrack(d,g,c,"Small RNA (<200 bp) Genes",e),d.addTrackList(q);else if(0===c.indexOf("refSeq"))99===d.levelNumber&&(e+="DrawTrx,"),q=RefSeqTrack(d,g,c,"Ref Seq Genes",e),q.density=99===d.levelNumber?2:h,d.addTrackList(q);else if(0===c.indexOf("snp"))q=SNPTrack(d,g,c,1,"4"),d.addTrackList(q);
else if("qtl"===c)q=QTLTrack(d,g,c,1),d.addTrackList(q);else if("trx"===c)g=getAllChildrenByName(getFirstChildByName(d.selectedData,"TranscriptList"),"Transcript"),q=TranscriptTrack(d,g,c,h),d.addTrackList(q);else if("probe"===c||"probeMouse"===c)99!==d.levelNumber&&(e=h+","+e),q=ProbeTrack(d,g,c,"Affy Exon 1.0 ST Probe Sets",e),d.addTrackList(q);else if(-1<c.indexOf("spliceJnct"))e="Brain ","liverspliceJnct"===c?e="Liver ":"heartspliceJnct"===c&&(e="Heart "),q=SpliceJunctionTrack(d,g,c,e+"Splice Junctions",
3,""),100===d.levelNumber&&(q.density=h),d.addTrackList(q);else if("polyASite"===c)q=PolyATrack(d,g,c,"Predicted PolyA Sites",e),d.addTrackList(q);else if("helicos"===c||-1<c.indexOf("illuminaTotal")||-1<c.indexOf("illuminaSmall")||"illuminaPolyA"===c){d.updateTimeoutHandle[c]&&(d.updateTimeoutHandle[c]=-1);h=2;l=l.split(",");1<l.length&&(1===l[1]||2===l[1])&&(h=l[1]);"helicos"===c?q=HelicosTrack(d,g,c,h):"illuminaTotal"===c?q=IlluminaTotalTrack(d,g,c,h):"illuminaSmall"===c?q=IlluminaSmallTrack(d,
g,c,h):"illuminaPolyA"===c?q=IlluminaPolyATrack(d,g,c,h):"liverilluminaTotalPlus"===c?q=LiverIlluminaTotalPlusTrack(d,g,c,h):"liverilluminaTotalMinus"===c?q=LiverIlluminaTotalMinusTrack(d,g,c,h):"heartilluminaTotalPlus"===c?q=HeartIlluminaTotalPlusTrack(d,g,c,h):"heartilluminaTotalMinus"===c?q=HeartIlluminaTotalMinusTrack(d,g,c,h):"brainilluminaTotalPlus"===c?q=BrainIlluminaTotalPlusTrack(d,g,c,h):"brainilluminaTotalMinus"===c?q=BrainIlluminaTotalMinusTrack(d,g,c,h):"liverilluminaSmall"===c?q=LiverIlluminaSmallTrack(d,
g,c,h):"heartilluminaSmall"===c?q=HeartIlluminaSmallTrack(d,g,c,h):-1<c.indexOf("illuminaTotal")&&(q=StrainSpecificIlluminaTotalTrack(d,g,c,h,e));if(99===d.levelNumber){if(0!==d.updateTimeoutHandle[c]){clearTimeout(d.updateTimeoutHandle[c]);try{clearTimeout(d.timeoutTrack[c].fullDataTimeOutHandle)}catch(t){}d.updateTimeoutHandle[c]=0}d.updateTimeoutHandle[c]=setTimeout(function(){q.updateFullData(0,1);d.timeoutTrack[c]=q;d.updateTimeoutHandle[c]=0},300)}d.addTrackList(q)}else if(0===c.indexOf("repeatMask"))q=
RepeatMaskTrack(d,g,c,"Repeat Masker",1,e),d.addTrackList(q);else if(-1<c.indexOf("custom"))if(h=trackInfo[c],e="DataFile="+h.Location+","+e,"bed"===h.Type||"bb"===h.Type)g=[],q=CustomTranscriptTrack(d,g,c,h.Name,3,e),d.addTrackList(q);else{if("bg"===h.Type||"bw"===h.Type)g=[],q=CustomCountTrack(d,g,c,3,e),d.addTrackList(q)}else 0<=c.indexOf("cirRNA")&&(h=trackInfo[c],g=[],q=CircRNATrack(d,g,c,h.Name,3,e),d.addTrackList(q));$(".sortable"+d.levelNumber).sortable("refresh")};d.addTrackList=function(c){null!=
c&&(d.trackList[d.trackCount]=c,d.trackCount++,setTimeout(function(){DisplayRegionReport()},300))};d.changeTrackHeight=function(c,h){0<h?d3.select("#"+c+"Scroll").style("max-height",h+"px"):d3.select("#"+c+"Scroll").style("max-height","none")};d.removeAllTracks=function(){for(var c=0;c<d.trackList.length;c++)"undefined"!==typeof d.trackList[c]&&"genomeSeq"!==d.trackList[c].trackClass&&d3.select("#Level"+d.levelNumber+d.trackList[c].trackClass).remove();d.trackList=[];setTimeout(function(){DisplayRegionReport()},
300)};d.removeTrack=function(c){d3.select("#Level"+d.levelNumber+c).remove();for(var h=0;h<d.trackList.length;h++)"undefined"!==typeof d.trackList[h]&&d.trackList[h].trackClass==c&&(d.trackList.splice(h,1),d.trackCount--);setTimeout(function(){DisplayRegionReport()},300)};d.redrawTrack=function(c){for(var h=0;h<d.trackList.length;h++)"undefined"!==typeof d.trackList[h]&&d.trackList[h].trackClass==c&&d.trackList[h].redraw();setTimeout(function(){DisplayRegionReport()},300)};d.redraw=function(){for(var c=
0;c<d.trackList.length;c++)"undefined"!==typeof d.trackList[c]&&"undefined"!==typeof d.trackList[c].redraw&&d.trackList[c].redraw()};d.update=function(){for(var c=0;c<d.trackList.length;c++)"undefined"!==typeof d.trackList[c].update&&d.trackList[c].update();setTimeout(function(){DisplayRegionReport()},300)};d.updateData=function(){for(var c=0;c<d.trackList.length;c++)"undefined"!==typeof d.trackList[c]&&"undefined"!==typeof d.trackList[c].updateData&&d.trackList[c].updateData(0);d.updateFullData();
setTimeout(function(){DisplayRegionReport()},300)};d.updateFullData=function(){-1<(new String(d.folderName)).indexOf("img")&&(d.folderName="/"+chr+"/"+d.xScale.domain()[0]+"_"+d.xScale.domain()[1]);for(var c=0;c<d.trackList.length;c++)"undefined"!==typeof d.trackList[c]&&"undefined"!==typeof d.trackList[c].updateFullData&&d.trackList[c].updateFullData(0,1)};d.setLoading=function(){for(var c=0;c<d.trackList.length;c++)"undefined"===typeof d.trackList[c]||"undefined"===typeof d.trackList[c].updateData&&
"undefined"===typeof d.trackList[c].updateFullData||d.trackList[c].showLoading()};d.clearSelection=function(){for(var c=0;c<d.trackList.length;c++)"undefined"!==typeof d.trackList[c]&&"undefined"!==typeof d.trackList[c].clearSelection&&d.trackList[c].clearSelection()};d.mdown=function(){if(0==processAjax){d.prevMinCoord=d.xScale.domain()[0];d.prevMaxCoord=d.xScale.domain()[1];var c=d3.mouse(d.vis.node());d.downx=d.xScale.invert(c[0]);d.downscalex=d.xScale}};d.forceDrawAs=function(c){for(var h=0;h<
d.trackList.length;h++)"undefined"!==typeof d.trackList[h]&&"undefined"!==typeof d.trackList[h].drawAs&&(d.trackList[h].drawAs=c,d.trackList[h].draw(d.trackList[h].data));d.forceDrawAsValue=c};d.generateSettingsString=function(){ret="";for(var c=0;c<d.trackList.length;c++)"undefined"!==typeof d.trackList[c]&&"undefined"!==typeof d.trackList[c].generateTrackSettingString&&(ret+=d.trackList[c].generateTrackSettingString());return ret};d.setCurrentViewModified=function(){"undefined"!==typeof d.currentView&&
(d.currentView.modified=1,$("span#viewModifiedCtl"+d.levelNumber).show())};d.clearCurrentView=function(){d.currentView.modified=0;$("span#viewModifiedCtl"+d.levelNumber).hide()};d.type=a;d.div=p;d.margin=0;d.halfWindowWidth=$(window).width()/2;d.mh=400;d.downx=Math.NaN;d.downscalex;d.downPanx=Math.NaN;d.xMax=29E7;d.xMin=1;d.prevMinCoord=r;d.prevMaxCoord=u;d.dataMinCoord=r;d.dataMaxCoord=u;d.y=0;d.xScale=null;d.xAxis=null;d.vis=null;d.level=null;d.svg=null;d.txType=null;d.txList=null;d.tt=null;d.trackList=
[];d.trackCount=0;d.levelNumber=f;d.selectedData=null;d.txType=null;d.width=n;d.mw=d.width-d.margin;d.vis=d3.select(p);d.topDiv=d.vis.append("div").attr("id","Level"+f).style("text-align","left");d.xScale=d3.scaleLinear().domain([r,u]).range([0,d.width]);d.xAxis=d3.axisTop(d.xScale).ticks(3).tickSize(8).tickPadding(10);d.scaleSVG=d.topDiv.append("svg:svg").attr("width",d.width).attr("height",60).attr("class","scale");d.scaleSVG.append("g").attr("class","x axis").attr("transform","translate(0,55)").attr("shape-rendering",
"crispEdges").call(d.xAxis);d3.select("#Level"+d.levelNumber).select(".x.axis").append("text").text(b).attr("x",(d.width-2*d.margin)/2).attr("y",-40).attr("class","axisLbl");d.topLevel=d.topDiv.append("div").attr("id","ScrollLevel"+d.levelNumber).style("width",d.width+18+"px").append("ul").attr("id","sortable"+d.levelNumber);return d}
function selectionSVG(p,n,r,u){var f={};f.imageWidth=n+25;f.levelNumber=r;f.parent=u;f.coordSelectStart=0;f.coordSelectStop=0;f.visible=!1;f.changeSelection=function(b,a){f.start=b;f.stop=a;f.setVis(!0);f.draw()};f.setVis=function(b){f.visible=b;f.visible?(f.svg.style("display","inline-block"),$("div#regionDiv").hide()):(f.svg.style("display","none"),$("div#regionDiv").show())};f.draw=function(){console.log("selectionSVG.draw"+f.trackClass);if(f.visible){f.xScale(f.stop);f.xScale(f.start);f.parent.updateTrackSelectedArea(f.start,
f.stop);var b=new String(numberWithCommas(Math.floor(f.start))),a=new String(numberWithCommas(Math.floor(f.stop)));f.svg.selectAll("line").remove();f.svg.selectAll("text").remove();f.svg.append("line").attr("x1",function(){var d=f.xScale(f.start);0>d&&(d=0);return d}).attr("x2",function(){var d=f.xScale(f.start);0>d&&(d=0);return d}).attr("y1",0).attr("y2",15).attr("stroke","#00992D").attr("stroke-width","1");f.svg.append("line").attr("x1",function(){return f.xScale(f.stop)}).attr("x2",function(){return f.xScale(f.stop)}).attr("y1",
0).attr("y2",15).attr("stroke","#00992D").attr("stroke-width","1");f.svg.append("line").attr("x1",function(){var d=f.xScale(f.start);0>d&&(d=0);return d}).attr("x2",0).attr("y1",15).attr("y2",60).attr("stroke","#00992D").attr("stroke-width","1");f.svg.append("line").attr("x1",function(){return f.xScale(f.stop)}).attr("x2",f.imageWidth).attr("y1",15).attr("y2",60).attr("stroke","#00992D").attr("stroke-width","1");f.svg.append("text").attr("x",f.xScale(f.start)-7.5*b.length-10).attr("y",15).text(b);
f.svg.append("text").attr("x",f.xScale(f.stop)+10).attr("y",15).text(a)}};f.redraw=function(){f.draw()};f.setup=function(){f.svg=d3.select(p).append("svg:svg").attr("width",f.imageWidth).attr("height",60).attr("id","selectionLevel"+f.levelNumber).style("display","none");f.xScale=f.parent.xScale};f.setup();return f}
function Track(p,n,r,u){var f={};f.selectionStart=p.selectionStart;f.selectionEnd=p.selectionEnd;f.ttSVGMinWidth=20;f.panDown=function(){if(!d3.event.shiftKey&&0===f.gsvg.overSettings&&0===overSelectable&&("dragzoom"!==f.gsvg.defaultMouseFunct&&d3.event.altKey||"dragzoom"===f.gsvg.defaultMouseFunct&&!d3.event.altKey)){var b=d3.mouse(f.gsvg.vis.node());f.gsvg.downZoomx=b[0];f.svg.append("rect").attr("class","zoomRect").attr("x",b[0]).attr("y",0).attr("height",f.svg.attr("height")).attr("width",1).attr("fill",
"#CECECE").attr("opacity",.3);f.scaleSVG.append("rect").attr("class","zoomRect").attr("x",b[0]).attr("y",0).attr("height",f.scaleSVG.attr("height")).attr("width",1).attr("fill","#CECECE").attr("opacity",.3);f.scaleSVG.append("text").attr("id","zoomTextStart").attr("x",f.gsvg.downZoomx).attr("y",15).text(numberWithCommas(Math.round(f.xScale.invert(f.gsvg.downZoomx))));f.scaleSVG.append("text").attr("id","zoomTextEnd").attr("x",f.gsvg.downZoomx).attr("y",50).text(numberWithCommas(Math.round(f.xScale.invert(f.gsvg.downZoomx))))}else!d3.event.shiftKey&&
0===f.gsvg.overSettings&&0===overSelectable&&("pan"===f.gsvg.defaultMouseFunct&&!d3.event.altKey||"pan"!==f.gsvg.defaultMouseFunct&&d3.event.altKey)&&0==processAjax&&(b=d3.mouse(f.gsvg.vis.node()),f.gsvg.downPanx=b[0],f.gsvg.downscalex=f.xScale)};f.zoomToFeature=function(b){var a=parseInt(b.getAttribute("stop"),10)-parseInt(b.getAttribute("start"),10);a*=.25;var d=parseInt(b.getAttribute("start"),10)-a;b=parseInt(b.getAttribute("stop"),10)+a;b<=f.gsvg.xMax&&1<=d&&(f.xScale.domain([d,b]),f.scaleSVG.select(".x.axis").call(f.xAxis),
f.gsvg.redraw(),0==f.gsvg.levelNumber||1==f.gsvg.levelNumber)&&(a={},a.chr=chr,a.start=d,a.stop=b,history[f.gsvg.levelNumber]||(history[f.gsvg.levelNumber]=[]),history[f.gsvg.levelNumber].push(a))};f.clearSelection=function(){f.selectionStart=-1;f.selectionEnd=-1;f.svg.selectAll("rect.selectedArea").remove();f.svg.selectAll(".selected").each(function(){f.svg.select(this).attr("class","").style("fill",f.color)})};f.setSelectedArea=function(b,a){f.selectionStart=b;f.selectionEnd=a;f.redrawSelectedArea()};
f.redrawSelectedArea=function(){d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll(".selectedArea").remove();if(-1<f.selectionStart&&-1<f.selectionEnd){var b=f.xScale(f.selectionStart),a=f.xScale(f.selectionEnd)-b;1>a&&(a=1);d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).append("rect").attr("class","selectedArea").attr("x",b).attr("y",0).attr("height",function(){var d=f.svg.attr("height");15>d&&(d=15);return d}).attr("width",a).attr("fill","#CECECE").attr("opacity",.3).attr("pointer-events",
"none")}};f.colorStroke=function(b){var a="black";3>f.xScale(b.getAttribute("stop"))-f.xScale(b.getAttribute("start"))&&(a=f.color(b));return a};f.calcY=function(b,a,d){b=3===f.density||"3"===f.density?f.calcYPack(b,a,d):2===f.density||"2"===f.density?f.calcYFull(d):f.calcYDense();f.trackYMax<b/15&&(f.trackYMax=b/15);return b};f.calcYPack=function(b,a,d){if(b>=f.xScale.domain()[0]&&b<=f.xScale.domain()[1]||a>=f.xScale.domain()[0]&&a<=f.xScale.domain()[1]||b<=f.xScale.domain()[0]&&a>=f.xScale.domain()[1]){b=
Math.round(f.xScale(b));0>b&&(b=0);a=Math.round(f.xScale(a));a>=f.gsvg.width&&(a=f.gsvg.width-1);d=b-f.xPadding;0>d&&(d=0);var c=a+f.xPadding;c>=f.gsvg.width&&(c=f.gsvg.width-1);for(var h=0,e=d;e<=c;e++)f.yMaxArr[e]>h&&(h=f.yMaxArr[e]);h++;var g=h;if(f.yArr.length<=h)for(f.yArr[g]=[],e=0;e<f.gsvg.width;e++)f.yArr[g][e]=0;e=h-f.scanBackYLines;1>e&&(e=1);g=0;for(var l=e;l<h&&0==g;l++){var m=0;for(e=d;e<=c&&0==m;e++)f.yArr[l][e]>m&&(m=1);0==m&&(h=l,g=1)}h>f.trackYMax&&(f.trackYMax=h);for(e=b;e<=a;e++)f.yMaxArr[e]<
h&&(f.yMaxArr[e]=h),f.yArr[h][e]=1;b=15*h}else b=15;return b};f.calcYDense=function(){return 15};f.calcYFull=function(b){return 15*(b+1)};f.positionTTLeft=function(b){b+=20;b>f.gsvg.halfWindowWidth&&(b-=490);return b+"px"};f.positionTTTop=function(b){b=window.pageYOffset+10;var a=window.innerHeight-1.8*$(".testToolTip").height();20<a&&(b+=a/2);return b+"px"};f.drawLegend=function(b){var a=new String(f.label),d=f.gsvg.width/2+a.length/2*6.5;500>f.gsvg.width&&(d=7*a.length);d3.select("#Level"+f.gsvg.levelNumber+
f.trackClass).selectAll(".legend").remove();for(var c=0;c<b.length;c++)f.svg.append("rect").attr("class","legend").attr("x",d).attr("y",0).attr("rx",3).attr("ry",3).attr("height",12).attr("width",16).attr("fill",b[c].color).attr("stroke",b[c].color),a=new String(b[c].label),f.svg.append("text").text(a).attr("class","legend").attr("x",d+18).attr("y",12),d=d+25+7*a.length};f.drawScaleLegend=function(b,a,d,c,h,e){var g=new String(f.label),l=f.gsvg.width/2+g.length/2*7.5+16;500>f.gsvg.width&&(l=7.5*g.length);
l+=e;d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll(".legend").remove();d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll("#def1").remove();g=f.svg.append("defs").attr("id","def1").append("linearGradient").attr("id","grad"+f.gsvg.levelNumber+f.trackClass);g.append("stop").attr("offset","0%").style("stop-color",c);g.append("stop").attr("offset","100%").style("stop-color",h);g=new String(b);b=7.6*g.length;f.svg.append("text").text(g).attr("class","legend").attr("x",l).attr("y",
12);f.svg.append("rect").attr("class","legend").attr("x",l+b+5).attr("y",0).attr("rx",3).attr("ry",3).attr("height",12).attr("width",75).attr("fill","url(#grad"+f.gsvg.levelNumber+f.trackClass+")");g=new String(a);f.svg.append("text").text(g).attr("class","legend").attr("x",l+b+80).attr("y",12);a=8*g.length+5;g=new String(d);f.svg.append("text").text(g).attr("class","legend").attr("x",l+b+80+a).attr("y",12)};f.showLoading=function(){0<d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll("g.loading")?
f.loading=d3.select(f.svg).selectAll("g.loading"):(f.loading=f.svg.append("g").attr("class","loading"),f.loading.append("rect").attr("x",0).attr("y",0).attr("height",f.svg.attr("height")).attr("width",f.gsvg.width).attr("fill","#CECECE").attr("opacity",.6),f.loading.append("text").text("Loading...").attr("x",f.gsvg.width/2-37.5).attr("y",f.svg.attr("height")/2))};f.hideLoading=function(){f.loading=d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll("g.loading");"undefined"!==typeof f.loading&&
f.loading.remove()};f.displayBreakDown=function(b){$(window).width();1E3<$(window).width()&&$(window).width();if("undefined"!==typeof f.counts&&0<f.counts.length){for(var a=1,d=0;d<f.counts.length&&1===a;d++)0<f.counts[d].value&&(a=0);if(0===a){var c=d3.arc().outerRadius(140).innerRadius(0);a=d3.pie().value(function(h){return h.value});b=d3.select(b).append("svg").attr("width",300).attr("height",300).append("g").attr("transform","translate(150,150)").selectAll(".arc").data(a(f.counts)).enter().append("g").attr("class",
"arc");b.append("path").attr("d",c).attr("fill",f.pieColor).on("mouseover",function(h){d3.select(".testToolTip").transition().duration(200).style("opacity",.95);d3.select(".testToolTip").html("Name: "+h.data.names+"<BR>Count: "+h.data.value).style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px");f.triggerTableFilter(h)}).on("mouseout",function(h){d3.select(".testToolTip").transition().delay(500).duration(200).style("opacity",0);f.clearTableFilter(h)});b.append("text").attr("transform",
function(h){return"translate("+c.centroid(h)+")"}).attr("dy",".35em").attr("fill","#FFFFFF").style("text-anchor","middle").text(function(h){var e=h.value;0==h.value&&(e="");return e})}}};f.updateLabel=function(b){f.label=b;b=new String(f.label);600<f.gsvg.width?d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).select("#trkLbl").attr("x",f.gsvg.width/2-b.length/2*7.5).text(b):d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).select("#trkLbl").attr("x",0).text(b);d3.select("#Level"+f.gsvg.levelNumber+
f.trackClass).select(".infoIcon").attr("transform","translate("+(f.gsvg.width-20)+",0)");d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).select(".settings").attr("transform","translate("+(f.gsvg.width-40)+",0)")};f.resize=function(){d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).attr("width",f.gsvg.width);f.updateLabel(f.label);"undefined"!==typeof f.redrawLegend&&f.redrawLegend();f.redraw()};f.triggerTableFilter=function(b){};f.clearTableFilter=function(b){};f.getDisplayID=function(b){return b.getAttribute("ID")};
f.setupToolTipSVG=function(b,a){var d=parseInt(b.getAttribute("start"),10),c=parseInt(b.getAttribute("stop"),10),h=Math.floor((c-d)*a);20>h&&(h=20);var e=d-h;h=c+h;1>e&&(e=1);"undefined"!==typeof f.ttSVGMinWidth&&h-e<f.ttSVGMinWidth&&(e=d-f.ttSVGMinWidth/2,h=c+f.ttSVGMinWidth/2);d=toolTipSVG("div#ttSVG",450,e,h,99,f.getDisplayID(b),"transcript");d.forLevel=f.gsvg.levelNumber;c=[];c.push(b);d.addTrack(f.trackClass,3,"",c);for(c=0;c<f.ttTrackList.length;c++){var g=f.gsvg.getTrackData(f.ttTrackList[c]),
l=[];if("undefined"!==typeof g&&0<g.length){for(var m=0,q=0;q<g.length;q++)if(e<=parseInt(g[q].getAttribute("start"),10)&&parseInt(g[q].getAttribute("start"),10)<=h||parseInt(g[q].getAttribute("start"),10)<=e&&parseInt(g[q].getAttribute("stop"),10)>=e)l[m]=g[q],m++;0<l.length&&d.addTrack(f.ttTrackList[c],3,"DrawTrx",l)}}};f.generateSettingsDiv=function(b){f.savePrevious();var a=trackInfo[f.trackClass];d3.select(b).select("table").select("tbody").html("");if("undefined"!==typeof a&&0<a.Controls.length&&
"null"!=a.Controls){var d=(new String(a.Controls)).split(",");b=d3.select(b).select("table").select("tbody");b.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+a.Name);for(a=0;a<d.length;a++)if("undefined"!==typeof d[a]&&""!=d[a]){var c=d[a].split(";"),h=b.append("tr").append("td"),e=c[0].substr(5);h.append("text").text(e+": ");e="";3<c.length&&0==c[3].indexOf("Default=")&&(e=c[3].substr(8));if(0==c[1].toLowerCase().indexOf("select")){var g=c[1].split(":");c=c[2].split("}");
var l="",m="";2<g.length&&(l=g[2]);3<g.length&&(m=g[3]);h=h.append("select").attr("id",f.trackClass+l+f.level+m).attr("name",g[1]);for(g=0;g<c.length;g++){var q=c[g].substr(1).split(":");if(2==q.length){var t=h.append("option").attr("value",q[1]).text(q[0]);"Dense"===l&&q[1]==f.density?t.attr("selected","selected"):"Version"===l&&q[1]==f.dataVer?t.attr("selected","selected"):q[1]==e&&t.attr("selected","selected")}}d3.select("select#"+f.trackClass+l+f.level+m).on("change",function(){f.updateSettingsFromUI();
f.redraw()})}else console.log("Undefined track settings:  "+d[a])}d=b.append("tr").append("td");d.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");f.gsvg.setCurrentViewModified();f.gsvg.removeTrack(f.trackClass);var v=svgList[f.gsvg.levelNumber].currentView.ViewID,y=viewMenu[f.gsvg.levelNumber].findTrackByClass(f.trackClass,v);y=viewMenu[f.gsvg.levelNumber].findTrackIndexWithViewID(y.TrackID,
v);viewMenu[f.gsvg.levelNumber].removeTrackWithIDIdx(y,v)});d.append("input").attr("type","button").attr("value","Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");f.density!=f.prevSetting.density&&f.gsvg.setCurrentViewModified()});d.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){f.revertPrevious();f.draw(f.data);$("#trackSettingDialog").fadeOut("fast")})}else a&&
(b=d3.select(b).select("table").select("tbody"),b.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+a.Name),b.append("tr").append("td").html("Sorry no settings for this track."),d=b.append("tr").append("td"),d.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");f.gsvg.setCurrentViewModified();f.gsvg.removeTrack(f.trackClass)}),d.append("input").attr("type",
"button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")}))};f.updateSettingsFromUI=function(){0<$("#"+f.trackClass+"Dense"+f.level+"Select").length&&(f.density=$("#"+f.trackClass+"Dense"+f.level+"Select").val())};f.savePrevious=function(){f.prevSetting={};f.prevSetting.density=f.density};f.revertPrevious=function(){f.density=f.prevSetting.density};f.updateSettings=function(b){};f.generateTrackSettingString=function(){return f.trackClass+
","+f.density+";"};f.gsvg=p;f.level=f.gsvg.levelNumber;f.data=n;f.label=u;f.density=3;f.loading;f.trackYMax=0;f.trackClass=r;f.topLevel=f.gsvg.get("topLevel");f.xScale=f.gsvg.get("xScale");f.scaleSVG=f.gsvg.get("scaleSVG");f.xAxis=f.gsvg.get("xAxis");f.yMaxArr=[];f.yArr=[];f.yArr[0]=[];for(p=0;p<f.gsvg.width;p++)f.yMaxArr[p]=0,f.yArr[0][p]=0;f.scanBackYLines=12;f.xPadding=2;3E6<f.gsvg.xScale.domain()[1]-f.gsvg.xScale.domain()[0]&&(f.xPadding=1);f.vis=d3.select("#Level"+f.gsvg.levelNumber+f.trackClass);
f.svg=d3.select("svg#Level"+f.gsvg.levelNumber+f.trackClass);f.svg.on("mousedown",f.panDown);f.updateLabel(f.label);return f}
function SequenceTrack(p,n,r,u){u=[];var f=Track(p,u,n,r);f.dispCutoff=300;f.aaDispCutoff=2900;f.seqRegionSize=4E3;f.strands="both";f.includeAA=1;f.labelBase=r;f.lastUpdate=0;f.seqRegionMin=0;f.seqRegionMax=0;f.color=function(b){};f.colorAA=function(b,a){d3.rgb("#FFFFFF");var d=0==b.pos%2?d3.rgb("#C3C3C3"):d3.rgb("#838383");"M"==b.aa&&(d=d3.rgb("#00FF00"));"*"==b.aa&&(d=d3.rgb("#FF0000"));return d};f.createCodon=function(){f.codons=[];f.codons.AAA="K";f.codons.AAT="N";f.codons.AAG="K";f.codons.AAC=
"N";f.codons.ATA="I";f.codons.ATT="I";f.codons.ATG="M";f.codons.ATC="I";f.codons.ACA="T";f.codons.ACT="T";f.codons.ACG="T";f.codons.ACC="T";f.codons.AGA="R";f.codons.AGT="S";f.codons.AGG="R";f.codons.AGC="S";f.codons.TAA="*";f.codons.TAT="Y";f.codons.TAG="*";f.codons.TAC="Y";f.codons.TTA="L";f.codons.TTT="F";f.codons.TTG="L";f.codons.TTC="F";f.codons.TCA="S";f.codons.TCT="S";f.codons.TCG="S";f.codons.TCC="S";f.codons.TGA="*";f.codons.TGT="C";f.codons.TGG="W";f.codons.TGC="C";f.codons.CAA="Q";f.codons.CAT=
"H";f.codons.CAG="Q";f.codons.CAC="H";f.codons.CTA="L";f.codons.CTT="L";f.codons.CTG="L";f.codons.CTC="L";f.codons.CCA="P";f.codons.CCT="P";f.codons.CCG="P";f.codons.CCC="P";f.codons.CGA="R";f.codons.CGT="R";f.codons.CGG="R";f.codons.CGC="R";f.codons.GAA="E";f.codons.GAT="D";f.codons.GAG="E";f.codons.GAC="D";f.codons.GTA="V";f.codons.GTT="V";f.codons.GTG="V";f.codons.GTC="V";f.codons.GCA="A";f.codons.GCT="A";f.codons.GCG="A";f.codons.GCC="A";f.codons.GGA="G";f.codons.GGT="G";f.codons.GGG="G";f.codons.GGC=
"G"};f.translate=function(b){b=b.toUpperCase();return f.codons[b]};f.translateRegion=function(b,a,d,c){var h=[],e=0,g=0;if(f.data){if(d>c){g=1;var l=d;d=c;c=l}for(l=d;l<=c;l+=3){var m=f.data.substring(l,l+3);1==g&&(m=f.reverseCompliment(m));h[e]=[];h[e].aa=f.translate(m);h[e].pos=a+(l-d);h[e].id=b+":"+l+":"+f.translate(m);e++}}return h};f.reverseCompliment=function(b){for(var a="",d=b.length-1;-1<d;d--)a+=f.complement(b.charAt(d));return a};f.complement=function(b){var a="N";"A"==b?a="T":"T"==b?a=
"A":"G"==b?a="C":"C"==b&&(a="G");return a};f.redraw=function(){f.redrawSelectedArea();var b=f.xScale.domain()[0],a=f.xScale.domain()[1];if(f.prevStrand!=f.strands||f.prevIncldAA!=f.includeAA)d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll("g.base").each(function(C){d3.select(this).remove()}),d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll("g.aa0").each(function(C){d3.select(this).remove()}),d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll("g.aa1").each(function(C){d3.select(this).remove()}),
d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll("g.aa2").each(function(C){d3.select(this).remove()}),d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll("g.aarev0").each(function(C){d3.select(this).remove()}),d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll("g.aarev1").each(function(C){d3.select(this).remove()}),d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll("g.aarev2").each(function(C){d3.select(this).remove()}),b<f.seqRegionMin||a>f.seqRegionMax?
f.updateData(0):f.draw(f.data);else if(b<f.seqRegionMin||a>f.seqRegionMax)f.updateData(0);else{var d=a-b,c="12px";200<d&&(c="10px");if(d<=f.aaDispCutoff&&1==f.includeAA||d<=f.dispCutoff){if(f.seqRegionMin<=b&&b<=f.seqRegionMax&&f.seqRegionMin<=a&&a<=f.seqRegionMax){var h=f.gsvg.width/d,e=h/2;a=b-f.seqRegionMin;var g=d+a,l=27;1==f.includeAA&&"-"!=f.strands&&(l+=30);if(d<f.dispCutoff){d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll("g.line").remove();for(var m=[],q=a;q<g;q++)m[q-a]=[],
m[q-a].base=f.data.charAt(q),m[q-a].id=q,m[q-a].pos=q-a;f.textSize(d);var t=f.yPosition(d);q=f.svg.selectAll(".base").data(m,keyID).attr("transform",function(C,F){return"translate("+(C.pos*h-e)+","+l+")"});m=q.enter().append("g").attr("class","base").attr("transform",function(C,F){return"translate("+(C.pos*h-e)+","+l+")"});m.each(function(C){d3.select(this).append("text").text(function(F){return"-"!=f.strands?F.base:f.complement(F.base)});"both"==f.strands&&d3.select(this).append("text").attr("class",
"comp").attr("y",t).text(function(F){return f.complement(F.base)})});q.exit().remove();q.selectAll("text").attr("font-size",function(C){return f.textSize(d)});q.selectAll("text.comp").attr("y",t)}else d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll("g.base").remove(),f.svg.append("g").attr("class","line").append("line").attr("stroke","#000000").attr("x1",0).attr("y1",l).attr("x2",f.gsvg.width).attr("y2",l);if(1==f.includeAA){var v=3*h,y=v/2-4,w=25;if("both"==f.strands||"+"==f.strands)for(q=
b%3,m=a-q,g=[],g[0]=f.translateRegion(0,b-q,m,m+d),g[1]=f.translateRegion(1,b-q-1,m-1,m-1+d),g[2]=f.translateRegion(2,b-q-2,m-2,m-2+d),w=25,q=0;3>q;q++){var A=f.svg.selectAll(".aa"+q).data(g[q],keyID).attr("transform",function(C,F){return"translate("+(f.xScale(C.pos)-h)+","+w+")"}).each(function(C){d3.select(this).select("rect").attr("width",v);d<f.dispCutoff?0==d3.select(this).select("text").size()?d3.select(this).append("text").attr("x",y).attr("font-size",c).text(function(F){return F.aa}):d3.select(this).select("text").attr("x",
y).attr("font-size",c):d3.select(this).select("text").remove()});m=A.enter().append("g").attr("class","aa"+q).attr("transform",function(C,F){return"translate("+(f.xScale(C.pos)-h)+","+w+")"});m.each(function(C){d3.select(this).append("rect").attr("y",-10).attr("height",10).attr("width",v).attr("stroke",f.colorAA).attr("fill",f.colorAA);d<f.dispCutoff&&d3.select(this).append("text").attr("x",y).attr("font-size",c).text(function(F){return F.aa})});A.exit().remove();w+=11}w="both"==f.strands?80:45;if("both"==
f.strands||"-"==f.strands)for(q=b%3,m=a-q,g=[],g[0]=f.translateRegion(0,b-q,m+d,m),g[1]=f.translateRegion(1,b-q-1,m-1+d,m-1),g[2]=f.translateRegion(2,b-q-2,m-2+d,m-2),q=0;3>q;q++)A=f.svg.selectAll(".aarev"+q).data(g[q],keyID).attr("transform",function(C,F){return"translate("+(f.xScale(C.pos)-h)+","+w+")"}).each(function(C){d3.select(this).select("rect").attr("width",v);d<f.dispCutoff?0==d3.select(this).select("text").size()?d3.select(this).append("text").attr("x",y).attr("font-size",c).text(function(F){return F.aa}):
d3.select(this).select("text").attr("x",y).attr("font-size",c):d3.select(this).select("text").remove()}),m=A.enter().append("g").attr("class","aarev"+q).attr("transform",function(C,F){return"translate("+f.xScale(C.pos)+","+w+")"}),m.each(function(C){d3.select(this).append("rect").attr("y",-10).attr("height",10).attr("width",v).attr("stroke",f.colorAA).attr("fill",f.colorAA);d<f.dispCutoff&&d3.select(this).append("text").attr("x",y).attr("font-size",c).text(function(F){return F.aa})}),A.exit().remove(),
w+=11;"both"==f.strands?f.svg.attr("height",125):f.svg.attr("height",75)}else"both"==f.strands?f.svg.attr("height",45):f.svg.attr("height",30)}else f.updateData(0);$("li.draggable"+f.gsvg.levelNumber+"#li"+f.trackClass).show()}else f.svg.attr("height",0),$("li.draggable"+f.gsvg.levelNumber+"#li"+f.trackClass).hide()}};f.draw=function(b){f.redrawSelectedArea();var a=f.xScale.domain()[0],d=f.xScale.domain()[1]-a,c="";1==f.includeAA&&(c=" and Amino Acids");"both"==f.strands?f.label=f.labelBase+c+" on +/- strands":
"+"==f.strands?f.label=f.labelBase+c+" on + strand":"-"==f.strands&&(f.label=f.labelBase+c+" on - strand");d<=f.aaDispCutoff&&1==f.includeAA||d<=f.dispCutoff||(f.label="");f.updateLabel(f.label);f.data=new String(b);var h="10px";200<d&&(h="8px");if(f.data&&d<=f.aaDispCutoff&&1==f.includeAA||d<=f.dispCutoff){c=a-f.seqRegionMin;var e=d+c,g=f.gsvg.width/d;f.svg.selectAll("text.dir").remove();"both"==f.strands?(f.svg.append("text").attr("class","dir").attr("x",5).attr("y",15).text("--\x3e"),f.svg.append("text").attr("class",
"dir").attr("x",5).attr("y",120).text("<--"),f.svg.append("text").attr("class","dir").attr("x",f.gsvg.width-60).attr("y",15).text("--\x3e"),f.svg.append("text").attr("class","dir").attr("x",f.gsvg.width-20).attr("y",120).text("<--")):"+"==f.strands?(f.svg.append("text").attr("class","dir").attr("x",5).attr("y",15).text("--\x3e"),f.svg.append("text").attr("class","dir").attr("x",f.gsvg.width-60).attr("y",15).text("--\x3e")):"-"==f.strands&&(f.svg.append("text").attr("class","dir").attr("x",5).attr("y",
15).text("<--"),f.svg.append("text").attr("class","dir").attr("x",f.gsvg.width-60).attr("y",15).text("<--"));if(d<f.dispCutoff&&1<b.length){for(var l=[],m=c;m<e;m++)l[m-c]=[],l[m-c].base=b.charAt(m),l[m-c].id=m,l[m-c].pos=m-c;m=f.textSize(d);var q=f.yPosition(d),t=27;1==f.includeAA&&"-"!=f.strands&&(t+=30);l=f.svg.selectAll(".base").data(l,keyID).attr("transform",function(A,C){return"translate("+A.pos*g+","+t+")"});b=l.enter().append("g").attr("class","base").attr("transform",function(A,C){return"translate("+
A.pos*g+","+t+")"});b.each(function(A){d3.select(this).append("text").text(function(C){return"-"!=f.strands?A.base:f.complement(A.base)});"both"==f.strands&&d3.select(this).append("text").attr("class","comp").attr("y",q).text(function(C){return f.complement(A.base)})});l.exit().remove();l.selectAll("text").attr("font-size",m)}else f.svg.append("g").attr("class","base").append("line").attr("stroke","#000000").attr("x1",0).attr("y1",57).attr("x2",f.gsvg.width).attr("y2",57);if(f.data&&1==f.includeAA){var v=
3*g,y=v/2-4,w=25;if("both"==f.strands||"+"==f.strands)for(m=a%3,b=c-m,l=[],l[0]=f.translateRegion(0,a-m,b,b+d),l[1]=f.translateRegion(1,a-m-2,b-2,b-2+d),l[2]=f.translateRegion(2,a-m-1,b-1,b-1+d),w=25,m=0;3>m;m++)e=f.svg.selectAll(".aa"+m).data(l[m],keyID).attr("transform",function(A,C){return"translate("+f.xScale(A.pos)+","+w+")"}).each(function(A){d3.select(this).select("rect").attr("width",v);d<f.dispCutoff?0==d3.select(this).select("text").size()?d3.select(this).append("text").attr("x",y).attr("font-size",
h).text(function(C){return A.aa}):d3.select(this).select("text").attr("x",y).attr("font-size",h):d3.select(this).select("text").remove()}),e.enter().append("g").attr("class","aa"+m).attr("transform",function(A,C){return"translate("+f.xScale(A.pos)+","+w+")"}).each(function(A){d3.select(this).append("rect").attr("y",-10).attr("height",10).attr("width",v).attr("stroke",f.colorAA(A)).attr("fill",f.colorAA(A));d<f.dispCutoff&&d3.select(this).append("text").attr("x",y).attr("font-size",h).text(function(){return A.aa})}),
e.exit().remove(),w+=11;w="both"==f.strands?80:45;if("both"==f.strands||"-"==f.strands)for(m=a%3,b=c-m,l=[],l[0]=f.translateRegion(0,a-m,b+d,b),l[1]=f.translateRegion(1,a-m-1,b-1+d,b-1),l[2]=f.translateRegion(2,a-m-2,b-2+d,b-2),m=0;3>m;m++)e=f.svg.selectAll(".aarev"+m).data(l[m],keyID).attr("transform",function(A,C){return"translate("+f.xScale(A.pos)+","+w+")"}),b=e.enter().append("g").attr("class","aarev"+m).attr("transform",function(A,C){return"translate("+f.xScale(A.pos)+","+w+")"}),b.each(function(A){d3.select(this).append("rect").attr("y",
-10).attr("height",10).attr("width",v).attr("stroke",f.colorAA(A)).attr("fill",f.colorAA(A));d<f.dispCutoff&&d3.select(this).append("text").attr("x",y).attr("font-size",h).text(function(C){return A.aa})}),e.exit().remove(),w+=11;"both"==f.strands?f.svg.attr("height",125):f.svg.attr("height",75)}else"both"==f.strands?f.svg.attr("height",45):f.svg.attr("height",30);f.prevStrand=f.strands;f.prevIncldAA=f.includeAA;$("li.draggable"+f.gsvg.levelNumber+"#li"+f.trackClass).show()}else f.svg.attr("height",
0),$("li.draggable"+f.gsvg.levelNumber+"#li"+f.trackClass).hide()};f.textSize=function(b){var a="9px";100>=b?a="11px":150>=b?a="8px":200>=b?a="6.8px":250>=b?a="5.8px":300>=b&&(a="4.8px");return a};f.yPosition=function(b){var a=12;100>=b?a=12:150>=b?a=10:200>=b?a=8:250>=b?a=6:300>=b&&(a=5);return a};f.updateData=function(b){var a=(new Date).getTime();if(25E3<a-f.lastUpdate||0<b)0===b&&(0===f.lastUpdate||25E3>a-f.lastUpdate)&&(f.tmpseqRegionMin=f.xScale.domain()[0]-f.seqRegionSize,f.tmpseqRegionMax=
f.xScale.domain()[1]+f.seqRegionSize,0>f.tmpseqRegionMin&&(f.tmpseqRegionMin=0)),f.xScale.domain()[1]-f.xScale.domain()[0]<f.aaDispCutoff&&(f.lastUpdate=a,f.svg&&30>f.svg.attr("height")&&f.svg.attr("height",30),0===b&&f.showLoading(),d3.text(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+f.gsvg.folderName+"/"+f.tmpseqRegionMin+"_"+f.tmpseqRegionMax+".seq",function(d,c){if(d){if(0===b){var h="/"+pathPrefix;pathPrefix||(h="");$.ajax({url:h+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,
data:{chromosome:chr,minCoord:f.tmpseqRegionMin,maxCoord:f.tmpseqRegionMax,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:f.trackClass,folder:f.gsvg.folderName},dataType:"json",success:function(e){gtag("event","generateTrackSequence",{event_category:"browser"})},error:function(e,g,l){}})}3>b?(h=1E4,1===b&&(h=15E3),setTimeout(function(){f.updateData(b+1)},h)):(f.seqRegionMin=0,f.seqRegionMax=0,f.hideLoading(),d3.select("#Level"+f.gsvg.levelNumber+
f.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+f.trackClass),d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).attr("height",15),f.gsvg.addTrackErrorRemove(f.svg,"#Level"+f.gsvg.levelNumber+f.trackClass),f.lastUpdate=0)}else f.seqRegionMin=f.tmpseqRegionMin,f.seqRegionMax=f.tmpseqRegionMax,f.hideLoading(),f.draw(c),f.lastUpdate=0,setTimeout(function(){DisplayRegionReport()},300)}))};f.updateSettingsFromUI=function(){0<$("#"+f.trackClass+f.level+"Select").length&&(f.strands=
$("#"+f.trackClass+f.level+"Select").val());0<$("#"+f.trackClass+"CBX"+f.level+"dispAA").length&&($("#"+f.trackClass+"CBX"+f.level+"dispAA").is(":checked")?f.includeAA=1:f.includeAA=0)};f.savePrevious=function(){f.prevSetting={};f.prevSetting.strands=f.strands;f.prevSetting.includeAA=f.includeAA};f.revertPrevious=function(){f.strands=f.prevSetting.strands;f.includeAA=f.prevSetting.includeAA};f.generateTrackSettingString=function(){return f.trackClass+","+f.strands+","+f.includeAA+";"};f.generateSettingsDiv=
function(b){var a=trackInfo[f.trackClass];f.savePrevious();d3.select(b).select("table").select("tbody").html("");if(0<a.Controls.length&&"null"!=a.Controls){var d=(new String(a.Controls)).split(",");b=d3.select(b).select("table").select("tbody");b.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+a.Name);for(a=0;a<d.length;a++)if(d[a]&&""!=d[a]){var c=d[a].split(";"),h=b.append("tr").append("td"),e=c[0].substr(5);3<c.length&&0===c[3].indexOf("Default=")&&c[3].substr(8);
if(0===c[1].toLowerCase().indexOf("select")){h.append("text").text(e+": ");e=c[1].split(":");c=c[2].split("}");for(var g=f.trackClass+f.level+"Select",l=h.append("select").attr("id",g).attr("name",e[1]),m=0;m<c.length;m++){var q=c[m].substr(1).split(":");2==q.length&&(h=l.append("option").attr("value",q[1]).text(q[0]),q[1]==f.strands&&h.attr("selected","selected"))}d3.select("select#"+g).on("change",function(){f.updateSettingsFromUI();f.redraw()})}else if(0===c[1].toLowerCase().indexOf("cbx"))for(h.append("text").text(e),
e=c[1].split(":"),c=c[2].split("}"),m=0;m<c.length;m++)if(q=c[m].substr(1).split(":"),2===q.length){g=h.append("div").style("display","inline-block");var t="",v="";2<e.length&&(v=e[2]);3<e.length&&(t=e[3]);l=g.append("input").attr("type","checkbox").attr("id",f.trackClass+v+"CBX"+f.level+t).attr("name",e[1]).style("margin-left","5px");g.append("text").text(q[0]);1==f.includeAA?$("#"+f.trackClass+v+"CBX"+f.level+t).prop("checked",!0):$("#"+f.trackClass+v+"CBX"+f.level+t).prop("checked",!1);d3.select("input#"+
f.trackClass+v+"CBX"+f.level+t).on("change",function(){f.updateSettingsFromUI();f.redraw()})}}d=b.append("tr").append("td");d.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");f.gsvg.removeTrack(f.trackClass);f.gsvg.setCurrentViewModified();var y=svgList[f.gsvg.levelNumber].currentView.ViewID,w=viewMenu[f.gsvg.levelNumber].findTrackByClass(f.trackClass,y);w=viewMenu[f.gsvg.levelNumber].findTrackIndexWithViewID(w.TrackID,
y);viewMenu[f.gsvg.levelNumber].removeTrackWithIDIdx(w,y)});d.append("input").attr("type","button").attr("value","Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");f.strands==f.prevSetting.strands&&f.includeAA==f.prevSetting.includeAA||f.gsvg.setCurrentViewModified()});d.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){f.revertPrevious();f.draw(f.data);
$("#trackSettingDialog").fadeOut("fast")})}else b=d3.select(b).select("table").select("tbody"),b.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+a.Name),b.append("tr").append("td").html("Sorry no settings for this track."),d=b.append("tr").append("td"),d.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")}),d.append("input").attr("type","button").attr("value",
"Cancel").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")})};f.createCodon();f.updateData(0);f.draw(u);return f}
function GeneTrack(p,n,r,u,f){var b=Track(p,n,r,u);b.counts=[{value:0,names:"Ensembl"},{value:0,names:"Brain RNA-Seq"}];p=new String(f);b.drawAs="Gene";b.trxCutoff=1E5;p=new String(f);b.xScale.domain();b.xScale.domain();-1<p.indexOf("DrawTrx")&&(b.drawAs="Trx");b.density=3;b.dataVer=0;b.reqDataVer=0;b.ttTrackList=[];-1===b.trackClass.indexOf("smallnc")?(b.ttTrackList.push("ensemblcoding"),b.ttTrackList.push("braincoding"),b.ttTrackList.push("brainTotal"),b.ttTrackList.push("liverTotal"),b.ttTrackList.push("heartTotal"),
b.ttTrackList.push("mergedTotal"),b.ttTrackList.push("refSeq"),b.ttTrackList.push("ensemblnoncoding"),b.ttTrackList.push("brainnoncoding")):(b.ttTrackList.push("ensemblsmallnc"),b.ttTrackList.push("brainsmallnc"),b.ttTrackList.push("liversmallnc"),b.ttTrackList.push("heartsmallnc"),b.ttTrackList.push("refSeq"));b.ttTrackList.push("repeatMask");b.ttTrackList.push("snpSHRH");b.ttTrackList.push("snpBNLX");b.ttTrackList.push("snpF344");b.ttTrackList.push("snpSHRJ");"braincoding"===r?(b.ttTrackList.push("spliceJnct"),
b.ttTrackList.push("illuminaPolyA")):0===r.indexOf("liverTotal")?(b.ttTrackList.push("liverspliceJnct"),b.ttTrackList.push("liverilluminaTotalPlus"),b.ttTrackList.push("liverilluminaTotalMinus")):"heartTotal"===r?(b.ttTrackList.push("heartspliceJnct"),b.ttTrackList.push("heartilluminaTotalPlus"),b.ttTrackList.push("heartilluminaTotalMinus")):0===r.indexOf("brainTotal")?(b.ttTrackList.push("brainspliceJnct"),b.ttTrackList.push("brainilluminaTotalPlus"),b.ttTrackList.push("brainilluminaTotalMinus")):
"brainsmallnc"===r?b.ttTrackList.push("illuminaSmall"):"heartsmallnc"===r?b.ttTrackList.push("heartilluminaSmall"):"liversmallnc"===r&&b.ttTrackList.push("liverilluminaSmall");b.pieColorPalette=d3.scaleOrdinal(d3.schemeCategory20);b.cleanID=function(a){return a=a.replace(/\./g,"_")};b.color=function(a){var d="#000000";"ensemblcoding"===b.trackClass?d="#DFC184":"braincoding"===b.trackClass?(d="#7EB5D6",null!==a.getAttribute("strain")&&"undefined"!==typeof a.getAttribute("strain")&&"All"!==a.getAttribute("strain")&&
(d=b.strainSpecColor(d,a))):"ensemblnoncoding"===b.trackClass?d="#B58AA5":"brainnoncoding"===b.trackClass?(d="#CECFCE",null!==a.getAttribute("strain")&&"undefined"!==typeof a.getAttribute("strain")&&"BNLX"===a.getAttribute("strain").toUpperCase()?d="#3E75FF":null===a.getAttribute("strain")||"undefined"===typeof a.getAttribute("strain")||"SHR"!==a.getAttribute("strain").toUpperCase()&&"SHRH"!==a.getAttribute("strain").toUpperCase()||(d="#FE7596")):"ensemblsmallnc"===b.trackClass?d="#FFCC00":"brainsmallnc"===
b.trackClass?(d="#3E7596",null!==a.getAttribute("strain")&&"undefined"!==typeof a.getAttribute("strain")&&"All"!==a.getAttribute("strain")&&(d=b.strainSpecColor(d,a))):0===b.trackClass.indexOf("liverTotal")?(d="#bbbedd",0<b.trackClass.indexOf("_F344Stm")?d="#abaefd":0<b.trackClass.indexOf("_LEStm")&&(d="#dbaecd"),null!==a.getAttribute("strain")&&"undefined"!==typeof a.getAttribute("strain")&&"All"!==a.getAttribute("strain")&&(d=b.strainSpecColor(d,a))):"heartTotal"===b.trackClass?(d="#DC7252",null!==
a.getAttribute("strain")&&"undefined"!==typeof a.getAttribute("strain")&&"All"!==a.getAttribute("strain")&&(d=b.strainSpecColor(d,a))):0===b.trackClass.indexOf("brainTotal")?(d="#7EB5D6",0<b.trackClass.indexOf("_F344Stm")?d="#6EA5F6":0<b.trackClass.indexOf("_LEStm")&&(d="#9EA5C6"),null!==a.getAttribute("strain")&&"undefined"!==typeof a.getAttribute("strain")&&"All"!==a.getAttribute("strain")&&(d=b.strainSpecColor(d,a))):"liversmallnc"===b.trackClass?(d="#7b7e9d",null!==a.getAttribute("strain")&&"undefined"!==
typeof a.getAttribute("strain")&&"All"!==a.getAttribute("strain")&&(d=b.strainSpecColor(d,a))):"heartsmallnc"===b.trackClass?(d="#9C3212",null!==a.getAttribute("strain")&&"undefined"!==typeof a.getAttribute("strain")&&"All"!==a.getAttribute("strain")&&(d=b.strainSpecColor(d,a))):"mergedTotal"===b.trackClass&&(d="#9F4F92");return d=d3.rgb(d)};b.strainSpecColor=function(a,d){var c=parseInt(a.substr(1,2),16),h=parseInt(a.substr(3,2),16),e=parseInt(a.substr(5),16);"BNLX"===d.getAttribute("strain").toUpperCase()?
(e+=64,c-=32,h-=32):"SHR"===d.getAttribute("strain").toUpperCase()||"SHRH"===d.getAttribute("strain").toUpperCase()?(c+=64,e-=32,h-=32):"F344_ST"===d.getAttribute("strain").toUpperCase()?(e+=32,c-=16,h-=16):"LE_ST"===d.getAttribute("strain").toUpperCase()&&(c+=32,e-=16,h-=16);255<c&&(c=255);255<h&&(h=255);255<e&&(e=255);return"#"+c.toString(16)+h.toString(16)+e.toString(16)};b.pieStrainSpecColor=function(a,d){var c=parseInt(a.substr(1,2),16),h=parseInt(a.substr(3,2),16),e=parseInt(a.substr(5),16);
if("BNLX"===d.toUpperCase())e+=64,c-=32,h-=32;else if("SHR"===d.toUpperCase()||"SHRH"===d.toUpperCase())c+=64,e-=32,h-=32;255<c&&(c=255);255<h&&(h=255);255<e&&(e=255);return a="#"+c.toString(16)+h.toString(16)+e.toString(16)};b.pieColor=function(a,d){var c="#000000";"ensemblcoding"===b.trackClass?c="#DFC184":"braincoding"===b.trackClass?c=b.pieStrainSpecColor("#7EB5D6",a.data.names):"ensemblnoncoding"===b.trackClass?c="#B58AA5":"brainnoncoding"===b.trackClass?(c="#CECFCE",null!==a.data.names&&"undefined"!==
typeof a.data.names&&"BNLX"===a.data.names.toUpperCase()?c="#3E75FF":null===a.data.names||"undefined"===typeof a.data.names||"SHR"!==a.data.names.toUpperCase()&&"SHRH"!==a.data.names.toUpperCase()||(c="#FE7596")):"ensemblsmallnc"===b.trackClass?c=b.pieColorPalette(a.data.names):"brainsmallnc"===b.trackClass?c=b.pieStrainSpecColor("#99CC99",a.data.names):0===b.trackClass.indexOf("liverTotal")?c=b.pieStrainSpecColor("#bbbedd",a.data.names):"heartTotal"===b.trackClass?c=b.pieStrainSpecColor("#DC7252",
a.data.names):0===b.trackClass.indexOf("brainTotal")?c=b.pieStrainSpecColor("#7EB5D6",a.data.names):"liversmallnc"===b.trackClass?c=b.pieStrainSpecColor("#8b8ead",a.data.names):"heartsmallnc"===b.trackClass?c=b.pieStrainSpecColor("#BC5232",a.data.names):"mergedTotal"===b.trackClass&&(c="#9F4F92");return c=d3.rgb(c)};b.getDisplayID=function(a){-1<b.trackClass.indexOf("smallnc")||-1<a.indexOf("_")&&(a=a.substr(a.indexOf("_")+1));return a};b.createToolTip=function(a){var d="";if(-1<b.trackClass.indexOf("smallnc")){d=
"Known - "+a.getAttribute("biotype");var c=".";1==a.getAttribute("strand")?c="+":-1==a.getAttribute("strand")&&(c="-");if(0===(new String(a.getAttribute("ID"))).indexOf("P")){var h=getAllChildrenByName(getFirstChildByName(a,"TranscriptList"),"Transcript");getAllChildrenByName(getFirstChildByName(a,"StrainQuantList"),"Strains")[1].getAttribute("strain");d=h[0].getAttribute("category")+" - "+h[0].getAttribute("source")}h='<BR><div id="ttSVG" style="background:#FFFFFF;"></div>ID: '+a.getAttribute("ID");
-1===b.trackClass.indexOf("ensembl")&&(h=h+"<BR>PhenoGen ID: "+a.getAttribute("intGeneID"));h=h+"<BR>Length: "+(a.getAttribute("stop")-a.getAttribute("start"))+"<BR>Type:"+d+"<BR>Location: "+a.getAttribute("chromosome")+":"+numberWithCommas(a.getAttribute("start"))+"-"+numberWithCommas(a.getAttribute("stop"))+"<BR>Strand: "+c+"<BR>"}else{var e=a.getAttribute("ID");e=b.getDisplayID(e);var g="";a.getAttribute("geneSymbol")?g=a.getAttribute("geneSymbol"):a.parent&&a.parent.getAttribute("geneSymbol")&&
(g=a.parent.getAttribute("geneSymbol"));c=".";1==a.getAttribute("strand")?c="+":-1==a.getAttribute("strand")&&(c="-");if(a.parent){h=getAllChildrenByName(getFirstChildByName(a.parent,"TranscriptList"),"Transcript");for(var l=0;l<h.length;l++){var m=new String(h[l].getAttribute("ID"));e!=m&&(-1<(new String(h[l].getAttribute("ID"))).indexOf("ENS")?d+="<B>"+m+"</B>":(d+="<B>"+m+"</B>",-1==(new String(h[l].getAttribute("ID"))).indexOf("ENS")&&(m=getFirstChildByName(getFirstChildByName(h[l],"annotationList"),
"annotation"),null!=m&&(d+=" - "+m.getAttribute("reason")))),d+="<br>");if(""==g){m=getAllChildrenByName(getFirstChildByName(h[l],"annotationList"),"annotation");for(var q=0;q<m.length&&""==g;q++)"AKA"==m[q].getAttribute("source")&&(g=m[q].getAttribute("annot_value"),g=(new String(g)).split(":"),g=0!=(new String(g[g.length-1])).indexOf("ENS")?g[g.length-1]:g[0])}}h='<BR><div id="ttSVG" style="background:#FFFFFF;overflow:"></div><BR>Transcript ID: '+e+"<BR>Location: "+a.getAttribute("chromosome")+
":"+numberWithCommas(a.getAttribute("start"))+"-"+numberWithCommas(a.getAttribute("stop"))+"<BR>Strand: "+c;h=h+"<BR><BR>Gene Symbol: "+g+"<BR>Gene ID: "+b.getDisplayID(a.parent.getAttribute("ID"))+"<BR><BR>Other Transcripts:<BR>"+d+"<BR>"}else{h=getAllChildrenByName(getFirstChildByName(a,"TranscriptList"),"Transcript");for(l=0;l<h.length;l++)if(m=new String(h[l].getAttribute("ID")),-1<(new String(h[l].getAttribute("ID"))).indexOf("ENS")?d+="<B>"+m+"</B>":(d+="<B>"+m+"</B>",-1===(new String(h[l].getAttribute("ID"))).indexOf("ENS")&&
(m=getFirstChildByName(getFirstChildByName(h[l],"annotationList"),"annotation"),null!=m&&(d+=" - "+m.getAttribute("reason")))),d+="<br>",0===g.length)for(m=getAllChildrenByName(getFirstChildByName(h[l],"annotationList"),"annotation"),q=0;q<m.length&&0===g.length;q++)"AKA"===m[q].getAttribute("source")&&(g=m[q].getAttribute("annot_value"),g=(new String(g)).split(":"),g=0!==(new String(g[g.length-1])).indexOf("ENS")?g[g.length-1]:g[0]);h='<BR><div id="ttSVG" style="background:#FFFFFF;overflow:scroll;max-height:400px;"></div>Gene ID: '+
e+"<BR>Gene Symbol: "+g+"<BR>Location: "+a.getAttribute("chromosome")+":"+numberWithCommas(a.getAttribute("start"))+"-"+numberWithCommas(a.getAttribute("stop"))+"<BR>Strand: "+c+"<BR><BR>Transcripts:<BR>"+d+"<BR>"}"brainTotal"!==b.trackClass&&"liverTotal"!==b.trackClass||!(-1<a.getAttribute("ID").indexOf("PRN6T")||-1<a.getAttribute("ID").indexOf("PRN6G"))||(c="Gene",-1<a.getAttribute("ID").indexOf("PRN6T")&&(c="Transcript"),h=h+'<div>Heritability: <span id="ttsingleHerit"></span></div>'+c+' Expression:<BR><div style="text-align:center;">Median Estimated Counts Per Million</div><div id="ttChart"></div>',
d="Brain",e="Whole Brain","liverTotal"===b.trackClass&&(e=d="Liver"),tmpChart=chart({data:"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/"+d+"expr.json",selector:"#ttChart",allowResize:!1,type:"scatter",width:"400",height:"275",displayHerit:!1,displayControls:!1,title:c+" Expression",titlePrefix:e,filterID:a.getAttribute("ID")}))}return h};b.redraw=function(){b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(var a=0;a<b.gsvg.width;a++)b.yMaxArr[a]=0,b.yArr[0][a]=0;b.trackYMax=0;a=b.xScale.domain()[0];
a=b.xScale.domain()[1]-a;var d=0;if(b.reqDataVer!==b.dataVer)b.updateDataVersion(b.reqDataVer,0);else if("undefined"!==typeof b.prevSetting&&b.prevSetting.density!==b.density)b.draw(b.data);else if(a<b.trxCutoff&&"Gene"===b.drawnAs||a>=b.trxCutoff&&"Trx"===b.drawnAs&&"Trx"!==b.drawAs||"Gene"===b.drawnAs&&$("#forceTrxCBX"+b.gsvg.levelNumber).is(":checked"))b.draw(b.data);else if(a<b.trxCutoff&&"Trx"===b.drawnAs&&"Trx"!==b.drawAs&&(d=1),"Gene"===b.drawAs&&0===d||-1<b.trackClass.indexOf("smallnc"))b.svg&&
(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").attr("transform",function(c,h){return"translate("+b.xScale(c.getAttribute("start"))+","+b.calcY(parseInt(c.getAttribute("start"),10),parseInt(c.getAttribute("stop"),10),h)+")"}),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene rect").attr("width",function(c){var h=1;1<b.xScale(c.getAttribute("stop"))-b.xScale(c.getAttribute("start"))&&(h=b.xScale(c.getAttribute("stop"))-b.xScale(c.getAttribute("start")));
return h}).attr("stroke",b.colorStroke),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").each(function(c){var h=d3.select(this),e=parseInt(c.getAttribute("strand"),10);if(-1===e||1===e){var g=">";-1===e&&(g="<");e="";var l=h.select("rect").attr("width");if(8.3<=l&&15.8>=l)e=g;else for(;8.5<l;)e+=g,l-=8.5;h.select("text#strandTxt").text(e)}if(2===b.density){var m=c.getAttribute("ID");c.getAttribute("geneSymbol")&&0<c.getAttribute("geneSymbol").length&&(m=m+" ("+c.getAttribute("geneSymbol")+
")");0===h.select("text#lblTxt").size()?h.append("svg:text").attr("dx",function(){var q=b.xScale(c.getAttribute("start"));return q=q<$(window).width()/2?b.xScale(c.getAttribute("stop"))-b.xScale(c.getAttribute("start"))+5:-9*m.length}).attr("dy",10).attr("id","lblTxt").text(m):h.select("text#lblTxt").attr("dx",function(){var q=b.xScale(c.getAttribute("start"));return q=q<$(window).width()/2?b.xScale(c.getAttribute("stop"))-b.xScale(c.getAttribute("start"))+5:-9*m.length})}else h.select("text#lblTxt").remove()})),
1===b.density?b.svg.attr("height",30):2===b.density?b.svg.attr("height",15*(b.trackYMax+1)):3===b.density&&b.svg.attr("height",15*(b.trackYMax+1));else if(1===d||"Trx"===b.drawAs)b.svg.selectAll(".trx"+b.gsvg.levelNumber).attr("transform",function(c,h){return"translate(0,"+b.calcY(parseInt(c.getAttribute("start"),10),parseInt(c.getAttribute("stop"),10),h)+")"}).each(function(c,h){var e=parseInt(c.getAttribute("start"),10),g=parseInt(c.getAttribute("stop"),10);c.getAttribute("cdsStart")&&c.getAttribute("cdsStop")&&
(e=parseInt(c.getAttribute("cdsStart"),10),g=parseInt(c.getAttribute("cdsStop"),10));exList=getAllChildrenByName(getFirstChildByName(c,"exonList"),"exon");var l="";1===b.gsvg.levelNumber?l="tx":99===b.gsvg.levelNumber&&(l="ttTx");for(var m=0;m<exList.length;m++){var q=exList[m].getAttribute("start"),t=exList[m].getAttribute("stop");if(q<e&&e<t||t>g&&g>q){var v=q,y=e;t>g?(v=g,y=t,t=g):q=e;d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g#"+l+b.cleanID(c.getAttribute("ID"))+b.gsvg.levelNumber+
" rect#ExNC"+exList[m].getAttribute("ID")).attr("x",function(B){return b.xScale(v)}).attr("width",function(B){return b.xScale(y)-b.xScale(v)})}d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g#"+l+b.cleanID(c.getAttribute("ID"))+b.gsvg.levelNumber+" rect#Ex"+exList[m].getAttribute("ID")).attr("x",function(B){return b.xScale(q)}).attr("width",function(B){return b.xScale(t)-b.xScale(q)});if(0<m){var w=">";"-1"==c.getAttribute("strand")&&(w="<");var A=w,C=b.xScale(exList[m-1].getAttribute("stop")),
F=b.xScale(exList[m].getAttribute("start")),E=F-C,D=0;if(7>E||"0"==c.getAttribute("strand")||"."==c.getAttribute("strand"))A="";else for(E-=7;8<E;)0===D?(A+=" ",D=1):(A+=w,D=0),E-=7;d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g.trx"+b.gsvg.levelNumber+"#"+l+b.cleanID(c.getAttribute("ID"))+b.gsvg.levelNumber+" line#Int"+exList[m-1].getAttribute("ID")+"_"+exList[m].getAttribute("ID")).attr("x1",C).attr("x2",F);d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g.trx"+b.gsvg.levelNumber+"#"+
l+b.cleanID(c.getAttribute("ID"))+b.gsvg.levelNumber+" #IntTxt"+exList[m-1].getAttribute("ID")+"_"+exList[m].getAttribute("ID")).attr("dx",C+1).text(A)}}if(2===b.density){var z=c.getAttribute("ID");c.getAttribute("geneSymbol")&&0<c.getAttribute("geneSymbol").length&&(z=z+" ("+c.getAttribute("geneSymbol")+")");0===d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g.trx"+b.gsvg.levelNumber+"#"+l+b.cleanID(c.getAttribute("ID"))+b.gsvg.levelNumber+" text#lblTxt").size()?d3.select("#Level"+b.gsvg.levelNumber+
b.trackClass+" g.trx"+b.gsvg.levelNumber+"#"+l+b.cleanID(c.getAttribute("ID"))+b.gsvg.levelNumber).append("svg:text").attr("dx",function(){var B=b.xScale(c.parent.getAttribute("start"));return B=B<$(window).width()/2?b.xScale(c.parent.getAttribute("stop"))-b.xScale(c.parent.getAttribute("start"))+5:-9*z.length}).attr("dy",10).attr("id","lblTxt").text(z):d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g.trx"+b.gsvg.levelNumber+"#"+l+b.cleanID(c.getAttribute("ID"))+b.gsvg.levelNumber+" text#lblTxt").attr("dx",
function(){var B=b.xScale(c.getAttribute("start"));return B=B<$(window).width()/2?b.xScale(c.getAttribute("stop"))-b.xScale(c.getAttribute("start"))+5:-9*z.length})}else d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g.trx"+b.gsvg.levelNumber+"#"+l+b.cleanID(c.getAttribute("ID"))+b.gsvg.levelNumber+" text#lblTxt").remove()}),1===b.density?b.svg.attr("height",30):2===b.density?b.svg.attr("height",15*(b.trackYMax+1)):3===b.density&&b.svg.attr("height",15*(b.trackYMax+1));b.redrawSelectedArea()};
b.setSelected=function(a){if(a)if(0<d3.selectAll("g.gene").size()){if(d3.selectAll("rect.selected").each(function(){d3.select(this).attr("class","").style("fill",b.color)}),a=d3.select("g.gene rect#"+a))a.attr("class","selected").style("fill","green"),b.setupDetailedView(a.data()[0]),selectGene=""}else 0<d3.selectAll("g.trx"+b.gsvg.levelNumber).size()&&(a=(new String(a)).replace(".","_"),b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("line").style("stroke",b.color),b.svg.selectAll("g.trx"+
b.gsvg.levelNumber+".selected").selectAll("rect").style("fill",b.color),b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("text").style("opacity","0.6").style("fill",b.color),b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").each(function(){var d=new String($(this).attr("class"));d=d.replace(" selected","");$(this).attr("class",d)}),b.svg.selectAll("g.gene"+a).each(function(){var d=$(this).attr("class")+" selected";$(this).attr("class",d)}),b.svg.selectAll("g.gene"+a).selectAll("line").style("stroke",
"green"),b.svg.selectAll("g.gene"+a).selectAll("rect").style("fill","green"),b.svg.selectAll("g.gene"+a).selectAll("text").style("opacity","0.3").style("fill","green"),b.svg.selectAll("g.gene"+a)&&((a=b.svg.selectAll("g.gene"+a).data())&&0<a.length?b.setupDetailedView(a[0].parent):(console.log("tmp[0]"),console.log(a))),selectGene="")};b.clearSelection=function(){b.selectionStart=-1;b.selectionEnd=-1;b.svg.selectAll("rect.selectedArea").remove();0<b.svg.selectAll("g.gene").size()?b.svg.selectAll("rect.selected").each(function(a){d3.select(this).attr("class",
"").style("fill",b.color)}):0<b.svg.selectAll("g.trx"+b.gsvg.levelNumber).size()&&(b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("line").style("stroke",b.color),b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("rect").style("fill",b.color),b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("text").style("opacity","0.6").style("fill",b.color),b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").each(function(){var a=new String($(this).attr("class"));
a=a.replace(" selected","");$(this).attr("class",a)}))};b.setupDetailedView=function(a){if(a){b.gsvg.clearSelection();jQuery.Event("keyup").which=32;var d=b.gsvg.levelNumber+1;$("div#collapsableReport").is(":hidden")||($("div#collapsableReport").hide(),$("span[name='collapsableReport']").removeClass("less"));$("div#selectedDetailHeader").is(":hidden")&&$("div#selectedDetailHeader").show();$("div#selectedDetail").is(":hidden")&&$("div#selectedDetail").show();var c="none";0===b.trackClass.indexOf("liverTotal")?
c=b.trackClass:"heartTotal"===b.trackClass?c="heartTotal":0===b.trackClass.indexOf("brainTotal")?c=b.trackClass:"mergedTotal"===b.trackClass?c="mergedTotal":"protein_coding"===a.getAttribute("biotype")&&200<=a.getAttribute("stop")-a.getAttribute("start")?c="protein":"protein_coding"!==a.getAttribute("biotype")&&200<=a.getAttribute("stop")-a.getAttribute("start")?c="long":200>a.getAttribute("stop")-a.getAttribute("start")&&(c="small");var h=0,e=0;if("protein"===c||"long"===c||0===c.indexOf("liverTotal")||
"heartTotal"===c||0===c.indexOf("brainTotal")||"mergedTotal"===c||"small"===c&&"rn5"!==genomeVer||"small"===c&&-1<(new String(a.getAttribute("ID"))).indexOf("ENS")){console.log("totalType");h=a.getAttribute("ID");var g="";if(a.getAttribute("geneSymbol")&&0<a.getAttribute("geneSymbol").length)h=h+" ("+a.getAttribute("geneSymbol")+")";else{e=getAllChildrenByName(getFirstChildByName(a,"TranscriptList"),"Transcript");for(var l=0;l<e.length&&""===g;l++)if(""===g)for(var m=getAllChildrenByName(getFirstChildByName(e[l],
"annotationList"),"annotation"),q=0;q<m.length&&0===g.length;q++)if("AKA"===m[q].getAttribute("source")){var t=m[q].getAttribute("annot_value");t=(new String(t)).split(":");1<=t.length?(g=t[0],h=h+" ("+g+")"):2<=t.length&&(g=t[0],t=t[1],h=h+" ("+t+")")}}e=parseInt(a.getAttribute("start"),10);m=parseInt(a.getAttribute("stop"),10);a.getAttribute("extStart")&&a.getAttribute("extStop")&&(e=parseInt(a.getAttribute("extStart"),10),m=parseInt(a.getAttribute("extStop"),10));svgViewIDList[d]||(svgViewIDList[d]=
b.gsvg.currentView?b.gsvg.currentView.ViewID:defaultView);l=GenomeSVG("div#selectedImage",b.gsvg.width,e,m,d,h,"transcript");l.xMin=e-.05*(m-e);l.xMax=m+.05*(m-e);h=l.xMin;e=l.xMax;svgList[d]=l;svgList[d].txType=c;svgList[d].selectedData=a;selectedGeneSymbol=a.getAttribute("geneSymbol");b.gsvg.selectedGeneSymbol=a.getAttribute("geneSymbol");selectedID=new String(a.getAttribute("ID"));-1===selectedID.indexOf("ENS")&&0<g.length&&(selectedID=g);$("div#selectedImage").show();console.log("here");-1<(new String(selectedID)).indexOf("ENS")&&
-1<b.trackClass.indexOf("ensembl")?(console.log("geneReport"),$("div#selectedReport").show(),d=pathPrefix+"geneReport.jsp",a={id:selectedID,geneSymbol:selectedGeneSymbol,chromosome:chr,species:organism,genomeVer:genomeVer},DisplaySelectedDetailReport(d,a)):"small"!==c?$("div#selectedReport").html("<BR><BR>Detailed Gene Reports are not currently provided for RNA-Seq(Cufflinks) generated genes that are novel and have not been matched to an existing annotated gene.  In the future overlapping probesets and SNPs will be summarized in the same manner.  This feature should be added by December 2014.  Please keep checking back or let us know you'd like to see it sooner."):
"rn6"===genomeVer&&(a=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/"+b.trackClass+".xml",d=pathPrefix+"smallRNAReport.jsp",a={dataPath:a,id:selectedID},DisplaySelectedDetailReport(d,a))}else"small"===c&&-1===(new String(a.getAttribute("ID"))).indexOf("ENS")&&"rn5"===genomeVer&&($("div#selectedImage").hide(),$("div#selectedReport").show(),h=a.getAttribute("start"),e=a.getAttribute("stop"),d=pathPrefix+"viewSmallNonCoding.jsp",a={id:a.getAttribute("ID"),name:"smRNA_"+
a.getAttribute("ID")},DisplaySelectedDetailReport(d,a));b.gsvg&&b.gsvg.selectSvg&&b.gsvg.selectSvg.changeSelection(h,e);$("html, body").animate({scrollTop:$("#selectedDetail").offset().top},200)}};b.getDisplayedData=function(){var a=[],d=0,c=[];if(-1<b.trackClass.indexOf("smallnc")){var h=0;b.counts=[];b.trackClass.indexOf("ensembl");"Gene"===b.drawnAs?c=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene"):"Trx"===b.drawnAs&&(c=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.trx"));
c.each&&c.each(function(g){var l=b.xScale(g.getAttribute("start")),m=b.xScale(g.getAttribute("stop"));if(0<=l&&l<=b.gsvg.width||0<=m&&m<=b.gsvg.width||0>=l&&m>=b.gsvg.width)l="Ensembl","undefined"!==typeof g.getAttribute("strain")?l=g.getAttribute("strain"):"undefined"!==typeof g.getAttribute("biotype")&&(l=g.getAttribute("biotype")),"undefined"===typeof b.counts[l]?(b.counts[l]={},b.counts[h]=b.counts[l],h++,b.counts[l].value=1,b.counts[l].names=l):b.counts[l].value++,a[d]=g,d++,e++})}else if("Gene"===
b.drawnAs)c=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene"),b.counts=[{value:0,names:"Ensembl"},{value:0,names:"Brain RNA-Seq"},{value:0,names:"Liver RNA-Seq"},{value:0,names:"Heart RNA-Seq"},{value:0,names:"Merged RNA-Seq"}],c.each(function(g){var l=b.xScale(g.getAttribute("start")),m=b.xScale(g.getAttribute("stop"));if(0<=l&&l<=b.gsvg.width||0<=m&&m<=b.gsvg.width)-1<(new String(g.childNodes[0].id)).indexOf("ENS")?b.counts[0].value++:-1<b.trackClass.indexOf("brain")?b.counts[1].value++:
-1<b.trackClass.indexOf("liver")?b.counts[2].value++:-1<b.trackClass.indexOf("heart")?b.counts[3].value++:-1<b.trackClass.indexOf("merged")&&b.counts[4].value++,a[d]=g,d++}),0===c.size()&&(b.counts=[]);else if("Trx"===b.drawnAs){c=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.trx"+b.gsvg.levelNumber);b.counts=[];var e=h=0;c.each(function(g){var l=b.xScale(g.getAttribute("start")),m=b.xScale(g.getAttribute("stop"));if(0<=l&&l<=b.gsvg.width||0<=m&&m<=b.gsvg.width||0>=l&&m>=b.gsvg.width)l=
"Ensembl","undefined"!==typeof g.getAttribute("strain")&&(l=g.getAttribute("strain")),"undefined"===typeof b.counts[l]?(b.counts[l]={},b.counts[h]=b.counts[l],h++,b.counts[l].value=1,b.counts[l].names=l):b.counts[l].value++,a[d]=g,d++,e++})}return a};b.updateData=function(a){d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/"+b.trackClass+".xml",function(d,c){if(d){if(0===a&&(0===b.trackClass.indexOf("heartTotal")||0===b.trackClass.indexOf("liverTotal")||0===b.trackClass.indexOf("brainTotal")||
"mergedTotal"===b.trackClass||-1<b.trackClass.indexOf("smallnc"))){var h="/"+pathPrefix;pathPrefix||(h="");var e=b.trackClass,g=panel;(0===b.trackClass.indexOf("liverTotal")||0===b.trackClass.indexOf("brainTotal"))&&0<b.trackClass.indexOf("_")&&(g=track.substr(track.indexOf("_")+1),"LEStm"===g&&(g="LE-Stm"),"F344Stm"===g&&(g="F344-Stm"));$.ajax({url:h+"generateTrackXML.jsp",type:"GET",cache:!1,asyn:!0,data:{chromosome:chr,minCoord:b.gsvg.xScale.domain()[0],maxCoord:b.gsvg.xScale.domain()[1],panel:g,
rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:e,folder:b.gsvg.folderName},dataType:"json",success:function(q){gtag("event","generateTrackGene",{event_category:"browser"})},error:function(q,t,v){}})}10>a?(h=2E3,1===a&&(h=5E3),setTimeout(function(){b.updateData(a+1)},h)):(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+b.trackClass),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).attr("height",
15),b.gsvg.addTrackErrorRemove(b.svg,"#Level"+b.gsvg.levelNumber+b.trackClass))}else if(c){h=c.documentElement.getElementsByTagName("Gene");e=[];g=[];for(var l=0,m=0;m<h.length;m++)h[m]&&(e[l]=h[m],g[h[m].getAttribute("ID")]=1,l++);for(m=0;m<b.data.length;m++)b.data[m]&&!g[b.data[m].getAttribute("ID")]&&(e[l]=b.data[m],l++);b.draw(e);b.hideLoading();setTimeout(function(){DisplayRegionReport()},300)}else b.hideLoading()})};b.updateDataVersion=function(a,d){var c=b.trackClass+"_"+a;d3.xml(dataPrefix+
"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/"+c+".xml",function(h,e){if(h){if(0===d){var g="/"+pathPrefix;pathPrefix||(g="");var l=panel;(0===track.indexOf("liverTotal")||0===track.indexOf("brainTotal"))&&0<track.indexOf("_")&&(l=track.substr(track.indexOf("_")+1),"LEStm"===l&&(l="LE-Stm"),"F344Stm"===l&&(l="F344-Stm"));$.ajax({url:g+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:b.gsvg.xScale.domain()[0],maxCoord:b.gsvg.xScale.domain()[1],
panel:l,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:c,folder:b.gsvg.folderName},dataType:"json",success:function(m){gtag("event","generateTrackGene",{event_category:"browser"})},error:function(m,q,t){}})}5>d?(g=1E4,0===d&&(g=5E3),setTimeout(function(){b.updateDataVersion(a,d+1)},g)):(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+b.trackClass),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).attr("height",
15),b.gsvg.addTrackErrorRemove(b.svg,"#Level"+b.gsvg.levelNumber+b.trackClass))}else g=e.documentElement.getElementsByTagName("Gene"),l=parseInt(a),b.dataVer=l,b.draw(g),b.hideLoading(),setTimeout(function(){DisplayRegionReport()},300)})};b.drawTrx=function(a,d){var c=parseInt(a.getAttribute("start"),10),h=parseInt(a.getAttribute("stop"),10);a.getAttribute("cdsStart")&&a.getAttribute("cdsStop")&&(c=parseInt(a.getAttribute("cdsStart"),10),h=parseInt(a.getAttribute("cdsStop"),10));var e="";1===b.gsvg.levelNumber?
e="tx":99===b.gsvg.levelNumber&&(e="ttTx");e=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" #"+e+b.cleanID(a.getAttribute("ID"))+b.gsvg.levelNumber);exList=getAllChildrenByName(getFirstChildByName(a,"exonList"),"exon");for(var g=0;g<exList.length;g++){var l=parseInt(exList[g].getAttribute("start"),10),m=parseInt(exList[g].getAttribute("stop"),10);if(l<c&&c<m||m>h&&h>l){var q=0,t=0,v=0,y=0;l<c?(q=b.xScale(l),t=b.xScale(c)-b.xScale(l),v=b.xScale(c),y=b.xScale(m)-b.xScale(c)):m>h&&(v=b.xScale(l),
y=b.xScale(h)-b.xScale(l),q=b.xScale(h),t=b.xScale(m)-b.xScale(h));e.append("rect").attr("x",q).attr("y",2.5).attr("height",5).attr("width",t).attr("title",function(A){return exList[g].getAttribute("ID")}).attr("id",function(A){return"ExNC"+exList[g].getAttribute("ID")}).style("fill",b.color).style("cursor","pointer");e.append("rect").attr("x",v).attr("height",10).attr("width",y).attr("title",function(A){return exList[g].getAttribute("ID")}).attr("id",function(A){return"Ex"+exList[g].getAttribute("ID")}).style("fill",
b.color).style("cursor","pointer")}else{q=10;t=0;if(l<c&&m<c||m>h&&l>h)q=5,t=2.5;e.append("rect").attr("x",function(A){return b.xScale(exList[g].getAttribute("start"))}).attr("y",t).attr("id",function(A){return"Ex"+exList[g].getAttribute("ID")}).attr("height",q).attr("width",function(A){return b.xScale(exList[g].getAttribute("stop"))-b.xScale(exList[g].getAttribute("start"))}).attr("title",function(A){return exList[g].getAttribute("ID")}).style("fill",b.color).style("cursor","pointer")}if(0<g&&(e.append("line").attr("x1",
function(A){return b.xScale(exList[g-1].getAttribute("stop"))}).attr("x2",function(A){return b.xScale(exList[g].getAttribute("start"))}).attr("y1",5).attr("y2",5).attr("id",function(A){return"Int"+exList[g-1].getAttribute("ID")+"_"+exList[g].getAttribute("ID")}).attr("stroke",b.color).attr("stroke-width","2"),"1"==a.getAttribute("strand")||"-1"==a.getAttribute("strand"))){l=">";if("-1"==a.getAttribute("strand")||"-"==a.getAttribute("strand"))l="<";m=l;q=b.xScale(exList[g-1].getAttribute("stop"));
t=b.xScale(exList[g].getAttribute("start"))-q;v=0;if(7>t)m="";else for(t-=7;8<t;)0==v?(m+=" ",v=1):(m+=l,v=0),t-=7;e.append("svg:text").attr("id",function(A){return"IntTxt"+exList[g-1].getAttribute("ID")+"_"+exList[g].getAttribute("ID")}).attr("dx",q+1).attr("dy","11").style("pointer-events","none").style("opacity","0.5").style("fill",b.color).style("font-size","16px").text(m)}}if(2==b.density){var w=a.getAttribute("ID");"undefined"!==typeof a.getAttribute("geneSymbol")&&0<a.getAttribute("geneSymbol").length&&
(w=w+" ("+a.getAttribute("geneSymbol")+")");e.append("svg:text").attr("dx",function(){var A=b.xScale(a.getAttribute("start"));return A=A<$(window).width()/2?b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start"))+5:-9*w.length}).attr("dy",10).attr("id","lblTxt").text(w)}else e.select("text#lblTxt").remove()};b.getSVGID=function(a){return b.getDisplayID(a.getAttribute("ID"))+" ("+a.getAttribute("geneSymbol")+")"};b.setupToolTipSVG=function(a,d){if("undefined"!==typeof a.getAttribute("extStart")&&
null!==a.getAttribute("extStart")){var c=parseInt(a.getAttribute("extStart"),10);var h=parseInt(a.getAttribute("extStop"),10)}else c=parseInt(a.getAttribute("start"),10),h=parseInt(a.getAttribute("stop"),10);var e=Math.floor((h-c)*d);10>e&&(e=10);c-=e;h+=e;e=toolTipSVG("div#ttSVG",450,c,h,99,b.getSVGID(a),"transcript");e.xMin=c;e.xMax=h;var g="none";0===b.trackClass.indexOf("liverTotal")?g=b.trackClass:"heartTotal"==b.trackClass?g="heartTotal":0===b.trackClass.indexOf("brainTotal")?g=b.trackClass:
"mergedTotal"==b.trackClass?g="mergedTotal":200>parseInt(a.getAttribute("stop"),10)-parseInt(a.getAttribute("start"),10)?g="small":"protein_coding"==a.getAttribute("biotype")&&200<=parseInt(a.getAttribute("stop"),10)-parseInt(a.getAttribute("start"),10)?g="protein":"protein_coding"!=a.getAttribute("biotype")&&200<=parseInt(a.getAttribute("stop"),10)-parseInt(a.getAttribute("start"),10)&&(g="long");e.txType=g;e.selectedData=a;g=[];g[0]=a;"undefined"!==typeof a.parent&&(g[0]=a.parent);e.addTrack(b.trackClass,
2,"DrawTrx",g);for(g=0;g<b.ttTrackList.length;g++)if(b.trackClass!==b.ttTrackList[g]){var l=b.gsvg.getTrackData(b.ttTrackList[g]),m=[];if("undefined"!==typeof l&&0<l.length){for(var q=0,t=0;t<l.length;t++)if(c<=parseInt(l[t].getAttribute("start"),10)&&parseInt(l[t].getAttribute("start"),10)<=h||c<=parseInt(l[t].getAttribute("stop"),10)&&parseInt(l[t].getAttribute("stop"),10)<=h||parseInt(l[t].getAttribute("start"),10)<=c&&parseInt(l[t].getAttribute("stop"),10)>=c)m[q]=l[t],q++;0<m.length&&e.addTrack(b.ttTrackList[g],
3,"DrawTrx",m)}}};b.draw=function(a){b.data=a;b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(var d=0;d<b.gsvg.width;d++)b.yMaxArr[d]=0,b.yArr[0][d]=0;b.svg.selectAll(".gene").remove();d=b.drawAs;var c=b.xScale.domain()[0];if(b.xScale.domain()[1]-c<b.trxCutoff||$("#forceTrxCBX"+b.gsvg.levelNumber).is(":checked"))b.drawAs="Trx";c="Genes";"Trx"==b.drawAs&&(c="Transcripts");var h="Protein Coding",e=" / PolyA+";-1<b.trackClass.indexOf("noncoding")?(h="Long Non-Coding",e=" / Non-PolyA+"):-1<b.trackClass.indexOf("smallnc")?
(h="Brain",-1<b.trackClass.indexOf("liver")?h="Liver":-1<b.trackClass.indexOf("heart")&&(h="Heart"),h+=" Small RNA",e=""):0===b.trackClass.indexOf("liverTotal")?(h="Liver RNA-Seq Reconstruction ",e="Total RNA"):"heartTotal"==b.trackClass?(h="Heart RNA-Seq Reconstruction ",e="Total RNA"):0===b.trackClass.indexOf("brainTotal")?(h="Whole Brain RNA-Seq Reconstruction ",e="Total RNA"):"mergedTotal"==b.trackClass&&(h="Merged (Brain,Heart,Liver) Reconstructed",e="Total RNA");h=-1<b.trackClass.indexOf("ensembl")?
"Ensembl "+h+" "+c:-1===b.trackClass.indexOf("brainTotal")&&-1===b.trackClass.indexOf("liverTotal")&&"heartTotal"!=b.trackClass&&"mergedTotal"!=b.trackClass?"Reconstruction "+h+e+" "+c:h+e+" "+c;(0===b.trackClass.indexOf("liverTotal")||0===b.trackClass.indexOf("brainTotal"))&&0<b.trackClass.indexOf("_")&&(c=b.trackClass.substr(b.trackClass.indexOf("_")+1),"LEStm"===c&&(c="LE-Stm"),"F344Stm"===c&&(c="F344-Stm"),h=c+" Filtered (>=1.0TPM) "+h);b.updateLabel(h);b.redrawLegend();c=a;if("Trx"===b.drawAs&&
-1===b.trackClass.indexOf("smallnc"))for(c=[],e=h=0;e<a.length;e++)if("undefined"!==typeof a[e])for(var g=getAllChildrenByName(getFirstChildByName(a[e],"TranscriptList"),"Transcript"),l=0;l<g.length;l++)c[h]=g[l],c[h].parent=a[e],h++;0<c.length&&("Gene"===b.drawAs||-1<b.trackClass.indexOf("smallnc")?(b.drawnAs="Gene",b.svg.selectAll(".trx0").each(function(){d3.select(this).remove()}),a=b.svg.selectAll(".gene").data(c,key).attr("transform",function(m,q){return"translate("+b.xScale(m.getAttribute("start"))+
","+b.calcY(parseInt(m.getAttribute("start"),10),parseInt(m.getAttribute("stop"),10),q)+")"}),a.enter().append("g").attr("class","gene").attr("transform",function(m,q){return"translate("+b.xScale(m.getAttribute("start"))+","+b.calcY(parseInt(m.getAttribute("start"),10),parseInt(m.getAttribute("stop"),10),q)+")"}).merge(a).append("rect").attr("height",10).attr("rx",1).attr("ry",1).attr("width",function(m){return b.xScale(m.getAttribute("stop"))-b.xScale(m.getAttribute("start"))}).attr("title",function(m){return m.getAttribute("ID")}).attr("stroke",
b.colorStroke).attr("stroke-width","1").attr("id",function(m){return b.cleanID(m.getAttribute("ID"))}).style("fill",b.color).style("cursor","pointer").on("click",function(m){setTimeout(function(){b.setupDetailedView(m);d3.select(this).attr("class","selected").style("fill","green")}.bind(this),10)}).on("dblclick",b.zoomToFeature).on("mouseover",function(m){0===b.gsvg.isToolTip&&(overSelectable=1,$("#mouseHelp").html("<B>Click</B> to see additional details. <B>Double Click</B> to zoom in on this feature."),
d3.select(this).style("fill","green"),tt.transition().duration(200).style("opacity",1).style("top",function(){return b.positionTTTop(d3.event.pageY)}).style("left",function(){return b.positionTTLeft(d3.event.pageX)}),tt.html(b.createToolTip(m)),m&&(b.triggerTableFilter(m),-1===b.trackClass.indexOf("smallnc")?"Trx"===b.drawAs?b.setupToolTipSVG(m.parent,.05):b.setupToolTipSVG(m,.05):b.setupToolTipSVG(m,.05),tt.style("top",function(){return b.positionTTTop(d3.event.pageY)})))}).on("mouseout",function(m){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");
"selected"!==d3.select(this).attr("class")&&d3.select(this).style("fill",b.color);tt.transition().delay(500).duration(200).style("opacity",0);b.clearTableFilter(m)}),a.exit().remove(),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").each(function(m){if(m){var q=d3.select(this);if("-1"==m.getAttribute("strand")||"1"==m.getAttribute("strand")){var t=">";"-1"==m.getAttribute("strand")&&(t="<");var v=t,y=q.select("rect").attr("width");if(8.5>y)v="";else for(y-=8.5,v=t;8.7<y;)v+=
t,y-=8.5;q.append("svg:text").attr("dx","1").attr("dy","10").attr("id","strandTxt").style("pointer-events","none").text(v)}if(2===b.density){var w=m.getAttribute("ID");m.getAttribute("geneSymbol")&&0<m.getAttribute("geneSymbol").length&&(w=w+" ("+m.getAttribute("geneSymbol")+")");q.append("svg:text").attr("dx",function(){var A=b.xScale(m.getAttribute("start"));return A=A<$(window).width()/2?b.xScale(m.getAttribute("stop"))-b.xScale(m.getAttribute("start"))+5:-9*w.length}).attr("dy",10).attr("id",
"lblTxt").text(w)}else q.select("text#lblTxt").remove()}}),1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").size()+1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1))):"Trx"==b.drawAs&&(b.drawnAs="Trx",b.svg.selectAll(".gene").each(function(){d3.select(this).remove()}),b.svg.selectAll(".trx"+b.gsvg.levelNumber).remove(),a=b.svg.selectAll(".trx"+b.gsvg.levelNumber).data(c,key).attr("transform",function(m,
q){return"translate("+b.xScale(m.getAttribute("start"))+","+b.calcY(parseInt(m.getAttribute("start"),10),parseInt(m.getAttribute("stop"),10),q)+")"}),a.enter().append("g").attr("class",function(m){m=new String(m.parent.getAttribute("ID"));return"trx"+b.gsvg.levelNumber+" gene"+m.replace(".","_")}).attr("transform",function(m,q){return"translate(0,"+b.calcY(parseInt(m.getAttribute("start"),10),parseInt(m.getAttribute("stop"),10),q)+")"}).attr("id",function(m){var q="";1==b.gsvg.levelNumber&&(q="tx");
99==b.gsvg.levelNumber&&(q="ttTx");return q+b.cleanID(m.getAttribute("ID"))+b.gsvg.levelNumber}).style("cursor","pointer").on("click",function(m){setTimeout(function(){if(0==b.gsvg.levelNumber){var q=(new String(m.parent.getAttribute("ID"))).replace(".","_");b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("line").style("stroke",b.color);b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("rect").style("fill",b.color);b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("text").style("opacity",
"0.6").style("fill",b.color);b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").each(function(){var t=new String($(this).attr("class"));t=t.replace(" selected","");$(this).attr("class",t)});b.svg.selectAll("g.gene"+q).each(function(){var t=$(this).attr("class")+" selected";$(this).attr("class",t)});b.svg.selectAll("g.gene"+q).selectAll("line").style("stroke","green");b.svg.selectAll("g.gene"+q).selectAll("rect").style("fill","green");b.svg.selectAll("g.gene"+q).selectAll("text").style("opacity",
"0.3").style("fill","green");b.setupDetailedView(m.parent)}},10)}).on("dblclick",b.zoomToFeature).on("mouseover",function(m){if(0===b.gsvg.isToolTip){if(0===b.gsvg.levelNumber&&"undefined"!==typeof m.parent){var q=(new String(m.parent.getAttribute("ID"))).replace(".","_");b.svg.selectAll("g.gene"+q).selectAll("line").style("stroke","green");b.svg.selectAll("g.gene"+q).selectAll("rect").style("fill","green");b.svg.selectAll("g.gene"+q).selectAll("text").style("opacity","0.3").style("fill","green")}else d3.select(this).selectAll("line").style("stroke",
"green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green");tt.transition().duration(200).style("opacity",1);tt.html(b.createToolTip(m)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)});b.triggerTableFilter(m);if("undefined"!==typeof m){if(-1===b.trackClass.indexOf("smallnc"))b.setupToolTipSVG(m,.05);else{q=toolTipSVG("div#ttSVG",450,
parseInt(m.getAttribute("start"),10)-10,parseInt(m.getAttribute("stop"),10)+10,99,b.getDisplayID(m.getAttribute("ID")),"");q.xMin=parseInt(m.getAttribute("start"),10)-20;q.xMax=parseInt(m.getAttribute("stop"),10)+20;var t=[];t[0]=m;q.addTrack(b.trackClass,2,"",t)}tt.style("top",function(){return b.positionTTTop(d3.event.pageY)})}}}).on("mouseout",function(m){if(-1==(new String(d3.select(this).attr("class"))).indexOf("selected"))if(0==b.gsvg.levelNumber){var q=(new String(m.parent.getAttribute("ID"))).replace(".",
"_");b.svg.selectAll("g.gene"+q).selectAll("line").style("stroke",b.color);b.svg.selectAll("g.gene"+q).selectAll("rect").style("fill",b.color);b.svg.selectAll("g.gene"+q).selectAll("text").style("opacity","0.6").style("fill",b.color)}else d3.select(this).selectAll("line").style("stroke",b.color),d3.select(this).selectAll("rect").style("fill",b.color),d3.select(this).selectAll("text").style("opacity","0.6").style("fill",b.color);tt.transition().delay(500).duration(200).style("opacity",0);b.clearTableFilter(m)}).merge(a).each(b.drawTrx),
a.exit().remove(),a,1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.trx"+b.gsvg.levelNumber).size()+1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1))));""!=selectGene&&b.setSelected(selectGene);b.redrawSelectedArea();b.drawAs=d};b.redrawLegend=function(){var a=[],d=0;"Trx"===b.drawAs&&("braincoding"===b.trackClass?"Rn"===organism&&(a[d]={color:"#7EB5D6",label:"All"},d++,a[d]={color:"#5E95FF",label:"BN-Lx"},
d++,a[d]={color:"#BE95B6",label:"SHR"},d++):"brainnoncoding"===b.trackClass?"Rn"===organism&&(a[d]={color:"#CECFCE",label:"All"},d++,a[d]={color:"#3E75FF",label:"BN-Lx"},d++,a[d]={color:"#FE7596",label:"SHR"},d++):"liverTotal"===b.trackClass?(a[d]={color:"#bbbedd",label:"All"},d++,a[d]={color:"#9b9eFF",label:"BN-Lx"},d++,a[d]={color:"#Fb9eBd",label:"SHR"},d++):"heartTotal"===b.trackClass?(a[d]={color:"#DC7252",label:"All"},d++,a[d]={color:"#BC5292",label:"BN-Lx"},d++,a[d]={color:"#FF5232",label:"SHR"},
d++):"mergedTotal"!==b.trackClass&&"brainTotal"===b.trackClass&&(a[d]={color:"#7EB5D6",label:"All"},d++,a[d]={color:"#5E95FF",label:"BN-Lx"},d++,a[d]={color:"#BE95B6",label:"SHR"},d++));"brainsmallnc"===b.trackClass?(a[d]={color:"#3E7596",label:"All"},d++,a[d]={color:"#1E55D6",label:"BN-Lx"},d++,a[d]={color:"#7E5576",label:"SHR"}):"heartsmallnc"===b.trackClass?(a[d]={color:"#9C3212",label:"All"},d++,a[d]={color:"#7C1252",label:"BN-Lx"},d++,a[d]={color:"#DC1200",label:"SHR"}):"liversmallnc"===b.trackClass&&
(a[d]={color:"#7b7e9d",label:"All"},d++,a[d]={color:"#5b5eDd",label:"BN-Lx"},d++,a[d]={color:"#bb5e7d",label:"SHR"});b.drawLegend(a)};b.triggerTableFilter=function(a){var d=jQuery.Event("keyup");d.which=32;var c="";"undefined"!==typeof a.getAttribute&&"undefined"!==typeof a.getAttribute("ID")&&(c=b.getDisplayID(a.getAttribute("ID")));-1==b.trackClass.indexOf("smallnc")?$("#tblGenes"+b.trackClass+"_filter input").val(c).trigger(d):$("#tblsmGenes_filter input").val(c).trigger(d)};b.clearTableFilter=
function(a){a=jQuery.Event("keyup");a.which=32;"smallnc"!=b.trackClass?$("#tblGenes"+b.trackClass+"_filter input").val("").trigger(a):$("#tblsmGenes_filter input").val("").trigger(a)};b.updateSettingsFromUI=function(){0<$("#"+b.trackClass+"Dense"+b.level+"Select").length&&(b.density=$("#"+b.trackClass+"Dense"+b.level+"Select").val(),"string"===typeof b.density&&(b.density=parseInt(b.density)));0<$("#"+b.trackClass+"Version"+b.level+"Select").length&&(b.reqDataVer=$("#"+b.trackClass+"Version"+b.level+
"Select").val())};b.savePrevious=function(){b.prevSetting={};b.prevSetting.density=b.density;b.prevSetting.dataVer=b.dataVer};b.revertPrevious=function(){b.density=b.prevSetting.density;b.dataVer=b.prevSetting.dataVer};b.updateSettings=function(a){};b.generateTrackSettingString=function(){return b.trackClass+","+b.density+","+b.dataVer+";"};b.redrawLegend();b.draw(n);return b}
function RefSeqTrack(p,n,r,u,f){var b=GeneTrack(p,n,r,u);b.counts=[{value:0,names:"Ensembl"},{value:0,names:"RNA-Seq"}];b.drawAs="Gene";b.trxCutoff=1E5;b.density=3;-1<(new String(f)).indexOf("DrawTrx")&&(b.drawAs="Trx");b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(p=0;p<b.gsvg.width;p++)b.yMaxArr[p]=0,b.yArr[0][p]=0;b.ttTrackList=[];b.ttTrackList.push("ensemblcoding");b.ttTrackList.push("braincoding");b.ttTrackList.push("liverTotal");b.ttTrackList.push("heartTotal");b.ttTrackList.push("mergedTotal");b.ttTrackList.push("ensemblnoncoding");
b.ttTrackList.push("brainnoncoding");b.ttTrackList.push("repeatMask");b.ttTrackList.push("snpSHRH");b.ttTrackList.push("snpBNLX");b.ttTrackList.push("snpF344");b.ttTrackList.push("snpSHRJ");b.cleanID=function(a){return a=a.replace(/\./g,"_")};b.color=function(a){var d=d3.rgb("#000000");if("Gene"==b.drawnAs){a=getAllChildrenByName(getFirstChildByName(a,"TranscriptList"),"Transcript");for(var c=-1,h=0;h<a.length;h++){var e=new String(a[h].getAttribute("category")),g=-1;"Reviewed"==e?g=5:"Validated"==
e?g=4:"Provisional"==e?g=3:"Inferred"==e?g=2:"Predicted"==e?g=1:"Model"==e?g=1:"Unknown"==e&&(g=0);c<g&&(c=g)}5===c&&(d=d3.rgb("#18814F"));4===c?d=d3.rgb("#38A16F"):3===c?d=d3.rgb("#78E1AF"):2===c?d=d3.rgb("#A8FFDF"):1===c?d=d3.rgb("#A8DFFF"):0===c&&(d=d3.rgb("#C8FFFF"))}else"Trx"==b.drawnAs&&(e=new String(a.getAttribute("category")),"Reviewed"==e?d=d3.rgb("#18814F"):"Validated"==e?d=d3.rgb("#38A16F"):"Provisional"==e?d=d3.rgb("#78E1AF"):"Inferred"==e?d=d3.rgb("#A8FFDF"):"Predicted"==e?d=d3.rgb("#A8DFFF"):
"Model"===e?d=d3.rgb("#A8DFFF"):"Unknown"===e&&(d=d3.rgb("#C8FFFF")));return d};b.pieColor=function(a,d){var c=d3.rgb("#000000"),h=new String(a.data.names);-1<h.indexOf("Reviewed")?c=d3.rgb("#18814F"):-1<h.indexOf("Validated")?c=d3.rgb("#38A16F"):-1<h.indexOf("Provisional")?c=d3.rgb("#78E1AF"):-1<h.indexOf("Inferred")?c=d3.rgb("#A8FFDF"):-1<h.indexOf("Predicted")?c=d3.rgb("#A8DFFF"):-1<h.indexOf("Model")?c=d3.rgb("#A8DFFF"):-1<h.indexOf("Unknown")&&(c=d3.rgb("#C8FFFF"));return c};b.getDisplayedData=
function(){var a=[],d=0,c=0;if("Gene"==b.drawnAs){var h=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".gene");b.counts=[];var e=0;h.each(function(g){var l=b.xScale(g.getAttribute("start")),m=b.xScale(g.getAttribute("stop"));if(0<=l&&l<=b.gsvg.width||0<=m&&m<=b.gsvg.width||0>=l&&m>=b.gsvg.width){m=getAllChildrenByName(getFirstChildByName(g,"TranscriptList"),"Transcript");l=-1;for(var q=0;q<m.length;q++){var t=new String(m[q].getAttribute("category")),v=-1;"Reviewed"==t?v=5:"Validated"==
t?v=4:"Provisional"==t?v=3:"Inferred"==t?v=2:"Predicted"==t?v=1:"Model"==t?v=1:"Unknown"==t&&(v=1);l<v&&(l=v)}m="Unknown";5==l?m="Reviewed":4==l?m="Validated":3==l?m="Provisional":2==l?m="Inferred":1==l&&(m="Predicted/Model");"undefined"===typeof b.counts[m]?(b.counts[m]={},b.counts[e]=b.counts[m],e++,b.counts[m].value=1,b.counts[m].names=m):b.counts[m].value++;a[d]=g;d++;c++}})}else b.counts=[],e=0,b.svg.selectAll("g.trx"+b.gsvg.levelNumber).each(function(g){var l=b.xScale(g.getAttribute("start")),
m=b.xScale(g.getAttribute("stop"));if(0<=l&&l<=b.gsvg.width||0<=m&&m<=b.gsvg.width||0>=l&&m>=b.gsvg.width)l=new String(g.getAttribute("category")),"undefined"===typeof b.counts[l]?(b.counts[l]={},b.counts[e]=b.counts[l],e++,b.counts[l].value=1,b.counts[l].names=l):b.counts[l].value++,a[d]=g,d++,c++});return a};b.createToolTip=function(a){var d="",c=a.getAttribute("strand");c="1"==c||"+"==c?"+":"-1"==c||"-"==c?"-":".";if("Gene"===b.drawnAs){d="";for(var h=getAllChildrenByName(getFirstChildByName(a,
"TranscriptList"),"Transcript"),e=0;e<h.length;e++){var g=new String(h[e].getAttribute("ID"));d+="<B>"+g+"</B> - "+h[e].getAttribute("category");d+="<br>"}d='<BR><div id="ttSVG" style="background:#FFFFFF;"></div>Gene Symbol: '+a.getAttribute("geneSymbol")+"<BR>Location: "+a.getAttribute("chromosome")+":"+numberWithCommas(a.getAttribute("start"))+"-"+numberWithCommas(a.getAttribute("stop"))+"<BR>Strand: "+c+"<BR>Transcripts:<BR>"+d}else"Trx"===b.drawnAs&&(g=new String(a.getAttribute("ID")),d='<BR><div id="ttSVG" style="background:#FFFFFF;"></div>RefSeq ID:<B>'+
(g+"</B><BR>Status: ")+a.getAttribute("category")+"<BR>Gene Symbol: "+a.getAttribute("geneSymbol")+"<BR>Location: "+a.getAttribute("chromosome")+":"+numberWithCommas(a.getAttribute("start"))+"-"+numberWithCommas(a.getAttribute("stop"))+"<BR>Strand: "+c);return d};b.getSVGID=function(a){return a.getAttribute("geneSymbol")};b.setupToolTipSVG=function(a,d){var c=parseInt(a.getAttribute("start"),10),h=parseInt(a.getAttribute("stop"),10),e=Math.floor((h-c)*d);20>e&&(e=20);var g=c-e;e=h+e;1>g&&(g=1);"undefined"!==
typeof b.ttSVGMinWidth&&e-g<b.ttSVGMinWidth&&(g=c-b.ttSVGMinWidth/2,e=h+b.ttSVGMinWidth/2);c=toolTipSVG("div#ttSVG",450,g,e,99,b.getSVGID(a),"transcript");c.forLevel=b.gsvg.levelNumber;h=[];h.push(a);c.addTrack(b.trackClass,3,"DrawTrx",h);for(h=0;h<b.ttTrackList.length;h++){var l=b.gsvg.getTrackData(b.ttTrackList[h]),m=[];if("undefined"!==typeof l&&0<l.length){for(var q=0,t=0;t<l.length;t++)if(g<=parseInt(l[t].getAttribute("start"),10)&&parseInt(l[t].getAttribute("start"),10)<=e||parseInt(l[t].getAttribute("start"),
10)<=g&&parseInt(l[t].getAttribute("stop"),10)>=g)m[q]=l[t],q++;0<m.length&&c.addTrack(b.ttTrackList[h],3,"DrawTrx",m)}}};b.calcY=function(a,d,c){if(3==b.density)if(a>=b.xScale.domain()[0]&&a<=b.xScale.domain()[1]||d>=b.xScale.domain()[0]&&d<=b.xScale.domain()[1]||a<=b.xScale.domain()[0]&&d>=b.xScale.domain()[1]){a=Math.floor(b.xScale(a));0>a&&(a=0);d=Math.floor(b.xScale(d))+1;d>=b.gsvg.width&&(d=b.gsvg.width-1);c=a-5;0>c&&(c=0);var h=d+5;h>=b.gsvg.width&&(h=b.gsvg.width-1);for(var e=0,g=c;g<=h;g++)b.yMaxArr[g]>
e&&(e=b.yMaxArr[g]);e++;var l=e;if(b.yArr.length<=e)for(b.yArr[l]=[],g=0;g<b.gsvg.width;g++)b.yArr[l][g]=0;g=e-12;1>g&&(g=1);l=0;for(var m=g;m<e&&0==l;m++){var q=0;for(g=c;g<=h&&0==q;g++)b.yArr[m][g]>q&&(q=1);0==q&&(e=m,l=1)}e>b.trackYMax&&(b.trackYMax=e);for(g=a;g<=d;g++)b.yMaxArr[g]<e&&(b.yMaxArr[g]=e),b.yArr[e][g]=1;a=15*e}else a=15;else a=2==b.density?15*(c+1):15;b.trackYMax<a/15&&(b.trackYMax=a/15);return a};b.redraw=function(){var a=b.xScale.domain()[0];a=b.xScale.domain()[1]-a;var d=0;b.yMaxArr=
[];b.yArr=[];b.yArr[0]=[];for(var c=0;c<b.gsvg.width;c++)b.yMaxArr[c]=0,b.yArr[0][c]=0;b.trackYMax=0;if(a<b.trxCutoff&&"Gene"==b.drawnAs||a>=b.trxCutoff&&"Trx"==b.drawnAs&&"Trx"!=b.drawAs||"Gene"==b.drawnAs&&$("#forceTrxCBX"+b.gsvg.levelNumber).is(":checked"))b.draw(b.data);else if(a<b.trxCutoff&&"Trx"==b.drawnAs&&"Trx"!=b.drawAs&&(d=1),"Gene"==b.drawAs&&0==d)b.svg.node()&&(b.svg.selectAll(".trx").each(function(){d3.select(this).remove()}),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").attr("transform",
function(h,e){return"translate("+b.xScale(h.getAttribute("start"))+","+b.calcY(parseInt(h.getAttribute("start"),10),parseInt(h.getAttribute("stop"),10),e)+")"}),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene rect").attr("width",function(h){var e=1;1<b.xScale(h.getAttribute("stop"))-b.xScale(h.getAttribute("start"))&&(e=b.xScale(h.getAttribute("stop"))-b.xScale(h.getAttribute("start")));return e}).attr("stroke",b.colorStroke),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").each(function(h){var e=
d3.select(this);if("1"==h.getAttribute("strand")||"-1"==h.getAttribute("strand")||"-"==h.getAttribute("strand")||"+"==h.getAttribute("strand")){var g=">";if("-1"==h.getAttribute("strand")||"-"==h.getAttribute("strand"))g="<";h="";var l=e.select("rect").attr("width");if(8.5<=l&&15.8>=l)h=g;else for(;8.7<l;)h+=g,l-=8.5;e.select("text").text(h)}})),1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").size()+
1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1));else if(1==d||"Trx"==b.drawAs)b.svg.selectAll("g.trx"+b.gsvg.levelNumber).attr("transform",function(h,e){return"translate(0,"+b.calcY(parseInt(h.getAttribute("start"),10),parseInt(h.getAttribute("stop"),10),e)+")"}).each(function(h,e){var g=parseInt(h.getAttribute("cdsStart"),10),l=parseInt(h.getAttribute("cdsStop"),10);exList=getAllChildrenByName(getFirstChildByName(h,"exonList"),"exon");var m="";1==b.gsvg.levelNumber&&(m="tx");for(var q=
0;q<exList.length;q++){var t=parseInt(exList[q].getAttribute("start"),10),v=parseInt(exList[q].getAttribute("stop"),10);if(t<g&&g<v||v>l&&l>t){var y=t,w=g;v>l?(y=l,w=v,v=l):t=g;d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).select("g#"+m+b.cleanID(h.getAttribute("ID"))+" rect#ExNC"+exList[q].getAttribute("ID")).attr("x",function(B){return b.xScale(y)}).attr("width",function(B){return b.xScale(w)-b.xScale(y)})}d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).select("g#"+m+b.cleanID(h.getAttribute("ID"))+
" rect#Ex"+exList[q].getAttribute("ID")).attr("x",function(B){return b.xScale(t)}).attr("width",function(B){return b.xScale(v)-b.xScale(t)});if(0<q){var A=b.xScale(exList[q-1].getAttribute("stop")),C=b.xScale(exList[q].getAttribute("start"));if("1"==h.getAttribute("strand")||"-1"==h.getAttribute("strand")||"-"==h.getAttribute("strand")||"+"==h.getAttribute("strand")){var F=">";"-1"==h.getAttribute("strand")&&(F="<");var E=F,D=C-A,z=0;if(7>D)E="";else for(D-=7;8<D;)0==z?(E+=" ",z=1):(E+=F,z=0),D-=
7;d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).select("g#"+m+b.cleanID(h.getAttribute("ID"))+" #IntTxt"+exList[q-1].getAttribute("ID")+"_"+exList[q].getAttribute("ID")).attr("dx",A+1).text(E)}d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).select("g#"+m+b.cleanID(h.getAttribute("ID"))+" line#Int"+exList[q-1].getAttribute("ID")+"_"+exList[q].getAttribute("ID")).attr("x1",A).attr("x2",C)}}}),1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(d3.select("#Level"+b.gsvg.levelNumber+
b.trackClass).selectAll("g.trx"+b.gsvg.levelNumber).size()+1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1));b.redrawSelectedArea()};b.updateData=function(a){var d=b.xScale.domain()[0],c=b.xScale.domain()[1];d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/refSeq.xml",function(h,e){if(h){if(0==a){var g=contextPath+"/"+pathPrefix;pathPrefix||(g="");$.ajax({url:g+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:d,maxCoord:c,
rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,track:b.trackClass,folder:b.gsvg.folderName,panel:panel},dataType:"json",success:function(v){},error:function(v,y,w){}})}10>a?(g=2500,1==a&&(g=1E4),setTimeout(function(){b.updateData(a+1)},g)):(d3.select("#Level"+b.levelNumber+b.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+b.trackClass),d3.select("#Level"+b.levelNumber+b.trackClass).attr("height",15),b.gsvg.addTrackErrorRemove(b.svg,"#Level"+b.gsvg.levelNumber+
b.trackClass))}else if(e){g=e.documentElement.getElementsByTagName("Gene");for(var l=[],m=[],q=0,t=0;t<g.length;t++)g[t]&&(l[q]=g[t],l[q].setAttribute("ID",q),m[g[t].getAttribute("geneSymbol")]=1,q++);for(t=0;t<b.data.length;t++)b.data[t]&&!m[b.data[t].getAttribute("geneSymbol")]&&(l[q]=b.data[t],l[q].setAttribute("ID",q),q++);b.draw(l);b.hideLoading();b.getDisplayedData();setTimeout(function(){DisplayRegionReport()},300)}else b.updateData(a+1),b.hideLoading()})};b.drawTrx=function(a,d){var c=parseInt(a.getAttribute("cdsStart"),
10),h=parseInt(a.getAttribute("cdsStop"),10),e="";1==b.gsvg.levelNumber&&(e="tx");e=b.svg.select("#"+e+b.cleanID(a.getAttribute("ID")));exList=getAllChildrenByName(getFirstChildByName(a,"exonList"),"exon");for(var g=0;g<exList.length;g++){var l=parseInt(exList[g].getAttribute("start"),10),m=parseInt(exList[g].getAttribute("stop"),10);if(l<c&&c<m||m>h&&h>l){var q=0,t=0,v=0,y=0;l<c?(q=b.xScale(l),t=b.xScale(c)-b.xScale(l),v=b.xScale(c),y=b.xScale(m)-b.xScale(c)):m>h&&(v=b.xScale(l),y=b.xScale(h)-b.xScale(l),
q=b.xScale(h),t=b.xScale(m)-b.xScale(h));e.append("rect").attr("x",q).attr("y",2.5).attr("height",5).attr("width",t).attr("title",function(w){return exList[g].getAttribute("ID")}).attr("id",function(w){return"ExNC"+exList[g].getAttribute("ID")}).style("fill",b.color).style("cursor","pointer");e.append("rect").attr("x",v).attr("height",10).attr("width",y).attr("title",function(w){return exList[g].getAttribute("ID")}).attr("id",function(w){return"Ex"+exList[g].getAttribute("ID")}).style("fill",b.color).style("cursor",
"pointer")}else{q=10;t=0;if(l<c&&m<c||m>h&&l>h)q=5,t=2.5;e.append("rect").attr("x",function(w){return b.xScale(exList[g].getAttribute("start"))}).attr("y",t).attr("height",q).attr("width",function(w){return b.xScale(exList[g].getAttribute("stop"))-b.xScale(exList[g].getAttribute("start"))}).attr("title",function(w){return exList[g].getAttribute("ID")}).attr("id",function(w){return"Ex"+exList[g].getAttribute("ID")}).style("fill",b.color).style("cursor","pointer")}if(0<g&&(e.append("line").attr("x1",
function(w){return b.xScale(exList[g-1].getAttribute("stop"))}).attr("x2",function(w){return b.xScale(exList[g].getAttribute("start"))}).attr("y1",5).attr("y2",5).attr("id",function(w){return"Int"+exList[g-1].getAttribute("ID")+"_"+exList[g].getAttribute("ID")}).attr("stroke",b.color).attr("stroke-width","2"),"1"==a.getAttribute("strand")||"-1"==a.getAttribute("strand")||"-"==a.getAttribute("strand")||"+"==a.getAttribute("strand"))){l=">";if("-"==a.getAttribute("strand")||"-1"==a.getAttribute("strand"))l=
"<";m=l;q=b.xScale(exList[g-1].getAttribute("stop"));t=b.xScale(exList[g].getAttribute("start"))-q;v=0;if(7>t)m="";else for(t-=7;8<t;)0==v?(m+=" ",v=1):(m+=l,v=0),t-=7;e.append("svg:text").attr("id",function(w){return"IntTxt"+exList[g-1].getAttribute("ID")+"_"+exList[g].getAttribute("ID")}).attr("dx",q+1).attr("dy","11").style("pointer-events","none").style("opacity","0.5").style("fill",b.color).style("font-size","16px").text(m)}}};b.draw=function(a){b.data=a;b.trackYMax=0;b.yArr=[];b.yArr[0]=[];
for(var d=0;d<b.gsvg.width;d++)b.yMaxArr[d]=0,b.yArr[0][d]=0;b.svg.selectAll(".gene").remove();b.svg.selectAll(".trx"+b.gsvg.levelNumber).remove();var c=b.drawAs;d=b.xScale.domain()[0];if(b.xScale.domain()[1]-d<b.trxCutoff||$("#forceTrxCBX"+b.gsvg.levelNumber).is(":checked"))b.drawAs="Trx";if(0!=a&&"Gene"===b.drawAs)b.drawnAs="Gene",b.label="Ref Seq Genes",b.updateLabel(b.label),b.redrawLegend(),a=b.svg.selectAll(".gene").data(a,key).attr("transform",function(m,q){return"translate("+b.xScale(m.getAttribute("start"))+
","+b.calcY(parseInt(m.getAttribute("start"),10),parseInt(m.getAttribute("stop"),10),q)+")"}),a.enter().append("g").attr("class","gene").attr("transform",function(m,q){return"translate("+b.xScale(m.getAttribute("start"))+","+b.calcY(parseInt(m.getAttribute("start"),10),parseInt(m.getAttribute("stop"),10),q)+")"}).append("rect").attr("height",10).attr("rx",1).attr("ry",1).attr("width",function(m){return b.xScale(m.getAttribute("stop"))-b.xScale(m.getAttribute("start"))}).attr("title",function(m){return m.getAttribute("ID")}).attr("stroke",
b.colorStroke).attr("stroke-width","1").attr("id",function(m){return b.cleanID(m.getAttribute("ID"))}).style("fill",b.color).on("dblclick",b.zoomToFeature).on("mouseover",function(m){0==b.gsvg.isToolTip&&(overSelectable=1,$("#mouseHelp").html("<B>Double Click</B> to zoom in on this feature."),d3.select(this).style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(b.createToolTip(m)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)}),
b.setupToolTipSVG(m,.05));return!1}).on("mouseout",function(m){overSelectable=0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");"selected"!=d3.select(this).attr("class")&&d3.select(this).style("fill",b.color);tt.transition().delay(500).duration(200).style("opacity",0)}),a.exit().remove(),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").each(function(m){if("undefined"!==typeof m){var q=d3.select(this);if("1"==m.getAttribute("strand")||
"-1"==m.getAttribute("strand")||"-"==m.getAttribute("strand")||"+"==m.getAttribute("strand")){var t=">";if("-"==m.getAttribute("strand")||"-1"==m.getAttribute("strand"))t="<";var v=q.select("rect").attr("width");if(8.5>v)m="";else for(v-=8.5,m=t;8.7<v;)m+=t,v-=8.5;q.append("svg:text").attr("dx","1").attr("dy","10").style("pointer-events","none").text(m)}}}),1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").size()+
1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1));else if(0!=a&&"Trx"===b.drawAs){b.drawnAs="Trx";b.label="Ref Seq Transcripts";b.updateLabel(b.label);b.redrawLegend();var h=[],e=0;for(d=0;d<a.length;d++)for(var g=getAllChildrenByName(getFirstChildByName(a[d],"TranscriptList"),"Transcript"),l=0;l<g.length;l++)h[e]=g[l],h[e].parent=a[d],e++;d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".trx"+b.gsvg.levelNumber).remove();a=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".trx"+
b.gsvg.levelNumber).data(h,key).attr("transform",function(m,q){return"translate("+b.xScale(m.getAttribute("start"))+","+b.calcY(parseInt(m.getAttribute("start"),10),parseInt(m.getAttribute("stop"),10),q)+")"});a.enter().append("g").attr("class","trx"+b.gsvg.levelNumber).attr("transform",function(m,q){return"translate(0,"+b.calcY(parseInt(m.getAttribute("start"),10),parseInt(m.getAttribute("stop"),10),q)+")"}).attr("id",function(m){var q="";1==b.gsvg.levelNumber&&(q="tx");return q+b.cleanID(m.getAttribute("ID"))}).on("mouseover",
function(m){0==b.gsvg.isToolTip&&(d3.select(this).selectAll("line").style("stroke","green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(b.createToolTip(m)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)}),"undefined"!==typeof m&&b.setupToolTipSVG(m.parent,.05))}).on("mouseout",
function(m){d3.select(this).selectAll("line").style("stroke",function(q){return b.color(q)});d3.select(this).selectAll("rect").style("fill",function(q){return b.color(q)});d3.select(this).selectAll("text").style("opacity","0.6").style("fill",function(q){return b.color(q)});tt.transition().delay(500).duration(200).style("opacity",0)}).each(b.drawTrx);a.exit().remove();2==b.density?b.svg.attr("height",15*(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.trx"+b.gsvg.levelNumber).size()+
1)):3==b.density?b.svg.attr("height",15*(b.trackYMax+1)):b.svg.attr("height",30)}b.redrawSelectedArea();b.drawAs=c};b.redrawLegend=function(){b.drawLegend([{color:"#18814F",label:"Reviewed"},{color:"#38A16F",label:"Validated"},{color:"#78E1AF",label:"Provisional"},{color:"#A8FFDF",label:"Inferred"},{color:"#A8DFFF",label:"Predicted/Model"},{color:"#C8FFFF",label:"Unknown"}])};b.redrawLegend();b.draw(n);DisplayRegionReport();return b}
function ProbeTrack(p,n,r,u,f){var b=Track(p,n,r,u);p=(new String(f)).split(",");0<p.length?(b.density=p[0],"string"===typeof b.density&&(b.density=parseInt(b.density)),b.colorSelect=1<p.length?p[1]:"annot",2<p.length?b.tissues=p[2].split(":"):(b.tissues=["Brain"],"Rn"==organism&&(b.tissues=["Brain","BrownAdipose","Heart","Liver"]))):(b.density=3,b.colorSelect="annot",b.tissues=["Brain"],"Rn"==organism&&(b.tissues=["Brain","BrownAdipose","Heart","Liver"]));1E6<b.gsvg.xScale.domain()[1]-b.gsvg.xScale.domain()[0]&&
(b.density=1);b.tissuesAll=["Brain"];"Rn"==organism&&(b.tissuesAll=["Brain","BrownAdipose","Heart","Liver"]);b.xPadding=1;b.scanBackYLines=75;b.curColor=b.colorSelect;b.ttTrackList=[];b.ttTrackList.push("ensemblcoding");b.ttTrackList.push("braincoding");b.ttTrackList.push("liverTotal");b.ttTrackList.push("heartTotal");b.ttTrackList.push("mergedTotal");b.ttTrackList.push("ensemblnoncoding");b.ttTrackList.push("brainnoncoding");b.ttTrackList.push("repeatMask");b.color=function(a,d){var c=d3.rgb("#000000");
"annot"==b.colorSelect?c=b.colorAnnotation(a):"herit"==b.colorSelect?(c=getFirstChildByName(a,"herit").getAttribute(d),c=Math.floor(255*c),c=d3.rgb(c,0,0)):"dabg"==b.colorSelect&&(c=getFirstChildByName(a,"dabg").getAttribute(d),c=Math.floor(2.55*c),c=d3.rgb(0,c,0));return c};b.colorAnnotation=function(a){var d=d3.rgb("#000000");"core"==a.getAttribute("type")?d=d3.rgb(255,0,0):"extended"==a.getAttribute("type")?d=d3.rgb(0,0,255):"full"==a.getAttribute("type")?d=d3.rgb(0,100,0):"ambiguous"==a.getAttribute("type")&&
(d=d3.rgb(0,0,0));return d};b.pieColor=function(a,d){var c=d3.rgb("#000000"),h=new String(a.data.names);"Core"==h?c=d3.rgb(255,0,0):"Extended"==h?c=d3.rgb(0,0,255):"Full"==h?c=d3.rgb(0,100,0):"Ambiguous"==h&&(c=d3.rgb(0,0,0));return c};b.createToolTip=function(a){var d=".";1==a.getAttribute("strand")?d="+":-1==a.getAttribute("strand")&&(d="-");var c=parseInt(a.getAttribute("stop"),10)-parseInt(a.getAttribute("start"),10);d='<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>Affy Probe Set ID: '+
a.getAttribute("ID")+"<BR>Strand: "+d+"<BR>Location: "+a.getAttribute("chromosome")+":"+numberWithCommas(a.getAttribute("start"))+"-"+numberWithCommas(a.getAttribute("stop"))+" ("+c+"bp)<BR>";d=d+"Type: "+a.getAttribute("type")+"<BR><BR>";c=getFirstChildByName(a,"herit");a=getFirstChildByName(a,"dabg");d+='<table class="tooltipTable" width="100%" colSpace="0"><tr><TH>Tissue</TH><TH>Heritability</TH><TH>DABG</TH></TR>';b.tissues.length<b.tissuesAll.length&&(d+='<TR><TD colspan="3">Displayed Tissues:</TD></TR>');
for(var h={},e=0;e<b.tissues.length;e++){var g=new String(b.tissues[e]);-1<g.indexOf("Affy")&&(g=g.substr(0,g.indexOf("Affy")));h[g]=1;var l=Math.floor(255*c.getAttribute(g));l=d3.rgb(l,0,0);var m=Math.floor(2.55*a.getAttribute(g));m=d3.rgb(0,m,0);d=d+"<TR><TD>"+g+'</TD><TD style="background:'+l+';color:white;">'+c.getAttribute(g)+'</TD><TD style="background:'+m+';color:white;">'+a.getAttribute(g)+"%</TD></TR>"}if(b.tissues.length<b.tissuesAll.length)for(d+='<TR><TD colspan="3">Other Tissues:</TD></TR>',
e=0;e<b.tissuesAll.length;e++)g=new String(b.tissuesAll[e]),-1<g.indexOf("Affy")&&(g=g.substr(0,g.indexOf("Affy"))),1!=h[g]&&(l=Math.floor(255*c.getAttribute(g)),l=d3.rgb(l,0,0),m=Math.floor(2.55*a.getAttribute(g)),m=d3.rgb(0,m,0),d=d+"<TR><TD>"+g+'</TD><TD style="background:'+l+';color:white;">'+c.getAttribute(g)+'</TD><TD style="background:'+m+';color:white;">'+a.getAttribute(g)+"%</TD></TR>");return d+"</table>"};b.updateSettingsFromUI=function(){0<$("#"+b.trackClass+"Dense"+b.level+"Select").length?
b.density=$("#"+b.trackClass+"Dense"+b.level+"Select").val():b.density||(b.density=1);b.curColor=b.colorSelect;0<$("#"+b.trackClass+b.level+"colorSelect").length?b.curColor=$("#"+b.trackClass+b.level+"colorSelect").val():b.curColor||(b.curColor="annot");var a=0;if(0<$("#affyTissues"+b.level+' input[name="tissuecbx"]').length){b.tissues=[];for(var d=$("#affyTissues"+b.level+' input[name="tissuecbx"]:checked'),c=0;c<d.length;c++){var h=new String(d[c].id);h=h.substr(0,h.indexOf("Affy"));b.tissues[a]=
h;a++}}};b.savePrevious=function(){b.prevSetting={};b.prevSetting.density=b.density;b.prevSetting.curColor=b.curColor;b.prevSetting.tissues=b.tissues};b.revertPrevious=function(){b.density=b.prevSetting.density;b.curColor=b.prevSetting.curColor;b.tissues=b.prevSetting.tissues};b.calcY=function(a,d,c,h){var e=8*h+5;if(3===b.density||"3"===b.density)if(a>=b.xScale.domain()[0]&&a<=b.xScale.domain()[1]||d>=b.xScale.domain()[0]&&d<=b.xScale.domain()[1]||a<=b.xScale.domain()[0]&&d>=b.xScale.domain()[1]){a=
Math.round(b.xScale(a));0>a&&(a=0);d=Math.round(b.xScale(d));d>=b.gsvg.width&&(d=b.gsvg.width-1);c=a-b.xPadding;0>c&&(c=0);h=d+b.xPadding;h>=b.gsvg.width&&(h=b.gsvg.width-1);h+e<b.gsvg.width?(h+=e,d+=e):0<c-e&&(c-=e,a-=e);e=0;for(var g=c;g<=h;g++)b.yMaxArr[g]>e&&(e=b.yMaxArr[g]);e++;var l=e;if(b.yArr.length<=e)for(b.yArr[l]=[],g=0;g<b.gsvg.width;g++)b.yArr[l][g]=0;g=e-b.scanBackYLines;1>g&&(g=1);l=0;for(var m=g;m<e&&0==l;m++){var q=0;for(g=c;g<=h&&0==q;g++)b.yArr[m][g]>q&&(q=1);0==q&&(e=m,l=1)}e>
b.trackYMax&&(b.trackYMax=e);for(g=a;g<=d;g++)b.yMaxArr[g]<e&&(b.yMaxArr[g]=e),b.yArr[e][g]=1;a=15*e}else a=15;else a=2===b.density||"2"===b.density?15*(c+1):15;b.trackYMax<a/15&&(b.trackYMax=a/15);return a};b.redraw=function(){var a=b.tissues.length;if(b.curColor!=b.colorSelect||("herit"===b.colorSelect||"dabg"===b.colorSelect)&&a!=b.tissueLen)b.tissueLen=a,b.draw(b.data);else{b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(var d=0;d<b.gsvg.width;d++)b.yMaxArr[d]=0,b.yArr[0][d]=0;b.colorSelect=
b.curColor;b.tissueLen=a;if("dabg"==b.colorSelect||"herit"==b.colorSelect){"dabg"==b.colorSelect?b.drawScaleLegend("0%","100%","of Samples DABG","#000000","#00FF00",0):"herit"==b.colorSelect&&b.drawScaleLegend("0","1.0","Probeset Heritability","#000000","#FF0000",0);var c=1;for(a=0;a<b.tissues.length;a++){var h=new String(b.tissues[a]);b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(d=0;d<b.gsvg.width;d++)b.yMaxArr[d]=0,b.yArr[0][d]=0;c++;b.svg.select("text."+h).attr("y",15*c);b.svg.selectAll("g.probe."+
h).attr("transform",function(e,g){var l=b.gsvg.xScale(e.getAttribute("start")),m=b.calcY(parseInt(e.getAttribute("start"),10),parseInt(e.getAttribute("stop"),10),g,e.getAttribute("ID").length)+15*c-10;return"translate("+l+","+m+")"}).each(function(e){var g=d3.select(this),l=1;1<b.gsvg.xScale(e.getAttribute("stop"))-b.gsvg.xScale(e.getAttribute("start"))&&(l=b.gsvg.xScale(e.getAttribute("stop"))-b.gsvg.xScale(e.getAttribute("start")));g.selectAll("rect").attr("width",l).attr("fill",b.color(e,h));var m=
">";"-1"==e.getAttribute("strand")&&(m="<");var q="";if(7.5<=l&&15>=l)q=m;else if(15<l)for(l-=7.5;7.5<l;)q+=m,l-=7.5;g.select("text#strand").text(q);if(2==b.density||3==b.density){var t=e.getAttribute("ID");0===g.select("text#lblTxt").size()?g.append("svg:text").attr("dx",function(){var v=b.xScale(e.getAttribute("stop"))+8*t.length+5,y=b.xScale(e.getAttribute("stop"))-b.xScale(e.getAttribute("start"))+5;v>b.gsvg.width&&(y=-8*t.length);return y}).attr("dy",10).attr("id","lblTxt").text(t):g.select("text#lblTxt").attr("dx",
function(){var v=b.xScale(e.getAttribute("stop"))+8*t.length+5,y=b.xScale(e.getAttribute("stop"))-b.xScale(e.getAttribute("start"))+5;v>b.gsvg.width&&(y=-8*t.length);return y})}else g.selectAll("text#lblTxt").remove()});c+=b.trackYMax}b.trackYMax=15*c;b.svg.attr("height",b.trackYMax)}else if("annot"===b.colorSelect){b.drawLegend([{color:"#FF0000",label:"Core"},{color:"#0000FF",label:"Extended"},{color:"#006400",label:"Full"},{color:"#000000",label:"Ambiguous"}]);b.trackYMax=0;b.yMaxArr=[];b.yArr=
[];b.yArr[0]=[];for(d=0;d<b.gsvg.width;d++)b.yMaxArr[d]=0,b.yArr[0][d]=0;b.svg.selectAll("g.probe").attr("transform",function(e,g){return"translate("+b.xScale(e.getAttribute("start"))+","+b.calcY(parseInt(e.getAttribute("start"),10),parseInt(e.getAttribute("stop"),10),g,e.getAttribute("ID").length)+")"});b.svg.selectAll("g.probe rect").attr("width",function(e){var g=1;1<b.xScale(e.getAttribute("stop"))-b.xScale(e.getAttribute("start"))&&(g=b.xScale(e.getAttribute("stop"))-b.xScale(e.getAttribute("start")));
return g}).attr("fill",function(e){return b.color(e,"")});b.svg.selectAll("g.probe").each(function(e){var g=d3.select(this),l=">";"-1"==e.getAttribute("strand")&&(l="<");var m="",q=g.select("rect").attr("width");if(7.5<=q&&15>=q)m=l;else if(15<q)for(q-=7.5;7.5<q;)m+=l,q-=7.5;g.select("text").text(m);if(2==b.density||3==b.density){var t=e.getAttribute("ID");0===g.select("text#lblTxt").size()?g.append("svg:text").attr("dx",function(){var v=b.xScale(e.getAttribute("stop"))+8*t.length+5,y=b.xScale(e.getAttribute("stop"))-
b.xScale(e.getAttribute("start"))+5;v>b.gsvg.width&&(y=-8*t.length);return y}).attr("dy",10).attr("id","lblTxt").text(t):g.select("text#lblTxt").attr("dx",function(){var v=b.xScale(e.getAttribute("stop"))+8*t.length+5,y=b.xScale(e.getAttribute("stop"))-b.xScale(e.getAttribute("start"))+5;v>b.gsvg.width&&(y=-8*t.length);return y})}else g.selectAll("text#lblTxt").remove()});1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(b.trackYMax+1)):3==b.density&&b.svg.attr("height",15*
(b.trackYMax+1))}}b.redrawSelectedArea()};b.update=function(a){b.redraw()};b.updateData=function(a){d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/probe.xml",function(d,c){if(d)if(3>a){var h=5E3;1==a&&(h=1E4);setTimeout(function(){b.updateData(a+1)},h)}else 3<=a&&(d3.select("#Level"+b.levelNumber+b.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+b.trackClass),d3.select("#Level"+b.levelNumber+b.trackClass).attr("height",15),b.gsvg.addTrackErrorRemove(b.svg,
"#Level"+b.gsvg.levelNumber+b.trackClass));else{if(c){h=c.documentElement.getElementsByTagName("probe");for(var e=[],g=[],l=0,m=0;m<b.data.length;m++)"undefined"!==typeof b.data[m]&&(e[l]=b.data[m],g[b.data[m].getAttribute("ID")]=1,l++);for(m=0;m<h.length;m++)"undefined"!==typeof h[m]&&"undefined"===typeof g[h[m].getAttribute("ID")]&&(e[l]=h[m],l++);b.draw(e)}b.hideLoading()}})};b.draw=function(a){b.data=a;b.colorSelect=b.curColor;b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(var d=0;d<b.gsvg.width;d++)b.yMaxArr[d]=
0,b.yArr[0][d]=0;if("dabg"==b.colorSelect||"herit"==b.colorSelect){"dabg"==b.colorSelect?b.drawScaleLegend("0%","100%","of Samples DABG","#000000","#00FF00",0):"herit"==b.colorSelect&&b.drawScaleLegend("0","1.0","Probeset Heritability","#000000","#FF0000",0);b.svg.selectAll(".probe").remove();b.svg.selectAll(".tissueLbl").remove();b.tissueLen=b.tissues.length;for(var c=1,h=0;h<b.tissues.length;h++){var e=new String(b.tissues[h]);0<e.indexOf(";")&&(e=e.substr(0,e.indexOf(";")));0<e.indexOf(":")&&(e=
e.substr(0,e.indexOf(":")));b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(d=0;d<b.gsvg.width;d++)b.yMaxArr[d]=0,b.yArr[0][d]=0;d=e;"BrownAdipose"==d?d="Brown Adipose":"Brain"==d&&(d="Whole Brain");d=new String("Tissue: "+d);c++;b.svg.append("text").attr("class","tissueLbl "+e).attr("x",b.gsvg.width/2-d.length/2*7.5).attr("y",15*c).text(d);0<a.length&&(d=b.svg.selectAll(".probe."+e).data(a,function(g){return keyTissue(g,e)}).attr("transform",function(g,l){return"translate("+b.xScale(g.getAttribute("start"))+
","+(b.calcY(parseInt(g.getAttribute("start"),10),parseInt(g.getAttribute("stop"),10),l,g.getAttribute("ID").length)+15*c-10)+")"}),d.enter().append("g").attr("class","probe "+e).attr("transform",function(g,l){return"translate("+b.xScale(g.getAttribute("start"))+","+(b.calcY(parseInt(g.getAttribute("start"),10),parseInt(g.getAttribute("stop"),10),l,g.getAttribute("ID").length)+15*c-10)+")"}).append("rect").attr("height",10).attr("rx",1).attr("ry",1).attr("width",function(g){var l=1;1<b.xScale(g.getAttribute("stop"))-
b.xScale(g.getAttribute("start"))&&(l=b.xScale(g.getAttribute("stop"))-b.xScale(g.getAttribute("start")));return l}).attr("id",function(g){return g.getAttribute("ID")+e}).style("fill",function(g){return b.color(g,e)}).style("cursor","pointer").on("dblclick",b.zoomToFeature).on("mouseover",function(g){if(0==b.gsvg.isToolTip){overSelectable=1;$("#mouseHelp").html("<B>Double Click</B> to zoom in on this feature.");var l=d3.select(this);b.curTTColor=l.style("fill");0<l.style("opacity")&&(l.style("fill",
"green"),tt.transition().duration(200).style("opacity",1),tt.html(b.createToolTip(g)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)}),b.setupToolTipSVG(g,.2))}}).on("mouseout",function(g){overSelectable=0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");g=d3.select(this);0<g.style("opacity")&&(g.style("fill",b.curTTColor),tt.transition().delay(500).duration(200).style("opacity",
0))}),b.svg.selectAll("g.probe."+e).each(function(g){var l=d3.select(this),m=">";"-1"==g.getAttribute("strand")&&(m="<");var q=m,t=l.select("rect").attr("width");if(7.5>t)q="";else for(t-=7.5;8.5<t;)q+=m,t-=7.5;l.append("svg:text").attr("dx","1").attr("id","strand").attr("dy","10").style("pointer-events","none").style("fill","white").text(q);if(2==b.density||3==b.density){var v=g.getAttribute("ID");l.append("svg:text").attr("dx",function(){var y=b.xScale(g.getAttribute("stop"))+8*v.length+5,w=b.xScale(g.getAttribute("stop"))-
b.xScale(g.getAttribute("start"))+5;y>b.gsvg.width&&(w=-8*v.length);return w}).attr("dy",10).attr("id","lblTxt").text(v)}else l.selectAll("text#lblTxt").remove()}),c=c+b.trackYMax+1)}b.trackYMax=c;b.svg.attr("height",15*c+45)}else if("annot"==b.colorSelect){b.drawLegend([{color:"#FF0000",label:"Core"},{color:"#0000FF",label:"Extended"},{color:"#006400",label:"Full"},{color:"#000000",label:"Ambiguous"}]);b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(d=0;d<b.gsvg.width;d++)b.yMaxArr[d]=0,b.yArr[0][d]=
0;b.svg.selectAll(".probe").remove();b.svg.selectAll(".tissueLbl").remove();d=b.svg.selectAll(".probe.annot").data(a,key).attr("transform",function(g,l){return"translate("+b.xScale(g.getAttribute("start"))+","+b.calcY(parseInt(g.getAttribute("start"),10),parseInt(g.getAttribute("stop"),10),l,g.getAttribute("ID").length)+")"});d.enter().append("g").attr("class","probe annot").attr("transform",function(g,l){return"translate("+b.xScale(g.getAttribute("start"))+","+b.calcY(parseInt(g.getAttribute("start"),
10),parseInt(g.getAttribute("stop"),10),l,g.getAttribute("ID").length)+")"}).append("rect").attr("height",10).attr("rx",1).attr("ry",1).attr("width",function(g){var l=1;1<b.xScale(g.getAttribute("stop"))-b.xScale(g.getAttribute("start"))&&(l=b.xScale(g.getAttribute("stop"))-b.xScale(g.getAttribute("start")));return l}).attr("id",function(g){return g.getAttribute("ID")}).style("fill",function(g){return b.color(g,"")}).style("cursor","pointer").on("dblclick",b.zoomToFeature).on("mouseover",function(g){if(0==
b.gsvg.isToolTip){overSelectable=1;$("#mouseHelp").html("<B>Double Click</B> to zoom in on this feature.");var l=d3.select(this);0<l.style("opacity")&&(l.style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(b.createToolTip(g)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)}),b.setupToolTipSVG(g,.2))}}).on("mouseout",function(g){overSelectable=0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");
g=d3.select(this);0<g.style("opacity")&&(g.style("fill",b.color),tt.transition().delay(500).duration(200).style("opacity",0))});b.svg.selectAll("g.probe").each(function(g){var l=d3.select(this),m=">";"-1"==g.getAttribute("strand")&&(m="<");var q=m,t=l.select("rect").attr("width");if(7.5>t)q="";else for(t-=7.5;15<t;)q+=m,t-=7.5;l.append("svg:text").attr("dx","1").attr("dy","10").style("pointer-events","none").style("fill","white").text(q);if(2==b.density||3==b.density){var v=g.getAttribute("ID");l.append("svg:text").attr("dx",
function(){var y=b.xScale(g.getAttribute("stop"))+8*v.length+5,w=b.xScale(g.getAttribute("stop"))-b.xScale(g.getAttribute("start"))+5;y>b.gsvg.width&&(w=-8*v.length);return w}).attr("dy",10).attr("id","lblTxt").text(v)}else l.select("text#lblTxt").remove()});1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(b.trackYMax+1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1))}b.redrawSelectedArea()};b.getDisplayedData=function(){var a=d3.select("#Level"+b.gsvg.levelNumber+
b.trackClass).selectAll("g.probe");b.counts=[{value:0,names:"Core"},{value:0,names:"Extended"},{value:0,names:"Full"},{value:0,names:"Ambiguous"}];var d=[],c=0;a.each(function(h){var e=b.xScale(h.getAttribute("start")),g=b.xScale(h.getAttribute("stop"));if(0<=e&&e<=b.gsvg.width||0<=g&&g<=b.gsvg.width)"core"==h.getAttribute("type")?b.counts[0].value++:"extended"==h.getAttribute("type")?b.counts[1].value++:"full"==h.getAttribute("type")?b.counts[2].value++:"ambiguous"==h.getAttribute("type")&&b.counts[3].value++,
d[c]=h,c++});0===a.size()&&(b.counts=[]);return d};b.generateSettingsDiv=function(a){var d=trackInfo[b.trackClass];b.savePrevious();d3.select(a).select("table").select("tbody").html("");if("undefined"!==typeof d&&"undefined"!==typeof d.Controls&&"null"!=d.Controls&&0<d.Controls.length){var c=(new String(d.Controls)).split(",");a=d3.select(a).select("table").select("tbody");a.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+d.Name);for(d=0;d<c.length;d++)if("undefined"!==
typeof c[d]&&""!=c[d]){var h=c[d].split(";"),e=a.append("tr").append("td"),g=h[0].substr(5);3<h.length&&0==h[3].indexOf("Default=")&&h[3].substr(8);if(0==h[1].toLowerCase().indexOf("select")){e.append("text").text(g+": ");g=h[1].split(":");h=h[2].split("}");var l=b.trackClass+"Dense"+b.level+"Select";"colorSelect"==g[1]&&(l=b.trackClass+b.level+"colorSelect");for(var m=e.append("select").attr("id",l).attr("name",g[1]),q=0;q<h.length;q++){var t=h[q].substr(1).split(":");2==t.length&&(e=m.append("option").attr("value",
t[1]).text(t[0]),"colorSelect"==g[1]&&t[1]==b.curColor?e.attr("selected","selected"):t[1]==b.density&&e.attr("selected","selected"))}d3.select("select#"+l).on("change",function(){"dabg"==$(this).val()||"herit"==$(this).val()?$("div#affyTissues"+b.level).show():$("div#affyTissues"+b.level).hide();b.updateSettingsFromUI();b.redraw()})}else if(0==h[1].toLowerCase().indexOf("cbx"))for(e=e.append("div").attr("id","affyTissues"+b.level).style("display","none"),e.append("text").text(g+": "),g=h[1].split(":"),
h=h[2].split("}"),q=0;q<h.length;q++)t=h[q].substr(1).split(":"),2==t.length&&(l=e.append("div").style("display","inline-block"),m=l.append("input").attr("type","checkbox").attr("id",t[1]+"CBX"+b.level).attr("name",g[1]).style("margin-left","5px"),l.append("text").text(t[0]),d3.select("input#"+t[1]+"CBX"+b.level).on("change",function(){b.updateSettingsFromUI();b.redraw()}))}"dabg"==b.curColor||"herit"==b.curColor?$("div#affyTissues"+b.level).show():$("div#affyTissues"+b.level).hide();for(c=0;c<b.tissues.length;c++)$("#"+
b.tissues[c]+"AffyCBX"+b.level).prop("checked",!0);c=a.append("tr").append("td");c.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");b.gsvg.removeTrack(b.trackClass);var v=svgList[b.gsvg.levelNumber].currentView.ViewID,y=viewMenu[b.gsvg.levelNumber].findTrackByClass(b.trackClass,v);y=viewMenu[b.gsvg.levelNumber].findTrackIndexWithViewID(y.TrackID,v);viewMenu[b.gsvg.levelNumber].removeTrackWithIDIdx(y,
v)});c.append("input").attr("type","button").attr("value","Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");b.density==b.prevSetting.density&&b.curColor==b.prevSetting.curColor&&b.tissues==b.prevSetting.tissues||b.gsvg.setCurrentViewModified()});c.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){b.revertPrevious();b.draw(b.data);$("#trackSettingDialog").fadeOut("fast")})}else a=
d3.select(a).select("table").select("tbody"),a.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+d.Name),a.append("tr").append("td").html("Sorry no settings for this track."),c=a.append("tr").append("td"),c.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")}),c.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left",
"5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")})};b.generateTrackSettingString=function(){for(var a="",d=0;d<b.tissues.length;d++)0<d&&(a+=":"),a+=b.tissues[d];return b.trackClass+","+b.density+","+b.curColor+","+a+";"};b.draw(n);return b}
function SNPTrack(p,n,r,u,f){var b=Track(p,n,r,a);p=(new String(r)).substr(3);f=(new String(f)).split(",");b.include=0<f.length?f[0]:4;b.density=u;var a=p;"SHRH"==a?a="SHR/OlaPrin":"BNLX"==a?a="BN-Lx/CubPrin":"SHRJ"==a&&(a="SHR/NCrlPrin");b.displayStrain=a;1==b.include?a+=" SNPs":2==b.include?a+=" Insertions":3==b.include?a+=" Deletions":4==b.include&&(a+=" SNPs/Indels");b.counts=[{value:0,perc:0,names:"SNP "+b.displayStrain},{value:0,perc:0,names:"Insertion "+b.displayStrain},{value:0,perc:0,names:"Deletion "+
b.displayStrain}];b.strain=p;b.ttTrackList=[];b.ttTrackList.push("ensemblcoding");b.ttTrackList.push("braincoding");b.ttTrackList.push("liverTotal");b.ttTrackList.push("heartTotal");b.ttTrackList.push("mergedTotal");b.ttTrackList.push("refSeq");b.ttTrackList.push("ensemblnoncoding");b.ttTrackList.push("brainnoncoding");b.ttTrackList.push("ensemblsmallnc");b.ttTrackList.push("brainsmallnc");b.ttTrackList.push("probe");b.ttTrackList.push("repeatMask");b.xPadding=1;b.scanBackYLines=50;b.updateSettingsFromUI=
function(){0<$("#"+b.trackClass+"Dense"+b.level+"Select").length&&(b.density=$("#"+b.trackClass+"Dense"+b.level+"Select").val());0<$("#"+b.trackClass+b.level+"Select").length&&(b.include=$("#"+b.trackClass+b.level+"Select").val())};b.savePrevious=function(){b.prevSetting={};b.prevSetting.density=b.density;b.prevSetting.include=b.include};b.revertPrevious=function(){b.density=b.prevSetting.density;b.include=b.prevSetting.include};b.generateTrackSettingString=function(){return b.trackClass+","+b.density+
","+b.include+";"};b.generateSettingsDiv=function(d){var c=trackInfo[b.trackClass];b.savePrevious();d3.select(d).select("table").select("tbody").html("");if(0<c.Controls.length&&"null"!=c.Controls){var h=(new String(c.Controls)).split(",");d=d3.select(d).select("table").select("tbody");d.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name);for(c=0;c<h.length;c++)if("undefined"!==typeof h[c]&&""!=h[c]){var e=h[c].split(";"),g=d.append("tr").append("td"),l=e[0].substr(5);
g.append("text").text(l+": ");3<e.length&&0==e[3].indexOf("Default=")&&e[3].substr(8);if(0==e[1].toLowerCase().indexOf("select")){var m=e[1].split(":");e=e[2].split("}");var q=l="";2<m.length&&(l=m[2]);3<m.length&&(q=m[3]);g=g.append("select").attr("id",b.trackClass+l+b.level+q).attr("name",m[1]);for(m=0;m<e.length;m++){var t=e[m].substr(1).split(":");if(2==t.length){var v=g.append("option").attr("value",t[1]).text(t[0]);("Dense"==l&&t[1]==b.density||""==l&&t[1]==b.include)&&v.attr("selected","selected")}}d3.select("#"+
b.trackClass+l+b.level+q).on("change",function(){b.updateSettingsFromUI();b.updateData()})}else console.log("Undefined track settings:  "+h[c])}h=d.append("tr").append("td");h.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");b.gsvg.removeTrack(b.trackClass);var y=svgList[b.gsvg.levelNumber].currentView.ViewID,w=viewMenu[b.gsvg.levelNumber].findTrackByClass(b.trackClass,
y);w=viewMenu[b.gsvg.levelNumber].findTrackIndexWithViewID(w.TrackID,y);viewMenu[b.gsvg.levelNumber].removeTrackWithIDIdx(w,y)});h.append("input").attr("type","button").attr("value","Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");b.density==b.prevSetting.density&&b.include==b.prevSetting.include||b.gsvg.setCurrentViewModified()});h.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left",
"5px").on("click",function(){b.revertPrevious();b.draw(b.data);$("#trackSettingDialog").fadeOut("fast")})}else d=d3.select(d).select("table").select("tbody"),d.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name),d.append("tr").append("td").html("Sorry no settings for this track."),h=d.append("tr").append("td"),h.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")}),
h.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")})};b.redraw=function(){b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(var d=0;d<b.gsvg.width;d++)b.yMaxArr[d]=0,b.yArr[0][d]=0;b.svg.selectAll("g.snp").attr("transform",function(c,h){return"translate("+b.xScale(c.getAttribute("start"))+","+b.calcY(parseInt(c.getAttribute("start"),10),parseInt(c.getAttribute("stop"),10),
h)+")"});b.svg.selectAll("g.snp rect").attr("width",function(c){var h=1;1<b.xScale(c.getAttribute("stop"))-b.xScale(c.getAttribute("start"))&&(h=b.xScale(c.getAttribute("stop"))-b.xScale(c.getAttribute("start")));return h});6<b.xScale(b.xScale.domain()[0]+1)?b.svg.selectAll(".snp").each(function(c){var h=b.xScale(c.getAttribute("stop"))-b.xScale(c.getAttribute("start")),e=new String(c.getAttribute("strainSeq")),g="8px",l=3.2,m=8;"SNP"!=c.getAttribute("type")&&(g="7px",l=3,m=7);0==d3.select(this).selectAll("text").size()&&
e.length*l<h?d3.select(this).append("text").attr("y",m).attr("x",function(q){q=0;7<h&&(q=h/2-e.length/2*l);return q}).attr("font-size",g).attr("stroke",d3.rgb("#FFFFFF")).attr("class","snpLbl").text(e):d3.select(this).selectAll(".snpLbl").attr("x",function(q){q=0;7<h&&(q=h/2-e.length/2*l);return q})}):b.svg.selectAll("text.snpLbl").remove();1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(b.trackYMax+1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1));b.redrawSelectedArea()};
b.color=function(d){d3.rgb("#000000");return"SNP"===d.getAttribute("type")?"BNLX"===d.getAttribute("strain")?d3.rgb(0,0,255):"SHRH"===d.getAttribute("strain")?d3.rgb(255,0,0):"SHRJ"===d.getAttribute("strain")?d3.rgb("#00FF00"):"F344"===d.getAttribute("strain")?d3.rgb("#00FFFF"):d3.rgb(100,100,100):"BNLX"===d.getAttribute("strain")?d3.rgb(0,0,150):"SHRH"===d.getAttribute("strain")?d3.rgb(150,0,0):"SHRJ"===d.getAttribute("strain")?d3.rgb("#009600"):"F344"===d.getAttribute("strain")?d3.rgb("#009696"):
d3.rgb(50,50,50)};b.getDisplayID=function(d){return d.getAttribute("type")+"_"+keySNP(d)};b.createToolTip=function(d){var c=d.getAttribute("strain");"SHRH"==c&&(c="SHR");c='<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>Type: '+d.getAttribute("type")+"<BR>Strain: "+c+"<BR>Sequence: "+d.getAttribute("refSeq")+"->"+d.getAttribute("strainSeq")+"<BR>Location: chr"+d.getAttribute("chromosome")+":"+numberWithCommas(d.getAttribute("start"));"SNP"!=d.getAttribute("type")&&(c=c+"-"+numberWithCommas(d.getAttribute("stop")));
return c};b.update=function(d){b.redraw()};b.updateData=function(d){d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/snp"+b.strain+".xml",function(c,h){if(c)if(3>d){var e=1E4;1==d&&(e=15E3);setTimeout(function(){b.updateData(d+1)},e)}else 3<=d&&(d3.select("#Level"+b.levelNumber+b.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+b.trackClass),d3.select("#Level"+b.levelNumber+b.trackClass).attr("height",15),b.gsvg.addTrackErrorRemove(b.svg,
"#Level"+b.gsvg.levelNumber+b.trackClass));else{e=h.documentElement.getElementsByTagName("Snp");for(var g=[],l=[],m=0,q=0;q<e.length;q++)"undefined"!==typeof e[q]&&(g[m]=e[q],l[keySNP(e[q])]=1,m++);for(q=0;q<b.data.length;q++)"undefined"!==typeof b.data[q]&&"undefined"===typeof l[keySNP(b.data[q])]&&(g[m]=b.data[q],m++);b.draw(g);b.hideLoading()}})};b.getDisplayedData=function(){var d=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".snp");b.counts=[{value:0,perc:0,names:"SNP"},{value:0,
perc:0,names:"Insertion"},{value:0,perc:0,names:"Deletion"}];var c=[],h=0,e=0;d.each(function(g){var l=b.xScale(g.getAttribute("start")),m=b.xScale(g.getAttribute("stop"));if(0<=l&&l<=b.gsvg.width||0<=m&&m<=b.gsvg.width)l=0,"Insertion"==g.getAttribute("type")?l++:"Deletion"==g.getAttribute("type")&&(l+=2),b.counts[l].value++,c[h]=g,h++,e++});return c};b.draw=function(d){b.data=d;b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(var c=0;c<b.gsvg.width;c++)b.yMaxArr[c]=0,b.yArr[0][c]=0;c=b.strain;
"SHRH"==c?c="SHR/OlaPrin":"BNLX"==c?c="BN-Lx/CubPrin":"SHRJ"==c&&(c="SHR/NCrlPrin");1==b.include?c+=" SNPs":2==b.include?c+=" Insertions":3==b.include?c+=" Deletions":4==b.include&&(c+=" SNPs/Indels");b.updateLabel(c);b.redrawLegend();if(4>b.include){c=[];for(var h=0,e=0;e<d.length;e++)"undefined"!==typeof d[e]&&(1==b.include&&"SNP"==d[e].getAttribute("type")?(c[h]=d[e],h++):2==b.include&&"Insertion"==d[e].getAttribute("type")?(c[h]=d[e],h++):3==b.include&&"Deletion"==d[e].getAttribute("type")&&(c[h]=
d[e],h++));b.data=c}b.svg.selectAll(".snp").remove();0<b.data.length&&(d=b.svg.selectAll(".snp").data(d,keySNP).attr("transform",function(g,l){return"translate("+b.xScale(g.getAttribute("start"))+","+b.calcY(parseInt(g.getAttribute("start"),10),parseInt(g.getAttribute("stop"),10),l)+")"}),d.enter().append("g").attr("class","snp").attr("transform",function(g,l){return"translate("+b.xScale(g.getAttribute("start"))+","+b.calcY(parseInt(g.getAttribute("start"),10),parseInt(g.getAttribute("stop"),10),
l)+")"}).append("rect").attr("height",10).attr("rx",1).attr("ry",1).attr("width",function(g){var l=1;1<b.xScale(g.getAttribute("stop"))-b.xScale(g.getAttribute("start"))&&(l=b.xScale(g.getAttribute("stop"))-b.xScale(g.getAttribute("start")));return l}).attr("id",keySNP).style("fill",b.color).on("mouseover",function(g){0==b.gsvg.isToolTip&&(d3.select(this).style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(b.createToolTip(g)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",
function(){return b.positionTTTop(d3.event.pageY)}),b.setupToolTipSVG(g,.2))}).on("mouseout",function(g){d3.select(this).style("fill",b.color);tt.transition().delay(500).duration(200).style("opacity",0)}),1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(b.trackYMax+1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1)),d.merge(d),d.exit().remove());b.redrawSelectedArea()};b.pieColor=function(d,c){var h=d3.rgb("#000000"),e=new String(d.data.names);"BNLX"==b.strain?h=-1<
e.indexOf("SNP")?d3.rgb(0,0,255):-1<e.indexOf("Insertion")?d3.rgb(0,0,175):d3.rgb(0,0,125):"SHRJ"==b.strain?h=-1<e.indexOf("SNP")?d3.rgb(0,255,0):-1<e.indexOf("Insertion")?d3.rgb(0,175,0):d3.rgb(0,125,0):"F344"==b.strain?h=-1<e.indexOf("SNP")?d3.rgb(0,255,255):-1<e.indexOf("Insertion")?d3.rgb(0,175,175):d3.rgb(0,125,125):"SHRH"==b.strain&&(h=-1<e.indexOf("SNP")?d3.rgb(255,0,0):-1<e.indexOf("Insertion")?d3.rgb(175,0,0):d3.rgb(125,0,0));return h};b.redrawLegend=function(){var d=[];4==b.include?d="BNLX"==
b.strain?[{color:"#0000FF",label:"SNP"},{color:"#000096",label:"Insertion/Deletion"}]:"SHRH"==b.strain?[{color:"#FF0000",label:"SNP"},{color:"#960000",label:"Insertion/Deletion"}]:"SHRJ"==b.strain?[{color:"#00FF00",label:"SNP"},{color:"#009600",label:"Insertion/Deletion"}]:"F344"==b.strain?[{color:"#00FFFF",label:"SNP"},{color:"#009696",label:"Insertion/Deletion"}]:[{color:"#DEDEDE",label:"SNP"},{color:"#969696",label:"Insertion/Deletion"}]:3==b.include||2==b.include?d="BNLX"==b.strain?[{color:"#000096",
label:"Insertion/Deletion"}]:"SHRH"==b.strain?[{color:"#960000",label:"Insertion/Deletion"}]:"SHRJ"==b.strain?[{color:"#009600",label:"Insertion/Deletion"}]:"F344"==b.strain?[{color:"#009696",label:"Insertion/Deletion"}]:[{color:"#969696",label:"Insertion/Deletion"}]:1==b.include&&(d="BNLX"==b.strain?[{color:"#0000FF",label:"SNP"}]:"SHRH"==b.strain?[{color:"#FF0000",label:"SNP"}]:"SHRJ"==b.strain?[{color:"#00FF00",label:"SNP"}]:"F344"==b.strain?[{color:"#00FFFF",label:"SNP"}]:[{color:"#DEDEDE",label:"SNP"}]);
b.drawLegend(d)};b.strain=p;b.redrawLegend();b.draw(n);return b}
function QTLTrack(p,n,r,u){var f=Track(p,n,r,"QTLs Overlapping Region");f.color=function(b){return f.pieColorPalette(b)};f.redraw=function(){f.yCount=0;f.idList=[];f.svg.selectAll("g.qtl").attr("transform",function(b,a){return"translate("+f.xScale(b.getAttribute("start"))+","+f.calcY(b,a)+")"});d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll("g.qtl rect").attr("width",function(b){var a=1;1<f.xScale(b.getAttribute("stop"))-f.xScale(b.getAttribute("start"))&&(a=f.xScale(b.getAttribute("stop"))-
f.xScale(b.getAttribute("start")));return a});f.svg.attr("height",15*f.yCount);f.redrawSelectedArea()};f.createToolTip=function(b){return"Name: "+b.getAttribute("name")+"<BR>Location: "+b.getAttribute("chromosome")+":"+numberWithCommas(b.getAttribute("start"))+"-"+numberWithCommas(b.getAttribute("stop"))+"<BR>Trait:<BR>"+b.getAttribute("trait")+"<BR><BR>Phenotype:<BR>"+b.getAttribute("phenotype")+"<BR><BR>Candidate Genes:<BR>"+b.getAttribute("candidate")};f.pieColorPalette=d3.scaleOrdinal(d3.schemeCategory20);
f.pieColor=function(b){return f.pieColorPalette(b.data.names)};f.triggerTableFilter=function(b){var a=jQuery.Event("keyup");a.which=32;var d="";"undefined"===typeof b.getAttribute||"undefined"===typeof b.getAttribute("ID")?"undefined"!==typeof b.data&&"undefined"!==typeof b.data.names&&(d=b.data.names):d=b.getAttribute("ID");$("#tblBQTL_filter input").val(d).trigger(a)};f.clearTableFilter=function(b){b=jQuery.Event("keyup");b.which=32;$("#tblBQTL_filter input").val("").trigger(b)};f.getDisplayedData=
function(){var b=d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll(".qtl");f.counts=[];var a=0,d=b.data();console.log(b);console.log(d);b=[];var c=0,h=0;if("undefined"!==typeof d)for(var e=0;e<d.length;e++){var g=f.xScale(d[e].getAttribute("start")),l=f.xScale(d[e].getAttribute("stop"));if(0<=g&&g<=f.gsvg.width||0<=l&&l<=f.gsvg.width||0>=g&&l>=f.gsvg.width)g=new String(d[e].getAttribute("name")),l=/[0-9]+\s*$/g,l=g.search(l),-1<l&&(g=g.substr(0,l)),l=/QTL\s*$/g,l=g.search(l),-1<l&&(g=
g.substr(0,l)),l=/traits+\s*$/g,l=g.search(l),-1<l&&(g=g.substr(0,l+5)),"undefined"===typeof f.counts[g]?(f.counts[g]={},f.counts[a]=f.counts[g],a++,f.counts[g].value=1,f.counts[g].names=g):f.counts[g].value++,b[c]=d[e],c++,h++}return b};f.setupDetailedView=function(b){$("div#collapsableReport").is(":hidden")||($("div#collapsableReport").hide(),$("span[name='collapsableReport']").removeClass("less"));$("div#selectedDetailHeader").is(":hidden")&&$("div#selectedDetailHeader").show();$("div#selectedDetail").is(":hidden")&&
$("div#selectedDetail").show();$("div#selectedImage").hide();$("div#selectedReport").show();var a=pathPrefix+"bQTLReport.jsp";b={id:b.getAttribute("ID"),species:organism,genomeVer:genomeVer};DisplaySelectedDetailReport(a,b)};f.updateData=function(b){d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+f.gsvg.folderName+"/qtl.xml",function(a,d){if(a)if(3>b){var c=1E4;1==b&&(c=15E3);setTimeout(function(){f.updateData(b+1)},c)}else d3.select("#Level"+f.levelNumber+f.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+
f.trackClass),d3.select("#Level"+f.levelNumber+f.trackClass).attr("height",15),f.gsvg.addTrackErrorRemove(f.svg,"#Level"+f.gsvg.levelNumber+f.trackClass);else{if(d){c=d.documentElement.getElementsByTagName("QTL");for(var h=[],e=[],g=0,l=0;l<c.length;l++)"undefined"!==typeof c[l]&&(h[g]=c[l],e[c[l].getAttribute("ID")]=1,g++);for(l=0;l<f.data.length;l++)"undefined"!==typeof f.data[l]&&"undefined"===typeof e[f.data[l].getAttribute("ID")]&&(h[g]=f.data[l],g++);f.draw(h)}f.hideLoading()}})};f.calcY=function(b,
a){var d=0;"undefined"===typeof f.idList[b.getAttribute("ID")]&&(d=f.yCount++);return 15*(d+1)};f.draw=function(b){f.data=b;f.yCount=0;f.idList=[];f.data&&0<f.data.length?(console.log(f.svg),console.log(f.svg.selectAll(".qtl")),b=f.svg.selectAll(".qtl").data(b,key),console.log(b),b.enter().append("g").attr("class","qtl").attr("transform",function(a,d){return"translate("+f.xScale(a.getAttribute("start"))+","+f.calcY(a,d)+")"}).append("rect").attr("height",10).attr("rx",1).attr("ry",1).attr("width",
function(a){var d=1;1<f.xScale(a.getAttribute("stop"))-f.xScale(a.getAttribute("start"))&&(d=f.xScale(a.getAttribute("stop"))-f.xScale(a.getAttribute("start")));return d}).attr("id",function(a){return a.getAttribute("id")}).style("fill","blue").style("cursor","pointer").on("click",f.setupDetailedView).on("mouseover",function(a){0==f.gsvg.isToolTip&&(overSelectable=1,$("#mouseHelp").html("<B>Click</B> to see additional details. <B>Double Click</B> to zoom in on this feature."),d3.select(this).style("fill",
"green"),tt.transition().duration(200).style("opacity",1),tt.html(f.createToolTip(a)).style("left",function(){return f.positionTTLeft(d3.event.pageX)}).style("top",function(){return f.positionTTTop(d3.event.pageY)}),f.triggerTableFilter(a))}).on("mouseout",function(a){overSelectable=0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");var d=a.getAttribute("name"),c=/[0-9]+\s*$/g;c=d.search(c);-1<c&&(d=d.substr(0,c));c=/QTL\s*$/g;c=d.search(c);-1<c&&
(d=d.substr(0,c));c=/traits?\s*$/g;c=d.search(c);-1<c&&(d=d.substr(0,c+5));d3.select(this).style("fill",f.color(d));tt.transition().delay(500).duration(200).style("opacity",0);f.clearTableFilter(a)}).merge(b),b.exit().remove(),"undefined"!==typeof b[0]&&b[0].forEach(function(a){if("undefined"!==typeof a){var d=new String(a.data().getAttribute("name")),c=/[0-9]+\s*$/g;c=d.search(c);-1<c&&(d=d.substr(0,c));c=/QTL\s*$/g;c=d.search(c);-1<c&&(d=d.substr(0,c));c=/traits?\s*$/g;c=d.search(c);-1<c&&(d=d.substr(0,
c+5));d3.select(a).select("rect").style("fill",f.color(d))}}),f.svg.attr("height",15*f.yCount)):f.svg.attr("height",15);f.redrawSelectedArea()};f.draw(n);f.redraw();return f}
function TranscriptTrack(p,n,r,u){var f=Track(p,n,r,"Selected Gene Transcripts");f.createToolTip=function(b){var a=".";1==b.getAttribute("strand")?a="+":-1==b.getAttribute("strand")&&(a="-");a="ID: "+b.getAttribute("ID")+"<BR>Location: chr"+b.getAttribute("chromosome")+":"+numberWithCommas(b.getAttribute("start"))+"-"+numberWithCommas(b.getAttribute("stop"))+"<BR>Strand: "+a;-1==(new String(b.getAttribute("ID"))).indexOf("ENS")&&(b=getFirstChildByName(getFirstChildByName(b,"annotationList"),"annotation"),
null!=b&&(a+="<BR>Matching: "+b.getAttribute("reason")));return a};f.color=function(b){var a=d3.rgb("#000000");"protein"==f.gsvg.txType?a=-1<(new String(b.getAttribute("ID"))).indexOf("ENS")?d3.rgb("#DFC184"):d3.rgb("#7EB5D6"):"long"==f.gsvg.txType?a=-1<(new String(b.getAttribute("ID"))).indexOf("ENS")?d3.rgb("#B58AA5"):d3.rgb("#CECFCE"):"small"==f.gsvg.txType?a=-1<(new String(b.getAttribute("ID"))).indexOf("ENS")?d3.rgb("#FFCC00"):d3.rgb("#99CC99"):"liverTotal"==f.gsvg.txType?a=d3.rgb("#bbbedd"):
"heartTotal"==f.gsvg.txType?a=d3.rgb("#DC7252"):"mergedTotal"==f.gsvg.txType&&(a=d3.rgb("#9F4F92"));return a};f.drawTrx=function(b,a){var d=parseInt(b.getAttribute("start"),10),c=parseInt(b.getAttribute("stop"),10);"undefined"!==typeof b.getAttribute("cdsStart")&&"undefined"!==typeof b.getAttribute("cdsStop")&&(d=parseInt(b.getAttribute("cdsStart"),10),c=parseInt(b.getAttribute("cdsStop"),10));var h=d3.select("#Level"+f.gsvg.levelNumber+f.trackClass+" #tx"+b.getAttribute("ID"));exList=getAllChildrenByName(getFirstChildByName(b,
"exonList"),"exon");for(var e=0;e<exList.length;e++){var g=parseInt(exList[e].getAttribute("start"),10),l=parseInt(exList[e].getAttribute("stop"),10);if(g<d&&d<l||l>c&&c>g){var m=0,q=0,t=0,v=0;g<d?(m=f.xScale(exList[e].getAttribute("start")),q=f.xScale(d)-f.xScale(exList[e].getAttribute("start")),t=f.xScale(d),v=f.xScale(exList[e].getAttribute("stop"))-f.xScale(d)):l>c&&(t=f.xScale(exList[e].getAttribute("start")),v=f.xScale(c)-f.xScale(exList[e].getAttribute("start")),m=f.xScale(c),q=f.xScale(exList[e].getAttribute("stop"))-
f.xScale(c));h.append("rect").attr("x",m).attr("y",2.5).attr("height",5).attr("width",q).attr("title",function(y){return exList[e].getAttribute("ID")}).attr("id",function(y){return"ExNC"+exList[e].getAttribute("ID")}).style("fill",f.color).style("cursor","pointer");h.append("rect").attr("x",t).attr("height",10).attr("width",v).attr("title",function(y){return exList[e].getAttribute("ID")}).attr("id",function(y){return"Ex"+exList[e].getAttribute("ID")}).style("fill",f.color).style("cursor","pointer")}else{m=
10;q=0;if(g<d&&l<d||l>c&&g>c)m=5,q=2.5;h.append("rect").attr("x",function(y){return f.xScale(exList[e].getAttribute("start"))}).attr("y",q).attr("height",m).attr("width",function(y){return f.xScale(exList[e].getAttribute("stop"))-f.xScale(exList[e].getAttribute("start"))}).attr("title",function(y){return exList[e].getAttribute("ID")}).attr("id",function(y){return"Ex"+exList[e].getAttribute("ID")}).style("fill",f.color).style("cursor","pointer")}if(0<e){h.append("line").attr("x1",function(y){return f.xScale(exList[e-
1].getAttribute("stop"))}).attr("x2",function(y){return f.xScale(exList[e].getAttribute("start"))}).attr("y1",5).attr("y2",5).attr("id",function(y){return"Int"+exList[e-1].getAttribute("ID")+"_"+exList[e].getAttribute("ID")}).attr("stroke",f.color).attr("stroke-width","2");g=">";"-1"==b.getAttribute("strand")&&(g="<");l=g;m=f.xScale(exList[e-1].getAttribute("stop"));q=f.xScale(exList[e].getAttribute("start"))-m;t=0;if(7>q)l="";else for(q-=7;8<q;)0==t?(l+=" ",t=1):(l+=g,t=0),q-=7;h.append("svg:text").attr("id",
function(y){return"IntTxt"+exList[e-1].getAttribute("ID")+"_"+exList[e].getAttribute("ID")}).attr("dx",m+1).attr("dy","11").style("pointer-events","none").style("opacity","0.5").style("fill",f.color).style("font-size","16px").text(l)}}};f.redraw=function(){d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll("g.trx"+f.gsvg.levelNumber).each(function(b,a){var d=parseInt(b.getAttribute("start"),10),c=parseInt(b.getAttribute("stop"),10);"undefined"!==typeof b.getAttribute("cdsStart")&&"undefined"!==
typeof b.getAttribute("cdsStop")&&(d=parseInt(b.getAttribute("cdsStart"),10),c=parseInt(b.getAttribute("cdsStop"),10));exList=getAllChildrenByName(getFirstChildByName(b,"exonList"),"exon");for(var h=0;h<exList.length;h++){var e=parseInt(exList[h].getAttribute("start"),10),g=parseInt(exList[h].getAttribute("stop"),10);if(e<d&&d<g||g>c&&c>e){var l=e,m=d;g>c?(l=c,m=g,g=c):e=d;d3.select("#Level"+f.gsvg.levelNumber+f.trackClass+" g#tx"+b.getAttribute("ID")+" rect#ExNC"+exList[h].getAttribute("ID")).attr("x",
function(C){return f.xScale(l)}).attr("width",function(C){return f.xScale(m)-f.xScale(l)})}d3.select("#Level"+f.gsvg.levelNumber+f.trackClass+" g#tx"+b.getAttribute("ID")+" rect#Ex"+exList[h].getAttribute("ID")).attr("x",function(C){return f.xScale(e)}).attr("width",function(C){return f.xScale(g)-f.xScale(e)});if(0<h){var q=">";"-1"==b.getAttribute("strand")&&(q="<");var t=q,v=f.xScale(exList[h-1].getAttribute("stop")),y=f.xScale(exList[h].getAttribute("start")),w=y-v,A=0;if(7>w)t="";else for(w-=
7;8<w;)0==A?(t+=" ",A=1):(t+=q,A=0),w-=7;d3.select("#Level"+f.gsvg.levelNumber+f.trackClass+" g#tx"+b.getAttribute("ID")+" line#Int"+exList[h-1].getAttribute("ID")+"_"+exList[h].getAttribute("ID")).attr("x1",v).attr("x2",y);d3.select("#Level"+f.gsvg.levelNumber+f.trackClass+" g#tx"+b.getAttribute("ID")+" #IntTxt"+exList[h-1].getAttribute("ID")+"_"+exList[h].getAttribute("ID")).attr("dx",v+1).text(t)}}});f.redrawSelectedArea()};f.update=function(){var b=getAllChildrenByName(getFirstChildByName(f.gsvg.selectedData,
"TranscriptList"),"Transcript"),a=parseInt(f.gsvg.selectedData.getAttribute("start"),10),d=parseInt(f.gsvg.selectedData.getAttribute("stop"),10);"undefined"!==typeof f.gsvg.selectedData.getAttribute("extStart")&&"undefined"!==typeof f.gsvg.selectedData.getAttribute("extStop")&&(a=parseInt(f.gsvg.selectedData.getAttribute("extStart"),10),d=parseInt(f.gsvg.selectedData.getAttribute("extStop"),10));f.txMin=a;f.txMax=d;f.svg.attr("height",15*(1+b.length));d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll(".trx"+
f.gsvg.levelNumber).remove();b=d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll(".trx"+f.gsvg.levelNumber).data(b,key).attr("transform",function(c,h){return"translate("+f.xScale(c.getAttribute("start"))+","+f.calcY(c,h)+")"});b.enter().append("g").attr("class","trx"+f.gsvg.levelNumber).attr("transform",function(c,h){return"translate(0,"+f.calcY(c,h)+")"}).attr("id",function(c){return c.getAttribute("ID")}).style("cursor","pointer").on("mouseover",function(c){0==f.gsvg.isToolTip&&(d3.select(this).selectAll("line").style("stroke",
"green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(f.createToolTip(c)).style("left",function(){return f.positionTTLeft(d3.event.pageX)}).style("top",function(){return f.positionTTTop(d3.event.pageY)}))}).on("mouseout",function(c){d3.select(this).selectAll("line").style("stroke",f.color);d3.select(this).selectAll("rect").style("fill",f.color);d3.select(this).selectAll("text").style("opacity",
"0.6").style("fill",f.color);tt.transition().delay(500).duration(200).style("opacity",0)}).each(f.drawTrx);b.exit().remove();f.svg.selectAll(".legend").remove();b=[];"protein"==f.gsvg.txType?b=[{color:"#DFC184",label:"Ensembl"},{color:"#7EB5D6",label:"RNA-Seq"}]:"long"==f.gsvg.txType?b=[{color:"#B58AA5",label:"Ensembl"},{color:"#CECFCE",label:"RNA-Seq"}]:"small"==f.gsvg.txType?b=[{color:"#FFCC00",label:"Ensembl"},{color:"#99CC99",label:"RNA-Seq"}]:"liverTotal"==f.gsvg.txType?b=[{color:"#bbbedd",label:"Liver RNA-Seq"}]:
"mergedTotal"==f.gsvg.txType&&(b=[{color:"#9F4F92",label:"Merged RNA-Seq"}]);f.drawLegend(b)};f.calcY=function(b,a){return 15*(a+1)};f.redrawLegend=function(){};"undefined"!==typeof f.gsvg.selectedData.getAttribute("extStart")?(f.txMin=parseInt(f.gsvg.selectedData.getAttribute("extStart"),10),f.txMax=parseInt(f.gsvg.selectedData.getAttribute("extStop"),10)):(f.txMin=parseInt(f.gsvg.selectedData.getAttribute("start"),10),f.txMax=parseInt(f.gsvg.selectedData.getAttribute("stop"),10));d3.select("#Level"+
f.gsvg.levelNumber+f.trackClass).attr("height",15*(1+n.length));d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll(".trx"+f.gsvg.levelNumber).remove();p=d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll(".trx"+f.gsvg.levelNumber).data(n,key).attr("transform",function(b,a){return"translate("+f.xScale(b.getAttribute("start"))+","+f.calcY(b,a)+")"});p.enter().append("g").attr("class","trx"+f.gsvg.levelNumber).attr("transform",function(b,a){return"translate(0,"+f.calcY(b,a)+")"}).attr("id",
function(b){return"tx"+b.getAttribute("ID")}).style("cursor","pointer").on("mouseover",function(b){0==f.gsvg.isToolTip&&(d3.select(this).selectAll("line").style("stroke","green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(f.createToolTip(b)).style("left",function(){return f.positionTTLeft(d3.event.pageX)}).style("top",function(){return f.positionTTTop(d3.event.pageY)}))}).on("mouseout",
function(b){d3.select(this).selectAll("line").style("stroke",f.color);d3.select(this).selectAll("rect").style("fill",f.color);d3.select(this).selectAll("text").style("opacity","0.6").style("fill",f.color);tt.transition().delay(500).duration(200).style("opacity",0)}).each(f.drawTrx);p.exit().remove();f.redrawLegend();f.scaleSVG.transition().duration(300).style("opacity",1);f.svg.transition().duration(300).style("opacity",1);f.redraw();return f}
function HelicosTrack(p,n,r,u){p=CountTrack(p,n,r,u);p.graphColorText="#DD0000";p.updateLabel("Brain Helicos RNA Read Counts");p.redrawLegend();p.redraw();return p}function IlluminaSmallTrack(p,n,r,u){p=CountTrack(p,n,r,u);p.graphColorText="#99CC99";p.updateLabel("Brain Illumina Small RNA Read Counts");p.redrawLegend();p.redraw();p.redraw();return p}
function IlluminaTotalTrack(p,n,r,u){p=CountTrack(p,n,r,u);p.updateLabel("BNLx/SHR Brain Illumina Total-RNA(rRNA depleted) Read Counts");p.redrawLegend();return p}function LiverIlluminaTotalPlusTrack(p,n,r,u){p=CountTrack(p,n,r,u);p.graphColorText="#abaecd";p.updateLabel("BNLx/SHR Liver + Strand Total-RNA Read Counts");p.redrawLegend();p.redraw();return p}
function LiverIlluminaTotalMinusTrack(p,n,r,u){p=CountTrack(p,n,r,u);p.graphColorText="#dbdefd";p.updateLabel("BNLx/SHR Liver - Strand Total-RNA Read Counts");p.redrawLegend();p.redraw();return p}function LiverIlluminaSmallTrack(p,n,r,u){p=CountTrack(p,n,r,u);p.graphColorText="#7b7e9d";p.updateLabel("Liver  Illumina Small RNA Read Counts");p.redrawLegend();p.redraw();return p}
function HeartIlluminaTotalPlusTrack(p,n,r,u){p=CountTrack(p,n,r,u);p.graphColorText="#CC6242";p.updateLabel("BNLx/SHR Heart + Strand Total-RNA Read Counts");p.redrawLegend();p.redraw();return p}function HeartIlluminaTotalMinusTrack(p,n,r,u){p=CountTrack(p,n,r,u);p.graphColorText="#FC9272";p.updateLabel("BNLx/SHR Heart - Strand Total-RNA Read Counts");p.redrawLegend();p.redraw();return p}
function HeartIlluminaSmallTrack(p,n,r,u){p=CountTrack(p,n,r,u);p.graphColorText="#9C3212";p.updateLabel("Heart Illumina Small RNA Read Counts");p.redrawLegend();p.redraw();return p}function BrainIlluminaTotalPlusTrack(p,n,r,u){p=CountTrack(p,n,r,u);p.graphColorText="#7EB5D6";p.updateLabel("Brain + Strand Total-RNA Read Counts");p.redrawLegend();p.redraw();return p}
function BrainIlluminaTotalMinusTrack(p,n,r,u){p=CountTrack(p,n,r,u);p.updateLabel("Brain - Strand Total-RNA Read Counts");p.redrawLegend();p.redraw();return p}
function StrainSpecificIlluminaTotalTrack(p,n,r,u,f){n=CountTrack(p,n,r,u,f);u=r.substr(r.indexOf("-")+1);f=".";0<r.indexOf("Plus")?f="+":0<r.indexOf("Minus")&&(f="-");r=r.substr(0,r.indexOf("illumina"));"brain"===r?r="Whole Brain":"liver"===r&&(r="Liver");n.graphColorText=p.strainSpecificCountColors(u);p="";"2"===n.countType&&(p=" Sampled");n.updateLabel(u+" "+r+" "+f+" Strand Total-RNA"+p+" Read Counts");n.redrawLegend();n.redraw();return n}
function IlluminaPolyATrack(p,n,r,u){p=CountTrack(p,n,r,u);p.graphColorText="#7EB5D6";p.updateLabel("Brain Illumina PolyA+ RNA Read Counts");p.redrawLegend();p.redraw();return p}
function SpliceJunctionTrack(p,n,r,u,f,b){p=GenericTranscriptTrack(p,n,r,u,f,b);p.dataFileName=r+".xml";p.xmlTag="Feature";p.xmlTagBlockElem="block";p.idPrefix="splcJnct";"liverspliceJnct"===r?p.idPrefix="lvrsplcJnct":"heartspliceJnct"===r&&(p.idPrefix="hrtsplcJnct");p.ttSVG=1;p.ttTrackList=[];p.ttTrackList.push(r);p.ttTrackList.push("ensemblcoding");p.ttTrackList.push("braincoding");p.ttTrackList.push("brainTotal");p.ttTrackList.push("liverTotal");p.ttTrackList.push("heartTotal");p.ttTrackList.push("mergedTotal");
p.ttTrackList.push("refSeq");p.ttTrackList.push("repeatMask");"splcJnct"===r?p.ttTrackList.push("illuminaPolyA"):"liverspliceJnct"===r?(p.ttTrackList.push("liverilluminaTotalPlus"),p.ttTrackList.push("liverilluminaTotalMinus")):"heartspliceJnct"===r?(p.ttTrackList.push("heartilluminaTotalPlus"),p.ttTrackList.push("heartilluminaTotalMinus")):"brainspliceJnct"===r&&(p.ttTrackList.push("brainilluminaTotalPlus"),p.ttTrackList.push("brainilluminaTotalMinus"));p.colorValueField="readCount";p.colorScale=
d3.scaleLinear().domain([1,1E3]).range(["#E6E6E6","#000000"]);p.legendLbl="Read Depth";p.density=3;p.getDisplayID=function(a){return a.getAttribute("name")};p.createToolTip=function(a){var d='<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>ID: '+a.getAttribute("name");d=d+"<BR>Read Counts="+numberWithCommas(a.getAttribute("readCount"));d=d+"<BR>Splice Junction in "+a.getAttribute("sampleCount")+" of ";"Rn"===organism?d+="6 samples(3 BN-Lx, 3 SHR)":"Mm"===organism&&(d+="6 samples(3 ILS, 3 ISS)");
var c=getAllChildrenByName(getFirstChildByName(a,"blockList"),"block"),h=0,e=1,g="start",l="stop";-1==a.getAttribute("strand")&&(h=1,e=0,g="stop",l="start");d=d+"<BR><BR>Coverage Exon 1: "+numberWithCommas(c[h].getAttribute(g))+"-"+numberWithCommas(c[h].getAttribute(l))+" ("+(parseInt(c[h].getAttribute("stop"),10)-parseInt(c[h].getAttribute("start"),10))+" bp)";d=d+"<BR>Coverage Exon 2: "+numberWithCommas(c[e].getAttribute(g))+"-"+numberWithCommas(c[e].getAttribute(l))+" ("+(parseInt(c[e].getAttribute("stop"),
10)-parseInt(c[e].getAttribute("start"),10))+" bp)";return d=d+"<BR>Intron: "+numberWithCommas(parseInt(c[1].getAttribute("start"),10)-parseInt(c[0].getAttribute("stop"),10))+" bp<BR>"};p.drawScaleLegend("1","1000+","Read Counts","#E6E6E6","#000000",0);p.draw(n);return p}
function CustomCountTrack(p,n,r,u,f){var b=CountTrack(p,n,r,u,f);b.graphColorText="#4E85A6";b.updateControl=0;b.updateFullData=function(a,d){if(b.updateControl==a){b.updateControl=a+1;var c=b.xScale.domain()[0],h=b.xScale.domain()[1],e=h-c;b.showLoading();b.bin=b.calculateBin(e);var g=dataPrefix+"tmpData/trackXML/"+b.gsvg.folderName+"/tmp/"+c+"_"+h+".count."+b.trackClass+".xml",l=dataPrefix+"tmpData/trackUpload/"+b.trackClass.substr(6),m="bg",q="";0<b.bin&&(c-=2*b.bin,c-=c%(2*b.bin),h+=2*b.bin,h+=
2*b.bin-h%(2*b.bin),g=dataPrefix+"tmpData/trackXML/"+b.gsvg.folderName+"/"+c+"_"+h+".bincount."+b.bin+"."+b.trackClass+".xml");-1<b.dataFileName.indexOf("http")&&(q=l=b.dataFileName,m="bw");d3.xml(g,function(t,v){if(t){if(0==a||1==d){var y="/"+pathPrefix;pathPrefix||(y="");$.ajax({url:y+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:c,maxCoord:h,myOrganism:organism,genomeVer:genomeVer,track:b.trackClass,bedFile:l,outFile:g,folder:b.gsvg.folderName,binSize:b.bin,
type:m,web:q},dataType:"json",success:function(w){gtag("event","generateTrackCount",{event_category:"browser"})},error:function(w,A,C){}})}8>a?b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1)},500):30>a?b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1)},1E3):32>a?b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1)},1E4):(d3.select("#Level"+b.levelNumber+b.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+b.trackClass),d3.select("#Level"+
b.levelNumber+b.trackClass).attr("height",15),b.gsvg.addTrackErrorRemove(b.svg,"#Level"+b.gsvg.levelNumber+b.trackClass),b.hideLoading(),b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1,0)},15E3))}else null==v?32<=a?(y=[],b.draw(y)):b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1,0)},5E3):(b.fullDataTimeOutHandle=0,b.loadedDataMin=c,b.loadedDataMax=h,y=v.documentElement.getElementsByTagName("Count"),b.draw(y),b.updateControl=0)})}};b.updateLabel("Custom Count Track");
b.redrawLegend();b.redraw();return b}
function CountTrack(p,n,r,u,f){var b=Track(p,n,r,"Generic Counts");b.loadedDataMin=b.xScale.domain()[0];b.loadedDataMax=b.xScale.domain()[1];b.dataFileName=b.trackClass;b.scaleMin=1;b.scaleMax=5E3;b.graphColorText="steelblue";b.colorScale=d3.scaleLinear().domain([b.scaleMin,b.scaleMax]).range(["#EEEEEE","#000000"]);b.ttSVG=1;b.data=n;b.density=u;b.prevDensity=u;b.countType=1;b.displayBreakDown=null;p=b.gsvg.xScale.domain()[0];p=b.gsvg.xScale.domain()[1]-p;console.log(b.trackClass+":"+f);f=f.split(",");
1<f.length?(tmp=f[1].split(":"),b.scaleMin=1*tmp[0],b.scaleMax=1*tmp[1]):3<f.length&&4<f.length&&(b.countType=1*f[2]);0<f.length&&f[0]&&(b.countType=1*f[0]);b.fullDataTimeOutHandle=0;b.ttTrackList=[];-1<r.indexOf("illuminaSmall")?(b.ttTrackList.push("ensemblsmallnc"),b.ttTrackList.push("brainsmallnc"),b.ttTrackList.push("liversmallnc"),b.ttTrackList.push("heartsmallnc")):(b.ttTrackList.push("ensemblcoding"),b.ttTrackList.push("braincoding"),b.ttTrackList.push("liverTotal"),b.ttTrackList.push("heartTotal"),
b.ttTrackList.push("mergedTotal"),b.ttTrackList.push("refSeq"),b.ttTrackList.push("ensemblnoncoding"),b.ttTrackList.push("brainnoncoding"),b.ttTrackList.push("probe"),b.ttTrackList.push("polyASite"),b.ttTrackList.push("spliceJnct"),b.ttTrackList.push("liverspliceJnct"),b.ttTrackList.push("heartspliceJnct"));b.ttTrackList.push("repeatMask");b.calculateBin=function(a){a=new String(Math.floor(a/b.gsvg.width));a=a.substr(0,1)*Math.pow(10,a.length-1);a=Math.floor(a/2);5>a&&(a=0);return a};b.bin=b.calculateBin(p);
b.color=function(a){var d="#FFFFFF";a.getAttribute("count")>=b.scaleMin&&(d=d3.rgb(b.colorScale(a.getAttribute("count"))));return d};b.redraw=function(){var a=b.gsvg.xScale.domain()[0],d=b.gsvg.xScale.domain()[1];b.xScale(a+b.bin);b.xScale(a);b.prevMinCoord=a;b.prevMaxCoord=d;a=b.xScale.domain()[0];d=b.xScale.domain()[1];for(var c=[],h=0,e=0,g=0;g<b.data.length;g++)if("undefined"!==typeof b.data[g]){var l=parseInt(b.data[g].getAttribute("start"),10),m=parseInt(b.data[g].getAttribute("stop"),10),q=
parseInt(b.data[g].getAttribute("count"),10);if(1!=b.density||1==b.density&&l!=m)if(g+1<b.data.length){if(m=parseInt(b.data[g+1].getAttribute("start"),10),l>=a&&l<=d||m>=a&&m<=d)c[h]=b.data[g],q>e&&(e=q),h++}else l>=a&&l<=d&&(c[h]=b.data[g],q>e&&(e=q),h++)}1==b.density?(b.density!=b.prevDensity?(b.redrawLegend(),d=b.gsvg.xScale.domain()[1],b.prevDensity=b.density,b.svg.selectAll(".area").remove(),b.svg.selectAll("g.y").remove(),b.svg.selectAll(".grid").remove(),b.svg.selectAll(".leftLbl").remove(),
a=b.svg.selectAll("."+b.trackClass).data(c,keyStart),a.enter().append("rect").attr("x",function(t){return b.xScale(t.getAttribute("start"))}).attr("y",15).attr("class",b.trackClass).attr("height",10).attr("width",function(t,v){return b.xScale(t.getAttribute("stop"))-b.xScale(t.getAttribute("start"))}).attr("fill",b.color).on("mouseover",function(t){0==b.gsvg.isToolTip&&(d3.select(this).style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(b.createToolTip(t)).style("left",
function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)}))}).on("mouseout",function(t){d3.select(this).style("fill",b.color);tt.transition().delay(500).duration(200).style("opacity",0)}),a.exit().remove()):b.svg.selectAll("."+b.trackClass).attr("x",function(t){return b.xScale(t.getAttribute("start"))}).attr("width",function(t,v){return b.xScale(t.getAttribute("stop"))-b.xScale(t.getAttribute("start"))}).attr("fill",b.color),b.svg.attr("height",
30)):2==b.density&&(b.svg.selectAll("."+b.trackClass).remove(),b.svg.select(".y.axis").remove(),b.svg.select("g.grid").remove(),b.svg.selectAll(".leftLbl").remove(),b.yScale.domain([0,e]),b.svg.select(".area").remove(),b.area=d3.area().x(function(t){return b.xScale(t.getAttribute("start"))}).y0(140).y1(function(t){return b.yScale(t.getAttribute("count"))}),b.redrawLegend(),b.prevDensity=b.density,b.svg.append("g").attr("class","y axis").call(b.yAxis),b.svg.append("g").attr("class","grid").call(b.yAxis.tickSize(-b.gsvg.width+
10,0,0).tickFormat("")),b.svg.select("g.y").selectAll("text").each(function(t){var v=new String(t);d3.select(this).attr("x",function(){return 7.7*v.length+5}).attr("dy","0.05em");b.svg.append("svg:text").attr("class","leftLbl").attr("x",b.gsvg.width-(7.8*v.length+5)).attr("y",function(){return b.yScale(t)}).attr("dy","0.01em").style("font-weight","bold").text(numberWithCommas(t))}),b.svg.append("path").datum(c).attr("class","area").attr("stroke",b.graphColorText).attr("fill",b.graphColorText).attr("d",
b.area),b.svg.attr("height",140));b.redrawSelectedArea()};b.createToolTip=function(a){var d='<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>Read Count='+numberWithCommas(a.getAttribute("count"));if(0<b.bin){var c=parseInt(a.getAttribute("start"),10)+parseInt(b.bin,10);d=d+"*<BR><BR>*Data compressed for display. Using 90th percentile of<BR>region:"+numberWithCommas(a.getAttribute("start"))+"-"+numberWithCommas(c)+"<BR><BR>Zoom in further to see raw data(roughly a region <1000bp). The bin size will decrease as you zoom in thus the resolution of the count data will improve as you zoom in."}return d};
b.update=function(a){a=b.xScale.domain()[0];var d=b.xScale.domain()[1];b.loadedDataMin<=a&&d<=b.loadedDataMax?b.redraw():b.updateFullData(0,1)};b.updateFullData=function(a,d){var c=b.xScale.domain()[0],h=b.xScale.domain()[1],e=h-c;b.showLoading();b.bin=b.calculateBin(e);e=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/tmp/"+c+"_"+h+".count."+b.trackClass+".xml";0<b.bin&&(c-=2*b.bin,c-=c%(2*b.bin),h+=2*b.bin,h+=2*b.bin-h%(2*b.bin),e=dataPrefix+"tmpData/browserCache/"+
genomeVer+"/regionData/"+b.gsvg.folderName+"/tmp/"+c+"_"+h+".bincount."+b.bin+"."+b.trackClass+".xml");d3.xml(e,function(g,l){if(g){if(0==a||1==d){var m="/"+pathPrefix;pathPrefix||(m="");tmpPanel=panel;-1<b.trackClass.indexOf("-")&&(tmpPanel=b.trackClass.substr(b.trackClass.indexOf("-")+1));$.ajax({url:m+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:c,maxCoord:h,panel:tmpPanel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,
track:b.trackClass,folder:b.gsvg.folderName,binSize:b.bin,countType:b.countType},dataType:"json",success:function(q){gtag("event","generateTrackCount",{event_category:"browser"})},error:function(q,t,v){}})}8>a?b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1,0)},500):30>a?b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1,0)},1E3):32>a?b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1,0)},1E4):(d3.select("#Level"+b.levelNumber+b.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+
b.trackClass),d3.select("#Level"+b.levelNumber+b.trackClass).attr("height",15),b.gsvg.addTrackErrorRemove(b.svg,"#Level"+b.gsvg.levelNumber+b.trackClass),b.hideLoading(),b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1,1)},15E3))}else null==l?32<=a?(m=[],b.draw(m)):b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1,0)},5E3):(b.fullDataTimeOutHandle=0,b.loadedDataMin=c,b.loadedDataMax=h,m=l.documentElement.getElementsByTagName("Count"),b.draw(m))})};b.updateCountScale=
function(a,d){b.scaleMin=a;b.scaleMax=d;b.colorScale=d3.scaleLinear().domain([b.scaleMin,b.scaleMax]).range(["#EEEEEE","#000000"]);1==b.density&&(b.redrawLegend(),b.redraw())};b.setupToolTipSVG=function(a,d){var c=b.xScale.domain()[0],h=b.xScale.domain()[1],e=parseInt(a.getAttribute("start"),10),g=parseInt(a.getAttribute("stop"),10);h=Math.floor((h-c)*d);20>h&&(h=20);c=e-h;h=g+h;1>c&&(c=1);"undefined"!==typeof b.ttSVGMinWidth&&h-c<b.ttSVGMinWidth&&(c=e-b.ttSVGMinWidth/2,h=g+b.ttSVGMinWidth/2);e=toolTipSVG("div#ttSVG",
450,c,h,99,a.getAttribute("ID"),"transcript");e.addTrack(b.trackClass,3,"",b.data);for(g=0;g<b.ttTrackList.length;g++){var l=b.gsvg.getTrackData(b.ttTrackList[g]),m=[];if("undefined"!==typeof l&&0<l.length){for(var q=0,t=0;t<l.length;t++)if(c<=parseInt(l[t].getAttribute("start"),10)&&parseInt(l[t].getAttribute("start"),10)<=h||parseInt(l[t].getAttribute("start"),10)<=c&&parseInt(l[t].getAttribute("stop"),10)>=c)m[q]=l[t],q++;0<m.length&&e.addTrack(b.ttTrackList[g],3,"DrawTrx",m)}}};b.draw=function(a){b.hideLoading();
b.data=a;var d=b.gsvg.xScale.domain()[0],c=b.gsvg.xScale.domain()[1];b.xScale(d+b.bin);b.xScale(d);b.redrawLegend();for(var h=[],e=0,g=0,l=0;l<a.length;l++)if("undefined"!==typeof a[l]){var m=parseInt(a[l].getAttribute("start"),10),q=parseInt(a[l].getAttribute("stop"),10),t=parseInt(a[l].getAttribute("count"),10);if(1!=b.density||1==b.density&&m!=q)if(l+1<a.length){if(q=parseInt(a[l+1].getAttribute("start"),10),m>=d&&m<=c||q>=d&&q<=c)h[e]=a[l],t>g&&(g=t),e++}else m>=d&&m<=c&&(h[e]=a[l],t>g&&(g=t),
e++)}a=h;b.svg.selectAll("."+b.trackClass).remove();b.svg.select(".y.axis").remove();b.svg.select("g.grid").remove();b.svg.selectAll(".leftLbl").remove();b.svg.select(".area").remove();b.svg.selectAll(".area").remove();1==b.density?(c=b.gsvg.xScale.domain()[1],b.svg.selectAll("."+b.trackClass).data(a,keyStart).enter().append("rect").attr("x",function(v){return b.xScale(v.getAttribute("start"))}).attr("y",15).attr("class",b.trackClass).attr("height",10).attr("width",function(v,y){return b.xScale(v.getAttribute("stop"))-
b.xScale(v.getAttribute("start"))}).attr("fill",b.color).on("mouseover",function(v){0==b.gsvg.isToolTip&&(d3.select(this).style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(b.createToolTip(v)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)}),1==b.ttSVG&&b.setupToolTipSVG(v,.005))}).on("mouseout",function(v){d3.select(this).style("fill",b.color);tt.transition().delay(500).duration(200).style("opacity",
0)}),b.svg.attr("height",30)):2==b.density&&(b.yScale.domain([0,g]),b.yAxis=d3.axisLeft(b.yScale).ticks(5),b.svg.select("g.grid").remove(),b.svg.select(".y.axis").remove(),b.svg.selectAll(".leftLbl").remove(),b.svg.append("g").attr("class","y axis").call(b.yAxis),b.svg.select("g.y").selectAll("text").each(function(v){var y=new String(v);b.svg.append("svg:text").attr("class","leftLbl").attr("x",b.gsvg.width-(7.8*y.length+5)).attr("y",function(){return b.yScale(v)}).attr("dy","0.01em").style("font-weight",
"bold").text(numberWithCommas(v));d3.select(this).attr("x",function(){return 7.7*y.length+5}).attr("dy","0.05em")}),b.svg.append("g").attr("class","grid").call(b.yAxis.tickSize(-b.gsvg.width+10,0,0).tickFormat("")),b.svg.select(".area").remove(),b.area=d3.area().x(function(v){return b.xScale(v.getAttribute("start"))}).y0(140).y1(function(v,y){return b.yScale(v.getAttribute("count"))}),b.svg.append("path").datum(a).attr("class","area").attr("stroke",b.graphColorText).attr("fill",b.graphColorText).attr("d",
b.area),b.svg.attr("height",140));b.redrawSelectedArea()};b.redrawLegend=function(){if(2==b.density)d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".legend").remove();else if(1==b.density){var a=new String(b.label);a=b.gsvg.width/2+a.length/2*7.5-10;var d=new String("<"+b.scaleMin);b.drawScaleLegend(b.scaleMin,numberWithCommas(b.scaleMax)+"+","Read Counts","#EEEEEE","#00000",15+7.6*d.length);b.svg.append("text").text("<"+b.scaleMin).attr("class","legend").attr("x",a).attr("y",12);b.svg.append("rect").attr("class",
"legend").attr("x",a+7.6*d.length+5).attr("y",0).attr("rx",2).attr("ry",2).attr("height",12).attr("width",15).attr("fill","#FFFFFF").attr("stroke","#CECECE")}};b.redrawSelectedArea=function(){if(1<b.density){var a=b.svg.attr("height");d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".selectedArea").remove();if(-1<b.selectionStart&&-1<b.selectionEnd){var d=b.xScale(b.selectionStart),c=b.xScale(b.selectionEnd)-d;1>c&&(c=1);d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).append("rect").attr("class",
"selectedArea").attr("x",d).attr("y",0).attr("height",a).attr("width",c).attr("fill","#CECECE").attr("opacity",.3).attr("pointer-events","none")}}else d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".selectedArea").remove()};b.savePrevious=function(){b.prevSetting={};b.prevSetting.density=b.density;b.prevSetting.scaleMin=b.scaleMin;b.prevSetting.scaleMax=b.scaleMax;b.prevSetting.countType=b.countType};b.revertPrevious=function(){b.density=b.prevSetting.density;b.scaleMin=b.prevSetting.scaleMin;
b.scaleMax=b.prevSetting.scaleMax;b.countType=b.prevSetting.countType};b.generateTrackSettingString=function(){return b.trackClass+","+b.density+","+b.scaleMin+":"+b.scaleMax+","+b.countType+";"};b.generateSettingsDiv=function(a){var d=trackInfo[b.trackClass];b.savePrevious();d3.select(a).select("table").select("tbody").html("");if(d&&d.Controls&&0<d.Controls.length){var c=(new String(d.Controls)).split(",");a=d3.select(a).select("table").select("tbody");a.append("tr").append("td").style("font-weight",
"bold").html("Track Settings: "+d.Name);for(d=0;d<c.length;d++)if("undefined"!==typeof c[d]&&""!=c[d]){var h=c[d].split(";"),e=a.append("tr").append("td"),g=h[0].substr(5),l="";3<h.length&&0==h[3].indexOf("Default=")&&(l=h[3].substr(8));if(0==h[1].toLowerCase().indexOf("select")){e.append("text").text(g+": ");var m=h[1].split(":");h=h[2].split("}");g=b.trackClass+"Dense"+b.level+"Select";"colorSelect"==m[1]?g=b.trackClass+b.level+"colorSelect":"countSelect"==m[1]&&(g=b.trackClass+b.level+"countSelect");
e=e.append("select").attr("id",g).attr("name",m[1]);for(m=0;m<h.length;m++){var q=h[m].substr(1).split(":");if(2==q.length){var t=e.append("option").attr("value",q[1]).text(q[0]);-1<g.indexOf("Dense")?q[1]==b.density&&t.attr("selected","selected"):q[1]==l&&t.attr("selected","selected")}}d3.select("select#"+g).on("change",function(){$(this).attr("id")==b.trackClass+"Dense"+b.level+"Select"&&1==$(this).val()?$("#scaleControl"+b.level).show():$("#scaleControl"+b.level).hide();b.updateSettingsFromUI();
b.redraw()})}else 0==h[1].toLowerCase().indexOf("slider")&&(l="none",1==b.density&&(l="inline-block"),e=e.append("div").attr("id","scaleControl"+b.level).style("display",l),e.append("text").text(g+": "),e.append("input").attr("type","text").attr("id","amount").attr("value",b.scaleMin+"-"+b.scaleMax).style("border",0).style("color","#f6931f").style("font-weight","bold").style("background-color","#EEEEEE"),m=h[1].split(":"),h=h[2].split("}"),e=e.append("div"),e.append("text").text("Min:"),e.append("div").attr("id",
"min-"+m[1]).style("width","60%").style("display","inline-block").style("float","right"),e.append("br"),e.append("text").text("Max:"),e.append("div").attr("id","max-"+m[1]).style("width","60%").style("display","inline-block").style("float","right"),$("#min-"+m[1]).slider({min:1,max:1E3,step:1,value:b.scaleMin,slide:b.processSlider}),$("#max-"+m[1]).slider({min:1E3,max:2E4,step:100,value:b.scaleMax,slide:b.processSlider}),b.updateSettingsFromUI(),b.redraw())}c=a.append("tr").append("td");c.append("input").attr("type",
"button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");b.gsvg.setCurrentViewModified();b.gsvg.removeTrack(b.trackClass);var v=svgList[b.gsvg.levelNumber].currentView.ViewID,y=viewMenu[b.gsvg.levelNumber].findTrackByClass(b.trackClass,v);y=viewMenu[b.gsvg.levelNumber].findTrackIndexWithViewID(y.TrackID,v);viewMenu[b.gsvg.levelNumber].removeTrackWithIDIdx(y,v)});c.append("input").attr("type","button").attr("value",
"Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");b.density==b.prevSetting.density&&b.scaleMin==b.prevSetting.scaleMin&&b.scaleMax==b.prevSetting.scaleMax||b.gsvg.setCurrentViewModified()});c.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){b.revertPrevious();b.updateCountScale(b.scaleMin,b.scaleMax);b.draw(b.data);$("#trackSettingDialog").fadeOut("fast")})}else a=
d3.select(a).select("table").select("tbody"),a.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+d.Name),a.append("tr").append("td").html("Sorry no settings for this track."),c=a.append("tr").append("td"),c.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){b.gsvg.setCurrentViewModified();$("#trackSettingDialog").fadeOut("fast")}),c.append("input").attr("type","button").attr("value",
"Cancel").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")})};b.processSlider=function(a,d){var c=$("#min-rangeslider").slider("value"),h=$("#max-rangeslider").slider("value");$("#amount").val(c+" - "+h);b.updateCountScale(c,h)};b.yScale=d3.scaleLinear().range([140,20]).domain([0,d3.max(n,function(a){return a.getAttribute("count")})]);b.area=d3.area().x(function(a){return b.xScale(a.getAttribute("start"))}).y0(140).y1(function(a){return a.getAttribute("count")});
b.yAxis=d3.axisLeft(b.yScale).ticks(5);b.redrawLegend();b.draw(n);return b}
function PolyATrack(p,n,r,u,f,b){var a=GenericTranscriptTrack(p,n,r,u,f,b);a.dataFileName="polyASite.xml";a.density=3;a.minFeatureWidth=1;a.colorBy="Color";a.ttSVG=1;a.ttTrackList=[];a.ttTrackList.push("ensemblcoding");a.ttTrackList.push("braincoding");a.ttTrackList.push("liverTotal");a.ttTrackList.push("heartTotal");a.ttTrackList.push("mergedTotal");a.ttTrackList.push("refSeq");a.ttTrackList.push("repeatMask");a.ttSVGMinWidth=200;a.createToolTip=function(d){var c=".";1==d.getAttribute("strand")?
c="+":-1==d.getAttribute("strand")&&(c="-");var h="0";1==d.getAttribute("pvalue")&&(h="");return'<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>Motif:'+d.getAttribute("motif")+"<BR>Strand:"+c+"<BR>Location: chr"+d.getAttribute("chromosome")+":"+d.getAttribute("start")+"-"+d.getAttribute("stop")+"<BR>Probability of site: "+h+d.getAttribute("pvalue")};a.updateData=function(d){d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+a.gsvg.folderName+"/"+a.dataFileName,function(c,
h){if(c)if(3>d){var e=1E4;1==d&&(e=15E3);setTimeout(function(){a.updateData(d+1)},e)}else 3<=d&&(d3.select("#Level"+a.levelNumber+a.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+a.trackClass),d3.select("#Level"+a.levelNumber+a.trackClass).attr("height",15),a.gsvg.addTrackErrorRemove(a.svg,"#Level"+a.gsvg.levelNumber+a.trackClass));else{e=h.documentElement.getElementsByTagName(a.xmlTag);for(var g=[],l=[],m=0,q=0;q<e.length;q++)"undefined"!==typeof e[q]&&(g[m]=e[q],l[e[q].getAttribute("ID")]=
1,m++);for(q=0;q<a.data.length;q++)"undefined"!==typeof a.data[q]&&"undefined"===typeof l[a.data[q].getAttribute("ID")]&&(g[m]=a.data[q],m++);a.draw(g);a.hideLoading()}})};a.redrawLegend=function(){a.drawLegend([{color:"#FF8000",label:"+ Strand >>>"},{color:"#330570",label:"- Strand <<<"}])};a.updateFullData=void 0;a.draw(n);return a}
function CustomTranscriptTrack(p,n,r,u,f,b){var a=GenericTranscriptTrack(p,n,r,u,f,b);p=b.split(",");a.xmlTag="Feature";a.xmlTagBlockElem="block";a.density=f;1!==a.density&&2!==a.density&&3!==a.density&&(a.density=3);0<p.length&&(a.dataFileName=p[0].substr(9));a.colorBy=1<p.length?p[1]:"Score";2<p.length&&(a.minValue=p[2]);3<p.length&&(a.maxValue=p[3]);4<p.length&&(a.minColor=p[4]);5<p.length&&(a.maxColor=p[5]);a.colorValueField="score";a.minFeatureWidth=1;a.updateControl=0;"Score"==a.colorBy&&a.createColorScale();
a.updateFullData=function(d,c){if(a.updateControl==d){a.updateControl=d+1;var h=a.xScale.domain()[0],e=a.xScale.domain()[1],g=dataPrefix+"tmpData/trackXML/"+a.gsvg.folderName+"/"+a.dataFileName+".xml",l=dataPrefix+"tmpData/trackUpload/"+a.dataFileName,m="",q=new Date,t="bed";-1<a.dataFileName.indexOf("http")&&(m=a.dataFileName,l="tmpData/tmpDownload/"+q.getTime()+"_"+a.trackClass,g=dataPrefix+"tmpData/trackXML/"+a.gsvg.folderName+"/"+a.trackClass+".xml",t="bb");d3.xml(g,function(v,y){if(v){console.log(v);
if(0==d||1==c){var w="/"+pathPrefix;pathPrefix||(w="");$.ajax({url:w+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:h,maxCoord:e,folder:a.gsvg.folderName,bedFile:l,outFile:g,track:a.trackClass,web:m,type:t},dataType:"json",success:function(A){gtag("event","generateTrackCustomTranscript",{event_category:"browser"})},error:function(A,C,F){console.log(F)}})}3>d?(w=1E4,1==d&&(w=15E3),setTimeout(function(){a.updateFullData(d+1,0)},w)):(d3.select("#Level"+a.gsvg.levelNumber+
a.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+a.trackClass),d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).attr("height",15),a.gsvg.addTrackErrorRemove(a.svg,"#Level"+a.gsvg.levelNumber+a.trackClass),a.hideLoading())}else w=y.documentElement.getElementsByTagName(a.xmlTag),a.draw(w),a.hideLoading(),a.updateControl=0})}};a.updateSettingsFromUI=function(){0<$("#"+a.trackClass+"Dense"+a.level+"Select").length&&(a.density=$("#"+a.trackClass+"Dense"+a.level+"Select").val());
0<$("#"+a.trackClass+a.level+"colorSelect").length&&(a.colorBy=$("#"+a.trackClass+a.level+"colorSelect").val());"Score"==a.colorBy&&(a.minValue=$("#"+a.trackClass+"minData"+a.level).val(),a.maxValue=$("#"+a.trackClass+"maxData"+a.level).val(),testIE||testSafari?(a.minColor=$("#"+a.trackClass+"minColor"+a.level).spectrum("get").toHexString(),a.maxColor=$("#"+a.trackClass+"maxColor"+a.level).spectrum("get").toHexString()):(a.minColor=$("#"+a.trackClass+"minColor"+a.level).val(),a.maxColor=$("#"+a.trackClass+
"maxColor"+a.level).val()),a.createColorScale())};a.generateSettingsDiv=function(d){var c=trackInfo[a.trackClass];a.savePrevious();d3.select(d).select("table").select("tbody").html("");if(0<c.Controls.length&&"null"!=c.Controls){var h=(new String(c.Controls)).split(",");d=d3.select(d).select("table").select("tbody");d.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name);for(c=0;c<h.length;c++)if("undefined"!==typeof h[c]&&""!=h[c]){var e=h[c].split(";"),g=d.append("tr").append("td"),
l=e[0].substr(5);3<e.length&&0==e[3].indexOf("Default=")&&e[3].substr(8);if(0==e[1].toLowerCase().indexOf("select")){g.append("text").text(l+": ");l=e[1].split(":");e=e[2].split("}");var m=a.trackClass+"Dense"+a.level+"Select";"colorSelect"==l[1]&&(m=a.trackClass+a.level+"colorSelect");g=g.append("select").attr("id",m).attr("name",l[1]);for(l=0;l<e.length;l++){var q=e[l].substr(1).split(":");if(2==q.length){var t=g.append("option").attr("value",q[1]).text(q[0]);(-1<m.indexOf("Dense")&&q[1]==a.density||
-1<m.indexOf("colorSelect")&&q[1]==a.colorBy)&&t.attr("selected","selected")}}d3.select("select#"+m).on("change",function(){"Score"==$(this).val()?$("div."+a.trackClass+"Scale"+a.level).show():"Color"==$(this).val()&&$("div."+a.trackClass+"Scale"+a.level).hide();a.updateSettingsFromUI();a.draw(a.data)})}else 0==e[1].toLowerCase().indexOf("txt")&&(g=0==$("#colorTrack"+a.level).size()?g.append("div").attr("class",a.trackClass+"Scale"+a.level).style("display","none"):d3.select("#"+a.trackClass+"Scale"+
a.level),g.append("text").text(l+": "),l=e[1].split(":"),e=e[2].split("}"),e="Data",m="text",q=a.minValue,t=a.maxValue,"color"==l[1]&&(m=e="Color",q=a.minColor,t=a.maxColor),g.append("input").attr("type",m).attr("id",a.trackClass+"min"+e+a.level).attr("class",l[1]).style("margin-left","5px").attr("value",q),g.append("text").text(" - "),g.append("input").attr("type",m).attr("id",a.trackClass+"max"+e+a.level).attr("class",l[1]).style("margin-left","5px").attr("value",t),"Color"==e&&(testIE||testSafari)?
($("#"+a.trackClass+"min"+e+a.level).spectrum({change:function(v){a.updateSettingsFromUI();a.draw(a.data)}}),$("#"+a.trackClass+"max"+e+a.level).spectrum({change:function(v){a.updateSettingsFromUI();a.draw(a.data)}})):($("input#"+a.trackClass+"min"+e+a.level).on("change",function(){a.updateSettingsFromUI();a.draw(a.data)}),$("input#"+a.trackClass+"max"+e+a.level).on("change",function(){a.updateSettingsFromUI();a.draw(a.data)})))}"Score"==$("#"+a.trackClass+a.level+"colorSelect").val()?$("div."+a.trackClass+
"Scale"+a.level).show():"Color"==$("#"+a.trackClass+a.level+"colorSelect").val()&&$("div."+a.trackClass+"Scale"+a.level).hide();h=d.append("tr").append("td");h.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");a.gsvg.removeTrack(a.trackClass);var v=svgList[a.gsvg.levelNumber].currentView.ViewID,y=viewMenu[a.gsvg.levelNumber].findTrackByClass(a.trackClass,v);y=viewMenu[a.gsvg.levelNumber].findTrackIndexWithViewID(y.TrackID,
v);viewMenu[a.gsvg.levelNumber].removeTrackWithIDIdx(y,v)});h.append("input").attr("type","button").attr("value","Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")});h.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){a.revertPrevious();a.draw(a.data);$("#trackSettingDialog").fadeOut("fast")})}else d=d3.select(d).select("table").select("tbody"),
d.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name),d.append("tr").append("td").html("Sorry no settings for this track."),h=d.append("tr").append("td"),h.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")}),h.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")})};
a.generateTrackSettingString=function(){return a.trackClass+","+a.density+","+a.colorBy+","+a.minValue+","+a.maxValue+","+a.minColor+","+a.maxColor+";"};return a}
function RepeatMaskTrack(p,n,r,u,f,b){var a=GenericTranscriptTrack(p,n,r,u,f,b);a.dataFileName="repeatMask.xml";a.density=1;a.xmlTag="Feature";a.xmlTagBlockElem="Block";a.minFeatureWidth=1;a.ttSVG=1;a.ttTrackList=[];a.ttTrackList.push("ensemblcoding");a.ttTrackList.push("braincoding");a.ttTrackList.push("liverTotal");a.ttTrackList.push("heartTotal");a.ttTrackList.push("mergedTotal");a.ttTrackList.push("refSeq");a.ttTrackList.push("spliceJnct");a.ttTrackList.push("liverspliceJnct");a.ttTrackList.push("heartspliceJnct");
a.ttTrackList.push("brainspliceJnct");a.ttTrackList.push("illuminaPolyA");a.ttTrackList.push("liverilluminaTotalPlus");a.ttTrackList.push("liverilluminaTotalMinus");a.ttTrackList.push("heartilluminaTotalPlus");a.ttTrackList.push("heartilluminaTotalMinus");a.ttTrackList.push("brainilluminaTotalPlus");a.ttTrackList.push("brainilluminaTotalMinus");a.ttSVGMinWidth=200;a.legendLbl="Smith-Waterman Alignment Score";a.typeList=[];a.typeList[0]={name:"SINE",clss:"SINE"};a.typeList[1]={name:"LINE",clss:"LINE"};
a.typeList[2]={name:"LTR",clss:"LTR"};a.typeList[3]={name:"DNA",clss:"DNA"};a.typeList[4]={name:"Simple",clss:"Simple_repeat"};a.typeList[5]={name:"Low Comp.",clss:"Low_complexity"};a.typeList[6]={name:"Satellite",clss:"Satellite"};a.typeList[7]={name:"RNA",clss:"RNA"};a.typeList[8]={name:"Other",clss:"Other"};a.typeList[9]={name:"Unknown",clss:"Unknown"};a.yList={};for(p=0;p<a.typeList.length;p++)a.yList[a.typeList[p].clss]=15+15*p;a.createToolTip=function(d){var c='<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>Name: '+
d.getAttribute("name")+"&nbsp&nbsp&nbsp&nbsp&nbspClass: "+d.getAttribute("class");c=c+"&nbsp&nbsp&nbsp&nbsp&nbspFamily: "+d.getAttribute("family")+"<BR><BR>Location: "+d.getAttribute("chromosome")+":"+d.getAttribute("start")+"-"+d.getAttribute("stop");c=c+"<BR><BR>Alignment Score: "+d.getAttribute("score")+"<BR>Mismatches(parts/thousand): "+d.getAttribute("mis")+"<BR>Insertions(parts/thousand): "+d.getAttribute("ins");return c=c+"<BR>Deletions(parts/thousand): "+d.getAttribute("del")};a.pieColor=
function(d,c){var h=d3.rgb("#000000"),e=d.data.names;"LINE"===e?h=d3.rgb("#27e5e5"):"SINE"===e?h=d3.rgb("#e57927"):"LTR"===e?h=d3.rgb("#27e527"):"DNA"===e?h=d3.rgb("#e52727"):"Simple_repeat"===e?h=d3.rgb("#e51ba2"):"Low_complexity"===e?h=d3.rgb("#9029e5"):"RNA"===e?h=d3.rgb("#005be5"):"Satellite"===e?h=d3.rgb("#cccc00"):"Other"===e&&(h=d3.rgb("#007f24"));return h};a.calcY=function(d,c,h,e){d=3===a.density||"3"===a.density?a.calcYPack(d,c,h):2===a.density||"2"===a.density?a.calcYFull(e):a.calcYDense();
a.trackYMax<d/15&&(a.trackYMax=d/15);return d};a.calcYFull=function(d){d=d.getAttribute("class");-1<d.indexOf("RNA")&&(d="RNA");return a.yList[d]};a.redraw=function(){if(a.prevDensity!=a.density)a.draw(a.data);else{a.yMaxArr=[];a.yArr=[];a.yArr[0]=[];for(var d=0;d<a.gsvg.width;d++)a.yMaxArr[d]=0,a.yArr[0][d]=0;a.trackYMax=0;d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g."+a.idPrefix+"trx"+a.gsvg.levelNumber).attr("transform",function(c,h){return"translate("+a.xScale(c.getAttribute("start"))+
","+a.calcY(parseInt(c.getAttribute("start"),10),parseInt(c.getAttribute("stop"),10),h,c)+")"}).each(function(c,h){for(var e=getAllChildrenByName(getFirstChildByName(c,a.xmlTagBlockElem+"List"),a.xmlTagBlockElem),g=0;g<e.length;g++){var l=a.idPrefix+"Ex"+e[g].getAttribute("ID");null==e[g].getAttribute("ID")&&(l=a.idPrefix+"Ex"+c.getAttribute("ID")+"_"+g);a.svg.select("g#"+a.idPrefix+"tx"+c.getAttribute("ID")+" rect#"+l).attr("x",function(w){return a.xScale(e[g].getAttribute("start"))-a.xScale(c.getAttribute("start"))}).attr("width",
function(w){return a.xScale(e[g].getAttribute("stop"))-a.xScale(e[g].getAttribute("start"))});if(0<g){l=">";"-1"==c.getAttribute("strand")&&(l="<");var m=l,q=a.xScale(e[g-1].getAttribute("stop"))-a.xScale(c.getAttribute("start")),t=a.xScale(e[g].getAttribute("start"))-a.xScale(c.getAttribute("start")),v=t-q,y=0;if(7>v)m="";else for(v-=7;8<v;)0==y?(m+=" ",y=1):(m+=l,y=0),v-=7;l=e[g-1].getAttribute("ID")+"_"+e[g].getAttribute("ID");null==e[g].getAttribute("ID")&&(l=c.getAttribute("ID")+"_"+(g-1)+"_"+
g);a.svg.select("g#"+a.idPrefix+"tx"+c.getAttribute("ID")+" line#"+a.idPrefix+"Int"+l).attr("x1",q).attr("x2",t);a.svg.select("g#"+a.idPrefix+"tx"+c.getAttribute("ID")+" #"+a.idPrefix+"IntTxt"+l).attr("dx",q+1).text(m)}}});1==a.density?a.svg.attr("height",30):2==a.density?a.svg.attr("height",15*(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g."+a.idPrefix+"trx"+a.gsvg.levelNumber).size()+1)):3==a.density&&a.svg.attr("height",15*(a.trackYMax+1));a.redrawSelectedArea()}};a.drawTrx=
function(d,c){var h=d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).select("#"+a.idPrefix+"tx"+d.getAttribute("ID"));exList=getAllChildrenByName(getFirstChildByName(d,a.xmlTagBlockElem+"List"),a.xmlTagBlockElem);1===exList.length&&h.append("rect").attr("x",function(e){return a.xScale(exList[0].getAttribute("start"))-a.xScale(e.getAttribute("start"))}).attr("rx",1).attr("ry",1).attr("height",10).attr("width",function(e){e=a.xScale(exList[0].getAttribute("stop"))-a.xScale(exList[0].getAttribute("start"));
0<a.minFeatureWidth&&e<a.minFeatureWidth&&(e=a.minFeatureWidth);return e}).attr("id",function(e,g){var l=a.idPrefix+"Ex"+exList[0].getAttribute("ID");null==exList[0].getAttribute("ID")&&(l=a.idPrefix+"Ex"+e.getAttribute("ID")+"_0");return l}).style("fill",a.color).style("cursor","pointer")};a.draw=function(d){a.data=d;a.prevDensity=a.density;a.trackYMax=0;a.yArr=[];a.yArr[0]=[];for(var c=0;c<a.gsvg.width;c++)a.yMaxArr[c]=0,a.yArr[0][c]=0;a.svg.selectAll(".repeatLine"+a.gsvg.levelNumber).remove();
a.svg.selectAll(".repeatLbl"+a.gsvg.levelNumber).remove();if(2==a.density)for(c=0;c<a.typeList.length;c++)a.svg.append("line").attr("class","repeatLine"+a.gsvg.levelNumber).attr("x1",0).attr("x2",a.gsvg.width).attr("y1",12+15*(c+1)).attr("y2",12+15*(c+1)).attr("stroke","#000000").attr("stroke-width","1px"),a.svg.append("text").attr("x",5).attr("class","repeatLbl"+a.gsvg.levelNumber).attr("y",10+15*(c+1)).style("pointer-events","none").style("opacity","0.5").style("fill","#000000").style("font-size",
"11px").text(a.typeList[c].name),a.svg.append("text").attr("class","repeatLbl"+a.gsvg.levelNumber).attr("x",a.gsvg.width-5).attr("y",10+15*(c+1)).style("text-anchor","end").style("pointer-events","none").style("opacity","0.5").style("fill","#000000").style("font-size","11px").text(a.typeList[c].name);d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("."+a.idPrefix+"trx"+a.gsvg.levelNumber).remove();a.redrawLegend();d=d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("."+a.idPrefix+
"trx"+a.gsvg.levelNumber).data(d,key).attr("transform",function(h,e){return"translate("+a.xScale(h.getAttribute("start"))+","+a.calcY(parseInt(h.getAttribute("start"),10),parseInt(h.getAttribute("stop"),10),e,h)+")"});d.enter().append("g").attr("class",a.idPrefix+"trx"+a.gsvg.levelNumber).attr("transform",function(h,e){return"translate("+a.xScale(h.getAttribute("start"))+","+a.calcY(parseInt(h.getAttribute("start"),10),parseInt(h.getAttribute("stop"),10),e,h)+")"}).attr("id",function(h){return a.idPrefix+
"tx"+h.getAttribute("ID")}).style("cursor","move").on("mouseover",function(h){0==a.gsvg.isToolTip&&0!=a.trackClass.indexOf("custom")&&(d3.select(this).selectAll("line").style("stroke","green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(a.createToolTip(h)).style("left",function(){return a.positionTTLeft(d3.event.pageX)}).style("top",function(){return a.positionTTTop(d3.event.pageY)}),
1==a.ttSVG&&a.setupToolTipSVG(h,.05))}).on("mouseout",function(h){d3.select(this).selectAll("line").style("stroke",a.color);d3.select(this).selectAll("rect").style("fill",a.color);d3.select(this).selectAll("text").style("opacity","0.6").style("fill",a.color);tt.transition().delay(100).duration(200).style("opacity",0)}).each(a.drawTrx);d.exit().remove();1==a.density?a.svg.attr("height",30):2==a.density?a.svg.attr("height",15*a.typeList.length+15):3==a.density&&a.svg.attr("height",15*(a.trackYMax+2));
a.redrawSelectedArea()};a.getDisplayedData=function(){var d=d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("."+a.idPrefix+"trx"+a.gsvg.levelNumber);a.counts=[];var c={};d=d[0];var h=[],e=0;if("undefined"!==typeof d){for(var g=0;g<d.length;g++){var l=a.xScale(d[g].__data__.getAttribute("start")),m=a.xScale(d[g].__data__.getAttribute("stop"));if(0<=l&&l<=a.gsvg.width||0<=m&&m<=a.gsvg.width)"undefined"===typeof c[d[g].__data__.getAttribute("class")]?(c[d[g].__data__.getAttribute("class")]=
{},c[d[g].__data__.getAttribute("class")].value=1,c[d[g].__data__.getAttribute("class")].names=d[g].__data__.getAttribute("class")):c[d[g].__data__.getAttribute("class")].value=c[d[g].__data__.getAttribute("class")].value+1,h[e]=d[g].__data__,e++}a.counts=[];for(x in c)a.counts.push(c[x])}else a.counts=[];return h};a.draw(n);return a}
function GenericTranscriptTrack(p,n,r,u,f,b){var a=Track(p,n,r,u);a.dataFileName=r+".xml";a.xmlTag="Feature";a.xmlTagBlockElem="block";a.idPrefix="genTrx";a.ttSVG=0;a.ttTrackList=[];a.colorValueField="score";a.colorBy="Score";a.minValue=1;a.maxValue=1E3;a.minColor="#E6E6E6";a.maxColor="#000000";a.minFeatureWidth=-1;a.ttSVGMinWidth=0;a.legendLbl="";p=new String(b);if("undefined"!==typeof b&&0<p.length)for(b=p.split(","),p=0;p<b.length;p++)n=new String(b[p]),0==n.indexOf("colorBy=")?a.colorBy=n.substr(n.indexOf("=")+
1):0==n.indexOf("minColor=")?a.minColor=n.substr(n.indexOf("=")+1):0==n.indexOf("maxColor=")?a.maxColor=n.substr(n.indexOf("=")+1):0==n.indexOf("minValue=")?a.minValue=n.substr(n.indexOf("=")+1):0==n.indexOf("maxValue=")&&(a.maxValue=n.substr(n.indexOf("=")+1));a.createColorScale=function(){"undefined"!==typeof a.minColor&&"undefined"!==typeof a.maxColor&&(a.colorScale=d3.scaleLinear().domain([a.minValue,a.maxValue]).range([a.minColor,a.maxColor]))};a.createColorScale();a.setMinColor=function(d){a.minColor=
"#"+d;a.createColorScale();a.draw(a.data)};a.setMaxColor=function(d){a.maxColor="#"+d;a.createColorScale();a.draw(a.data)};a.setMinValue=function(d){a.minValue=d;a.createColorScale();a.draw(a.data)};a.setMaxValue=function(d){a.maxValue=d;a.createColorScale();a.draw(a.data)};a.setColorBy=function(d){a.colorBy=d;a.createColorScale();a.draw(a.data)};a.getDisplayID=function(d){return d.getAttribute("ID")};a.createToolTip=function(d){return""};a.getColorValue=function(d){return d.getAttribute(a.colorValueField)};
a.color=function(d){var c=d3.rgb("#FFFFFF");"Score"==a.colorBy?c=a.colorScale(a.getColorValue(d)):"Color"==a.colorBy&&(d=(new String(d.getAttribute("color"))).split(","),3==d.length&&(c=d3.rgb(d[0],d[1],d[2])));return c};a.savePrevious=function(){a.prevSetting={};a.prevSetting.density=a.density;a.prevSetting.colorValueField=a.colorValueField;a.prevSetting.colorBy=a.colorBy;a.prevSetting.minValue=a.minValue;a.prevSetting.maxValue=a.maxValue;a.prevSetting.minColor=a.minColor;a.prevSetting.maxColor=
a.maxColor};a.revertPrevious=function(){a.density=a.prevSetting.density;a.colorValueField=a.prevSetting.colorValueField;a.colorBy=a.prevSetting.colorBy;a.minValue=a.prevSetting.minValue;a.maxValue=a.prevSetting.maxValue;a.minColor=a.prevSetting.minColor;a.maxColor=a.prevSetting.maxColor;"Score"==a.colorBy&&a.createColorScale()};a.drawTrx=function(d,c){var h=d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).select("#"+a.idPrefix+"tx"+d.getAttribute("ID"));exList=getAllChildrenByName(getFirstChildByName(d,
a.xmlTagBlockElem+"List"),a.xmlTagBlockElem);for(var e=0;e<exList.length;e++)if(h.append("rect").attr("x",function(v){return a.xScale(exList[e].getAttribute("start"))-a.xScale(v.getAttribute("start"))}).attr("rx",1).attr("ry",1).attr("height",10).attr("width",function(v){v=a.xScale(exList[e].getAttribute("stop"))-a.xScale(exList[e].getAttribute("start"));0<a.minFeatureWidth&&v<a.minFeatureWidth&&(v=a.minFeatureWidth);return v}).attr("id",function(v,y){var w=a.idPrefix+"Ex"+exList[e].getAttribute("ID");
null==exList[e].getAttribute("ID")&&(w=a.idPrefix+"Ex"+v.getAttribute("ID")+"_"+e);return w}).style("fill",a.color).style("cursor","pointer"),0<e){var g=a.xScale(exList[e-1].getAttribute("stop"))-a.xScale(d.getAttribute("start")),l=a.xScale(exList[e].getAttribute("start"))-a.xScale(d.getAttribute("start"));h.append("line").attr("x1",g).attr("x2",l).attr("y1",5).attr("y2",5).attr("stroke",a.color).attr("stroke-width","2").attr("id",function(v,y){var w=a.idPrefix+"Int"+exList[e-1].getAttribute("ID")+
"_"+exList[e].getAttribute("ID");null==exList[e].getAttribute("ID")&&(w=a.idPrefix+"Int"+v.getAttribute("ID")+"_"+(e-1)+"_"+e);return w});var m=">";"-1"==d.getAttribute("strand")&&(m="<");var q=m;l-=g;var t=0;if(7>l)q="";else for(l-=7;8<l;)0==t?(q+=" ",t=1):(q+=m,t=0),l-=7;h.append("svg:text").attr("id",function(v){var y=a.idPrefix+"IntTxt"+exList[e-1].getAttribute("ID")+"_"+exList[e].getAttribute("ID");null==exList[e].getAttribute("ID")&&(y=a.idPrefix+"IntTxt"+v.getAttribute("ID")+"_"+(e-1)+"_"+
e);return y}).attr("dx",g+1).attr("dy","11").style("pointer-events","none").style("opacity","0.5").style("fill",a.color).style("font-size","16px").text(q)}};a.redraw=function(){if(a.prevDensity!=a.density)a.draw(a.data);else{a.yMaxArr=[];a.yArr=[];a.yArr[0]=[];for(var d=0;d<a.gsvg.width;d++)a.yMaxArr[d]=0,a.yArr[0][d]=0;a.trackYMax=0;d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g."+a.idPrefix+"trx"+a.gsvg.levelNumber).attr("transform",function(c,h){return"translate("+a.xScale(c.getAttribute("start"))+
","+a.calcY(parseInt(c.getAttribute("start"),10),parseInt(c.getAttribute("stop"),10),h)+")"}).each(function(c,h){for(var e=getAllChildrenByName(getFirstChildByName(c,a.xmlTagBlockElem+"List"),a.xmlTagBlockElem),g=0;g<e.length;g++){var l=a.idPrefix+"Ex"+e[g].getAttribute("ID");null==e[g].getAttribute("ID")&&(l=a.idPrefix+"Ex"+c.getAttribute("ID")+"_"+g);a.svg.select("g#"+a.idPrefix+"tx"+c.getAttribute("ID")+" rect#"+l).attr("x",function(w){return a.xScale(e[g].getAttribute("start"))-a.xScale(c.getAttribute("start"))}).attr("width",
function(w){return a.xScale(e[g].getAttribute("stop"))-a.xScale(e[g].getAttribute("start"))});if(0<g){l=">";"-1"==c.getAttribute("strand")&&(l="<");var m=l,q=a.xScale(e[g-1].getAttribute("stop"))-a.xScale(c.getAttribute("start")),t=a.xScale(e[g].getAttribute("start"))-a.xScale(c.getAttribute("start")),v=t-q,y=0;if(7>v)m="";else for(v-=7;8<v;)0==y?(m+=" ",y=1):(m+=l,y=0),v-=7;l=e[g-1].getAttribute("ID")+"_"+e[g].getAttribute("ID");null==e[g].getAttribute("ID")&&(l=c.getAttribute("ID")+"_"+(g-1)+"_"+
g);a.svg.select("g#"+a.idPrefix+"tx"+c.getAttribute("ID")+" line#"+a.idPrefix+"Int"+l).attr("x1",q).attr("x2",t);a.svg.select("g#"+a.idPrefix+"tx"+c.getAttribute("ID")+" #"+a.idPrefix+"IntTxt"+l).attr("dx",q+1).text(m)}}});1==a.density?a.svg.attr("height",30):2==a.density?a.svg.attr("height",15*(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g."+a.idPrefix+"trx"+a.gsvg.levelNumber).size()+1)):3==a.density&&a.svg.attr("height",15*(a.trackYMax+1));a.redrawSelectedArea()}};a.update=function(d){a.redraw()};
a.updateFullData=function(d,c){var h=a.xScale.domain()[0],e=a.xScale.domain()[1];a.showLoading();d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+a.gsvg.folderName+"/"+a.dataFileName,function(g,l){if(g){if(0==d||1==c){var m="/"+pathPrefix;pathPrefix||(m="");$.ajax({url:m+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:h,maxCoord:e,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:a.trackClass,
folder:a.gsvg.folderName},dataType:"json",success:function(q){gtag("event","generateTrackTranscript",{event_category:"browser"})},error:function(q,t,v){}})}3>d?(m=1E4,1==d&&(m=15E3),setTimeout(function(){a.updateFullData(d+1,0)},m)):(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+a.trackClass),d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).attr("height",15),a.gsvg.addTrackErrorRemove(a.svg,"#Level"+a.gsvg.levelNumber+a.trackClass),
a.hideLoading())}else null==l?4<=d?(m=[],a.draw(m),a.hideLoading()):setTimeout(function(){a.updateFullData(d+1,0)},5E3):(m=l.documentElement.getElementsByTagName(a.xmlTag),a.draw(m),a.hideLoading())})};a.redrawLegend=function(){var d=[];"Score"==a.colorBy?a.drawScaleLegend(a.minValue,a.maxValue+"+",a.legendLbl,a.minColor,a.maxColor,0):"Color"==a.colorBy&&(d[0]={color:"#FFFFFF",label:"User assigned color from track file."},a.drawLegend(d))};a.draw=function(d){a.data=d;a.prevDensity=a.density;a.trackYMax=
0;a.yArr=[];a.yArr[0]=[];for(var c=0;c<a.gsvg.width;c++)a.yMaxArr[c]=0,a.yArr[0][c]=0;d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("."+a.idPrefix+"trx"+a.gsvg.levelNumber).remove();a.redrawLegend();d&&(d=d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("."+a.idPrefix+"trx"+a.gsvg.levelNumber).data(d,key),d.enter().append("g").attr("class",a.idPrefix+"trx"+a.gsvg.levelNumber).attr("transform",function(h,e){return"translate("+a.xScale(h.getAttribute("start"))+","+a.calcY(parseInt(h.getAttribute("start"),
10),parseInt(h.getAttribute("stop"),10),e)+")"}).attr("id",function(h){return a.idPrefix+"tx"+h.getAttribute("ID")}).style("cursor","move").on("mouseover",function(h){0==a.gsvg.isToolTip&&0!=a.trackClass.indexOf("custom")&&(d3.select(this).selectAll("line").style("stroke","green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(a.createToolTip(h)).style("left",
function(){return a.positionTTLeft(d3.event.pageX)}).style("top",function(){return a.positionTTTop(d3.event.pageY)}),1==a.ttSVG&&a.setupToolTipSVG(h,.05))}).on("mouseout",function(h){d3.select(this).selectAll("line").style("stroke",a.color);d3.select(this).selectAll("rect").style("fill",a.color);d3.select(this).selectAll("text").style("opacity","0.6").style("fill",a.color);tt.transition().delay(100).duration(200).style("opacity",0)}).merge(d).each(a.drawTrx),d.exit().remove());1==a.density?a.svg.attr("height",
30):2==a.density?a.svg.attr("height",15*(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g."+a.idPrefix+"trx"+a.gsvg.levelNumber).size()+1)):3==a.density&&a.svg.attr("height",15*(a.trackYMax+2));a.redrawSelectedArea()};return a}
function CircRNATrack(p,n,r,u,f,b){var a=GenericTranscriptTrack(p,n,r,u,f,b);p=b.split(",");a.density=f;0<p.length&&(a.dataFileName=p[0].substr(9));a.colorBy=1<p.length?p[1]:"Score";2<p.length&&(a.minValue=p[2]);3<p.length&&(a.maxValue=p[3]);4<p.length&&(a.minColor=p[4]);5<p.length&&(a.maxColor=p[5]);a.colorValueField="score";a.minFeatureWidth=1;a.updateControl=0;a.xmlTag="Gene";a.xmlTagBlockElem="Block";a.idPrefix="cirRNA";a.xCirLineWidth=4;a.xPadding=7;a.featureHeight=30;"Score"==a.colorBy&&a.createColorScale();
a.color=function(d){var c=d3.rgb("#000000");"1"===d.getAttribute("Array")&&"1"===d.getAttribute("Ciri")&&"1"===d.getAttribute("Circexplorer")?c=d3.rgb("#DD9C56"):"0"===d.getAttribute("Array")&&"1"===d.getAttribute("Ciri")&&"1"===d.getAttribute("Circexplorer")?c=d3.rgb("#0f4c75"):"0"!==d.getAttribute("Array")||"1"!==d.getAttribute("Ciri")&&"1"!==d.getAttribute("Circexplorer")?"1"===d.getAttribute("Array")&&"0"===d.getAttribute("Ciri")&&"0"===d.getAttribute("Circexplorer")?c=d3.rgb("#5D576B"):"1"!==
d.getAttribute("Array")||"1"!==d.getAttribute("Ciri")&&"1"!==d.getAttribute("Circexplorer")||(c=d3.rgb("#7A9D98")):c=d3.rgb("#3282b8");return c};a.calcY=function(d,c,h){d=3===a.density||"3"===a.density?a.calcYPack(d,c,h):2===a.density||"2"===a.density?a.calcYFull(h):a.calcYDense();a.trackYMax<d/a.featureHeight&&(a.trackYMax=d/a.featureHeight);return d};a.calcYPack=function(d,c,h){if(d>=a.xScale.domain()[0]&&d<=a.xScale.domain()[1]||c>=a.xScale.domain()[0]&&c<=a.xScale.domain()[1]||d<=a.xScale.domain()[0]&&
c>=a.xScale.domain()[1]){d=Math.round(a.xScale(d));0>d&&(d=0);c=Math.round(a.xScale(c));c>=a.gsvg.width&&(c=a.gsvg.width-1);h=d-a.xPadding;0>h&&(h=0);var e=c+a.xPadding;e>=a.gsvg.width&&(e=a.gsvg.width-1);for(var g=0,l=h;l<=e;l++)a.yMaxArr[l]>g&&(g=a.yMaxArr[l]);g++;var m=g;if(a.yArr.length<=g)for(a.yArr[m]=[],l=0;l<a.gsvg.width;l++)a.yArr[m][l]=0;l=g-a.scanBackYLines;1>l&&(l=1);m=0;for(var q=l;q<g&&0==m;q++){var t=0;for(l=h;l<=e&&0==t;l++)a.yArr[q][l]>t&&(t=1);0==t&&(g=q,m=1)}g>a.trackYMax&&(a.trackYMax=
g);for(l=d;l<=c;l++)a.yMaxArr[l]<g&&(a.yMaxArr[l]=g),a.yArr[g][l]=1;d=g*a.featureHeight}else d=a.featureHeight;return d};a.calcYFull=function(d){return(d+1)*a.featureHeight};a.draw=function(d){a.data=d;a.prevDensity=a.density;a.trackYMax=0;a.yArr=[];a.yArr[0]=[];for(var c=0;c<a.gsvg.width;c++)a.yMaxArr[c]=0,a.yArr[0][c]=0;d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("."+a.idPrefix+"trx"+a.gsvg.levelNumber).remove();a.redrawLegend();d&&(d=d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("."+
a.idPrefix+"trx"+a.gsvg.levelNumber).data(d,key),d.enter().append("g").attr("class",a.idPrefix+"trx"+a.gsvg.levelNumber).attr("transform",function(h,e){return"translate("+a.xScale(h.getAttribute("start"))+","+a.calcY(parseInt(h.getAttribute("start"),10),parseInt(h.getAttribute("stop"),10),e)+")"}).attr("id",function(h){return a.idPrefix+"tx"+h.getAttribute("ID")}).style("cursor","move").on("mouseover",function(h){0==a.gsvg.isToolTip&&0!=a.trackClass.indexOf("custom")&&(d3.select(this).selectAll("line").style("stroke",
"green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(a.createToolTip(h)).style("left",function(){return a.positionTTLeft(d3.event.pageX)}).style("top",function(){return a.positionTTTop(d3.event.pageY)}),1==a.ttSVG&&a.setupToolTipSVG(h,.05))}).on("mouseout",function(h){d3.select(this).selectAll("line").style("stroke",a.color);d3.select(this).selectAll("rect").style("fill",
a.color);d3.select(this).selectAll("text").style("opacity","0.6").style("fill",a.color);tt.transition().delay(100).duration(200).style("opacity",0)}).merge(d).each(a.drawTrx),d.exit().remove());1==a.density?a.svg.attr("height",30):2==a.density?a.svg.attr("height",15*(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g."+a.idPrefix+"trx"+a.gsvg.levelNumber).size()+1)):3==a.density&&a.svg.attr("height",30*(a.trackYMax+2));a.redrawSelectedArea()};a.drawTrx=function(d,c){var h=d3.select("#Level"+
a.gsvg.levelNumber+a.trackClass).select("#"+a.idPrefix+"tx"+d.getAttribute("ID"));exList=getAllChildrenByName(getFirstChildByName(d,a.xmlTagBlockElem+"List"),a.xmlTagBlockElem);minStart=a.xScale(d.getAttribute("start"));maxEnd=a.xScale(d.getAttribute("stop"));h.append("line").attr("id",function(){return"l"+d.getAttribute("ID")+"_x1"}).attr("x1",function(){return a.calcXLine(exList,0,-1,"start",minStart)}).attr("x2",function(){return a.calcXLine(exList,0,-1,"start",minStart)}).attr("y1",5).attr("y2",
20).attr("stroke",a.color).attr("stroke-width","1");h.append("line").attr("id",function(){return"l"+d.getAttribute("ID")+"_x2"}).attr("x1",function(){return a.calcXLine(exList,exList.length-1,1,"stop",minStart)}).attr("x2",function(){return a.calcXLine(exList,exList.length-1,1,"stop",minStart)}).attr("y1",5).attr("y2",20).attr("stroke",a.color).attr("stroke-width","1");h.append("line").attr("id",function(){return"l"+d.getAttribute("ID")+"_x3"}).attr("x1",function(){return a.calcXLine(exList,0,-1,
"start",minStart)}).attr("x2",function(){return a.calcXLine(exList,exList.length-1,1,"stop",minStart)}).attr("y1",5).attr("y2",5).attr("stroke",a.color).attr("stroke-width","1");h.append("line").attr("id",function(){return"l"+d.getAttribute("ID")+"_x4"}).attr("x1",function(){return a.calcXLine(exList,0,-1,"start",minStart)}).attr("x2",function(){return a.calcXLine(exList,0,0,"start",minStart)}).attr("y1",20).attr("y2",20).attr("stroke",a.color).attr("stroke-width","1");h.append("line").attr("id",
function(){return"l"+d.getAttribute("ID")+"_x5"}).attr("x1",function(){return a.calcXLine(exList,exList.length-1,0,"stop",minStart)}).attr("x2",function(){return a.calcXLine(exList,exList.length-1,1,"stop",minStart)}).attr("y1",20).attr("y2",20).attr("stroke",a.color).attr("stroke-width","1");for(var e=0;e<exList.length;e++)if(h.append("rect").attr("x",function(v){return a.xScale(exList[e].getAttribute("start"))-a.xScale(v.getAttribute("start"))}).attr("y",15).attr("rx",1).attr("ry",1).attr("height",
10).attr("width",function(v){v=a.xScale(exList[e].getAttribute("stop"))-a.xScale(exList[e].getAttribute("start"));0<a.minFeatureWidth&&v<a.minFeatureWidth&&(v=a.minFeatureWidth);return v}).attr("id",function(v,y){var w=a.idPrefix+"Ex"+exList[e].getAttribute("ID");null==exList[e].getAttribute("ID")&&(w=a.idPrefix+"Ex"+v.getAttribute("ID")+"_"+e);return w}).style("fill",a.color).style("cursor","pointer"),0<e){var g=a.xScale(exList[e-1].getAttribute("stop"))-a.xScale(d.getAttribute("start")),l=a.xScale(exList[e].getAttribute("start"))-
a.xScale(d.getAttribute("start"));h.append("line").attr("x1",g).attr("x2",l).attr("y1",20).attr("y2",20).attr("stroke",a.color).attr("stroke-width","2").attr("id",function(v,y){var w=a.idPrefix+"Int"+exList[e-1].getAttribute("ID")+"_"+exList[e].getAttribute("ID");null==exList[e].getAttribute("ID")&&(w=a.idPrefix+"Int"+v.getAttribute("ID")+"_"+(e-1)+"_"+e);return w});var m=">";"-"===d.getAttribute("strand")&&(m="<");var q=m;l-=g;var t=0;if(7>l)q="";else for(l-=7;8<l;)0==t?(q+=" ",t=1):(q+=m,t=0),l-=
7;h.append("svg:text").attr("id",function(v){var y=a.idPrefix+"IntTxt"+exList[e-1].getAttribute("ID")+"_"+exList[e].getAttribute("ID");null==exList[e].getAttribute("ID")&&(y=a.idPrefix+"IntTxt"+v.getAttribute("ID")+"_"+(e-1)+"_"+e);return y}).attr("y",15).attr("dx",g+1).attr("dy","11").style("pointer-events","none").style("opacity","0.5").style("fill",a.color).style("font-size","16px").text(q)}};a.calcXLine=function(d,c,h,e,g){h*=a.xCirLineWidth;return 0<d.length?a.xScale(d[c].getAttribute(e))-g+
h:0+h};a.redraw=function(){if(a.prevDensity!=a.density)a.draw(a.data);else{a.yMaxArr=[];a.yArr=[];a.yArr[0]=[];for(var d=0;d<a.gsvg.width;d++)a.yMaxArr[d]=0,a.yArr[0][d]=0;a.trackYMax=0;d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g."+a.idPrefix+"trx"+a.gsvg.levelNumber).attr("transform",function(c,h){return"translate("+a.xScale(c.getAttribute("start"))+","+a.calcY(parseInt(c.getAttribute("start"),10),parseInt(c.getAttribute("stop"),10),h)+")"}).each(function(c,h){minStart=a.xScale(c.getAttribute("start"));
maxEnd=a.xScale(c.getAttribute("stop"));var e=getAllChildrenByName(getFirstChildByName(c,a.xmlTagBlockElem+"List"),a.xmlTagBlockElem);a.svg.select("#l"+c.getAttribute("ID")+"_x1").attr("x1",function(){return a.calcXLine(e,0,-1,"start",minStart)}).attr("x2",function(){return a.calcXLine(e,0,-1,"start",minStart)});a.svg.select("#l"+c.getAttribute("ID")+"_x2").attr("x1",function(){return a.calcXLine(e,e.length-1,1,"stop",minStart)}).attr("x2",function(){return a.calcXLine(e,e.length-1,1,"stop",minStart)});
a.svg.select("#l"+c.getAttribute("ID")+"_x3").attr("x1",function(){return a.calcXLine(e,0,-1,"start",minStart)}).attr("x2",function(){return a.calcXLine(e,e.length-1,1,"stop",minStart)});a.svg.select("#l"+c.getAttribute("ID")+"_x4").attr("x1",function(){return a.calcXLine(e,0,-1,"start",minStart)}).attr("x2",function(){return a.calcXLine(e,0,0,"start",minStart)});a.svg.select("#l"+c.getAttribute("ID")+"_x5").attr("x1",function(){return a.calcXLine(e,e.length-1,0,"stop",minStart)}).attr("x2",function(){return a.calcXLine(e,
e.length-1,1,"stop",minStart)});for(var g=0;g<e.length;g++){var l=a.idPrefix+"Ex"+e[g].getAttribute("ID");null==e[g].getAttribute("ID")&&(l=a.idPrefix+"Ex"+c.getAttribute("ID")+"_"+g);a.svg.select("g#"+a.idPrefix+"tx"+c.getAttribute("ID")+" rect#"+l).attr("x",function(w){return a.xScale(e[g].getAttribute("start"))-a.xScale(c.getAttribute("start"))}).attr("width",function(w){return a.xScale(e[g].getAttribute("stop"))-a.xScale(e[g].getAttribute("start"))});if(0<g){l=">";"-"===c.getAttribute("strand")&&
(l="<");var m=l,q=a.xScale(e[g-1].getAttribute("stop"))-a.xScale(c.getAttribute("start")),t=a.xScale(e[g].getAttribute("start"))-a.xScale(c.getAttribute("start")),v=t-q,y=0;if(7>v)m="";else for(v-=7;8<v;)0==y?(m+=" ",y=1):(m+=l,y=0),v-=7;l=e[g-1].getAttribute("ID")+"_"+e[g].getAttribute("ID");null==e[g].getAttribute("ID")&&(l=c.getAttribute("ID")+"_"+(g-1)+"_"+g);a.svg.select("g#"+a.idPrefix+"tx"+c.getAttribute("ID")+" line#"+a.idPrefix+"Int"+l).attr("x1",q).attr("x2",t);a.svg.select("g#"+a.idPrefix+
"tx"+c.getAttribute("ID")+" #"+a.idPrefix+"IntTxt"+l).attr("dx",q+1).text(m)}}});1==a.density?a.svg.attr("height",40):2==a.density?a.svg.attr("height",25*(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g."+a.idPrefix+"trx"+a.gsvg.levelNumber).size()+1)):3==a.density&&a.svg.attr("height",25*(a.trackYMax+1));a.redrawSelectedArea()}};a.updateFullData=function(d,c){if(a.updateControl==d){a.updateControl=d+1;var h=a.xScale.domain()[0],e=a.xScale.domain()[1];d3.xml(dataPrefix+"tmpData/browserCache/"+
genomeVer+"/regionData/"+a.gsvg.folderName+"/"+a.trackClass+".xml",function(g,l){if(g){console.log(g);if(0==d||1==c){var m="/"+pathPrefix;pathPrefix||(m="");$.ajax({url:m+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:h,maxCoord:e,folder:a.gsvg.folderName,track:a.trackClass,myOrganism:organism,genomeVer:genomeVer},dataType:"json",success:function(q){gtag("event","generateTrackCustomTranscript",{event_category:"browser"})},error:function(q,t,v){console.log(v)}})}3>
d?(m=1E4,1==d&&(m=15E3),setTimeout(function(){a.updateFullData(d+1,0)},m)):(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+a.trackClass),d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).attr("height",15),a.gsvg.addTrackErrorRemove(a.svg,"#Level"+a.gsvg.levelNumber+a.trackClass),a.hideLoading())}else m=l.documentElement.getElementsByTagName(a.xmlTag),a.draw(m),a.hideLoading(),a.updateControl=0})}};a.updateSettingsFromUI=function(){0<
$("#"+a.trackClass+"Dense"+a.level+"Select").length&&(a.density=$("#"+a.trackClass+"Dense"+a.level+"Select").val());0<$("#"+a.trackClass+a.level+"colorSelect").length&&(a.colorBy=$("#"+a.trackClass+a.level+"colorSelect").val())};a.generateSettingsDiv=function(d){var c=trackInfo[a.trackClass];a.savePrevious();d3.select(d).select("table").select("tbody").html("");if(0<c.Controls.length&&"null"!=c.Controls){var h=(new String(c.Controls)).split(",");d=d3.select(d).select("table").select("tbody");d.append("tr").append("td").style("font-weight",
"bold").html("Track Settings: "+c.Name);for(c=0;c<h.length;c++)if("undefined"!==typeof h[c]&&""!=h[c]){var e=h[c].split(";"),g=d.append("tr").append("td"),l=e[0].substr(5);3<e.length&&0==e[3].indexOf("Default=")&&e[3].substr(8);if(0==e[1].toLowerCase().indexOf("select")){g.append("text").text(l+": ");l=e[1].split(":");e=e[2].split("}");var m=a.trackClass+"Dense"+a.level+"Select";"colorSelect"==l[1]&&(m=a.trackClass+a.level+"colorSelect");g=g.append("select").attr("id",m).attr("name",l[1]);for(l=0;l<
e.length;l++){var q=e[l].substr(1).split(":");if(2==q.length){var t=g.append("option").attr("value",q[1]).text(q[0]);(-1<m.indexOf("Dense")&&q[1]==a.density||-1<m.indexOf("colorSelect")&&q[1]==a.colorBy)&&t.attr("selected","selected")}}d3.select("select#"+m).on("change",function(){"Score"==$(this).val()?$("div."+a.trackClass+"Scale"+a.level).show():"Color"==$(this).val()&&$("div."+a.trackClass+"Scale"+a.level).hide();a.updateSettingsFromUI();a.draw(a.data)})}else 0==e[1].toLowerCase().indexOf("txt")&&
(g=0==$("#colorTrack"+a.level).size()?g.append("div").attr("class",a.trackClass+"Scale"+a.level).style("display","none"):d3.select("#"+a.trackClass+"Scale"+a.level),g.append("text").text(l+": "),l=e[1].split(":"),e=e[2].split("}"),e="Data",m="text",q=a.minValue,t=a.maxValue,"color"==l[1]&&(m=e="Color",q=a.minColor,t=a.maxColor),g.append("input").attr("type",m).attr("id",a.trackClass+"min"+e+a.level).attr("class",l[1]).style("margin-left","5px").attr("value",q),g.append("text").text(" - "),g.append("input").attr("type",
m).attr("id",a.trackClass+"max"+e+a.level).attr("class",l[1]).style("margin-left","5px").attr("value",t),"Color"==e&&(testIE||testSafari)?($("#"+a.trackClass+"min"+e+a.level).spectrum({change:function(v){a.updateSettingsFromUI();a.draw(a.data)}}),$("#"+a.trackClass+"max"+e+a.level).spectrum({change:function(v){a.updateSettingsFromUI();a.draw(a.data)}})):($("input#"+a.trackClass+"min"+e+a.level).on("change",function(){a.updateSettingsFromUI();a.draw(a.data)}),$("input#"+a.trackClass+"max"+e+a.level).on("change",
function(){a.updateSettingsFromUI();a.draw(a.data)})))}"Score"==$("#"+a.trackClass+a.level+"colorSelect").val()?$("div."+a.trackClass+"Scale"+a.level).show():"Color"==$("#"+a.trackClass+a.level+"colorSelect").val()&&$("div."+a.trackClass+"Scale"+a.level).hide();h=d.append("tr").append("td");h.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");a.gsvg.removeTrack(a.trackClass);
var v=svgList[a.gsvg.levelNumber].currentView.ViewID,y=viewMenu[a.gsvg.levelNumber].findTrackByClass(a.trackClass,v);y=viewMenu[a.gsvg.levelNumber].findTrackIndexWithViewID(y.TrackID,v);viewMenu[a.gsvg.levelNumber].removeTrackWithIDIdx(y,v)});h.append("input").attr("type","button").attr("value","Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")});h.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left",
"5px").on("click",function(){a.revertPrevious();a.draw(a.data);$("#trackSettingDialog").fadeOut("fast")})}else d=d3.select(d).select("table").select("tbody"),d.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name),d.append("tr").append("td").html("Sorry no settings for this track."),h=d.append("tr").append("td"),h.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")}),
h.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")})};a.generateTrackSettingString=function(){return a.trackClass+","+a.density+","+a.colorBy+","+a.minValue+","+a.maxValue+","+a.minColor+","+a.maxColor+";"};a.updateFullData(0,0);a.redrawLegend=function(){a.drawLegend([{color:"#DD9C56",label:"All"},{color:"#0f4c75",label:"Predicted(Multi)"},{color:"#3282b8",label:"Predicted(Single)"},
{color:"#5D576B",label:"Array"},{color:"#7A9D98",label:"Array/Predicted"}])};return a}window.GenomeSVG=GenomeSVG;var reportSelectedTrack=null,loadedTrackTable=null,regionDetailLoaded={};$(document).on("click","span.detailMenu",function(p){p=$(this).attr("name");var n=$("span.detailMenu.selected").attr("name");$("div#"+n).hide();$("span.detailMenu.selected").removeClass("selected");$("span[name='"+p+"']").addClass("selected");$("div#"+p).show();if("undefined"!==typeof svgList[0]){n=svgList[0].xScale.domain()[0];var r=svgList[0].xScale.domain()[1];loadRegionReport(p,chr,n,r)}});
function loadRegionReport(p,n,r,u){n=n+":"+r+"-"+u;"regionTable"===p&&(n=n+":"+reportSelectedTrack);regionDetailLoaded[p]&&regionDetailLoaded[p]===n?"regionWGCNAEQTL"===p&&""===$("div#regionWGCNAEQTL").html()&&loadRegionWGCNA():("regionTable"==p&&null!=reportSelectedTrack?loadTrackTable():"regionEQTLTable"==p?($("div#regionEQTLTable").html('<span style="text-align:center;width:100%;"><img src="web/images/ucsc-loading.gif"><BR>Loading...</span>'),setTimeout(function(){loadEQTLTable()},750)):"regionWGCNAEQTL"==
p&&loadRegionWGCNA(),regionDetailLoaded[p]=n);gtag("event",p,{event_category:"loadRegionReport"})}
function loadTrackTable(){var p=svgList[0].xScale.domain()[0],n=svgList[0].xScale.domain()[1],r=chr+":"+minCoord+"-"+maxCoord+":"+reportSelectedTrack.trackClass;loadedTrackTable&&loadedTrackTable===r||(loadedTrackTable=r,r="",p={species:organism,minCoord:p,maxCoord:n,chromosome:chr,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,forwardPvalueCutoff:forwardPValueCutoff,folderName:regionfolderName,genomeVer:genomeVer,track:reportSelectedTrack.trackClass},-1<reportSelectedTrack.trackClass.indexOf("noncoding")?
(p.type="noncoding",p.source="ensembl",-1<reportSelectedTrack.trackClass.indexOf("brain")&&(p.source="brain"),r="web/GeneCentric/geneTable.jsp"):-1<reportSelectedTrack.trackClass.indexOf("coding")?(r="web/GeneCentric/geneTable.jsp",p.type="coding",p.source="ensembl",-1<reportSelectedTrack.trackClass.indexOf("brain")&&(p.source="brain")):"liverTotal"===reportSelectedTrack.trackClass||"heartTotal"===reportSelectedTrack.trackClass||"brainTotal"===reportSelectedTrack.trackClass||"mergedTotal"===reportSelectedTrack.trackClass?
(r="web/GeneCentric/geneTable.jsp",p.type="all",p.source="liver","heartTotal"===reportSelectedTrack.trackClass?p.source="heart":"brainTotal"===reportSelectedTrack.trackClass?p.source="brain":"mergedTotal"===reportSelectedTrack.trackClass&&(p.source="merged")):-1<reportSelectedTrack.trackClass.indexOf("smallnc")?(p.source="ensembl",-1<reportSelectedTrack.trackClass.indexOf("brain")?p.source="brain":-1<reportSelectedTrack.trackClass.indexOf("heart")&&(p.source="heart"),-1<reportSelectedTrack.trackClass.indexOf("liver")&&
(p.source="liver"),r="web/GeneCentric/smallGeneTable.jsp"):-1<(new String(reportSelectedTrack.trackClass)).indexOf("snp")||"qtl"===reportSelectedTrack.trackClass&&(r="web/GeneCentric/bqtlTable.jsp"),r&&loadDivWithPage("div#regionTable",r,!1,p,'<span style="text-align:center;width:100%;"><img src="web/images/ucsc-loading.gif"><BR>Loading...</span>'));gtag("event",reportSelectedTrack.trackClass,{event_category:"loadTrackTable"})}
function loadEQTLTable(){var p=svgList[0].xScale.domain()[0],n=svgList[0].xScale.domain()[1];transcriptome=$("#transriptome").val();cisOnly=$("#cisTrans").val();pValueCutoff=$("#pvalueCutoffSelect2").val();loadDivWithPage("div#regionEQTLTable","web/GeneCentric/regionEQTLTableSeq.jsp",!1,{species:organism,minCoord:p,maxCoord:n,chromosome:chr,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,pValueCutoff:pValueCutoff,folderName:regionfolderName,genomeVer:genomeVer,transcriptome:transcriptome,cisOnly:cisOnly},
'<span style="text-align:center;width:100%;"><img src="web/images/ucsc-loading.gif"><BR>Loading...</span>');gtag("event","eQTLTable",{event_category:"loadEQTLTable"})}
function loadRegionWGCNA(){$("div#geneWGCNA").html("");var p=svgList[0].xScale.domain()[0],n=svgList[0].xScale.domain()[1];loadDivWithPage("div#regionWGCNAEQTL","web/GeneCentric/wgcnaGene.jsp",!0,{region:chr+":"+p+"-"+n},'<span style="text-align:center;width:100%;"><img src="web/images/ucsc-loading.gif"><BR>Loading...</span>');gtag("event","wgcna",{event_category:"loadWGCNA"})}
function loadEQTLTableWParams(p,n,r,u,f){p=svgList[0].xScale.domain()[0];u=svgList[0].xScale.domain()[1];transcriptome=$("#transriptome").val();cisOnly=$("#cisTrans").val();pValueCutoff=$("#pvalueCutoffSelect2").val();loadDivWithPage("div#regionEQTLTable","web/GeneCentric/regionEQTLTableSeq.jsp",!1,{genomeVer:genomeVer,species:organism,minCoord:p,maxCoord:u,chromosome:chr,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,pValueCutoff:pValueCutoff,tissues:r,chromosomes:n,folderName:regionfolderName,
transcriptome:transcriptome,cisOnly:cisOnly},'<span style="text-align:center;width:100%;"><img src="web/images/ucsc-loading.gif"><BR>Loading...</span>');gtag("event","eqtlwparams",{event_category:"loadEQTLTableWParams"})}
function loadDivWithPage(p,n,r,u,f){$(p).html(f);$.ajax({url:n,type:"GET",cache:!1,data:u,dataType:"html",async:!0,success:function(b){$(p).html(b);r&&setTimeout(function(){$("html, body").animate({scrollTop:$(p).offset().top},200)},300)},error:function(b,a,d){$(p).html('<span style="color:#FF0000;">An error occurred generating this page.  Please try back later.</span>')}})}function trKey(p){var n="";p&&(n=p.trackClass);return n}
function DisplayRegionReport(){if(0<d3.select("#collapsableReportList").size()){var p=svgList[0].trackList;if(reportSelectedTrack)for(var n=0;n<p.length&&!reportSelectedTrack;n++)p[n]&&p[n].getDisplayedData&&(reportSelectedTrack=p[n]);p=d3.select("#collapsableReportList").selectAll("li.report").data(p,trKey).html(function(u){var f="";u&&u.getDisplayedData&&(f=u.getDisplayedData(),f=u.label+": "+f.length);return f});p.enter().append("li").attr("class",function(u){return u?"report "+u.trackClass:"report"}).html(function(u){var f=
"";u&&u.getDisplayedData&&(f=u.getDisplayedData(),f=u.label+": "+f.length);return f}).on("click",displayDetailedView);p.exit().remove();!$("div#collapsableReport").is(":hidden")&&reportSelectedTrack&&displayDetailedView(reportSelectedTrack)}p=$("span.detailMenu.selected").attr("name");n=svgList[0].xScale.domain()[0];var r=svgList[0].xScale.domain()[1];loadRegionReport(p,chr,n,r);gtag("event","regionReport",{event_category:"loadRegionReport"})}
function displayDetailedView(p){reportSelectedTrack=p;$("li.report").removeClass("selected");$("li."+p.trackClass).addClass("selected");p.displayBreakDown&&setTimeout(function(){$("div#trackGraph").html("");p.displayBreakDown("div#collapsableReport div#trackGraph")},50);var n=new String(p.trackClass);-1<n.indexOf("coding")||-1<n.indexOf("noncoding")||-1<n.indexOf("smallnc")||-1<n.indexOf("liverTotal")||-1<n.indexOf("heartTotal")||-1<n.indexOf("brainTotal")||-1<n.indexOf("mergedTotal")||"qtl"==n?($("#regionTableSubHeader").show(),
$("#regionTable").show()):($("#regionTableSubHeader").hide(),$("#regionTable").hide());$("div#regionTable").is(":hidden")||loadTrackTable();gtag("event",p,{event_category:"loaddetailedView"})}function DisplaySelectedDetailReport(p,n){loadDivWithPage("div#selectedReport",p,!1,n,'<span style="text-align:center;width:100%;"><img src="web/images/ucsc-loading.gif"><BR>Loading...</span>')};function ViewMenu(p){var n={};n.level=p;n.viewList=[];n.selectedTrackSetting=0;n.previewLevel=100;n.previewSVG=NaN;n.curOrg=(new String(organism)).toUpperCase();n.initialized=0;n.generatePreview=function(r){$("div#previewOuter"+n.level+" div#previewContent").html("");var u=(new String(organism)).toUpperCase();if("AA"===r.Organism||r.Organism===u){u=svgList[n.level].xScale.domain()[0];var f=svgList[n.level].xScale.domain()[1];n.previewSVG=toolTipSVG("div#previewOuter"+n.level+" div#previewContent",
555,u,f,n.previewLevel,chr,svgList[n.level].type);$("div#ScrollLevel"+n.previewLevel).css("overflow","auto").css("max-height","360px");if(r=n.generateSettingsString(r))loadStateFromString(r,"",n.previewLevel,n.previewSVG),n.previewSVG.updateData(),n.previewSVG.updateFullData()}else $("div#previewOuter"+n.level+" div#previewContent").html("No Preview Available: The current organism doesn't match the tracks included in this view.")};n.removeTrackWithID=function(r){r=n.findTrackIndex(r);var u=n.findSelectedView().ViewID;
n.removeTrackWithIDIdx(r,u);gtag("event","deleteTrack",{event_category:"BrowserViews"})};n.removeTrackWithIDIdx=function(r,u){var f=n.findViewWithID(u),b=n.findViewIndexByID(u);"undefined"!==typeof f&&"undefined"!==typeof f.TrackList&&(f.TrackList.splice(r,1),n.generateTrackList(f),n.findSelectedView().modified=1,n.generateViewList(),n.generatePreview(f),$("#viewSelect"+n.level).prop("selectedIndex",b))};n.generateTrackList=function(r){var u=[];d3.select("table#trackListTbl"+n.level).select("tbody").selectAll("tr").remove();
if("undefined"!==typeof r.TrackList)for(var f=0;f<r.TrackList.length;f++)"AA"!==r.TrackList[f].Organism&&r.TrackList[f].Organism!==n.curOrg||u.push(r.TrackList[f]);d3.select("table#trackListTbl"+n.level).select("tbody").selectAll("tr").data(u).enter().append("tr").attr("class",function(b,a){return 0===a%2?"even":"odd"}).attr("id",function(b){return"trk"+b.TrackID}).each(function(b,a){var d='<img src="'+iconPath+'grab_flat.png" style="cursor: move; cursor: -webkit-grab; cursor: -moz-grab; " class="handle'+
n.level+'">';d3.select(this).append("td").attr("class","ind").html(d+(a+1));d='  <span class="listtooltip'+n.level+'" title= "'+b.Description+'"><img src="'+iconPath+'info.gif"></span>';d3.select(this).append("td").html(b.Name+d);d="";"AA"!==b.Organism&&(d=b.Organism,"RN"===d?d="Rat":"MM"===d&&(d="Mouse"),d+=" only");d3.select(this).append("td").html(d);d='<span class="moveUp'+n.level+'" name="'+b.TrackID+'" style="cursor:pointer;" ><img src="'+iconPath+'up_flat.png"></span>';d=d+' <span class="moveDown'+
n.level+'" name="'+b.TrackID+'" style="cursor:pointer;"><img src="'+iconPath+'down_flat.png"></span>';b.Controls&&5<b.Controls.length&&(d=d+'&nbsp&nbsp&nbsp<span class="trackSetting'+n.level+'" name="'+b.TrackID+'" style="cursor:pointer;"><img src="'+iconPath+'gear_flat.png"></span>');d=d+'&nbsp&nbsp&nbsp<span class="delete'+n.level+'" name="'+b.TrackID+'" style="cursor:pointer;"><img src="'+iconPath+'del_flat.png"></span>';d3.select(this).append("td").html(d);d3.select("table#trackListTbl"+n.level).selectAll(".trackSetting"+
n.level).on("click",function(){var c=d3.select(this).attr("name");c!==n.selectedTrackSetting?(n.previewSVG.getTrack(n.findTrack(c).TrackClass).generateSettingsDiv("div#trackSettingContent"),n.selectedTrackSetting=c,c=$(this).position(),$("#trackSettingDialog").css("top",c.top+240).css("left",$(window).width()-415),$("#trackSettingDialog").fadeIn("fast")):$("#trackSettingDialog").fadeOut("fast")}).on("mouseover",function(){$("#controlInfo"+n.level).html("Click to edit track settings.")}).on("mouseout",
function(){$("#controlInfo"+n.level).html("")});d3.select("table#trackListTbl"+n.level).selectAll(".moveUp"+n.level).on("click",function(){var c=$(this).attr("name");$("tr#trk"+c).insertBefore($("table#trackListTbl"+n.level+" tbody tr:first"));n.findSelectedView().modified=1;n.updateTrackNumber("",$("tr#trk"+c))}).on("mouseover",function(){$("#controlInfo"+n.level).html("Click to move the track to the top of the list.")}).on("mouseout",function(){$("#controlInfo"+n.level).html("")});d3.select("table#trackListTbl"+
n.level).selectAll(".moveDown"+n.level).on("click",function(){var c=$(this).attr("name");$("tr#trk"+c).insertAfter($("table#trackListTbl"+n.level+" tbody tr:last"));n.findSelectedView().modified=1;n.updateTrackNumber("",$("tr#trk"+c))}).on("mouseover",function(){$("#controlInfo"+n.level).html("Click to move the track to the end of the list.")}).on("mouseout",function(){$("#controlInfo"+n.level).html("")});d3.select("table#trackListTbl"+n.level).selectAll(".delete"+n.level).on("click",function(){var c=
d3.select(this).attr("name");n.removeTrackWithID(c)}).on("mouseover",function(){$("#controlInfo"+n.level).html("Click to remove the track from the view.")}).on("mouseout",function(){$("#controlInfo"+n.level).html("")})});$("#trackListTbl"+n.level+" tbody").sortable({handle:".handle"+n.level,stop:n.updateTrackNumber}).disableSelection();$(".listtooltip"+n.level).tooltipster({position:"top-right",maxWidth:250,offsetX:10,offsetY:5,contentAsHTML:!0,interactive:!0,interactiveTolerance:350});gtag("event",
"generateTrackList",{event_category:"BrowserViews"})};n.applyView=function(){var r=n.findSelectedView(),u=n.generateSettingStringFromUI();n.setupImage(u,r);$("div.viewsLevel"+n.level).hide();$("div.trackLevel"+n.level).hide();u="/"+pathPrefix;"db"===r.Source&&(pathPrefix||(u=""),$.ajax({url:u+"addBrowserCount.jsp",type:"GET",cache:!1,data:{viewID:r.ViewID},dataType:"json",success:function(f){},error:function(f,b,a){},async:!0}));gtag("event","applyView",{event_category:"BrowserViews"})};n.applySelectedView=
function(r){for(var u=NaN,f=-1,b=0;b<n.filterList.length&&isNaN(u);b++)n.filterList[b].ViewID===r&&(u=n.filterList[b],f=b);r=n.generateSettingStringFromView(u);n.setupImage(r,u);$("#viewSelect"+n.level).prop("selectedIndex",f);n.selectChange();gtag("event","applySelectedView",{event_category:"BrowserViews"})};n.setupImage=function(r,u){svgList[n.level].removeAllTracks();svgList[n.level].currentView=u;svgViewIDList[n.level]=u.ViewID;loadStateFromString(r,u.imgSettings,n.level,svgList[n.level]);$("span#viewLbl"+
n.level).html("View: "+u.Name);0===u.UserID?($("li#menusaveView"+n.level).addClass("ui-state-disabled"),$("li#menudeleteView"+n.level).addClass("ui-state-disabled")):($("li#menusaveView"+n.level).removeClass("ui-state-disabled"),$("li#menudeleteView"+n.level).removeClass("ui-state-disabled"))};n.updateTrackNumber=function(r,u){$("td.ind",$("table#trackListTbl"+n.level)).each(function(b){var a='<img src="'+iconPath+'grab_flat.png" style="cursor: move; cursor: -webkit-grab; cursor: -moz-grab; " class="handle'+
n.level+'">    ';$(this).html(a+(b+1))});d3.select("table#trackListTbl"+n.level).select("tbody").selectAll("tr").attr("class",function(b,a){return 0===a%2?"even":"odd"});var f=n.findSelectedView();n.generatePreview(f)};n.generateSettingsString=function(r){var u="";d3.select("table#trackListTbl"+n.level).select("tbody").selectAll("tr").each(function(f){u=u+f.TrackClass+","+f.Settings+";"});return u};n.generateSettingStringFromUI=function(){return n.previewSVG.generateSettingsString()};n.getViewData=
function(){var r="/"+pathPrefix;pathPrefix||(r="");params={genomeVer:genomeVer};PhenogenAnonSession||(PhenogenAnonSession=SetupAnonSession(),PhenogenAnonSession.setupSession());params.UUID=PhenogenAnonSession.UUID;$.ajax({url:r+"getBrowserViews.jsp",type:"GET",data:params,dataType:"json",success:function(u){n.viewList=[];for(var f=0;f<u.length;f++)if("AA"===u[f].Organism||u[f].Organism===n.curOrg){for(var b=0,a=0;a<u[f].TrackList.length;a++){var d=u[f].TrackList[a];"AA"!==d.Organism&&d.Organism!==
n.curOrg||b++}u[f].orgCount=b;n.viewList.push(u[f])}trackInfo&&n.readCookieViews();n.generateViewList();0===n.initialized&&0===n.level?setTimeout(function(){n.initialized=1;n.applySelectedView($("#defaultView").val())},500):1===n.level&&(n.initialized=1,n.applySelectedView(svgViewIDList[n.level]));gtag("event","getViews",{event_category:"BrowserViews"})},error:function(u,f,b){}})};n.readCookieViews=function(){var r="";if(!0===isLocalStorage()){var u=localStorage.getItem("phenogenCustomViews");u&&
(r=u)}else $.cookie("phenogenCustomViews")&&(r=$.cookie("phenogenCustomViews"));if(r&&-1<r.indexOf("<///>"))for(r=r.split("<///>"),u=0;u<r.length;u++){var f=r[u].split("</>"),b={};for(g=0;g<f.length;g++){var a=f[g].split("=");if("TrackSettingList"===a[0]){a=a[1].split(";");b.TrackList=[];for(var d=0;d<a.length;d++)if(0<a[d].length){var c=a[d].substr(0,a[d].indexOf(",")),h=a[d].substr(a[d].indexOf(",")+1),e={};e.TrackClass=c;e.Settings=h;e.Order=d;b.TrackList.push(e)}}else 2>=a.length?b[a[0]]=a[1]:
2<a.length&&(a=f[g].substr(0,f[g].indexOf("=")),d=f[g].substr(f[g].indexOf("=")+1),b[a]=d)}b.Source="local";if(3<f.length){for(var g=f=0;g<b.TrackList.length;g++){if(a=trackInfo[b.TrackList[g].TrackClass])b.TrackList[g].TrackID=a.TrackID,b.TrackList[g].UserID=a.UserID,b.TrackList[g].Name=a.Name,b.TrackList[g].Description=a.Description,b.TrackList[g].Organism=a.Organism,b.TrackList[g].Controls=a.Controls;a=b.TrackList[g];"AA"!==a.Organism&&a.Organism!==n.curOrg||f++}b.orgCount=f;n.viewList.push(b)}}};
n.generateSettingStringFromView=function(r){var u="";r=r.TrackList;if("undefined"!==typeof r)for(var f=0;f<r.length;f++)u=u+r[f].TrackClass+","+r[f].Settings+";";return u};n.selectChange=function(){var r="",u=n.findSelectedView();"AA"!==u.Organism&&("RN"===u.Organism?r="<BR><BR>Available for Rat Only":"MM"===u.Organism&&(r="<BR><BR>Available for Mouse Only"));0===u.UserID?$("#deleteView"+n.level).hide():$("#deleteView"+n.level).show();$("div#descOuter"+n.level+" div#descContent").html(u.Description+
r);n.generateTrackList(u);n.generatePreview(u);$(".trackLevel"+n.level).is(":visible")&&trackMenu[n.level].generateTrackTable();$("#trackSettingDialog").hide()};n.setSelectedView=function(r){$("#viewTypeSelect"+n.level).val("all");n.generateViewList();r=n.findDisplayedIndex(r);$("#viewSelect"+n.level).prop("selectedIndex",r)};n.findSelectedView=function(){for(var r=$("#viewSelect"+n.level).val(),u=NaN,f=0;f<n.viewList.length&&isNaN(u);f++)n.viewList[f].ViewID===r&&(u=n.viewList[f]);return u};n.findViewWithID=
function(r){for(var u=NaN,f=0;f<n.viewList.length&&isNaN(u);f++)n.viewList[f].ViewID===r&&(u=n.viewList[f]);return u};n.findViewIndexByID=function(r){for(var u=NaN,f=0;f<n.viewList.length&&isNaN(u);f++)n.viewList[f].ViewID===r&&(u=f);return u};n.findSelectedViewIndex=function(){for(var r=$("#viewSelect"+n.level).val(),u=NaN,f=0;f<n.viewList.length&&isNaN(u);f++)n.viewList[f].ViewID===r&&(u=f);return u};n.findDisplayedIndex=function(r){for(var u=NaN,f=0;f<n.filterList.length&&isNaN(u);f++)n.filterList[f].ViewID===
r&&(u=f);return u};n.findTrackByClass=function(r,u){for(var f=n.findViewWithID(u).TrackList,b=NaN,a=0;a<f.length&&isNaN(b);a++)f[a].TrackClass===r&&(b=f[a]);return b};n.findTrack=function(r){for(var u=n.findSelectedView().TrackList,f=NaN,b=0;b<u.length&&isNaN(f);b++)u[b].TrackID===r&&(f=u[b]);return f};n.findTrackIndex=function(r){var u=n.findSelectedView().TrackList,f=NaN;if("undefined"!==typeof u)for(var b=0;b<u.length&&isNaN(f);b++)u[b].TrackID===r&&(f=b);return f};n.findTrackIndexWithViewID=function(r,
u){for(var f=n.findViewWithID(u).TrackList,b=NaN,a=0;a<f.length&&isNaN(b);a++)f[a].TrackID===r&&(b=a);return b};n.setupControls=function(){-1<p&&($(".control"+n.level+"#addTrack"+n.level).on("click",function(){if($(".trackLevel"+n.level).is(":visible"))$(".trackLevel"+n.level).fadeOut("fast");else{var r=$("div.viewsLevel"+n.level).position(),u=0;1200<=$(window).width()&&(u=-601);trackMenu[n.level].standalone=!1;$(".trackLevel"+n.level).css("top",r.top).css("left",r.left+u);r=n.findSelectedView();
$(".trackLevel"+n.level+" span#selectedViewName").html(r.Name);$(".trackLevel"+n.level).fadeIn("fast");$("div#selectTrack"+n.level).show();$("div#addUsrTrack"+n.level).hide();$("div#addUsrTrack"+n.level).hide();$("div#deleteUsrTrack"+n.level).hide();setTimeout(function(){trackMenu[n.level].generateTrackTable()},250)}}).on("mouseover",function(){$("#controlInfo"+n.level).html("Click to add a track to the current view.")}).on("mouseout",function(){$("#controlInfo"+n.level).html("")}),$(".control"+n.level+
"#addView"+n.level).on("click",function(){$("div#nameView"+n.level).show();$("div#selection"+n.level).hide();$("span#viewMenuLbl"+n.level).text("Create View");$("input#createType"+n.level).val("blank");$("input#function"+n.level).val("create")}).on("mouseover",function(){$("#topcontrolInfo"+n.level).html("Click to create a new view with no tracks.")}).on("mouseout",function(){$("#topcontrolInfo"+n.level).html("")}),$(".control"+n.level+"#copyView"+n.level).on("click",function(){$("div#nameView"+n.level).show();
$("div#selection"+n.level).hide();$("span#viewMenuLbl"+n.level).text("Create View");$("input#createType"+n.level).val("copy");$("input#function"+n.level).val("create")}).on("mouseover",function(){$("#topcontrolInfo"+n.level).html("Click to create a new view copied from the selected view.")}).on("mouseout",function(){$("#topcontrolInfo"+n.level).html("")}),$(".control"+n.level+"#saveView"+n.level).on("click",function(){var r=n.findSelectedView();0===r.UserID?($("#predefinedSaveAs"+n.level).show(),
n.saveAsView(r,n.previewSVG)):n.saveView(r.ViewID,n.previewSVG,!1)}).on("mouseover",function(){$("#topcontrolInfo"+n.level).html("Click to save changes to the currently selected view.")}).on("mouseout",function(){$("#topcontrolInfo"+n.level).html("")}),$(".control"+n.level+"#deleteView"+n.level).on("click",function(){var r=n.findSelectedViewIndex();n.confirmDeleteView(n.viewList[r])}).on("mouseover",function(){$("#topcontrolInfo"+n.level).html("Click to delete current view.")}).on("mouseout",function(){$("#topcontrolInfo"+
n.level).html("")}),$(".applyView"+n.level).on("click",function(){n.applyView()}),d3.select("#viewTypeSelect"+n.level).on("change",n.generateViewList).on("mouseover",function(){$("#topcontrolInfo"+n.level).html("Change to filter the view list by category.")}).on("mouseout",function(){$("#topcontrolInfo"+n.level).html("")}))};n.generateViewList=function(){d3.select("#viewSelect"+n.level).html("");n.filterList=[];for(var r=$("#viewTypeSelect"+n.level).val(),u=0;u<n.viewList.length;u++)("all"===r||"predefined"===
r&&0===n.viewList[u].UserID||"custom"===r&&0!==n.viewList[u].UserID)&&n.filterList.push(n.viewList[u]);d3.select("#viewSelect"+n.level).on("change",n.selectChange).on("mouseover",function(){$("#topcontrolInfo"+n.level).html("Click on a view to select it and view preview/details.")}).on("mouseout",function(){$("#topcontrolInfo"+n.level).html("")}).selectAll("option").data(n.filterList).enter().append("option").attr("value",function(f){return f.ViewID}).text(function(f){var b=f.Name;b=0===f.UserID?
b+"      (Predefined)":b+"     (Custom"+("local"===f.Source?" local":" server")+")";b=b+"     ("+f.orgCount+" tracks)";"AA"!==f.Organism&&("RN"===f.Organism?b+="      (Rat Only)":"MM"===f.Organism&&(b+="     (Mouse Only)"));f.modified&&1===f.modified&&(b+="   (Modified)");return b})};n.addTrackToView=function(r){var u=n.findSelectedView(),f=n.findSelectedViewIndex();u.TrackList.push(r);n.generateTrackList(u);n.generatePreview(u);n.generateViewList();$("#viewSelect"+n.level).prop("selectedIndex",f);
ga&&ga("send","event","BrowserViews","addTrackToView")};n.addTrackToViewWithID=function(r,u){var f=n.findViewWithID(r);f.TrackList.push(u);n.generateTrackList(f);n.generatePreview(f);n.generateViewList()};n.createNewView=function(){$("#predefinedSaveAs"+n.level).hide();if(0<uid)if("create"===$("#function"+n.level).val()){var r=$("input#viewNameTxt"+n.level).val(),u=$("#viewDescTxt"+n.level).val(),f=$("input#createType"+n.level).val(),b=-1;"copy"===f&&(b=n.findSelectedView().ViewID);var a="/"+pathPrefix;
pathPrefix||(a="");$.ajax({url:a+"createBrowserViews.jsp",type:"GET",cache:!1,data:{name:r,description:u,type:f,copyFrom:b,organism:organism},dataType:"json",success:function(d){n.getViewData();$("div#nameView"+n.level).hide();$("div#selection"+n.level).show();$("span#viewMenuLbl"+n.level).html("Select/Edit Views")},error:function(d,c,h){console.log(h)},async:!1})}else"saveAs"===$("#function"+n.level).val()&&(r=$("input#viewNameTxt"+n.level).val(),u=$("#viewDescTxt"+n.level).val(),a="/"+pathPrefix,
pathPrefix||(a=""),$.ajax({url:a+"createBrowserViews.jsp",type:"GET",cache:!1,data:{name:r,description:u,type:"blank",copyFrom:-1,organism:organism},dataType:"json",success:function(d){n.saveView(d.viewID,n.saveAsImg,!1);$("div#nameView"+n.level).hide();$("div#selection"+n.level).show();$("span#viewMenuLbl"+n.level).html("Select/Edit Views")},error:function(d,c,h){console.log(h)},async:!1}));else{r=$("input#viewNameTxt"+n.level).val();u=$("#viewDescTxt"+n.level).val();f=$("input#createType"+n.level).val();
b="";b=$.cookie("JSESSIONID");a=(new Date).getTime();b="ViewID="+(b+"_"+a)+"</>UserID=-999</>Name="+r+"</>Description="+u+"</>Organism="+organism.toUpperCase()+"</>imgSettings=displaySelect0=700;</>TrackSettingList=";if("saveAs"===$("#function"+n.level).val())r=n.saveAsImg.generateSettingsString(),b+=r;else if("copy"===f){r="";u=n.findSelectedView().TrackList;for(f=0;f<u.length;f++)r=r+u[f].TrackClass+","+u[f].Settings+";";b+=r}b+="<///>";!0===isLocalStorage()?(r=localStorage.getItem("phenogenCustomViews"))?
localStorage.setItem("phenogenCustomViews",r+b):localStorage.setItem("phenogenCustomViews",b):(r="",r=$.cookie("phenogenCustomViews")?$.cookie("phenogenCustomViews")+b:b,$.cookie("phenogenCustomViews",r));n.getViewData();$("div#nameView"+n.level).hide();$("div#selection"+n.level).show();$("span#viewMenuLbl"+n.level).html("Select/Edit Views")}$("input#viewNameTxt"+n.level).val("");$("#viewDescTxt"+n.level).val("");$("input#createType"+n.level).val("blank");getMainViewData(1);gtag("event","createView",
{event_category:"BrowserViews"})};n.saveView=function(r,u,f){if(0<uid){u=u.generateSettingsString();var b="/"+pathPrefix;pathPrefix||(b="");0<r&&$.ajax({url:b+"updateBrowserView.jsp",type:"GET",cache:!1,data:{viewID:r,trackList:u},dataType:"json",success:function(h){n.getViewData()},error:function(h,e,g){console.log(g)},async:f})}else{f=b="";if(!0===isLocalStorage()){var a=localStorage.getItem("phenogenCustomViews");a&&(b=a)}else $.cookie("phenogenCustomViews")&&(b=$.cookie("phenogenCustomViews"));
b=b.split("<///>");for(a=0;a<b.length;a++)if(10<b[a].length)if(-1<b[a].indexOf("ViewID="+r)){var d=b[a].substr(0,b[a].indexOf("</>TrackSettingList=")),c=u.generateSettingsString();f=f+d+"</>TrackSettingList="+c+"<///>"}else f=f+b+"<///>";!0===isLocalStorage()?localStorage.setItem("phenogenCustomViews",f):$.cookie("phenogenCustomViews",f);n.getViewData()}getMainViewData(1);gtag("event","saveView",{event_category:"BrowserViews"})};n.saveAsView=function(r,u){n.saveAs=r;n.saveAsImg=u;$("div#nameView"+
n.level).show();$("div#selection"+n.level).hide();$("span#viewMenuLbl"+n.level).text("Save As...");$("input#createType"+n.level).val("blank");$("input#function"+n.level).val("saveAs");gtag("event","saveAsView",{event_category:"BrowserViews"})};n.confirmDeleteView=function(r){n.findSelectedView().ViewID!==r.ViewID&&n.setSelectedView(r.ViewID);0<r.UserID||-999===Number(r.UserID)?($("div#selection"+n.level).hide(),$("#deleteViewName"+n.level).html(r.Name+"    ("+r.orgCount+" tracks)"),$("#confirmDeleteView"+
n.level).show()):$("#topcontrolInfo"+n.level).html("This is a predefined view, you may not delete it.")};n.cancelDeleteView=function(){$("#confirmDeleteView"+n.level).hide();$("div#selection"+n.level).show()};n.deleteView=function(){var r=n.findSelectedViewIndex(),u=n.viewList[r];if("db"===u.Source){var f="/"+pathPrefix;pathPrefix||(f="");$.ajax({url:f+"deleteView.jsp",type:"GET",data:{viewID:u.ViewID},dataType:"json",cache:!1,success:function(d){"Deleted Successfully"===d.status&&(n.viewList.splice(r,
1),n.generateViewList());$("#topcontrolInfo"+n.level).html(d.status)},error:function(d,c,h){console.log(h);$("#topcontrolInfo"+n.level).html("There was an error deleting this view.")},async:!0})}else{var b="";f="";if(!0===isLocalStorage()){var a=localStorage.getItem("phenogenCustomViews");a&&(b=a)}else $.cookie("phenogenCustomViews")&&(b=$.cookie("phenogenCustomViews"));b=b.split("<///>");for(a=0;a<b.length;a++)-1<b[a].indexOf("ViewID="+u.ViewID)||10<b[a].length&&(f=f+b[a]+"<///>");!0===isLocalStorage()?
localStorage.setItem("phenogenCustomViews",f):$.cookie("phenogenCustomViews",f);n.viewList.splice(r,1);n.generateViewList()}$("#confirmDeleteView"+n.level).hide();$("div#selection"+n.level).show();$("#viewSelect"+n.level).prop("selectedIndex",0);n.selectChange();svgList[n.level].currentView.ViewID===u.ViewID&&n.applyView();getMainViewData(1);gtag("event","deleteView",{event_category:"BrowserViews"})};n.cancelView=function(){$("div#nameView"+n.level).hide();$("div#selection"+n.level).show();$("#predefinedSaveAs"+
n.level).hide();$("span#viewMenuLbl"+n.level).html("Select/Edit Views")};n.getViewData();n.setupControls();return n};function TrackMenu(p){var n={};n.level=p;n.trackList=[];n.previewLevel=101;n.previewSVG=NaN;n.dataInitialized=0;n.trackDataTable;n.generateTrackTable=function(){for(var r=$("#trackTypeSelect"+n.level).val(),u=[],f=0,b=0;b<n.trackList.length;b++)!("all"===r||"allpublic"===r&&0===n.trackList[b].UserID||"custom"===r&&0!==n.trackList[b].UserID||"genome"===r&&"Genome"===n.trackList[b].GenericCategory||"trxome"===r&&"Transcriptome"===n.trackList[b].GenericCategory)||"AA"!==n.trackList[b].Organism.toUpperCase()&&
n.trackList[b].Organism.toUpperCase()!==organism.toUpperCase()&&n.trackList[b].Organism.toUpperCase()!==organism.toUpperCase()&&n.trackList[b].Organism.substring(0,2).toUpperCase()!==organism.toUpperCase()||0!==$("table#trackListTbl"+n.level+" tr#trk"+n.trackList[b].TrackID).length||(u[f]=n.trackList[b],f++);try{$.fn.DataTable.isDataTable("table#trkSelList"+n.level)&&n.trackDataTable.destroy()}catch(a){}"custom"===r&&0===u.length?($("#noCustomTracks").show(),0===uid?$("#notSignedIn1").show():$("#notSignedIn1").hide()):
($("#noCustomTracks").hide(),$("#notSignedIn1").hide());d3.select("table#trkSelList"+n.level).select("tbody").selectAll("tr").remove();d3.select("table#trkSelList"+n.level).select("tbody").selectAll("tr").data(u).enter().append("tr").attr("id",function(a){return"trk"+a.TrackID}).attr("class",function(a,d){var c="odd";0===d%2&&(c="even");return c}).each(function(a,d){var c="",h="";"local"===a.Source&&(h=" (Local)");0!==a.UserID&&(c=new String(a.SetupDate),c=c.substr(0,c.indexOf(":",c.indexOf(":")+
1)),c="<BR><BR>File:"+a.OriginalFile+"<BR><BR>Setup Date:"+c+"<BR><BR>Type:"+a.Type,"local"===a.Source&&(c+="<BR><BR>Local Track only available on this computer."));c='  <span class="trlisttooltip'+n.level+'" title= "'+a.Description+c+'"><img src="'+iconPath+'info.gif"></span>';d3.select(this).append("td").html(a.Name+h+c);h="";"RN"===a.Organism?h="Rat":"MM"===a.Organism&&(h="Mouse");c="Public";0!==a.UserID&&(c="Custom");d3.select(this).append("td").html(h);d3.select(this).append("td").html(a.GenericCategory);
d3.select(this).append("td").html(a.Category);d3.select(this).append("td").html(c)});$.fn.DataTable.isDataTable("table#trkSelList"+n.level)||(r=n.getInitTrackTableHeight(u),n.trackDataTable=$("table#trkSelList"+n.level).DataTable({bPaginate:!1,aaSorting:[[3,"asc"]],sScrollY:r,sDom:'<"rightSearch"fr><t>',columnDefs:[{width:"45%",targets:0}]}));n.trackDataTable.draw();$("td#selectedTrack"+n.level).hide();$("table#trkSelList"+n.level+" tbody").on("click","tr",function(){if(!$(this).hasClass("selected")){$("table#trkSelList"+
n.level+" tbody tr.selected").removeClass("selected");$(this).addClass("selected");$(this).attr("id");var a=n.findSelectedTrack(),d="Selected Track Name: "+a.Name+'  <span class="trInfotooltip'+n.level+'" title= "'+a.Description+'"><img src="'+iconPath+'info.gif"></span>';$("div#trackHeaderOuter"+n.level+" #trackHeaderContent").html(d);d=n.getTrackTableHeight(u);n.trackDataTable.settings()[0].oScroll.sy=d;try{n.trackDataTable.columns.adjust().draw()}catch(c){}$("#trkSelList"+n.level+"_wrapper div.dataTables_scroll div.dataTables_scrollBody").css("height",
d);$("td#selectedTrack"+n.level).show();$(".trInfotooltip"+n.level).tooltipster({position:"top-right",maxWidth:250,offsetX:10,offsetY:5,contentAsHTML:!0,interactive:!0,interactiveTolerance:350});n.generatePreview(a);(d=n.previewSVG.getTrack(a.TrackClass))&&d.generateSettingsDiv&&d.generateSettingsDiv("td#selectedTrack"+n.level);$("td#selectedTrack"+n.level+" #trackListTbl"+n.level+" tbody tr:first").remove();$("td#selectedTrack"+n.level+" #trackListTbl"+n.level+" tbody tr:last").remove();0!==a.UserID?
$("span#deleteCustomTrack"+n.level).show():$("span#deleteCustomTrack"+n.level).hide();d.updateSettingsFromUI()}});$(".trlisttooltip"+n.level).tooltipster({position:"top-right",maxWidth:250,offsetX:10,offsetY:5,contentAsHTML:!0,interactive:!0,interactiveTolerance:350})};n.getInitTrackTableHeight=function(r){var u="750px";0===r.length?u="30px":15>r.length&&(u=30*r.length+"px");return u};n.getTrackTableHeight=function(r){var u="300px";0===r.length?u="20px":10>r.length&&(u=30*r.length+"px");return u};
n.getTrackData=function(){var r="/"+pathPrefix;""===pathPrefix&&(r="");$.ajax({url:r+"getBrowserTracks.jsp",type:"GET",data:{genomeVer:genomeVer},dataType:"json",success:function(u){n.trackList=u;if(0===n.level)for(trackInfo=[],u=0;u<n.trackList.length;u++)trackInfo[n.trackList[u].TrackClass]=n.trackList[u];n.readCookieTracks();n.dataInitialized=1;n.generateTrackTable();trackMenu[n.level]&&trackMenu[n.level].readCookieViews&&(trackMenu[n.level].readCookieViews(),trackMenu[n.level].generateViewList())},
error:function(u,f,b){console.log(b)}})};n.readCookieTracks=function(){var r="";if(!0===isLocalStorage()){var u=localStorage.getItem("phenogenCustomTracks");u&&(r=u)}else $.cookie("phenogenCustomTracks")&&(r=$.cookie("phenogenCustomTracks"));if(r&&-1<r.indexOf("<;>"))for(r=r.split("<;>"),u=0;u<r.length;u++){var f=r[u].split("<->"),b={};for(k=0;k<f.length;k++){var a=f[k].split("=");if(2>=a.length)b[a[0]]=a[1];else if(2<a.length){a=f[k].substr(0,f[k].indexOf("="));var d=f[k].substr(f[k].indexOf("=")+
1);if("TrackID"===a||"TrackClass"===a)d=d.replace(/\./g,"_");b[a]=d}}b.Source="local";3<f.length&&(n.trackList.push(b),0===n.level&&(trackInfo[b.TrackClass]=b))}};n.findSelectedTrack=function(){var r=NaN;if(0<$("table#trkSelList"+n.level+" tbody tr.selected").length){var u=$("table#trkSelList"+n.level+" tbody tr.selected").attr("id");u=u.substr(3);for(var f=0;f<n.trackList.length&&isNaN(r);f++)n.trackList[f].TrackID===u&&(r=n.trackList[f])}return r};n.generateSettingsString=function(r){return r.TrackClass+
","+r.Settings+";"};n.generatePreview=function(r){$("div#trackPreviewOuter"+n.level+" div#trackPreviewContent").html("");var u=(new String(organism)).toUpperCase();if("AA"===r.Organism.substring(0,2)||r.Organism.substring(0,2)===u){u=svgList[n.level].xScale.domain()[0];var f=svgList[n.level].xScale.domain()[1];n.previewSVG=toolTipSVG("div#trackPreviewOuter"+n.level+" div#trackPreviewContent",565,u,f,n.previewLevel,chr,svgList[n.level].type);n.previewSVG.folderName=svgList[n.level].folderName;r=n.generateSettingsString(r);
loadStateFromString(r,"",n.previewLevel,n.previewSVG);n.previewSVG.updateData();n.previewSVG.updateFullData();$("div#trackPreviewContent div#ScrollLevel"+n.previewLevel).css("max-height","250px").css("overflow","auto")}else $("div#previewOuter"+n.level+" div#previewContent").html("No Preview Available: The current organism doesn't match the tracks included in this view.")};n.removeTrack=function(r){n.generateTrackTable()};n.confirmdeleteCustomTrack=function(){var r=n.findSelectedTrack();$("#deleteUsrTrack"+
n.level).show();$("#selectTrack"+n.level).hide();r="Name: <B>"+r.Name+"</B><BR>Description: <B>"+r.Description+"</B><BR>Original File: <B>"+r.OriginalFile+"</B><BR>Setup Date: <B>"+r.SetupDate+"</b>";$("span#customTrackInfo"+n.level).html(r);gtag("event","deleteCustomTrack",{event_category:"BrowserTracks"})};n.cancelDeleteTrack=function(){$("#deleteUsrTrack"+n.level).hide();$("#selectTrack"+n.level).show()};n.deleteTrack=function(){var r=n.findSelectedTrack();if("local"===r.Source){var u="TrackClass="+
r.TrackClass+"<->",f="";if(!0===isLocalStorage()){var b=localStorage.getItem("phenogenCustomTracks");b&&(f=b)}else $.cookie("phenogenCustomTracks")&&(f=$.cookie("phenogenCustomTracks"));if(f&&-1<f.indexOf("<;>")){var a="";f=f.split("<;>");for(b=0;b<f.length;b++)-1===f[b].indexOf(u)&&(a=a+f[b]+"<;>");u="/"+pathPrefix;pathPrefix||(u="");$.ajax({url:u+"removeCustomTrack.jsp",type:"GET",data:{trackID:r.TrackID},dataType:"json",success:function(d){!0===isLocalStorage()?localStorage.setItem("phenogenCustomTracks",
a):$.cookie("phenogenCustomTracks",a)},error:function(d,c,h){console.log(h)},async:!1})}}else"db"===r.Source&&(u="/"+pathPrefix,pathPrefix||(u=""),$.ajax({url:u+"deleteTrack.jsp",type:"GET",data:{trackID:r.TrackID},dataType:"json",success:function(d){"true"===d.success?$(".uploadStatus").html("<B>Track Setup Successfully</B>"):$(".uploadStatus").html("<B>Track Setup Failed</B>")},error:function(d,c,h){console.log(h)},async:!1}));n.getTrackData();$("#deleteUsrTrack"+n.level).hide();$("#selectTrack"+
n.level).show();n.generateTrackTable();gtag("event","deleteTrack",{event_category:"BrowserTracks"})};n.confirmUpload=function(){$("div#confirmUpload"+n.level).show();$("div#uploadBtn"+n.level).hide()};n.confirmBed=function(){$("input#hasconfirmBed"+n.level).val(1);n.createCustomTrack(n.level)};n.cancelUpload=function(){$("div#confirmUpload"+n.level).hide();$("div#confirmBed"+n.level).hide();$("div#uploadBtn"+n.level).show()};n.createCustomTrack=function(){$("div#confirmUpload"+n.level).hide();customTrackLevel=
n.level;var r=$("#usrtrkFileTypeSelect"+n.level).val();"bed"===r||"bg"===r?n.createUploadedCustomTrack():("bb"===r||"bw"===r)&&n.createRemoteCustomTrack();gtag("event","createCustomTrack",{event_category:"BrowserTracks"})};n.createUploadedCustomTrack=function(){var r=$("input#customUploadFile"+n.level)[0].files[0],u=$("#usrtrkFileTypeSelect"+n.level).val(),f=r.name,b=r.size/1024/1024;$(".uploadStatus").show();var a="";if(0<f.indexOf(".")){for(var d=f;-1<d.indexOf(".");)d=d.substr(d.indexOf(".")+1);
""!==d&&d!==f&&(a=d)}20>b?a!==u?"gz"===a||"tar"===a||"zip"===a||"exe"===a||"bin"===a?(setTimeout(function(){$("div#uploadBtn"+customTrackLevel).show();$(".progressInd").hide()},5E3),$(".uploadStatus").html("Error: Selected File Type is not supported.")):0===$("input#hasconfirmBed"+n.level).val()?$("div#confirmBed"+customTrackLevel).show():1===$("input#hasconfirmBed"+n.level).val()&&($("div#confirmBed"+customTrackLevel).hide(),n.createTrack(r)):n.createTrack(r):($("div#uploadBtn"+customTrackLevel).show(),
$(".progressInd").hide(),$(".uploadStatus").html("File is too large.  20MB is the current limit."))};n.createTrack=function(r){n.readFile(r)};n.createRemoteCustomTrack=function(){$(".uploadStatus").html("Setting up track...");$(".uploadStatus").show();var r=$("#customFileURL"+n.level).val(),u="",f=new Date;$.cookie("JSESSIONID")&&(u=$.cookie("JSESSIONID"),u=u+"_"+f.getTime());n.saveTrack(u,r)};n.saveTrack=function(r,u){var f=$("#usrtrkNameTxt"+n.level).val(),b=$("#usrtrkDescTxt"+n.level).val(),a=
$("#usrtrkOrgSelect"+n.level).val(),d=$("#usrtrkGenCatSelect"+n.level).val(),c=$("#usrtrkCatTxt"+n.level).val(),h="",e=$("#usrtrkFileTypeSelect"+n.level).val(),g="";if("bed"===e||"bg"===e)g=$("input#customUploadFile"+n.level)[0].files[0].name;var l="Color";0<$("#usrtrkColorSelect"+n.level).length&&(l=$("#usrtrkColorSelect"+n.level).val());if("Score"===l){var m="000000",q="FFFFFF",t=1,v=1E3;testIE||testSafari?(m=$("#usrtrkColorMin"+n.level).spectrum("get").toHexString(),q=$("#usrtrkColorMax"+n.level).spectrum("get").toHexString()):
(m=$("#usrtrkColorMin"+n.level).val(),q=$("#usrtrkColorMax"+n.level).val());m=m.substr(1);q=q.substr(1);t=$("#usrtrkScoreMinTxt"+n.level).val();v=$("#usrtrkScoreMaxTxt"+n.level).val()}"bed"===e?h="Name=View Density;Select:trackSelect:Dense:Select;{Dense:1}{Pack:3}{Full:2};Default=3,Name=Color by;Select:colorSelect::colorSelect;{Feature Defined:Color}{Score based scale:Score};Default="+l+",Name=Scale Range;Txt:tissuecbx;{min:1}{max:1000};Default="+t+":"+v+",Name=Color Range;Txt:color;{min:FFFFFF}{max:000000};Default="+
m+":"+q:"bg"===e?h="Name=View Density;Select:trackSelect:Dense:Select;{Dense:1}{Full:2};Default=1,Name=Scale Range;Slider:rangeslider;{min:1-1000}{max:1000-20000};Default=1:5000":"bw"===e?h="Name=View Density;Select:trackSelect:Dense:Select;{Dense:1}{Full:2};Default=1,Name=Scale Range;Slider:rangeslider;{min:1-1000}{max:1000-20000};Default=1:5000":"bb"===e&&(h="Name=View Density;Select:trackSelect:Dense:Select;{Dense:1}{Pack:3}{Full:2};Default=3,Name=Color by;Select:colorSelect::colorSelect;{Feature Defined:Color}{Score based scale:Score};Default="+
l+",Name=Scale Range;Txt:tissuecbx;{min:1}{max:1000};Default="+t+":"+v+",Name=Color Range;Txt:color;{min:FFFFFF}{max:000000};Default="+m+":"+q);r="custom"+r;0<uid?(l="/"+pathPrefix,pathPrefix||(l=""),$.ajax({url:l+"addTrack.jsp",type:"GET",data:{trackClass:r,trackName:f,trackDesc:b,trackOrg:a,genericCategory:d,category:c,controls:h,location:u,type:e,file:g},dataType:"json",success:function(y){"true"===y.success?$(".uploadStatus").html("<B>Track Setup Successfully</B>"):$(".uploadStatus").html("<B>Track Setup Failed</B>")},
error:function(y,w,A){console.log(A)},async:!1})):(l=new Date,f="TrackID="+r+"<->UserID=-999<->TrackClass="+r+"<->Name="+f+"<->Description="+b+"<->Organism="+a.toUpperCase(),f=f+"<->Settings=<->Order=0<->GenericCategory="+d+"<->Category="+c+"<->Controls="+h+"<->SetupDate="+l+"<->Type="+e+"<->OriginalFile="+g+"<->Location="+u,f=f+"<->genomeVer="+genomeVer,f+="<;>",!0===isLocalStorage()?((d=localStorage.getItem("phenogenCustomTracks"))&&(f=d+f),localStorage.setItem("phenogenCustomTracks",f)):($.cookie("phenogenCustomTracks")&&
(f=$.cookie("phenogenCustomTracks")+f),$.cookie("phenogenCustomTracks",f)),$(".uploadStatus").html("<B>Track Setup Successfully</B>"));$("div#finished"+n.level).show();$("input#customUploadFile"+n.level).val("");$("input#customURL"+n.level).val("");$("input#usrtrkNameTxt"+n.level).val("");$("#usrtrkDescTxt"+n.level).val("");$("input#usrtrkOrgSelect"+n.level).val("Rn");$("input#usrtrkGenCatSelect"+n.level).val("Genome");$("input#usrtrkCatTxt"+n.level).val("");$("#usrtrkColorSelect"+n.level).val("Color");
$("#customFileURL"+n.level).val("");n.getTrackData();gtag("event","saveTrack",{event_category:"BrowserTracks"})};n.readFile=function(r){var u=new FileReader;u.readAsText(r,"UTF-8");u.onload=n.sendFile};n.sendFile=function(r){$.ajax({url:pathPrefix+"trackUpload.jsp",type:"POST",contentType:"text/plain",xhr:function(){var u=$.ajaxSettings.xhr();u.upload.addEventListener("progress",n.progressHandlingFunction,!1);return u},data:r.target.result,processData:!1,cache:!1,dataType:"json",success:function(u){$(".uploadStatus").html("<B>Upload Completed Successfully</b>");
n.saveTrack(u.trackFile,u.trackFile);gtag("event","customTrackUploaded",{event_category:"BrowserTracks"})},error:function(u,f,b){console.log(b);$(".uploadStatus").html("Error:"+b);$("div#uploadBtn"+customTrackLevel).show()}})};n.progressHandlingFunction=function(r){$(".progressInd").show();$(".uploadStatus").html("Uploading...");r.lengthComputable&&$("progress").attr({value:r.loaded,max:r.total})};n.getTrackData();return n};$(window).resize(function(){"undefined"!==typeof wgcna&&("undefined"!==typeof wgcna.multiImage?wgcna.multiImage.draw():"undefined"!==typeof wgcna.singleImage&&wgcna.singleImage.draw())});function replaceDot(p){return p.replace(/\./g,"_")}function replaceUnderscore(p){return p.replace(/_/g,".")}function removeColon(p){return p.replace(/:/g,"")}
function WGCNABrowser(p,n,r,u,f,b){that={};that.singleID=p;that.region=n;that.dispType=u;that.viewType=f;that.geneList=r;that.moduleList=[];that.moduleGenes={};that.modules={};that.tissue=b;that.panel="";that.requests=0;that.skipGrey=1;that.chrLen=19;that.selSource="seq";that.version="5";that.moduleRequestList=[];that.modSelect="gene";that.modSelectCutoff=2;"Mm"===organism?(that.panel="ILS/ISS",that.wDSID=1):"Rn"===organism&&("rn5"===genomeVer?(that.panel="BNLx/SHR",that.chrLen=20,that.wDSID=2):(that.panel=
"BNLx/SHR",that.chrLen=20,"seq"===that.selSource?"5"===that.version?"Whole Brain"===b?that.wDSID=11:"Liver"===b&&(that.wDSID=12):"2"===that.version?"Whole Brain"===b?that.wDSID=8:"Liver"===b&&(that.wDSID=9):"Whole Brain"===b?that.wDSID=6:"Liver"===b&&(that.wDSID=7):"Whole Brain"===b?that.wDSID=3:"Heart"===b?that.wDSID=4:"Liver"===b&&(that.wDSID=5)));that.eQTLKey=function(a){return"Link_"+a.Snp};that.mirKey=function(a){return a.ID};that.modKey=function(a){return a.MODULE};that.removeInvalidIDChars=
function(a){"undefined"!==typeof a&&(-1<a.indexOf("*")&&(a=a.replace(/\*/g,"star")),-1<a.indexOf(" ")&&(a=a.replace(/\s/g,"_")),-1<a.indexOf(".")&&(a=a.replace(/\./g,"_")));return a};that.setup=function(){that.requestModuleList();that.createImageControls();that.createViewControls();that.createDataControls();$(".wgcnaControltooltip").tooltipster({position:"top-right",maxWidth:250,offsetX:5,offsetY:5,contentAsHTML:!0,interactive:!0,interactiveTolerance:350});gtag("event","setupWGCNA",{event_category:"setupWGCNA"})};
that.requestModuleList=function(){that.moduleGenes={};that.moduleList=[];that.modules={};var a=that.modSelect;"eQTL"==that.modSelect&&(a=a+":"+that.modSelectCutoff);$.ajax({url:pathPrefix+"getWGCNAModules.jsp",type:"GET",async:!0,data:{source:that.selSource,modFileType:that.viewtype,id:that.singleID,organism:organism,panel:that.panel,tissue:that.tissue,region:that.region,geneList:that.geneList,genomeVer:genomeVer,version:that.version,modSelection:a},dataType:"json",beforeSend:function(){$("#waitCircos").show();
for(var d=0;d<that.moduleRequestList.length;d++)that.moduleRequestList[d].abort();that.moduleRequestList=[];console.log(that.modSelect+":"+that.modSelectCutoff);console.log(a);console.log("request mod list:"+that.wDSID+":"+that.selSource)},success:function(d){$("#wgcnaGeneImage #message").hide();that.moduleList=[];0<d.length&&(1!==d.length||"grey"!==d[0].ModuleID)?setTimeout(function(){for(var c=0;c<d.length;c++)"grey"!==d[c].ModuleID&&(that.moduleList.push(d[c].ModuleID),that.requests++,that.requestModule(d[c].ModuleID),
"undefined"!==typeof d[c].GeneList&&(that.moduleGenes[d[c].ModuleID]=d[c].GeneList));that.refreshRegion(1E3);setTimeout(function(){$("html, body").animate({scrollTop:$("#multiWGCNAScroll").offset().top},100)},1200)},1):0===d.length?that.displayMessage("There are no transcripts with Affymetrix Probesets that represent this gene."):1===d.length&&"grey"===d[0].ModuleID&&that.displayMessage("Only the Grey module contains transcripts for this gene.  The Grey module contains all transcripts that did not have a high enough correlation with any other transcripts to be included in another module.");
gtag("event","requestModuleList",{event_category:"requestModuleList"})},error:function(d,c,h){}})};that.displayMessage=function(a){$("#waitCircos").hide();$("#wgcnaGeneImage #message").html("<BR><BR><h2>"+a+"</h2><BR><BR>").show()};that.refreshRegion=function(a){setTimeout(function(){that.createMultiWGCNAImage();0<that.requests?that.refreshRegion(2E3):1!==a&&(that.refreshRegion(1),$("#waitCircos").hide())},a)};that.requestModule=function(a,d){xhr=$.ajax({url:contextRoot+"tmpData/browserCache/"+genomeVer+
"/modules/ds"+that.wDSID+"/"+a+".json",type:"GET",async:!0,data:{},dataType:"json",success:function(c){console.log("success:"+contextRoot+"tmpData/browserCache/"+genomeVer+"/modules/ds"+that.wDSID+"/"+a+".json");setTimeout(function(){console.log("countingGeneInstances");console.log(a);if(0<that.singleID.length)that.countGeneInstance(that.singleID,c);else{var h=that.moduleGenes[a].split(",");c.GroupedGenes=h.length;that.countGeneInstance(that.moduleGenes[a],c)}that.modules[a]=c;that.requests--;d&&
d(a)},20);gtag("event",a,{event_category:"requestModule"})},error:function(c,h,e){console.log(e);that.requests--}});that.moduleRequestList.push(xhr)};that.scanFilter=function(a,d){var c=[];if(a)for(var h=0;h<a.length;h++)d(a[h])&&c.append(a[h]);return c};that.countGeneInstance=function(a,d){var c=d.TCList,h=0;d.selectGeneTC={};for(var e=0;e<c.length;e++)-1<a.indexOf(c[e].Gene.ID)&&h++;d.GeneCount=h};that.createImageControls=function(){that.imageBar=d3.select("#imageControl").append("span").style("float",
"left");that.imageBar.append("span").attr("class","saveImage control").style("display","inline-block").attr("id","saveImage").style("cursor","pointer").append("img").attr("src",contextRoot+"web/images/icons/savePic_dark.png").attr("pointer-events","all").attr("cursor","pointer").on("click",function(){var a="";if(that.singleImage){"eqtl"===that.viewType&&"eqtl"===that.singleImage.type?a=$("div#circos").html():"gene"===that.viewType&&"gene"===that.singleImage.type?a=$("div#viewGene").html():"mir"===
that.viewType&&"mir"===that.singleImage.type?a=$("div#viewGene").html():"go"===that.viewType&&"go"===that.singleImage.type&&(a=$("div#viewGene").html());var d=$(window).width();a=a.replace('width="100%"','width="'+d+'px"');$.ajax({url:pathPrefix+"saveBrowserImage.jsp",type:"POST",contentType:"text/html",data:a+"\n",processData:!1,dataType:"json",success:function(c){var h=new Date;h=h.getMonth()+1+"_"+h.getDate()+"_"+h.getFullYear();var e="http://";"https:"===location.protocol&&(e="https://");var g=
e+urlprefix+"/tmpData/download/"+c.imageFile;c="";that.selectedModule&&(c=new String(that.selectedModule.MOD_NAME));c=c+"_"+that.viewType;var l=c+"_"+h+".png",m=new XMLHttpRequest;m.open("GET",g);m.responseType="blob";m.send();m.onreadystatechange=function(){if(4!=m.readyState||200!=m.status)return!1;var q=document.createElement("a");q.href=window.URL.createObjectURL(m.response);q.download=l;q.style.display="none";document.body.appendChild(q);try{q.click()}catch(t){$("#wgcnaMouseHelp").html("<span style='color:#FF0000;'>Your browser will not save the image directly. Image will open in a popup, in the new window right click to save image.</span>"),
window.open(g)}return!0}},error:function(c,h,e){console.log(e)}});gtag("event","saveWGCNAView",{event_category:"saveWGCNAView"})}}).on("mouseover",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/savePic_white.png");$("#wgcnaMouseHelp").html("Click to download a PNG image of the current view.")}).on("mouseout",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/savePic_dark.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});
that.imageBar.append("span").attr("class","reset control").style("display","inline-block").attr("id","wgcnaresetImage").style("cursor","pointer").append("img").attr("src",contextRoot+"web/images/icons/reset_dark.png").attr("pointer-events","all").attr("cursor","pointer").on("click",function(){that.singleImage&&("eqtl"===that.viewType?that.singleImage.panZoomCircos.reset():"undefined"!==typeof that.singleImage&&that.singleImage.panZoom.reset());gtag("event","resetWGCNAView",{event_category:"resetWGCNAView"})}).on("mouseover",
function(){d3.select(this).attr("src",contextRoot+"web/images/icons/reset_white.png");$("#wgcnaMouseHelp").html("Click to reset image zoom to initial region.")}).on("mouseout",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/reset_dark.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});that.imageBar.append("span").attr("class","zoomIn control").style("display","inline-block").style("cursor","pointer").style("position",
"relative").style("top","7px").attr("id","wgcnazoomInImage").append("img").attr("src",contextRoot+"web/images/icons/magPlus_dark_32.png").attr("pointer-events","all").attr("cursor","pointer").style("position","relative").style("top","-5px").on("click",function(){"eqtl"===that.viewType&&that.singleImage?that.singleImage.panZoomCircos.zoomIn():void 0==that.singleImage&&that.multiImage?that.multiImage.zoomIn():"undefined"!==typeof that.singleImage&&that.singleImage&&that.singleImage.panZoom.zoomIn();
gtag("event","zoomInWGCNAView",{event_category:"zoomInWGCNAView"})}).on("mouseover",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/magPlus_light_32.png");$("#wgcnaMouseHelp").html("Click to zoom in.")}).on("mouseout",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/magPlus_dark_32.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});that.imageBar.append("span").attr("class","zoomOut control").style("display",
"inline-block").style("cursor","pointer").style("position","relative").style("top","7px").attr("id","wgcnazoomOutImage").append("img").attr("src",contextRoot+"web/images/icons/magMinus_dark_32.png").attr("pointer-events","all").attr("cursor","pointer").style("position","relative").style("top","-5px").on("click",function(){"eqtl"===that.viewType&&that.singleImage?that.singleImage.panZoomCircos.zoomOut():void 0==that.singleImage&&that.multiImage?that.multiImage.zoomOut():that.singleImage&&"undefined"!==
typeof that.singleImage&&"undefined"!==typeof that.singleImage.panZoom&&that.singleImage.panZoom.zoomOut();gtag("event","zoomOutWGCNAView",{event_category:"zoomOutWGCNAView"})}).on("mouseover",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/magMinus_light_32.png");$("#wgcnaMouseHelp").html("Click to zoom out.")}).on("mouseout",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/magMinus_dark_32.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});
that.imageBar.append("span").attr("class","back control").style("display","inline-block").style("cursor","pointer").style("position","relative").style("top","7px").attr("id","backModule").append("img").attr("src",contextRoot+"web/images/icons/back_dark_32.png").attr("pointer-events","all").attr("cursor","pointer").style("position","relative").style("top","-5px").on("click",function(){that.multiImage.backModule()}).on("mouseover",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/back_light_32.png");
$("#wgcnaMouseHelp").html("Click to move to the previous module.")}).on("mouseout",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/back_dark_32.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});that.imageBar.append("span").attr("class","forward control").style("display","inline-block").style("cursor","pointer").style("position","relative").style("top","7px").attr("id","forwardModule").append("img").attr("src",contextRoot+
"web/images/icons/forward_dark_32.png").attr("pointer-events","all").attr("cursor","pointer").style("position","relative").style("top","-5px").on("click",function(){that.multiImage.forwardModule()}).on("mouseover",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/forward_light_32.png");$("#wgcnaMouseHelp").html("Click to move to the next module.")}).on("mouseout",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/forward_dark_32.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")})};
that.createViewControls=function(){that.viewBar=d3.select("#viewControl").append("div").attr("id","wgcnaViewControls").style("float","right").style("margin-left","10px").style("margin-right","5px").style("text-align","left");that.viewBar.append("text").text("Views:");that.viewBar.append("span").attr("id","HelpWGCNAView").append("img").attr("src",contextRoot+"web/images/icons/help.png");that.viewBar.append("br");that.viewBar.append("input").attr("type","radio").attr("id","wgcnaGeneViewRB").attr("name",
"wgcnaViewRB").attr("value","gene").attr("checked","checked").style("margin-left","7px").style("margin-right","3px").on("click",function(){that.viewType="gene";that.createSingleWGCNAImage();gtag("event","moduleView",{event_category:"WGCNA"})});that.viewBar.append("text").text("Module");that.viewBar.append("span").attr("class","wgcnaControltooltip").attr("title",'View transcripts within the selected module and their connectivity based on correlation of expression.<BR><BR>Have a question about this view click the <img src="'+
contextRoot+'web/images/icons/help.png"> above for a detailed description of each view.').style("margin-left","5px").append("img").attr("src","/web/images/icons/info.gif");that.viewBar.append("br");that.viewBar.append("input").attr("type","radio").attr("id","wgcnaEQTLViewRB").attr("name","wgcnaViewRB").attr("value","eqtl").style("margin-left","7px").style("margin-right","3px").on("click",function(){that.viewType="eqtl";that.createSingleWGCNAImage();gtag("event","eQTLView",{event_category:"WGCNA"})});
that.viewBar.append("text").text("Eigengene eQTL");that.viewBar.append("span").attr("class","wgcnaControltooltip").attr("title",'View Circos plot of the module Eigengene eQTLs.<BR><BR>Have a question about this view click the <img src="'+contextRoot+'web/images/icons/help.png"> above for a detailed description of each view.').style("margin-left","5px").append("img").attr("src","/web/images/icons/info.gif");that.viewBar.append("br");that.viewBar.append("input").attr("type","radio").attr("id","wgcnaGOViewRB").attr("name",
"wgcnaViewRB").attr("value","go").style("margin-left","7px").style("margin-right","3px").attr("disabled",function(){return 10<that.wDSID?!0:!1}).on("click",function(){that.viewType="go";that.createSingleWGCNAImage();gtag("event","goView",{event_category:"WGCNA"})});that.viewBar.append("text").text("Gene Ontology");that.viewBar.append("span").attr("class","wgcnaControltooltip").attr("title",'TEMPORARILY DISABLED PLEASE CHECK BACK. View a summary of Gene Ontology terms assigned to transcripts in the selected module.<BR><BR>Have a question about this view click the <img src="'+
contextRoot+'web/images/icons/help.png"> above for a detailed description of each view.').style("margin-left","5px").append("img").attr("src","/web/images/icons/info.gif");that.viewBar.append("br");that.viewBar.append("input").attr("type","radio").attr("id","wgcnaMirViewRB").attr("name","wgcnaViewRB").attr("value","mir").style("margin-left","7px").style("margin-right","3px").on("click",function(){that.viewType="mir";that.createSingleWGCNAImage();gtag("event","mirView",{event_category:"WGCNA"})});
that.viewBar.append("text").text("miRNA Targets");that.viewBar.append("span").attr("class","wgcnaControltooltip").attr("title",'View a summary of miRNAs that target genes in this module.<BR><BR>Have a question about this view click the <img src="'+contextRoot+'web/images/icons/help.png"> above for a detailed description of each view.').style("margin-left","5px").append("img").attr("src","/web/images/icons/info.gif");that.viewBar.append("br");that.viewBar.append("input").attr("type","radio").attr("id",
"wgcnaMetaViewRB").attr("name","wgcnaViewRB").attr("value","meta").style("margin-left","7px").style("margin-right","3px").attr("disabled",function(){return 10<that.wDSID?!0:!1}).on("click",function(){that.viewType="meta";that.createSingleWGCNAImage();gtag("event","metaView",{event_category:"WGCNA"})});that.viewBar.append("text").text("Meta Module (nearest neighbors)");that.viewBar.append("span").attr("class","wgcnaControltooltip").attr("title",'View most closely correlated modules and browse those modules.<BR><BR>Have a question about this view click the <img src="'+
contextRoot+'web/images/icons/help.png"> above for a detailed description of each view.').style("margin-left","5px").append("img").attr("src","/web/images/icons/info.gif");$("#HelpWGCNAView").on("click",function(a){var d=$(this).attr("id");$("#"+d+"Content").dialog("option","position",{my:"right top",at:"left bottom",of:$(this)});$("#"+d+"Content").dialog("open").css({"font-size":12});a.stopPropagation()})};that.createDataControls=function(){that.dataBar=d3.select("#dataControl").append("span").attr("id",
"wgcnaDataControls").style("margin-left","10px").style("margin-right","5px").append("table").append("tr");var a=that.dataBar.append("td");a.append("text").text("Data Source:");var d=a.append("select").attr("id","wgcnaSourceSelect").on("change",function(){$("#singleWGCNASVG").hide();d3.select("#multiWGCNASVG").remove();$("#circosModule").hide();$("#wgcnaModuleTable").hide();$("#wgcnaMirTable").hide();$("#wgcnaMirGeneTable").hide();$("#wgcnaGoTable").hide();$("#wgcnaEqtlTable").hide();that.selSource=
$("#wgcnaSourceSelect").val();that.tissue=$("#wgcnaTissueSelect").val();"array"===that.selSource?($("span#spanVersion").hide(),"Whole Brain"===that.tissue?that.wDSID=3:"Heart"===that.tissue?that.wDSID=4:"Liver"===that.tissue&&(that.wDSID=5),d3.select("#wgcnaTissueSelect").append("option").attr("value","Heart").text("Heart")):"seq"===that.selSource&&($("span#spanVersion").show(),"Whole Brain"===that.tissue?(that.wDSID=11,"2"===that.version?that.wDSID=8:"1"===that.version&&(that.wDSID=6)):"Liver"===
that.tissue?(that.wDSID=12,"2"===that.version?that.wDSID=9:"1"===that.version&&(that.wDSID=7)):(that.wDSID=11,that.version="5",d3.select("#wgcnaTissueSelect").select('option[value="Brain"]').attr("selected","selected"),d3.select("#wgcnaVersionSelect").select('option[value="2"]').attr("selected","selected")),d3.select("#wgcnaTissueSelect").select('option[value="Heart"]').remove());that.requestModuleList()});that.sources=["array"];that.dispSources=["Arrays"];"Rn"===organism&&"rn6"===genomeVer&&(that.sources=
["seq","array"],that.dispSources=["RNA-Seq","Arrays"]);for(var c=0;c<that.sources.length;c++)d.append("option").attr("value",that.sources[c]).text(that.dispSources[c]);a.append("br");a.append("text").text("Tissue:");d=a.append("select").attr("id","wgcnaTissueSelect").on("change",function(){$("#singleWGCNASVG").hide();d3.select("#multiWGCNASVG").remove();$("#circosModule").hide();$("#wgcnaModuleTable").hide();$("#wgcnaMirTable").hide();$("#wgcnaMirGeneTable").hide();$("#wgcnaGoTable").hide();$("#wgcnaEqtlTable").hide();
that.selSource=$("#wgcnaSourceSelect").val();that.tissue=$("#wgcnaTissueSelect").val();"array"===that.selSource?"Whole Brain"===that.tissue?that.wDSID=3:"Heart"===that.tissue?that.wDSID=4:"Liver"===that.tissue&&(that.wDSID=5):"seq"===that.selSource&&("Whole Brain"===that.tissue?(that.wDSID=11,"2"===that.version?that.wDSID=8:"1"===that.version&&(that.wDSID=6)):"Liver"===that.tissue&&(that.wDSID=12,"2"===that.version?that.wDSID=9:"1"===that.version&&(that.wDSID=7)));that.requestModuleList()});that.tissues=
["Brain"];that.dispTissues=["Whole Brain"];"Rn"===organism&&"rn6"===genomeVer&&(that.source&&"arrays"===that.source?(that.tissues=["Whole Brain","Heart","Liver"],that.dispTissues=["Whole Brain","Heart","Liver"]):(that.tissues=["Whole Brain","Liver"],that.dispTissues=["Whole Brain","Liver"]));for(c=0;c<that.tissues.length;c++)d.append("option").attr("value",that.tissues[c]).text(that.dispTissues[c]);a.append("br");c=a.append("span").attr("id","spanVersion");c.append("text").text("Version:");d=c.append("select").attr("id",
"wgcnaVersionSelect").on("change",function(){that.version=$("#wgcnaVersionSelect").val();"Whole Brain"===that.tissue?(that.wDSID=11,"2"===that.version?that.wDSID=8:"1"===that.version&&(that.wDSID=6)):"Liver"===that.tissue&&(that.wDSID=12,"2"===that.version?that.wDSID=9:"1"===that.version&&(that.wDSID=7));that.requestModuleList()});that.ver=["5","2","1"];that.dispVer=["HRDP v5","HRDP v4","HRDP v3"];for(c=0;c<that.ver.length;c++)d.append("option").attr("value",that.ver[c]).text(that.dispVer[c]);d3.select("#wgcnaVersionSelect").select('option[value="'+
that.version+'"]').attr("selected","selected");a.append("br");c=a.append("span").attr("id","spanReturnType");c.append("text").text("Module selection by:");d=c.append("select").attr("id","wgcnaModuleSelect").on("change",function(){that.modSelect=$("#wgcnaModuleSelect").val();that.requestModuleList();"eQTL"===that.modSelect?$("#spaneQTLCutoff").show():$("#spaneQTLCutoff").hide()});c.append("text").text("in this region");a.append("br");a=a.append("span").attr("id","spaneQTLCutoff").style("display","none");
a.append("text").text("eQTL Cutoff P-value:");var h=["gene","eQTL"],e=["genes","module Eigengene QTL"];for(c=0;c<h.length;c++)d.append("option").attr("value",h[c]).text(e[c]);d3.select("#wgcnaModuleSelect").select('option[value="'+that.modSelect+'"]').attr("selected","selected");$("span#spanReturnType").show();d=a.append("select").attr("id","wgcnaModuleEQTLCutoff").on("change",function(){that.modSelectCutoff=$("#wgcnaModuleEQTLCutoff").val();that.requestModuleList()});h=["1","2","3","4"];e=["0.1",
"0.01","0.001","0.0001"];for(c=0;c<h.length;c++)d.append("option").attr("value",h[c]).text(e[c]);d3.select("#wgcnaModuleEQTLCutoff").select('option[value="'+that.modSelectCutoff+'"]').attr("selected","selected");c=that.dataBar.append("td").append("div").attr("id","goCtls").attr("class","goCTL").style("display","none").style("margin-left","10px");c.append("text").text("GO Domain:");d=c.append("select").attr("id","goDomainSelect").on("change",function(){that.singleImage.goDomain=$("#goDomainSelect").val();
that.singleImage.draw();gtag("event","changeDomain",{event_category:"WGCNA_go"})});d.append("option").attr("value","cc").text("Cellular Component");d.append("option").attr("value","bp").text("Biological Process");d.append("option").attr("selected","selected").attr("value","mf").text("Molecular Function");c.append("br");c.append("text").text("Number of Levels to Display:");c.append("input").attr("name","value").attr("id","goSpinner");$("#goSpinner").spinner({min:1,max:100,step:1,change:function(g,
l){that.singleImage.displayDepth=l.value;that.singleImage.selectedNode!==that.singleImage.data.GOList[0]&&that.singleImage.selectedNode!==that.singleImage.data.GOList[1]&&that.singleImage.selectedNode!==that.singleImage.data.GOList[2]?that.singleImage.redraw():that.singleImage.draw();gtag("event","changeDepth",{event_category:"WGCNA_go"})},spin:function(g,l){that.singleImage.displayDepth=l.value;that.singleImage.selectedNode!==that.singleImage.data.GOList[0]&&that.singleImage.selectedNode!==that.singleImage.data.GOList[1]&&
that.singleImage.selectedNode!==that.singleImage.data.GOList[2]?that.singleImage.redraw():that.singleImage.draw();gtag("event","changeDepth",{event_category:"WGCNA_go"})}}).val(3);c=that.dataBar.append("td").append("div").attr("id","mirCtls").attr("class","mirCTL").style("display","none").style("margin-left","10px");d=c.append("table").append("tr");c.append("text").style("font-weight","bold").text("Filter miRNAs:");c.append("br");c.append("input").attr("type","checkbox").style("margin-right","5px").attr("id",
"mirValidatedCBX").on("click",function(){$(this).is(":checked")?that.singleImage.mirValid=1:that.singleImage.mirValid=0;that.singleImage.drawMiR();gtag("event","changeValidated",{event_category:"WGCNA_mir"})});c.append("text").text("only miRNAs with Validated Targets");c.append("br");c.append("text").style("margin-right","5px").text("# of targeted Genes: ");c.append("div").attr("id","minMirGeneSlider").style("display","inline-block").style("width","150px");c.append("span").attr("id","minMirGeneLabel").style("margin-left",
"5px").append("text").text("1");c.append("br");c.append("text").style("margin-right","5px").text("miRNAs targeting gene: ");c.append("input").attr("type","text").attr("id","mirGeneFilterTxt").on("keyup",function(g){that.singleImage.mirTargetID=$(this).val().toLowerCase();that.singleImage.drawMiR();gtag("event","geneFilter",{event_category:"WGCNA_mir"})});c.append("br");c.append("text").style("margin-right","5px").text("miRNA(ID or Accession): ");c.append("input").attr("type","text").attr("id","mirIDFilterTxt").on("keyup",
function(g){that.singleImage.mirID=$(this).val().toLowerCase();that.singleImage.drawMiR();gtag("event","geneFilter",{event_category:"WGCNA_mir"})});c=that.dataBar.append("td").append("div").attr("id","mirCtls2").attr("class","mirCTL").style("display","none").style("margin-left","10px");c.append("text").style("font-weight","bold").text("Display Options:");c.append("br");c.append("input").attr("type","checkbox").attr("id","mirSortCBX").style("margin-right","5px").on("click",function(){$(this).prop("checked")?
that.singleImage.sortMir=$("#mirSortSelect").val():that.singleImage.sortMir=0;that.singleImage.drawMiR();gtag("event","mirSort",{event_category:"WGCNA_mir"})});c.append("text").text("Hovering over a node(miR or transcript):");c.append("br");c.append("input").attr("type","checkbox").attr("id","mirLinkCBX").attr("checked","checked").style("margin-left","12px").style("margin-right","3px").on("click",function(){$(this).prop("checked")?that.singleImage.showMirLinks=1:that.singleImage.showMirLinks=0;gtag("event",
"showLinks",{event_category:"WGCNA_mir"})});c.append("text").text("Display links between miRNAs and targeted transcripts");c.append("br");c.append("input").attr("type","checkbox").attr("id","mirgeneLinkCBX").style("margin-left","12px").style("margin-right","3px").on("click",function(){$(this).prop("checked")?(that.singleImage.showLinks=0,$("div#mirLinkColorSelect").show()):(that.singleImage.showLinks=1,$("div#mirLinkColorSelect").hide());that.singleImage.setupLegend();gtag("event","linkColor",{event_category:"WGCNA_mir"})});
c.append("text").text("Display links between correlated transcripts");d=c.append("div").attr("id","mirLinkColorSelect").style("display","none");d.append("text").style("margin-left","24px").text("Correlation Link Color Options:");c=d.append("select").attr("id","mirlinkColor").on("change",function(){that.singleImage.updateColor("mirlinkColor");that.singleImage.setupLegend();gtag("event","linkColor",{event_category:"WGCNA_mir"})});c.append("option").attr("selected","selected").attr("value","Green_Red").text("Green(+) / Red(-)");
c.append("option").attr("value","Blue_Yellow").text("Blue(+) / Yellow(-)");c.append("option").attr("value","Red_Green").text("Red(+) / Green(-)");d.append("br");d.append("input").attr("type","checkbox").style("margin-left","24px").style("margin-right","3px").on("click",function(){$(this).prop("checked")?that.singleImage.showAllFromTarget=1:that.singleImage.showAllFromTarget=0;gtag("event","linkColor",{event_category:"WGCNA_mir"})});d.append("text").text("Display all cor. transcript links from targeted transcripts.");
$("#minMirGeneSlider").slider({min:1,max:100,step:1,value:1,slide:function(g,l){that.singleImage.mirGeneCutoff=l.value;$("span#minMirGeneLabel").html(l.value);that.singleImage.drawMiR();gtag("event","minMir",{event_category:"WGCNA_mir"})}});c=that.dataBar.append("td").append("div").attr("id","linkCtls").attr("class","linkCTL").style("display","none").style("margin-left","10px");c.append("text").text("Link Correlation Values");c.append("span").style("cursor","pointer").on("click",function(){$("#linkSliderMin").slider("value",
.75);that.singleImage.CorCutoff_min=.75;$("span#minLabel").html(.75);$("#linkSliderMax").slider("value",1);that.singleImage.CorCutoff_max=1;$("span#maxLabel").html(1);that.singleImage.draw();gtag("event","resetCorrelation",{event_category:"WGCNA_mir"})}).append("img").attr("src",contextRoot+"/web/images/icons/reset_16.png");a=c.append("table");d=a.append("tr");d.append("td").append("text").text("Min:");d.append("td").append("div").attr("id","linkSliderMin").style("width","100px");d.append("td").append("span").attr("id",
"minLabel").style("margin-left","5px").append("text").text("0.75");d=a.append("tr");d.append("td").append("text").text("Max:");d.append("td").append("div").attr("id","linkSliderMax").style("width","100px");d.append("td").append("span").attr("id","maxLabel").style("margin-left","5px").append("text").text("1");c.append("input").attr("type","checkbox").attr("id","hideLinkExceptNode").on("click",function(){that.singleImage.showLinks=!$(this).is(":checked");that.singleImage.draw();that.singleImage.panZoom=
svgPanZoom("#singleWGCNASVG",{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,minZoom:.1,maxZoom:4,fit:!0,center:!0})});c.append("text").text("Hide Links Except Selected Node");d=that.dataBar.append("td").append("div").attr("id","linkCtl2").attr("class","linkCTL").style("display","none").style("margin-left","10px");d.append("text").text("Correlation Link Color Options:");d.append("br");d=d.append("select").attr("id","linkColor").on("change",function(){that.singleImage.draw();
that.singleImage.panZoom=svgPanZoom("#singleWGCNASVG",{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,minZoom:.1,maxZoom:4,fit:!0,center:!0})});d.append("option").attr("selected","selected").attr("value","Green_Red").text("Green(+) / Red(-)");d.append("option").attr("value","Blue_Yellow").text("Blue(+) / Yellow(-)");d.append("option").attr("value","Red_Green").text("Red(+) / Green(-)");$("#linkSliderMin").slider({min:.05,max:.95,step:.05,value:.75,
slide:function(g,l){that.singleImage.CorCutoff_min=l.value;$("span#minLabel").html(l.value);that.singleImage.draw()}});$("#linkSliderMax").slider({min:.1,max:1,step:.05,value:1,slide:function(g,l){that.singleImage.CorCutoff_max=l.value;$("span#maxLabel").html(l.value);that.singleImage.draw()}});c=that.dataBar.append("td").append("div").attr("class","eqtlCtls").attr("id","eqtlCtl").style("display","none").style("margin-left","10px");c.append("text").text("Select Chromosomes");c.append("br");d=c.append("select").attr("id",
"eqtlChr").attr("multiple","multiple").attr("size","4").style("width","100px");for(c=1;c<=that.chrLen;c++)d.append("option").attr("selected","selected").attr("value",organism.toLowerCase()+c).text("chr"+c);d.append("option").attr("selected","selected").attr("value",organism.toLowerCase()+"X").text("chrX");c=that.dataBar.append("td").append("div").attr("class","eqtlCtls").attr("id","eqtlCtl2").style("display","none").style("margin-left","10px");c.append("text").text("P-value cutoff:");d=c.append("select").attr("id",
"eqtlPval");d.append("option").attr("value","1").text("0.1");d.append("option").attr("selected","selected").attr("value","2").text("0.01");d.append("option").attr("value","3").text("0.001");d.append("option").attr("value","4").text("0.0001");d.append("option").attr("value","5").text("0.00001");c.append("br");c.append("br");c.append("br");c.append("br");c.append("input").attr("type","button").attr("value","Apply Selections").on("click",function(){for(var g=$("#eqtlPval").val(),l=$("#eqtlChr").val(),
m="",q=0;q<l.length;q++)m=m+l[q]+";";$.ajax({url:pathPrefix+"runCircosModule.jsp",type:"GET",async:!0,data:{cutoffValue:g,organism:organism,module:that.selectedModule.MOD_NAME,modColor:that.selectedModule.ModRGB,chrList:m,genomeVer:genomeVer,tissue:that.tissue},dataType:"json",beforeSend:function(){$("#waitCircos").show()},success:function(t){$("#waitCircos").hide();that.singleImage.update(t.URL)},error:function(t,v,y){}})})};that.positionTTLeft=function(a){a+=20;a>$(window).width()/2&&(a-=250);return a+
"px"};that.positionTTTop=function(a){a+="px";d3.event.clientY>.6*window.innerHeight&&(a=d3.event.pageY-2.2*$(".testToolTip").height()+"px");return a};that.createMultiWGCNAImage=function(){that.multiImage=that.multiWGCNAImageGeneView();that.multiImage.draw();that.img=that.multiImage};that.multiWGCNAImage=function(){var a={maxWidth:200};a.totalWidth=$(window).width();a.modPerLine=Math.floor($(window).width()/a.maxWidth);a.calcWidth=Math.floor($(window).width()/a.modPerLine);a.data=[];if(0===d3.select("#multiWGCNASVG").size()){var d=
d3.select("#wgcnaGeneImage").append("div").attr("id","multiWGCNAScroll").style("overflow","auto").style("max-height","430px");a.svg=d.append("svg").attr("id","multiWGCNASVG").attr("height","430px").attr("width","100%");d=a.svg.append("linearGradient").attr("id","lgrad").attr("x1","11%").attr("y1","0%").attr("x2","89%").attr("y2","100%");d.append("stop").attr("offset","0%").attr("style","stop-color:rgb(153,218,255);stop-opacity:1");d.append("stop").attr("offset","100%").attr("style","stop-color:rgb(0,128,128);stop-opacity:1");
d=a.svg.append("linearGradient").attr("id","selectGrad").attr("x1","11%").attr("y1","0%").attr("x2","89%").attr("y2","100%");d.append("stop").attr("offset","0%").attr("style","stop-color:rgb(0,163,55);stop-opacity:1");d.append("stop").attr("offset","100%").attr("style","stop-color:rgb(0,75,20);stop-opacity:1")}else a.svg=d3.select("#multiWGCNASVG");a.modKey=function(c){return c.MOD_NAME};a.calcX=function(c,h){return h%a.modPerLine*a.calcWidth};a.calcY=function(c,h){return Math.floor(h/a.modPerLine)*
a.maxWidth};a.sizing=function(c){c=a.size(c.TCList.length);c>a.maxWidth/2&&(c=a.maxWidth/2);return c};a.zoomIn=function(){a.maxWidth<$(window).width()/2&&(a.maxWidth*=2,a.draw())};a.zoomOut=function(){var c=a.maxWidth;a.maxWidth=Math.floor(a.maxWidth/2);25>a.maxWidth?a.maxWidth=c:a.draw()};a.sortTCLenDesc=function(c,h){return h.TCList.length<c.TCList.length?-1:h.TCList.length>c.TCList.length?1:0};a.sortGeneInstanceDesc=function(c,h){return h.GeneCount<c.GeneCount?-1:h.GeneCount>c.GeneCount?1:a.sortTCLenDesc(c,
h)};a.draw=function(){};a.redraw=function(){};return a};that.multiWGCNAImageGeneView=function(){var a=that.multiWGCNAImage();a.createToolTip=function(d){var c="Module Name: "+d.MOD_NAME+"<BR>Transcript Size: "+d.TCList.length;"undefined"!==typeof d.GroupedGenes?(c=c+"<BR>Genes in Region/List: "+d.GroupedGenes,c=c+"<BR>Transcripts in Region/List: "+d.GeneCount):c=c+"<BR>Selected Gene Transcripts in Module: "+d.GeneCount;return c};a.draw=function(){"undefined"!==typeof that.selectedModule&&(a.maxWidth=
85);a.svg.selectAll(".modules").remove();a.svg.selectAll(".moduleGradient").remove();a.totalWidth=$(window).width();a.modPerLine=Math.floor($(window).width()/a.maxWidth);a.calcWidth=Math.floor($(window).width()/a.modPerLine);var d=[];a.dataList={};for(var c=0,h=0;h<that.moduleList.length;h++)if(("grey"!==that.moduleList[h]||"grey"===that.moduleList[h]&&0===that.skipGrey)&&"undefined"!==typeof that.modules[that.moduleList[h]]){d[c]=that.modules[that.moduleList[h]];var e=d[c].ModRGB.split(","),g="";
for(g=0;g<e.length;g++)e[g]-=70,0>e[g]&&(e[g]=0);g=e[0]+","+e[1]+","+e[2];e=a.svg.append("linearGradient").attr("id","grad"+d[c].MOD_NAME).attr("class","moduleGradient").attr("x1","11%").attr("y1","0%").attr("x2","89%").attr("y2","100%");e.append("stop").attr("offset","0%").attr("style","stop-color:rgb("+d[c].ModRGB+");stop-opacity:1");e.append("stop").attr("offset","100%").attr("style","stop-color:rgb("+g+");stop-opacity:1");c++}c=a.maxWidth+15;d.length>a.modPerLine&&(h=Math.floor(d.length/a.modPerLine),
0<d.length%a.modPerLine&&h++,c*=h);a.svg.attr("height",c+"px");d.sort(a.sortGeneInstanceDesc);a.data=d;for(h=0;h<d.length;h++)a.dataList[d[h].MOD_NAME]=h;c=d3.min(d,function(l){return l.TCList.length});h=d3.max(d,function(l){return l.TCList.length});a.size=d3.scaleLinear().domain([c,h]).range([10,a.maxWidth/2]);d=a.svg.selectAll(".modules").data(d,a.modKey).attr("transform",function(l,m){return"translate("+a.calcX(l,m)+","+a.calcY(l,m)+")"});d.enter().append("g").attr("class","modules").attr("id",
function(l){return l.MOD_NAME}).attr("transform",function(l,m){return"translate("+a.calcX(l,m)+","+a.calcY(l,m)+")"}).merge(d).each(function(l){var m=d3.select("g#"+l.MOD_NAME);m.append("circle").attr("cx",a.calcWidth/2).attr("cy",a.maxWidth/2).attr("r",a.sizing).attr("stroke",function(q){var t="#FFFFFF";"undefined"!==typeof that.selectedModule&&that.selectedModule===q&&(t="#000000");return t}).attr("stroke-width",function(q){var t="1px";"undefined"!==typeof that.selectedModule&&that.selectedModule===
q&&(t="3px");return t}).attr("fill",function(q){var t="url(#grad"+q.MOD_NAME+")";"undefined"!==typeof that.selectedModule&&that.selectedModule===q&&(t="url(#selectGrad)");return t}).on("click",function(){a.maxWidth=85;that.selectedModule=l;a.draw();d3.select("#multiWGCNAScroll").style("max-height","110px");a.svg.select("g#"+l.MOD_NAME).style("background","#CECECE");a.svg.select("g#"+l.MOD_NAME).select("circle").attr("fill","url(#selectGrad)").attr("stroke","#000000").attr("stroke-width","3px");a.svg.select("g#"+
l.MOD_NAME).select("text.txtLbl").style("font-weight","bold");that.selectedGene={};for(var q=0;q<l.TCList.length;q++)"undefined"===typeof that.selectedGene[l.TCList[q].Gene.ID]&&(that.selectedGene[l.TCList[q].Gene.ID]={},that.selectedGene[l.TCList[q].Gene.ID].geneSymbol=l.TCList[q].Gene.geneSymbol,that.selectedGene[l.TCList[q].Gene.ID].tcList=[]),that.selectedGene[l.TCList[q].Gene.ID].tcList.push(l.TCList[q]);setTimeout(that.createSingleWGCNAImage,20)}).on("mouseover",function(){$("#wgcnaMouseHelp").html("<B>Click</B> to select this module and see additional details.");
d3.select(this).style("fill","url(#selectGrad)");tt.transition().duration(200).style("opacity",1);tt.html(a.createToolTip(l)).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",function(){return that.positionTTTop(d3.event.pageY)})}).on("mouseout",function(){var q=d3.select(this).data()[0];"undefined"!==typeof that.selectedModule&&q.MOD_NAME===that.selectedModule.MOD_NAME||d3.select(this).style("fill","url(#grad"+q.MOD_NAME+")");tt.transition().duration(500).style("opacity",
0)});"undefined"!==typeof that.selectedModule&&that.selectedModule===l?m.append("text").attr("class","txtLbl").attr("y",a.maxWidth+12).attr("x",function(q){return a.calcWidth/2-q.MOD_NAME.length/2*6.5}).style("font-weight","bold").text(replaceUnderscore(l.MOD_NAME)):6.5*l.MOD_NAME.length<a.calcWidth&&m.append("text").attr("class","txtLbl").attr("y",a.maxWidth+12).attr("x",function(q){return a.calcWidth/2-q.MOD_NAME.length/2*6.5}).text(replaceUnderscore(l.MOD_NAME));m.append("text").attr("y",a.maxWidth/
2+5).attr("x",a.calcWidth/2-3).attr("pointer-events","none").attr("fill",function(q){var t="#000000";q=q.ModRGB.split(",");360>q[0]+q[1]+q[2]&&(t="#FFFFFF");return t}).text(function(q){var t=q.GeneCount;"undefined"!==typeof q.GroupedGenes&&(t=q.GroupedGenes);return t})})};a.backModule=function(){if(that.selectedModule){var d=a.dataList[that.selectedModule.MOD_NAME];if(0<d){d=a.data[d-1];var c=a.svg.select("g#"+that.selectedModule.MOD_NAME);c.select("circle").attr("fill","url(#grad"+that.selectedModule.MOD_NAME+
")").attr("stroke","#FFFFFF").attr("stroke-width","1px");c.select("text.txtLbl").style("font-weight","normal");that.selectedModule=d;d=a.svg.select("g#"+d.MOD_NAME);d.select("circle").attr("fill","url(#selectGrad)").attr("stroke","#000000").attr("stroke-width","3px");d.select("text.txtLbl").style("font-weight","bold");setTimeout(that.createSingleWGCNAImage,20)}}};a.forwardModule=function(){if(that.selectedModule){var d=a.dataList[that.selectedModule.MOD_NAME];if(d<a.data.length-1){d=a.data[d+1];var c=
a.svg.select("g#"+that.selectedModule.MOD_NAME);c.select("circle").attr("fill","url(#grad"+that.selectedModule.MOD_NAME+")").attr("stroke","#FFFFFF").attr("stroke-width","1px");c.select("text.txtLbl").style("font-weight","normal");that.selectedModule=d;d=a.svg.select("g#"+d.MOD_NAME);d.select("circle").attr("fill","url(#selectGrad)").attr("stroke","#000000").attr("stroke-width","3px");d.select("text.txtLbl").style("font-weight","bold");setTimeout(that.createSingleWGCNAImage,20)}}};return a};that.createSingleWGCNAImage=
function(){d3.select("#viewGene").remove();d3.select("#circos").remove();$("#wgcnaresetImage").show();$("#wgcnazoomInImage").show();$("#wgcnazoomOutImage").show();"gene"===that.viewType?($("#linkSliderMin").slider("value",.01),$("span#minLabel").html(.01),$("#linkSliderMax").slider("value",1),$("span#maxLabel").html(1),$("#hideLinkExceptNode").prop("checked",!1),setTimeout(function(){that.singleImage=that.singleWGCNAImageGeneView(that.modules);that.singleImage.draw();that.img=that.singleImage;that.singleWGCNATableGeneView();
setTimeout(function(){that.singleImage.panZoom=svgPanZoom("#singleWGCNASVG",{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,minZoom:.1,maxZoom:4,fit:!0,center:!0})},500)},50)):"go"===that.viewType?($("#wgcnaresetImage").hide(),$("#wgcnazoomInImage").hide(),$("#wgcnazoomOutImage").hide(),$("#goDomainSelect").val("mf"),$("#goSpinner").val(3),setTimeout(function(){that.singleImage=that.singleWGCNAImageGoView(that.modules);that.singleImage.goDomain=
$("#goDomainSelect").val();that.singleImage.draw();that.img=that.singleImage},50)):"eqtl"===that.viewType?($("#eqtlChr option").prop("selected",!0),$("#eqtlPval").val(2),setTimeout(function(){that.singleImage=that.singleWGCNAImageEQTLView(that.modules);that.singleImage.displayDefault();that.img=that.singleImage},50)):"mir"===that.viewType?($("#mirValidatedCBX").prop("checked",!1),$("#minMirGeneSlider").slider("value",1),$("span#minMirGeneLabel").html(1),$("#mirGeneFilterTxt").val(""),$("#mirIDFilterTxt").val(""),
$("#mirSortCBX").prop("checked",!1),$("#mirLinkCBX").prop("checked",!0),$("#mirgeneLinkCBX").prop("checked",!1),$("div#mirLinkColorSelect").hide(),setTimeout(function(){that.singleImage=that.singleWGCNAImageGeneView(that.modules);that.singleImage.draw();that.img=that.singleImage;setTimeout(function(){that.singleImage.panZoom=svgPanZoom("#singleWGCNASVG",{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,minZoom:.1,maxZoom:4,fit:!0,center:!0})},500)},
50)):"meta"===that.viewType&&setTimeout(function(){that.singleImage=that.singleWGCNAImageMetaView(that.modules);that.singleImage.requestMeta();that.img=that.singleImage;setTimeout(function(){that.singleImage.panZoom=svgPanZoom("#singleWGCNASVG",{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,minZoom:.1,maxZoom:4,fit:!0,center:!0})},500)},50);gtag("event",that.viewType,{event_category:"changedWGCNAView"})};that.singleWGCNAImage=function(){var a={};
a.width=$(window).width();a.height=Math.floor(.9*window.innerHeight);a.r=a.height>a.width?Math.floor(a.width/2*.95):Math.floor(a.height/2*.95);a.maxPerLevel=150;a.CorCutoff_min=.75;a.CorCutoff_max=1;a.showLinks=!0;a.data=[];a.maxNodeR=28;a.negColor="#DD0000";a.negDarkColor="#770000";a.posColor="#00DD00";a.posDarkColor="#007700";a.mirVal="#FFFF00";a.mirPred="#0000CC";0===d3.select("#singleWGCNASVG").size()?a.svg=d3.select("#wgcnaGeneImage").append("div").attr("id","viewGene").append("svg").attr("id",
"singleWGCNASVG").attr("height",a.height+"px").attr("width","100%"):a.svg=d3.select("#singleWGCNASVG");a.geneKey=function(d){return d.ID};a.linkKey=function(d){return that.removeInvalidIDChars(d.TC1)+that.removeInvalidIDChars(d.TC2)};a.calcX=function(d,c){return c%a.modPerLine*a.calcWidth};a.calcY=function(d,c){return Math.floor(c/a.modPerLine)*a.maxWidth};a.sizing=function(d){d=a.size(d.TCList.length);d>a.maxWidth/2&&(d=a.maxWidth/2);return d};a.colorCircle=function(d){d=d.Gene.ID;var c="#DFC184";
if(0==d.indexOf("PRN")||0==d.indexOf("PMM")||0==d.indexOf("Unannotated"))"Whole Brain"===that.tissue?c="#7EB5D6":"Heart"===that.tissue?c="#DC7252":"Liver"===that.tissue&&(c="#bbbedd");return c};a.colorLink=function(d){var c=a.negColor;0<d.Cor&&(c=a.posColor);return c};a.colorLinkHighlight=function(d){var c=a.negDarkColor;0<d.Cor&&(c=a.posDarkColor);return c};a.updateColor=function(d){d=$("#"+d).val();"Red_Green"===d?(a.posColor="#DD0000",a.posDarkColor="#770000",a.negColor="#00DD00",a.negDarkColor=
"#007700",a.mirVal="#FFFF00",a.mirPred="#0000CC"):"Blue_Yellow"===d?(a.posColor="#0000DD",a.posDarkColor="#000077",a.negColor="#ffef16",a.negDarkColor="#b7ae2a",a.mirVal="#FF9C2A",a.mirPred="#BA49FF"):(a.negColor="#DD0000",a.negDarkColor="#770000",a.posColor="#00DD00",a.posDarkColor="#007700",a.mirVal="#FFFF00",a.mirPred="#0000CC")};a.nodeRadiusSum=function(d,c){var h=3+20*d.LinkSum;h>a.maxNodeR&&(h=a.maxNodeR);return h};a.zoomIn=function(){a.maxWidth<$(window).width()/2&&(a.maxWidth*=2,a.draw())};
a.zoomOut=function(){var d=a.maxWidth;a.maxWidth=Math.floor(a.maxWidth/2);25>a.maxWidth?a.maxWidth=d:a.draw()};a.draw=function(){};a.redraw=function(){};a.setupLegend=function(){a.svg.select("#legend").remove();a.svg.select("#legendDisp").remove();a.legendG=a.svg.append("g").attr("id","legend").attr("transform","translate(10,60)").style("cursor","pointer").on("mouseover",function(){a.legendDispG.transition().duration(300).style("opacity",1);gtag("event","viewLegend",{event_category:"wgcna"})}).on("mouseleave",
function(){a.legendDispG.transition().duration(300).style("opacity",0)});a.legendG.append("image").attr("x",0).attr("y",-20).attr("width","24px").attr("height","24px").attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAJI0lEQVRIDQEYCef2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABVVVVAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAq6ur/wAAAP4AAAAAAQAAAAAAAAAAAAAAAFtynWv/AgFSAP//BAEBAgAAAP8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/95/Plx4sH/fPbq6ur8QQAAAAAAAAAAEBAQAT/AgOLAQEACQABAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAgAJDRgG/O7xiAAAAMkEAAAAAAAAAADz8/MB/vv1pgMEBVb///4JAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//Pb+/fLiJgAAAB8AAADJBAAAAAAAAAAADQ0N//nivJACAgLfAQEBOwEBARH///8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/gAAAOoAAADxAAAAAAQAAAAAAAAAAMDAwPxAQEDkEhISuv///9wCAgIN////AQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////4AAADxAAAA2AAAAAAEAAAAAAAAAAAAAAAAFS1XJgQDAk4B//wK/gD9BQIAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//fro+OXExvj4+O8AAAAABAAAAAAAAAAAAFVVAwUHCLcBAQESAAAHAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8A/wYTKxsC79eVAAAA1QIAAAAAAAAAADPe3gIA//3Z///+/AD//v7//v7///7+///+/v///v7///7+///+/v///v7///7+///+/v///v7///7+///+/v///v7///7+/wH++v/+9+k6////JgAAAAAEAAAAAAAAAAANDQ3/9+LCcwMIDGEB/vs1AAD/DgIBAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD+/fn9//v18wAAAAAAAAAABAAAAAAAAAAAwMDA/UZGRt0N/g2q/wAA0gEBAQ39AAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////gAAAPD////YAAAAAAQAAAAAAAAAAAAAAP8LIkUAAwT9AwD8+uoCAP/x////AQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP779vD+8d3a/f395QAAAAAEAAAAAAAAAAAAAAABCQwVtQEBADQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/4+gABewTw260AAADzAgAAAAAAAAAAM2ZmBAEA/xsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8BBwD++FYBAQErAAAAAAQAAAAAAAAAAADNzQD5MRBsAwIIagD++igAAP4K////AQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAH7+PwA9+gIAAAADAAAAAAEAAAAAAAAAADNzc39FxcXzQYGBqACAgIwAgICDv///wIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAf/////+AAAA7gICAuAAAAAABAAAAAAAAAAAAAAA/uHh4ecfHx+8AwMDzAYGBgb+/v4BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/f39/wMDA/j29vboAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAA/gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAApkUqF3zKmm8AAAAASUVORK5CYII=");
a.legendG.append("text").attr("x","25").style("font-size","18").text("Legend");a.legendDispG=a.svg.append("g").attr("id","legendDisp").attr("transform","translate(10,70)").style("opacity",1);a.drawLegend();setTimeout(function(){a.legendDispG.transition().duration(750).style("opacity",0)},8E3)};a.drawLegend=function(){};a.createToolTip=function(d){var c="Gene: "+d.Gene.geneSymbol+" ("+d.Gene.ID+")<BR><BR>Transcript:"+d.ID+"<BR>";c=c+"<BR>Link Count:"+d.LinkCount;c=c+"<BR>Link Sum:"+d.LinkSum.toFixed(2);
var h=that.selectedGene[d.Gene.ID].tcList;if(1<h.length){"<BR><BR>Additional Transcripts in this Module:<BR>";h=that.selectedGene[d.Gene.ID].tcList;for(var e=0;e<h.length;e++)h[e].ID!==d.ID&&(c=c+h[e].ID+"<BR>")}d.PSList&&"array"===that.selSource&&(c=c+"<BR><BR>"+d.PSList.length+" Probe Sets in Transcript<BR>");return c};return a};that.singleWGCNAImageGeneView=function(){var a=that.singleWGCNAImage();$(".goCTL").hide();$(".eqtlCtls").hide();if("gene"===that.viewType)$(".linkCTL").show(),$(".mirCTL").hide(),
a.showMirLinks=0;else{$(".mirCTL").show();$(".linkCTL").hide();a.showLinks=1;a.geneList={};a.geneMirList={};for(var d=that.selectedModule.TCList,c=0;c<d.length;c++)a.geneList[that.selectedModule.TCList[c].Gene.ID]=that.selectedModule.TCList[c].Gene.geneSymbol;a.showMirLinks=1;a.showAllFromTarget=0}a.CorCutoff_min=.75;a.CorCutoff_max=1;a.type=that.viewType;a.truncated=0;a.filterOneDB=1;a.mirGeneCutoff=1;a.mirValid=0;a.mirTargetID="";a.mirID="";a.miRcolor=d3.scaleOrdinal(d3.schemeCategory20b);a.sortMir=
0;a.maxCorWidth=5;a.drawLinks=function(h){"gene"===that.viewType?a.updateColor("linkColor"):"mir"===that.viewType&&a.updateColor("mirlinkColor");a.svg.selectAll(".link").remove();for(var e=that.selectedModule.LinkList,g=[],l=0,m=0;m<e.length;m++)(e[m].TC1===h.ID||e[m].TC2===h.ID)&&a.CorCutoff_min<=Math.abs(e[m].Cor)&&Math.abs(e[m].Cor)<=a.CorCutoff_max&&(g[l]=e[m],l++);e=g;1E4>e.length&&(h=a.topG.selectAll(".link").data(e,a.linkKey),h.enter().append("line").attr("class","link").attr("pointer-events",
"none").attr("id",function(q){return"ln_"+that.removeInvalidIDChars(q.TC1)+that.removeInvalidIDChars(q.TC2)}).attr("x1",function(q){return d3.select("#tc_"+that.removeInvalidIDChars(q.TC1)).attr("cx")}).attr("y1",function(q){return d3.select("#tc_"+that.removeInvalidIDChars(q.TC1)).attr("cy")}).attr("x2",function(q){return d3.select("#tc_"+that.removeInvalidIDChars(q.TC2)).attr("cx")}).attr("y2",function(q){return d3.select("#tc_"+that.removeInvalidIDChars(q.TC2)).attr("cy")}).attr("stroke",a.colorLink).attr("stroke-width",
function(q){return Math.abs(q.Cor)*a.maxCorWidth}).merge(h))};a.drawLinksBetween=function(h){for(var e={},g=0;g<h.length;g++)e[h[g]]=1;"gene"===that.viewType?a.updateColor("linkColor"):"mir"===that.viewType&&a.updateColor("mirlinkColor");a.svg.selectAll(".link").remove();h=that.selectedModule.LinkList;g=[];for(var l=0,m=0;m<h.length;m++)(0===a.showAllFromTarget&&"undefined"!==typeof e[h[m].TC1]&&"undefined"!==typeof e[h[m].TC2]||1===a.showAllFromTarget&&("undefined"!==typeof e[h[m].TC1]||"undefined"!==
typeof e[h[m].TC2]))&&a.CorCutoff_min<=Math.abs(h[m].Cor)&&Math.abs(h[m].Cor)<=a.CorCutoff_max&&(g[l]=h[m],l++);h=g;1E4>h.length&&(e=a.svg.select("g.svg-pan-zoom_viewport").selectAll(".link").data(h,a.linkKey),e.enter().append("line").attr("class","link").attr("pointer-events","none").attr("id",function(q){return"ln_"+that.removeInvalidIDChars(q.TC1)+that.removeInvalidIDChars(q.TC2)}).attr("x1",function(q){return d3.select("#tc_"+that.removeInvalidIDChars(q.TC1)).attr("cx")}).attr("y1",function(q){return d3.select("#tc_"+
that.removeInvalidIDChars(q.TC1)).attr("cy")}).attr("x2",function(q){return d3.select("#tc_"+that.removeInvalidIDChars(q.TC2)).attr("cx")}).attr("y2",function(q){return d3.select("#tc_"+that.removeInvalidIDChars(q.TC2)).attr("cy")}).attr("stroke",a.colorLink).attr("stroke-width",function(q){return Math.abs(q.Cor)*a.maxCorWidth}).merge(e))};a.nodeX=function(h,e){var g=50,l=Math.floor(e/a.maxPerLevel)+1;1<l&&(g=60*l);return a.width/2+(a.r-g)*Math.cos(e%a.maxPerLevel*a.angle-1.57079633)};a.nodeY=function(h,
e){var g=50;e>a.maxPerLevel&&(g=60*(Math.floor(e/a.maxPerLevel)+1));return a.height/2+(a.r-g)*Math.sin(e%a.maxPerLevel*a.angle-1.57079633)};a.nodeXLbl=function(h,e){var g=e%a.maxPerLevel*a.angle-1.57079633,l=1;if(Math.PI/2<g&&g<1.5*Math.PI){var m=0;"undefined"!==typeof h.Gene.geneSymbol&&(m=h.Gene.geneSymbol.length);l+=7.5*m}return a.width/2+(a.r+l)*Math.cos(g)};a.nodeYLbl=function(h,e){var g=e%a.maxPerLevel*a.angle-1.57079633,l=1;if(Math.PI/2<g&&g<1.5*Math.PI){var m=0;"undefined"!==typeof h.Gene.geneSymbol&&
(m=h.Gene.geneSymbol.length);l+=7.5*m}return a.height/2+(a.r+l)*Math.sin(g)};a.drawCorLegend=function(h){a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",h).text("Positive Correlation");a.legendDispG.append("rect").attr("x","0").attr("y",h-10).attr("width","30").attr("height","10").style("fill",a.posColor);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",h+20).text("Negative Correlation");a.legendDispG.append("rect").attr("x","0").attr("y",h+
10).attr("width","30").attr("height","10").style("fill",a.negColor);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",h+40).text("Lower Correlation");a.legendDispG.append("line").attr("x1","0").attr("y1",h+30).attr("x2","30").attr("y2",h+30).style("stroke","#000000").style("stroke-width","0");a.legendDispG.append("line").attr("x1","0").attr("y1",h+35).attr("x2","30").attr("y2",h+35).style("stroke","#000000").style("stroke-width","0.5");a.legendDispG.append("line").attr("x1",
"0").attr("y1",h+40).attr("x2","30").attr("y2",h+40).style("stroke","#000000").style("stroke-width","1");a.legendDispG.append("line").attr("x1","0").attr("y1",h+45).attr("x2","30").attr("y2",h+45).style("stroke","#000000").style("stroke-width","2");a.legendDispG.append("line").attr("x1","0").attr("y1",h+55).attr("x2","30").attr("y2",h+55).style("stroke","#000000").style("stroke-width","3");a.legendDispG.append("line").attr("x1","0").attr("y1",h+65).attr("x2","30").attr("y2",h+65).style("stroke","#000000").style("stroke-width",
"5");a.legendDispG.append("line").attr("x1","0").attr("y1",h+75).attr("x2","30").attr("y2",h+75).style("stroke","#000000").style("stroke-width","7");a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",h+80).text("Higher Correlation")};a.drawMirSupportLegend=function(h){a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",h).text("Validated miRNA Target");a.legendDispG.append("rect").attr("x","0").attr("y",h-10).attr("width","30").attr("height","10").style("fill",
a.mirVal);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",h+20).text("Predicted miRNA Target");a.legendDispG.append("rect").attr("x","0").attr("y",h+10).attr("width","30").attr("height","10").style("fill",a.mirPred);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",h+40).text("Lower support of targeting");a.legendDispG.append("line").attr("x1","0").attr("y1",h+30).attr("x2","30").attr("y2",h+30).style("stroke","#000000").style("stroke-width",
"0");a.legendDispG.append("line").attr("x1","0").attr("y1",h+35).attr("x2","30").attr("y2",h+35).style("stroke","#000000").style("stroke-width","0.5");a.legendDispG.append("line").attr("x1","0").attr("y1",h+40).attr("x2","30").attr("y2",h+40).style("stroke","#000000").style("stroke-width","1");a.legendDispG.append("line").attr("x1","0").attr("y1",h+45).attr("x2","30").attr("y2",h+45).style("stroke","#000000").style("stroke-width","2");a.legendDispG.append("line").attr("x1","0").attr("y1",h+55).attr("x2",
"30").attr("y2",h+55).style("stroke","#000000").style("stroke-width","3");a.legendDispG.append("line").attr("x1","0").attr("y1",h+65).attr("x2","30").attr("y2",h+65).style("stroke","#000000").style("stroke-width","5");a.legendDispG.append("line").attr("x1","0").attr("y1",h+75).attr("x2","30").attr("y2",h+75).style("stroke","#000000").style("stroke-width","7");a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",h+80).text("Higher support of targeting")};a.drawLegend=function(){"gene"===
that.viewType?a.drawCorLegend(20):(a.drawMirSupportLegend(20),a.showLinks||a.drawCorLegend(130))};a.draw=function(){"mir"===that.viewType?(a.requestMiR(),a.updateColor("mirlinkColor")):"gene"===that.viewType&&a.updateColor("linkColor");a.width=$(window).width();a.height=Math.floor(.9*window.innerHeight);a.r=a.height>a.width?Math.floor(a.width/2*.95):Math.floor(a.height/2*.95);a.svg.attr("height",a.height+"px");a.svg.selectAll("circle").remove();a.svg.selectAll("text").remove();a.svg.selectAll("line").remove();
a.svg.selectAll(".geneTC").remove();"undefined"!==typeof a.panZoom&&(a.panZoom.destroy(),delete a.panZoom);a.svg.selectAll(".svg-pan-zoom_viewport").remove();setTimeout(function(){a.svg.append("text").style("font-size","20").attr("y",22).attr("x",5).text(function(){return that.selectedModule?replaceUnderscore(that.selectedModule.MOD_NAME):""});a.setupLegend();a.data=that.selectedModule.TCList;a.angle=2*Math.PI/a.data.length;a.angleDeg=360/a.data.length;a.data.length>a.maxPerLevel&&(a.angle=2*Math.PI/
a.maxPerLevel,a.angleDeg=360/a.maxPerLevel);a.data.sort(function(m,q){return m.LinkSum===q.LinkSum?0:m.LinkSum>q.LinkSum?-1:1});if(150<a.data.length){a.truncated=1;a.maxNodeR=15;for(var h=[],e=0;150>e;e++)h[e]=a.data[e];a.data=h;a.dataIndex={};for(e=0;e<a.data.length;e++)a.dataIndex[a.data[e].ID]=1;a.CorCutoff_min=.85;$("#linkSliderMin").slider("value",.85);$("span#minLabel").html(.85);a.svg.append("image").attr("x",7.8*that.selectedModule.MOD_NAME.length+20).attr("y",1).attr("width","24px").attr("height",
"24px").attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAJI0lEQVRIDQEYCef2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAAH/gAACcAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAADwAAALkCAABoFDEx0gIzM+/b29v4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGIAAAAvAgAAHDnn54QGBgY3SUlJBwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8AAB0AAAChAAAADAAAAAAU9vYY4RER/ecNDdLZ2dnvAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB5AAAAFgAAAAAAAAAABv7+BFHZ2UgFAgI4Ozs7DAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAtAAAAmAAAAAQAAAAAAAAAAAAAAAAU9/cM7AoKAOYYGNTZ2dnqAAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAFAAAAnQAAACf8AgIAzhgY/uIODv4V9vYBBP//AR3z8xrKHBzjDhwc2uDg4PYAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASwAAAEUAAAAB+AMDAJwyMveSODjT9QUF+AAAAAAY9PQOTN3dTxISEipAQEAEAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAADAAAAIAAAAAEAAAAAAAAAAAC/v7vAv7+tQn7+/IAAAAAAAAAAT/g4DQd8/NHCgoKFAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGcAAAAuAAAAAAAAAAAAAAAAAAEB+gP//+QF///7AAAAAAAAAAAQ+voIVtfXUggICDM5OTkJAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAP8AABYAAAB4AAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAATXm5iYt6+tMExMTHAAAAAEAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB7AAAAEwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAF/v4CVdfXSw0EBDdAQEALAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAD/AAAzAAAAkwAAAAYAAAAAAAAAAAAAAAAAAQEAAAAA/kDh4QAb8/MpAgAACAAAAAAAAAAAAAAAABT29g7vCAgB4RYW1NnZ2eoAAAD/AAAAAAAAAAAAAAAAAAAAAAD/AAAE/wAAtf8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD/5Q0N7WNKSnFHR0cSAAAAAAAAAAADAAAAAAAAAAAAAAAAgAAATAAAAHkAAAADAAAAAAAAAAAAAAAAAAAAAPgEBP+XMzP7xR8f7ivq6gcH/f0CAAAAAAAAAAAAAAAAAAAAAAz6+gj9AgIM2Bsb0QoKCujn5+f+AgAAAAAAAAAA/wAABwAAAIkAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAD9AQEA1hUV9MwZGccAAAD2AAAAAAAAAAAAAAAAAAAAAAAAAAABAAABR97eNhb390ceHh4RAAAAAAAAAAAAAAAAAP8AAG//AAD+/wAA//8AAP//AAD//wAA//8AAP//AAD//gAA/u4ICPvzBQXw/gAA/P8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP/CHR3SVVBQNgAAAAACAAAAAP8AAAgAAABfAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAER+PgEDPv7DwEAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMOnpJyHy8icAAAAABAAAAAABAAD42BMTgdUTE2buCwsz/QICCQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8BAAD/AAEBAf8AAAEAAAAAAAAAAAAAAAAAAAAAAAAAAPEHB/vhEBANAAAAAAQAAAAAAAAAAHU6OrsDAwPnAgICIQEBAQUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQH//f39zgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAs0IPw6I24JoAAAAASUVORK5CYII=").attr("pointer-events",
"all").style("cursor","pointer").on("mouseover",function(){$("#wgcnaMouseHelp").html("Warning: Transcripts displayed are truncated to the top 150 most connected transcripts due to the size of the module.")}).on("mouseout",function(){$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")})}else a.maxNodeR=28;a.topG=a.svg.append("g").attr("class","svg-pan-zoom_viewport");if("gene"===that.viewType){h=a.topG.selectAll(".geneTC").data(a.data,a.geneKey);
h.enter().append("circle").attr("class","geneTC").attr("id",function(m){return"tc_"+that.removeInvalidIDChars(m.ID)}).attr("cx",a.nodeX).attr("cy",a.nodeY).attr("r",3).attr("stroke","#000000").attr("fill","#FF0000").merge(h);h=that.selectedModule.LinkList;e=[];for(var g=0,l=0;l<h.length;l++)a.CorCutoff_min<=Math.abs(h[l].Cor)&&Math.abs(h[l].Cor)<=a.CorCutoff_max&&(0===a.truncated||"undefined"!==typeof a.dataIndex[h[l].TC1]&&"undefined"!==typeof a.dataIndex[h[l].TC2])&&(e[g]=h[l],g++);h=e;a.showLinks&&
1E4>h.length&&a.topG.selectAll(".link").data(h,a.linkKey).enter().append("line").attr("class","link").attr("id",function(m){return"ln_"+that.removeInvalidIDChars(m.TC1)+that.removeInvalidIDChars(m.TC2)}).attr("x1",function(m){return d3.select("#tc_"+that.removeInvalidIDChars(m.TC1)).attr("cx")}).attr("y1",function(m){return d3.select("#tc_"+that.removeInvalidIDChars(m.TC1)).attr("cy")}).attr("x2",function(m){return d3.select("#tc_"+that.removeInvalidIDChars(m.TC2)).attr("cx")}).attr("y2",function(m){return d3.select("#tc_"+
that.removeInvalidIDChars(m.TC2)).attr("cy")}).attr("stroke",a.colorLink).attr("stroke-width",function(m){return Math.abs(m.Cor)*a.maxCorWidth})}a.topG.selectAll(".geneTC").remove();h=a.topG.selectAll(".geneTC").data(a.data,a.geneKey);h.enter().append("g").append("circle").attr("cx",a.nodeX).attr("cy",a.nodeY).attr("r",a.nodeRadiusSum).attr("stroke","#000000").attr("fill",a.colorCircle).attr("class",function(m){return"geneTC "+m.Gene.ID}).attr("id",function(m){return"tc_"+that.removeInvalidIDChars(m.ID)}).on("click",
function(){}).on("mouseover",a.mouseoverGene).on("mouseout",a.mouseleaveGene).merge(h).each(function(m,q){d3.select(this.parentNode).append("g").attr("class","label").attr("id",function(t){return"txt_"+that.removeInvalidIDChars(t.ID)}).attr("transform",function(){var t=a.nodeXLbl(m,q),v=a.nodeYLbl(m,q);return"translate("+t+","+v+")"}).append("text").attr("transform",function(){var t=-90+q%a.maxPerLevel*a.angleDeg;90<t&&(t-=180);return"rotate("+t+")"}).text(function(){return m.Gene.geneSymbol})});
h.exit().remove();"mir"===that.viewType&&a.drawMiR()},250)};a.requestMiR=function(){$.ajax({url:contextRoot+"tmpData/browserCache/"+genomeVer+"/modules/ds"+that.wDSID+"/"+replaceUnderscore(that.selectedModule.MOD_NAME)+".miR.json",type:"GET",async:!0,data:{},dataType:"json",success:function(h){setTimeout(function(){a.mirData=h;a.geneMirList={};for(var e=0;e<a.mirData.MIRList.length;e++)for(var g=a.mirData.MIRList[e],l=g.GeneList,m=0;m<l.length;m++)if("undefined"===typeof a.geneMirList[l[m].ID])a.geneMirList[l[m].ID]=
[],a.geneMirList[l[m].ID].push(g);else{for(var q=0,t=0;t<a.geneMirList[l[m].ID].length&&0===q;t++)g.ID===a.geneMirList[l[m].ID][t].ID&&(q=1);0===q&&a.geneMirList[l[m].ID].push(g)}a.drawMiR();that.singleWGCNATableMirView()},50)},error:function(h,e,g){setTimeout(function(){a.requestMiR()},2E3)}})};a.drawMiR=function(){if("undefined"!==typeof a.topG&&"undefined"!==typeof a.mirData){a.svg.select("#mirG").remove();a.miRdiameter=1.5*a.r;a.miRformat=d3.format(",d");a.miRbubble=d3.pack().size([a.miRdiameter,
a.miRdiameter]).padding(1.5);var h=a.runMirFilter(a.mirData.MIRList);a.hierarch=d3.hierarchy({children:h}).sum(function(e){return e.filterGLSize});a.mirNode=a.miRbubble(a.hierarch.sort());h=a.topG.append("g").attr("id","mirG").attr("transform",function(){return"translate("+(a.width/2-a.miRdiameter/2)+","+(a.height/2-a.miRdiameter/2)+")"}).selectAll(".node").data(a.hierarch.leaves(),that.mirKey);h.enter().append("g").attr("class","node").attr("id",function(e){return that.removeInvalidIDChars(e.ID)}).attr("transform",
function(e){return"translate("+e.x+","+e.y+")"}).merge(h).on("mouseover",a.mouseoverMir).on("mouseleave",a.mouseleaveMir);h.exit().remove();d3.selectAll(".node").each(function(e){var g=e.data;if(0<e.depth){d3.select(this).append("circle").attr("r",function(m){return m.r}).style("fill",function(m){return a.miRcolor(g.ID)});var l=g.ID.substring(8);l.length<e.r/3&&d3.select(this).append("text").attr("dy",".2em").attr("pointer-events","none").style("text-anchor","middle").style("cursor","pointer").append("tspan").attr("x",
0).attr("dy","-0.5em").text("miR").append("tspan").attr("x",0).attr("dy","1em").text(l)}})}};a.sortMirFunction=function(h,e){return 0<a.sortMir?h.value-e.value:0>a.sortMir?e.value-h.value:0};a.runMirFilter=function(h){var e=h;if(1===a.filterOneDB||1<a.mirGeneCutoff||1===a.mirValid||0<a.mirID.length||0<a.mirTargetID.length){var g=0;e=[];for(var l=0;l<h.length;l++)a.filterMiR(h[l])&&(e[g]=h[l],g++)}return e};a.filterMiR=function(h){val=!0;h.GeneList.length<a.mirGeneCutoff&&(val=!1);val&&1===a.mirValid&&
0===h.vC&&(val=!1);val&&0<a.mirID.length&&(-1<h.ID.toLowerCase().indexOf(a.mirID)||-1<h.ACC.toLowerCase().indexOf(a.mirID)||(val=!1));if(val&&0<a.mirTargetID.length){for(var e=!1,g=0;g<h.GeneList.length&&!e;g++)if(1===a.filterOneDB)(1<h.GeneList[g].P||0<h.GeneList[g].V)&&(-1<h.GeneList[g].ID.toLowerCase().indexOf(a.mirTargetID)||-1<a.geneList[h.GeneList[g].ID].toLowerCase().indexOf(a.mirTargetID))&&(e=!0);else if(-1<h.GeneList[g].ID.toLowerCase().indexOf(a.mirTargetID)||-1<a.geneList[h.GeneList[g].ID].toLowerCase().indexOf(a.mirTargetID))e=
!0;e||(val=!1)}if(val&&1===a.filterOneDB&&"undefined"===typeof h.filterGLSize){for(g=e=0;g<h.GeneList.length;g++)(1<h.GeneList[g].P||0<h.GeneList[g].V)&&e++;h.filterGLSize=e;0===h.filterGLSize&&0===h.vC&&(val=!1)}else val&&1===a.filterOneDB&&0===h.filterGLSize&&0===h.vC&&(val=!1);return val};a.filterRevMiR=function(h){var e=[];if("undefined"!==typeof h)if(1===a.filterOneDB)for(var g=0;g<h.length;g++)(0<h[g].filterGLSize||0<h[g].vC)&&e.push(h[g]);else e=h;return e};a.filterMiRGenes=function(h){var e=
[];if(1===a.filterOneDB)for(var g=0;g<h.length;g++)(1<h[g].P||0<h[g].V)&&e.push(h[g]);else e=h;return e};a.createMirToolTip=function(h){return'<div id="ttSVG"></div>ID: '+h.ID+"<BR>Accession: "+h.ACC+"<BR><BR>Genes Targeted within Module: "+h.filterGLSize+"<BR>"};a.mouseoverMir=function(){var h=d3.select(this).data()[0],e=h.data,g=e.GeneList;g=a.filterMiRGenes(g);d3.select(this).style("opacity","0.3");tt.transition().duration(200).style("opacity",1);tt.html(a.createMirToolTip(e)).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",
function(){return that.positionTTTop(d3.event.pageY)});e=a.svg.select("g.svg-pan-zoom_viewport").selectAll(".mirlink").data(g,that.mirKey);e.enter().append("line").attr("class","mirlink").attr("pointer-events","none").attr("id",function(t){return"ln_"+t.ID}).attr("x1",function(t){return h.x+a.width/2-a.miRdiameter/2}).attr("y1",function(t){return h.y+a.height/2-a.miRdiameter/2}).attr("x2",function(t){var v=h.x+a.width/2-a.miRdiameter/2;0<d3.select("."+t.ID).size()&&(v=d3.select("."+t.ID).attr("cx"));
return v}).attr("y2",function(t){var v=h.y+a.height/2-a.miRdiameter/2;0<d3.select("."+t.ID).size()&&(v=d3.select("."+t.ID).attr("cy"));return v}).attr("stroke",function(t){var v=a.mirPred;0<t.V&&(v=a.mirVal);return v}).attr("stroke-width",function(t){return t.P+3*t.V}).merge(e);if(!a.showLinks){e=[];for(var l=0;l<g.length;l++)for(var m=d3.selectAll("."+g[l].ID).nodes(),q=0;q<m.length;q++)"undefined"!==typeof m[q]&&e.push(d3.select(m[q].parentNode).datum().ID);a.drawLinksBetween(e)}gtag("event","mouseOverMir",
{event_category:"wgcna"})};a.mouseleaveMir=function(){d3.select(this).style("opacity","1");tt.transition().duration(200).style("opacity",0);a.svg.selectAll(".mirlink").remove();a.svg.selectAll(".link").remove()};a.mouseoverGene=function(){$("#wgcnaMouseHelp").html("<B>Click</B> to select this gene cluster and see additional details.");d3.select(this).style("fill","url(#selectGrad)");tt.transition().duration(200).style("opacity",1);tt.html(a.createToolTip(d3.select(this).data()[0])).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",
function(){return that.positionTTTop(d3.event.pageY)});var h=d3.select(this.parentNode).datum();"mir"===that.viewType?(a.mirTargetID=h.Gene.ID.toLowerCase(),that.singleImage.drawMiR(),a.svg.selectAll(".link").remove()):($("[id^=ln_"+that.removeInvalidIDChars(h.ID)+"]").each(function(){var m=$(this).attr("id");d3.select("line#"+m).attr("stroke",a.colorLinkHighlight)}),$("[id$="+that.removeInvalidIDChars(h.ID)+"]").each(function(){var m=$(this).attr("id");d3.select("line#"+m).attr("stroke",a.colorLinkHighlight)}));
a.showLinks||a.drawLinks(h);d3.select("#txt_"+that.removeInvalidIDChars(h.ID)).select("text").attr("fill","#00A347");for(var e=that.selectedGene[h.Gene.ID].tcList,g=0;g<e.length;g++)d3.select("#tc_"+that.removeInvalidIDChars(e[g].ID)).attr("fill","#FEFF49");if("mir"===that.viewType&&a.showMirLinks){var l=h.Gene.ID;h=a.geneMirList[h.Gene.ID];h=a.filterRevMiR(h);h=a.svg.select("g.svg-pan-zoom_viewport").selectAll(".mirlink").data(h,that.mirKey);h.enter().append("line").attr("class","mirlink").attr("pointer-events",
"none").attr("id",function(m){return"ln_"+m.ID}).attr("x1",function(m){var q=d3.select("."+l).attr("cx");0<d3.select("#"+that.removeInvalidIDChars(m.ID)).size()&&(q=d3.select("#"+that.removeInvalidIDChars(m.ID))[0][0].__data__.x+a.width/2-a.miRdiameter/2);return q}).attr("y1",function(m){var q=d3.select("."+l).attr("cy");0<d3.select("#"+that.removeInvalidIDChars(m.ID)).size()&&(q=d3.select("#"+that.removeInvalidIDChars(m.ID))[0][0].__data__.y+a.height/2-a.miRdiameter/2);return q}).attr("x2",function(m){return d3.select("."+
l).attr("cx")}).attr("y2",function(m){return d3.select("."+l).attr("cy")}).attr("stroke",function(m){var q=a.mirPred;0<m.V&&(q=a.mirVal);return q}).attr("stroke-width",function(m){return m.P+3*m.V}).merge(h)}gtag("event","mouseOverGene",{event_category:"wgcna"})};a.mouseleaveGene=function(){var h=d3.select(this.parentNode).datum();$("[id^=ln_"+that.removeInvalidIDChars(h.ID)+"]").each(function(){var e=$(this).attr("id");d3.select("line#"+e).attr("stroke",a.colorLink)});$("[id$="+that.removeInvalidIDChars(h.ID)+
"]").each(function(){var e=$(this).attr("id");d3.select("line#"+e).attr("stroke",a.colorLink)});d3.select(this).style("fill",a.colorCircle);d3.select("#txt_"+that.removeInvalidIDChars(h.ID)).select("text").attr("fill","#000000");tt.transition().duration(500).style("opacity",0);a.showLinks||a.svg.selectAll(".link").remove();"mir"===that.viewType&&(a.mirTargetID=$("#mirGeneFilterTxt").val().toLowerCase(),a.svg.selectAll(".mirLink").remove(),that.singleImage.drawMiR())};return a};that.singleWGCNATableGeneView=
function(){"undefined"!==typeof that.selectedModule?($("div#waitModuleTable").hide(),$("div#wgcnaEqtlTable").hide(),$("div#wgcnaMirTable").hide(),$("div#wgcnaMirGeneTable").hide(),$("div#wgcnaGoTable").hide(),$("div#wgcnaModuleTable").show(),$("span#modTableName").html(that.selectedModule.MOD_NAME),$.fn.DataTable.isDataTable("table#moduleTable")&&$("table#moduleTable").DataTable().destroy(),d3.select("table#moduleTable").select("tbody").selectAll("tr").remove(),d3.select("table#moduleTable").select("tbody").selectAll("tr").data(that.selectedModule.TCList,
that.geneKey).enter().append("tr").attr("id",function(a){return"modtrx"+a.ID}).attr("class",function(a,d){var c="odd";0===d%2&&(c="even");return c}).each(function(a,d){d3.select(this).append("td").html(a.Gene.geneSymbol);d3.select(this).append("td").html(a.Gene.ID);d3.select(this).append("td").html(a.ID);a.PSList?d3.select(this).append("td").html(a.PSList.length):d3.select(this).append("td").html("0");d3.select(this).append("td").html(a.LinkSum.toFixed(2))}),that.datatbl=$("table#moduleTable").DataTable({bPaginate:!1,
aaSorting:[[4,"desc"]],sDom:'<"centerSearch"f>i<t>',buttons:[$.extend(!0,{},that.buttonCommon,{extend:"copyHtml5"}),$.extend(!0,{},that.buttonCommon,{extend:"csvHtml5"}),$.extend(!0,{},that.buttonCommon,{extend:"excelHtml5"})],columnDefs:[{type:"num",targets:[3,4]}]}),setTimeout(function(){that.PhenogenList=PhenoGenGeneList(that.datatbl,1,void 0,organism,"#tableExportCtlMod")},50),that.buttonCommon={exportOptions:{format:{body:function(a,d,c,h){a=a.replace(/(<.*?>)*/g,"");a=a.replace(/\s*/g,"");if(3===
c||4===c)a=a.replace(/&nbsp;/g," ");return a}},columns:[0,1,2,3,4]}}):($("div#waitModuleTable").hide(),$("div#wgcnaEqtlTable").hide(),$("div#wgcnaModuleTable").hide(),$("div#wgcnaGoTable").hide())};that.singleWGCNATableMirView=function(){var a={orgPref:"mmu-",runMirFilter:function(h){for(var e=[],g=0,l=0;l<h.length;l++)if(0<h[l].filterGLSize||0<h[l].vC)e[g]=h[l],g++;return e},createMirTable:function(){$("div#waitMirTable").hide();$("div#wgcnaMirGeneTable").hide();$("div#wgcnaMirTable").show();$("span#mirTableName").html(that.selectedModule.MOD_NAME);
$.fn.DataTable.isDataTable("table#mirTable")&&$("table#mirTable").DataTable().destroy();d3.select("table#mirTable").select("tbody").selectAll("tr").remove();var h=a.runMirFilter(that.singleImage.mirData.MIRList);d3.select("table#mirTable").select("tbody").selectAll("tr").data(h,that.mirKey).enter().append("tr").attr("id",function(e){return"mirTR"+that.removeInvalidIDChars(e.ID)}).attr("class",function(e,g){var l="odd";0===g%2&&(l="even");return l}).each(function(e,g){for(var l=0,m=[],q=0,t=[],v=e.GeneList,
y=0;y<v.length;y++)0<v[y].V?(l++,m.push(v[y])):1<v[y].P&&(q++,t.push(v[y]));d3.select(this).append("td").html(e.ID);d3.select(this).append("td").html(e.ACC);d3.select(this).append("td").html(function(){if(0<q){var w='<span class="triggerpL" name="pl'+g+'">'+q+"</span><BR>";w=w+'<span id="pl'+g+'" style="display:none;" >';for(var A=0;A<t.length;A++){0<A&&(w+=", ");var C=t[A].ID;"undefined"!==typeof that.singleImage.geneList[C]&&(C=that.singleImage.geneList[C]);w+=C}w+="</span>"}else w=q;return w});
d3.select(this).append("td").html(function(){if(0<l){var w='<span class="triggervL" name="vl'+g+'">'+l+"</span><BR>";w=w+'<span id="vl'+g+'" style="display:none;" >';for(var A=0;A<m.length;A++){0<A&&(w+=", ");var C=m[A].ID;"undefined"!==typeof that.singleImage.geneList[C]&&(C=that.singleImage.geneList[C]);w+=C}w+="</span>"}else w=l;return w});d3.select(this).append("td").html(function(){var w=q+l;if(0<w){w='<span class="triggerMiL" name="mil'+g+'">'+w+"</span><BR>";w=w+'<span id="mil'+g+'" style="display:none;" >';
if(0<m.length){w+="Validated: ";for(var A=0;A<m.length;A++){0<A&&(w+=", ");var C=m[A].ID;"undefined"!==typeof that.singleImage.geneList[C]&&(C=that.singleImage.geneList[C]);w+=C}}if(0<t.length)for(0<m.length&&(w+="<BR><BR>"),w+="Predicted: ",A=0;A<t.length;A++)0<A&&(w+=", "),C=t[A].ID,"undefined"!==typeof that.singleImage.geneList[C]&&(C=that.singleImage.geneList[C]),w+=C;w+="</span>"}return w})});$("#mirTable .triggerMiL").on("click",function(e){var g=this.getAttribute("name");$("#"+g).is(":hidden")?
($(this).addClass("less"),$("span#"+g).show()):($(this).removeClass("less"),$("span#"+g).hide());e.stopPropagation()});$("#mirTable .triggerpL").on("click",function(e){var g=this.getAttribute("name");$("#"+g).is(":hidden")?($(this).addClass("less"),$("span#"+g).show()):($(this).removeClass("less"),$("span#"+g).hide());e.stopPropagation()});$("#mirTable .triggervL").on("click",function(e){var g=this.getAttribute("name");$("#"+g).is(":hidden")?($(this).addClass("less"),$("span#"+g).show()):($(this).removeClass("less"),
$("span#"+g).hide());e.stopPropagation()});that.datatbl=$("table#mirTable").DataTable({bPaginate:!1,aaSorting:[[4,"desc"]],sDom:'<"leftSearch"B><"centerSearch"f><"rightTable"i><t>',buttons:[$.extend(!0,{},that.buttonCommon,{extend:"copyHtml5"}),$.extend(!0,{},that.buttonCommon,{extend:"csvHtml5"}),$.extend(!0,{},that.buttonCommon,{extend:"excelHtml5"})]});that.PhenogenList=PhenoGenGeneList(that.datatbl,4,that.buttonCommon);that.buttonCommon={exportOptions:{format:{body:function(e,g,l,m){e=e.replace(/(<.*?>)*/g,
"");0!==l&&3!==l?e=e.replace(/\s*/g,""):3===l?e=e.replace(/&nbsp;/g," "):0===l&&(e=e.replace(/PRN/g,";PRN"),e=e.replace(/ENS/g,";ENS"),e=e.substring(1));0===e.indexOf("ENS")&&0<e.indexOf("AllOrganisms:")&&(e=e.substring(0,e.indexOf("AllOrganisms:")));if(7===l||8===l||9===l||11===l||14===l||16===l||19===l||21===l||24===l||26===l)e="\u200c"+e;else if(12===l||13===l||17===l||18===l||22===l||23===l||27===l||28===l)e=e.replace(/chr/g," ");return e}},columns:[0,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,
19,20,21,22,23,24,25,26,27,28,29]}}},createMirGeneTable:function(){$("div#waitMirGeneTable").hide();$("div#wgcnaMirGeneTable").show();$("div#wgcnaMirTable").hide();$("span#mirGeneTableName").html(that.selectedModule.MOD_NAME);d3.select("table#mirGeneTable").select("tbody").selectAll("tr").remove();d3.select("table#mirGeneTable").select("tbody").selectAll("tr").data(that.selectedModule.TCList,that.geneKey).enter().append("tr").attr("id",function(h){return"mirg"+that.removeInvalidIDChars(h.ID)}).attr("class",
function(h,e){var g="odd";0===e%2&&(g="even");return g}).each(function(h,e){var g=that.singleImage.geneMirList[h.Gene.ID],l=0,m=[],q=0,t=[];if("undefined"!==typeof g)for(var v=0;v<g.length;v++)for(var y=g[v].GeneList,w=0,A=0;A<y.length&&0===w;A++)y[A].ID===h.Gene.ID&&(0<y[A].V?(l++,m.push(g[v])):1<y[A].P&&(q++,t.push(g[v])),w=1);d3.select(this).append("td").html(h.Gene.geneSymbol);d3.select(this).append("td").html(h.Gene.ID);d3.select(this).append("td").html(function(C,F){if(0<q){var E='<span class="triggerpL" name="pl'+
e+'">'+q+"</span><BR>";E=E+'<span id="pl'+e+'" style="display:none;" >';for(var D=0;D<t.length;D++){0<D&&(E+=", ");var z=t[D].ID.replace(a.orgPref,"");E+=z}E+="</span>"}else E=q;return E});d3.select(this).append("td").html(function(C,F){if(0<l){var E='<span class="triggervL" name="vl'+e+'">'+l+"</span><BR>";E=E+'<span id="vl'+e+'" style="display:none;" >';for(var D=0;D<m.length;D++){0<D&&(E+=", ");var z=m[D].ID.replace(a.orgPref,"");E+=z}E+="</span>"}else E=l;return E});d3.select(this).append("td").html(function(C,
F){var E=l+q;if(0<E){E='<span class="triggerMiL" name="mil'+e+'">'+E+"</span><BR>";E=E+'<span id="mil'+e+'" style="display:none;" >';if(0<m.length){E+="Validated: ";for(var D=0;D<m.length;D++){0<D&&(E+=", ");var z=m[D].ID.replace(a.orgPref,"");E+=z}}if(0<t.length)for(0<m.length&&(E+="<BR><BR>"),E+="Predicted: ",D=0;D<t.length;D++)0<D&&(E+=", "),z=t[D].ID.replace(a.orgPref,""),E+=z;E+="</span>"}return E})});$("#mirGeneTable .triggerMiL").on("click",function(h){var e=this.getAttribute("name");$("#"+
e).is(":hidden")?($(this).addClass("less"),$("span#"+e).show()):($(this).removeClass("less"),$("span#"+e).hide());h.stopPropagation()});$("#mirGeneTable .triggerpL").on("click",function(h){var e=this.getAttribute("name");$("#"+e).is(":hidden")?($(this).addClass("less"),$("span#"+e).show()):($(this).removeClass("less"),$("span#"+e).hide());h.stopPropagation()});$("#mirGeneTable .triggervL").on("click",function(h){var e=this.getAttribute("name");$("#"+e).is(":hidden")?($(this).addClass("less"),$("span#"+
e).show()):($(this).removeClass("less"),$("span#"+e).hide());h.stopPropagation()});$.fn.DataTable.isDataTable("table#mirGeneTable")&&$("table#mirGeneTable").DataTable().destroy();$("table#mirGeneTable").DataTable({bPaginate:!1,aaSorting:[[4,"desc"]],sDom:'<"rightTable"i><"leftTable"fB><t>',buttons:["copy","excel","pdf"]})}};if("undefined"!==typeof that.selectedModule){$("div#wgcnaEqtlTable").hide();$("div#wgcnaModuleTable").hide();$("div#wgcnaGoTable").hide();d3.select("div#tableExportCtl").selectAll("span").remove();
var d=d3.select("div#tableExportCtl"),c=d.append("span").style("display","inline-block").style("text-align","left").style("margin-left","20px").style("margin-right","10px");c.append("text").text("View by:");c.append("br");c.append("input").attr("type","radio").attr("checked","checked").attr("name","wgcnaMirTableRB").on("click",function(){a.createMirTable()});c.append("text").text(" miRNA");c.append("br");c.append("input").attr("type","radio").attr("name","wgcnaMirTableRB").on("click",function(){a.createMirGeneTable()});
c.append("text").text(" Gene");d.append("span").attr("class","button").style("display","inline-block").style("margin-right","10px").on("click",function(){$("#moduleTable").tableExport({type:"csv",escape:"false"})}).html("Export CSV");a.createMirTable()}else $("div#waitModuleTable").hide(),$("div#wgcnaEqtlTable").hide(),$("div#wgcnaModuleTable").hide(),$("div#wgcnaMirTable").hide(),$("div#wgcnaMirGeneTable").hide(),$("div#wgcnaGoTable").hide();return a};that.singleWGCNAImageGoView=function(){var a=
that.singleWGCNAImage();$(".goCTL").show();$(".linkCTL").hide();$(".mirCTL").hide();$(".eqtlCtls").hide();a.type=that.viewType;a.goDomain="mf";a.lastDrawn="mf";a.selectedNode;a.displayedLevel="d1";a.width=$(window).width();a.height=Math.floor(.92*window.innerHeight);a.padding=5;a.radius=(Math.min(a.width,a.height)-2*a.padding)/2;a.duration=1E3;a.xScale=d3.scaleLinear().range([0,2*Math.PI]);a.yScale=d3.scalePow().exponent(1.3).domain([0,1]).range([0,a.radius]);a.colorGO=d3.scaleOrdinal(d3.schemeCategory20);
a.displayDepth=3;a.geneList={};var d=[];if(that.selectedModule){d=that.selectedModule.TCList;for(var c=0;c<d.length;c++)a.geneList[that.selectedModule.TCList[c].Gene.ID]=that.selectedModule.TCList[c].Gene.geneSymbol}a.pathColor=function(h){return h&&h.data?h.data.name&&0==h.data.name.indexOf("ENS")?"#DFC184":h.data.name?a.colorGO(h.data.name):"#000000":h&&h.name&&0==h.name.indexOf("ENS")?"#DFC184":h&&h.name?a.colorGO(h.name):"#000000"};a.addLabels=function(h,e,g,l,m,q,t){q=a.radius/(t+1)*h.depth+
a.radius/(t+1)-12;var v=a.radius/(t+1)*h.depth,y=(m-g)/360*Math.PI*v*2;t=Math.floor((m-g)/360*Math.PI*q*2/7)-1;q=Math.floor((q-v)/12);var w=h.data.name;0===h.data.name.indexOf("ENS")&&"undefined"!==typeof a.geneList[w]&&(w=a.geneList[w],25<m-g&&(w=w+" ("+h.data.name+")"));var A=w.split(" ")[0].split("-")[0];if(A.length<=t||-1===h.data.name.indexOf("ENS")&&A.length/2<=t&&10<m-g){y=[];A=0;if(w.length>t)for(;0<w.length;){var C=w.indexOf(" ");if(-1===C)w.length>t?(y[A]=w.substr(0,t),A++,w=w.substr(t)):
(y[A]=w,A++,w="");else{for(var F=0;C<t&&1>F;){var E=w.indexOf(" ",C+1);-1!==E&&E<=t?C=E:F=1}C>t?-1<w.indexOf("-")&&w.indexOf("-")<t?(C=w.indexOf("-"),y[A]=w.substr(0,C+1),A++,w=w.substr(C+1)):(y[A]=w.substr(0,t),A++,w=w.substr(t)):(y[A]=w.substr(0,C),A++,w=w.substr(C+1))}}else y[A]=w;A=a.topG.append("text").style("fill-opacity",1).style("fill","#000").attr("pointer-events","none").attr("class","txt"+removeColon(h.data.id)).attr("text-anchor",function(D){return"start"}).attr("dy","1em").style("opacity",
function(D){return 1}).append("textPath").attr("xlink:href",function(D){return"#ap"+e}).attr("startOffset",function(D){return 0===g&&360===m?90:5});for(h=0;h<y.length&&h<q;h++)h<q&&(h===q-1&&y.length>q&&(y[h]+="...",y[h].length>t&&(y[h]=y[h].substr(0,t-4)+"...")),A.append("tspan").attr("x",0).attr("dy","1em").text(y[h]))}else if(12<=y&&0===h.data.name.indexOf("ENS"))for(A=a.topG.append("text").style("fill-opacity",1).style("fill","#000").attr("pointer-events","none").attr("class","txt"+removeColon(h.data.id)).attr("text-anchor",
function(D){D="start";180<=m&&(D="end");return D}).attr("dy",".2em").attr("transform",function(D){D=l-2.5;var z=v;0===g&&360===m&&(z=20);180<=m&&(D=l+2.5);return"rotate("+(D-90)+")translate("+z+")rotate("+(180<D?-180:0)+")"}).style("opacity",function(D){return 1}),w=h.data.name,0===h.data.name.indexOf("ENS")&&"undefined"!==typeof a.geneList[w]&&(w=a.geneList[w]),t=w.split(" "),h=0;h<t.length;h++)A.append("tspan").attr("x",0).attr("dy","1em").text(t[h])};a.redraw=function(){a.svg.selectAll("path").remove();
a.svg.select("#center").remove();var h=a.partition(a.rootN).descendants().filter(a.filterNodes),e=a.displayDepth;a.arc=d3.arc().startAngle(function(l){return Math.max(0,Math.min(2*Math.PI,l.x0))}).endAngle(function(l){return Math.max(0,Math.min(2*Math.PI,l.x1))}).innerRadius(function(l){return l===a.selectedNode&&a.selectedNode!==a.data.GOList[0]&&a.selectedNode!==a.data.GOList[1]&&a.selectedNode!==a.data.GOList[2]?20:Math.max(0,a.radius/(e+1)*(l.depth-a.rootN.depth))}).outerRadius(function(l){return Math.max(0,
a.radius/(e+1)*(l.depth-a.rootN.depth)+a.radius/(e+1))});a.topG.selectAll("path").remove();a.topG.selectAll("text").remove();var g=180/Math.PI;a.path=a.topG.selectAll("path").data(h);a.path.enter().append("path").merge(a.path).attr("d",a.arc).attr("id",function(l,m){return"ap"+m}).attr("class",function(l,m){return removeColon(l.data.id)}).attr("fill-rule","evenodd").attr("fill",a.pathColor).attr("pointer-events","all").on("mouseover",a.mouseover).on("click",a.click).each(function(l,m){if(l.depth<
a.rootN.depth+a.displayDepth){var q=Math.max(0,Math.min(2*Math.PI,l.x0))*g,t=Math.max(0,Math.min(2*Math.PI,l.x1))*g,v=q+(t-q)/2;0===q&&360===t&&(v=90);a.addLabels(l,m,q,v,t,l.depth-a.rootN.depth,e)}});if(a.selectedNode!==a.data.GOList[0]&&a.selectedNode!==a.data.GOList[1]&&a.selectedNode!==a.data.GOList[2])a.svg.append("circle").attr("id","center").attr("cx",a.width/2+a.padding).attr("cy",a.height/2+a.padding).attr("r","20").attr("fill-rule","evenodd").attr("fill",function(){return a.pathColor(a.rootN.parent)}).attr("pointer-events",
"all").on("click",function(){if(a.rootN.parent.data===a.data.GOList[0]||a.rootN.parent.data===a.data.GOList[1]||a.rootN.parent.data===a.data.GOList[2])a.selectedNode=null,a.draw();else{if(a.rootN.parent.data!==a.data.GOList[0]&&a.rootN.parent.data!==a.data.GOList[1]&&a.rootN.parent.data!==a.data.GOList[2])a.selectedNode=a.rootN.parent.data,a.rootN=a.rootN.parent,a.mouseover(a.rootN.parent);else{var l=a.data.GOList[0];"mf"===a.goDomain?l=a.data.GOList[2]:"bp"===a.goDomain&&(l=a.data.GOList[1]);a.selectedNode=
l}a.redraw();d3.event.stopPropagation();gtag("event","mouseClickGO",{event_category:"wgcna"})}}).on("mouseover",function(l){"undefined"!==typeof a.selectedNode&&a.selectedNode.parent!==a.data.GOList[0]&&a.selectedNode.parent!==a.data.GOList[1]&&a.selectedNode.parent!==a.data.GOList[2]?a.mouseover(a.selectedNode.parent):(tt.transition().duration(200).style("opacity",1),tt.html(a.createToolTip(a.selectedNode)).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",function(){return that.positionTTTop(d3.event.pageY)}));
d3.event.stopPropagation();gtag("event","mouseOverGO",{event_category:"wgcna"})}).on("mouseleave",function(l){tt.transition().duration(200).style("opacity",0)})};a.getModuleGOFile=function(h){"undefined"!==typeof that.selectedModule&&"undefined"!==typeof that.selectedModule.MOD_NAME&&$.ajax({url:contextRoot+"tmpData/browserCache/"+genomeVer+"/modules/ds"+that.wDSID+"/"+replaceUnderscore(that.selectedModule.MOD_NAME)+".GO.json",type:"GET",async:!0,data:{},dataType:"json",success:function(e){a.data=
e;e=a.data.GOList[0];for(var g=0,l=0;l<e.length;l++)e[l].UnqID=g,g++;e=a.data.GOList[1];for(l=0;l<e.length;l++)e[l].UnqID=g,g++;e=a.data.GOList[2];for(l=0;l<e.length;l++)e[l].UnqID=g,g++;a.draw()},error:function(e,g,l){console.log(l);25>h&&setTimeout(function(){a.getModuleGOFile(h+1)},1E3)}})};a.draw=function(){a.svg.attr("width",a.width).attr("height",a.height);a.initializeBreadcrumbTrail();a.topG=a.svg.append("g").attr("transform","translate("+[a.width/2+a.padding,a.height/2+a.padding]+")");a.partition=
d3.partition().size([2*Math.PI,a.radius]);if("undefined"===typeof a.data.MOD_NAME||"undefined"!==typeof that.selectedModule.MOD_NAME&&replaceUnderscore(a.data.MOD_NAME)!==replaceUnderscore(that.selectedModule.MOD_NAME))a.getModuleGOFile(0),a.selectedNode=null;else{if(a.goDomain!==a.lastDrawn||"undefined"===typeof a.selectedNode||null===a.selectedNode){var h=a.data.GOList[0];"mf"===a.goDomain?h=a.data.GOList[2]:"bp"===a.goDomain&&(h=a.data.GOList[1]);a.selectedNode=h;a.rootN=d3.hierarchy(h).sum(function(l){return l&&
l.name&&-1<l.name.indexOf("ENS")?1:l.uniqueGene}).sort(function(l,m){return m.value-l.value})}h=a.partition(a.rootN).descendants().filter(a.filterNodes);a.lastDrawn=a.goDomain;if(a.selectedNode===a.data.GOList[0]||a.selectedNode===a.data.GOList[1]||a.selectedNode===a.data.GOList[2])a.totalSize=a.selectedNode.uniqueGene;var e=a.displayDepth;a.arc=d3.arc().startAngle(function(l){return Math.max(0,Math.min(2*Math.PI,l.x0))}).endAngle(function(l){return Math.max(0,Math.min(2*Math.PI,l.x1))}).innerRadius(function(l){return Math.max(0,
a.radius/(e+1)*l.depth)}).outerRadius(function(l){return Math.max(0,a.radius/(e+1)*l.depth+a.radius/(e+1))});setTimeout(function(){that.singleWGCNATableGoView()},50);a.vis=a.topG.append("svg:circle").attr("r",a.radius+30).style("opacity",0).on("mouseover",a.mouseleave);var g=180/Math.PI;a.path=a.topG.selectAll("path").data(h);a.path.enter().append("path").attr("d",a.arc).attr("id",function(l,m){return"ap"+m}).attr("fill-rule","evenodd").attr("fill",a.pathColor).attr("pointer-events","all").on("mouseover",
a.mouseover).on("click",a.click).each(function(l,m){var q=Math.max(0,Math.min(2*Math.PI,l.x0))*g,t=Math.max(0,Math.min(2*Math.PI,l.x1))*g,v=q+(t-q)/2;0===q&&360===t&&(v=90);a.addLabels(l,m,q,v,t,l.depth-a.rootN.depth,e)});a.path.exit().remove();a.svg.append("g").attr("transform","translate(0,15)").append("text").style("fill-opacity",1).style("fill","#000").attr("pointer-events","none").attr("text-anchor","start").style("opacity",function(l){return 1}).text(a.selectedNode.uniqueGene+" genes in module with GO annotation")}};
a.filterNodes=function(h,e){return h.depth<a.rootN.depth+a.displayDepth?!0:!1};a.click=function(h){a.selectedNode=h.data;a.rootN=h;h.data!==a.data.GOList[0]&&h.data!==a.data.GOList[1]&&h.data!==a.data.GOList[2]?a.redraw():a.draw();d3.event.stopPropagation()};a.mouseover=function(h){if("undefined"!==typeof h&&null!==h){var e=a.data.GOList[0];"mf"===a.goDomain?e=a.data.GOList[2]:"bp"===a.goDomain&&(e=a.data.GOList[1]);var g=0;g="undefined"!==typeof h&&"undefined"!==typeof h.data.value?(100*h.data.value/
e.uniqueGene).toPrecision(3):"undefined"!==typeof h?(100*h.data.uniqueGene/e.uniqueGene).toPrecision(3):100;e=g+"%";.1>g&&(e="< 0.1%");"undefined"!==typeof h.data.name&&-1===h.data.name.indexOf("ENS")&&(e=h.data.uniqueGene+" genes ("+e+")");d3.select("#percentage").text(e);d3.select("#explanation").style("visibility","");var l=a.getAncestors(h);a.updateBreadcrumbs(l,e);d3.selectAll("path").style("opacity",.3);a.topG.selectAll("text").style("opacity",.3);a.topG.selectAll("path").filter(function(m){return 0<=
l.indexOf(m)}).style("opacity",1).each(function(m){a.topG.selectAll(".txt"+removeColon(m.data.id)).style("opacity",1)});a.topG.selectAll("."+removeColon(h.data.id)).style("opacity",1);tt.transition().duration(200).style("opacity",1);tt.html(a.createToolTip(h)).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",function(){return that.positionTTTop(d3.event.pageY)})}d3.event.stopPropagation()};a.createToolTip=function(h){h.data&&(h=h.data);var e="Name:"+h.name+" ("+h.id+
")<BR><BR>Definition: "+h.definition+"<BR><BR>Unique Genes in this module with this term: "+h.uniqueGene+"<BR>";if(0<h.uniqueGene)for(var g=0;g<h.uniqueGenes.length;g++){0<g&&(e+=", ");var l=h.uniqueGenes[g].id;"undefined"!==typeof a.geneList[l]&&(l=a.geneList[l]);e+=l}return e};a.mouseleave=function(h){d3.select("#trail").style("visibility","hidden");d3.selectAll("text").style("opacity",1);d3.selectAll("path").transition().duration(500).style("opacity",1);d3.select("#explanation").style("visibility",
"hidden");tt.transition().duration(200).style("opacity",0)};a.getAncestors=function(h){for(var e=[];h.parent;)e.unshift(h),h=h.parent;return e};a.isParentOf=function(h,e){return h===e?!0:h.children?h.children.some(function(g){return a.isParentOf(g,e)}):!1};a.b={w:250,h:30,s:3,t:10,runW:0,runH:0};a.initializeBreadcrumbTrail=function(){d3.select("#singleWGCNASVG").remove();d3.select("#trail").remove();d3.select("#viewGene").append("svg:svg").attr("width",a.width).attr("height",68).attr("id","trail").append("svg:text").attr("id",
"endlabel").style("fill","#000");a.svg=d3.select("#viewGene").append("svg").attr("id","singleWGCNASVG").attr("height",a.height+"px").attr("width","100%")};a.breadcrumbPoints=function(h,e){var g=7.5*h.data.name.length+25,l=[];l.push("0,0");l.push(g+",0");l.push(g+a.b.t+","+a.b.h/2);l.push(g+","+a.b.h);l.push("0,"+a.b.h);0<e&&l.push(a.b.t+","+a.b.h/2);return l.join(" ")};a.updateBreadcrumbs=function(h,e){var g=d3.select("#trail").selectAll("g").data(h,function(l){return l.data.name+l.depth});g.exit().remove();
a.b.runW=0;a.b.runH=0;g=g.enter().append("svg:g").merge(g).attr("transform",function(l,m){var q=7.5*l.data.name.length+25,t=a.b.runW;t+q>a.width&&(t=0,a.b.runH=a.b.runH+a.b.h+a.b.s,a.b.runW=0);a.b.runW=a.b.runW+q+a.b.s;return"translate("+t+", "+a.b.runH+")"});g.append("svg:polygon").attr("points",a.breadcrumbPoints).style("fill",a.pathColor);g.append("svg:text").attr("x",function(l){return(7.5*l.data.name.length+25+a.b.t)/2}).attr("y",a.b.h/2).attr("dy","0.35em").attr("text-anchor","middle").text(function(l){l=
l.data.name;0===l.indexOf("ENS")&&"undefined"!==typeof a.geneList[l]&&(l=a.geneList[l]);return l});d3.select("#trail").select("#endlabel").attr("x",a.b.runW+15).attr("y",a.b.h/2+a.b.runH).attr("dy","0.35em").attr("text-anchor","start").text(e);d3.select("#trail").attr("height",function(){var l=a.b.runH+a.b.h+5;68>l&&(l=68);return l}).style("visibility","")};return a};that.flattenTree=function(a,d){-1===d.data.name.indexOf("ENS")&&a.push(d);if(d.children)for(var c=0;c<d.children.length;c++)that.flattenTree(a,
d.children[c])};that.singleWGCNATableGoView=function(){$("div#waitGoTable").hide();$("div#wgcnaModuleTable").hide();$("div#wgcnaMirTable").hide();$("div#wgcnaMirGeneTable").hide();$("div#wgcnaEqtlTable").hide();$("div#wgcnaGoTable").show();$("span#GoTableName").html(that.selectedModule.MOD_NAME);d3.select("div#tableExportCtl").selectAll("span").remove();d3.select("div#tableExportCtl").append("span").attr("class","button").style("margin-right","10px").on("click",function(){$("#GoTable").tableExport({type:"csv",
escape:"false"})}).html("Export CSV");$.fn.DataTable.isDataTable("table#GoTable")&&$("table#GoTable").DataTable().destroy();d3.select("#GoTable").select("tbody").selectAll("tr").remove();var a=[];that.flattenTree(a,that.singleImage.rootN);a=d3.select("#GoTable").select("tbody").selectAll("tr").data(a,function(d,c){return c});a.exit().remove();a.enter().append("tr").style("background-color",that.singleImage.pathColor).style("display",function(d){var c="none";d.depth<=that.singleImage.rootN.depth?c=
"":d.depth===that.singleImage.rootN.depth+1&&(c="");return c}).style("cursor","pointer").merge(a).attr("id",function(d){return d.id}).attr("class",function(d){return" d"+d.depth}).on("mouseover",function(d){d3.select(this).style("background-color","#FFFFFF");gtag("event","mouseOverGOTbl",{event_category:"wgcna"})}).on("mouseleave",function(d){d3.select(this).style("background-color",that.singleImage.pathColor(d))}).on("click",function(d){that.singleImage.selectedNode=d.data;that.singleImage.rootN=
d;$("span[name=d"+d.depth+"]").addClass("less");$("tr.d"+d.depth).show();that.singleImage.redraw();gtag("event","wgcna",{event_category:"mouseClickGOTbl"})}).each(function(d,c){var h=d3.select(this);h.append("td").style("padding-left",function(){return 20*d.depth+"px"}).html(function(){var e=d.data.name+" ("+d.data.id+")";-1<d.data.name.indexOf("ENS")&&(e=that.singleImage.geneList[d.data.name]+" ("+d.data.id+")");var g=e;if("undefined"!==typeof d.children&&0<d.children.length){g="";d.depth<=that.singleImage.rootN.depth&&
(g=" less");for(var l=0,m=0;m<d.children.length&&0===l;m++)-1===d.children[m].data.name.indexOf("ENS")&&(l=1);g=1===l?'<span class="trigger'+g+'" name="d'+(d.depth+1)+'">'+e+"</span>":e}return g});h.append("td").html(d.data.definition);h.append("td").html(function(){if(0<d.data.uniqueGene){var e='<span class="triggerGL" name="gl'+c+'">'+d.data.uniqueGene+"</span><BR>";e=e+'<span id="gl'+c+'" style="display:none;" >';for(var g=0;g<d.data.uniqueGenes.length;g++){0<g&&(e+=", ");var l=d.data.uniqueGenes[g].id;
"undefined"!==typeof that.singleImage.geneList[l]&&(l=that.singleImage.geneList[l]);e+=l}e+="</span>"}else e="0";return e})});$("#GoTable .trigger").on("click",function(d){var c=this.getAttribute("name");if($("."+c).is(":hidden"))$("span[name="+c+"]").addClass("less"),$("tr."+c).show();else for(c=parseInt(c.substr(1));0<$("tr.d"+c).length;)$("span[name=d"+c+"]").removeClass("less"),$("tr.d"+c).hide(),c++;d.stopPropagation()});$("#GoTable .triggerGL").on("click",function(d){var c=this.getAttribute("name");
$("#"+c).is(":hidden")?($(this).addClass("less"),$("span#"+c).show()):($(this).removeClass("less"),$("span#"+c).hide());d.stopPropagation()});$("#GoTable").DataTable({bPaginate:!1,bSort:!1,asStripClasses:[],sDom:"f<t>"})};that.singleWGCNAImageEQTLView=function(){var a=that.singleWGCNAImage();$(".linkCTL").hide();$(".mirCTL").hide();$(".goCTL").hide();$(".eqtlCtls").show();a.type="eqtl";a.createToolTip=function(d){var c=that.selectedGene[d];return c.geneSymbol?"<BR>Gene: "+c.geneSymbol+"("+d+")":"<BR>Gene: "+
d};a.colorGene=function(d){var c="#DFC184";if(0===d.indexOf("Brain")||0===d.indexOf("Unannotated"))c="#7EB5D6";return c};a.displayDefault=function(){d3.select("#viewGene").remove();d3.select("#circos").remove();that.selectedModule&&(a.update(contextRoot+"tmpData/browserCache/"+genomeVer+"/circos/ds"+that.wDSID+"/"+replaceUnderscore(that.selectedModule.MOD_NAME)+"/"+replaceUnderscore(that.selectedModule.MOD_NAME)+"_1/svg/circos_new.svg"),that.singleWGCNATableEQTLView())};a.draw=function(){};a.update=
function(d){$.ajax({url:d,type:"GET",data:{},dataType:"html",success:function(c){d3.select("#circos").remove();d3.select("#wgcnaGeneImage").append("div").attr("id","circos");$("#circos").html(c);$("#circosModule").css("width","100%");$("#circosModule").css("height",Math.floor(.9*window.innerHeight)+"px");a.panZoomCircos=svgPanZoom("#circosModule",{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,minZoom:.1,maxZoom:4,fit:!0,center:!0});d3.select("#circosModule").selectAll(".circosGene").style("cursor",
"pointer").on("mouseover",function(){d3.select(this).style("fill","#000000").attr("font-size","50px");tt.transition().duration(200).style("opacity",1);tt.html(a.createToolTip(d3.select(this).attr("id"))).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",function(){return that.positionTTTop(d3.event.pageY)});gtag("event","mouseOverEQTL",{event_category:"wgcna"})}).on("mouseout",function(){var h=a.colorGene(d3.select(this).attr("id"));d3.select(this).style("fill",h).attr("font-size",
"26px");tt.transition().duration(500).style("opacity",0)});that.singleWGCNATableEQTLView()}})};return a};that.singleWGCNATableEQTLView=function(){$("div#waitEqtlTable").hide();$("div#wgcnaModuleTable").hide();$("div#wgcnaMirTable").hide();$("div#wgcnaMirGeneTable").hide();$("div#wgcnaGoTable").hide();$("div#wgcnaEqtlTable").show();$("span#eqtlTableName").html(that.selectedModule.MOD_NAME);d3.select("div#tableExportCtl").selectAll("span").remove();d3.select("div#tableExportCtl").append("span").attr("class",
"button").style("margin-right","10px").on("click",function(){$("#eqtlTable").tableExport({type:"csv",escape:"false"})}).html("Export CSV");$.ajax({url:contextRoot+"tmpData/browserCache/"+genomeVer+"/modules/ds"+that.wDSID+"/"+replaceUnderscore(that.selectedModule.MOD_NAME)+".eQTL.json",type:"GET",async:!0,data:{},dataType:"json",beforeSend:function(){$("div#waitEqtlTable").show()},success:function(a){setTimeout(function(){$.fn.DataTable.isDataTable("table#eqtlTable")&&$("table#eqtlTable").DataTable().destroy();
for(var d=[],c=1*$("#eqtlPval").val(),h="",e=0,g=0;g<a.length;g++)a[g].Pval>=c&&(a[g].Pval>e&&(h=a[g].Snp,e=a[g].Pval),d.push(a[g]));d3.select("#eqtlTable").select("tbody").selectAll("tr").remove();d3.select("#eqtlTable").select("tbody").selectAll("tr").data(d,that.eQTLKey).enter().append("tr").attr("id",function(l){return"tblLink_"+l.Snp}).attr("class",function(l,m){var q="odd";0===m%2&&(q="even");return q}).each(function(l,m){var q=l.Start/1E6;d3.select(this).append("td").html(l.Chr);d3.select(this).append("td").html(q.toFixed(1));
d3.select(this).append("td").html(l.Snp);d3.select(this).append("td").html(l.Pval.toFixed(2))});$("#eqtlTable").DataTable({bPaginate:!1,aaSorting:[[3,"desc"]],sDom:"fiB<t>",buttons:["copy","excel","pdf"]});$("div#waitEqtlTable").hide();d3.select("#circosModule").select("g#Link_"+h).select("path").style("stroke","#FFF450")},20)},error:function(a,d,c){}})};that.singleWGCNAImageMetaView=function(){var a=that.singleWGCNAImage();$(".goCTL").hide();$(".eqtlCtls").hide();$(".linkCTL").show();$(".mirCTL").hide();
a.CorCutoff_min=.75;a.CorCutoff_max=1;a.type=that.viewType;a.truncated=0;a.filterOneDB=1;a.mirGeneCutoff=1;a.mirValid=0;a.mirTargetID="";a.mirID="";a.miRcolor=d3.scaleOrdinal(d3.schemeCategory20b);a.sortMir=0;a.maxCorWidth=5;a.mlinkKey=function(d){return that.removeInvalidIDChars(d.MOD1)+"_"+that.removeInvalidIDChars(d.MOD2)};a.colorCircle=function(d){return d.COLOR};a.colorLink=function(d){var c=a.negColor;0<d.COR&&(c=a.posColor);return c};a.colorLinkHighlight=function(d){var c=a.negDarkColor;0<
d.COR&&(c=a.posDarkColor);return c};a.drawLinks=function(d){a.updateColor("linkColor");a.svg.selectAll(".link").remove();for(var c=a.metaData.LINKS,h=[],e=0,g=0;g<c.length;g++)(c[g].MOD1===d.MODULE||c[g].MOD2===d.MODULE)&&a.CorCutoff_min<=Math.abs(c[g].COR)&&Math.abs(c[g].COR)<=a.CorCutoff_max&&(h[e]=c[g],e++);c=h;1E4>c.length&&(d=a.topG.selectAll(".link").data(c,a.mlinkKey),d.enter().append("line").attr("class","link").attr("pointer-events","none").attr("id",function(l){return"ln_"+that.removeInvalidIDChars(l.MOD1)+
that.removeInvalidIDChars(l.MOD2)}).attr("x1",function(l){return d3.select("#mod_"+that.removeInvalidIDChars(l.MOD1)).attr("cx")}).attr("y1",function(l){return d3.select("#mod_"+that.removeInvalidIDChars(l.MOD1)).attr("cy")}).attr("x2",function(l){return d3.select("#mod_"+that.removeInvalidIDChars(l.MOD2)).attr("cx")}).attr("y2",function(l){return d3.select("#mod_"+that.removeInvalidIDChars(l.MOD2)).attr("cy")}).attr("stroke",a.colorLink).attr("stroke-width",function(l){return Math.abs(l.COR)*a.maxCorWidth}).merge(d))};
a.drawLinksBetween=function(d){a.updateColor("linkColor");for(var c={},h=0;h<d.length;h++)c[d[h]]=1;a.svg.selectAll(".link").remove();d=a.metaData.LINKS;h=[];for(var e=0,g=0;g<d.length;g++)(0===a.showAllFromTarget&&"undefined"!==typeof c[d[g].MOD1]&&"undefined"!==typeof c[d[g].MOD2]||1===a.showAllFromTarget&&("undefined"!==typeof c[d[g].MOD1]||"undefined"!==typeof c[d[g].MOD2]))&&a.CorCutoff_min<=Math.abs(d[g].COR)&&Math.abs(d[g].COR)<=a.CorCutoff_max&&(h[e]=d[g],e++);d=h;1E4>d.length&&(c=a.topG.selectAll(".link").data(d,
a.mlinkKey),c.enter().append("line").attr("class","link").attr("pointer-events","none").attr("id",function(l){return"ln_"+that.removeInvalidIDChars(l.MOD1)+that.removeInvalidIDChars(l.MOD2)}).attr("x1",function(l){return d3.select("#mod_"+that.removeInvalidIDChars(l.MOD1)).attr("cx")}).attr("y1",function(l){return d3.select("#mod_"+that.removeInvalidIDChars(l.MOD1)).attr("cy")}).attr("x2",function(l){return d3.select("#mod_"+that.removeInvalidIDChars(l.MOD2)).attr("cx")}).attr("y2",function(l){return d3.select("#mod_"+
that.removeInvalidIDChars(l.MOD2)).attr("cy")}).attr("stroke",a.colorLink).attr("stroke-width",function(l){return Math.abs(l.COR)*a.maxCorWidth}).merge(c))};a.nodeX=function(d,c){var h=50,e=Math.floor(c/a.maxPerLevel)+1;1<e&&(h=60*e);return a.width/2+(a.r-h)*Math.cos(c%a.maxPerLevel*a.angle-1.57079633)};a.nodeY=function(d,c){var h=50;c>a.maxPerLevel&&(h=60*(Math.floor(c/a.maxPerLevel)+1));return a.height/2+(a.r-h)*Math.sin(c%a.maxPerLevel*a.angle-1.57079633)};a.nodeXLbl=function(d,c){var h=c%a.maxPerLevel*
a.angle-1.57079633,e=1;if(Math.PI/2<h&&h<1.5*Math.PI){var g=0;"undefined"!==typeof d.MODULE&&(g=d.MODULE.length);e+=7.5*g}return a.width/2+(a.r+e)*Math.cos(h)};a.nodeYLbl=function(d,c){var h=c%a.maxPerLevel*a.angle-1.57079633,e=1;if(Math.PI/2<h&&h<1.5*Math.PI){var g=0;"undefined"!==typeof d.MODULE&&(g=d.MODULE.length);e+=7.5*g}return a.height/2+(a.r+e)*Math.sin(h)};a.drawCorLegend=function(d){a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",d).text("Positive Correlation");
a.legendDispG.append("rect").attr("x","0").attr("y",d-10).attr("width","30").attr("height","10").style("fill",a.posColor);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",d+20).text("Negative Correlation");a.legendDispG.append("rect").attr("x","0").attr("y",d+10).attr("width","30").attr("height","10").style("fill",a.negColor);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",d+40).text("Lower Correlation");a.legendDispG.append("line").attr("x1",
"0").attr("y1",d+30).attr("x2","30").attr("y2",d+30).style("stroke","#000000").style("stroke-width","0");a.legendDispG.append("line").attr("x1","0").attr("y1",d+35).attr("x2","30").attr("y2",d+35).style("stroke","#000000").style("stroke-width","0.5");a.legendDispG.append("line").attr("x1","0").attr("y1",d+40).attr("x2","30").attr("y2",d+40).style("stroke","#000000").style("stroke-width","1");a.legendDispG.append("line").attr("x1","0").attr("y1",d+45).attr("x2","30").attr("y2",d+45).style("stroke",
"#000000").style("stroke-width","2");a.legendDispG.append("line").attr("x1","0").attr("y1",d+55).attr("x2","30").attr("y2",d+55).style("stroke","#000000").style("stroke-width","3");a.legendDispG.append("line").attr("x1","0").attr("y1",d+65).attr("x2","30").attr("y2",d+65).style("stroke","#000000").style("stroke-width","5");a.legendDispG.append("line").attr("x1","0").attr("y1",d+75).attr("x2","30").attr("y2",d+75).style("stroke","#000000").style("stroke-width","7");a.legendDispG.append("text").style("font-size",
"16").attr("x","35").attr("y",d+80).text("Higher Correlation")};a.drawLegend=function(){a.drawCorLegend(20)};a.selectMetaMod=function(d){that.topselectedModule=that.selectedModule;that.selectedModule=that.modules[d];that.topselectedGene=that.selectedGene;that.selectedGene={};for(d=0;d<that.selectedModule.TCList.length;d++)"undefined"===typeof that.selectedGene[that.selectedModule.TCList[d].Gene.ID]&&(that.selectedGene[that.selectedModule.TCList[d].Gene.ID]={},that.selectedGene[that.selectedModule.TCList[d].Gene.ID].geneSymbol=
that.selectedModule.TCList[d].Gene.geneSymbol,that.selectedGene[that.selectedModule.TCList[d].Gene.ID].tcList=[]),that.selectedGene[that.selectedModule.TCList[d].Gene.ID].tcList.push(that.selectedModule.TCList[d]);that.viewType="gene";d3.select("#wgcnaGeneViewRB").property("checked",!0);that.createSingleWGCNAImage()};a.draw=function(){a.updateColor("linkColor");a.width=$(window).width();a.height=Math.floor(.9*window.innerHeight);a.r=a.height>a.width?Math.floor(a.width/2*.95):Math.floor(a.height/2*
.95);a.svg.attr("height",a.height+"px");a.svg.selectAll("circle").remove();a.svg.selectAll("text").remove();a.svg.selectAll("line").remove();a.svg.selectAll(".mod").remove();"undefined"!==typeof a.panZoom&&(a.panZoom.destroy(),delete a.panZoom);a.svg.selectAll(".svg-pan-zoom_viewport").remove();setTimeout(function(){a.svg.append("text").style("font-size","20").attr("y",22).attr("x",5).text(function(){return that.selectedModule?"Meta Module for "+replaceUnderscore(that.selectedModule.MOD_NAME):""});
a.setupLegend();a.data=a.metaData.MODULES;a.angle=2*Math.PI/a.data.length;a.angleDeg=360/a.data.length;a.data.length>a.maxPerLevel&&(a.angle=2*Math.PI/a.maxPerLevel,a.angleDeg=360/a.maxPerLevel);if(150<a.data.length){a.truncated=1;a.maxNodeR=15;for(var d=[],c=0;150>c;c++)d[c]=a.data[c];a.data=d;a.dataIndex={};for(c=0;c<a.data.length;c++)a.dataIndex[a.data[c].ID]=1;a.CorCutoff_min=.75;$("#linkSliderMin").slider("value",.75);$("span#minLabel").html(.75);a.svg.append("image").attr("x",7.8*that.selectedModule.MOD_NAME.length+
20).attr("y",1).attr("width","24px").attr("height","24px").attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAJI0lEQVRIDQEYCef2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAAH/gAACcAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAADwAAALkCAABoFDEx0gIzM+/b29v4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGIAAAAvAgAAHDnn54QGBgY3SUlJBwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8AAB0AAAChAAAADAAAAAAU9vYY4RER/ecNDdLZ2dnvAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB5AAAAFgAAAAAAAAAABv7+BFHZ2UgFAgI4Ozs7DAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAtAAAAmAAAAAQAAAAAAAAAAAAAAAAU9/cM7AoKAOYYGNTZ2dnqAAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAFAAAAnQAAACf8AgIAzhgY/uIODv4V9vYBBP//AR3z8xrKHBzjDhwc2uDg4PYAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASwAAAEUAAAAB+AMDAJwyMveSODjT9QUF+AAAAAAY9PQOTN3dTxISEipAQEAEAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAADAAAAIAAAAAEAAAAAAAAAAAC/v7vAv7+tQn7+/IAAAAAAAAAAT/g4DQd8/NHCgoKFAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGcAAAAuAAAAAAAAAAAAAAAAAAEB+gP//+QF///7AAAAAAAAAAAQ+voIVtfXUggICDM5OTkJAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAP8AABYAAAB4AAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAATXm5iYt6+tMExMTHAAAAAEAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB7AAAAEwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAF/v4CVdfXSw0EBDdAQEALAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAD/AAAzAAAAkwAAAAYAAAAAAAAAAAAAAAAAAQEAAAAA/kDh4QAb8/MpAgAACAAAAAAAAAAAAAAAABT29g7vCAgB4RYW1NnZ2eoAAAD/AAAAAAAAAAAAAAAAAAAAAAD/AAAE/wAAtf8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD/5Q0N7WNKSnFHR0cSAAAAAAAAAAADAAAAAAAAAAAAAAAAgAAATAAAAHkAAAADAAAAAAAAAAAAAAAAAAAAAPgEBP+XMzP7xR8f7ivq6gcH/f0CAAAAAAAAAAAAAAAAAAAAAAz6+gj9AgIM2Bsb0QoKCujn5+f+AgAAAAAAAAAA/wAABwAAAIkAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAD9AQEA1hUV9MwZGccAAAD2AAAAAAAAAAAAAAAAAAAAAAAAAAABAAABR97eNhb390ceHh4RAAAAAAAAAAAAAAAAAP8AAG//AAD+/wAA//8AAP//AAD//wAA//8AAP//AAD//gAA/u4ICPvzBQXw/gAA/P8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP/CHR3SVVBQNgAAAAACAAAAAP8AAAgAAABfAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAER+PgEDPv7DwEAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMOnpJyHy8icAAAAABAAAAAABAAD42BMTgdUTE2buCwsz/QICCQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8BAAD/AAEBAf8AAAEAAAAAAAAAAAAAAAAAAAAAAAAAAPEHB/vhEBANAAAAAAQAAAAAAAAAAHU6OrsDAwPnAgICIQEBAQUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQH//f39zgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAs0IPw6I24JoAAAAASUVORK5CYII=").attr("pointer-events",
"all").style("cursor","pointer").on("mouseover",function(){$("#wgcnaMouseHelp").html("Warning: Modules displayed are truncated to the top 150 most connected modules due to the size of the meta module.")}).on("mouseout",function(){$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")})}else a.maxNodeR=28;a.topG=a.svg.append("g").attr("class","svg-pan-zoom_viewport");d=a.topG.selectAll(".mod").data(a.data,a.modKey);d.enter().append("circle").attr("class",
"mod").attr("id",function(g){return"mod_"+that.removeInvalidIDChars(g.MODULE)}).attr("cx",a.nodeX).attr("cy",a.nodeY).attr("r",3).attr("stroke","#000000").attr("fill","#FF0000").merge(d);d=a.metaData.LINKS;c=[];for(var h=0,e=0;e<d.length;e++)a.CorCutoff_min<=Math.abs(d[e].COR)&&Math.abs(d[e].COR)<=a.CorCutoff_max&&(0===a.truncated||"undefined"!==typeof a.dataIndex[d[e].MOD1]&&"undefined"!==typeof a.dataIndex[d[e].MOD2])&&(c[h]=d[e],h++);d=c;a.showLinks&&1E4>d.length&&(d=a.topG.selectAll(".link").data(d,
a.mlinkKey),d.enter().append("line").attr("class","link").attr("id",function(g){return"ln_"+that.removeInvalidIDChars(g.MOD1)+that.removeInvalidIDChars(g.MOD2)}).attr("x1",function(g){return d3.select("#mod_"+that.removeInvalidIDChars(g.MOD1)).attr("cx")}).attr("y1",function(g){return d3.select("#mod_"+that.removeInvalidIDChars(g.MOD1)).attr("cy")}).attr("x2",function(g){return d3.select("#mod_"+that.removeInvalidIDChars(g.MOD2)).attr("cx")}).attr("y2",function(g){return d3.select("#mod_"+that.removeInvalidIDChars(g.MOD2)).attr("cy")}).attr("stroke",
a.colorLink).attr("stroke-width",function(g){return Math.abs(g.COR)*a.maxCorWidth}).merge(d));a.topG.selectAll(".mod").remove();d=a.topG.selectAll(".mod").data(a.data,a.geneKey);d.enter().append("g").append("circle").attr("cx",a.nodeX).attr("cy",a.nodeY).attr("r",20).attr("stroke","#000000").attr("fill",a.colorCircle).attr("class",function(g){return"mod "+that.removeInvalidIDChars(g.MODULE)}).attr("id",function(g){return"mod_"+that.removeInvalidIDChars(g.MODULE)}).on("click",function(g){that.moduleGenes[g.MODULE]||
(that.moduleGenes[g.MODULE]="",that.requestModule(g.MODULE,a.selectMetaMod))}).on("mouseover",a.mouseoverModule).on("mouseout",a.mouseleaveModule).merge(d).each(function(g,l){d3.select(this.parentNode).append("g").attr("class","label").attr("id",function(m){return"txt_"+that.removeInvalidIDChars(m.MODULE)}).attr("transform",function(){var m=a.nodeXLbl(g,l),q=a.nodeYLbl(g,l);return"translate("+m+","+q+")"}).append("text").attr("transform",function(){var m=-90+l%a.maxPerLevel*a.angleDeg;90<m&&(m-=180);
return"rotate("+m+")"}).text(function(){return g.MODULE})});d.exit().remove()},250)};a.requestMeta=function(){$.ajax({url:pathPrefix+"getWGCNAMetaModules.jsp",type:"GET",async:!0,data:{source:that.selSource,id:replaceUnderscore(that.selectedModule.MOD_NAME),organism:organism,panel:that.panel,tissue:that.tissue,region:that.region,geneList:that.geneList,genomeVer:genomeVer},dataType:"json",success:function(d){setTimeout(function(){a.metaData=d[0];a.draw();that.singleWGCNATableMetaView()},50)},error:function(d,
c,h){setTimeout(function(){a.requestMeta()},2E3)}})};a.mouseoverModule=function(){$("#wgcnaMouseHelp").html("<B>Click</B> to select this module and see additional details.");d3.select(this).style("fill","url(#selectGrad)");tt.transition().duration(200).style("opacity",1);tt.html(a.createToolTip(d3.select(this).datum())).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",function(){return that.positionTTTop(d3.event.pageY)});var d=d3.select(this.parentNode).datum();$("[id^=ln_"+
that.removeInvalidIDChars(d.MODULE)+"]").each(function(){var c=$(this).attr("id");d3.select("line#"+c).attr("stroke",a.colorLinkHighlight)});$("[id$="+that.removeInvalidIDChars(d.MODULE)+"]").each(function(){var c=$(this).attr("id");d3.select("line#"+c).attr("stroke",a.colorLinkHighlight)});a.showLinks||a.drawLinks(d);d3.select("#txt_"+that.removeInvalidIDChars(d.MODULE)).select("text").attr("fill","#00A347");gtag("event","mouseOverModule",{event_category:"wgcna"})};a.mouseleaveModule=function(){var d=
d3.select(this.parentNode).datum();$("[id^=ln_"+that.removeInvalidIDChars(d.MODULE)+"]").each(function(){var c=$(this).attr("id");d3.select("line#"+c).attr("stroke",a.colorLink)});$("[id$="+that.removeInvalidIDChars(d.MODULE)+"]").each(function(){var c=$(this).attr("id");d3.select("line#"+c).attr("stroke",a.colorLink)});d3.select(this).style("fill",a.colorCircle);d3.select("#txt_"+that.removeInvalidIDChars(d.MODULE)).select("text").attr("fill","#000000");tt.transition().duration(500).style("opacity",
0);a.showLinks||a.svg.selectAll(".link").remove();"mir"===that.viewType&&(a.mirTargetID=$("#mirGeneFilterTxt").val().toLowerCase(),a.svg.selectAll(".mirLink").remove(),that.singleImage.drawMiR())};a.createToolTip=function(d){return"Module: "+d.MODULE};return a};that.singleWGCNATableMetaView=function(){$("div#wgcnaModuleTable").hide();$("div#wgcnaMirTable").hide();$("div#wgcnaMirGeneTable").hide();$("div#wgcnaGoTable").hide();$("div#wgcnaEqtlTable").hide()};return that};