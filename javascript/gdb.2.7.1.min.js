$.cookie.defaults.expires=365;var svgList=[],svgViewIDList=[],processAjax=0,ajaxList=[],trackInfo=[],selectedGeneSymbol="",selectedID="",trackSettings=[],overSelectable=0,zoomUpdateHandle=Math.NaN,ratOnly=[],mouseOnly=[],history=[[],[]],customTrackCount=0,testChrome=/chrom(e|ium)/.test(navigator.userAgent.toLowerCase()),testSafari=/safari/.test(navigator.userAgent.toLowerCase()),testFireFox=/firefox/.test(navigator.userAgent.toLowerCase()),testIE=/(wow|.net|ie)/.test(navigator.userAgent.toLowerCase());
testChrome&&testSafari&&(testSafari=!1);!testIE||testChrome||testFireFox||testSafari||$("#IEproblem").show();ratOnly.snpSHRJ=1;ratOnly.snpF344=1;ratOnly.snpSHRH=1;ratOnly.snpBNLX=1;ratOnly.helicos=1;ratOnly.spliceJnct=1;ratOnly.illuminaTotal=1;ratOnly.illuminaSmall=1;ratOnly.illuminaPolyA=1;ratOnly.liverTotal=1;ratOnly.liverspliceJnct=1;ratOnly.liverilluminaTotalPlus=1;ratOnly.liverilluminaTotalMinus=1;ratOnly.polyASite=1;ratOnly.braincoding=1;ratOnly.brainnoncoding=1;ratOnly.brainsmallnc=1;
ratOnly.heartTotal=1;ratOnly.heartilluminaTotalPlus=1;ratOnly.heartilluminaTotalMinus=1;ratOnly.probe=1;ratOnly.mergedTotal=1;"rn5"===genomeVer&&(mouseOnly.brainTotal=1);mouseOnly.brainilluminaTotalPlus=1;mouseOnly.brainilluminaTotalMinus=1;mouseOnly.brainspliceJnct=1;mouseOnly.probeMouse=1;
var mmVer='Mouse(<span id="verSelect"></span>) Strain:C57BL/6J',rnVer='Rat(<span id="verSelect"></span>) Strain:BN',siteVer="PhenoGen v3.5.1(1/24/2019)",trackBinCutoff=1E4,customTrackLevel=-1,mouseTTOver=0,ttHideHandle=0,tt=d3.select("body").append("div").attr("class","testToolTip").style("z-index",1001).style("opacity",0);tt.append("span").style("float","right").append("img").attr("src","web/images/icons/close.png").on("click",function(){tt.style("opacity",0)});
var tsDialog=d3.select("body").append("div").attr("class","trackSetting").attr("id","trackSettingDialog").style("z-index",1001).style("margin-left","15px").style("margin-right","15px");tsDialog.append("div").attr("id","trackSettingContent").append("table").attr("cellpadding","0").attr("cellspacing","0").append("tbody");
function updatePage(f){var e=Math.round(f.xScale.domain()[0]),l=Math.round(f.xScale.domain()[1]);if((e<f.prevMinCoord||l>f.prevMaxCoord)&&(e<f.dataMinCoord||l>f.dataMaxCoord)){processAjax=1;var n=e;var c=l;e>=f.dataMinCoord&&l>f.dataMaxCoord?n=f.dataMaxCoord+1:e<f.dataMinCoord&&l<=f.dataMaxCoord&&(c=f.dataMinCoord-1);f.setLoading();$.ajax({url:pathPrefix+"updateRegion.jsp",type:"GET",data:{chromosome:chr,minCoord:n,maxCoord:c,fullminCoord:e,fullmaxCoord:l,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,
myOrganism:organism,genomeVer:genomeVer},dataType:"json",success:function(b){f.prevMinCoord=e;f.prevMaxCoord=l;e<f.dataMinCoord&&(f.dataMinCoord=e);l>f.dataMaxCoord&&(f.dataMaxCoord=l);f.folderName=b.folderName;f.updateData();processAjax=0;ga&&ga("send","event","updatePage","outsideLoadedRegion")},error:function(b,a,c){console.log(c)}})}}
function back(f){var e=1<history[f].length?history[f].pop():history[f][0];chr==e.chr&&(e.start==svgList[f].xScale.domain()[0]&&e.stop==svgList[f].xScale.domain()[1]&&(e=1<history[f].length?history[f].pop():history[f][0]),0==f&&$("#geneTxt").val(e.chr+":"+e.start+"-"+e.stop),svgList[f].xScale.domain([e.start,e.stop]),svgList[f].scaleSVG.select(".x.axis").call(svgList[f].xAxis),svgList[f].redraw(),0===f&&updatePage(svgList[f]),svgList[f].updateFullData());ga&&ga("send","event","stepBackSVGNaviation",
"navigateBack")}
function zoomIn(f,e){var l={};l.chr=chr;l.start=svgList[f].xScale.domain()[0];l.stop=svgList[f].xScale.domain()[1];var n=Math.floor((l.stop-l.start)*e);1>n&&(n=1);l.start+=n;l.stop-=n;20>l.stop-l.start&&(l.start-=n,l.stop+=n);svgList[f].xScale.domain([l.start,l.stop]);history[f].push(l);svgList[f].scaleSVG.select(".x.axis").call(svgList[f].xAxis);svgList[f].redraw();isNaN(zoomUpdateHandle)||(clearTimeout(zoomUpdateHandle),zoomUpdateHandle=Math.NaN);zoomUpdateHandle=setTimeout(function(){0===f&&updatePage(svgList[f]);
svgList[f].updateFullData();0===f&&setTimeout(function(){DisplayRegionReport()},100)},300);0===f&&$("#geneTxt").val(chr+":"+l.start+"-"+l.stop);ga&&ga("send","event","calledZoomIn",f)}
function zoomOut(f,e){var l={};l.chr=chr;l.start=svgList[f].xScale.domain()[0];l.stop=svgList[f].xScale.domain()[1];var n=Math.floor((l.stop-l.start)*e);1>n&&(n=1);l.start-=n;l.stop+=n;svgList[f].xScale.domain([l.start,l.stop]);history[f].push(l);svgList[f].scaleSVG.select(".x.axis").call(svgList[f].xAxis);svgList[f].redraw();isNaN(zoomUpdateHandle)||(clearTimeout(zoomUpdateHandle),zoomUpdateHandle=Math.NaN);zoomUpdateHandle=setTimeout(function(){0===f&&updatePage(svgList[f]);svgList[f].updateFullData();
0===f&&setTimeout(function(){DisplayRegionReport()},100)},300);0===f&&$("#geneTxt").val(chr+":"+l.start+"-"+l.stop);ga&&ga("send","event","calledZoomOut",f)}
function mup(){var f=0;for(f=0;f<svgList.length;f++)if(svgList[f]&&"undefined"!==typeof svgList[f])if(!(svgList[f].overSettings&&0!=svgList[f].overSettings||isNaN(svgList[f].downx)&&isNaN(svgList[f].downPanx))){if(0===f&&updatePage(svgList[f]),svgList[f].downx=Math.NaN,svgList[f].downPanx=Math.NaN,svgList[f].updateFullData(),0===f&&setTimeout(function(){DisplayRegionReport()},300),0==f||1==f){var e={};e.chr=chr;e.start=svgList[f].xScale.domain()[0];e.stop=svgList[f].xScale.domain()[1];history[f].push(e)}}else if(!(svgList[f].overSettings&&
0!=svgList[f].overSettings||isNaN(svgList[f].downZoomx))){var l=svgList[f].downZoomx;var n=d3.mouse(svgList[f].vis.node());svgList[f].downZoomxEnd=n[0];e=1;n[0]<l?(l=n[0],e=svgList[f].downZoomx-l):e=n[0]-l;n=Math.round(svgList[f].xScale.invert(l));l=Math.round(svgList[f].xScale.invert(l+e));svgList[f].downZoomx=Math.NaN;svgList[f].downZoomxEnd=Math.NaN;0===f&&$("#geneTxt").val(chr+":"+n+"-"+l);d3.select("#Level"+svgList[f].levelNumber).selectAll("svg rect.zoomRect").remove();d3.select("#Level"+svgList[f].levelNumber).selectAll("svg text#zoomTextStart").remove();
d3.select("#Level"+svgList[f].levelNumber).selectAll("svg text#zoomTextEnd").remove();svgList[f].xScale.domain([n,l]);svgList[f].scaleSVG.select(".x.axis").call(svgList[f].xAxis);svgList[f].redraw();svgList[f].updateFullData();0===f&&setTimeout(function(){DisplayRegionReport()},300);if(0==f||1==f)e={},e.chr=chr,e.start=n,e.stop=l,history[f].push(e)}ga&&ga("send","event","dragMouseUp","mouseUpFromDrag")}
function mmove(){var f;for(f=0;f<svgList.length;f++)if(svgList[f]&&(!svgList[f].overSettings||0===svgList[f].overSettings))if(!isNaN(svgList[f].downx)){var e=d3.mouse(svgList[f].vis.node());rupx=e[0];if(0!==rupx){var l=Math.round(svgList[f].downscalex.domain()[0]);var n=Math.round(svgList[f].mw*(svgList[f].downx-svgList[f].downscalex.domain()[0])/rupx+svgList[f].downscalex.domain()[0]);n<=svgList[f].xMax&&l>=svgList[f].xMin&&(0===f&&$("#geneTxt").val(chr+":"+l+"-"+n),svgList[f].xScale.domain([l,n]),
svgList[f].scaleSVG.select(".x.axis").call(svgList[f].xAxis),svgList[f].redraw())}}else if(isNaN(svgList[f].downPanx))isNaN(svgList[f].downZoomx)||(c=svgList[f].downZoomx,e=d3.mouse(svgList[f].vis.node()),svgList[f].downZoomxEnd=e[0],e[0]<c?(c=e[0],e=svgList[f].downZoomx-c):e=e[0]-c,l=Math.round(svgList[f].xScale.invert(c)),n=Math.round(svgList[f].xScale.invert(c+e)),d3.select("#Level"+svgList[f].levelNumber).selectAll("svg rect.zoomRect").attr("x",c).attr("width",e),d3.select("#Level"+svgList[f].levelNumber).selectAll("svg text#zoomTextStart").attr("x",
c).attr("y",15).text(numberWithCommas(l)),d3.select("#Level"+svgList[f].levelNumber).selectAll("svg text#zoomTextEnd").attr("x",c+e).attr("y",50).text(numberWithCommas(n)));else if(e=d3.mouse(svgList[f].vis.node()),rupx=e[0],0!==rupx){n=svgList[f].downPanx-rupx;var c=(svgList[f].downscalex.domain()[1]-svgList[f].downscalex.domain()[0])/svgList[f].mw;l=Math.round(svgList[f].downscalex.domain()[0]+n*c);n=Math.round(n*c+svgList[f].downscalex.domain()[1]);n<=svgList[f].xMax&&l>=svgList[f].xMin&&(0===
f&&$("#geneTxt").val(chr+":"+l+"-"+n),svgList[f].xScale.domain([l,n]),svgList[f].scaleSVG.select(".x.axis").call(svgList[f].xAxis),svgList[f].redraw(),svgList[f].downPanx=e[0])}}d3.select("html").on("mousemove",mmove).on("mouseup",mup);$(window).resize(function(){for(var f=0;f<svgList.length;f++)svgList[f]&&svgList[f].resize($(window).width()-25)});
$(document).on("click",".closeBtn",function(){var f=new String($(this).attr("id"));f=f.substr(6);$("."+f).fadeOut("fast");if(-1<f.indexOf("viewsLevel")){var e=f.substr(f.length-1);$("div#nameView"+e).hide();$("div#selection"+e).show();$("span#viewMenuLbl"+e).html("Select/Edit Views");$("div.trackLevel"+e).fadeOut("fast")}ga&&ga("send","event","closeSettings",f);return!1});
$(document).on("click",".viewSelect",function(){var f=$(this).attr("id");f=f.substr(f.length-1);if($(".viewsLevel"+f).is(":visible"))$(".viewsLevel"+f).fadeOut("fast");else{var e=$(this).parent().parent().position().top;$(".viewsLevel"+f).css("top",e).css("left",$(window).width()-610);$(".viewsLevel"+f).fadeIn("fast");$("#trackSettingDialog").hide();tt.transition().duration(200).style("opacity",0);ga&&ga("send","event","openViews",f)}return!1});
$(document).on("change","input[name='optioncbx']",function(){var f=new String($(this).attr("id")),e=f.indexOf("CBX"),l=new String(f.substr(0,e));e=f.substr(e+3,1);redrawTrack(e,l);ga&&ga("send","event","changeSettingView",f)});$(document).on("change","input[name='imgCBX']",function(){var f=new String($(this).attr("id")),e=f.indexOf("CBX");new String(f.substr(0,e));e=f.substr(e+3,1);svgList[e].redraw();setTimeout(function(){DisplayRegionReport()},300);ga&&ga("send","event","clickCbx",f)});
$(document).on("click",".reset",function(){var f=new String($(this).attr("id")),e=f.substr(f.length-1);0===f.indexOf("resetImage")?0===e&&($("#geneTxt").val(chr+":"+initMin+"-"+initMax),svgList[0].xScale.domain([initMin,initMax]),svgList[0].scaleSVG.select(".x.axis").call(svgList[0].xAxis),svgList[0].redraw()):0===f.indexOf("resetTracks")&&(svgList[e].removeAllTracks(),setupDefaultView(e));ga&&ga("send","event","resetImage",f)});
function numberWithCommas(f){return f.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}
function displayHelpFirstTime(){if(-1===navigator.userAgent.toLowerCase().indexOf("phantomjs"))if($.cookie("genomeBrowserHelp")){var f=$.cookie("genomeBrowserHelp"),e=f.indexOf("v")+1,l=f.indexOf(".",f.indexOf(".")+1);f=f.substr(e,l-e);e=siteVer.indexOf("v")+1;l=siteVer.indexOf(".",siteVer.indexOf(".")+1);e=siteVer.substr(e,l-e);f!==e&&(setTimeout(function(){$("a#fbhelp1").click()},1E3),$.cookie("genomeBrowserHelp",siteVer))}else setTimeout(function(){$("a#fbhelp1").click()},1E3),$.cookie("genomeBrowserHelp",
siteVer)}function removeTrack(f,e){"undefined"!==typeof svgList[f]&&svgList[f].removeTrack(e);ga&&ga("send","event","removeTrack",f,e)}function redrawTrack(f,e){svgList[f].redrawTrack(e);ga&&ga("send","event","redrawTrack",f,e)}function changeTrackHeight(f,e){if(0<e){var l=e+"px";$("#Scroll"+f).css({"max-height":l,overflow:"auto"})}else $("#Scroll"+f).css({"max-height":"",overflow:"hidden"})}registerKeyboardHandler=function(f){d3.select(window).on("keydown",f)};
function getAllChildrenByName(f,e){var l=[],n=0;if("undefined"!==typeof f&&null!==f&&"undefined"!==typeof f.childNodes)for(var c=f.childNodes,b=0;b<c.length;b++)c.item(b).nodeName==e&&(l[n]=c.item(b),n++);return l}function getFirstChildByName(f,e){var l=null;if(null!==f&&"undefined"!==typeof f&&"undefined"!==typeof f.childNodes)for(var n=f.childNodes,c=!1,b=0;b<n.length&&!c;b++)n.item(b).nodeName==e&&(l=n.item(b),c=!0);return l}
function getAddMenuDiv(f,e){var l="/"+pathPrefix;""==pathPrefix&&(l="");$.ajax({url:l+"settingsMenu.jsp",type:"GET",cache:!1,data:{level:f,organism:organism,type:e},dataType:"html",success:function(e){$("#imageMenu"+f).remove();d3.select("div#imageMenu").append("div").attr("id","imageMenu"+f);$("#imageMenu"+f).html(e)},error:function(e,c,b){$("#imageMenu"+f).remove();d3.select("div#imageMenu").append("div").attr("id","imageMenu"+f);$("#imageMenu"+f).append('<div class="settingsLevel'+f+'">An error occurred generating this menu.  Please try back later.</div>')},
async:!1})}function loadStateFromString(f,e,l,n){loadSavedConfigTracks(f,l,n);loadImageState(e,l)}
function loadSavedConfigTracks(f,e,l){f=f.split(";");var n=0;l=90>e?svgList[e]:l;for(var c=0;c<f.length;c++){var b=f[c].split(",");if(("Rn"==organism&&"undefined"===typeof mouseOnly[b[0]]||"Mm"==organism&&"undefined"===typeof ratOnly[b[0]])&&""!=b[0]){n++;var a="";if(2<b.length)for(var g=2;g<b.length;g++)a=2==g?b[g]:a+","+b[g];1==e&&(a+=",DrawTrx");l.addTrack(b[0],b[1],a,0)}}0==n&&setupDefaultView(e)}
function loadImageState(f,e){if("undefined"!==typeof f&&""!=f)for(var l=f.split(";"),n=0;n<l.length;n++){var c=l[n].split("=");0==(new String(c[0])).indexOf("displaySelect")&&changeTrackHeight("Level"+e,c[1])}}function calculateBin(f,e){var l=new String(Math.floor(f/e));l=l.substr(0,1)*Math.pow(10,l.length-1);l=Math.floor(l/2);5>l&&(l=0);return l}function key(f){return"undefined"!==typeof f?f.getAttribute("ID"):"unknown"}
function keyName(f){return"undefined"!==typeof f?f.getAttribute("name"):"unknown"}function keyStart(f){return"undefined"!==typeof f?f.getAttribute("start"):"unknown"}function keyTissue(f,e){return"undefined"!==typeof f?f.getAttribute("ID")+e:"unknown"}function keyPos(f){return"undefined"!==typeof f?f.pos:"unknown"}function keyID(f){return"undefined"!==typeof f?f.id:"unknown"}function keySNP(f){return"undefined"!==typeof f?f.getAttribute("strain")+"_"+f.getAttribute("start"):"unknown"}
function GenomeSVG(f,e,l,n,c,b,a,g){var d={isToolTip:0,folderName:"",selectedTrackSetting:"",trackListHash:{},overSettings:0,zoomFactor:.05};d.strainSpecificCountColors=d3.scaleOrdinal(d3.schemeCategory20);0==c&&(d.folderName=regionfolderName);var p={};p.chr=chr;p.start=l;p.stop=n;d.allowSelectGenomeVer="undefined"===typeof g?!0:g;if(20>c)try{history[c].push(p)}catch(m){Rollbar.error("history["+c+"] not defined")}d.get=function(a){return d[a]};d.getTrackData=function(a){for(var b=[],c=0;c<d.trackList.length;c++)"undefined"!==
typeof d.trackList[c]&&d.trackList[c].trackClass==a&&(b=d.trackList[c].data);return b};d.getTrack=function(a){return d.trackListHash[a]};d.addTrackErrorRemove=function(a,b){if("undefined"!==typeof a){var c=b.substr(7);a.select(".infoIcon").style("opacity",0);a.select(".settings").style("opacity",0);a.append("g").attr("class","removeErrorTrack").attr("id","remove"+c+d.levelNumber).attr("transform","translate("+(d.width-40)+",0)").append("image").attr("width","16px").attr("height","16px").attr("xlink:href",
"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAARBJREFUeNpi/P//PwMlgBHZgNNajGCO6bX/jNgUY5UHGQDCpzSB1Jn/YAxmQ8UJyaNKNitAMJoifPJMIFecvA4ktitCnPT7DwPDJlkG08X/wU4GYRAbJAaWY4CoBetBDoMpjIz/c4rlIKI/v0HohNcQeoEohGbngqjtfcSQ8x8SDiiBCDYkAar41zfUEGSDal7wGq4ZwwC4IT48WKNsypYvKJpBgAVdkbkmkHj3DasBYDk0wIQez+AA+/kPK4YFLNaEBNccC3QhF45kB3IYyBCgGnhiQolnEA3CxhA8mQGCYXwwhqqFpQOwAWBFWDTDEhKGIUjy8KQ6mwG7ZmyGIMtjpAMQjR5V+OQZKc3OAAEGAInHQgT+/r+xAAAAAElFTkSuQmCC").attr("pointer-events",
"all").style("cursor","pointer").on("click",function(a){d3.select(b).remove();ga&&ga("send","event","removeErrorTrack",b)}).on("mouseover",function(){d.overSettings=1;$("#mouseHelp").html("");ga&&ga("send","event","mouseHelp",b)}).on("mouseout",function(){d.overSettings=0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");ga&&ga("send","event","hideMouseHelp",b)})}};d.addTrack=function(a,b,c,g){"Trx"==d.forceDrawAsValue&&-1==(new String(c)).indexOf("DrawTrx")&&
(c=","===c.substr(c.length-1)?c+"DrawTrx,":c+",DrawTrx,");var p=new String(d.folderName);if(0>p.indexOf(chr)||0>p.indexOf(d.xScale.domain()[0]+"_")||0>p.indexOf("_"+d.xScale.domain()[1]))d.folderName="/"+chr+"/"+d.xScale.domain()[0]+"_"+d.xScale.domain()[1],0==d.levelNumber&&regionfolderName!=d.folderName&&(regionfolderName=d.folderName),$.ajax({url:pathPrefix+"getFullPath.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:d.xScale.domain()[0],maxCoord:d.xScale.domain()[1],panel:panel,
rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer},dataType:"json",success:function(a){},error:function(a,b,d){console.log(d)}});p=null;p=d3.select("#Level"+d.levelNumber+a).nodes();if(0===p.length||null==p){p=d.topLevel.append("li").attr("class","draggable"+d.levelNumber).attr("id","li"+a).style("margin-bottom","-3px").append("svg").attr("width",d.width).attr("height",30).attr("class","track").attr("id","Level"+d.levelNumber+a).style("cursor","move").on("mouseover",
function(){0===overSelectable&&("dragzoom"===d.defaultMouseFunct?$("#mouseHelp").html("<B>Zoom:</B> Click and drag to select a region to zoom in. <B>Navigate or Reorder Tracks:</B> Select the appropriate function at the top left of the image."):"pan"===d.defaultMouseFunct?$("#mouseHelp").html("<B>Navigate:</B> Move along Genome by clicking and dragging in desired direction. <B>Zoom or Reorder Tracks:</B> Select the appropriate function at the top left of the image."):"reorder"===d.defaultMouseFunct&&
$("#mouseHelp").html("<B>Reorder Tracks:</B> Click on the track and drag up or down to desired location. <B>Zoom or Navigate:</B> Select the appropriate function at the top left of the image."));ga&&ga("send","event","mouseOverTrack","")}).on("mouseout",function(){0===overSelectable&&$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mousemove",function(){d3.event.shiftKey?d.changeTrackCursor("ns-resize"):d3.event.altKey&&"dragzoom"!==d.defaultMouseFunct?
d.changeTrackCursor("crosshair"):d3.event.altKey&&"dragzoom"===d.defaultMouseFunct?d.changeTrackCursor("move"):d3.event.altKey||"dragzoom"!==d.defaultMouseFunct?d3.event.altKey||"dragzoom"===d.defaultMouseFunct||d.changeTrackCursor("move"):d.changeTrackCursor("crosshair")});var m=new String("Loading...");p.append("text").text(m).attr("x",d.width/2-m.length/2*7.5).attr("y",12).attr("id","trkLbl");m=p.append("g").attr("class","infoIcon").attr("transform","translate("+(d.width-20)+",0)").style("cursor",
"pointer").attr("track",a).attr("title",a).on("mouseover",function(){var b=$(this).attr("track"),d=trackInfo[b];b=$(this).tooltipster({position:"top-right",maxWidth:250,offsetX:24,offsetY:5,contentAsHTML:!0,interactive:!0,interactiveTolerance:350});b.tooltipster("content",function(){var a="";"undefined"!==typeof d&&"undefined"!==typeof d.Description&&(a=d.Description);return a});b.tooltipster("show");ga&&ga("send","event","trackInfo",a)}).on("mouseout",function(){$(this).tooltipster("hide")});m.append("rect").attr("x",
0).attr("y",0).attr("rx",3).attr("ry",3).attr("height",14).attr("width",14).attr("fill","#A7C5E2").attr("stroke","#7795B2");m.append("text").attr("x",2.5).attr("y",12).attr("style","font-family:monospace;font-weight:bold;").attr("fill","#FFFFFF").text("i");p.append("g").attr("class","settings").attr("id",a+"_"+d.levelNumber).attr("transform","translate("+(d.width-40)+",0)").append("image").attr("width","16px").attr("height","16px").attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAAAJdnBBZwAAABAAAAAQAFzGrcMAAAGASURBVCjPlZGxaxNhAMV/9128JF/uLsndaVoPhEopFW2RGAXpKOpQHNwEHXTVf0Chm6OL4OhccFHoYKGFQgMOLoIUEQfBSZCUBtI2yaVt8hwarI6+5cF7v+HBg/+RH1U3q2/+zdxjK0znO0EhWgru20t2J/fZnXInjrYBHAD/ut30OkW3FBURfXrtLDroduf2f4ABaARlLzkdRwFFLCFxFBMdPezDGLj5PT/yMChLNqLm6MDFI2eSvT9Dzj2/qLqu7q4+0mXVlx83BnVdUPrC9wEor6Sa0awW38oCKLy1NqsZpap8AgP5BTgk41fP6QE4u60s4xCwCQArDxofUk2q1i5NAJSmantnlWphvXkXABXf3U6GsSrytwsvC6+CTlWxat2v1+SNR96ZLA9ChSrJyspXqFDlwfkUIAfwcbrvGRwEwAgzEjLDlJ9joPXl6VK639h5cm9rEebfv14emOaZZ9+ck0uUKJTXnretfHvrik7JU+W4+QsCOdzAsOEMT7LfaTGJVMIWBCwAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTAtMDItMTFUMDA6NTM6MDItMDY6MDDZzrlFAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDA5LTA4LTE4VDAyOjI2OjEwLTA1OjAw2ytpkgAAAABJRU5ErkJggg==").attr("pointer-events",
"all").style("cursor","pointer").on("click",function(b){a!=d.selectedTrackSetting?(d.getTrack(a).generateSettingsDiv("div#trackSettingContent"),d.selectedTrackSetting=a,b=$(this).position(),$("#trackSettingDialog").css("top",b.top).css("left",$(window).width()-380),$("#trackSettingDialog").fadeIn("fast")):(d.selectedTrackSetting="",$("#trackSettingDialog").fadeOut("fast"));ga&&ga("send","event","trackSettings","click");return!1}).on("mouseover",function(){d.overSettings=1;$("#mouseHelp").html("Track Settings: Click to access track settings or quickly remove the track from the current view.")}).on("mouseout",
function(){d.overSettings=0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")})}if("genomeSeq"==a)p=SequenceTrack(d,a,"Reference Genomic Sequence",c),d.addTrackList(p);else if(-1<a.indexOf("noncoding"))d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+d.folderName+"/"+a+".xml",function(p,m){if(p)if(60>g){var h=1500;1==g&&(h=2500);setTimeout(function(){d.addTrack(a,b,c,g+1)},h)}else d3.select("#Level"+d.levelNumber+a).select("#trkLbl").text("An errror occurred loading Track:"+
a),d3.select("#Level"+d.levelNumber+a).attr("height",15),d.addTrackErrorRemove(d3.select("#Level"+d.levelNumber+a),"#Level"+d.levelNumber+a);else if(null==m)if(11<=g){h=[];var r=GeneTrack(d,h,a,"Long Non-Coding / Non-PolyA+ Genes",c);d.addTrackList(r)}else setTimeout(function(){d.addTrack(a,b,c,10)},5E3);else{h=m.documentElement.getElementsByTagName("Gene");var e=0,q=m.documentElement.getElementsByTagName("GeneList");0<q.length&&"undefined"!==typeof q[0].getAttribute("ver")&&(e=q[0].getAttribute("ver"));
try{r=GeneTrack(d,h,a,"Long Non-Coding / Non-PolyA+ Genes",c),r.dataVer=e,d.addTrackList(r)}catch(G){}}});else if(-1<a.indexOf("coding"))d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+d.folderName+"/"+a+".xml",function(p,m){if(p)if(60>g){var h=1500;1==g&&(h=2500);setTimeout(function(){d.addTrack(a,b,c,g+1)},h)}else d3.select("#Level"+d.levelNumber+a).select("#trkLbl").text("An errror occurred loading Track:"+a),d3.select("#Level"+d.levelNumber+a).attr("height",15),d.addTrackErrorRemove(d3.select("#Level"+
d.levelNumber+a),"#Level"+d.levelNumber+a);else if(null==m)if(11<=g){h=[];var r=GeneTrack(d,h,a,"Protein Coding / PolyA+",c);d.addTrackList(r)}else setTimeout(function(){d.addTrack(a,b,c,11)},5E3);else{h=m.documentElement.getElementsByTagName("Gene");var e=0,q=m.documentElement.getElementsByTagName("GeneList");0<q.length&&"undefined"!==typeof q[0].getAttribute("ver")&&(e=q[0].getAttribute("ver"));try{r=GeneTrack(d,h,a,"Protein Coding / PolyA+",c),r.dataVer=e,d.addTrackList(r)}catch(G){console.log(G)}}});
else if(-1<a.indexOf("smallnc"))d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+d.folderName+"/"+a+".xml",function(p,m){if(p){if(0===g){var h=d.xScale.domain()[0],r=d.xScale.domain()[1],e="/"+pathPrefix;pathPrefix||(e="");$.ajax({url:e+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:h,maxCoord:r,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:a,folder:d.folderName},dataType:"json",success:function(a){ga&&
ga("send","event","browser","generateTrackRefseq")},error:function(a,b,d){}})}60>g?(h=1500,1==g&&(h=2500),setTimeout(function(){d.addTrack(a,b,c,g+1)},h)):(d3.select("#Level"+d.levelNumber+a).select("#trkLbl").text("An errror occurred loading Track:"+a),d3.select("#Level"+d.levelNumber+a).attr("height",15),d.addTrackErrorRemove(d3.select("#Level"+d.levelNumber+a),"#Level"+d.levelNumber+a))}else if(null==m)11<=g?(h=[],r=GeneTrack(d,h,a,"Small RNA (<200 bp) Genes",c),d.addTrackList(r)):setTimeout(function(){d.addTrack(a,
b,c,11)},5E3);else{h="rn5"===genomeVer?m.documentElement.getElementsByTagName("smnc"):m.documentElement.getElementsByTagName("Gene");try{r=GeneTrack(d,h,a,"Small RNA (<200 bp) Genes",c),d.addTrackList(r),""!=selectGene&&r.setSelected(selectGene)}catch(H){}}});else if(0===a.indexOf("liverTotal")||"heartTotal"===a||0===a.indexOf("brainTotal")||"mergedTotal"===a){var h="Liver Reconstructed";"heartTotal"===a?h="Heart Reconstructed":"brainTotal"===a?h="Whole Brain Reconstructed":"mergedTotal"===a&&(h=
"Merged (Brain,Heart,Liver) Reconstructed");(0===a.indexOf("liverTotal")||0===a.indexOf("brainTotal"))&&0<a.indexOf("_")&&(p=a.substr(a.indexOf("_")+1),"LEStm"===p&&(p="LE-Stm"),"F344Stm"===p&&(p="F344-Stm"),h=p+" "+h);d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+d.folderName+"/"+a+".xml",function(p,m){if(p){if(1===g&&("mergedTotal"===a||0===a.indexOf("liverTotal")||0===a.indexOf("brainTotal"))){var r=d.xScale.domain()[0],e=d.xScale.domain()[1],q="/"+pathPrefix;pathPrefix||(q=
"");var f=panel;(0===a.indexOf("liverTotal")||0===a.indexOf("brainTotal"))&&0<a.indexOf("_")&&(f=a.substr(a.indexOf("_")+1),"LEStm"===f&&(f="LE-Stm"),"F344Stm"===f&&(f="F344-Stm"));$.ajax({url:q+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:r,maxCoord:e,panel:f,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:a,folder:d.folderName},dataType:"json",success:function(a){ga&&ga("send","event","browser","generateTrackRefseq")},
error:function(a,b,d){}})}60>g?(r=1500,1==g&&(r=2500),setTimeout(function(){d.addTrack(a,b,c,g+1)},r)):(d3.select("#Level"+d.levelNumber+a).select("#trkLbl").text("An errror occurred loading Track:"+a),d3.select("#Level"+d.levelNumber+a).attr("height",15),d.addTrackErrorRemove(d3.select("#Level"+d.levelNumber+a),"#Level"+d.levelNumber+a))}else if(null==m)11<=g?(r=[],e=GeneTrack(d,r,a,h,c),d.addTrackList(e)):setTimeout(function(){d.addTrack(a,b,c,11)},5E3);else{r=m.documentElement.getElementsByTagName("Gene");
q=0;f=m.documentElement.getElementsByTagName("GeneList");0<f.length&&"undefined"!==typeof f[0].getAttribute("ver")&&(q=f[0].getAttribute("ver"));try{e=GeneTrack(d,r,a,h,c),e.dataVer=q,d.addTrackList(e),""!=selectGene&&e.setSelected(selectGene)}catch(G){}}})}else if(0===a.indexOf("refSeq")){$("#"+a+d.levelNumber+"Select").val();var r=d.xScale.domain()[0],e=d.xScale.domain()[1];p=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+d.folderName+"/"+a+".xml";d3.xml(p,function(p,m){if(p){console.log(p);
if(0===g){var h="/"+pathPrefix;pathPrefix||(h="");$.ajax({url:h+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:r,maxCoord:e,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:a,folder:d.folderName},dataType:"json",success:function(a){ga&&ga("send","event","browser","generateTrackRefseq")},error:function(a,b,d){}})}60>g?(h=1500,1===g&&(h=2500),setTimeout(function(){d.addTrack(a,b,c,g+1)},h)):(d3.select("#Level"+
d.levelNumber+a).select("#trkLbl").text("An errror occurred loading Track:"+a),d3.select("#Level"+d.levelNumber+a).attr("height",15),d.addTrackErrorRemove(d3.select("#Level"+d.levelNumber+a),"#Level"+d.levelNumber+a))}else if(null==m)if(11<=g){h=[];var q=RefSeqTrack(d,h,a,"Ref Seq Genes",c);d.addTrackList(q)}else setTimeout(function(){d.addTrack(a,b,c,11)},5E3);else{h=m.documentElement.getElementsByTagName("Gene");try{q=RefSeqTrack(d,h,a,"Ref Seq Genes",c),d.addTrackList(q)}catch(A){console.log(A)}}})}else if(0==
a.indexOf("snp"))r=d.xScale.domain()[0],e=d.xScale.domain()[1],p=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+d.folderName+"/"+a+".xml",d3.xml(p,function(p,m){if(p){console.log(p);if(0==g){var h="/"+pathPrefix;pathPrefix||(h="");$.ajax({url:h+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:r,maxCoord:e,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:a,folder:d.folderName},dataType:"json",success:function(a){ga&&
ga("send","event","browser","generateTrackSNP")},error:function(a,b,d){}})}60>g?(h=1500,1===g&&(h=2500),setTimeout(function(){d.addTrack(a,b,c,g+1)},h)):(d3.select("#Level"+d.levelNumber+a).select("#trkLbl").text("An errror occurred loading Track:"+a),d3.select("#Level"+d.levelNumber+a).attr("height",15),d.addTrackErrorRemove(d3.select("#Level"+d.levelNumber+a),"#Level"+d.levelNumber+a))}else if(null==m)if(11<=g){h=[];var q=SNPTrack(d,h,a,b,c);d.addTrackList(q)}else setTimeout(function(){d.addTrack(a,
b,c,11)},5E3);else{h=m.documentElement.getElementsByTagName("Snp");try{q=SNPTrack(d,h,a,b,c),d.addTrackList(q)}catch(A){}}});else if("qtl"===a)d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+d.folderName+"/qtl.xml",function(p,m){if(p)if(60>g){var h=1500;1===g&&(h=2500);setTimeout(function(){d.addTrack(a,b,c,g+1)},h)}else d3.select("#Level"+d.levelNumber+a).select("#trkLbl").text("An errror occurred loading Track:"+a),d3.select("#Level"+d.levelNumber+a).attr("height",15),d.addTrackErrorRemove(d3.select("#Level"+
d.levelNumber+a),"#Level"+d.levelNumber+a);else if(null==m)if(11<=g){h=[];var r=QTLTrack(d,h,a,b);d.addTrackList(r)}else setTimeout(function(){d.addTrack(a,b,c,11)},5E3);else{h=m.documentElement.getElementsByTagName("QTL");try{r=QTLTrack(d,h,a,b),d.addTrackList(r)}catch(A){}}});else if("trx"===a)p=getAllChildrenByName(getFirstChildByName(d.selectedData,"TranscriptList"),"Transcript"),p=TranscriptTrack(d,p,a,b),d.addTrackList(p);else if("probe"===a||"probeMouse"==a)d3.xml(dataPrefix+"tmpData/browserCache/"+
genomeVer+"/regionData/"+d.folderName+"/probe.xml",function(p,m){if(p)if(60>g){var h=1500;1===g&&(h=2500);setTimeout(function(){d.addTrack(a,b,c,g+1)},h)}else d3.select("#Level"+d.levelNumber+a).select("#trkLbl").text("An errror occurred loading Track:"+a),d3.select("#Level"+d.levelNumber+a).attr("height",15),d.addTrackErrorRemove(d3.select("#Level"+d.levelNumber+a),"#Level"+d.levelNumber+a);else if(null==m)11<=g?(r=[],h=ProbeTrack(d,r,a,"Affy Exon 1.0 ST Probe Sets",b+","+c),d.addTrackList(h)):setTimeout(function(){d.addTrack(a,
b,c,11)},5E3);else{var r=m.documentElement.getElementsByTagName("probe");try{h=ProbeTrack(d,r,a,"Affy Exon 1.0 ST Probe Sets",b+","+c),d.addTrackList(h)}catch(A){}}});else if("helicos"===a||-1<a.indexOf("illuminaTotal")||-1<a.indexOf("illuminaSmall")||"illuminaPolyA"===a){r=d.xScale.domain()[0];e=d.xScale.domain()[1];var q=calculateBin(e-r,d.width);p=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+d.folderName+"/tmp/"+r+"_"+e+".count."+a+".xml";0<q&&(r-=r%q,e+=q-e%q,p=dataPrefix+"tmpData/browserCache/"+
genomeVer+"/regionData/"+d.folderName+"/tmp/"+r+"_"+e+".bincount."+q+"."+a+".xml");d3.xml(p,function(p,m){if(p){if(0===g||3===g){var h="/"+pathPrefix;pathPrefix||(h="");tmpPanel=panel;-1<a.indexOf("-")&&(tmpPanel=a.substr(a.indexOf("-")+1));$.ajax({url:h+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:r,maxCoord:e,panel:tmpPanel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:a,folder:d.folderName,binSize:q},dataType:"json",
success:function(a){ga&&ga("send","event","browser","generateTrackCounts")},error:function(a,b,d){}});h=1E4}60>g?(h=1E3,0===g&&(h=2500),setTimeout(function(){d.addTrack(a,b,c,g+1)},h)):(d3.select("#Level"+d.levelNumber+a).select("#trkLbl").text("An errror occurred loading Track:"+a),d3.select("#Level"+d.levelNumber+a).attr("height",15),d.addTrackErrorRemove(d3.select("#Level"+d.levelNumber+a),"#Level"+d.levelNumber+a))}else if(null==m)4<=g?(h=[],"helicos"==a?f=HelicosTrack(d,h,a,b):"illuminaTotal"==
a?f=IlluminaTotalTrack(d,h,a,b):"illuminaSmall"==a?f=IlluminaSmallTrack(d,h,a,b):"illuminaPolyA"==a?f=IlluminaPolyATrack(d,h,a,b):"liverilluminaTotalPlus"==a?f=LiverIlluminaTotalPlusTrack(d,h,a,b):"liverilluminaTotalMinus"==a?f=LiverIlluminaTotalMinusTrack(d,h,a,b):"heartilluminaTotalPlus"==a?f=HeartIlluminaTotalPlusTrack(d,h,a,b):"heartilluminaTotalMinus"==a?f=HeartIlluminaTotalMinusTrack(d,h,a,b):"brainilluminaTotalPlus"==a?f=BrainIlluminaTotalPlusTrack(d,h,a,b):"brainilluminaTotalMinus"==a?f=BrainIlluminaTotalMinusTrack(d,
h,a,b):"liverilluminaSmall"==a?f=LiverIlluminaSmallTrack(d,h,a,b):"heartilluminaSmall"==a?f=HeartIlluminaSmallTrack(d,h,a,b):-1<a.indexOf("illuminaTotal")&&(f=StrainSpecificIlluminaTotalTrack(d,h,a,b)),d.addTrackList(f)):setTimeout(function(){d.addTrack(a,b,c,4)},3E3);else{h=m.documentElement.getElementsByTagName("Count");var f;try{"helicos"===a?f=HelicosTrack(d,h,a,b):"illuminaTotal"===a?f=IlluminaTotalTrack(d,h,a,b):"illuminaSmall"===a?f=IlluminaSmallTrack(d,h,a,b):"illuminaPolyA"===a?f=IlluminaPolyATrack(d,
h,a,b):"liverilluminaTotalPlus"===a?f=LiverIlluminaTotalPlusTrack(d,h,a,b):"liverilluminaTotalMinus"===a?f=LiverIlluminaTotalMinusTrack(d,h,a,b):"heartilluminaTotalPlus"===a?f=HeartIlluminaTotalPlusTrack(d,h,a,b):"heartilluminaTotalMinus"===a?f=HeartIlluminaTotalMinusTrack(d,h,a,b):"brainilluminaTotalPlus"===a?f=BrainIlluminaTotalPlusTrack(d,h,a,b):"brainilluminaTotalMinus"===a?f=BrainIlluminaTotalMinusTrack(d,h,a,b):"liverilluminaSmall"===a?f=LiverIlluminaSmallTrack(d,h,a,b):"heartilluminaSmall"===
a?f=HeartIlluminaSmallTrack(d,h,a,b):-1<a.indexOf("illuminaTotal")&&(f=StrainSpecificIlluminaTotalTrack(d,h,a,b)),d.addTrackList(f)}catch(A){}}})}else if(-1<a.indexOf("spliceJnct")){r=d.xScale.domain()[0];e=d.xScale.domain()[1];p=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+d.folderName+"/"+a+".xml";var f="Brain ";"liverspliceJnct"==a?f="Liver ":"heartspliceJnct"==a&&(f="Heart ");d3.xml(p,function(p,h){if(p){console.log(p);if(0==g){var m="/"+pathPrefix;pathPrefix||(m="");$.ajax({url:m+
"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:r,maxCoord:e,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:a,folder:d.folderName},dataType:"json",success:function(a){ga&&ga("send","event","browser","generateTrackSpliceJnct")},error:function(a,b,d){}})}60>g?(m=1500,1===g&&(m=2500),setTimeout(function(){d.addTrack(a,b,c,g+1)},m)):(d3.select("#Level"+d.levelNumber+a).select("#trkLbl").text("An errror occurred loading Track:"+
a),d3.select("#Level"+d.levelNumber+a).attr("height",15),d.addTrackErrorRemove(d3.select("#Level"+d.levelNumber+a),"#Level"+d.levelNumber+a))}else if(null==h)if(11<=g){m=[];var q=SpliceJunctionTrack(d,m,a,f+"Splice Junctions",1,"");d.addTrackList(q)}else setTimeout(function(){d.addTrack(a,b,c,11)},5E3);else{m=h.documentElement.getElementsByTagName("Feature");console.log(m);try{q=SpliceJunctionTrack(d,m,a,f+"Splice Junctions",3,""),d.addTrackList(q)}catch(A){console.log(A)}}})}else if("polyASite"==
a)d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+d.folderName+"/polyASite.xml",function(p,h){if(p)if(60>g){var m=1E3;1===g&&(m=2500);setTimeout(function(){d.addTrack(a,b,c,g+1)},m)}else d3.select("#Level"+d.levelNumber+a).select("#trkLbl").text("An errror occurred loading Track:"+a),d3.select("#Level"+d.levelNumber+a).attr("height",15),d.addTrackErrorRemove(d3.select("#Level"+d.levelNumber+a),"#Level"+d.levelNumber+a);else if(null==h)if(4<=g){m=[];var r=PolyATrack(d,m,a,"Predicted PolyA Sites",
c);d.addTrackList(r)}else setTimeout(function(){d.addTrack(a,b,c,4)},5E3);else{m=h.documentElement.getElementsByTagName("Feature");try{r=PolyATrack(d,m,a,"Predicted PolyA Sites",c),d.addTrackList(r)}catch(A){}}});else if(0===a.indexOf("repeatMask"))$("#"+a+d.levelNumber+"Select").val(),r=d.xScale.domain()[0],e=d.xScale.domain()[1],p=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+d.folderName+"/"+a+".xml",d3.xml(p,function(p,h){if(p){console.log(p);if(0===g){var m="/"+pathPrefix;pathPrefix||
(m="");$.ajax({url:m+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:r,maxCoord:e,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:a,folder:d.folderName},dataType:"json",success:function(a){ga&&ga("send","event","browser","generateTrackRepeatMask")},error:function(a,b,d){}})}60>g?(m=1500,1===g&&(m=2500),setTimeout(function(){d.addTrack(a,b,c,g+1)},m)):(d3.select("#Level"+d.levelNumber+a).select("#trkLbl").text("An errror occurred loading Track:"+
a),d3.select("#Level"+d.levelNumber+a).attr("height",15),d.addTrackErrorRemove(d3.select("#Level"+d.levelNumber+a),"#Level"+d.levelNumber+a))}else if(null==h)if(11<=g){m=[];var q=RepeatMaskTrack(d,m,a,"Repeat Masker",b,c);d.addTrackList(q)}else setTimeout(function(){d.addTrack(a,b,c,11)},5E3);else{m=h.documentElement.getElementsByTagName("Feature");try{q=RepeatMaskTrack(d,m,a,"Repeat Masker",b,c),d.addTrackList(q)}catch(A){console.log(A)}}});else if(0==a.indexOf("custom"))if(p=trackInfo[a],c=c+",Name="+
p.Name,c="DataFile="+p.Location+","+c,"bed"==p.Type||"bb"==p.Type)m=[],p=CustomTranscriptTrack(d,m,a,p.Name,3,c),d.addTrackList(p),p.updateFullData(0,0);else if("bg"==p.Type||"bw"==p.Type)m=[],p=CustomCountTrack(d,m,a,3,c),d.addTrackList(p);$(".sortable"+d.levelNumber).sortable("refresh");ga&&ga("send","event","trackAdded",a)};d.addTrackList=function(a){null!=a&&(d.trackList[d.trackCount]=a,d.trackCount++,d.trackListHash[a.trackClass]=a,setTimeout(function(){DisplayRegionReport()},300))};d.updateLinks=
function(){1===d.levelNumber&&d3.select("#probeSetDetailLink1").each(function(){var a=new String(d3.select(this).attr("href"));a=a.substr(0,a.lastIndexOf("=")+1);a+=d.currentView.ViewID;d3.select(this).attr("href",a)})};d.changeTrackHeight=function(a,b){0<b?d3.select("#"+a+"Scroll").style("max-height",b+"px").style("overflow","auto"):d3.select("#"+a+"Scroll").style("max-height","none").style("overflow","hidden")};d.removeAllTracks=function(){d3.selectAll("li.draggable"+d.levelNumber).remove();d.trackList=
[];setTimeout(function(){DisplayRegionReport()},300);ga&&ga("send","event","SVGremoveAllTracks",d.levelNumber)};d.removeTrack=function(a){d3.select("#Level"+d.levelNumber+a).remove();for(var b=0;b<d.trackList.length;b++)"undefined"!==typeof d.trackList[b]&&d.trackList[b].trackClass==a&&(d.trackList.splice(b,1),d.trackCount--);d.trackListHash[a]=void 0;setTimeout(function(){DisplayRegionReport()},300);ga&&ga("send","event","removeTrack",d.levelNumber,a)};d.redrawTrack=function(a){for(var b=0;b<d.trackList.length;b++)"undefined"!==
typeof d.trackList[b]&&d.trackList[b].trackClass==a&&d.trackList[b].redraw();setTimeout(function(){DisplayRegionReport()},300)};d.redraw=function(){for(var a=0;a<d.trackList.length;a++)"undefined"!==typeof d.trackList[a]&&"undefined"!==typeof d.trackList[a].redraw&&d.trackList[a].redraw();d.selectSvg.redraw()};d.update=function(){for(var a=0;a<d.trackList.length;a++)"undefined"!==typeof d.trackList[a].update&&d.trackList[a].update();setTimeout(function(){DisplayRegionReport()},300);ga&&ga("send",
"event","gsvgUpdate","genomeSVG.update")};d.updateData=function(){for(var a=0;a<d.trackList.length;a++)"undefined"!==typeof d.trackList[a]&&"undefined"!==typeof d.trackList[a].updateData&&d.trackList[a].updateData(0);d.updateFullData();setTimeout(function(){DisplayRegionReport()},300);ga&&ga("send","event","gsvgUpdateData","genomeSVG.updateData")};d.updateFullData=function(){-1<(new String(d.folderName)).indexOf("img")&&(d.folderName="/"+chr+"/"+d.xScale.domain()[0]+"_"+d.xScale.domain()[1],0==d.levelNumber&&
regionfolderName!=d.folderName&&(regionfolderName=d.folderName),setTimeout(function(){DisplayRegionReport()},300));for(var a=0;a<d.trackList.length;a++)"undefined"!==typeof d.trackList[a]&&"undefined"!==typeof d.trackList[a].updateFullData&&d.trackList[a].updateFullData(0,1);ga&&ga("send","event","gsvgUpdateFullData","genomeSVG.updateFullData")};d.setLoading=function(){for(var a=0;a<d.trackList.length;a++)"undefined"===typeof d.trackList[a]||"undefined"===typeof d.trackList[a].updateData&&"undefined"===
typeof d.trackList[a].updateFullData||d.trackList[a].showLoading()};d.clearSelection=function(){d.selectionStart=-1;d.selectionEnd=-1;d.scaleSVG.selectAll("rect.selectedArea").remove();d.selectSvg.setVis(!1);for(var a=0;a<d.trackList.length;a++)"undefined"!==typeof d.trackList[a]&&"undefined"!==typeof d.trackList[a].clearSelection&&d.trackList[a].clearSelection()};d.mdown=function(){if(0==d.overSettings)if("dragzoom"!==d.defaultMouseFunct&&d3.event.altKey||"dragzoom"===d.defaultMouseFunct&&!d3.event.altKey){var a=
d3.mouse(d.vis.node());d.downZoomx=a[0];d.scaleSVG.append("rect").attr("class","zoomRect").attr("x",a[0]).attr("y",0).attr("height",d.scaleSVG.attr("height")).attr("width",1).attr("fill","#CECECE").attr("opacity",.3);d.scaleSVG.append("text").attr("id","zoomTextStart").attr("x",d.downZoomx).attr("y",15).text(numberWithCommas(Math.round(d.xScale.invert(d.downZoomx))));d.scaleSVG.append("text").attr("id","zoomTextEnd").attr("x",d.downZoomx).attr("y",50).text(numberWithCommas(Math.round(d.xScale.invert(d.downZoomx))))}else 0==
processAjax&&(d.prevMinCoord=d.xScale.domain()[0],d.prevMaxCoord=d.xScale.domain()[1],a=d3.mouse(d.vis.node()),d.downx=d.xScale.invert(a[0]),d.downscalex=d.xScale)};d.forceDrawAs=function(a){for(var b=0;b<d.trackList.length;b++)"undefined"!==typeof d.trackList[b]&&"undefined"!==typeof d.trackList[b].drawAs&&(d.trackList[b].drawAs=a,d.trackList[b].draw(d.trackList[b].data));d.forceDrawAsValue=a};d.resize=function(a){d.width=a;d.xScale.range([0,d.width]);d.xAxis=d3.axisTop(d.xScale).ticks(6).tickSize(8).tickPadding(10);
d.scaleSVG.attr("width",d.width);d.scaleSVG.select(".x.axis").call(d.xAxis);d3.select("#Level"+d.levelNumber).select(".axisLbl").attr("x",(d.width-2*d.margin)/2);d.topLevel.style("width",d.width+18+"px");for(var b=0;b<d.trackList.length;b++)"undefined"!==typeof d.trackList[b]&&"undefined"!==typeof d.trackList[b].redraw&&d.trackList[b].resize();d.selectSvg.width=a;d.selectSvg.draw()};d.updateCountScales=function(a,b){for(var c=0;c<d.trackList.length;c++)"undefined"!==typeof d.trackList[c]&&"undefined"!==
typeof d.trackList[c].updateCountScale&&d.trackList[c].updateCountScale(a,b)};d.resetDefaultMouse=function(a){var b="/web/images/icons/"+a+"_dark.png";d3.select("span#"+a+d.levelNumber+" img").attr("src",b);d3.select("span#"+a+d.levelNumber).style("background","#DCDCDC")};d.changeTrackCursor=function(a){for(var b=0;b<d.trackList.length;b++)"undefined"!==typeof d.trackList[b]&&"undefined"!==typeof d.trackList[b].svg&&d.trackList[b].svg.style("cursor",a)};d.changeScaleCursor=function(a){"undefined"!==
typeof d.scaleSVG&&d.scaleSVG.style("cursor",a)};d.updateTrackSelectedArea=function(a,b){d.selectionStart=a;d.selectionEnd=b;var c=d.xScale(a),g=d.xScale(b)-c;d.scaleSVG.selectAll("rect.selectedArea").remove();if((0<c||0<c+g)&&c<d.width)for(1>g&&(g=1),d.scaleSVG.append("rect").attr("class","selectedArea").attr("x",c).attr("y",15).attr("height",d.scaleSVG.attr("height")-15).attr("width",g).attr("fill","#CECECE").attr("opacity",.3).attr("pointer-events","none"),c=0;c<d.trackList.length;c++)"undefined"!==
typeof d.trackList[c]&&"undefined"!==typeof d.trackList[c].setSelectedArea&&d.trackList[c].setSelectedArea(a,b)};d.getAddMenus=function(){var a="/"+pathPrefix;""==pathPrefix&&(a="");$.ajax({url:a+"trackMenu.jsp",type:"GET",cache:!1,data:{level:d.levelNumber,organism:organism},dataType:"html",success:function(a){$("#trackMenu"+d.levelNumber).remove();d3.select("div#trackMenu").append("div").attr("id","trackMenu"+d.levelNumber);$("#trackMenu"+d.levelNumber).html(a)},error:function(a,b,c){$("#trackMenu"+
d.levelNumber).remove();d3.select("div#trackMenu").append("div").attr("id","trackMenu"+d.levelNumber);$("#trackMenu"+d.levelNumber).append('<div class="viewsLevel'+d.levelNumber+'">An error occurred generating this menu.  Please try back later.</div>')},async:!1});$.ajax({url:a+"viewMenu.jsp",type:"GET",cache:!1,data:{level:d.levelNumber,organism:organism},dataType:"html",success:function(a){$("#viewMenu"+d.levelNumber).remove();d3.select("div#viewMenu").append("div").attr("id","viewMenu"+d.levelNumber);
$("#viewMenu"+d.levelNumber).html(a)},error:function(a,b,c){$("#viewMenu"+d.levelNumber).remove();d3.select("div#viewMenu").append("div").attr("id","viewMenu"+d.levelNumber);$("#viewMenu"+d.levelNumber).append('<div class="viewsLevel'+d.levelNumber+'">An error occurred generating this menu.  Please try back later.</div>')},async:!1})};d.zoomMenuChange=function(a){d3.select("#zoomSelectMenu"+d.levelNumber).selectAll("li").style("background","#FFFFFF");d.zoomFactor=parseFloat(d3.select(a).attr("value"));
d3.select(a).style("background","#CECECE")};d.setupFunctionBar=function(){d3.select(f).select("#functLevel"+d.levelNumber).remove();d.functionBar=d.vis.append("div").attr("class","functionBar").attr("id","functLevel"+d.levelNumber).style("float","left");var a=d.functionBar.append("div").attr("class","defaultMouse").attr("id","defaultMouse"+d.levelNumber);a.append("span").attr("id","dragzoom"+d.levelNumber).style("height","24px").style("display","inline-block").style("cursor","pointer").append("img").attr("class",
"mouseOpt dragzoom").attr("src","/web/images/icons/dragzoom_dark.png").attr("pointer-events","all").on("click",function(){d.resetDefaultMouse(d.defaultMouseFunct);d.defaultMouseFunct="dragzoom";d3.select(this).attr("src","/web/images/icons/dragzoom_white.png");d3.select("span#dragzoom"+d.levelNumber).style("background","#989898");d.changeTrackCursor("crosshair");d.changeScaleCursor("crosshair");ga&&ga("send","event","clickDragZoom","")}).on("mouseout",function(){"dragzoom"!=d.defaultMouseFunct&&(d3.select(this).attr("src",
"/web/images/icons/dragzoom_dark.png"),d3.select("span#dragzoom"+d.levelNumber).style("background","#DCDCDC"))}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/dragzoom_white.png");d3.select("span#dragzoom"+d.levelNumber).style("background","#989898");$("#mouseHelp").html("Click to set default mouse function to allow click and drag to select a region to zoom in on.")});a.append("span").attr("id","pan"+d.levelNumber).style("height","24px").style("display","inline-block").style("cursor",
"pointer").append("img").attr("class","mouseOpt pan").attr("src","/web/images/icons/pan_dark.png").attr("pointer-events","all").on("click",function(){d.resetDefaultMouse(d.defaultMouseFunct);d.defaultMouseFunct="pan";d3.select(this).attr("src","/web/images/icons/pan_white.png");d3.select("span#pan"+d.levelNumber).style("background","#989898");d.changeTrackCursor("move");d.changeScaleCursor("ew-resize");ga&&ga("send","event","clickPan","")}).on("mouseout",function(){"pan"!=d.defaultMouseFunct&&(d3.select(this).attr("src",
"/web/images/icons/pan_dark.png"),d3.select("span#pan"+d.levelNumber).style("background","#DCDCDC"))}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/pan_white.png");d3.select("span#pan"+d.levelNumber).style("background","#989898");$("#mouseHelp").html("Click to set default mouse function to allow click and drag to navigate along the genome.")});a.append("span").attr("id","reorder"+d.levelNumber).style("height","24px").style("display","inline-block").style("cursor","pointer").append("img").attr("class",
"mouseOpt pan").attr("src","/web/images/icons/reorder_dark.png").attr("pointer-events","all").on("click",function(){d.resetDefaultMouse(d.defaultMouseFunct);d.defaultMouseFunct="reorder";d3.select(this).attr("src","/web/images/icons/reorder_white.png");d3.select("span#reorder"+d.levelNumber).style("background","#989898");d.changeTrackCursor("ns-resize");d.changeScaleCursor("ew-resize");ga&&ga("send","event","clickReorder","")}).on("mouseout",function(){"reorder"!=d.defaultMouseFunct&&(d3.select(this).attr("src",
"/web/images/icons/reorder_dark.png"),d3.select("span#reorder"+d.levelNumber).style("background","#DCDCDC"))}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/reorder_white.png");d3.select("span#reorder"+d.levelNumber).style("background","#989898");$("#mouseHelp").html("Click to set default mouse function to reorder image tracks. <strong>Optionally hold down shift in any mode.</strong>")});$("span#"+d.defaultMouseFunct+d.levelNumber+" img").click();d.functionBar.append("span").attr("class",
"saveImage control").style("display","inline-block").attr("id","saveLevel"+d.levelNumber).style("cursor","pointer").append("img").attr("src","/web/images/icons/savePic_dark.png").attr("pointer-events","all").attr("cursor","pointer").on("click",function(){var a=$(this).parent().attr("id"),b=(new String(a)).substr(9);a=$("div#Level"+b).html();$.ajax({url:pathPrefix+"saveBrowserImage.jsp",type:"POST",contentType:"text/html",data:a+"\n",processData:!1,dataType:"json",success:function(a){var d=new Date;
d=d.getMonth()+1+"_"+d.getDate()+"_"+d.getFullYear();var c="http://";"https:"===location.protocol&&(c="https://");var g=c+urlprefix+"/tmpData/download/"+a.imageFile;a=new String($("#geneTxt").val());a=a.replace(/:/g,"_");a=a.replace(/-/g,"_");a=a.replace(/,/g,"");"Level1"==b&&(a=svgList[1].selectedData.getAttribute("geneSymbol"));var p=a+"_"+d+".png",h=new XMLHttpRequest;h.open("GET",g);h.responseType="blob";h.send();h.onreadystatechange=function(){if(4!=h.readyState||200!=h.status)return!1;var a=
document.createElement("a");a.href=window.URL.createObjectURL(h.response);a.download=p;a.style.display="none";document.body.appendChild(a);try{a.click()}catch(E){$("#mouseHelp").html("<span style='color:#FF0000;'>Your browser will not save the image directly. Image will open in a popup, in the new window right click to save image.</span>"),window.open(g)}return!0};ga&&ga("send","event","browser","saveBrowserImage")},error:function(a,b,d){console.log(d)}});ga&&ga("send","event","saveImage","")}).on("mouseover",
function(){d3.select(this).attr("src","/web/images/icons/savePic_white.png");d3.select("span#savePic"+d.levelNumber).style("background","#DCDCDC");$("#mouseHelp").html("Click to download a PNG image of the current view.")}).on("mouseout",function(){d3.select(this).attr("src","/web/images/icons/savePic_dark.png");d3.select("span#savePic"+d.levelNumber).style("background","#989898");$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});d.functionBar.append("span").attr("class",
"reset control").style("display","inline-block").attr("id","resetImage"+d.levelNumber).style("cursor","pointer").append("img").attr("src","/web/images/icons/reset_dark.png").attr("pointer-events","all").attr("cursor","pointer").on("click",function(){var a=new String($(this).parent().attr("id"));a=a.substr(a.length-1);0==a?($("#geneTxt").val(chr+":"+initMin+"-"+initMax),svgList[0].xScale.domain([initMin,initMax]),svgList[0].scaleSVG.select(".x.axis").call(svgList[0].xAxis),svgList[0].redraw()):(svgList[a].xScale.domain([svgList[a].initMin,
svgList[a].initMax]),svgList[a].scaleSVG.select(".x.axis").call(svgList[a].xAxis),svgList[a].redraw());svgList[0].updateFullData();ga&&ga("send","event","clickResetImage","")}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/reset_white.png");d3.select("span#reset"+d.levelNumber).style("background","#DCDCDC");$("#mouseHelp").html("Click to reset image zoom to initial region.")}).on("mouseout",function(){d3.select(this).attr("src","/web/images/icons/reset_dark.png");d3.select("span#reset"+
d.levelNumber).style("background","#989898");$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});d.functionBar.append("span").attr("class","back control").style("display","inline-block").attr("id","backButton"+d.levelNumber).style("cursor","pointer").append("img").attr("src","/web/images/icons/back_dark2.png").attr("pointer-events","all").attr("cursor","pointer").on("click",function(){back(d.levelNumber);ga&&ga("send","event","clickBack","")}).on("mouseover",
function(){d3.select(this).attr("src","/web/images/icons/back_white2.png");$("#mouseHelp").html("Click to undo last zoom/pan.")}).on("mouseout",function(){d3.select(this).attr("src","/web/images/icons/back_dark2.png");$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});a=d.functionBar.append("span").style("display","inline-block").style("position","relative").style("top","-9px").attr("id","zoom"+d.levelNumber);a.append("button").attr("id","zoomInButton"+
d.levelNumber).attr("class","zoomIn").style("height","2.3em").append("img").style("position","relative").style("top","-5px").attr("src","/web/images/icons/magPlus_dark_32.png").attr("pointer-events","all").attr("cursor","pointer");a.append("button").attr("id","zoomOutButton"+d.levelNumber).attr("class","zoomOut").style("height","2.3em").append("img").style("position","relative").style("top","-5px").attr("src","/web/images/icons/magMinus_dark_32.png").attr("pointer-events","all").attr("cursor","pointer");
a.append("button").attr("id","zoomMenuSelect"+d.levelNumber).attr("class","zoomSelectMenu");testChrome?(console.log("CHROME"),d3.select("#zoomSelect"+d.levelNumber).style("height","2.3em")):testSafari&&d3.select("#zoomSelect"+d.levelNumber).style("height","2.3em");a=d.functionBar.append("ul").attr("id","zoomSelectMenu"+d.levelNumber);a.append("li").attr("id","zoom1"+d.levelNumber).attr("value","0.025").on("click",function(){d.zoomMenuChange(this)}).text("0.5x");a.append("li").attr("id","zoom2"+d.levelNumber).attr("value",
"0.05").style("background","#CECECE").on("click",function(){d.zoomMenuChange(this)}).text("1x");a.append("li").attr("id","zoom3"+d.levelNumber).attr("value","0.1").on("click",function(){d.zoomMenuChange(this)}).text("2x");a.append("li").attr("id","zoom4"+d.levelNumber).attr("value","0.25").on("click",function(){d.zoomMenuChange(this)}).text("5x");a.append("li").attr("id","zoom5"+d.levelNumber).attr("value","0.5").on("click",function(){d.zoomMenuChange(this)}).text("10x");$("#zoomInButton"+d.levelNumber).button().click(function(){zoomIn(d.levelNumber,
d.zoomFactor);ga&&ga("send","event","clickZoomIn","")}).on("mouseover",function(){$(this).css("background","#989898");$("img",this).attr("src","/web/images/icons/magPlus_light_32.png");$("#mouseHelp").html("Click to zoom in on the center of the region.  Click and drag the scale to zoom in or out more quickly or select the region select tool to highlight a specific region.")}).on("mouseout",function(){$(this).css("background","#e6e6e6");$("img",this).attr("src","/web/images/icons/magPlus_dark_32.png");
$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).next().button().click(function(){zoomOut(d.levelNumber,d.zoomFactor);ga&&ga("send","event","clickZoomOut","")}).on("mouseover",function(){$(this).css("background","#989898");$("img",this).attr("src","/web/images/icons/magMinus_light_32.png");$("#mouseHelp").html("Click to zoom out from the center of the region.  Click and drag the scale to zoom in or out more quickly or select the region select tool to highlight a specific region.")}).on("mouseout",
function(){$(this).css("background","#e6e6e6");$("img",this).attr("src","/web/images/icons/magMinus_dark_32.png");$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).next().button({text:!1,icons:{primary:"ui-icon-triangle-1-s"}}).click(function(){var a=$(this).parent().next().show().position({my:"left top",at:"left bottom",of:this});$(document).on("click",function(){a.hide()});return!1}).parent().buttonset().next().hide().menu()};d.generateSettingsString=
function(){ret="";$("#ScrollLevel"+d.levelNumber+" li.draggable"+d.levelNumber).each(function(){var a=new String($(this).attr("id"));a=a.substr(2);"undefined"!==typeof d.trackListHash[a]&&(ret+=d.trackListHash[a].generateTrackSettingString())});return ret};d.setCurrentViewModified=function(){d.currentView.modified=1;$("span#viewModifiedCtl"+d.levelNumber).show()};d.clearCurrentView=function(){d.currentView.modified=0;$("span#viewModifiedCtl"+d.levelNumber).hide()};d.type=a;d.div=f;d.margin=0;d.halfWindowWidth=
$(window).width()/2;d.mh=400;d.downx=Math.NaN;d.downscalex;d.downPanx=Math.NaN;d.downZoomx=Math.NaN;d.downZoomxEnd=Math.NaN;d.defaultMouseFunct="pan";d.xMax=29E7;d.xMin=1;d.prevMinCoord=l;d.prevMaxCoord=n;d.initMin=l;d.initMax=n;d.dataMinCoord=l;d.dataMaxCoord=n;d.y=0;d.xScale=null;d.xAxis=null;d.vis=null;d.level=null;d.svg=null;d.txType=null;d.txList=null;d.tt=null;d.trackList=[];d.trackCount=0;d.levelNumber=c;d.selectedData=null;d.txType=null;d.selectionStart=-1;d.selectionEnd=-1;d.scrollSize=350;
d.width=e;d.mw=d.width-d.margin;d3.select(f).select("#viewsLevel"+c).remove();d3.select(f).select("#Level"+c).remove();d.vis=d3.select(f);d.setupFunctionBar();0==$("#viewSelect"+d.levelNumber).length&&(e=d.vis.append("div").style("float","right").style("display","inline-block").style("margin-right","5px"),a=e.append("div"),a.append("button").attr("id","viewSelect"+d.levelNumber).attr("class","viewSelect").text("Select/Edit Views").on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",
function(){$("#mouseHelp").html("Click to select another view or edit the current view.")}),a.append("button").attr("id","viewMenuSelect"+d.levelNumber).attr("class","viewSelectMenu").on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",function(){$("#mouseHelp").html("Click for options to quickly save and delete your current view.")}),testChrome?d3.select("#viewSelect"+d.levelNumber).style("height","2.3em"):
testSafari?d3.select("#viewSelect"+d.levelNumber).style("height","2.3em"):testFireFox||testIE&&d3.select("#viewSelect"+d.levelNumber).style("position","relative").style("top","-8px").style("height","2.3em"),e=e.append("ul").attr("id","viewSelectMenu"+d.levelNumber),e.append("li").attr("id","menusaveView"+d.levelNumber).on("click",function(){viewMenu[d.levelNumber].saveView(d.currentView.ViewID,d,!1);$("#viewModifiedCtl"+d.level).hide();ga&&ga("send","event","menuSaveView","")}).text("Save"),e.append("li").attr("id",
"menusaveAsView"+d.levelNumber).on("click",function(){viewMenu[d.levelNumber].saveAsView(d.currentView,svgList[d.levelNumber]);$(".viewsLevel"+d.levelNumber).css("top",250).css("left",$(window).width()-610);$(".viewsLevel"+d.levelNumber).fadeIn("fast");$("#viewModifiedCtl"+d.level).hide();ga&&ga("send","event","menuSaveAsView","")}).text("Save As"),e.append("li").attr("id","menudeleteView"+d.levelNumber).on("click",function(){viewMenu[d.levelNumber].confirmDeleteView(d.currentView);$(".viewsLevel"+
d.levelNumber).css("top",250).css("left",$(window).width()-610);$(".viewsLevel"+d.levelNumber).fadeIn("fast");ga&&ga("send","event","menuDeleteView","")}).text("Delete"),$("#viewSelect"+d.levelNumber).button().click(function(){}).next().button({text:!1,icons:{primary:"ui-icon-triangle-1-s"}}).click(function(){var a=$(this).parent().next().show().position({my:"left top",at:"left bottom",of:this});$(document).on("click",function(){a.hide()});return!1}).parent().buttonset().next().hide().menu(),d.vis.append("span").style("float",
"right").style("margin-right","5px").append("span").attr("id","mainAddTrack"+d.levelNumber).attr("class","control").style("height","24px").style("display","inline-block").style("cursor","pointer").append("img").attr("class","mainAddTrack").attr("src","/web/images/icons/addTrack_dark_32.png").attr("pointer-events","all").style("height","37px").style("position","relative").style("top","-8px").on("click",function(){if($(".trackLevel"+d.levelNumber).is(":visible"))$(".trackLevel"+d.levelNumber).fadeOut("fast");
else{var a=$(this).parent().parent().position();trackMenu[d.levelNumber].standalone=!0;$(".trackLevel"+d.levelNumber).css("top",a.top).css("left",a.left+-561);$(".trackLevel"+d.levelNumber+" span#selectedViewName").html(d.currentView.Name);$(".trackLevel"+d.levelNumber).fadeIn("fast");$("div#selectTrack"+d.levelNumber).show();$("div#addUsrTrack"+d.levelNumber).hide();$("div#addUsrTrack"+d.levelNumber).hide();$("div#deleteUsrTrack"+d.levelNumber).hide();setTimeout(function(){trackMenu[d.levelNumber].generateTrackTable()},
250);ga&&ga("send","event","clickAddTrack","")}}).on("mouseout",function(){d3.select(this).attr("src","/web/images/icons/addTrack_dark_32.png");d3.select("span#mainAddTrack"+d.levelNumber).style("background","#DCDCDC");$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/addTrack_light_32.png");d3.select("span#mainAddTrack"+d.levelNumber).style("background","#989898");$("#mouseHelp").html("Click to quickly add other tracks to the current view.")}),
e=d.vis.append("span").style("float","right").style("margin-right","5px"),e.append("input").attr("type","checkbox").attr("name","imgCBX").attr("id","forceTrxCBX"+d.levelNumber),e.append("label").attr("for","forceTrxCBX"+d.levelNumber).text("Draw Genes as Transcripts").on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",function(){$("#mouseHelp").html("Click to display Gene Tracks as Transcripts. Note: in smaller regions this occurs automatically.")}),
$("input#forceTrxCBX"+d.levelNumber).button(),e=d.vis.append("span").style("float","right").style("margin-right","5px"),a=e.append("div").attr("class","defaultMouse").style("width","64px").attr("id","scrollSize"+d.levelNumber),a.append("span").attr("id","scrollIncr"+d.levelNumber).style("height","24px").style("display","inline-block").style("cursor","pointer").append("img").attr("class","mouseOpt ").attr("src","/web/images/icons/scroll_smaller.png").attr("pointer-events","all").on("click",function(){d.scrollSize-=
100;100>d.scrollSize&&(d.scrollSize=100);changeTrackHeight("Level"+d.levelNumber,d.scrollSize);ga&&ga("send","event","changeScrollHeight","")}).on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",function(){$("#mouseHelp").html("Decrease the vertical length of the scrollable browser image on the page.")}),a.append("span").attr("id","pan"+d.levelNumber).style("height","24px").style("display","inline-block").style("cursor",
"pointer").append("img").attr("class","mouseOpt pan").attr("src","/web/images/icons/scroll_larger.png").attr("pointer-events","all").on("click",function(){0<$("#ScrollLevel"+d.levelNumber).length&&"undefined"!==typeof $("#ScrollLevel"+d.levelNumber)[0]&&d.scrollSize<$("#ScrollLevel"+d.levelNumber)[0].scrollHeight&&(d.scrollSize+=100,changeTrackHeight("Level"+d.levelNumber,d.scrollSize))}).on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",
function(){$("#mouseHelp").html("Increase the vertical length of the scrollable browser image on the page.")}),e.append("span").attr("class","scrollBtn control").style("display","inline-block").attr("id","scrollImage"+d.levelNumber).style("cursor","pointer").append("img").attr("src","/web/images/icons/scroll.png").attr("pointer-events","all").attr("cursor","pointer").on("click",function(){"/web/images/icons/no_scroll.png"==d3.select(this).attr("src")?(d3.select(this).attr("src","/web/images/icons/scroll.png"),
d3.select("span#reset"+d.levelNumber).style("background","#989898"),$("#scrollSize"+d.levelNumber).show(),changeTrackHeight("Level"+d.levelNumber,d.scrollSize)):(d3.select(this).attr("src","/web/images/icons/no_scroll.png"),d3.select("span#reset"+d.levelNumber).style("background","#DCDCDC"),$("#scrollSize"+d.levelNumber).hide(),changeTrackHeight("Level"+d.levelNumber,0));ga&&ga("send","event","toggleImageScroll","")}).on("mouseover",function(){$("#mouseHelp").html("Click to toggle browser image scrolling on/off.  <b>Off</b> the image takes as much space as needed. <b>On</b> you can adjust the maximum length of the image.")}).on("mouseout",
function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}));d.topDiv=d.vis.append("div").attr("id","Level"+c).style("text-align","left");d.xScale=d3.scaleLinear().domain([l,n]).range([0,d.width]);e={};e.chr=chr;e.start=l;e.stop=n;history[d.levelNumber]||(history[d.levelNumber]=[]);history[d.levelNumber].push(e);d.xAxis=d3.axisTop(d.xScale).ticks(6).tickSize(8).tickPadding(10);d.scaleSVG=d.topDiv.append("svg:svg").attr("width",d.width).attr("height",
60).attr("pointer-events","all").attr("class","scale").on("mousedown",d.mdown).on("mouseup",mup).on("mouseover",function(){"dragzoom"!=d.defaultMouseFunct?$("#mouseHelp").html("<B>Zoom:</b> Click and Drag right to zoom in or left to zoom out. <B>OR</B> Hold the Alt/Option Key while clicking, then drag to select a specific area."):$("#mouseHelp").html("<B>Zoom:</b> Click and Drag to select an area to zoom in on it. <B>OR</B> Hold the Alt/Option Key while clicking and drag right to zoom in or left to zoom out.");
d3.event.altKey&&"dragzoom"!=d.defaultMouseFunct?d.changeScaleCursor("crosshair"):d3.event.altKey&&"dragzoom"==d.defaultMouseFunct&&d.changeScaleCursor("ew-resize")}).on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mousemove",function(){d3.event.altKey&&"dragzoom"!=d.defaultMouseFunct?d.changeScaleCursor("crosshair"):d3.event.altKey&&"dragzoom"==d.defaultMouseFunct?d.changeScaleCursor("ew-resize"):d3.event.altKey||
"dragzoom"!=d.defaultMouseFunct?d3.event.altKey||"dragzoom"==d.defaultMouseFunct||d.changeScaleCursor("ew-resize"):d.changeScaleCursor("crosshair")}).style("cursor","ew-resize");d.scaleSVG.append("text").text(b).attr("x",(d.width-2*d.margin)/2).attr("y",10).attr("class","axisLbl");d.scaleSVG.append("g").attr("class","x axis").attr("transform","translate(0,55)").attr("shape-rendering","crispEdges").call(d.xAxis);d.topLevel=d.topDiv.append("div").attr("id","ScrollLevel"+c).attr("class","scroll").style("max-height",
"350px").style("overflow","auto").style("width","100%").append("ul").attr("id","sortable"+c);d.getAddMenus();svgList[c]=d;$("#sortable"+c).sortable({appendTo:"parent",containment:"parent",stop:function(){}}).disableSelection();$(".draggable"+c).draggable({connectToSortable:"#sortable"+c,scroll:!0,revert:"invalid",axis:"y"});l=mmVer;"Rn"==organism&&(l=rnVer);d3.select("div#imageHeader").html("Organism: "+l+"&nbsp&nbsp&nbsp&nbsp"+siteVer);0<$("span#verSelect").length&&(l=d3.select("span#verSelect").append("select"),
d.allowSelectGenomeVer?(l.on("change",function(){displayWorking();!0===isLocalStorage()?localStorage.setItem(organism+"DefGenomeVer",$(this).val()):$.cookie(organism+"DefGenomeVer",$(this).val());changeGenome($(this).val(),d.currentView);setTimeout(function(){$("form#geneCentricForm").submit()},1500)}),"Rn"===organism?(n=l.append("option").attr("value","rn6").html("rn6"),"rn6"===genomeVer&&n.attr("selected","selected"),l=l.append("option").attr("value","rn5").html("rn5"),"rn5"===genomeVer&&l.attr("selected",
"selected")):"Mm"===organism&&(l=l.append("option").attr("value","mm10").html("mm10"),"mm10"===genomeVer&&l.attr("selected","selected"))):l.append("option").attr("value",genomeVer).html(genomeVer));d.addTrack("genomeSeq",3,"both",0);d.selectSvg=selectionSVG("#Level"+d.levelNumber,d.width,d.levelNumber,d);return d}
function toolTipSVG(f,e,l,n,c,b,a){var g={isToolTip:1};g.folderName=regionfolderName;g.updateTimeoutHandle={};g.timeoutTrack=-1;g.forLevel=-1;g.strainSpecificCountColors=d3.scaleOrdinal(d3.schemeCategory20);g.get=function(a){return g[a]};g.getTrack=function(a){for(var b,d=0;d<g.trackList.length;d++)"undefined"!==typeof g.trackList[d]&&g.trackList[d].trackClass===a&&(b=g.trackList[d]);return b};g.addTrackErrorRemove=function(a,b){};g.addTrack=function(a,b,c,h){"Trx"==g.forceDrawAsValue&&-1==(new String(c)).indexOf("DrawTrx")&&
(c+="DrawTrx,");var d=d3.select("#Level"+g.levelNumber+a).nodes();if(0===d.length||null==d){d=g.topLevel.append("li").attr("class","draggable"+g.levelNumber).append("svg:svg").attr("width",g.get("width")).attr("height",30).attr("class","track").attr("id","Level"+g.levelNumber+a);var p=new String("Loading...");d.append("text").text(p).attr("x",g.width/2-p.length/2*7.5).attr("y",12).attr("id","trkLbl")}d="";-1<g.forLevel&&99==g.levelNumber&&"undefined"!==typeof svgList[g.forLevel]&&(d=svgList[g.forLevel].getTrack(a).generateTrackSettingString(),
c=d=d.substr(d.indexOf(",")+1));if("genomeSeq"===a){var m=SequenceTrack(g,a,"Reference Genomic Sequence",c);m.seqRegionSize=10;g.addTrackList(m)}else if(-1<a.indexOf("noncoding"))m=GeneTrack(g,h,a,"Non-Coding/Non-PolyA+ Transcripts",c),g.addTrackList(m);else if(-1<a.indexOf("coding"))m=GeneTrack(g,h,a,"Protein Coding/PolyA+ Transcripts",c),g.addTrackList(m);else if(0===a.indexOf("liverTotal")||"heartTotal"===a||0===a.indexOf("brainTotal")||"mergedTotal"===a)b="Liver Total RNA Transcripts","heartTotal"===
a?b="Heart Total RNA Transcripts":"brainTotal"===a?b="Brain Total RNA Transcripts":"mergedTotal"===a&&(b="Merged (Brain,Heart,Liver) Reconstructed"),m=GeneTrack(g,h,a,b,c),g.addTrackList(m);else if(-1<a.indexOf("smallnc"))m=GeneTrack(g,h,a,"Small RNA (<200 bp) Genes",c),g.addTrackList(m);else if(0===a.indexOf("refSeq"))99===g.levelNumber&&(c+="DrawTrx,"),m=RefSeqTrack(g,h,a,"Ref Seq Genes",c),m.density=99===g.levelNumber?2:b,g.addTrackList(m);else if(0===a.indexOf("snp"))m=SNPTrack(g,h,a,1,"4"),g.addTrackList(m);
else if("qtl"===a)m=QTLTrack(g,h,a,1),g.addTrackList(m);else if("trx"===a)h=getAllChildrenByName(getFirstChildByName(g.selectedData,"TranscriptList"),"Transcript"),m=TranscriptTrack(g,h,a,b),g.addTrackList(m);else if("probe"===a||"probeMouse"===a)99!==g.levelNumber&&(c=b+","+c),m=ProbeTrack(g,h,a,"Affy Exon 1.0 ST Probe Sets",c),g.addTrackList(m);else if(-1<a.indexOf("spliceJnct"))c="Brain ","liverspliceJnct"===a?c="Liver ":"heartspliceJnct"===a&&(c="Heart "),m=SpliceJunctionTrack(g,h,a,c+"Splice Junctions",
3,""),100===g.levelNumber&&(m.density=b),g.addTrackList(m);else if("polyASite"===a)m=PolyATrack(g,h,a,"Predicted PolyA Sites",c),g.addTrackList(m);else if("helicos"===a||-1<a.indexOf("illuminaTotal")||-1<a.indexOf("illuminaSmall")||"illuminaPolyA"===a){g.updateTimeoutHandle[a]&&(g.updateTimeoutHandle[a]=-1);b=2;c=d.split(",");1<c.length&&(1===c[1]||2===c[1])&&(b=c[1]);"helicos"===a?m=HelicosTrack(g,h,a,b):"illuminaTotal"===a?m=IlluminaTotalTrack(g,h,a,b):"illuminaSmall"===a?m=IlluminaSmallTrack(g,
h,a,b):"illuminaPolyA"===a?m=IlluminaPolyATrack(g,h,a,b):"liverilluminaTotalPlus"===a?m=LiverIlluminaTotalPlusTrack(g,h,a,b):"liverilluminaTotalMinus"===a?m=LiverIlluminaTotalMinusTrack(g,h,a,b):"heartilluminaTotalPlus"===a?m=HeartIlluminaTotalPlusTrack(g,h,a,b):"heartilluminaTotalMinus"===a?m=HeartIlluminaTotalMinusTrack(g,h,a,b):"brainilluminaTotalPlus"===a?m=BrainIlluminaTotalPlusTrack(g,h,a,b):"brainilluminaTotalMinus"===a?m=BrainIlluminaTotalMinusTrack(g,h,a,b):"liverilluminaSmall"===a?m=LiverIlluminaSmallTrack(g,
h,a,b):"heartilluminaSmall"===a?m=HeartIlluminaSmallTrack(g,h,a,b):-1<a.indexOf("illuminaTotal")&&(m=StrainSpecificIlluminaTotalTrack(g,h,a,b));if(99===g.levelNumber){if(0!==g.updateTimeoutHandle[a]){clearTimeout(g.updateTimeoutHandle[a]);try{clearTimeout(g.timeoutTrack[a].fullDataTimeOutHandle)}catch(t){}g.updateTimeoutHandle[a]=0}g.updateTimeoutHandle[a]=setTimeout(function(){m.updateFullData(0,1);g.timeoutTrack[a]=m;g.updateTimeoutHandle[a]=0},300)}g.addTrackList(m)}else if(0===a.indexOf("repeatMask"))m=
RepeatMaskTrack(g,h,a,"Repeat Masker",1,c),g.addTrackList(m);else if(-1<a.indexOf("custom"))if(b=trackInfo[a],c="DataFile="+b.Location+","+c,"bed"===b.Type||"bb"===b.Type)h=[],m=CustomTranscriptTrack(g,h,a,b.Name,3,c),g.addTrackList(m);else if("bg"===b.Type||"bw"===b.Type)h=[],m=CustomCountTrack(g,h,a,3,c),g.addTrackList(m);$(".sortable"+g.levelNumber).sortable("refresh")};g.addTrackList=function(a){null!=a&&(g.trackList[g.trackCount]=a,g.trackCount++,setTimeout(function(){DisplayRegionReport()},
300))};g.changeTrackHeight=function(a,b){0<b?d3.select("#"+a+"Scroll").style("max-height",b+"px"):d3.select("#"+a+"Scroll").style("max-height","none")};g.removeAllTracks=function(){for(var a=0;a<g.trackList.length;a++)"undefined"!==typeof g.trackList[a]&&"genomeSeq"!==g.trackList[a].trackClass&&d3.select("#Level"+g.levelNumber+g.trackList[a].trackClass).remove();g.trackList=[];setTimeout(function(){DisplayRegionReport()},300)};g.removeTrack=function(a){d3.select("#Level"+g.levelNumber+a).remove();
for(var b=0;b<g.trackList.length;b++)"undefined"!==typeof g.trackList[b]&&g.trackList[b].trackClass==a&&(g.trackList.splice(b,1),g.trackCount--);setTimeout(function(){DisplayRegionReport()},300)};g.redrawTrack=function(a){for(var b=0;b<g.trackList.length;b++)"undefined"!==typeof g.trackList[b]&&g.trackList[b].trackClass==a&&g.trackList[b].redraw();setTimeout(function(){DisplayRegionReport()},300)};g.redraw=function(){for(var a=0;a<g.trackList.length;a++)"undefined"!==typeof g.trackList[a]&&"undefined"!==
typeof g.trackList[a].redraw&&g.trackList[a].redraw()};g.update=function(){for(var a=0;a<g.trackList.length;a++)"undefined"!==typeof g.trackList[a].update&&g.trackList[a].update();setTimeout(function(){DisplayRegionReport()},300)};g.updateData=function(){for(var a=0;a<g.trackList.length;a++)"undefined"!==typeof g.trackList[a]&&"undefined"!==typeof g.trackList[a].updateData&&g.trackList[a].updateData(0);g.updateFullData();setTimeout(function(){DisplayRegionReport()},300)};g.updateFullData=function(){-1<
(new String(g.folderName)).indexOf("img")&&(g.folderName="/"+chr+"/"+g.xScale.domain()[0]+"_"+g.xScale.domain()[1]);for(var a=0;a<g.trackList.length;a++)"undefined"!==typeof g.trackList[a]&&"undefined"!==typeof g.trackList[a].updateFullData&&g.trackList[a].updateFullData(0,1)};g.setLoading=function(){for(var a=0;a<g.trackList.length;a++)"undefined"===typeof g.trackList[a]||"undefined"===typeof g.trackList[a].updateData&&"undefined"===typeof g.trackList[a].updateFullData||g.trackList[a].showLoading()};
g.clearSelection=function(){for(var a=0;a<g.trackList.length;a++)"undefined"!==typeof g.trackList[a]&&"undefined"!==typeof g.trackList[a].clearSelection&&g.trackList[a].clearSelection()};g.mdown=function(){if(0==processAjax){g.prevMinCoord=g.xScale.domain()[0];g.prevMaxCoord=g.xScale.domain()[1];var a=d3.mouse(g.vis.node());g.downx=g.xScale.invert(a[0]);g.downscalex=g.xScale}};g.forceDrawAs=function(a){for(var b=0;b<g.trackList.length;b++)"undefined"!==typeof g.trackList[b]&&"undefined"!==typeof g.trackList[b].drawAs&&
(g.trackList[b].drawAs=a,g.trackList[b].draw(g.trackList[b].data));g.forceDrawAsValue=a};g.generateSettingsString=function(){ret="";for(var a=0;a<g.trackList.length;a++)"undefined"!==typeof g.trackList[a]&&"undefined"!==typeof g.trackList[a].generateTrackSettingString&&(ret+=g.trackList[a].generateTrackSettingString());return ret};g.setCurrentViewModified=function(){"undefined"!==typeof g.currentView&&(g.currentView.modified=1,$("span#viewModifiedCtl"+g.levelNumber).show())};g.clearCurrentView=function(){g.currentView.modified=
0;$("span#viewModifiedCtl"+g.levelNumber).hide()};g.type=a;g.div=f;g.margin=0;g.halfWindowWidth=$(window).width()/2;g.mh=400;g.downx=Math.NaN;g.downscalex;g.downPanx=Math.NaN;g.xMax=29E7;g.xMin=1;g.prevMinCoord=l;g.prevMaxCoord=n;g.dataMinCoord=l;g.dataMaxCoord=n;g.y=0;g.xScale=null;g.xAxis=null;g.vis=null;g.level=null;g.svg=null;g.txType=null;g.txList=null;g.tt=null;g.trackList=[];g.trackCount=0;g.levelNumber=c;g.selectedData=null;g.txType=null;g.width=e;g.mw=g.width-g.margin;g.vis=d3.select(f);
g.topDiv=g.vis.append("div").attr("id","Level"+c).style("text-align","left");g.xScale=d3.scaleLinear().domain([l,n]).range([0,g.width]);g.xAxis=d3.axisTop(g.xScale).ticks(3).tickSize(8).tickPadding(10);g.scaleSVG=g.topDiv.append("svg:svg").attr("width",g.width).attr("height",60).attr("class","scale");g.scaleSVG.append("g").attr("class","x axis").attr("transform","translate(0,55)").attr("shape-rendering","crispEdges").call(g.xAxis);d3.select("#Level"+g.levelNumber).select(".x.axis").append("text").text(b).attr("x",
(g.width-2*g.margin)/2).attr("y",-40).attr("class","axisLbl");g.topLevel=g.topDiv.append("div").attr("id","ScrollLevel"+g.levelNumber).style("width",g.width+18+"px").append("ul").attr("id","sortable"+g.levelNumber);return g}
function selectionSVG(f,e,l,n){var c={};c.imageWidth=e+25;c.levelNumber=l;c.parent=n;c.coordSelectStart=0;c.coordSelectStop=0;c.visible=!1;c.changeSelection=function(b,a){c.start=b;c.stop=a;c.setVis(!0);c.draw()};c.setVis=function(b){c.visible=b;c.visible?(c.svg.style("display","inline-block"),$("div#regionDiv").hide()):(c.svg.style("display","none"),$("div#regionDiv").show())};c.draw=function(){if(c.visible){c.xScale(c.stop);c.xScale(c.start);c.parent.updateTrackSelectedArea(c.start,c.stop);var b=
new String(numberWithCommas(Math.floor(c.start))),a=new String(numberWithCommas(Math.floor(c.stop)));c.svg.selectAll("line").remove();c.svg.selectAll("text").remove();c.svg.append("line").attr("x1",function(){var a=c.xScale(c.start);0>a&&(a=0);return a}).attr("x2",function(){var a=c.xScale(c.start);0>a&&(a=0);return a}).attr("y1",0).attr("y2",15).attr("stroke","#00992D").attr("stroke-width","1");c.svg.append("line").attr("x1",function(){return c.xScale(c.stop)}).attr("x2",function(){return c.xScale(c.stop)}).attr("y1",
0).attr("y2",15).attr("stroke","#00992D").attr("stroke-width","1");c.svg.append("line").attr("x1",function(){var a=c.xScale(c.start);0>a&&(a=0);return a}).attr("x2",0).attr("y1",15).attr("y2",60).attr("stroke","#00992D").attr("stroke-width","1");c.svg.append("line").attr("x1",function(){return c.xScale(c.stop)}).attr("x2",c.imageWidth).attr("y1",15).attr("y2",60).attr("stroke","#00992D").attr("stroke-width","1");c.svg.append("text").attr("x",c.xScale(c.start)-7.5*b.length-10).attr("y",15).text(b);
c.svg.append("text").attr("x",c.xScale(c.stop)+10).attr("y",15).text(a)}};c.redraw=function(){c.draw()};c.setup=function(){c.svg=d3.select(f).append("svg:svg").attr("width",c.imageWidth).attr("height",60).attr("id","selectionLevel"+c.levelNumber).style("display","none");c.xScale=c.parent.xScale};c.setup();return c}
function Track(f,e,l,n){var c={};c.selectionStart=f.selectionStart;c.selectionEnd=f.selectionEnd;c.ttSVGMinWidth=20;c.panDown=function(){if(!d3.event.shiftKey&&0===c.gsvg.overSettings&&0===overSelectable&&("dragzoom"!==c.gsvg.defaultMouseFunct&&d3.event.altKey||"dragzoom"===c.gsvg.defaultMouseFunct&&!d3.event.altKey)){var b=d3.mouse(c.gsvg.vis.node());c.gsvg.downZoomx=b[0];c.svg.append("rect").attr("class","zoomRect").attr("x",b[0]).attr("y",0).attr("height",c.svg.attr("height")).attr("width",1).attr("fill",
"#CECECE").attr("opacity",.3);c.scaleSVG.append("rect").attr("class","zoomRect").attr("x",b[0]).attr("y",0).attr("height",c.scaleSVG.attr("height")).attr("width",1).attr("fill","#CECECE").attr("opacity",.3);c.scaleSVG.append("text").attr("id","zoomTextStart").attr("x",c.gsvg.downZoomx).attr("y",15).text(numberWithCommas(Math.round(c.xScale.invert(c.gsvg.downZoomx))));c.scaleSVG.append("text").attr("id","zoomTextEnd").attr("x",c.gsvg.downZoomx).attr("y",50).text(numberWithCommas(Math.round(c.xScale.invert(c.gsvg.downZoomx))))}else!d3.event.shiftKey&&
0===c.gsvg.overSettings&&0===overSelectable&&("pan"===c.gsvg.defaultMouseFunct&&!d3.event.altKey||"pan"!==c.gsvg.defaultMouseFunct&&d3.event.altKey)&&0==processAjax&&(b=d3.mouse(c.gsvg.vis.node()),c.gsvg.downPanx=b[0],c.gsvg.downscalex=c.xScale)};c.zoomToFeature=function(b){var a=parseInt(b.getAttribute("stop"),10)-parseInt(b.getAttribute("start"),10);a*=.25;var g=parseInt(b.getAttribute("start"),10)-a;b=parseInt(b.getAttribute("stop"),10)+a;b<=c.gsvg.xMax&&1<=g&&(c.xScale.domain([g,b]),c.scaleSVG.select(".x.axis").call(c.xAxis),
c.gsvg.redraw(),0==c.gsvg.levelNumber||1==c.gsvg.levelNumber)&&(a={},a.chr=chr,a.start=g,a.stop=b,history[c.gsvg.levelNumber].push(a))};c.clearSelection=function(){c.selectionStart=-1;c.selectionEnd=-1;c.svg.selectAll("rect.selectedArea").remove();c.svg.selectAll(".selected").each(function(){c.svg.select(this).attr("class","").style("fill",c.color)})};c.setSelectedArea=function(b,a){c.selectionStart=b;c.selectionEnd=a;c.redrawSelectedArea()};c.redrawSelectedArea=function(){d3.select("#Level"+c.gsvg.levelNumber+
c.trackClass).selectAll(".selectedArea").remove();if(-1<c.selectionStart&&-1<c.selectionEnd){var b=c.xScale(c.selectionStart),a=c.xScale(c.selectionEnd)-b;1>a&&(a=1);d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).append("rect").attr("class","selectedArea").attr("x",b).attr("y",0).attr("height",function(){var a=c.svg.attr("height");15>a&&(a=15);return a}).attr("width",a).attr("fill","#CECECE").attr("opacity",.3).attr("pointer-events","none")}};c.colorStroke=function(b){var a="black";3>c.xScale(b.getAttribute("stop"))-
c.xScale(b.getAttribute("start"))&&(a=c.color(b));return a};c.calcY=function(b,a,g){b=3===c.density||"3"===c.density?c.calcYPack(b,a,g):2===c.density||"2"===c.density?c.calcYFull(g):c.calcYDense();c.trackYMax<b/15&&(c.trackYMax=b/15);return b};c.calcYPack=function(b,a,g){if(b>=c.xScale.domain()[0]&&b<=c.xScale.domain()[1]||a>=c.xScale.domain()[0]&&a<=c.xScale.domain()[1]||b<=c.xScale.domain()[0]&&a>=c.xScale.domain()[1]){b=Math.round(c.xScale(b));0>b&&(b=0);a=Math.round(c.xScale(a));a>=c.gsvg.width&&
(a=c.gsvg.width-1);g=b-c.xPadding;0>g&&(g=0);var d=a+c.xPadding;d>=c.gsvg.width&&(d=c.gsvg.width-1);for(var p=0,m=g;m<=d;m++)c.yMaxArr[m]>p&&(p=c.yMaxArr[m]);p++;var h=p;if(c.yArr.length<=p)for(c.yArr[h]=[],m=0;m<c.gsvg.width;m++)c.yArr[h][m]=0;m=p-c.scanBackYLines;1>m&&(m=1);h=0;for(var e=m;e<p&&0==h;e++){var q=0;for(m=g;m<=d&&0==q;m++)c.yArr[e][m]>q&&(q=1);0==q&&(p=e,h=1)}p>c.trackYMax&&(c.trackYMax=p);for(m=b;m<=a;m++)c.yMaxArr[m]<p&&(c.yMaxArr[m]=p),c.yArr[p][m]=1;b=15*p}else b=15;return b};c.calcYDense=
function(){return 15};c.calcYFull=function(b){return 15*(b+1)};c.positionTTLeft=function(b){b+=20;b>c.gsvg.halfWindowWidth&&(b-=490);return b+"px"};c.positionTTTop=function(b){b=window.pageYOffset+10;var a=window.innerHeight-1.8*$(".testToolTip").height();20<a&&(b+=a/2);return b+"px"};c.drawLegend=function(b){var a=new String(c.label),g=c.gsvg.width/2+a.length/2*7.5+16;500>c.gsvg.width&&(g=7.5*a.length);d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll(".legend").remove();for(var d=0;d<
b.length;d++)c.svg.append("rect").attr("class","legend").attr("x",g).attr("y",0).attr("rx",3).attr("ry",3).attr("height",12).attr("width",16).attr("fill",b[d].color).attr("stroke",b[d].color),a=new String(b[d].label),c.svg.append("text").text(a).attr("class","legend").attr("x",g+18).attr("y",12),g=g+25+8*a.length};c.drawScaleLegend=function(b,a,g,d,p,m){var h=new String(c.label),e=c.gsvg.width/2+h.length/2*7.5+16;500>c.gsvg.width&&(e=7.5*h.length);e+=m;d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll(".legend").remove();
d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll("#def1").remove();h=c.svg.append("defs").attr("id","def1").append("linearGradient").attr("id","grad"+c.gsvg.levelNumber+c.trackClass);h.append("stop").attr("offset","0%").style("stop-color",d);h.append("stop").attr("offset","100%").style("stop-color",p);h=new String(b);b=7.6*h.length;c.svg.append("text").text(h).attr("class","legend").attr("x",e).attr("y",12);c.svg.append("rect").attr("class","legend").attr("x",e+b+5).attr("y",0).attr("rx",
3).attr("ry",3).attr("height",12).attr("width",75).attr("fill","url(#grad"+c.gsvg.levelNumber+c.trackClass+")");h=new String(a);c.svg.append("text").text(h).attr("class","legend").attr("x",e+b+80).attr("y",12);a=8*h.length+5;h=new String(g);c.svg.append("text").text(h).attr("class","legend").attr("x",e+b+80+a).attr("y",12)};c.showLoading=function(){0<d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll("g.loading")?c.loading=d3.select(c.svg).selectAll("g.loading"):(c.loading=c.svg.append("g").attr("class",
"loading"),c.loading.append("rect").attr("x",0).attr("y",0).attr("height",c.svg.attr("height")).attr("width",c.gsvg.width).attr("fill","#CECECE").attr("opacity",.6),c.loading.append("text").text("Loading...").attr("x",c.gsvg.width/2-37.5).attr("y",c.svg.attr("height")/2))};c.hideLoading=function(){c.loading=d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll("g.loading");"undefined"!==typeof c.loading&&c.loading.remove()};c.displayBreakDown=function(b){$(window).width();1E3<$(window).width()&&
$(window).width();if("undefined"!==typeof c.counts&&0<c.counts.length){for(var a=1,g=0;g<c.counts.length&&1===a;g++)0<c.counts[g].value&&(a=0);if(0===a){var d=d3.arc().outerRadius(140).innerRadius(0);a=d3.pie().value(function(a){return a.value});b=d3.select(b).append("svg").attr("width",300).attr("height",300).append("g").attr("transform","translate(150,150)").selectAll(".arc").data(a(c.counts)).enter().append("g").attr("class","arc");b.append("path").attr("d",d).attr("fill",c.pieColor).on("mouseover",
function(a){d3.select(".testToolTip").transition().duration(200).style("opacity",.95);d3.select(".testToolTip").html("Name: "+a.data.names+"<BR>Count: "+a.data.value).style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px");c.triggerTableFilter(a)}).on("mouseout",function(a){d3.select(".testToolTip").transition().delay(500).duration(200).style("opacity",0);c.clearTableFilter(a)});b.append("text").attr("transform",function(a){return"translate("+d.centroid(a)+")"}).attr("dy",".35em").attr("fill",
"#FFFFFF").style("text-anchor","middle").text(function(a){var b=a.value;0==a.value&&(b="");return b})}}};c.updateLabel=function(b){c.label=b;b=new String(c.label);600<c.gsvg.width?d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).select("#trkLbl").attr("x",c.gsvg.width/2-b.length/2*7.5).text(b):d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).select("#trkLbl").attr("x",0).text(b);d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).select(".infoIcon").attr("transform","translate("+(c.gsvg.width-
20)+",0)");d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).select(".settings").attr("transform","translate("+(c.gsvg.width-40)+",0)")};c.resize=function(){d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).attr("width",c.gsvg.width);c.updateLabel(c.label);"undefined"!==typeof c.redrawLegend&&c.redrawLegend();c.redraw()};c.triggerTableFilter=function(b){};c.clearTableFilter=function(b){};c.getDisplayID=function(b){return b.getAttribute("ID")};c.setupToolTipSVG=function(b,a){var g=parseInt(b.getAttribute("start"),
10),d=parseInt(b.getAttribute("stop"),10),p=Math.floor((d-g)*a);20>p&&(p=20);var m=g-p;p=d+p;1>m&&(m=1);"undefined"!==typeof c.ttSVGMinWidth&&p-m<c.ttSVGMinWidth&&(m=g-c.ttSVGMinWidth/2,p=d+c.ttSVGMinWidth/2);g=toolTipSVG("div#ttSVG",450,m,p,99,c.getDisplayID(b),"transcript");g.forLevel=c.gsvg.levelNumber;d=[];d.push(b);g.addTrack(c.trackClass,3,"",d);for(d=0;d<c.ttTrackList.length;d++){var h=c.gsvg.getTrackData(c.ttTrackList[d]),e=[];if("undefined"!==typeof h&&0<h.length){for(var q=0,f=0;f<h.length;f++)if(m<=
parseInt(h[f].getAttribute("start"),10)&&parseInt(h[f].getAttribute("start"),10)<=p||parseInt(h[f].getAttribute("start"),10)<=m&&parseInt(h[f].getAttribute("stop"),10)>=m)e[q]=h[f],q++;0<e.length&&g.addTrack(c.ttTrackList[d],3,"DrawTrx",e)}}};c.generateSettingsDiv=function(b){c.savePrevious();var a=trackInfo[c.trackClass];d3.select(b).select("table").select("tbody").html("");if("undefined"!==typeof a&&0<a.Controls.length&&"null"!=a.Controls){var g=(new String(a.Controls)).split(",");b=d3.select(b).select("table").select("tbody");
b.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+a.Name);for(a=0;a<g.length;a++)if("undefined"!==typeof g[a]&&""!=g[a]){var d=g[a].split(";"),p=b.append("tr").append("td"),m=d[0].substr(5);p.append("text").text(m+": ");m="";3<d.length&&0==d[3].indexOf("Default=")&&(m=d[3].substr(8));if(0==d[1].toLowerCase().indexOf("select")){var h=d[1].split(":");d=d[2].split("}");var e="",q="";2<h.length&&(e=h[2]);3<h.length&&(q=h[3]);p=p.append("select").attr("id",c.trackClass+e+
c.level+q).attr("name",h[1]);for(h=0;h<d.length;h++){var f=d[h].substr(1).split(":");if(2==f.length){var l=p.append("option").attr("value",f[1]).text(f[0]);"Dense"===e&&f[1]==c.density?l.attr("selected","selected"):"Version"===e&&f[1]==c.dataVer?l.attr("selected","selected"):f[1]==m&&l.attr("selected","selected")}}d3.select("select#"+c.trackClass+e+c.level+q).on("change",function(){c.updateSettingsFromUI();c.redraw()})}else console.log("Undefined track settings:  "+g[a])}g=b.append("tr").append("td");
g.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");c.gsvg.setCurrentViewModified();c.gsvg.removeTrack(c.trackClass);var a=svgList[c.gsvg.levelNumber].currentView.ViewID,b=viewMenu[c.gsvg.levelNumber].findTrackByClass(c.trackClass,a);b=viewMenu[c.gsvg.levelNumber].findTrackIndexWithViewID(b.TrackID,a);viewMenu[c.gsvg.levelNumber].removeTrackWithIDIdx(b,a)});g.append("input").attr("type",
"button").attr("value","Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");c.density!=c.prevSetting.density&&c.gsvg.setCurrentViewModified()});g.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){c.revertPrevious();c.draw(c.data);$("#trackSettingDialog").fadeOut("fast")})}else a&&(b=d3.select(b).select("table").select("tbody"),b.append("tr").append("td").style("font-weight",
"bold").html("Track Settings: "+a.Name),b.append("tr").append("td").html("Sorry no settings for this track."),g=b.append("tr").append("td"),g.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");c.gsvg.setCurrentViewModified();c.gsvg.removeTrack(c.trackClass)}),g.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",
function(){$("#trackSettingDialog").fadeOut("fast")}))};c.updateSettingsFromUI=function(){0<$("#"+c.trackClass+"Dense"+c.level+"Select").length&&(c.density=$("#"+c.trackClass+"Dense"+c.level+"Select").val())};c.savePrevious=function(){c.prevSetting={};c.prevSetting.density=c.density};c.revertPrevious=function(){c.density=c.prevSetting.density};c.updateSettings=function(b){};c.generateTrackSettingString=function(){return c.trackClass+","+c.density+";"};c.gsvg=f;c.level=c.gsvg.levelNumber;c.data=e;
c.label=n;c.density=3;c.loading;c.trackYMax=0;c.trackClass=l;c.topLevel=c.gsvg.get("topLevel");c.xScale=c.gsvg.get("xScale");c.scaleSVG=c.gsvg.get("scaleSVG");c.xAxis=c.gsvg.get("xAxis");c.yMaxArr=[];c.yArr=[];c.yArr[0]=[];for(f=0;f<c.gsvg.width;f++)c.yMaxArr[f]=0,c.yArr[0][f]=0;c.scanBackYLines=12;c.xPadding=2;3E6<c.gsvg.xScale.domain()[1]-c.gsvg.xScale.domain()[0]&&(c.xPadding=1);c.vis=d3.select("#Level"+c.gsvg.levelNumber+c.trackClass);c.svg=d3.select("svg#Level"+c.gsvg.levelNumber+c.trackClass);
c.svg.on("mousedown",c.panDown);c.updateLabel(c.label);return c}
function SequenceTrack(f,e,l,n){n=[];var c=Track(f,n,e,l);c.dispCutoff=300;c.aaDispCutoff=2900;c.seqRegionSize=4E3;c.strands="both";c.includeAA=1;c.labelBase=l;c.lastUpdate=0;c.seqRegionMin=0;c.seqRegionMax=0;c.color=function(b){};c.colorAA=function(b,a){d3.rgb("#FFFFFF");var c=0==b.pos%2?d3.rgb("#C3C3C3"):d3.rgb("#838383");"M"==b.aa&&(c=d3.rgb("#00FF00"));"*"==b.aa&&(c=d3.rgb("#FF0000"));return c};c.createCodon=function(){c.codons=[];c.codons.AAA="K";c.codons.AAT="N";c.codons.AAG="K";c.codons.AAC=
"N";c.codons.ATA="I";c.codons.ATT="I";c.codons.ATG="M";c.codons.ATC="I";c.codons.ACA="T";c.codons.ACT="T";c.codons.ACG="T";c.codons.ACC="T";c.codons.AGA="R";c.codons.AGT="S";c.codons.AGG="R";c.codons.AGC="S";c.codons.TAA="*";c.codons.TAT="Y";c.codons.TAG="*";c.codons.TAC="Y";c.codons.TTA="L";c.codons.TTT="F";c.codons.TTG="L";c.codons.TTC="F";c.codons.TCA="S";c.codons.TCT="S";c.codons.TCG="S";c.codons.TCC="S";c.codons.TGA="*";c.codons.TGT="C";c.codons.TGG="W";c.codons.TGC="C";c.codons.CAA="Q";c.codons.CAT=
"H";c.codons.CAG="Q";c.codons.CAC="H";c.codons.CTA="L";c.codons.CTT="L";c.codons.CTG="L";c.codons.CTC="L";c.codons.CCA="P";c.codons.CCT="P";c.codons.CCG="P";c.codons.CCC="P";c.codons.CGA="R";c.codons.CGT="R";c.codons.CGG="R";c.codons.CGC="R";c.codons.GAA="E";c.codons.GAT="D";c.codons.GAG="E";c.codons.GAC="D";c.codons.GTA="V";c.codons.GTT="V";c.codons.GTG="V";c.codons.GTC="V";c.codons.GCA="A";c.codons.GCT="A";c.codons.GCG="A";c.codons.GCC="A";c.codons.GGA="G";c.codons.GGT="G";c.codons.GGG="G";c.codons.GGC=
"G"};c.translate=function(b){b=b.toUpperCase();return c.codons[b]};c.translateRegion=function(b,a,g,d){var p=[],m=0,h=0;if(c.data){if(g>d){h=1;var e=g;g=d;d=e}for(e=g;e<=d;e+=3){var q=c.data.substring(e,e+3);1==h&&(q=c.reverseCompliment(q));p[m]=[];p[m].aa=c.translate(q);p[m].pos=a+(e-g);p[m].id=b+":"+e+":"+c.translate(q);m++}}return p};c.reverseCompliment=function(b){for(var a="",g=b.length-1;-1<g;g--)a+=c.complement(b.charAt(g));return a};c.complement=function(b){var a="N";"A"==b?a="T":"T"==b?a=
"A":"G"==b?a="C":"C"==b&&(a="G");return a};c.redraw=function(){c.redrawSelectedArea();var b=c.xScale.domain()[0],a=c.xScale.domain()[1];if(c.prevStrand!=c.strands||c.prevIncldAA!=c.includeAA)d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll("g.base").each(function(a){d3.select(this).remove()}),d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll("g.aa0").each(function(a){d3.select(this).remove()}),d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll("g.aa1").each(function(a){d3.select(this).remove()}),
d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll("g.aa2").each(function(a){d3.select(this).remove()}),d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll("g.aarev0").each(function(a){d3.select(this).remove()}),d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll("g.aarev1").each(function(a){d3.select(this).remove()}),d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll("g.aarev2").each(function(a){d3.select(this).remove()}),b<c.seqRegionMin||a>c.seqRegionMax?
c.updateData(0):c.draw(c.data);else if(b<c.seqRegionMin||a>c.seqRegionMax)c.updateData(0);else{var g=a-b,d="12px";200<g&&(d="10px");if(g<=c.aaDispCutoff&&1==c.includeAA||g<=c.dispCutoff){if(c.seqRegionMin<=b&&b<=c.seqRegionMax&&c.seqRegionMin<=a&&a<=c.seqRegionMax){var p=c.gsvg.width/g,m=p/2;a=b-c.seqRegionMin;var h=g+a,e=27;1==c.includeAA&&"-"!=c.strands&&(e+=30);if(g<c.dispCutoff){d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll("g.line").remove();for(var q=[],f=a;f<h;f++)q[f-a]=[],
q[f-a].base=c.data.charAt(f),q[f-a].id=f,q[f-a].pos=f-a;c.textSize(g);var l=c.yPosition(g);f=c.svg.selectAll(".base").data(q,keyID).attr("transform",function(a,b){return"translate("+(a.pos*p-m)+","+e+")"});q=f.enter().append("g").attr("class","base").attr("transform",function(a,b){return"translate("+(a.pos*p-m)+","+e+")"});q.each(function(a){d3.select(this).append("text").text(function(a){return"-"!=c.strands?a.base:c.complement(a.base)});"both"==c.strands&&d3.select(this).append("text").attr("class",
"comp").attr("y",l).text(function(a){return c.complement(a.base)})});f.exit().remove();f.selectAll("text").attr("font-size",function(a){return c.textSize(g)});f.selectAll("text.comp").attr("y",l)}else d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll("g.base").remove(),c.svg.append("g").attr("class","line").append("line").attr("stroke","#000000").attr("x1",0).attr("y1",e).attr("x2",c.gsvg.width).attr("y2",e);if(1==c.includeAA){var n=3*p,v=n/2-4,w=25;if("both"==c.strands||"+"==c.strands)for(f=
b%3,q=a-f,h=[],h[0]=c.translateRegion(0,b-f,q,q+g),h[1]=c.translateRegion(1,b-f-1,q-1,q-1+g),h[2]=c.translateRegion(2,b-f-2,q-2,q-2+g),w=25,f=0;3>f;f++){var z=c.svg.selectAll(".aa"+f).data(h[f],keyID).attr("transform",function(a,b){return"translate("+(c.xScale(a.pos)-p)+","+w+")"}).each(function(a){d3.select(this).select("rect").attr("width",n);g<c.dispCutoff?0==d3.select(this).select("text").size()?d3.select(this).append("text").attr("x",v).attr("font-size",d).text(function(a){return a.aa}):d3.select(this).select("text").attr("x",
v).attr("font-size",d):d3.select(this).select("text").remove()});q=z.enter().append("g").attr("class","aa"+f).attr("transform",function(a,b){return"translate("+(c.xScale(a.pos)-p)+","+w+")"});q.each(function(a){d3.select(this).append("rect").attr("y",-10).attr("height",10).attr("width",n).attr("stroke",c.colorAA).attr("fill",c.colorAA);g<c.dispCutoff&&d3.select(this).append("text").attr("x",v).attr("font-size",d).text(function(a){return a.aa})});z.exit().remove();w+=11}w="both"==c.strands?80:45;if("both"==
c.strands||"-"==c.strands)for(f=b%3,q=a-f,h=[],h[0]=c.translateRegion(0,b-f,q+g,q),h[1]=c.translateRegion(1,b-f-1,q-1+g,q-1),h[2]=c.translateRegion(2,b-f-2,q-2+g,q-2),f=0;3>f;f++)z=c.svg.selectAll(".aarev"+f).data(h[f],keyID).attr("transform",function(a,b){return"translate("+(c.xScale(a.pos)-p)+","+w+")"}).each(function(a){d3.select(this).select("rect").attr("width",n);g<c.dispCutoff?0==d3.select(this).select("text").size()?d3.select(this).append("text").attr("x",v).attr("font-size",d).text(function(a){return a.aa}):
d3.select(this).select("text").attr("x",v).attr("font-size",d):d3.select(this).select("text").remove()}),q=z.enter().append("g").attr("class","aarev"+f).attr("transform",function(a,b){return"translate("+c.xScale(a.pos)+","+w+")"}),q.each(function(a){d3.select(this).append("rect").attr("y",-10).attr("height",10).attr("width",n).attr("stroke",c.colorAA).attr("fill",c.colorAA);g<c.dispCutoff&&d3.select(this).append("text").attr("x",v).attr("font-size",d).text(function(a){return a.aa})}),z.exit().remove(),
w+=11;"both"==c.strands?c.svg.attr("height",125):c.svg.attr("height",75)}else"both"==c.strands?c.svg.attr("height",45):c.svg.attr("height",30)}else c.updateData(0);$("li.draggable"+c.gsvg.levelNumber+"#li"+c.trackClass).show()}else c.svg.attr("height",0),$("li.draggable"+c.gsvg.levelNumber+"#li"+c.trackClass).hide()}};c.draw=function(b){c.redrawSelectedArea();var a=c.xScale.domain()[0],g=c.xScale.domain()[1]-a,d="";1==c.includeAA&&(d=" and Amino Acids");"both"==c.strands?c.label=c.labelBase+d+" on +/- strands":
"+"==c.strands?c.label=c.labelBase+d+" on + strand":"-"==c.strands&&(c.label=c.labelBase+d+" on - strand");g<=c.aaDispCutoff&&1==c.includeAA||g<=c.dispCutoff||(c.label="");c.updateLabel(c.label);c.data=new String(b);var p="10px";200<g&&(p="8px");if(c.data&&g<=c.aaDispCutoff&&1==c.includeAA||g<=c.dispCutoff){d=a-c.seqRegionMin;var m=g+d,h=c.gsvg.width/g;c.svg.selectAll("text.dir").remove();"both"==c.strands?(c.svg.append("text").attr("class","dir").attr("x",5).attr("y",15).text("--\x3e"),c.svg.append("text").attr("class",
"dir").attr("x",5).attr("y",120).text("<--"),c.svg.append("text").attr("class","dir").attr("x",c.gsvg.width-60).attr("y",15).text("--\x3e"),c.svg.append("text").attr("class","dir").attr("x",c.gsvg.width-20).attr("y",120).text("<--")):"+"==c.strands?(c.svg.append("text").attr("class","dir").attr("x",5).attr("y",15).text("--\x3e"),c.svg.append("text").attr("class","dir").attr("x",c.gsvg.width-60).attr("y",15).text("--\x3e")):"-"==c.strands&&(c.svg.append("text").attr("class","dir").attr("x",5).attr("y",
15).text("<--"),c.svg.append("text").attr("class","dir").attr("x",c.gsvg.width-60).attr("y",15).text("<--"));if(g<c.dispCutoff&&1<b.length){for(var e=[],q=d;q<m;q++)e[q-d]=[],e[q-d].base=b.charAt(q),e[q-d].id=q,e[q-d].pos=q-d;q=c.textSize(g);var f=c.yPosition(g),l=27;1==c.includeAA&&"-"!=c.strands&&(l+=30);e=c.svg.selectAll(".base").data(e,keyID).attr("transform",function(a,b){return"translate("+a.pos*h+","+l+")"});b=e.enter().append("g").attr("class","base").attr("transform",function(a,b){return"translate("+
a.pos*h+","+l+")"});b.each(function(a){d3.select(this).append("text").text(function(b){return"-"!=c.strands?a.base:c.complement(a.base)});"both"==c.strands&&d3.select(this).append("text").attr("class","comp").attr("y",f).text(function(b){return c.complement(a.base)})});e.exit().remove();e.selectAll("text").attr("font-size",q)}else c.svg.append("g").attr("class","base").append("line").attr("stroke","#000000").attr("x1",0).attr("y1",57).attr("x2",c.gsvg.width).attr("y2",57);if(c.data&&1==c.includeAA){var n=
3*h,v=n/2-4,w=25;if("both"==c.strands||"+"==c.strands)for(q=a%3,b=d-q,e=[],e[0]=c.translateRegion(0,a-q,b,b+g),e[1]=c.translateRegion(1,a-q-2,b-2,b-2+g),e[2]=c.translateRegion(2,a-q-1,b-1,b-1+g),w=25,q=0;3>q;q++)m=c.svg.selectAll(".aa"+q).data(e[q],keyID).attr("transform",function(a,b){return"translate("+c.xScale(a.pos)+","+w+")"}).each(function(a){d3.select(this).select("rect").attr("width",n);g<c.dispCutoff?0==d3.select(this).select("text").size()?d3.select(this).append("text").attr("x",v).attr("font-size",
p).text(function(b){return a.aa}):d3.select(this).select("text").attr("x",v).attr("font-size",p):d3.select(this).select("text").remove()}),m.enter().append("g").attr("class","aa"+q).attr("transform",function(a,b){return"translate("+c.xScale(a.pos)+","+w+")"}).each(function(a){d3.select(this).append("rect").attr("y",-10).attr("height",10).attr("width",n).attr("stroke",c.colorAA(a)).attr("fill",c.colorAA(a));g<c.dispCutoff&&d3.select(this).append("text").attr("x",v).attr("font-size",p).text(function(){return a.aa})}),
m.exit().remove(),w+=11;w="both"==c.strands?80:45;if("both"==c.strands||"-"==c.strands)for(q=a%3,b=d-q,e=[],e[0]=c.translateRegion(0,a-q,b+g,b),e[1]=c.translateRegion(1,a-q-1,b-1+g,b-1),e[2]=c.translateRegion(2,a-q-2,b-2+g,b-2),q=0;3>q;q++)m=c.svg.selectAll(".aarev"+q).data(e[q],keyID).attr("transform",function(a,b){return"translate("+c.xScale(a.pos)+","+w+")"}),b=m.enter().append("g").attr("class","aarev"+q).attr("transform",function(a,b){return"translate("+c.xScale(a.pos)+","+w+")"}),b.each(function(a){d3.select(this).append("rect").attr("y",
-10).attr("height",10).attr("width",n).attr("stroke",c.colorAA(a)).attr("fill",c.colorAA(a));g<c.dispCutoff&&d3.select(this).append("text").attr("x",v).attr("font-size",p).text(function(b){return a.aa})}),m.exit().remove(),w+=11;"both"==c.strands?c.svg.attr("height",125):c.svg.attr("height",75)}else"both"==c.strands?c.svg.attr("height",45):c.svg.attr("height",30);c.prevStrand=c.strands;c.prevIncldAA=c.includeAA;$("li.draggable"+c.gsvg.levelNumber+"#li"+c.trackClass).show()}else c.svg.attr("height",
0),$("li.draggable"+c.gsvg.levelNumber+"#li"+c.trackClass).hide()};c.textSize=function(b){var a="9px";100>=b?a="11px":150>=b?a="8px":200>=b?a="6.8px":250>=b?a="5.8px":300>=b&&(a="4.8px");return a};c.yPosition=function(b){var a=12;100>=b?a=12:150>=b?a=10:200>=b?a=8:250>=b?a=6:300>=b&&(a=5);return a};c.updateData=function(b){var a=(new Date).getTime();if(25E3<a-c.lastUpdate||0<b)0===b&&(0===c.lastUpdate||25E3>a-c.lastUpdate)&&(c.tmpseqRegionMin=c.xScale.domain()[0]-c.seqRegionSize,c.tmpseqRegionMax=
c.xScale.domain()[1]+c.seqRegionSize,0>c.tmpseqRegionMin&&(c.tmpseqRegionMin=0)),c.xScale.domain()[1]-c.xScale.domain()[0]<c.aaDispCutoff&&(c.lastUpdate=a,c.svg&&30>c.svg.attr("height")&&c.svg.attr("height",30),0===b&&c.showLoading(),d3.text(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.gsvg.folderName+"/"+c.tmpseqRegionMin+"_"+c.tmpseqRegionMax+".seq",function(a,d){if(a){if(0===b){var g="/"+pathPrefix;pathPrefix||(g="");$.ajax({url:g+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,
data:{chromosome:chr,minCoord:c.tmpseqRegionMin,maxCoord:c.tmpseqRegionMax,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:c.trackClass,folder:c.gsvg.folderName},dataType:"json",success:function(a){ga&&ga("send","event","browser","generateTrackSequence")},error:function(a,b,c){}})}3>b?(g=1E4,1===b&&(g=15E3),setTimeout(function(){c.updateData(b+1)},g)):(c.seqRegionMin=0,c.seqRegionMax=0,c.hideLoading(),d3.select("#Level"+c.gsvg.levelNumber+
c.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+c.trackClass),d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).attr("height",15),c.gsvg.addTrackErrorRemove(c.svg,"#Level"+c.gsvg.levelNumber+c.trackClass),c.lastUpdate=0)}else c.seqRegionMin=c.tmpseqRegionMin,c.seqRegionMax=c.tmpseqRegionMax,c.hideLoading(),c.draw(d),c.lastUpdate=0,setTimeout(function(){DisplayRegionReport()},300)}))};c.updateSettingsFromUI=function(){0<$("#"+c.trackClass+c.level+"Select").length&&(c.strands=
$("#"+c.trackClass+c.level+"Select").val());0<$("#"+c.trackClass+"CBX"+c.level+"dispAA").length&&($("#"+c.trackClass+"CBX"+c.level+"dispAA").is(":checked")?c.includeAA=1:c.includeAA=0)};c.savePrevious=function(){c.prevSetting={};c.prevSetting.strands=c.strands;c.prevSetting.includeAA=c.includeAA};c.revertPrevious=function(){c.strands=c.prevSetting.strands;c.includeAA=c.prevSetting.includeAA};c.generateTrackSettingString=function(){return c.trackClass+","+c.strands+","+c.includeAA+";"};c.generateSettingsDiv=
function(b){var a=trackInfo[c.trackClass];c.savePrevious();d3.select(b).select("table").select("tbody").html("");if(0<a.Controls.length&&"null"!=a.Controls){var g=(new String(a.Controls)).split(",");b=d3.select(b).select("table").select("tbody");b.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+a.Name);for(a=0;a<g.length;a++)if(g[a]&&""!=g[a]){var d=g[a].split(";"),p=b.append("tr").append("td"),m=d[0].substr(5);3<d.length&&0===d[3].indexOf("Default=")&&d[3].substr(8);
if(0===d[1].toLowerCase().indexOf("select")){p.append("text").text(m+": ");m=d[1].split(":");d=d[2].split("}");for(var h=c.trackClass+c.level+"Select",e=p.append("select").attr("id",h).attr("name",m[1]),q=0;q<d.length;q++){var f=d[q].substr(1).split(":");2==f.length&&(p=e.append("option").attr("value",f[1]).text(f[0]),f[1]==c.strands&&p.attr("selected","selected"))}d3.select("select#"+h).on("change",function(){c.updateSettingsFromUI();c.redraw()})}else if(0===d[1].toLowerCase().indexOf("cbx"))for(p.append("text").text(m),
m=d[1].split(":"),d=d[2].split("}"),q=0;q<d.length;q++)if(f=d[q].substr(1).split(":"),2===f.length){h=p.append("div").style("display","inline-block");var l="",n="";2<m.length&&(n=m[2]);3<m.length&&(l=m[3]);e=h.append("input").attr("type","checkbox").attr("id",c.trackClass+n+"CBX"+c.level+l).attr("name",m[1]).style("margin-left","5px");h.append("text").text(f[0]);1==c.includeAA?$("#"+c.trackClass+n+"CBX"+c.level+l).prop("checked",!0):$("#"+c.trackClass+n+"CBX"+c.level+l).prop("checked",!1);d3.select("input#"+
c.trackClass+n+"CBX"+c.level+l).on("change",function(){c.updateSettingsFromUI();c.redraw()})}}g=b.append("tr").append("td");g.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");c.gsvg.removeTrack(c.trackClass);c.gsvg.setCurrentViewModified();var a=svgList[c.gsvg.levelNumber].currentView.ViewID,b=viewMenu[c.gsvg.levelNumber].findTrackByClass(c.trackClass,a);b=viewMenu[c.gsvg.levelNumber].findTrackIndexWithViewID(b.TrackID,
a);viewMenu[c.gsvg.levelNumber].removeTrackWithIDIdx(b,a)});g.append("input").attr("type","button").attr("value","Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");c.strands==c.prevSetting.strands&&c.includeAA==c.prevSetting.includeAA||c.gsvg.setCurrentViewModified()});g.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){c.revertPrevious();c.draw(c.data);
$("#trackSettingDialog").fadeOut("fast")})}else b=d3.select(b).select("table").select("tbody"),b.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+a.Name),b.append("tr").append("td").html("Sorry no settings for this track."),g=b.append("tr").append("td"),g.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")}),g.append("input").attr("type","button").attr("value",
"Cancel").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")})};c.createCodon();c.updateData(0);c.draw(n);return c}
function GeneTrack(f,e,l,n,c){var b=Track(f,e,l,n);b.counts=[{value:0,names:"Ensembl"},{value:0,names:"Brain RNA-Seq"}];f=new String(c);b.drawAs="Gene";b.trxCutoff=1E5;f=new String(c);b.xScale.domain();b.xScale.domain();-1<f.indexOf("DrawTrx")&&(b.drawAs="Trx");b.density=3;b.dataVer=0;b.reqDataVer=0;b.ttTrackList=[];-1===b.trackClass.indexOf("smallnc")?(b.ttTrackList.push("ensemblcoding"),b.ttTrackList.push("braincoding"),b.ttTrackList.push("brainTotal"),b.ttTrackList.push("liverTotal"),b.ttTrackList.push("heartTotal"),
b.ttTrackList.push("mergedTotal"),b.ttTrackList.push("refSeq"),b.ttTrackList.push("ensemblnoncoding"),b.ttTrackList.push("brainnoncoding")):(b.ttTrackList.push("ensemblsmallnc"),b.ttTrackList.push("brainsmallnc"),b.ttTrackList.push("liversmallnc"),b.ttTrackList.push("heartsmallnc"),b.ttTrackList.push("refSeq"));b.ttTrackList.push("repeatMask");b.ttTrackList.push("snpSHRH");b.ttTrackList.push("snpBNLX");b.ttTrackList.push("snpF344");b.ttTrackList.push("snpSHRJ");"braincoding"===l?(b.ttTrackList.push("spliceJnct"),
b.ttTrackList.push("illuminaPolyA")):0===l.indexOf("liverTotal")?(b.ttTrackList.push("liverspliceJnct"),b.ttTrackList.push("liverilluminaTotalPlus"),b.ttTrackList.push("liverilluminaTotalMinus")):"heartTotal"===l?(b.ttTrackList.push("heartspliceJnct"),b.ttTrackList.push("heartilluminaTotalPlus"),b.ttTrackList.push("heartilluminaTotalMinus")):0===l.indexOf("brainTotal")?(b.ttTrackList.push("brainspliceJnct"),b.ttTrackList.push("brainilluminaTotalPlus"),b.ttTrackList.push("brainilluminaTotalMinus")):
"brainsmallnc"===l?b.ttTrackList.push("illuminaSmall"):"heartsmallnc"===l?b.ttTrackList.push("heartilluminaSmall"):"liversmallnc"===l&&b.ttTrackList.push("liverilluminaSmall");b.pieColorPalette=d3.scaleOrdinal(d3.schemeCategory20);b.cleanID=function(a){return a=a.replace(/\./g,"_")};b.color=function(a){var c="#000000";"ensemblcoding"===b.trackClass?c="#DFC184":"braincoding"===b.trackClass?(c="#7EB5D6",null!==a.getAttribute("strain")&&"undefined"!==typeof a.getAttribute("strain")&&"All"!==a.getAttribute("strain")&&
(c=b.strainSpecColor(c,a))):"ensemblnoncoding"===b.trackClass?c="#B58AA5":"brainnoncoding"===b.trackClass?(c="#CECFCE",null!==a.getAttribute("strain")&&"undefined"!==typeof a.getAttribute("strain")&&"BNLX"===a.getAttribute("strain").toUpperCase()?c="#3E75FF":null===a.getAttribute("strain")||"undefined"===typeof a.getAttribute("strain")||"SHR"!==a.getAttribute("strain").toUpperCase()&&"SHRH"!==a.getAttribute("strain").toUpperCase()||(c="#FE7596")):"ensemblsmallnc"===b.trackClass?c="#FFCC00":"brainsmallnc"===
b.trackClass?(c="#3E7596",null!==a.getAttribute("strain")&&"undefined"!==typeof a.getAttribute("strain")&&"All"!==a.getAttribute("strain")&&(c=b.strainSpecColor(c,a))):0===b.trackClass.indexOf("liverTotal")?(c="#bbbedd",0<b.trackClass.indexOf("_F344Stm")?c="#abaefd":0<b.trackClass.indexOf("_LEStm")&&(c="#dbaecd"),null!==a.getAttribute("strain")&&"undefined"!==typeof a.getAttribute("strain")&&"All"!==a.getAttribute("strain")&&(c=b.strainSpecColor(c,a))):"heartTotal"===b.trackClass?(c="#DC7252",null!==
a.getAttribute("strain")&&"undefined"!==typeof a.getAttribute("strain")&&"All"!==a.getAttribute("strain")&&(c=b.strainSpecColor(c,a))):0===b.trackClass.indexOf("brainTotal")?(c="#7EB5D6",0<b.trackClass.indexOf("_F344Stm")?c="#6EA5F6":0<b.trackClass.indexOf("_LEStm")&&(c="#9EA5C6"),null!==a.getAttribute("strain")&&"undefined"!==typeof a.getAttribute("strain")&&"All"!==a.getAttribute("strain")&&(c=b.strainSpecColor(c,a))):"liversmallnc"===b.trackClass?(c="#7b7e9d",null!==a.getAttribute("strain")&&"undefined"!==
typeof a.getAttribute("strain")&&"All"!==a.getAttribute("strain")&&(c=b.strainSpecColor(c,a))):"heartsmallnc"===b.trackClass?(c="#9C3212",null!==a.getAttribute("strain")&&"undefined"!==typeof a.getAttribute("strain")&&"All"!==a.getAttribute("strain")&&(c=b.strainSpecColor(c,a))):"mergedTotal"===b.trackClass&&(c="#9F4F92");return c=d3.rgb(c)};b.strainSpecColor=function(a,b){var c=parseInt(a.substr(1,2),16),g=parseInt(a.substr(3,2),16),m=parseInt(a.substr(5),16);"BNLX"===b.getAttribute("strain").toUpperCase()?
(m+=64,c-=32,g-=32):"SHR"===b.getAttribute("strain").toUpperCase()||"SHRH"===b.getAttribute("strain").toUpperCase()?(c+=64,m-=32,g-=32):"F344_ST"===b.getAttribute("strain").toUpperCase()?(m+=32,c-=16,g-=16):"LE_ST"===b.getAttribute("strain").toUpperCase()&&(c+=32,m-=16,g-=16);255<c&&(c=255);255<g&&(g=255);255<m&&(m=255);return"#"+c.toString(16)+g.toString(16)+m.toString(16)};b.pieStrainSpecColor=function(a,b){var c=parseInt(a.substr(1,2),16),g=parseInt(a.substr(3,2),16),m=parseInt(a.substr(5),16);
if("BNLX"===b.toUpperCase())m+=64,c-=32,g-=32;else if("SHR"===b.toUpperCase()||"SHRH"===b.toUpperCase())c+=64,m-=32,g-=32;255<c&&(c=255);255<g&&(g=255);255<m&&(m=255);return a="#"+c.toString(16)+g.toString(16)+m.toString(16)};b.pieColor=function(a,c){var d="#000000";"ensemblcoding"===b.trackClass?d="#DFC184":"braincoding"===b.trackClass?d=b.pieStrainSpecColor("#7EB5D6",a.data.names):"ensemblnoncoding"===b.trackClass?d="#B58AA5":"brainnoncoding"===b.trackClass?(d="#CECFCE",null!==a.data.names&&"undefined"!==
typeof a.data.names&&"BNLX"===a.data.names.toUpperCase()?d="#3E75FF":null===a.data.names||"undefined"===typeof a.data.names||"SHR"!==a.data.names.toUpperCase()&&"SHRH"!==a.data.names.toUpperCase()||(d="#FE7596")):"ensemblsmallnc"===b.trackClass?d=b.pieColorPalette(a.data.names):"brainsmallnc"===b.trackClass?d=b.pieStrainSpecColor("#99CC99",a.data.names):0===b.trackClass.indexOf("liverTotal")?d=b.pieStrainSpecColor("#bbbedd",a.data.names):"heartTotal"===b.trackClass?d=b.pieStrainSpecColor("#DC7252",
a.data.names):0===b.trackClass.indexOf("brainTotal")?d=b.pieStrainSpecColor("#7EB5D6",a.data.names):"liversmallnc"===b.trackClass?d=b.pieStrainSpecColor("#8b8ead",a.data.names):"heartsmallnc"===b.trackClass?d=b.pieStrainSpecColor("#BC5232",a.data.names):"mergedTotal"===b.trackClass&&(d="#9F4F92");return d=d3.rgb(d)};b.getDisplayID=function(a){-1<b.trackClass.indexOf("smallnc")||-1<a.indexOf("_")&&(a=a.substr(a.indexOf("_")+1));return a};b.createToolTip=function(a){var c="";if(-1<b.trackClass.indexOf("smallnc")){c=
"Known - "+a.getAttribute("biotype");var d=".";1==a.getAttribute("strand")?d="+":-1==a.getAttribute("strand")&&(d="-");if(0===(new String(a.getAttribute("ID"))).indexOf("P")){var p=getAllChildrenByName(getFirstChildByName(a,"TranscriptList"),"Transcript");getAllChildrenByName(getFirstChildByName(a,"StrainQuantList"),"Strains")[1].getAttribute("strain");c=p[0].getAttribute("category")+" - "+p[0].getAttribute("source")}p='<BR><div id="ttSVG" style="background:#FFFFFF;"></div>ID: '+a.getAttribute("ID");
-1===b.trackClass.indexOf("ensembl")&&(p=p+"<BR>PhenoGen ID: "+a.getAttribute("intGeneID"));p=p+"<BR>Length: "+(a.getAttribute("stop")-a.getAttribute("start"))+"<BR>Type:"+c+"<BR>Location: "+a.getAttribute("chromosome")+":"+numberWithCommas(a.getAttribute("start"))+"-"+numberWithCommas(a.getAttribute("stop"))+"<BR>Strand: "+d+"<BR>"}else{var m=a.getAttribute("ID");m=b.getDisplayID(m);var h="";a.getAttribute("geneSymbol")?h=a.getAttribute("geneSymbol"):a.parent&&a.parent.getAttribute("geneSymbol")&&
(h=a.parent.getAttribute("geneSymbol"));d=".";1==a.getAttribute("strand")?d="+":-1==a.getAttribute("strand")&&(d="-");if(a.parent){p=getAllChildrenByName(getFirstChildByName(a.parent,"TranscriptList"),"Transcript");for(var e=0;e<p.length;e++){var q=new String(p[e].getAttribute("ID"));m!=q&&(-1<(new String(p[e].getAttribute("ID"))).indexOf("ENS")?c+="<B>"+q+"</B>":(c+="<B>"+q+"</B>",-1==(new String(p[e].getAttribute("ID"))).indexOf("ENS")&&(q=getFirstChildByName(getFirstChildByName(p[e],"annotationList"),
"annotation"),null!=q&&(c+=" - "+q.getAttribute("reason")))),c+="<br>");if(""==h){q=getAllChildrenByName(getFirstChildByName(p[e],"annotationList"),"annotation");for(var f=0;f<q.length&&""==h;f++)"AKA"==q[f].getAttribute("source")&&(h=q[f].getAttribute("annot_value"),h=(new String(h)).split(":"),h=0!=(new String(h[h.length-1])).indexOf("ENS")?h[h.length-1]:h[0])}}p='<BR><div id="ttSVG" style="background:#FFFFFF;overflow:"></div><BR>Transcript ID: '+m+"<BR>Location: "+a.getAttribute("chromosome")+
":"+numberWithCommas(a.getAttribute("start"))+"-"+numberWithCommas(a.getAttribute("stop"))+"<BR>Strand: "+d;p=p+"<BR><BR>Gene Symbol: "+h+"<BR>Gene ID: "+b.getDisplayID(a.parent.getAttribute("ID"))+"<BR><BR>Other Transcripts:<BR>"+c+"<BR>"}else{p=getAllChildrenByName(getFirstChildByName(a,"TranscriptList"),"Transcript");for(e=0;e<p.length;e++)if(q=new String(p[e].getAttribute("ID")),-1<(new String(p[e].getAttribute("ID"))).indexOf("ENS")?c+="<B>"+q+"</B>":(c+="<B>"+q+"</B>",-1===(new String(p[e].getAttribute("ID"))).indexOf("ENS")&&
(q=getFirstChildByName(getFirstChildByName(p[e],"annotationList"),"annotation"),null!=q&&(c+=" - "+q.getAttribute("reason")))),c+="<br>",0===h.length)for(q=getAllChildrenByName(getFirstChildByName(p[e],"annotationList"),"annotation"),f=0;f<q.length&&0===h.length;f++)"AKA"===q[f].getAttribute("source")&&(h=q[f].getAttribute("annot_value"),h=(new String(h)).split(":"),h=0!==(new String(h[h.length-1])).indexOf("ENS")?h[h.length-1]:h[0]);p='<BR><div id="ttSVG" style="background:#FFFFFF;overflow:scroll;max-height:400px;"></div>Gene ID: '+
m+"<BR>Gene Symbol: "+h+"<BR>Location: "+a.getAttribute("chromosome")+":"+numberWithCommas(a.getAttribute("start"))+"-"+numberWithCommas(a.getAttribute("stop"))+"<BR>Strand: "+d+"<BR><BR>Transcripts:<BR>"+c+"<BR>"}"brainTotal"!==b.trackClass&&"liverTotal"!==b.trackClass||!(-1<a.getAttribute("ID").indexOf("PRN6T")||-1<a.getAttribute("ID").indexOf("PRN6G"))||(d="Gene",-1<a.getAttribute("ID").indexOf("PRN6T")&&(d="Transcript"),p=p+'<div>Heritability: <span id="ttsingleHerit"></span></div>'+d+' Expression:<BR><div style="text-align:center;">Median Estimated Counts Per Million</div><div id="ttChart"></div>',
c="Brain",m="Whole Brain","liverTotal"===b.trackClass&&(m=c="Liver"),tmpChart=chart({data:"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/"+c+"expr.json",selector:"#ttChart",allowResize:!1,type:"scatter",width:"400",height:"275",displayHerit:!1,displayControls:!1,title:d+" Expression",titlePrefix:m,filterID:a.getAttribute("ID")}))}return p};b.redraw=function(){b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(var a=0;a<b.gsvg.width;a++)b.yMaxArr[a]=0,b.yArr[0][a]=0;b.trackYMax=0;a=b.xScale.domain()[0];
a=b.xScale.domain()[1]-a;var c=0;if(b.reqDataVer!==b.dataVer)b.updateDataVersion(b.reqDataVer,0);else if("undefined"!==typeof b.prevSetting&&b.prevSetting.density!==b.density)b.draw(b.data);else if(a<b.trxCutoff&&"Gene"===b.drawnAs||a>=b.trxCutoff&&"Trx"===b.drawnAs&&"Trx"!==b.drawAs||"Gene"===b.drawnAs&&$("#forceTrxCBX"+b.gsvg.levelNumber).is(":checked"))b.draw(b.data);else if(a<b.trxCutoff&&"Trx"===b.drawnAs&&"Trx"!==b.drawAs&&(c=1),"Gene"===b.drawAs&&0===c||-1<b.trackClass.indexOf("smallnc"))b.svg&&
(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").attr("transform",function(a,c){return"translate("+b.xScale(a.getAttribute("start"))+","+b.calcY(parseInt(a.getAttribute("start"),10),parseInt(a.getAttribute("stop"),10),c)+")"}),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene rect").attr("width",function(a){var c=1;1<b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start"))&&(c=b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start")));
return c}).attr("stroke",b.colorStroke),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").each(function(a){var c=d3.select(this),d=parseInt(a.getAttribute("strand"),10);if(-1===d||1===d){var g=">";-1===d&&(g="<");d="";var e=c.select("rect").attr("width");if(8.3<=e&&15.8>=e)d=g;else for(;8.5<e;)d+=g,e-=8.5;c.select("text#strandTxt").text(d)}if(2===b.density){var q=a.getAttribute("ID");a.getAttribute("geneSymbol")&&0<a.getAttribute("geneSymbol").length&&(q=q+" ("+a.getAttribute("geneSymbol")+
")");0===c.select("text#lblTxt").size()?c.append("svg:text").attr("dx",function(){var c=b.xScale(a.getAttribute("start"));return c=c<$(window).width()/2?b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start"))+5:-9*q.length}).attr("dy",10).attr("id","lblTxt").text(q):c.select("text#lblTxt").attr("dx",function(){var c=b.xScale(a.getAttribute("start"));return c=c<$(window).width()/2?b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start"))+5:-9*q.length})}else c.select("text#lblTxt").remove()})),
1===b.density?b.svg.attr("height",30):2===b.density?b.svg.attr("height",15*(b.trackYMax+1)):3===b.density&&b.svg.attr("height",15*(b.trackYMax+1));else if(1===c||"Trx"===b.drawAs)b.svg.selectAll(".trx"+b.gsvg.levelNumber).attr("transform",function(a,c){return"translate(0,"+b.calcY(parseInt(a.getAttribute("start"),10),parseInt(a.getAttribute("stop"),10),c)+")"}).each(function(a,c){var d=parseInt(a.getAttribute("start"),10),g=parseInt(a.getAttribute("stop"),10);a.getAttribute("cdsStart")&&a.getAttribute("cdsStop")&&
(d=parseInt(a.getAttribute("cdsStart"),10),g=parseInt(a.getAttribute("cdsStop"),10));exList=getAllChildrenByName(getFirstChildByName(a,"exonList"),"exon");var p="";1===b.gsvg.levelNumber?p="tx":99===b.gsvg.levelNumber&&(p="ttTx");for(var e=0;e<exList.length;e++){var f=exList[e].getAttribute("start"),l=exList[e].getAttribute("stop");if(f<d&&d<l||l>g&&g>f){var n=f,v=d;l>g?(n=g,v=l,l=g):f=d;d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g#"+p+b.cleanID(a.getAttribute("ID"))+b.gsvg.levelNumber+
" rect#ExNC"+exList[e].getAttribute("ID")).attr("x",function(a){return b.xScale(n)}).attr("width",function(a){return b.xScale(v)-b.xScale(n)})}d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g#"+p+b.cleanID(a.getAttribute("ID"))+b.gsvg.levelNumber+" rect#Ex"+exList[e].getAttribute("ID")).attr("x",function(a){return b.xScale(f)}).attr("width",function(a){return b.xScale(l)-b.xScale(f)});if(0<e){var w=">";"-1"==a.getAttribute("strand")&&(w="<");var z=w,E=b.xScale(exList[e-1].getAttribute("stop")),
F=b.xScale(exList[e].getAttribute("start")),B=F-E,D=0;if(7>B||"0"==a.getAttribute("strand")||"."==a.getAttribute("strand"))z="";else for(B-=7;8<B;)0===D?(z+=" ",D=1):(z+=w,D=0),B-=7;d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g.trx"+b.gsvg.levelNumber+"#"+p+b.cleanID(a.getAttribute("ID"))+b.gsvg.levelNumber+" line#Int"+exList[e-1].getAttribute("ID")+"_"+exList[e].getAttribute("ID")).attr("x1",E).attr("x2",F);d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g.trx"+b.gsvg.levelNumber+"#"+
p+b.cleanID(a.getAttribute("ID"))+b.gsvg.levelNumber+" #IntTxt"+exList[e-1].getAttribute("ID")+"_"+exList[e].getAttribute("ID")).attr("dx",E+1).text(z)}}if(2===b.density){var C=a.getAttribute("ID");a.getAttribute("geneSymbol")&&0<a.getAttribute("geneSymbol").length&&(C=C+" ("+a.getAttribute("geneSymbol")+")");0===d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g.trx"+b.gsvg.levelNumber+"#"+p+b.cleanID(a.getAttribute("ID"))+b.gsvg.levelNumber+" text#lblTxt").size()?d3.select("#Level"+b.gsvg.levelNumber+
b.trackClass+" g.trx"+b.gsvg.levelNumber+"#"+p+b.cleanID(a.getAttribute("ID"))+b.gsvg.levelNumber).append("svg:text").attr("dx",function(){var c=b.xScale(a.parent.getAttribute("start"));return c=c<$(window).width()/2?b.xScale(a.parent.getAttribute("stop"))-b.xScale(a.parent.getAttribute("start"))+5:-9*C.length}).attr("dy",10).attr("id","lblTxt").text(C):d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g.trx"+b.gsvg.levelNumber+"#"+p+b.cleanID(a.getAttribute("ID"))+b.gsvg.levelNumber+" text#lblTxt").attr("dx",
function(){var c=b.xScale(a.getAttribute("start"));return c=c<$(window).width()/2?b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start"))+5:-9*C.length})}else d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g.trx"+b.gsvg.levelNumber+"#"+p+b.cleanID(a.getAttribute("ID"))+b.gsvg.levelNumber+" text#lblTxt").remove()}),1===b.density?b.svg.attr("height",30):2===b.density?b.svg.attr("height",15*(b.trackYMax+1)):3===b.density&&b.svg.attr("height",15*(b.trackYMax+1));b.redrawSelectedArea()};
b.setSelected=function(a){if(a)if(0<d3.selectAll("g.gene").size()){if(d3.selectAll("rect.selected").each(function(){d3.select(this).attr("class","").style("fill",b.color)}),a=d3.select("g.gene rect#"+a))a.attr("class","selected").style("fill","green"),b.setupDetailedView(a.data()[0]),selectGene=""}else if(0<d3.selectAll("g.trx"+b.gsvg.levelNumber).size()){var c=(new String(a)).replace(".","_");b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("line").style("stroke",b.color);b.svg.selectAll("g.trx"+
b.gsvg.levelNumber+".selected").selectAll("rect").style("fill",b.color);b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("text").style("opacity","0.6").style("fill",b.color);b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").each(function(){var a=new String($(this).attr("class"));a=a.replace(" selected","");$(this).attr("class",a)});b.svg.selectAll("g.gene"+c).each(function(){var a=$(this).attr("class")+" selected";$(this).attr("class",a)});b.svg.selectAll("g.gene"+c).selectAll("line").style("stroke",
"green");b.svg.selectAll("g.gene"+c).selectAll("rect").style("fill","green");b.svg.selectAll("g.gene"+c).selectAll("text").style("opacity","0.3").style("fill","green");b.svg.selectAll("g.gene"+c)&&((c=b.svg.selectAll("g.gene"+c).data())&&0<c.length?b.setupDetailedView(c[0].parent):(console.log("tmp[0]"),console.log(c),Rollbar.debug("tmp[0] is undefined.  tmp.length is "+c.length+":"+a+":"+b.gsvg.levelNumber+":"+b.trackClass)));selectGene=""}};b.clearSelection=function(){b.selectionStart=-1;b.selectionEnd=
-1;b.svg.selectAll("rect.selectedArea").remove();0<b.svg.selectAll("g.gene").size()?b.svg.selectAll("rect.selected").each(function(a){d3.select(this).attr("class","").style("fill",b.color)}):0<b.svg.selectAll("g.trx"+b.gsvg.levelNumber).size()&&(b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("line").style("stroke",b.color),b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("rect").style("fill",b.color),b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("text").style("opacity",
"0.6").style("fill",b.color),b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").each(function(){var a=new String($(this).attr("class"));a=a.replace(" selected","");$(this).attr("class",a)}))};b.setupDetailedView=function(a){if(a){b.gsvg.clearSelection();jQuery.Event("keyup").which=32;var c=b.gsvg.levelNumber+1;$("div#collapsableReport").is(":hidden")||($("div#collapsableReport").hide(),$("span[name='collapsableReport']").removeClass("less"));$("div#selectedDetailHeader").is(":hidden")&&$("div#selectedDetailHeader").show();
$("div#selectedDetail").is(":hidden")&&$("div#selectedDetail").show();var d="none";0===b.trackClass.indexOf("liverTotal")?d=b.trackClass:"heartTotal"===b.trackClass?d="heartTotal":0===b.trackClass.indexOf("brainTotal")?d=b.trackClass:"mergedTotal"===b.trackClass?d="mergedTotal":"protein_coding"===a.getAttribute("biotype")&&200<=a.getAttribute("stop")-a.getAttribute("start")?d="protein":"protein_coding"!==a.getAttribute("biotype")&&200<=a.getAttribute("stop")-a.getAttribute("start")?d="long":200>a.getAttribute("stop")-
a.getAttribute("start")&&(d="small");var p=0,m=0;if("protein"===d||"long"===d||0===d.indexOf("liverTotal")||"heartTotal"===d||0===d.indexOf("brainTotal")||"mergedTotal"===d||"small"===d&&"rn5"!==genomeVer||"small"===d&&-1<(new String(a.getAttribute("ID"))).indexOf("ENS")){console.log("totalType");p=a.getAttribute("ID");var h="";if(a.getAttribute("geneSymbol")&&0<a.getAttribute("geneSymbol").length)p=p+" ("+a.getAttribute("geneSymbol")+")";else{m=getAllChildrenByName(getFirstChildByName(a,"TranscriptList"),
"Transcript");for(var e=0;e<m.length&&""===h;e++)if(""===h)for(var f=getAllChildrenByName(getFirstChildByName(m[e],"annotationList"),"annotation"),l=0;l<f.length&&0===h.length;l++)if("AKA"===f[l].getAttribute("source")){var n=f[l].getAttribute("annot_value");n=(new String(n)).split(":");1<=n.length?(h=n[0],p=p+" ("+h+")"):2<=n.length&&(h=n[0],n=n[1],p=p+" ("+n+")")}}m=parseInt(a.getAttribute("start"),10);f=parseInt(a.getAttribute("stop"),10);a.getAttribute("extStart")&&a.getAttribute("extStop")&&
(m=parseInt(a.getAttribute("extStart"),10),f=parseInt(a.getAttribute("extStop"),10));svgViewIDList[c]||(svgViewIDList[c]=b.gsvg.currentView?b.gsvg.currentView.ViewID:defaultView);e=GenomeSVG("div#selectedImage",b.gsvg.width,m,f,c,p,"transcript");e.xMin=m-.05*(f-m);e.xMax=f+.05*(f-m);p=e.xMin;m=e.xMax;svgList[c]=e;svgList[c].txType=d;svgList[c].selectedData=a;selectedGeneSymbol=a.getAttribute("geneSymbol");selectedID=new String(a.getAttribute("ID"));-1===selectedID.indexOf("ENS")&&0<h.length&&(selectedID=
h);$("div#selectedImage").show();console.log("here");-1<(new String(selectedID)).indexOf("ENS")&&-1<b.trackClass.indexOf("ensembl")?(console.log("geneReport"),$("div#selectedReport").show(),c=pathPrefix+"geneReport.jsp",a={id:selectedID,geneSymbol:selectedGeneSymbol,chromosome:chr,species:organism,genomeVer:genomeVer},DisplaySelectedDetailReport(c,a)):"small"!==d?$("div#selectedReport").html("<BR><BR>Detailed Gene Reports are not currently provided for RNA-Seq(Cufflinks) generated genes that are novel and have not been matched to an existing annotated gene.  In the future overlapping probesets and SNPs will be summarized in the same manner.  This feature should be added by December 2014.  Please keep checking back or let us know you'd like to see it sooner."):
"rn6"===genomeVer&&(a=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/"+b.trackClass+".xml",c=pathPrefix+"smallRNAReport.jsp",a={dataPath:a,id:selectedID},DisplaySelectedDetailReport(c,a))}else"small"===d&&-1===(new String(a.getAttribute("ID"))).indexOf("ENS")&&"rn5"===genomeVer&&($("div#selectedImage").hide(),$("div#selectedReport").show(),p=a.getAttribute("start"),m=a.getAttribute("stop"),c=pathPrefix+"viewSmallNonCoding.jsp",a={id:a.getAttribute("ID"),name:"smRNA_"+
a.getAttribute("ID")},DisplaySelectedDetailReport(c,a));b.gsvg&&b.gsvg.selectSvg&&b.gsvg.selectSvg.changeSelection(p,m);$("html, body").animate({scrollTop:$("#selectedDetail").offset().top},200)}};b.getDisplayedData=function(){var a=[],c=0,d=[];if(-1<b.trackClass.indexOf("smallnc")){var p=0;b.counts=[];b.trackClass.indexOf("ensembl");"Gene"===b.drawnAs?d=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene"):"Trx"===b.drawnAs&&(d=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.trx"));
d.each&&d.each(function(d){var g=b.xScale(d.getAttribute("start")),h=b.xScale(d.getAttribute("stop"));if(0<=g&&g<=b.gsvg.width||0<=h&&h<=b.gsvg.width||0>=g&&h>=b.gsvg.width)g="Ensembl","undefined"!==typeof d.getAttribute("strain")?g=d.getAttribute("strain"):"undefined"!==typeof d.getAttribute("biotype")&&(g=d.getAttribute("biotype")),"undefined"===typeof b.counts[g]?(b.counts[g]={},b.counts[p]=b.counts[g],p++,b.counts[g].value=1,b.counts[g].names=g):b.counts[g].value++,a[c]=d,c++,m++})}else if("Gene"===
b.drawnAs)d=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene"),b.counts=[{value:0,names:"Ensembl"},{value:0,names:"Brain RNA-Seq"},{value:0,names:"Liver RNA-Seq"},{value:0,names:"Heart RNA-Seq"},{value:0,names:"Merged RNA-Seq"}],d.each(function(d){var g=b.xScale(d.getAttribute("start")),h=b.xScale(d.getAttribute("stop"));if(0<=g&&g<=b.gsvg.width||0<=h&&h<=b.gsvg.width)-1<(new String(d.childNodes[0].id)).indexOf("ENS")?b.counts[0].value++:-1<b.trackClass.indexOf("brain")?b.counts[1].value++:
-1<b.trackClass.indexOf("liver")?b.counts[2].value++:-1<b.trackClass.indexOf("heart")?b.counts[3].value++:-1<b.trackClass.indexOf("merged")&&b.counts[4].value++,a[c]=d,c++}),0===d.size()&&(b.counts=[]);else if("Trx"===b.drawnAs){d=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.trx"+b.gsvg.levelNumber);b.counts=[];var m=p=0;d.each(function(d){var g=b.xScale(d.getAttribute("start")),h=b.xScale(d.getAttribute("stop"));if(0<=g&&g<=b.gsvg.width||0<=h&&h<=b.gsvg.width||0>=g&&h>=b.gsvg.width)g=
"Ensembl","undefined"!==typeof d.getAttribute("strain")&&(g=d.getAttribute("strain")),"undefined"===typeof b.counts[g]?(b.counts[g]={},b.counts[p]=b.counts[g],p++,b.counts[g].value=1,b.counts[g].names=g):b.counts[g].value++,a[c]=d,c++,m++})}return a};b.updateData=function(a){d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/"+b.trackClass+".xml",function(c,d){if(c){if(0===a&&(0===b.trackClass.indexOf("heartTotal")||0===b.trackClass.indexOf("liverTotal")||0===b.trackClass.indexOf("brainTotal")||
"mergedTotal"===b.trackClass||-1<b.trackClass.indexOf("smallnc"))){var g="/"+pathPrefix;pathPrefix||(g="");var m=b.trackClass,h=panel;(0===b.trackClass.indexOf("liverTotal")||0===b.trackClass.indexOf("brainTotal"))&&0<b.trackClass.indexOf("_")&&(h=track.substr(track.indexOf("_")+1),"LEStm"===h&&(h="LE-Stm"),"F344Stm"===h&&(h="F344-Stm"));$.ajax({url:g+"generateTrackXML.jsp",type:"GET",cache:!1,asyn:!0,data:{chromosome:chr,minCoord:b.gsvg.xScale.domain()[0],maxCoord:b.gsvg.xScale.domain()[1],panel:h,
rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:m,folder:b.gsvg.folderName},dataType:"json",success:function(a){ga&&ga("send","event","browser","generateTrackGene")},error:function(a,b,c){}})}10>a?(g=2E3,1===a&&(g=5E3),setTimeout(function(){b.updateData(a+1)},g)):(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+b.trackClass),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).attr("height",
15),b.gsvg.addTrackErrorRemove(b.svg,"#Level"+b.gsvg.levelNumber+b.trackClass))}else if(d){g=d.documentElement.getElementsByTagName("Gene");m=[];h=[];for(var e=0,f=0;f<g.length;f++)g[f]&&(m[e]=g[f],h[g[f].getAttribute("ID")]=1,e++);for(f=0;f<b.data.length;f++)b.data[f]&&!h[b.data[f].getAttribute("ID")]&&(m[e]=b.data[f],e++);b.draw(m);b.hideLoading();setTimeout(function(){DisplayRegionReport()},300)}else b.hideLoading()})};b.updateDataVersion=function(a,c){var d=b.trackClass+"_"+a;d3.xml(dataPrefix+
"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/"+d+".xml",function(g,m){if(g){if(0===c){var h="/"+pathPrefix;pathPrefix||(h="");var p=panel;(0===track.indexOf("liverTotal")||0===track.indexOf("brainTotal"))&&0<track.indexOf("_")&&(p=track.substr(track.indexOf("_")+1),"LEStm"===p&&(p="LE-Stm"),"F344Stm"===p&&(p="F344-Stm"));$.ajax({url:h+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:b.gsvg.xScale.domain()[0],maxCoord:b.gsvg.xScale.domain()[1],
panel:p,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:d,folder:b.gsvg.folderName},dataType:"json",success:function(a){ga&&ga("send","event","browser","generateTrackGene")},error:function(a,b,c){}})}5>c?(h=1E4,0===c&&(h=5E3),setTimeout(function(){b.updateDataVersion(a,c+1)},h)):(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+b.trackClass),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).attr("height",
15),b.gsvg.addTrackErrorRemove(b.svg,"#Level"+b.gsvg.levelNumber+b.trackClass))}else h=m.documentElement.getElementsByTagName("Gene"),p=parseInt(a),b.dataVer=p,b.draw(h),b.hideLoading(),setTimeout(function(){DisplayRegionReport()},300)})};b.drawTrx=function(a,c){var d=parseInt(a.getAttribute("start"),10),g=parseInt(a.getAttribute("stop"),10);a.getAttribute("cdsStart")&&a.getAttribute("cdsStop")&&(d=parseInt(a.getAttribute("cdsStart"),10),g=parseInt(a.getAttribute("cdsStop"),10));var m="";1===b.gsvg.levelNumber?
m="tx":99===b.gsvg.levelNumber&&(m="ttTx");m=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" #"+m+b.cleanID(a.getAttribute("ID"))+b.gsvg.levelNumber);exList=getAllChildrenByName(getFirstChildByName(a,"exonList"),"exon");for(var h=0;h<exList.length;h++){var e=parseInt(exList[h].getAttribute("start"),10),f=parseInt(exList[h].getAttribute("stop"),10);if(e<d&&d<f||f>g&&g>e){var l=0,n=0,y=0,v=0;e<d?(l=b.xScale(e),n=b.xScale(d)-b.xScale(e),y=b.xScale(d),v=b.xScale(f)-b.xScale(d)):f>g&&(y=b.xScale(e),
v=b.xScale(g)-b.xScale(e),l=b.xScale(g),n=b.xScale(f)-b.xScale(g));m.append("rect").attr("x",l).attr("y",2.5).attr("height",5).attr("width",n).attr("title",function(a){return exList[h].getAttribute("ID")}).attr("id",function(a){return"ExNC"+exList[h].getAttribute("ID")}).style("fill",b.color).style("cursor","pointer");m.append("rect").attr("x",y).attr("height",10).attr("width",v).attr("title",function(a){return exList[h].getAttribute("ID")}).attr("id",function(a){return"Ex"+exList[h].getAttribute("ID")}).style("fill",
b.color).style("cursor","pointer")}else{l=10;n=0;if(e<d&&f<d||f>g&&e>g)l=5,n=2.5;m.append("rect").attr("x",function(a){return b.xScale(exList[h].getAttribute("start"))}).attr("y",n).attr("id",function(a){return"Ex"+exList[h].getAttribute("ID")}).attr("height",l).attr("width",function(a){return b.xScale(exList[h].getAttribute("stop"))-b.xScale(exList[h].getAttribute("start"))}).attr("title",function(a){return exList[h].getAttribute("ID")}).style("fill",b.color).style("cursor","pointer")}if(0<h&&(m.append("line").attr("x1",
function(a){return b.xScale(exList[h-1].getAttribute("stop"))}).attr("x2",function(a){return b.xScale(exList[h].getAttribute("start"))}).attr("y1",5).attr("y2",5).attr("id",function(a){return"Int"+exList[h-1].getAttribute("ID")+"_"+exList[h].getAttribute("ID")}).attr("stroke",b.color).attr("stroke-width","2"),"1"==a.getAttribute("strand")||"-1"==a.getAttribute("strand"))){e=">";if("-1"==a.getAttribute("strand")||"-"==a.getAttribute("strand"))e="<";f=e;l=b.xScale(exList[h-1].getAttribute("stop"));
n=b.xScale(exList[h].getAttribute("start"))-l;y=0;if(7>n)f="";else for(n-=7;8<n;)0==y?(f+=" ",y=1):(f+=e,y=0),n-=7;m.append("svg:text").attr("id",function(a){return"IntTxt"+exList[h-1].getAttribute("ID")+"_"+exList[h].getAttribute("ID")}).attr("dx",l+1).attr("dy","11").style("pointer-events","none").style("opacity","0.5").style("fill",b.color).style("font-size","16px").text(f)}}if(2==b.density){var w=a.getAttribute("ID");"undefined"!==typeof a.getAttribute("geneSymbol")&&0<a.getAttribute("geneSymbol").length&&
(w=w+" ("+a.getAttribute("geneSymbol")+")");m.append("svg:text").attr("dx",function(){var c=b.xScale(a.getAttribute("start"));return c=c<$(window).width()/2?b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start"))+5:-9*w.length}).attr("dy",10).attr("id","lblTxt").text(w)}else m.select("text#lblTxt").remove()};b.getSVGID=function(a){return b.getDisplayID(a.getAttribute("ID"))+" ("+a.getAttribute("geneSymbol")+")"};b.setupToolTipSVG=function(a,c){if("undefined"!==typeof a.getAttribute("extStart")&&
null!==a.getAttribute("extStart")){var d=parseInt(a.getAttribute("extStart"),10);var g=parseInt(a.getAttribute("extStop"),10)}else d=parseInt(a.getAttribute("start"),10),g=parseInt(a.getAttribute("stop"),10);var m=Math.floor((g-d)*c);10>m&&(m=10);d-=m;g+=m;m=toolTipSVG("div#ttSVG",450,d,g,99,b.getSVGID(a),"transcript");m.xMin=d;m.xMax=g;var h="none";0===b.trackClass.indexOf("liverTotal")?h=b.trackClass:"heartTotal"==b.trackClass?h="heartTotal":0===b.trackClass.indexOf("brainTotal")?h=b.trackClass:
"mergedTotal"==b.trackClass?h="mergedTotal":200>parseInt(a.getAttribute("stop"),10)-parseInt(a.getAttribute("start"),10)?h="small":"protein_coding"==a.getAttribute("biotype")&&200<=parseInt(a.getAttribute("stop"),10)-parseInt(a.getAttribute("start"),10)?h="protein":"protein_coding"!=a.getAttribute("biotype")&&200<=parseInt(a.getAttribute("stop"),10)-parseInt(a.getAttribute("start"),10)&&(h="long");m.txType=h;m.selectedData=a;h=[];h[0]=a;"undefined"!==typeof a.parent&&(h[0]=a.parent);m.addTrack(b.trackClass,
2,"DrawTrx",h);for(h=0;h<b.ttTrackList.length;h++)if(b.trackClass!==b.ttTrackList[h]){var e=b.gsvg.getTrackData(b.ttTrackList[h]),f=[];if("undefined"!==typeof e&&0<e.length){for(var l=0,n=0;n<e.length;n++)if(d<=parseInt(e[n].getAttribute("start"),10)&&parseInt(e[n].getAttribute("start"),10)<=g||d<=parseInt(e[n].getAttribute("stop"),10)&&parseInt(e[n].getAttribute("stop"),10)<=g||parseInt(e[n].getAttribute("start"),10)<=d&&parseInt(e[n].getAttribute("stop"),10)>=d)f[l]=e[n],l++;0<f.length&&m.addTrack(b.ttTrackList[h],
3,"DrawTrx",f)}}};b.draw=function(a){b.data=a;b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(var c=0;c<b.gsvg.width;c++)b.yMaxArr[c]=0,b.yArr[0][c]=0;b.svg.selectAll(".gene").remove();c=b.drawAs;var d=b.xScale.domain()[0];if(b.xScale.domain()[1]-d<b.trxCutoff||$("#forceTrxCBX"+b.gsvg.levelNumber).is(":checked"))b.drawAs="Trx";d="Genes";"Trx"==b.drawAs&&(d="Transcripts");var p="Protein Coding",m=" / PolyA+";-1<b.trackClass.indexOf("noncoding")?(p="Long Non-Coding",m=" / Non-PolyA+"):-1<b.trackClass.indexOf("smallnc")?
(p="Brain",-1<b.trackClass.indexOf("liver")?p="Liver":-1<b.trackClass.indexOf("heart")&&(p="Heart"),p+=" Small RNA",m=""):0===b.trackClass.indexOf("liverTotal")?(p="Liver RNA-Seq Reconstruction ",m="Total RNA"):"heartTotal"==b.trackClass?(p="Heart RNA-Seq Reconstruction ",m="Total RNA"):0===b.trackClass.indexOf("brainTotal")?(p="Whole Brain RNA-Seq Reconstruction ",m="Total RNA"):"mergedTotal"==b.trackClass&&(p="Merged (Brain,Heart,Liver) Reconstructed",m="Total RNA");p=-1<b.trackClass.indexOf("ensembl")?
"Ensembl "+p+" "+d:-1===b.trackClass.indexOf("brainTotal")&&-1===b.trackClass.indexOf("liverTotal")&&"heartTotal"!=b.trackClass&&"mergedTotal"!=b.trackClass?"Reconstruction "+p+m+" "+d:p+m+" "+d;(0===b.trackClass.indexOf("liverTotal")||0===b.trackClass.indexOf("brainTotal"))&&0<b.trackClass.indexOf("_")&&(d=b.trackClass.substr(b.trackClass.indexOf("_")+1),"LEStm"===d&&(d="LE-Stm"),"F344Stm"===d&&(d="F344-Stm"),p=d+" Filtered (>=1.0TPM) "+p);b.updateLabel(p);b.redrawLegend();d=a;if("Trx"===b.drawAs&&
-1===b.trackClass.indexOf("smallnc"))for(d=[],m=p=0;m<a.length;m++)if("undefined"!==typeof a[m])for(var h=getAllChildrenByName(getFirstChildByName(a[m],"TranscriptList"),"Transcript"),e=0;e<h.length;e++)d[p]=h[e],d[p].parent=a[m],p++;0<d.length&&("Gene"===b.drawAs||-1<b.trackClass.indexOf("smallnc")?(b.drawnAs="Gene",b.svg.selectAll(".trx0").each(function(){d3.select(this).remove()}),a=b.svg.selectAll(".gene").data(d,key).attr("transform",function(a,c){return"translate("+b.xScale(a.getAttribute("start"))+
","+b.calcY(parseInt(a.getAttribute("start"),10),parseInt(a.getAttribute("stop"),10),c)+")"}),a.enter().append("g").attr("class","gene").attr("transform",function(a,c){return"translate("+b.xScale(a.getAttribute("start"))+","+b.calcY(parseInt(a.getAttribute("start"),10),parseInt(a.getAttribute("stop"),10),c)+")"}).merge(a).append("rect").attr("height",10).attr("rx",1).attr("ry",1).attr("width",function(a){return b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start"))}).attr("title",function(a){return a.getAttribute("ID")}).attr("stroke",
b.colorStroke).attr("stroke-width","1").attr("id",function(a){return b.cleanID(a.getAttribute("ID"))}).style("fill",b.color).style("cursor","pointer").on("click",function(a){setTimeout(function(){b.setupDetailedView(a);d3.select(this).attr("class","selected").style("fill","green")}.bind(this),10)}).on("dblclick",b.zoomToFeature).on("mouseover",function(a){0===b.gsvg.isToolTip&&(overSelectable=1,$("#mouseHelp").html("<B>Click</B> to see additional details. <B>Double Click</B> to zoom in on this feature."),
d3.select(this).style("fill","green"),tt.transition().duration(200).style("opacity",1).style("top",function(){return b.positionTTTop(d3.event.pageY)}).style("left",function(){return b.positionTTLeft(d3.event.pageX)}),tt.html(b.createToolTip(a)),a&&(b.triggerTableFilter(a),-1===b.trackClass.indexOf("smallnc")?"Trx"===b.drawAs?b.setupToolTipSVG(a.parent,.05):b.setupToolTipSVG(a,.05):b.setupToolTipSVG(a,.05),tt.style("top",function(){return b.positionTTTop(d3.event.pageY)})))}).on("mouseout",function(a){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");
"selected"!==d3.select(this).attr("class")&&d3.select(this).style("fill",b.color);tt.transition().delay(500).duration(200).style("opacity",0);b.clearTableFilter(a)}),a.exit().remove(),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").each(function(a){if(a){var c=d3.select(this);if("-1"==a.getAttribute("strand")||"1"==a.getAttribute("strand")){var d=">";"-1"==a.getAttribute("strand")&&(d="<");var g=d,h=c.select("rect").attr("width");if(8.5>h)g="";else for(h-=8.5,g=d;8.7<h;)g+=
d,h-=8.5;c.append("svg:text").attr("dx","1").attr("dy","10").attr("id","strandTxt").style("pointer-events","none").text(g)}if(2===b.density){var p=a.getAttribute("ID");a.getAttribute("geneSymbol")&&0<a.getAttribute("geneSymbol").length&&(p=p+" ("+a.getAttribute("geneSymbol")+")");c.append("svg:text").attr("dx",function(){var c=b.xScale(a.getAttribute("start"));return c=c<$(window).width()/2?b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start"))+5:-9*p.length}).attr("dy",10).attr("id",
"lblTxt").text(p)}else c.select("text#lblTxt").remove()}}),1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").size()+1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1))):"Trx"==b.drawAs&&(b.drawnAs="Trx",b.svg.selectAll(".gene").each(function(){d3.select(this).remove()}),b.svg.selectAll(".trx"+b.gsvg.levelNumber).remove(),a=b.svg.selectAll(".trx"+b.gsvg.levelNumber).data(d,key).attr("transform",function(a,
c){return"translate("+b.xScale(a.getAttribute("start"))+","+b.calcY(parseInt(a.getAttribute("start"),10),parseInt(a.getAttribute("stop"),10),c)+")"}),a.enter().append("g").attr("class",function(a){a=new String(a.parent.getAttribute("ID"));return"trx"+b.gsvg.levelNumber+" gene"+a.replace(".","_")}).attr("transform",function(a,c){return"translate(0,"+b.calcY(parseInt(a.getAttribute("start"),10),parseInt(a.getAttribute("stop"),10),c)+")"}).attr("id",function(a){var c="";1==b.gsvg.levelNumber&&(c="tx");
99==b.gsvg.levelNumber&&(c="ttTx");return c+b.cleanID(a.getAttribute("ID"))+b.gsvg.levelNumber}).style("cursor","pointer").on("click",function(a){setTimeout(function(){if(0==b.gsvg.levelNumber){var c=(new String(a.parent.getAttribute("ID"))).replace(".","_");b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("line").style("stroke",b.color);b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("rect").style("fill",b.color);b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("text").style("opacity",
"0.6").style("fill",b.color);b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").each(function(){var a=new String($(this).attr("class"));a=a.replace(" selected","");$(this).attr("class",a)});b.svg.selectAll("g.gene"+c).each(function(){var a=$(this).attr("class")+" selected";$(this).attr("class",a)});b.svg.selectAll("g.gene"+c).selectAll("line").style("stroke","green");b.svg.selectAll("g.gene"+c).selectAll("rect").style("fill","green");b.svg.selectAll("g.gene"+c).selectAll("text").style("opacity",
"0.3").style("fill","green");b.setupDetailedView(a.parent)}},10)}).on("dblclick",b.zoomToFeature).on("mouseover",function(a){if(0===b.gsvg.isToolTip){if(0===b.gsvg.levelNumber&&"undefined"!==typeof a.parent){var c=(new String(a.parent.getAttribute("ID"))).replace(".","_");b.svg.selectAll("g.gene"+c).selectAll("line").style("stroke","green");b.svg.selectAll("g.gene"+c).selectAll("rect").style("fill","green");b.svg.selectAll("g.gene"+c).selectAll("text").style("opacity","0.3").style("fill","green")}else d3.select(this).selectAll("line").style("stroke",
"green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green");tt.transition().duration(200).style("opacity",1);tt.html(b.createToolTip(a)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)});b.triggerTableFilter(a);if("undefined"!==typeof a){if(-1===b.trackClass.indexOf("smallnc"))b.setupToolTipSVG(a,.05);else{c=toolTipSVG("div#ttSVG",450,
parseInt(a.getAttribute("start"),10)-10,parseInt(a.getAttribute("stop"),10)+10,99,b.getDisplayID(a.getAttribute("ID")),"");c.xMin=parseInt(a.getAttribute("start"),10)-20;c.xMax=parseInt(a.getAttribute("stop"),10)+20;var d=[];d[0]=a;c.addTrack(b.trackClass,2,"",d)}tt.style("top",function(){return b.positionTTTop(d3.event.pageY)})}}}).on("mouseout",function(a){if(-1==(new String(d3.select(this).attr("class"))).indexOf("selected"))if(0==b.gsvg.levelNumber){var c=(new String(a.parent.getAttribute("ID"))).replace(".",
"_");b.svg.selectAll("g.gene"+c).selectAll("line").style("stroke",b.color);b.svg.selectAll("g.gene"+c).selectAll("rect").style("fill",b.color);b.svg.selectAll("g.gene"+c).selectAll("text").style("opacity","0.6").style("fill",b.color)}else d3.select(this).selectAll("line").style("stroke",b.color),d3.select(this).selectAll("rect").style("fill",b.color),d3.select(this).selectAll("text").style("opacity","0.6").style("fill",b.color);tt.transition().delay(500).duration(200).style("opacity",0);b.clearTableFilter(a)}).merge(a).each(b.drawTrx),
a.exit().remove(),a,1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.trx"+b.gsvg.levelNumber).size()+1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1))));""!=selectGene&&b.setSelected(selectGene);b.redrawSelectedArea();b.drawAs=c};b.redrawLegend=function(){var a=[],c=0;"Trx"===b.drawAs&&("braincoding"===b.trackClass?"Rn"===organism&&(a[c]={color:"#7EB5D6",label:"All"},c++,a[c]={color:"#5E95FF",label:"BN-Lx"},
c++,a[c]={color:"#BE95B6",label:"SHR"},c++):"brainnoncoding"===b.trackClass?"Rn"===organism&&(a[c]={color:"#CECFCE",label:"All"},c++,a[c]={color:"#3E75FF",label:"BN-Lx"},c++,a[c]={color:"#FE7596",label:"SHR"},c++):"liverTotal"===b.trackClass?(a[c]={color:"#bbbedd",label:"All"},c++,a[c]={color:"#9b9eFF",label:"BN-Lx"},c++,a[c]={color:"#Fb9eBd",label:"SHR"},c++):"heartTotal"===b.trackClass?(a[c]={color:"#DC7252",label:"All"},c++,a[c]={color:"#BC5292",label:"BN-Lx"},c++,a[c]={color:"#FF5232",label:"SHR"},
c++):"mergedTotal"!==b.trackClass&&"brainTotal"===b.trackClass&&(a[c]={color:"#7EB5D6",label:"All"},c++,a[c]={color:"#5E95FF",label:"BN-Lx"},c++,a[c]={color:"#BE95B6",label:"SHR"},c++));"brainsmallnc"===b.trackClass?(a[c]={color:"#3E7596",label:"All"},c++,a[c]={color:"#1E55D6",label:"BN-Lx"},c++,a[c]={color:"#7E5576",label:"SHR"}):"heartsmallnc"===b.trackClass?(a[c]={color:"#9C3212",label:"All"},c++,a[c]={color:"#7C1252",label:"BN-Lx"},c++,a[c]={color:"#DC1200",label:"SHR"}):"liversmallnc"===b.trackClass&&
(a[c]={color:"#7b7e9d",label:"All"},c++,a[c]={color:"#5b5eDd",label:"BN-Lx"},c++,a[c]={color:"#bb5e7d",label:"SHR"});b.drawLegend(a)};b.triggerTableFilter=function(a){var c=jQuery.Event("keyup");c.which=32;var d="";"undefined"!==typeof a.getAttribute&&"undefined"!==typeof a.getAttribute("ID")&&(d=b.getDisplayID(a.getAttribute("ID")));-1==b.trackClass.indexOf("smallnc")?$("#tblGenes"+b.trackClass+"_filter input").val(d).trigger(c):$("#tblsmGenes_filter input").val(d).trigger(c)};b.clearTableFilter=
function(a){a=jQuery.Event("keyup");a.which=32;"smallnc"!=b.trackClass?$("#tblGenes"+b.trackClass+"_filter input").val("").trigger(a):$("#tblsmGenes_filter input").val("").trigger(a)};b.updateSettingsFromUI=function(){0<$("#"+b.trackClass+"Dense"+b.level+"Select").length&&(b.density=$("#"+b.trackClass+"Dense"+b.level+"Select").val(),"string"===typeof b.density&&(b.density=parseInt(b.density)));0<$("#"+b.trackClass+"Version"+b.level+"Select").length&&(b.reqDataVer=$("#"+b.trackClass+"Version"+b.level+
"Select").val())};b.savePrevious=function(){b.prevSetting={};b.prevSetting.density=b.density;b.prevSetting.dataVer=b.dataVer};b.revertPrevious=function(){b.density=b.prevSetting.density;b.dataVer=b.prevSetting.dataVer};b.updateSettings=function(a){};b.generateTrackSettingString=function(){return b.trackClass+","+b.density+","+b.dataVer+";"};b.redrawLegend();b.draw(e);return b}
function RefSeqTrack(f,e,l,n,c){var b=GeneTrack(f,e,l,n);b.counts=[{value:0,names:"Ensembl"},{value:0,names:"RNA-Seq"}];b.drawAs="Gene";b.trxCutoff=1E5;b.density=3;-1<(new String(c)).indexOf("DrawTrx")&&(b.drawAs="Trx");b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(f=0;f<b.gsvg.width;f++)b.yMaxArr[f]=0,b.yArr[0][f]=0;b.ttTrackList=[];b.ttTrackList.push("ensemblcoding");b.ttTrackList.push("braincoding");b.ttTrackList.push("liverTotal");b.ttTrackList.push("heartTotal");b.ttTrackList.push("mergedTotal");b.ttTrackList.push("ensemblnoncoding");
b.ttTrackList.push("brainnoncoding");b.ttTrackList.push("repeatMask");b.ttTrackList.push("snpSHRH");b.ttTrackList.push("snpBNLX");b.ttTrackList.push("snpF344");b.ttTrackList.push("snpSHRJ");b.cleanID=function(a){return a=a.replace(/\./g,"_")};b.color=function(a){var c=d3.rgb("#000000");if("Gene"==b.drawnAs){a=getAllChildrenByName(getFirstChildByName(a,"TranscriptList"),"Transcript");for(var d=-1,p=0;p<a.length;p++){var m=new String(a[p].getAttribute("category")),h=-1;"Reviewed"==m?h=5:"Validated"==
m?h=4:"Provisional"==m?h=3:"Inferred"==m?h=2:"Predicted"==m?h=1:"Model"==m?h=1:"Unknown"==m&&(h=0);d<h&&(d=h)}5===d&&(c=d3.rgb("#18814F"));4===d?c=d3.rgb("#38A16F"):3===d?c=d3.rgb("#78E1AF"):2===d?c=d3.rgb("#A8FFDF"):1===d?c=d3.rgb("#A8DFFF"):0===d&&(c=d3.rgb("#C8FFFF"))}else"Trx"==b.drawnAs&&(m=new String(a.getAttribute("category")),"Reviewed"==m?c=d3.rgb("#18814F"):"Validated"==m?c=d3.rgb("#38A16F"):"Provisional"==m?c=d3.rgb("#78E1AF"):"Inferred"==m?c=d3.rgb("#A8FFDF"):"Predicted"==m?c=d3.rgb("#A8DFFF"):
"Model"===m?c=d3.rgb("#A8DFFF"):"Unknown"===m&&(c=d3.rgb("#C8FFFF")));return c};b.pieColor=function(a,b){var c=d3.rgb("#000000"),g=new String(a.data.names);-1<g.indexOf("Reviewed")?c=d3.rgb("#18814F"):-1<g.indexOf("Validated")?c=d3.rgb("#38A16F"):-1<g.indexOf("Provisional")?c=d3.rgb("#78E1AF"):-1<g.indexOf("Inferred")?c=d3.rgb("#A8FFDF"):-1<g.indexOf("Predicted")?c=d3.rgb("#A8DFFF"):-1<g.indexOf("Model")?c=d3.rgb("#A8DFFF"):-1<g.indexOf("Unknown")&&(c=d3.rgb("#C8FFFF"));return c};b.getDisplayedData=
function(){var a=[],c=0,d=0;if("Gene"==b.drawnAs){var p=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".gene");b.counts=[];var m=0;p.each(function(g){var h=b.xScale(g.getAttribute("start")),p=b.xScale(g.getAttribute("stop"));if(0<=h&&h<=b.gsvg.width||0<=p&&p<=b.gsvg.width||0>=h&&p>=b.gsvg.width){p=getAllChildrenByName(getFirstChildByName(g,"TranscriptList"),"Transcript");h=-1;for(var e=0;e<p.length;e++){var f=new String(p[e].getAttribute("category")),l=-1;"Reviewed"==f?l=5:"Validated"==
f?l=4:"Provisional"==f?l=3:"Inferred"==f?l=2:"Predicted"==f?l=1:"Model"==f?l=1:"Unknown"==f&&(l=1);h<l&&(h=l)}p="Unknown";5==h?p="Reviewed":4==h?p="Validated":3==h?p="Provisional":2==h?p="Inferred":1==h&&(p="Predicted/Model");"undefined"===typeof b.counts[p]?(b.counts[p]={},b.counts[m]=b.counts[p],m++,b.counts[p].value=1,b.counts[p].names=p):b.counts[p].value++;a[c]=g;c++;d++}})}else b.counts=[],m=0,b.svg.selectAll("g.trx"+b.gsvg.levelNumber).each(function(g){var h=b.xScale(g.getAttribute("start")),
p=b.xScale(g.getAttribute("stop"));if(0<=h&&h<=b.gsvg.width||0<=p&&p<=b.gsvg.width||0>=h&&p>=b.gsvg.width)h=new String(g.getAttribute("category")),"undefined"===typeof b.counts[h]?(b.counts[h]={},b.counts[m]=b.counts[h],m++,b.counts[h].value=1,b.counts[h].names=h):b.counts[h].value++,a[c]=g,c++,d++});return a};b.createToolTip=function(a){var c="",d=a.getAttribute("strand");d="1"==d||"+"==d?"+":"-1"==d||"-"==d?"-":".";if("Gene"===b.drawnAs){c="";for(var p=getAllChildrenByName(getFirstChildByName(a,
"TranscriptList"),"Transcript"),m=0;m<p.length;m++){var h=new String(p[m].getAttribute("ID"));c+="<B>"+h+"</B> - "+p[m].getAttribute("category");c+="<br>"}c='<BR><div id="ttSVG" style="background:#FFFFFF;"></div>Gene Symbol: '+a.getAttribute("geneSymbol")+"<BR>Location: "+a.getAttribute("chromosome")+":"+numberWithCommas(a.getAttribute("start"))+"-"+numberWithCommas(a.getAttribute("stop"))+"<BR>Strand: "+d+"<BR>Transcripts:<BR>"+c}else"Trx"===b.drawnAs&&(h=new String(a.getAttribute("ID")),c='<BR><div id="ttSVG" style="background:#FFFFFF;"></div>RefSeq ID:'+
("<B>"+h+"</B>")+"<BR>Status: "+a.getAttribute("category")+"<BR>Gene Symbol: "+a.getAttribute("geneSymbol")+"<BR>Location: "+a.getAttribute("chromosome")+":"+numberWithCommas(a.getAttribute("start"))+"-"+numberWithCommas(a.getAttribute("stop"))+"<BR>Strand: "+d);return c};b.getSVGID=function(a){return a.getAttribute("geneSymbol")};b.setupToolTipSVG=function(a,c){var d=parseInt(a.getAttribute("start"),10),g=parseInt(a.getAttribute("stop"),10),m=Math.floor((g-d)*c);20>m&&(m=20);var h=d-m;m=g+m;1>h&&
(h=1);"undefined"!==typeof b.ttSVGMinWidth&&m-h<b.ttSVGMinWidth&&(h=d-b.ttSVGMinWidth/2,m=g+b.ttSVGMinWidth/2);d=toolTipSVG("div#ttSVG",450,h,m,99,b.getSVGID(a),"transcript");d.forLevel=b.gsvg.levelNumber;g=[];g.push(a);d.addTrack(b.trackClass,3,"DrawTrx",g);for(g=0;g<b.ttTrackList.length;g++){var e=b.gsvg.getTrackData(b.ttTrackList[g]),f=[];if("undefined"!==typeof e&&0<e.length){for(var l=0,n=0;n<e.length;n++)if(h<=parseInt(e[n].getAttribute("start"),10)&&parseInt(e[n].getAttribute("start"),10)<=
m||parseInt(e[n].getAttribute("start"),10)<=h&&parseInt(e[n].getAttribute("stop"),10)>=h)f[l]=e[n],l++;0<f.length&&d.addTrack(b.ttTrackList[g],3,"DrawTrx",f)}}};b.calcY=function(a,c,d){if(3==b.density)if(a>=b.xScale.domain()[0]&&a<=b.xScale.domain()[1]||c>=b.xScale.domain()[0]&&c<=b.xScale.domain()[1]||a<=b.xScale.domain()[0]&&c>=b.xScale.domain()[1]){a=Math.floor(b.xScale(a));0>a&&(a=0);c=Math.floor(b.xScale(c))+1;c>=b.gsvg.width&&(c=b.gsvg.width-1);d=a-5;0>d&&(d=0);var g=c+5;g>=b.gsvg.width&&(g=
b.gsvg.width-1);for(var m=0,h=d;h<=g;h++)b.yMaxArr[h]>m&&(m=b.yMaxArr[h]);m++;var e=m;if(b.yArr.length<=m)for(b.yArr[e]=[],h=0;h<b.gsvg.width;h++)b.yArr[e][h]=0;h=m-12;1>h&&(h=1);e=0;for(var f=h;f<m&&0==e;f++){var l=0;for(h=d;h<=g&&0==l;h++)b.yArr[f][h]>l&&(l=1);0==l&&(m=f,e=1)}m>b.trackYMax&&(b.trackYMax=m);for(h=a;h<=c;h++)b.yMaxArr[h]<m&&(b.yMaxArr[h]=m),b.yArr[m][h]=1;a=15*m}else a=15;else a=2==b.density?15*(d+1):15;b.trackYMax<a/15&&(b.trackYMax=a/15);return a};b.redraw=function(){var a=b.xScale.domain()[0];
a=b.xScale.domain()[1]-a;var c=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(var d=0;d<b.gsvg.width;d++)b.yMaxArr[d]=0,b.yArr[0][d]=0;b.trackYMax=0;if(a<b.trxCutoff&&"Gene"==b.drawnAs||a>=b.trxCutoff&&"Trx"==b.drawnAs&&"Trx"!=b.drawAs||"Gene"==b.drawnAs&&$("#forceTrxCBX"+b.gsvg.levelNumber).is(":checked"))b.draw(b.data);else if(a<b.trxCutoff&&"Trx"==b.drawnAs&&"Trx"!=b.drawAs&&(c=1),"Gene"==b.drawAs&&0==c)b.svg.node()&&(b.svg.selectAll(".trx").each(function(){d3.select(this).remove()}),d3.select("#Level"+
b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").attr("transform",function(a,c){return"translate("+b.xScale(a.getAttribute("start"))+","+b.calcY(parseInt(a.getAttribute("start"),10),parseInt(a.getAttribute("stop"),10),c)+")"}),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene rect").attr("width",function(a){var c=1;1<b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start"))&&(c=b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start")));return c}).attr("stroke",
b.colorStroke),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").each(function(a){var b=d3.select(this);if("1"==a.getAttribute("strand")||"-1"==a.getAttribute("strand")||"-"==a.getAttribute("strand")||"+"==a.getAttribute("strand")){var c=">";if("-1"==a.getAttribute("strand")||"-"==a.getAttribute("strand"))c="<";a="";var d=b.select("rect").attr("width");if(8.5<=d&&15.8>=d)a=c;else for(;8.7<d;)a+=c,d-=8.5;b.select("text").text(a)}})),1==b.density?b.svg.attr("height",30):2==b.density?
b.svg.attr("height",15*(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").size()+1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1));else if(1==c||"Trx"==b.drawAs)b.svg.selectAll("g.trx"+b.gsvg.levelNumber).attr("transform",function(a,c){return"translate(0,"+b.calcY(parseInt(a.getAttribute("start"),10),parseInt(a.getAttribute("stop"),10),c)+")"}).each(function(a,c){var d=parseInt(a.getAttribute("cdsStart"),10),g=parseInt(a.getAttribute("cdsStop"),10);exList=getAllChildrenByName(getFirstChildByName(a,
"exonList"),"exon");var e="";1==b.gsvg.levelNumber&&(e="tx");for(var p=0;p<exList.length;p++){var m=parseInt(exList[p].getAttribute("start"),10),f=parseInt(exList[p].getAttribute("stop"),10);if(m<d&&d<f||f>g&&g>m){var l=m,n=d;f>g?(l=g,n=f,f=g):m=d;d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).select("g#"+e+b.cleanID(a.getAttribute("ID"))+" rect#ExNC"+exList[p].getAttribute("ID")).attr("x",function(a){return b.xScale(l)}).attr("width",function(a){return b.xScale(n)-b.xScale(l)})}d3.select("#Level"+
b.gsvg.levelNumber+b.trackClass).select("g#"+e+b.cleanID(a.getAttribute("ID"))+" rect#Ex"+exList[p].getAttribute("ID")).attr("x",function(a){return b.xScale(m)}).attr("width",function(a){return b.xScale(f)-b.xScale(m)});if(0<p){var z=b.xScale(exList[p-1].getAttribute("stop")),E=b.xScale(exList[p].getAttribute("start"));if("1"==a.getAttribute("strand")||"-1"==a.getAttribute("strand")||"-"==a.getAttribute("strand")||"+"==a.getAttribute("strand")){var F=">";"-1"==a.getAttribute("strand")&&(F="<");var B=
F,D=E-z,C=0;if(7>D)B="";else for(D-=7;8<D;)0==C?(B+=" ",C=1):(B+=F,C=0),D-=7;d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).select("g#"+e+b.cleanID(a.getAttribute("ID"))+" #IntTxt"+exList[p-1].getAttribute("ID")+"_"+exList[p].getAttribute("ID")).attr("dx",z+1).text(B)}d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).select("g#"+e+b.cleanID(a.getAttribute("ID"))+" line#Int"+exList[p-1].getAttribute("ID")+"_"+exList[p].getAttribute("ID")).attr("x1",z).attr("x2",E)}}}),1==b.density?b.svg.attr("height",
30):2==b.density?b.svg.attr("height",15*(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.trx"+b.gsvg.levelNumber).size()+1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1));b.redrawSelectedArea()};b.updateData=function(a){var c=b.xScale.domain()[0],d=b.xScale.domain()[1];d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/refSeq.xml",function(g,e){if(g){if(0==a){var h=contextPath+"/"+pathPrefix;pathPrefix||(h="");$.ajax({url:h+"generateTrackXML.jsp",
type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:c,maxCoord:d,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,track:b.trackClass,folder:b.gsvg.folderName,panel:panel},dataType:"json",success:function(a){},error:function(a,b,c){}})}10>a?(h=2500,1==a&&(h=1E4),setTimeout(function(){b.updateData(a+1)},h)):(d3.select("#Level"+b.levelNumber+b.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+b.trackClass),d3.select("#Level"+b.levelNumber+b.trackClass).attr("height",
15),b.gsvg.addTrackErrorRemove(b.svg,"#Level"+b.gsvg.levelNumber+b.trackClass))}else if(e){h=e.documentElement.getElementsByTagName("Gene");for(var p=[],m=[],f=0,l=0;l<h.length;l++)h[l]&&(p[f]=h[l],p[f].setAttribute("ID",f),m[h[l].getAttribute("geneSymbol")]=1,f++);for(l=0;l<b.data.length;l++)b.data[l]&&!m[b.data[l].getAttribute("geneSymbol")]&&(p[f]=b.data[l],p[f].setAttribute("ID",f),f++);b.draw(p);b.hideLoading();b.getDisplayedData();setTimeout(function(){DisplayRegionReport()},300)}else b.updateData(a+
1),b.hideLoading()})};b.drawTrx=function(a,c){var d=parseInt(a.getAttribute("cdsStart"),10),g=parseInt(a.getAttribute("cdsStop"),10),e="";1==b.gsvg.levelNumber&&(e="tx");e=b.svg.select("#"+e+b.cleanID(a.getAttribute("ID")));exList=getAllChildrenByName(getFirstChildByName(a,"exonList"),"exon");for(var h=0;h<exList.length;h++){var f=parseInt(exList[h].getAttribute("start"),10),l=parseInt(exList[h].getAttribute("stop"),10);if(f<d&&d<l||l>g&&g>f){var n=0,t=0,y=0,v=0;f<d?(n=b.xScale(f),t=b.xScale(d)-b.xScale(f),
y=b.xScale(d),v=b.xScale(l)-b.xScale(d)):l>g&&(y=b.xScale(f),v=b.xScale(g)-b.xScale(f),n=b.xScale(g),t=b.xScale(l)-b.xScale(g));e.append("rect").attr("x",n).attr("y",2.5).attr("height",5).attr("width",t).attr("title",function(a){return exList[h].getAttribute("ID")}).attr("id",function(a){return"ExNC"+exList[h].getAttribute("ID")}).style("fill",b.color).style("cursor","pointer");e.append("rect").attr("x",y).attr("height",10).attr("width",v).attr("title",function(a){return exList[h].getAttribute("ID")}).attr("id",
function(a){return"Ex"+exList[h].getAttribute("ID")}).style("fill",b.color).style("cursor","pointer")}else{n=10;t=0;if(f<d&&l<d||l>g&&f>g)n=5,t=2.5;e.append("rect").attr("x",function(a){return b.xScale(exList[h].getAttribute("start"))}).attr("y",t).attr("height",n).attr("width",function(a){return b.xScale(exList[h].getAttribute("stop"))-b.xScale(exList[h].getAttribute("start"))}).attr("title",function(a){return exList[h].getAttribute("ID")}).attr("id",function(a){return"Ex"+exList[h].getAttribute("ID")}).style("fill",
b.color).style("cursor","pointer")}if(0<h&&(e.append("line").attr("x1",function(a){return b.xScale(exList[h-1].getAttribute("stop"))}).attr("x2",function(a){return b.xScale(exList[h].getAttribute("start"))}).attr("y1",5).attr("y2",5).attr("id",function(a){return"Int"+exList[h-1].getAttribute("ID")+"_"+exList[h].getAttribute("ID")}).attr("stroke",b.color).attr("stroke-width","2"),"1"==a.getAttribute("strand")||"-1"==a.getAttribute("strand")||"-"==a.getAttribute("strand")||"+"==a.getAttribute("strand"))){f=
">";if("-"==a.getAttribute("strand")||"-1"==a.getAttribute("strand"))f="<";l=f;n=b.xScale(exList[h-1].getAttribute("stop"));t=b.xScale(exList[h].getAttribute("start"))-n;y=0;if(7>t)l="";else for(t-=7;8<t;)0==y?(l+=" ",y=1):(l+=f,y=0),t-=7;e.append("svg:text").attr("id",function(a){return"IntTxt"+exList[h-1].getAttribute("ID")+"_"+exList[h].getAttribute("ID")}).attr("dx",n+1).attr("dy","11").style("pointer-events","none").style("opacity","0.5").style("fill",b.color).style("font-size","16px").text(l)}}};
b.draw=function(a){b.data=a;b.trackYMax=0;b.yArr=[];b.yArr[0]=[];for(var c=0;c<b.gsvg.width;c++)b.yMaxArr[c]=0,b.yArr[0][c]=0;b.svg.selectAll(".gene").remove();b.svg.selectAll(".trx"+b.gsvg.levelNumber).remove();var d=b.drawAs;c=b.xScale.domain()[0];if(b.xScale.domain()[1]-c<b.trxCutoff||$("#forceTrxCBX"+b.gsvg.levelNumber).is(":checked"))b.drawAs="Trx";if(0!=a&&"Gene"===b.drawAs)b.drawnAs="Gene",b.label="Ref Seq Genes",b.updateLabel(b.label),b.redrawLegend(),a=b.svg.selectAll(".gene").data(a,key).attr("transform",
function(a,c){return"translate("+b.xScale(a.getAttribute("start"))+","+b.calcY(parseInt(a.getAttribute("start"),10),parseInt(a.getAttribute("stop"),10),c)+")"}),a.enter().append("g").attr("class","gene").attr("transform",function(a,c){return"translate("+b.xScale(a.getAttribute("start"))+","+b.calcY(parseInt(a.getAttribute("start"),10),parseInt(a.getAttribute("stop"),10),c)+")"}).append("rect").attr("height",10).attr("rx",1).attr("ry",1).attr("width",function(a){return b.xScale(a.getAttribute("stop"))-
b.xScale(a.getAttribute("start"))}).attr("title",function(a){return a.getAttribute("ID")}).attr("stroke",b.colorStroke).attr("stroke-width","1").attr("id",function(a){return b.cleanID(a.getAttribute("ID"))}).style("fill",b.color).on("dblclick",b.zoomToFeature).on("mouseover",function(a){0==b.gsvg.isToolTip&&(overSelectable=1,$("#mouseHelp").html("<B>Double Click</B> to zoom in on this feature."),d3.select(this).style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(b.createToolTip(a)).style("left",
function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)}),b.setupToolTipSVG(a,.05));return!1}).on("mouseout",function(a){overSelectable=0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");"selected"!=d3.select(this).attr("class")&&d3.select(this).style("fill",b.color);tt.transition().delay(500).duration(200).style("opacity",0)}),a.exit().remove(),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").each(function(a){if("undefined"!==
typeof a){var b=d3.select(this);if("1"==a.getAttribute("strand")||"-1"==a.getAttribute("strand")||"-"==a.getAttribute("strand")||"+"==a.getAttribute("strand")){var c=">";if("-"==a.getAttribute("strand")||"-1"==a.getAttribute("strand"))c="<";var d=b.select("rect").attr("width");if(8.5>d)a="";else for(d-=8.5,a=c;8.7<d;)a+=c,d-=8.5;b.append("svg:text").attr("dx","1").attr("dy","10").style("pointer-events","none").text(a)}}}),1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(d3.select("#Level"+
b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").size()+1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1));else if(0!=a&&"Trx"===b.drawAs){b.drawnAs="Trx";b.label="Ref Seq Transcripts";b.updateLabel(b.label);b.redrawLegend();var e=[],m=0;for(c=0;c<a.length;c++)for(var h=getAllChildrenByName(getFirstChildByName(a[c],"TranscriptList"),"Transcript"),f=0;f<h.length;f++)e[m]=h[f],e[m].parent=a[c],m++;d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".trx"+b.gsvg.levelNumber).remove();
a=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".trx"+b.gsvg.levelNumber).data(e,key).attr("transform",function(a,c){return"translate("+b.xScale(a.getAttribute("start"))+","+b.calcY(parseInt(a.getAttribute("start"),10),parseInt(a.getAttribute("stop"),10),c)+")"});a.enter().append("g").attr("class","trx"+b.gsvg.levelNumber).attr("transform",function(a,c){return"translate(0,"+b.calcY(parseInt(a.getAttribute("start"),10),parseInt(a.getAttribute("stop"),10),c)+")"}).attr("id",function(a){var c=
"";1==b.gsvg.levelNumber&&(c="tx");return c+b.cleanID(a.getAttribute("ID"))}).on("mouseover",function(a){0==b.gsvg.isToolTip&&(d3.select(this).selectAll("line").style("stroke","green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(b.createToolTip(a)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)}),
"undefined"!==typeof a&&b.setupToolTipSVG(a.parent,.05))}).on("mouseout",function(a){d3.select(this).selectAll("line").style("stroke",function(a){return b.color(a)});d3.select(this).selectAll("rect").style("fill",function(a){return b.color(a)});d3.select(this).selectAll("text").style("opacity","0.6").style("fill",function(a){return b.color(a)});tt.transition().delay(500).duration(200).style("opacity",0)}).each(b.drawTrx);a.exit().remove();2==b.density?b.svg.attr("height",15*(d3.select("#Level"+b.gsvg.levelNumber+
b.trackClass).selectAll("g.trx"+b.gsvg.levelNumber).size()+1)):3==b.density?b.svg.attr("height",15*(b.trackYMax+1)):b.svg.attr("height",30)}b.redrawSelectedArea();b.drawAs=d};b.redrawLegend=function(){b.drawLegend([{color:"#18814F",label:"Reviewed"},{color:"#38A16F",label:"Validated"},{color:"#78E1AF",label:"Provisional"},{color:"#A8FFDF",label:"Inferred"},{color:"#A8DFFF",label:"Predicted/Model"},{color:"#C8FFFF",label:"Unknown"}])};b.redrawLegend();b.draw(e);DisplayRegionReport();return b}
function ProbeTrack(f,e,l,n,c){var b=Track(f,e,l,n);f=(new String(c)).split(",");0<f.length?(b.density=f[0],"string"===typeof b.density&&(b.density=parseInt(b.density)),b.colorSelect=1<f.length?f[1]:"annot",2<f.length?b.tissues=f[2].split(":"):(b.tissues=["Brain"],"Rn"==organism&&(b.tissues=["Brain","BrownAdipose","Heart","Liver"]))):(b.density=3,b.colorSelect="annot",b.tissues=["Brain"],"Rn"==organism&&(b.tissues=["Brain","BrownAdipose","Heart","Liver"]));1E6<b.gsvg.xScale.domain()[1]-b.gsvg.xScale.domain()[0]&&
(b.density=1);b.tissuesAll=["Brain"];"Rn"==organism&&(b.tissuesAll=["Brain","BrownAdipose","Heart","Liver"]);b.xPadding=1;b.scanBackYLines=75;b.curColor=b.colorSelect;b.ttTrackList=[];b.ttTrackList.push("ensemblcoding");b.ttTrackList.push("braincoding");b.ttTrackList.push("liverTotal");b.ttTrackList.push("heartTotal");b.ttTrackList.push("mergedTotal");b.ttTrackList.push("ensemblnoncoding");b.ttTrackList.push("brainnoncoding");b.ttTrackList.push("repeatMask");b.color=function(a,c){var d=d3.rgb("#000000");
"annot"==b.colorSelect?d=b.colorAnnotation(a):"herit"==b.colorSelect?(d=getFirstChildByName(a,"herit").getAttribute(c),d=Math.floor(255*d),d=d3.rgb(d,0,0)):"dabg"==b.colorSelect&&(d=getFirstChildByName(a,"dabg").getAttribute(c),d=Math.floor(2.55*d),d=d3.rgb(0,d,0));return d};b.colorAnnotation=function(a){var b=d3.rgb("#000000");"core"==a.getAttribute("type")?b=d3.rgb(255,0,0):"extended"==a.getAttribute("type")?b=d3.rgb(0,0,255):"full"==a.getAttribute("type")?b=d3.rgb(0,100,0):"ambiguous"==a.getAttribute("type")&&
(b=d3.rgb(0,0,0));return b};b.pieColor=function(a,b){var c=d3.rgb("#000000"),g=new String(a.data.names);"Core"==g?c=d3.rgb(255,0,0):"Extended"==g?c=d3.rgb(0,0,255):"Full"==g?c=d3.rgb(0,100,0):"Ambiguous"==g&&(c=d3.rgb(0,0,0));return c};b.createToolTip=function(a){var c=".";1==a.getAttribute("strand")?c="+":-1==a.getAttribute("strand")&&(c="-");var d=parseInt(a.getAttribute("stop"),10)-parseInt(a.getAttribute("start"),10);c='<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>Affy Probe Set ID: '+
a.getAttribute("ID")+"<BR>Strand: "+c+"<BR>Location: "+a.getAttribute("chromosome")+":"+numberWithCommas(a.getAttribute("start"))+"-"+numberWithCommas(a.getAttribute("stop"))+" ("+d+"bp)<BR>";c=c+"Type: "+a.getAttribute("type")+"<BR><BR>";d=getFirstChildByName(a,"herit");a=getFirstChildByName(a,"dabg");c+='<table class="tooltipTable" width="100%" colSpace="0"><tr><TH>Tissue</TH><TH>Heritability</TH><TH>DABG</TH></TR>';b.tissues.length<b.tissuesAll.length&&(c+='<TR><TD colspan="3">Displayed Tissues:</TD></TR>');
for(var e={},m=0;m<b.tissues.length;m++){var h=new String(b.tissues[m]);-1<h.indexOf("Affy")&&(h=h.substr(0,h.indexOf("Affy")));e[h]=1;var f=Math.floor(255*d.getAttribute(h));f=d3.rgb(f,0,0);var l=Math.floor(2.55*a.getAttribute(h));l=d3.rgb(0,l,0);c=c+"<TR><TD>"+h+'</TD><TD style="background:'+f+';color:white;">'+d.getAttribute(h)+'</TD><TD style="background:'+l+';color:white;">'+a.getAttribute(h)+"%</TD></TR>"}if(b.tissues.length<b.tissuesAll.length)for(c+='<TR><TD colspan="3">Other Tissues:</TD></TR>',
m=0;m<b.tissuesAll.length;m++)h=new String(b.tissuesAll[m]),-1<h.indexOf("Affy")&&(h=h.substr(0,h.indexOf("Affy"))),1!=e[h]&&(f=Math.floor(255*d.getAttribute(h)),f=d3.rgb(f,0,0),l=Math.floor(2.55*a.getAttribute(h)),l=d3.rgb(0,l,0),c=c+"<TR><TD>"+h+'</TD><TD style="background:'+f+';color:white;">'+d.getAttribute(h)+'</TD><TD style="background:'+l+';color:white;">'+a.getAttribute(h)+"%</TD></TR>");return c+"</table>"};b.updateSettingsFromUI=function(){0<$("#"+b.trackClass+"Dense"+b.level+"Select").length?
b.density=$("#"+b.trackClass+"Dense"+b.level+"Select").val():b.density||(b.density=1);b.curColor=b.colorSelect;0<$("#"+b.trackClass+b.level+"colorSelect").length?b.curColor=$("#"+b.trackClass+b.level+"colorSelect").val():b.curColor||(b.curColor="annot");var a=0;if(0<$("#affyTissues"+b.level+' input[name="tissuecbx"]').length){b.tissues=[];for(var c=$("#affyTissues"+b.level+' input[name="tissuecbx"]:checked'),d=0;d<c.length;d++){var e=new String(c[d].id);e=e.substr(0,e.indexOf("Affy"));b.tissues[a]=
e;a++}}};b.savePrevious=function(){b.prevSetting={};b.prevSetting.density=b.density;b.prevSetting.curColor=b.curColor;b.prevSetting.tissues=b.tissues};b.revertPrevious=function(){b.density=b.prevSetting.density;b.curColor=b.prevSetting.curColor;b.tissues=b.prevSetting.tissues};b.calcY=function(a,c,d,e){var g=8*e+5;if(3===b.density||"3"===b.density)if(a>=b.xScale.domain()[0]&&a<=b.xScale.domain()[1]||c>=b.xScale.domain()[0]&&c<=b.xScale.domain()[1]||a<=b.xScale.domain()[0]&&c>=b.xScale.domain()[1]){a=
Math.round(b.xScale(a));0>a&&(a=0);c=Math.round(b.xScale(c));c>=b.gsvg.width&&(c=b.gsvg.width-1);d=a-b.xPadding;0>d&&(d=0);e=c+b.xPadding;e>=b.gsvg.width&&(e=b.gsvg.width-1);e+g<b.gsvg.width?(e+=g,c+=g):0<d-g&&(d-=g,a-=g);g=0;for(var h=d;h<=e;h++)b.yMaxArr[h]>g&&(g=b.yMaxArr[h]);g++;var p=g;if(b.yArr.length<=g)for(b.yArr[p]=[],h=0;h<b.gsvg.width;h++)b.yArr[p][h]=0;h=g-b.scanBackYLines;1>h&&(h=1);p=0;for(var f=h;f<g&&0==p;f++){var l=0;for(h=d;h<=e&&0==l;h++)b.yArr[f][h]>l&&(l=1);0==l&&(g=f,p=1)}g>
b.trackYMax&&(b.trackYMax=g);for(h=a;h<=c;h++)b.yMaxArr[h]<g&&(b.yMaxArr[h]=g),b.yArr[g][h]=1;a=15*g}else a=15;else a=2===b.density||"2"===b.density?15*(d+1):15;b.trackYMax<a/15&&(b.trackYMax=a/15);return a};b.redraw=function(){var a=b.tissues.length;if(b.curColor!=b.colorSelect||("herit"===b.colorSelect||"dabg"===b.colorSelect)&&a!=b.tissueLen)b.tissueLen=a,b.draw(b.data);else{b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(var c=0;c<b.gsvg.width;c++)b.yMaxArr[c]=0,b.yArr[0][c]=0;b.colorSelect=
b.curColor;b.tissueLen=a;if("dabg"==b.colorSelect||"herit"==b.colorSelect){"dabg"==b.colorSelect?b.drawScaleLegend("0%","100%","of Samples DABG","#000000","#00FF00",0):"herit"==b.colorSelect&&b.drawScaleLegend("0","1.0","Probeset Heritability","#000000","#FF0000",0);var d=1;for(a=0;a<b.tissues.length;a++){var e=new String(b.tissues[a]);b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(c=0;c<b.gsvg.width;c++)b.yMaxArr[c]=0,b.yArr[0][c]=0;d++;b.svg.select("text."+e).attr("y",15*d);b.svg.selectAll("g.probe."+
e).attr("transform",function(a,c){var g=b.gsvg.xScale(a.getAttribute("start")),h=b.calcY(parseInt(a.getAttribute("start"),10),parseInt(a.getAttribute("stop"),10),c,a.getAttribute("ID").length)+15*d-10;return"translate("+g+","+h+")"}).each(function(a){var c=d3.select(this),d=1;1<b.gsvg.xScale(a.getAttribute("stop"))-b.gsvg.xScale(a.getAttribute("start"))&&(d=b.gsvg.xScale(a.getAttribute("stop"))-b.gsvg.xScale(a.getAttribute("start")));c.selectAll("rect").attr("width",d).attr("fill",b.color(a,e));var g=
">";"-1"==a.getAttribute("strand")&&(g="<");var p="";if(7.5<=d&&15>=d)p=g;else if(15<d)for(d-=7.5;7.5<d;)p+=g,d-=7.5;c.select("text#strand").text(p);if(2==b.density||3==b.density){var m=a.getAttribute("ID");0===c.select("text#lblTxt").size()?c.append("svg:text").attr("dx",function(){var c=b.xScale(a.getAttribute("stop"))+8*m.length+5,d=b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start"))+5;c>b.gsvg.width&&(d=-8*m.length);return d}).attr("dy",10).attr("id","lblTxt").text(m):c.select("text#lblTxt").attr("dx",
function(){var c=b.xScale(a.getAttribute("stop"))+8*m.length+5,d=b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start"))+5;c>b.gsvg.width&&(d=-8*m.length);return d})}else c.selectAll("text#lblTxt").remove()});d+=b.trackYMax}b.trackYMax=15*d;b.svg.attr("height",b.trackYMax)}else if("annot"===b.colorSelect){b.drawLegend([{color:"#FF0000",label:"Core"},{color:"#0000FF",label:"Extended"},{color:"#006400",label:"Full"},{color:"#000000",label:"Ambiguous"}]);b.trackYMax=0;b.yMaxArr=[];b.yArr=
[];b.yArr[0]=[];for(c=0;c<b.gsvg.width;c++)b.yMaxArr[c]=0,b.yArr[0][c]=0;b.svg.selectAll("g.probe").attr("transform",function(a,c){return"translate("+b.xScale(a.getAttribute("start"))+","+b.calcY(parseInt(a.getAttribute("start"),10),parseInt(a.getAttribute("stop"),10),c,a.getAttribute("ID").length)+")"});b.svg.selectAll("g.probe rect").attr("width",function(a){var c=1;1<b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start"))&&(c=b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start")));
return c}).attr("fill",function(a){return b.color(a,"")});b.svg.selectAll("g.probe").each(function(a){var c=d3.select(this),d=">";"-1"==a.getAttribute("strand")&&(d="<");var g="",e=c.select("rect").attr("width");if(7.5<=e&&15>=e)g=d;else if(15<e)for(e-=7.5;7.5<e;)g+=d,e-=7.5;c.select("text").text(g);if(2==b.density||3==b.density){var p=a.getAttribute("ID");0===c.select("text#lblTxt").size()?c.append("svg:text").attr("dx",function(){var c=b.xScale(a.getAttribute("stop"))+8*p.length+5,d=b.xScale(a.getAttribute("stop"))-
b.xScale(a.getAttribute("start"))+5;c>b.gsvg.width&&(d=-8*p.length);return d}).attr("dy",10).attr("id","lblTxt").text(p):c.select("text#lblTxt").attr("dx",function(){var c=b.xScale(a.getAttribute("stop"))+8*p.length+5,d=b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start"))+5;c>b.gsvg.width&&(d=-8*p.length);return d})}else c.selectAll("text#lblTxt").remove()});1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(b.trackYMax+1)):3==b.density&&b.svg.attr("height",15*
(b.trackYMax+1))}}b.redrawSelectedArea()};b.update=function(a){b.redraw()};b.updateData=function(a){d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/probe.xml",function(c,d){if(c)if(3>a){var g=5E3;1==a&&(g=1E4);setTimeout(function(){b.updateData(a+1)},g)}else 3<=a&&(d3.select("#Level"+b.levelNumber+b.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+b.trackClass),d3.select("#Level"+b.levelNumber+b.trackClass).attr("height",15),b.gsvg.addTrackErrorRemove(b.svg,
"#Level"+b.gsvg.levelNumber+b.trackClass));else{if(d){g=d.documentElement.getElementsByTagName("probe");for(var e=[],h=[],f=0,l=0;l<b.data.length;l++)"undefined"!==typeof b.data[l]&&(e[f]=b.data[l],h[b.data[l].getAttribute("ID")]=1,f++);for(l=0;l<g.length;l++)"undefined"!==typeof g[l]&&"undefined"===typeof h[g[l].getAttribute("ID")]&&(e[f]=g[l],f++);b.draw(e)}b.hideLoading()}})};b.draw=function(a){b.data=a;b.colorSelect=b.curColor;b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(var c=0;c<b.gsvg.width;c++)b.yMaxArr[c]=
0,b.yArr[0][c]=0;if("dabg"==b.colorSelect||"herit"==b.colorSelect){"dabg"==b.colorSelect?b.drawScaleLegend("0%","100%","of Samples DABG","#000000","#00FF00",0):"herit"==b.colorSelect&&b.drawScaleLegend("0","1.0","Probeset Heritability","#000000","#FF0000",0);b.svg.selectAll(".probe").remove();b.svg.selectAll(".tissueLbl").remove();b.tissueLen=b.tissues.length;for(var d=1,e=0;e<b.tissues.length;e++){var m=new String(b.tissues[e]);0<m.indexOf(";")&&(m=m.substr(0,m.indexOf(";")));0<m.indexOf(":")&&(m=
m.substr(0,m.indexOf(":")));b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(c=0;c<b.gsvg.width;c++)b.yMaxArr[c]=0,b.yArr[0][c]=0;c=m;"BrownAdipose"==c?c="Brown Adipose":"Brain"==c&&(c="Whole Brain");c=new String("Tissue: "+c);d++;b.svg.append("text").attr("class","tissueLbl "+m).attr("x",b.gsvg.width/2-c.length/2*7.5).attr("y",15*d).text(c);0<a.length&&(c=b.svg.selectAll(".probe."+m).data(a,function(a){return keyTissue(a,m)}).attr("transform",function(a,c){return"translate("+b.xScale(a.getAttribute("start"))+
","+(b.calcY(parseInt(a.getAttribute("start"),10),parseInt(a.getAttribute("stop"),10),c,a.getAttribute("ID").length)+15*d-10)+")"}),c.enter().append("g").attr("class","probe "+m).attr("transform",function(a,c){return"translate("+b.xScale(a.getAttribute("start"))+","+(b.calcY(parseInt(a.getAttribute("start"),10),parseInt(a.getAttribute("stop"),10),c,a.getAttribute("ID").length)+15*d-10)+")"}).append("rect").attr("height",10).attr("rx",1).attr("ry",1).attr("width",function(a){var c=1;1<b.xScale(a.getAttribute("stop"))-
b.xScale(a.getAttribute("start"))&&(c=b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start")));return c}).attr("id",function(a){return a.getAttribute("ID")+m}).style("fill",function(a){return b.color(a,m)}).style("cursor","pointer").on("dblclick",b.zoomToFeature).on("mouseover",function(a){if(0==b.gsvg.isToolTip){overSelectable=1;$("#mouseHelp").html("<B>Double Click</B> to zoom in on this feature.");var c=d3.select(this);b.curTTColor=c.style("fill");0<c.style("opacity")&&(c.style("fill",
"green"),tt.transition().duration(200).style("opacity",1),tt.html(b.createToolTip(a)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)}),b.setupToolTipSVG(a,.2))}}).on("mouseout",function(a){overSelectable=0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");a=d3.select(this);0<a.style("opacity")&&(a.style("fill",b.curTTColor),tt.transition().delay(500).duration(200).style("opacity",
0))}),b.svg.selectAll("g.probe."+m).each(function(a){var c=d3.select(this),d=">";"-1"==a.getAttribute("strand")&&(d="<");var g=d,e=c.select("rect").attr("width");if(7.5>e)g="";else for(e-=7.5;8.5<e;)g+=d,e-=7.5;c.append("svg:text").attr("dx","1").attr("id","strand").attr("dy","10").style("pointer-events","none").style("fill","white").text(g);if(2==b.density||3==b.density){var h=a.getAttribute("ID");c.append("svg:text").attr("dx",function(){var c=b.xScale(a.getAttribute("stop"))+8*h.length+5,d=b.xScale(a.getAttribute("stop"))-
b.xScale(a.getAttribute("start"))+5;c>b.gsvg.width&&(d=-8*h.length);return d}).attr("dy",10).attr("id","lblTxt").text(h)}else c.selectAll("text#lblTxt").remove()}),d=d+b.trackYMax+1)}b.trackYMax=d;b.svg.attr("height",15*d+45)}else if("annot"==b.colorSelect){b.drawLegend([{color:"#FF0000",label:"Core"},{color:"#0000FF",label:"Extended"},{color:"#006400",label:"Full"},{color:"#000000",label:"Ambiguous"}]);b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(c=0;c<b.gsvg.width;c++)b.yMaxArr[c]=0,b.yArr[0][c]=
0;b.svg.selectAll(".probe").remove();b.svg.selectAll(".tissueLbl").remove();c=b.svg.selectAll(".probe.annot").data(a,key).attr("transform",function(a,c){return"translate("+b.xScale(a.getAttribute("start"))+","+b.calcY(parseInt(a.getAttribute("start"),10),parseInt(a.getAttribute("stop"),10),c,a.getAttribute("ID").length)+")"});c.enter().append("g").attr("class","probe annot").attr("transform",function(a,c){return"translate("+b.xScale(a.getAttribute("start"))+","+b.calcY(parseInt(a.getAttribute("start"),
10),parseInt(a.getAttribute("stop"),10),c,a.getAttribute("ID").length)+")"}).append("rect").attr("height",10).attr("rx",1).attr("ry",1).attr("width",function(a){var c=1;1<b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start"))&&(c=b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start")));return c}).attr("id",function(a){return a.getAttribute("ID")}).style("fill",function(a){return b.color(a,"")}).style("cursor","pointer").on("dblclick",b.zoomToFeature).on("mouseover",function(a){if(0==
b.gsvg.isToolTip){overSelectable=1;$("#mouseHelp").html("<B>Double Click</B> to zoom in on this feature.");var c=d3.select(this);0<c.style("opacity")&&(c.style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(b.createToolTip(a)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)}),b.setupToolTipSVG(a,.2))}}).on("mouseout",function(a){overSelectable=0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");
a=d3.select(this);0<a.style("opacity")&&(a.style("fill",b.color),tt.transition().delay(500).duration(200).style("opacity",0))});b.svg.selectAll("g.probe").each(function(a){var c=d3.select(this),d=">";"-1"==a.getAttribute("strand")&&(d="<");var g=d,e=c.select("rect").attr("width");if(7.5>e)g="";else for(e-=7.5;15<e;)g+=d,e-=7.5;c.append("svg:text").attr("dx","1").attr("dy","10").style("pointer-events","none").style("fill","white").text(g);if(2==b.density||3==b.density){var h=a.getAttribute("ID");c.append("svg:text").attr("dx",
function(){var c=b.xScale(a.getAttribute("stop"))+8*h.length+5,d=b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start"))+5;c>b.gsvg.width&&(d=-8*h.length);return d}).attr("dy",10).attr("id","lblTxt").text(h)}else c.select("text#lblTxt").remove()});1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(b.trackYMax+1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1))}b.redrawSelectedArea()};b.getDisplayedData=function(){var a=d3.select("#Level"+b.gsvg.levelNumber+
b.trackClass).selectAll("g.probe");b.counts=[{value:0,names:"Core"},{value:0,names:"Extended"},{value:0,names:"Full"},{value:0,names:"Ambiguous"}];var c=[],d=0;a.each(function(a){var g=b.xScale(a.getAttribute("start")),e=b.xScale(a.getAttribute("stop"));if(0<=g&&g<=b.gsvg.width||0<=e&&e<=b.gsvg.width)"core"==a.getAttribute("type")?b.counts[0].value++:"extended"==a.getAttribute("type")?b.counts[1].value++:"full"==a.getAttribute("type")?b.counts[2].value++:"ambiguous"==a.getAttribute("type")&&b.counts[3].value++,
c[d]=a,d++});0===a.size()&&(b.counts=[]);return c};b.generateSettingsDiv=function(a){var c=trackInfo[b.trackClass];b.savePrevious();d3.select(a).select("table").select("tbody").html("");if("undefined"!==typeof c&&"undefined"!==typeof c.Controls&&"null"!=c.Controls&&0<c.Controls.length){var d=(new String(c.Controls)).split(",");a=d3.select(a).select("table").select("tbody");a.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name);for(c=0;c<d.length;c++)if("undefined"!==
typeof d[c]&&""!=d[c]){var e=d[c].split(";"),m=a.append("tr").append("td"),h=e[0].substr(5);3<e.length&&0==e[3].indexOf("Default=")&&e[3].substr(8);if(0==e[1].toLowerCase().indexOf("select")){m.append("text").text(h+": ");h=e[1].split(":");e=e[2].split("}");var f=b.trackClass+"Dense"+b.level+"Select";"colorSelect"==h[1]&&(f=b.trackClass+b.level+"colorSelect");for(var l=m.append("select").attr("id",f).attr("name",h[1]),n=0;n<e.length;n++){var t=e[n].substr(1).split(":");2==t.length&&(m=l.append("option").attr("value",
t[1]).text(t[0]),"colorSelect"==h[1]&&t[1]==b.curColor?m.attr("selected","selected"):t[1]==b.density&&m.attr("selected","selected"))}d3.select("select#"+f).on("change",function(){"dabg"==$(this).val()||"herit"==$(this).val()?$("div#affyTissues"+b.level).show():$("div#affyTissues"+b.level).hide();b.updateSettingsFromUI();b.redraw()})}else if(0==e[1].toLowerCase().indexOf("cbx"))for(m=m.append("div").attr("id","affyTissues"+b.level).style("display","none"),m.append("text").text(h+": "),h=e[1].split(":"),
e=e[2].split("}"),n=0;n<e.length;n++)t=e[n].substr(1).split(":"),2==t.length&&(f=m.append("div").style("display","inline-block"),l=f.append("input").attr("type","checkbox").attr("id",t[1]+"CBX"+b.level).attr("name",h[1]).style("margin-left","5px"),f.append("text").text(t[0]),d3.select("input#"+t[1]+"CBX"+b.level).on("change",function(){b.updateSettingsFromUI();b.redraw()}))}"dabg"==b.curColor||"herit"==b.curColor?$("div#affyTissues"+b.level).show():$("div#affyTissues"+b.level).hide();for(d=0;d<b.tissues.length;d++)$("#"+
b.tissues[d]+"AffyCBX"+b.level).prop("checked",!0);d=a.append("tr").append("td");d.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");b.gsvg.removeTrack(b.trackClass);var a=svgList[b.gsvg.levelNumber].currentView.ViewID,c=viewMenu[b.gsvg.levelNumber].findTrackByClass(b.trackClass,a);c=viewMenu[b.gsvg.levelNumber].findTrackIndexWithViewID(c.TrackID,a);viewMenu[b.gsvg.levelNumber].removeTrackWithIDIdx(c,
a)});d.append("input").attr("type","button").attr("value","Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");b.density==b.prevSetting.density&&b.curColor==b.prevSetting.curColor&&b.tissues==b.prevSetting.tissues||b.gsvg.setCurrentViewModified()});d.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){b.revertPrevious();b.draw(b.data);$("#trackSettingDialog").fadeOut("fast")})}else a=
d3.select(a).select("table").select("tbody"),a.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name),a.append("tr").append("td").html("Sorry no settings for this track."),d=a.append("tr").append("td"),d.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")}),d.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left",
"5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")})};b.generateTrackSettingString=function(){for(var a="",c=0;c<b.tissues.length;c++)0<c&&(a+=":"),a+=b.tissues[c];return b.trackClass+","+b.density+","+b.curColor+","+a+";"};b.draw(e);return b}
function SNPTrack(f,e,l,n,c){var b=Track(f,e,l,a);f=(new String(l)).substr(3);c=(new String(c)).split(",");b.include=0<c.length?c[0]:4;b.density=n;var a=f;"SHRH"==a?a="SHR/OlaPrin":"BNLX"==a?a="BN-Lx/CubPrin":"SHRJ"==a&&(a="SHR/NCrlPrin");b.displayStrain=a;1==b.include?a+=" SNPs":2==b.include?a+=" Insertions":3==b.include?a+=" Deletions":4==b.include&&(a+=" SNPs/Indels");b.counts=[{value:0,perc:0,names:"SNP "+b.displayStrain},{value:0,perc:0,names:"Insertion "+b.displayStrain},{value:0,perc:0,names:"Deletion "+
b.displayStrain}];b.strain=f;b.ttTrackList=[];b.ttTrackList.push("ensemblcoding");b.ttTrackList.push("braincoding");b.ttTrackList.push("liverTotal");b.ttTrackList.push("heartTotal");b.ttTrackList.push("mergedTotal");b.ttTrackList.push("refSeq");b.ttTrackList.push("ensemblnoncoding");b.ttTrackList.push("brainnoncoding");b.ttTrackList.push("ensemblsmallnc");b.ttTrackList.push("brainsmallnc");b.ttTrackList.push("probe");b.ttTrackList.push("repeatMask");b.xPadding=1;b.scanBackYLines=50;b.updateSettingsFromUI=
function(){0<$("#"+b.trackClass+"Dense"+b.level+"Select").length&&(b.density=$("#"+b.trackClass+"Dense"+b.level+"Select").val());0<$("#"+b.trackClass+b.level+"Select").length&&(b.include=$("#"+b.trackClass+b.level+"Select").val())};b.savePrevious=function(){b.prevSetting={};b.prevSetting.density=b.density;b.prevSetting.include=b.include};b.revertPrevious=function(){b.density=b.prevSetting.density;b.include=b.prevSetting.include};b.generateTrackSettingString=function(){return b.trackClass+","+b.density+
","+b.include+";"};b.generateSettingsDiv=function(a){var c=trackInfo[b.trackClass];b.savePrevious();d3.select(a).select("table").select("tbody").html("");if(0<c.Controls.length&&"null"!=c.Controls){var g=(new String(c.Controls)).split(",");a=d3.select(a).select("table").select("tbody");a.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name);for(c=0;c<g.length;c++)if("undefined"!==typeof g[c]&&""!=g[c]){var e=g[c].split(";"),h=a.append("tr").append("td"),f=e[0].substr(5);
h.append("text").text(f+": ");3<e.length&&0==e[3].indexOf("Default=")&&e[3].substr(8);if(0==e[1].toLowerCase().indexOf("select")){var l=e[1].split(":");e=e[2].split("}");var n=f="";2<l.length&&(f=l[2]);3<l.length&&(n=l[3]);h=h.append("select").attr("id",b.trackClass+f+b.level+n).attr("name",l[1]);for(l=0;l<e.length;l++){var t=e[l].substr(1).split(":");if(2==t.length){var y=h.append("option").attr("value",t[1]).text(t[0]);("Dense"==f&&t[1]==b.density||""==f&&t[1]==b.include)&&y.attr("selected","selected")}}d3.select("#"+
b.trackClass+f+b.level+n).on("change",function(){b.updateSettingsFromUI();b.updateData()})}else console.log("Undefined track settings:  "+g[c])}g=a.append("tr").append("td");g.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");b.gsvg.removeTrack(b.trackClass);var a=svgList[b.gsvg.levelNumber].currentView.ViewID,c=viewMenu[b.gsvg.levelNumber].findTrackByClass(b.trackClass,
a);c=viewMenu[b.gsvg.levelNumber].findTrackIndexWithViewID(c.TrackID,a);viewMenu[b.gsvg.levelNumber].removeTrackWithIDIdx(c,a)});g.append("input").attr("type","button").attr("value","Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");b.density==b.prevSetting.density&&b.include==b.prevSetting.include||b.gsvg.setCurrentViewModified()});g.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left",
"5px").on("click",function(){b.revertPrevious();b.draw(b.data);$("#trackSettingDialog").fadeOut("fast")})}else a=d3.select(a).select("table").select("tbody"),a.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name),a.append("tr").append("td").html("Sorry no settings for this track."),g=a.append("tr").append("td"),g.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")}),
g.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")})};b.redraw=function(){b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(var a=0;a<b.gsvg.width;a++)b.yMaxArr[a]=0,b.yArr[0][a]=0;b.svg.selectAll("g.snp").attr("transform",function(a,c){return"translate("+b.xScale(a.getAttribute("start"))+","+b.calcY(parseInt(a.getAttribute("start"),10),parseInt(a.getAttribute("stop"),10),
c)+")"});b.svg.selectAll("g.snp rect").attr("width",function(a){var c=1;1<b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start"))&&(c=b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start")));return c});6<b.xScale(b.xScale.domain()[0]+1)?b.svg.selectAll(".snp").each(function(a){var c=b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start")),d=new String(a.getAttribute("strainSeq")),g="8px",e=3.2,f=8;"SNP"!=a.getAttribute("type")&&(g="7px",e=3,f=7);0==d3.select(this).selectAll("text").size()&&
d.length*e<c?d3.select(this).append("text").attr("y",f).attr("x",function(a){a=0;7<c&&(a=c/2-d.length/2*e);return a}).attr("font-size",g).attr("stroke",d3.rgb("#FFFFFF")).attr("class","snpLbl").text(d):d3.select(this).selectAll(".snpLbl").attr("x",function(a){a=0;7<c&&(a=c/2-d.length/2*e);return a})}):b.svg.selectAll("text.snpLbl").remove();1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(b.trackYMax+1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1));b.redrawSelectedArea()};
b.color=function(a){d3.rgb("#000000");return"SNP"===a.getAttribute("type")?"BNLX"===a.getAttribute("strain")?d3.rgb(0,0,255):"SHRH"===a.getAttribute("strain")?d3.rgb(255,0,0):"SHRJ"===a.getAttribute("strain")?d3.rgb("#00FF00"):"F344"===a.getAttribute("strain")?d3.rgb("#00FFFF"):d3.rgb(100,100,100):"BNLX"===a.getAttribute("strain")?d3.rgb(0,0,150):"SHRH"===a.getAttribute("strain")?d3.rgb(150,0,0):"SHRJ"===a.getAttribute("strain")?d3.rgb("#009600"):"F344"===a.getAttribute("strain")?d3.rgb("#009696"):
d3.rgb(50,50,50)};b.getDisplayID=function(a){return a.getAttribute("type")+"_"+keySNP(a)};b.createToolTip=function(a){var b=a.getAttribute("strain");"SHRH"==b&&(b="SHR");b='<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>Type: '+a.getAttribute("type")+"<BR>Strain: "+b+"<BR>Sequence: "+a.getAttribute("refSeq")+"->"+a.getAttribute("strainSeq")+"<BR>Location: chr"+a.getAttribute("chromosome")+":"+numberWithCommas(a.getAttribute("start"));"SNP"!=a.getAttribute("type")&&(b=b+"-"+numberWithCommas(a.getAttribute("stop")));
return b};b.update=function(a){b.redraw()};b.updateData=function(a){d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/snp"+b.strain+".xml",function(c,g){if(c)if(3>a){var d=1E4;1==a&&(d=15E3);setTimeout(function(){b.updateData(a+1)},d)}else 3<=a&&(d3.select("#Level"+b.levelNumber+b.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+b.trackClass),d3.select("#Level"+b.levelNumber+b.trackClass).attr("height",15),b.gsvg.addTrackErrorRemove(b.svg,
"#Level"+b.gsvg.levelNumber+b.trackClass));else{d=g.documentElement.getElementsByTagName("Snp");for(var e=[],p=[],f=0,l=0;l<d.length;l++)"undefined"!==typeof d[l]&&(e[f]=d[l],p[keySNP(d[l])]=1,f++);for(l=0;l<b.data.length;l++)"undefined"!==typeof b.data[l]&&"undefined"===typeof p[keySNP(b.data[l])]&&(e[f]=b.data[l],f++);b.draw(e);b.hideLoading()}})};b.getDisplayedData=function(){var a=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".snp");b.counts=[{value:0,perc:0,names:"SNP"},{value:0,
perc:0,names:"Insertion"},{value:0,perc:0,names:"Deletion"}];var c=[],e=0,m=0;a.each(function(a){var d=b.xScale(a.getAttribute("start")),g=b.xScale(a.getAttribute("stop"));if(0<=d&&d<=b.gsvg.width||0<=g&&g<=b.gsvg.width)d=0,"Insertion"==a.getAttribute("type")?d++:"Deletion"==a.getAttribute("type")&&(d+=2),b.counts[d].value++,c[e]=a,e++,m++});return c};b.draw=function(a){b.data=a;b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(var c=0;c<b.gsvg.width;c++)b.yMaxArr[c]=0,b.yArr[0][c]=0;c=b.strain;
"SHRH"==c?c="SHR/OlaPrin":"BNLX"==c?c="BN-Lx/CubPrin":"SHRJ"==c&&(c="SHR/NCrlPrin");1==b.include?c+=" SNPs":2==b.include?c+=" Insertions":3==b.include?c+=" Deletions":4==b.include&&(c+=" SNPs/Indels");b.updateLabel(c);b.redrawLegend();if(4>b.include){c=[];for(var g=0,e=0;e<a.length;e++)"undefined"!==typeof a[e]&&(1==b.include&&"SNP"==a[e].getAttribute("type")?(c[g]=a[e],g++):2==b.include&&"Insertion"==a[e].getAttribute("type")?(c[g]=a[e],g++):3==b.include&&"Deletion"==a[e].getAttribute("type")&&(c[g]=
a[e],g++));b.data=c}b.svg.selectAll(".snp").remove();0<b.data.length&&(a=b.svg.selectAll(".snp").data(a,keySNP).attr("transform",function(a,c){return"translate("+b.xScale(a.getAttribute("start"))+","+b.calcY(parseInt(a.getAttribute("start"),10),parseInt(a.getAttribute("stop"),10),c)+")"}),a.enter().append("g").attr("class","snp").attr("transform",function(a,c){return"translate("+b.xScale(a.getAttribute("start"))+","+b.calcY(parseInt(a.getAttribute("start"),10),parseInt(a.getAttribute("stop"),10),
c)+")"}).append("rect").attr("height",10).attr("rx",1).attr("ry",1).attr("width",function(a){var c=1;1<b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start"))&&(c=b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start")));return c}).attr("id",keySNP).style("fill",b.color).on("mouseover",function(a){0==b.gsvg.isToolTip&&(d3.select(this).style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(b.createToolTip(a)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",
function(){return b.positionTTTop(d3.event.pageY)}),b.setupToolTipSVG(a,.2))}).on("mouseout",function(a){d3.select(this).style("fill",b.color);tt.transition().delay(500).duration(200).style("opacity",0)}),1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(b.trackYMax+1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1)),a.merge(a),a.exit().remove());b.redrawSelectedArea()};b.pieColor=function(a,c){var d=d3.rgb("#000000"),g=new String(a.data.names);"BNLX"==b.strain?d=-1<
g.indexOf("SNP")?d3.rgb(0,0,255):-1<g.indexOf("Insertion")?d3.rgb(0,0,175):d3.rgb(0,0,125):"SHRJ"==b.strain?d=-1<g.indexOf("SNP")?d3.rgb(0,255,0):-1<g.indexOf("Insertion")?d3.rgb(0,175,0):d3.rgb(0,125,0):"F344"==b.strain?d=-1<g.indexOf("SNP")?d3.rgb(0,255,255):-1<g.indexOf("Insertion")?d3.rgb(0,175,175):d3.rgb(0,125,125):"SHRH"==b.strain&&(d=-1<g.indexOf("SNP")?d3.rgb(255,0,0):-1<g.indexOf("Insertion")?d3.rgb(175,0,0):d3.rgb(125,0,0));return d};b.redrawLegend=function(){var a=[];4==b.include?a="BNLX"==
b.strain?[{color:"#0000FF",label:"SNP"},{color:"#000096",label:"Insertion/Deletion"}]:"SHRH"==b.strain?[{color:"#FF0000",label:"SNP"},{color:"#960000",label:"Insertion/Deletion"}]:"SHRJ"==b.strain?[{color:"#00FF00",label:"SNP"},{color:"#009600",label:"Insertion/Deletion"}]:"F344"==b.strain?[{color:"#00FFFF",label:"SNP"},{color:"#009696",label:"Insertion/Deletion"}]:[{color:"#DEDEDE",label:"SNP"},{color:"#969696",label:"Insertion/Deletion"}]:3==b.include||2==b.include?a="BNLX"==b.strain?[{color:"#000096",
label:"Insertion/Deletion"}]:"SHRH"==b.strain?[{color:"#960000",label:"Insertion/Deletion"}]:"SHRJ"==b.strain?[{color:"#009600",label:"Insertion/Deletion"}]:"F344"==b.strain?[{color:"#009696",label:"Insertion/Deletion"}]:[{color:"#969696",label:"Insertion/Deletion"}]:1==b.include&&(a="BNLX"==b.strain?[{color:"#0000FF",label:"SNP"}]:"SHRH"==b.strain?[{color:"#FF0000",label:"SNP"}]:"SHRJ"==b.strain?[{color:"#00FF00",label:"SNP"}]:"F344"==b.strain?[{color:"#00FFFF",label:"SNP"}]:[{color:"#DEDEDE",label:"SNP"}]);
b.drawLegend(a)};b.strain=f;b.redrawLegend();b.draw(e);return b}
function QTLTrack(f,e,l,n){var c=Track(f,e,l,"QTLs Overlapping Region");c.color=function(b){return c.pieColorPalette(b)};c.redraw=function(){c.yCount=0;c.idList=[];c.svg.selectAll("g.qtl").attr("transform",function(b,a){return"translate("+c.xScale(b.getAttribute("start"))+","+c.calcY(b,a)+")"});d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll("g.qtl rect").attr("width",function(b){var a=1;1<c.xScale(b.getAttribute("stop"))-c.xScale(b.getAttribute("start"))&&(a=c.xScale(b.getAttribute("stop"))-
c.xScale(b.getAttribute("start")));return a});c.svg.attr("height",15*c.yCount);c.redrawSelectedArea()};c.createToolTip=function(b){return"Name: "+b.getAttribute("name")+"<BR>Location: "+b.getAttribute("chromosome")+":"+numberWithCommas(b.getAttribute("start"))+"-"+numberWithCommas(b.getAttribute("stop"))+"<BR>Trait:<BR>"+b.getAttribute("trait")+"<BR><BR>Phenotype:<BR>"+b.getAttribute("phenotype")+"<BR><BR>Candidate Genes:<BR>"+b.getAttribute("candidate")};c.pieColorPalette=d3.scaleOrdinal(d3.schemeCategory20);
c.pieColor=function(b){return c.pieColorPalette(b.data.names)};c.triggerTableFilter=function(b){var a=jQuery.Event("keyup");a.which=32;var c="";"undefined"===typeof b.getAttribute||"undefined"===typeof b.getAttribute("ID")?"undefined"!==typeof b.data&&"undefined"!==typeof b.data.names&&(c=b.data.names):c=b.getAttribute("ID");$("#tblBQTL_filter input").val(c).trigger(a)};c.clearTableFilter=function(b){b=jQuery.Event("keyup");b.which=32;$("#tblBQTL_filter input").val("").trigger(b)};c.getDisplayedData=
function(){var b=d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll(".qtl");c.counts=[];var a=0,g=b.data();console.log(b);console.log(g);b=[];var d=0,e=0;if("undefined"!==typeof g)for(var m=0;m<g.length;m++){var h=c.xScale(g[m].getAttribute("start")),f=c.xScale(g[m].getAttribute("stop"));if(0<=h&&h<=c.gsvg.width||0<=f&&f<=c.gsvg.width||0>=h&&f>=c.gsvg.width)h=new String(g[m].getAttribute("name")),f=/[0-9]+\s*$/g,f=h.search(f),-1<f&&(h=h.substr(0,f)),f=/QTL\s*$/g,f=h.search(f),-1<f&&(h=
h.substr(0,f)),f=/traits+\s*$/g,f=h.search(f),-1<f&&(h=h.substr(0,f+5)),"undefined"===typeof c.counts[h]?(c.counts[h]={},c.counts[a]=c.counts[h],a++,c.counts[h].value=1,c.counts[h].names=h):c.counts[h].value++,b[d]=g[m],d++,e++}return b};c.setupDetailedView=function(b){$("div#collapsableReport").is(":hidden")||($("div#collapsableReport").hide(),$("span[name='collapsableReport']").removeClass("less"));$("div#selectedDetailHeader").is(":hidden")&&$("div#selectedDetailHeader").show();$("div#selectedDetail").is(":hidden")&&
$("div#selectedDetail").show();$("div#selectedImage").hide();$("div#selectedReport").show();var a=pathPrefix+"bQTLReport.jsp";b={id:b.getAttribute("ID"),species:organism,genomeVer:genomeVer};DisplaySelectedDetailReport(a,b)};c.updateData=function(b){d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.gsvg.folderName+"/qtl.xml",function(a,g){if(a)if(3>b){var d=1E4;1==b&&(d=15E3);setTimeout(function(){c.updateData(b+1)},d)}else d3.select("#Level"+c.levelNumber+c.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+
c.trackClass),d3.select("#Level"+c.levelNumber+c.trackClass).attr("height",15),c.gsvg.addTrackErrorRemove(c.svg,"#Level"+c.gsvg.levelNumber+c.trackClass);else{if(g){d=g.documentElement.getElementsByTagName("QTL");for(var e=[],m=[],h=0,f=0;f<d.length;f++)"undefined"!==typeof d[f]&&(e[h]=d[f],m[d[f].getAttribute("ID")]=1,h++);for(f=0;f<c.data.length;f++)"undefined"!==typeof c.data[f]&&"undefined"===typeof m[c.data[f].getAttribute("ID")]&&(e[h]=c.data[f],h++);c.draw(e)}c.hideLoading()}})};c.calcY=function(b,
a){var g=0;"undefined"===typeof c.idList[b.getAttribute("ID")]&&(g=c.yCount++);return 15*(g+1)};c.draw=function(b){c.data=b;c.yCount=0;c.idList=[];c.data&&0<c.data.length?(console.log(c.svg),console.log(c.svg.selectAll(".qtl")),b=c.svg.selectAll(".qtl").data(b,key),console.log(b),b.enter().append("g").attr("class","qtl").attr("transform",function(a,b){return"translate("+c.xScale(a.getAttribute("start"))+","+c.calcY(a,b)+")"}).append("rect").attr("height",10).attr("rx",1).attr("ry",1).attr("width",
function(a){var b=1;1<c.xScale(a.getAttribute("stop"))-c.xScale(a.getAttribute("start"))&&(b=c.xScale(a.getAttribute("stop"))-c.xScale(a.getAttribute("start")));return b}).attr("id",function(a){return a.getAttribute("id")}).style("fill","blue").style("cursor","pointer").on("click",c.setupDetailedView).on("mouseover",function(a){0==c.gsvg.isToolTip&&(overSelectable=1,$("#mouseHelp").html("<B>Click</B> to see additional details. <B>Double Click</B> to zoom in on this feature."),d3.select(this).style("fill",
"green"),tt.transition().duration(200).style("opacity",1),tt.html(c.createToolTip(a)).style("left",function(){return c.positionTTLeft(d3.event.pageX)}).style("top",function(){return c.positionTTTop(d3.event.pageY)}),c.triggerTableFilter(a))}).on("mouseout",function(a){overSelectable=0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");var b=a.getAttribute("name"),d=/[0-9]+\s*$/g;d=b.search(d);-1<d&&(b=b.substr(0,d));d=/QTL\s*$/g;d=b.search(d);-1<d&&
(b=b.substr(0,d));d=/traits?\s*$/g;d=b.search(d);-1<d&&(b=b.substr(0,d+5));d3.select(this).style("fill",c.color(b));tt.transition().delay(500).duration(200).style("opacity",0);c.clearTableFilter(a)}).merge(b),b.exit().remove(),"undefined"!==typeof b[0]&&b[0].forEach(function(a){if("undefined"!==typeof a){var b=new String(a.data().getAttribute("name")),d=/[0-9]+\s*$/g;d=b.search(d);-1<d&&(b=b.substr(0,d));d=/QTL\s*$/g;d=b.search(d);-1<d&&(b=b.substr(0,d));d=/traits?\s*$/g;d=b.search(d);-1<d&&(b=b.substr(0,
d+5));d3.select(a).select("rect").style("fill",c.color(b))}}),c.svg.attr("height",15*c.yCount)):c.svg.attr("height",15);c.redrawSelectedArea()};c.draw(e);c.redraw();return c}
function TranscriptTrack(f,e,l,n){var c=Track(f,e,l,"Selected Gene Transcripts");c.createToolTip=function(b){var a=".";1==b.getAttribute("strand")?a="+":-1==b.getAttribute("strand")&&(a="-");a="ID: "+b.getAttribute("ID")+"<BR>Location: chr"+b.getAttribute("chromosome")+":"+numberWithCommas(b.getAttribute("start"))+"-"+numberWithCommas(b.getAttribute("stop"))+"<BR>Strand: "+a;-1==(new String(b.getAttribute("ID"))).indexOf("ENS")&&(b=getFirstChildByName(getFirstChildByName(b,"annotationList"),"annotation"),
null!=b&&(a+="<BR>Matching: "+b.getAttribute("reason")));return a};c.color=function(b){var a=d3.rgb("#000000");"protein"==c.gsvg.txType?a=-1<(new String(b.getAttribute("ID"))).indexOf("ENS")?d3.rgb("#DFC184"):d3.rgb("#7EB5D6"):"long"==c.gsvg.txType?a=-1<(new String(b.getAttribute("ID"))).indexOf("ENS")?d3.rgb("#B58AA5"):d3.rgb("#CECFCE"):"small"==c.gsvg.txType?a=-1<(new String(b.getAttribute("ID"))).indexOf("ENS")?d3.rgb("#FFCC00"):d3.rgb("#99CC99"):"liverTotal"==c.gsvg.txType?a=d3.rgb("#bbbedd"):
"heartTotal"==c.gsvg.txType?a=d3.rgb("#DC7252"):"mergedTotal"==c.gsvg.txType&&(a=d3.rgb("#9F4F92"));return a};c.drawTrx=function(b,a){var g=parseInt(b.getAttribute("start"),10),d=parseInt(b.getAttribute("stop"),10);"undefined"!==typeof b.getAttribute("cdsStart")&&"undefined"!==typeof b.getAttribute("cdsStop")&&(g=parseInt(b.getAttribute("cdsStart"),10),d=parseInt(b.getAttribute("cdsStop"),10));var e=d3.select("#Level"+c.gsvg.levelNumber+c.trackClass+" #tx"+b.getAttribute("ID"));exList=getAllChildrenByName(getFirstChildByName(b,
"exonList"),"exon");for(var f=0;f<exList.length;f++){var h=parseInt(exList[f].getAttribute("start"),10),l=parseInt(exList[f].getAttribute("stop"),10);if(h<g&&g<l||l>d&&d>h){var n=0,u=0,t=0,y=0;h<g?(n=c.xScale(exList[f].getAttribute("start")),u=c.xScale(g)-c.xScale(exList[f].getAttribute("start")),t=c.xScale(g),y=c.xScale(exList[f].getAttribute("stop"))-c.xScale(g)):l>d&&(t=c.xScale(exList[f].getAttribute("start")),y=c.xScale(d)-c.xScale(exList[f].getAttribute("start")),n=c.xScale(d),u=c.xScale(exList[f].getAttribute("stop"))-
c.xScale(d));e.append("rect").attr("x",n).attr("y",2.5).attr("height",5).attr("width",u).attr("title",function(a){return exList[f].getAttribute("ID")}).attr("id",function(a){return"ExNC"+exList[f].getAttribute("ID")}).style("fill",c.color).style("cursor","pointer");e.append("rect").attr("x",t).attr("height",10).attr("width",y).attr("title",function(a){return exList[f].getAttribute("ID")}).attr("id",function(a){return"Ex"+exList[f].getAttribute("ID")}).style("fill",c.color).style("cursor","pointer")}else{n=
10;u=0;if(h<g&&l<g||l>d&&h>d)n=5,u=2.5;e.append("rect").attr("x",function(a){return c.xScale(exList[f].getAttribute("start"))}).attr("y",u).attr("height",n).attr("width",function(a){return c.xScale(exList[f].getAttribute("stop"))-c.xScale(exList[f].getAttribute("start"))}).attr("title",function(a){return exList[f].getAttribute("ID")}).attr("id",function(a){return"Ex"+exList[f].getAttribute("ID")}).style("fill",c.color).style("cursor","pointer")}if(0<f){e.append("line").attr("x1",function(a){return c.xScale(exList[f-
1].getAttribute("stop"))}).attr("x2",function(a){return c.xScale(exList[f].getAttribute("start"))}).attr("y1",5).attr("y2",5).attr("id",function(a){return"Int"+exList[f-1].getAttribute("ID")+"_"+exList[f].getAttribute("ID")}).attr("stroke",c.color).attr("stroke-width","2");h=">";"-1"==b.getAttribute("strand")&&(h="<");l=h;n=c.xScale(exList[f-1].getAttribute("stop"));u=c.xScale(exList[f].getAttribute("start"))-n;t=0;if(7>u)l="";else for(u-=7;8<u;)0==t?(l+=" ",t=1):(l+=h,t=0),u-=7;e.append("svg:text").attr("id",
function(a){return"IntTxt"+exList[f-1].getAttribute("ID")+"_"+exList[f].getAttribute("ID")}).attr("dx",n+1).attr("dy","11").style("pointer-events","none").style("opacity","0.5").style("fill",c.color).style("font-size","16px").text(l)}}};c.redraw=function(){d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll("g.trx"+c.gsvg.levelNumber).each(function(b,a){var g=parseInt(b.getAttribute("start"),10),d=parseInt(b.getAttribute("stop"),10);"undefined"!==typeof b.getAttribute("cdsStart")&&"undefined"!==
typeof b.getAttribute("cdsStop")&&(g=parseInt(b.getAttribute("cdsStart"),10),d=parseInt(b.getAttribute("cdsStop"),10));exList=getAllChildrenByName(getFirstChildByName(b,"exonList"),"exon");for(var e=0;e<exList.length;e++){var f=parseInt(exList[e].getAttribute("start"),10),h=parseInt(exList[e].getAttribute("stop"),10);if(f<g&&g<h||h>d&&d>f){var l=f,n=g;h>d?(l=d,n=h,h=d):f=g;d3.select("#Level"+c.gsvg.levelNumber+c.trackClass+" g#tx"+b.getAttribute("ID")+" rect#ExNC"+exList[e].getAttribute("ID")).attr("x",
function(a){return c.xScale(l)}).attr("width",function(a){return c.xScale(n)-c.xScale(l)})}d3.select("#Level"+c.gsvg.levelNumber+c.trackClass+" g#tx"+b.getAttribute("ID")+" rect#Ex"+exList[e].getAttribute("ID")).attr("x",function(a){return c.xScale(f)}).attr("width",function(a){return c.xScale(h)-c.xScale(f)});if(0<e){var u=">";"-1"==b.getAttribute("strand")&&(u="<");var t=u,y=c.xScale(exList[e-1].getAttribute("stop")),v=c.xScale(exList[e].getAttribute("start")),w=v-y,z=0;if(7>w)t="";else for(w-=
7;8<w;)0==z?(t+=" ",z=1):(t+=u,z=0),w-=7;d3.select("#Level"+c.gsvg.levelNumber+c.trackClass+" g#tx"+b.getAttribute("ID")+" line#Int"+exList[e-1].getAttribute("ID")+"_"+exList[e].getAttribute("ID")).attr("x1",y).attr("x2",v);d3.select("#Level"+c.gsvg.levelNumber+c.trackClass+" g#tx"+b.getAttribute("ID")+" #IntTxt"+exList[e-1].getAttribute("ID")+"_"+exList[e].getAttribute("ID")).attr("dx",y+1).text(t)}}});c.redrawSelectedArea()};c.update=function(){var b=getAllChildrenByName(getFirstChildByName(c.gsvg.selectedData,
"TranscriptList"),"Transcript"),a=parseInt(c.gsvg.selectedData.getAttribute("start"),10),g=parseInt(c.gsvg.selectedData.getAttribute("stop"),10);"undefined"!==typeof c.gsvg.selectedData.getAttribute("extStart")&&"undefined"!==typeof c.gsvg.selectedData.getAttribute("extStop")&&(a=parseInt(c.gsvg.selectedData.getAttribute("extStart"),10),g=parseInt(c.gsvg.selectedData.getAttribute("extStop"),10));c.txMin=a;c.txMax=g;c.svg.attr("height",15*(1+b.length));d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll(".trx"+
c.gsvg.levelNumber).remove();b=d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll(".trx"+c.gsvg.levelNumber).data(b,key).attr("transform",function(a,b){return"translate("+c.xScale(a.getAttribute("start"))+","+c.calcY(a,b)+")"});b.enter().append("g").attr("class","trx"+c.gsvg.levelNumber).attr("transform",function(a,b){return"translate(0,"+c.calcY(a,b)+")"}).attr("id",function(a){return a.getAttribute("ID")}).style("cursor","pointer").on("mouseover",function(a){0==c.gsvg.isToolTip&&(d3.select(this).selectAll("line").style("stroke",
"green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(c.createToolTip(a)).style("left",function(){return c.positionTTLeft(d3.event.pageX)}).style("top",function(){return c.positionTTTop(d3.event.pageY)}))}).on("mouseout",function(a){d3.select(this).selectAll("line").style("stroke",c.color);d3.select(this).selectAll("rect").style("fill",c.color);d3.select(this).selectAll("text").style("opacity",
"0.6").style("fill",c.color);tt.transition().delay(500).duration(200).style("opacity",0)}).each(c.drawTrx);b.exit().remove();c.svg.selectAll(".legend").remove();b=[];"protein"==c.gsvg.txType?b=[{color:"#DFC184",label:"Ensembl"},{color:"#7EB5D6",label:"RNA-Seq"}]:"long"==c.gsvg.txType?b=[{color:"#B58AA5",label:"Ensembl"},{color:"#CECFCE",label:"RNA-Seq"}]:"small"==c.gsvg.txType?b=[{color:"#FFCC00",label:"Ensembl"},{color:"#99CC99",label:"RNA-Seq"}]:"liverTotal"==c.gsvg.txType?b=[{color:"#bbbedd",label:"Liver RNA-Seq"}]:
"mergedTotal"==c.gsvg.txType&&(b=[{color:"#9F4F92",label:"Merged RNA-Seq"}]);c.drawLegend(b)};c.calcY=function(b,a){return 15*(a+1)};c.redrawLegend=function(){};"undefined"!==typeof c.gsvg.selectedData.getAttribute("extStart")?(c.txMin=parseInt(c.gsvg.selectedData.getAttribute("extStart"),10),c.txMax=parseInt(c.gsvg.selectedData.getAttribute("extStop"),10)):(c.txMin=parseInt(c.gsvg.selectedData.getAttribute("start"),10),c.txMax=parseInt(c.gsvg.selectedData.getAttribute("stop"),10));d3.select("#Level"+
c.gsvg.levelNumber+c.trackClass).attr("height",15*(1+e.length));d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll(".trx"+c.gsvg.levelNumber).remove();f=d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll(".trx"+c.gsvg.levelNumber).data(e,key).attr("transform",function(b,a){return"translate("+c.xScale(b.getAttribute("start"))+","+c.calcY(b,a)+")"});f.enter().append("g").attr("class","trx"+c.gsvg.levelNumber).attr("transform",function(b,a){return"translate(0,"+c.calcY(b,a)+")"}).attr("id",
function(b){return"tx"+b.getAttribute("ID")}).style("cursor","pointer").on("mouseover",function(b){0==c.gsvg.isToolTip&&(d3.select(this).selectAll("line").style("stroke","green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(c.createToolTip(b)).style("left",function(){return c.positionTTLeft(d3.event.pageX)}).style("top",function(){return c.positionTTTop(d3.event.pageY)}))}).on("mouseout",
function(b){d3.select(this).selectAll("line").style("stroke",c.color);d3.select(this).selectAll("rect").style("fill",c.color);d3.select(this).selectAll("text").style("opacity","0.6").style("fill",c.color);tt.transition().delay(500).duration(200).style("opacity",0)}).each(c.drawTrx);f.exit().remove();c.redrawLegend();c.scaleSVG.transition().duration(300).style("opacity",1);c.svg.transition().duration(300).style("opacity",1);c.redraw();return c}
function HelicosTrack(f,e,l,n){f=CountTrack(f,e,l,n);f.graphColorText="#DD0000";f.updateLabel("Brain Helicos RNA Read Counts");f.redrawLegend();f.redraw();return f}function IlluminaSmallTrack(f,e,l,n){f=CountTrack(f,e,l,n);f.graphColorText="#99CC99";f.updateLabel("Brain Illumina Small RNA Read Counts");f.redrawLegend();f.redraw();f.redraw();return f}
function IlluminaTotalTrack(f,e,l,n){f=CountTrack(f,e,l,n);f.updateLabel("BNLx/SHR Brain Illumina Total-RNA(rRNA depleted) Read Counts");f.redrawLegend();return f}function LiverIlluminaTotalPlusTrack(f,e,l,n){f=CountTrack(f,e,l,n);f.graphColorText="#abaecd";f.updateLabel("BNLx/SHR Liver + Strand Total-RNA Read Counts");f.redrawLegend();f.redraw();return f}
function LiverIlluminaTotalMinusTrack(f,e,l,n){f=CountTrack(f,e,l,n);f.graphColorText="#dbdefd";f.updateLabel("BNLx/SHR Liver - Strand Total-RNA Read Counts");f.redrawLegend();f.redraw();return f}function LiverIlluminaSmallTrack(f,e,l,n){f=CountTrack(f,e,l,n);f.graphColorText="#7b7e9d";f.updateLabel("Liver  Illumina Small RNA Read Counts");f.redrawLegend();f.redraw();return f}
function HeartIlluminaTotalPlusTrack(f,e,l,n){f=CountTrack(f,e,l,n);f.graphColorText="#CC6242";f.updateLabel("BNLx/SHR Heart + Strand Total-RNA Read Counts");f.redrawLegend();f.redraw();return f}function HeartIlluminaTotalMinusTrack(f,e,l,n){f=CountTrack(f,e,l,n);f.graphColorText="#FC9272";f.updateLabel("BNLx/SHR Heart - Strand Total-RNA Read Counts");f.redrawLegend();f.redraw();return f}
function HeartIlluminaSmallTrack(f,e,l,n){f=CountTrack(f,e,l,n);f.graphColorText="#9C3212";f.updateLabel("Heart Illumina Small RNA Read Counts");f.redrawLegend();f.redraw();return f}function BrainIlluminaTotalPlusTrack(f,e,l,n){f=CountTrack(f,e,l,n);f.graphColorText="#7EB5D6";f.updateLabel("Brain + Strand Total-RNA Read Counts");f.redrawLegend();f.redraw();return f}
function BrainIlluminaTotalMinusTrack(f,e,l,n){f=CountTrack(f,e,l,n);f.updateLabel("Brain - Strand Total-RNA Read Counts");f.redrawLegend();f.redraw();return f}
function StrainSpecificIlluminaTotalTrack(f,e,l,n){e=CountTrack(f,e,l,n);n=l.substr(l.indexOf("-")+1);var c=".";0<l.indexOf("Plus")?c="+":0<l.indexOf("Minus")&&(c="-");l=l.substr(0,l.indexOf("illumina"));"brain"===l?l="Whole Brain":"liver"===l&&(l="Liver");e.graphColorText=f.strainSpecificCountColors(n);e.updateLabel(n+" "+l+" "+c+" Strand Total-RNA Read Counts");e.redrawLegend();e.redraw();return e}
function IlluminaPolyATrack(f,e,l,n){f=CountTrack(f,e,l,n);f.graphColorText="#7EB5D6";f.updateLabel("Brain Illumina PolyA+ RNA Read Counts");f.redrawLegend();f.redraw();return f}
function SpliceJunctionTrack(f,e,l,n,c,b){f=GenericTranscriptTrack(f,e,l,n,c,b);f.dataFileName=l+".xml";f.xmlTag="Feature";f.xmlTagBlockElem="block";f.idPrefix="splcJnct";"liverspliceJnct"===l?f.idPrefix="lvrsplcJnct":"heartspliceJnct"===l&&(f.idPrefix="hrtsplcJnct");f.ttSVG=1;f.ttTrackList=[];f.ttTrackList.push(l);f.ttTrackList.push("ensemblcoding");f.ttTrackList.push("braincoding");f.ttTrackList.push("brainTotal");f.ttTrackList.push("liverTotal");f.ttTrackList.push("heartTotal");f.ttTrackList.push("mergedTotal");
f.ttTrackList.push("refSeq");f.ttTrackList.push("repeatMask");"splcJnct"===l?f.ttTrackList.push("illuminaPolyA"):"liverspliceJnct"===l?(f.ttTrackList.push("liverilluminaTotalPlus"),f.ttTrackList.push("liverilluminaTotalMinus")):"heartspliceJnct"===l?(f.ttTrackList.push("heartilluminaTotalPlus"),f.ttTrackList.push("heartilluminaTotalMinus")):"brainspliceJnct"===l&&(f.ttTrackList.push("brainilluminaTotalPlus"),f.ttTrackList.push("brainilluminaTotalMinus"));f.colorValueField="readCount";f.colorScale=
d3.scaleLinear().domain([1,1E3]).range(["#E6E6E6","#000000"]);f.legendLbl="Read Depth";f.density=3;f.getDisplayID=function(a){return a.getAttribute("name")};f.createToolTip=function(a){var b='<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>ID: '+a.getAttribute("name");b=b+"<BR>Read Counts="+numberWithCommas(a.getAttribute("readCount"));b=b+"<BR>Splice Junction in "+a.getAttribute("sampleCount")+" of ";"Rn"===organism?b+="6 samples(3 BN-Lx, 3 SHR)":"Mm"===organism&&(b+="6 samples(3 ILS, 3 ISS)");
var c=getAllChildrenByName(getFirstChildByName(a,"blockList"),"block"),e=0,f=1,h="start",l="stop";-1==a.getAttribute("strand")&&(e=1,f=0,h="stop",l="start");b=b+"<BR><BR>Coverage Exon 1: "+numberWithCommas(c[e].getAttribute(h))+"-"+numberWithCommas(c[e].getAttribute(l))+" ("+(parseInt(c[e].getAttribute("stop"),10)-parseInt(c[e].getAttribute("start"),10))+" bp)";b=b+"<BR>Coverage Exon 2: "+numberWithCommas(c[f].getAttribute(h))+"-"+numberWithCommas(c[f].getAttribute(l))+" ("+(parseInt(c[f].getAttribute("stop"),
10)-parseInt(c[f].getAttribute("start"),10))+" bp)";return b=b+"<BR>Intron: "+numberWithCommas(parseInt(c[1].getAttribute("start"),10)-parseInt(c[0].getAttribute("stop"),10))+" bp<BR>"};f.drawScaleLegend("1","1000+","Read Counts","#E6E6E6","#000000",0);f.draw(e);return f}
function CustomCountTrack(f,e,l,n,c){var b=CountTrack(f,e,l,n);b.graphColorText="#4E85A6";b.updateControl=0;f="Custom Count Track";c=c.split(",");if(0<c.length)for(e=0;e<c.length;e++)0==e?b.dataFileName=c[e].substr(9):c[e].indexOf("Name=")&&(f=c[e].substr(5));b.updateFullData=function(a,c){if(b.updateControl==a){b.updateControl=a+1;var d=b.xScale.domain()[0],g=b.xScale.domain()[1],e=g-d;b.showLoading();b.bin=b.calculateBin(e);var h=dataPrefix+"tmpData/trackXML/"+b.gsvg.folderName+"/tmp/"+d+"_"+g+
".count."+b.trackClass+".xml",f=dataPrefix+"tmpData/trackUpload/"+b.trackClass.substr(6),l="bg",n="";0<b.bin&&(d-=2*b.bin,d-=d%(2*b.bin),g+=2*b.bin,g+=2*b.bin-g%(2*b.bin),h=dataPrefix+"tmpData/trackXML/"+b.gsvg.folderName+"/"+d+"_"+g+".bincount."+b.bin+"."+b.trackClass+".xml");-1<b.dataFileName.indexOf("http")&&(n=f=b.dataFileName,l="bw");d3.xml(h,function(e,p){if(e){if(0==a||1==c){var m="/"+pathPrefix;pathPrefix||(m="");$.ajax({url:m+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,
minCoord:d,maxCoord:g,myOrganism:organism,genomeVer:genomeVer,track:b.trackClass,bedFile:f,outFile:h,folder:b.gsvg.folderName,binSize:b.bin,type:l,web:n},dataType:"json",success:function(a){ga&&ga("send","event","browser","generateTrackCount")},error:function(a,b,c){}})}8>a?b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1)},500):30>a?b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1)},1E3):32>a?b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1)},
1E4):(d3.select("#Level"+b.levelNumber+b.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+b.trackClass),d3.select("#Level"+b.levelNumber+b.trackClass).attr("height",15),b.gsvg.addTrackErrorRemove(b.svg,"#Level"+b.gsvg.levelNumber+b.trackClass),b.hideLoading(),b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1,0)},15E3))}else null==p?32<=a?(m=[],b.draw(m)):b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1,0)},5E3):(b.fullDataTimeOutHandle=0,b.loadedDataMin=
d,b.loadedDataMax=g,m=p.documentElement.getElementsByTagName("Count"),b.draw(m),b.updateControl=0)})}};b.updateLabel(f);b.redrawLegend();b.redraw();return b}
function CountTrack(f,e,l,n){var c=Track(f,e,l,"Generic Counts");c.loadedDataMin=c.xScale.domain()[0];c.loadedDataMax=c.xScale.domain()[1];c.dataFileName=c.trackClass;c.scaleMin=1;c.scaleMax=5E3;c.graphColorText="steelblue";c.colorScale=d3.scaleLinear().domain([c.scaleMin,c.scaleMax]).range(["#EEEEEE","#000000"]);c.ttSVG=1;c.data=e;c.density=n;c.prevDensity=n;c.displayBreakDown=null;f=c.gsvg.xScale.domain()[0];f=c.gsvg.xScale.domain()[1]-f;c.fullDataTimeOutHandle=0;c.ttTrackList=[];-1<l.indexOf("illuminaSmall")?
(c.ttTrackList.push("ensemblsmallnc"),c.ttTrackList.push("brainsmallnc"),c.ttTrackList.push("liversmallnc"),c.ttTrackList.push("heartsmallnc")):(c.ttTrackList.push("ensemblcoding"),c.ttTrackList.push("braincoding"),c.ttTrackList.push("liverTotal"),c.ttTrackList.push("heartTotal"),c.ttTrackList.push("mergedTotal"),c.ttTrackList.push("refSeq"),c.ttTrackList.push("ensemblnoncoding"),c.ttTrackList.push("brainnoncoding"),c.ttTrackList.push("probe"),c.ttTrackList.push("polyASite"),c.ttTrackList.push("spliceJnct"),
c.ttTrackList.push("liverspliceJnct"),c.ttTrackList.push("heartspliceJnct"));c.ttTrackList.push("repeatMask");c.calculateBin=function(b){b=new String(Math.floor(b/c.gsvg.width));b=b.substr(0,1)*Math.pow(10,b.length-1);b=Math.floor(b/2);5>b&&(b=0);return b};c.bin=c.calculateBin(f);c.color=function(b){var a="#FFFFFF";b.getAttribute("count")>=c.scaleMin&&(a=d3.rgb(c.colorScale(b.getAttribute("count"))));return a};c.redraw=function(){var b=c.gsvg.xScale.domain()[0],a=c.gsvg.xScale.domain()[1];c.xScale(b+
c.bin);c.xScale(b);c.prevMinCoord=b;c.prevMaxCoord=a;b=c.xScale.domain()[0];a=c.xScale.domain()[1];for(var g=[],d=0,e=0,f=0;f<c.data.length;f++)if("undefined"!==typeof c.data[f]){var h=parseInt(c.data[f].getAttribute("start"),10),l=parseInt(c.data[f].getAttribute("stop"),10),n=parseInt(c.data[f].getAttribute("count"),10);if(1!=c.density||1==c.density&&h!=l)if(f+1<c.data.length){if(l=parseInt(c.data[f+1].getAttribute("start"),10),h>=b&&h<=a||l>=b&&l<=a)g[d]=c.data[f],n>e&&(e=n),d++}else h>=b&&h<=a&&
(g[d]=c.data[f],n>e&&(e=n),d++)}1==c.density?(c.density!=c.prevDensity?(c.redrawLegend(),a=c.gsvg.xScale.domain()[1],c.prevDensity=c.density,c.svg.selectAll(".area").remove(),c.svg.selectAll("g.y").remove(),c.svg.selectAll(".grid").remove(),c.svg.selectAll(".leftLbl").remove(),b=c.svg.selectAll("."+c.trackClass).data(g,keyStart),b.enter().append("rect").attr("x",function(a){return c.xScale(a.getAttribute("start"))}).attr("y",15).attr("class",c.trackClass).attr("height",10).attr("width",function(a,
b){return c.xScale(a.getAttribute("stop"))-c.xScale(a.getAttribute("start"))}).attr("fill",c.color).on("mouseover",function(a){0==c.gsvg.isToolTip&&(d3.select(this).style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(c.createToolTip(a)).style("left",function(){return c.positionTTLeft(d3.event.pageX)}).style("top",function(){return c.positionTTTop(d3.event.pageY)}))}).on("mouseout",function(a){d3.select(this).style("fill",c.color);tt.transition().delay(500).duration(200).style("opacity",
0)}),b.exit().remove()):c.svg.selectAll("."+c.trackClass).attr("x",function(a){return c.xScale(a.getAttribute("start"))}).attr("width",function(a,b){return c.xScale(a.getAttribute("stop"))-c.xScale(a.getAttribute("start"))}).attr("fill",c.color),c.svg.attr("height",30)):2==c.density&&(c.svg.selectAll("."+c.trackClass).remove(),c.svg.select(".y.axis").remove(),c.svg.select("g.grid").remove(),c.svg.selectAll(".leftLbl").remove(),c.yScale.domain([0,e]),c.svg.select(".area").remove(),c.area=d3.area().x(function(a){return c.xScale(a.getAttribute("start"))}).y0(140).y1(function(a){return c.yScale(a.getAttribute("count"))}),
c.redrawLegend(),c.prevDensity=c.density,c.svg.append("g").attr("class","y axis").call(c.yAxis),c.svg.append("g").attr("class","grid").call(c.yAxis.tickSize(-c.gsvg.width+10,0,0).tickFormat("")),c.svg.select("g.y").selectAll("text").each(function(a){var b=new String(a);d3.select(this).attr("x",function(){return 7.7*b.length+5}).attr("dy","0.05em");c.svg.append("svg:text").attr("class","leftLbl").attr("x",c.gsvg.width-(7.8*b.length+5)).attr("y",function(){return c.yScale(a)}).attr("dy","0.01em").style("font-weight",
"bold").text(numberWithCommas(a))}),c.svg.append("path").datum(g).attr("class","area").attr("stroke",c.graphColorText).attr("fill",c.graphColorText).attr("d",c.area),c.svg.attr("height",140));c.redrawSelectedArea()};c.createToolTip=function(b){var a='<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>Read Count='+numberWithCommas(b.getAttribute("count"));if(0<c.bin){var g=parseInt(b.getAttribute("start"),10)+parseInt(c.bin,10);a=a+"*<BR><BR>*Data compressed for display. Using 90th percentile of<BR>region:"+
numberWithCommas(b.getAttribute("start"))+"-"+numberWithCommas(g)+"<BR><BR>Zoom in further to see raw data(roughly a region <1000bp). The bin size will decrease as you zoom in thus the resolution of the count data will improve as you zoom in."}return a};c.update=function(b){b=c.xScale.domain()[0];var a=c.xScale.domain()[1];c.loadedDataMin<=b&&a<=c.loadedDataMax?c.redraw():c.updateFullData(0,1)};c.updateFullData=function(b,a){var g=c.xScale.domain()[0],d=c.xScale.domain()[1],e=d-g;c.showLoading();
c.bin=c.calculateBin(e);e=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.gsvg.folderName+"/tmp/"+g+"_"+d+".count."+c.trackClass+".xml";0<c.bin&&(g-=2*c.bin,g-=g%(2*c.bin),d+=2*c.bin,d+=2*c.bin-d%(2*c.bin),e=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.gsvg.folderName+"/tmp/"+g+"_"+d+".bincount."+c.bin+"."+c.trackClass+".xml");d3.xml(e,function(e,f){if(e){if(0==b||1==a){var h="/"+pathPrefix;pathPrefix||(h="");tmpPanel=panel;-1<c.trackClass.indexOf("-")&&(tmpPanel=c.trackClass.substr(c.trackClass.indexOf("-")+
1));$.ajax({url:h+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:g,maxCoord:d,panel:tmpPanel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:c.trackClass,folder:c.gsvg.folderName,binSize:c.bin},dataType:"json",success:function(a){ga&&ga("send","event","browser","generateTrackCount")},error:function(a,b,c){}})}8>b?c.fullDataTimeOutHandle=setTimeout(function(){c.updateFullData(b+1,0)},500):30>b?c.fullDataTimeOutHandle=
setTimeout(function(){c.updateFullData(b+1,0)},1E3):32>b?c.fullDataTimeOutHandle=setTimeout(function(){c.updateFullData(b+1,0)},1E4):(d3.select("#Level"+c.levelNumber+c.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+c.trackClass),d3.select("#Level"+c.levelNumber+c.trackClass).attr("height",15),c.gsvg.addTrackErrorRemove(c.svg,"#Level"+c.gsvg.levelNumber+c.trackClass),c.hideLoading(),c.fullDataTimeOutHandle=setTimeout(function(){c.updateFullData(b+1,1)},15E3))}else null==f?
32<=b?(h=[],c.draw(h)):c.fullDataTimeOutHandle=setTimeout(function(){c.updateFullData(b+1,0)},5E3):(c.fullDataTimeOutHandle=0,c.loadedDataMin=g,c.loadedDataMax=d,h=f.documentElement.getElementsByTagName("Count"),c.draw(h))})};c.updateCountScale=function(b,a){c.scaleMin=b;c.scaleMax=a;c.colorScale=d3.scaleLinear().domain([c.scaleMin,c.scaleMax]).range(["#EEEEEE","#000000"]);1==c.density&&(c.redrawLegend(),c.redraw())};c.setupToolTipSVG=function(b,a){var g=c.xScale.domain()[0],d=c.xScale.domain()[1],
e=parseInt(b.getAttribute("start"),10),f=parseInt(b.getAttribute("stop"),10);d=Math.floor((d-g)*a);20>d&&(d=20);g=e-d;d=f+d;1>g&&(g=1);"undefined"!==typeof c.ttSVGMinWidth&&d-g<c.ttSVGMinWidth&&(g=e-c.ttSVGMinWidth/2,d=f+c.ttSVGMinWidth/2);e=toolTipSVG("div#ttSVG",450,g,d,99,b.getAttribute("ID"),"transcript");e.addTrack(c.trackClass,3,"",c.data);for(f=0;f<c.ttTrackList.length;f++){var h=c.gsvg.getTrackData(c.ttTrackList[f]),l=[];if("undefined"!==typeof h&&0<h.length){for(var n=0,u=0;u<h.length;u++)if(g<=
parseInt(h[u].getAttribute("start"),10)&&parseInt(h[u].getAttribute("start"),10)<=d||parseInt(h[u].getAttribute("start"),10)<=g&&parseInt(h[u].getAttribute("stop"),10)>=g)l[n]=h[u],n++;0<l.length&&e.addTrack(c.ttTrackList[f],3,"DrawTrx",l)}}};c.draw=function(b){c.hideLoading();c.data=b;var a=c.gsvg.xScale.domain()[0],g=c.gsvg.xScale.domain()[1];c.xScale(a+c.bin);c.xScale(a);c.redrawLegend();for(var d=[],e=0,f=0,h=0;h<b.length;h++)if("undefined"!==typeof b[h]){var l=parseInt(b[h].getAttribute("start"),
10),n=parseInt(b[h].getAttribute("stop"),10),u=parseInt(b[h].getAttribute("count"),10);if(1!=c.density||1==c.density&&l!=n)if(h+1<b.length){if(n=parseInt(b[h+1].getAttribute("start"),10),l>=a&&l<=g||n>=a&&n<=g)d[e]=b[h],u>f&&(f=u),e++}else l>=a&&l<=g&&(d[e]=b[h],u>f&&(f=u),e++)}b=d;c.svg.selectAll("."+c.trackClass).remove();c.svg.select(".y.axis").remove();c.svg.select("g.grid").remove();c.svg.selectAll(".leftLbl").remove();c.svg.select(".area").remove();c.svg.selectAll(".area").remove();1==c.density?
(g=c.gsvg.xScale.domain()[1],c.svg.selectAll("."+c.trackClass).data(b,keyStart).enter().append("rect").attr("x",function(a){return c.xScale(a.getAttribute("start"))}).attr("y",15).attr("class",c.trackClass).attr("height",10).attr("width",function(a,b){return c.xScale(a.getAttribute("stop"))-c.xScale(a.getAttribute("start"))}).attr("fill",c.color).on("mouseover",function(a){0==c.gsvg.isToolTip&&(d3.select(this).style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(c.createToolTip(a)).style("left",
function(){return c.positionTTLeft(d3.event.pageX)}).style("top",function(){return c.positionTTTop(d3.event.pageY)}),1==c.ttSVG&&c.setupToolTipSVG(a,.005))}).on("mouseout",function(a){d3.select(this).style("fill",c.color);tt.transition().delay(500).duration(200).style("opacity",0)}),c.svg.attr("height",30)):2==c.density&&(c.yScale.domain([0,f]),c.yAxis=d3.axisLeft(c.yScale).ticks(5),c.svg.select("g.grid").remove(),c.svg.select(".y.axis").remove(),c.svg.selectAll(".leftLbl").remove(),c.svg.append("g").attr("class",
"y axis").call(c.yAxis),c.svg.select("g.y").selectAll("text").each(function(a){var b=new String(a);c.svg.append("svg:text").attr("class","leftLbl").attr("x",c.gsvg.width-(7.8*b.length+5)).attr("y",function(){return c.yScale(a)}).attr("dy","0.01em").style("font-weight","bold").text(numberWithCommas(a));d3.select(this).attr("x",function(){return 7.7*b.length+5}).attr("dy","0.05em")}),c.svg.append("g").attr("class","grid").call(c.yAxis.tickSize(-c.gsvg.width+10,0,0).tickFormat("")),c.svg.select(".area").remove(),
c.area=d3.area().x(function(a){return c.xScale(a.getAttribute("start"))}).y0(140).y1(function(a,b){return c.yScale(a.getAttribute("count"))}),c.svg.append("path").datum(b).attr("class","area").attr("stroke",c.graphColorText).attr("fill",c.graphColorText).attr("d",c.area),c.svg.attr("height",140));c.redrawSelectedArea()};c.redrawLegend=function(){if(2==c.density)d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll(".legend").remove();else if(1==c.density){var b=new String(c.label);b=c.gsvg.width/
2+b.length/2*7.5-10;var a=new String("<"+c.scaleMin);c.drawScaleLegend(c.scaleMin,numberWithCommas(c.scaleMax)+"+","Read Counts","#EEEEEE","#00000",15+7.6*a.length);c.svg.append("text").text("<"+c.scaleMin).attr("class","legend").attr("x",b).attr("y",12);c.svg.append("rect").attr("class","legend").attr("x",b+7.6*a.length+5).attr("y",0).attr("rx",2).attr("ry",2).attr("height",12).attr("width",15).attr("fill","#FFFFFF").attr("stroke","#CECECE")}};c.redrawSelectedArea=function(){if(1<c.density){var b=
c.svg.attr("height");d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll(".selectedArea").remove();if(-1<c.selectionStart&&-1<c.selectionEnd){var a=c.xScale(c.selectionStart),g=c.xScale(c.selectionEnd)-a;1>g&&(g=1);d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).append("rect").attr("class","selectedArea").attr("x",a).attr("y",0).attr("height",b).attr("width",g).attr("fill","#CECECE").attr("opacity",.3).attr("pointer-events","none")}}else d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll(".selectedArea").remove()};
c.savePrevious=function(){c.prevSetting={};c.prevSetting.density=c.density;c.prevSetting.scaleMin=c.scaleMin;c.prevSetting.scaleMax=c.scaleMax};c.revertPrevious=function(){c.density=c.prevSetting.density;c.scaleMin=c.prevSetting.scaleMin;c.scaleMax=c.prevSetting.scaleMax};c.generateTrackSettingString=function(){return c.trackClass+","+c.density+","+c.include+";"};c.generateSettingsDiv=function(b){var a=trackInfo[c.trackClass];c.savePrevious();d3.select(b).select("table").select("tbody").html("");
if(a&&a.Controls&&0<a.Controls.length){var g=(new String(a.Controls)).split(",");b=d3.select(b).select("table").select("tbody");b.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+a.Name);for(a=0;a<g.length;a++)if("undefined"!==typeof g[a]&&""!=g[a]){var d=g[a].split(";"),e=b.append("tr").append("td"),f=d[0].substr(5),h="";3<d.length&&0==d[3].indexOf("Default=")&&(h=d[3].substr(8));if(0==d[1].toLowerCase().indexOf("select")){e.append("text").text(f+": ");var l=d[1].split(":");
d=d[2].split("}");f=c.trackClass+"Dense"+c.level+"Select";"colorSelect"==l[1]&&(f=c.trackClass+c.level+"colorSelect");e=e.append("select").attr("id",f).attr("name",l[1]);for(l=0;l<d.length;l++){var n=d[l].substr(1).split(":");if(2==n.length){var u=e.append("option").attr("value",n[1]).text(n[0]);-1<f.indexOf("Dense")?n[1]==c.density&&u.attr("selected","selected"):n[1]==h&&u.attr("selected","selected")}}d3.select("select#"+f).on("change",function(){$(this).attr("id")==c.trackClass+"Dense"+c.level+
"Select"&&1==$(this).val()?$("#scaleControl"+c.level).show():$("#scaleControl"+c.level).hide();c.updateSettingsFromUI();c.redraw()})}else 0==d[1].toLowerCase().indexOf("slider")&&(h="none",1==c.density&&(h="inline-block"),e=e.append("div").attr("id","scaleControl"+c.level).style("display",h),e.append("text").text(f+": "),e.append("input").attr("type","text").attr("id","amount").attr("value",c.scaleMin+"-"+c.scaleMax).style("border",0).style("color","#f6931f").style("font-weight","bold").style("background-color",
"#EEEEEE"),l=d[1].split(":"),d=d[2].split("}"),e=e.append("div"),e.append("text").text("Min:"),e.append("div").attr("id","min-"+l[1]).style("width","60%").style("display","inline-block").style("float","right"),e.append("br"),e.append("text").text("Max:"),e.append("div").attr("id","max-"+l[1]).style("width","60%").style("display","inline-block").style("float","right"),$("#min-"+l[1]).slider({min:1,max:1E3,step:1,value:c.scaleMin,slide:c.processSlider}),$("#max-"+l[1]).slider({min:1E3,max:2E4,step:100,
value:c.scaleMax,slide:c.processSlider}),c.updateSettingsFromUI(),c.redraw())}g=b.append("tr").append("td");g.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");c.gsvg.setCurrentViewModified();c.gsvg.removeTrack(c.trackClass);var a=svgList[c.gsvg.levelNumber].currentView.ViewID,b=viewMenu[c.gsvg.levelNumber].findTrackByClass(c.trackClass,a);b=viewMenu[c.gsvg.levelNumber].findTrackIndexWithViewID(b.TrackID,
a);viewMenu[c.gsvg.levelNumber].removeTrackWithIDIdx(b,a)});g.append("input").attr("type","button").attr("value","Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");c.density==c.prevSetting.density&&c.scaleMin==c.prevSetting.scaleMin&&c.scaleMax==c.prevSetting.scaleMax||c.gsvg.setCurrentViewModified()});g.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){c.revertPrevious();
c.updateCountScale(c.scaleMin,c.scaleMax);c.draw(c.data);$("#trackSettingDialog").fadeOut("fast")})}else b=d3.select(b).select("table").select("tbody"),b.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+a.Name),b.append("tr").append("td").html("Sorry no settings for this track."),g=b.append("tr").append("td"),g.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){c.gsvg.setCurrentViewModified();
$("#trackSettingDialog").fadeOut("fast")}),g.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")})};c.processSlider=function(b,a){var g=$("#min-rangeslider").slider("value"),d=$("#max-rangeslider").slider("value");$("#amount").val(g+" - "+d);c.updateCountScale(g,d)};c.yScale=d3.scaleLinear().range([140,20]).domain([0,d3.max(e,function(b){return b.getAttribute("count")})]);c.area=
d3.area().x(function(b){return c.xScale(b.getAttribute("start"))}).y0(140).y1(function(b){return b.getAttribute("count")});c.yAxis=d3.axisLeft(c.yScale).ticks(5);c.redrawLegend();c.draw(e);return c}
function PolyATrack(f,e,l,n,c,b){var a=GenericTranscriptTrack(f,e,l,n,c,b);a.dataFileName="polyASite.xml";a.density=3;a.minFeatureWidth=1;a.colorBy="Color";a.ttSVG=1;a.ttTrackList=[];a.ttTrackList.push("ensemblcoding");a.ttTrackList.push("braincoding");a.ttTrackList.push("liverTotal");a.ttTrackList.push("heartTotal");a.ttTrackList.push("mergedTotal");a.ttTrackList.push("refSeq");a.ttTrackList.push("repeatMask");a.ttSVGMinWidth=200;a.createToolTip=function(a){var b=".";1==a.getAttribute("strand")?
b="+":-1==a.getAttribute("strand")&&(b="-");var c="0";1==a.getAttribute("pvalue")&&(c="");return'<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>Motif:'+a.getAttribute("motif")+"<BR>Strand:"+b+"<BR>Location: chr"+a.getAttribute("chromosome")+":"+a.getAttribute("start")+"-"+a.getAttribute("stop")+"<BR>Probability of site: "+c+a.getAttribute("pvalue")};a.updateData=function(b){d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+a.gsvg.folderName+"/"+a.dataFileName,function(c,
g){if(c)if(3>b){var d=1E4;1==b&&(d=15E3);setTimeout(function(){a.updateData(b+1)},d)}else 3<=b&&(d3.select("#Level"+a.levelNumber+a.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+a.trackClass),d3.select("#Level"+a.levelNumber+a.trackClass).attr("height",15),a.gsvg.addTrackErrorRemove(a.svg,"#Level"+a.gsvg.levelNumber+a.trackClass));else{d=g.documentElement.getElementsByTagName(a.xmlTag);for(var e=[],f=[],p=0,l=0;l<d.length;l++)"undefined"!==typeof d[l]&&(e[p]=d[l],f[d[l].getAttribute("ID")]=
1,p++);for(l=0;l<a.data.length;l++)"undefined"!==typeof a.data[l]&&"undefined"===typeof f[a.data[l].getAttribute("ID")]&&(e[p]=a.data[l],p++);a.draw(e);a.hideLoading()}})};a.redrawLegend=function(){a.drawLegend([{color:"#FF8000",label:"+ Strand >>>"},{color:"#330570",label:"- Strand <<<"}])};a.updateFullData=void 0;a.draw(e);return a}
function CustomTranscriptTrack(f,e,l,n,c,b){var a=GenericTranscriptTrack(f,e,l,n,c,b);f=b.split(",");a.density=c;0<f.length&&(a.dataFileName=f[0].substr(9));a.colorBy=1<f.length?f[1]:"Score";2<f.length&&(a.minValue=f[2]);3<f.length&&(a.maxValue=f[3]);4<f.length&&(a.minColor=f[4]);5<f.length&&(a.maxColor=f[5]);a.colorValueField="score";a.minFeatureWidth=1;a.updateControl=0;"Score"==a.colorBy&&a.createColorScale();a.updateFullData=function(b,c){if(a.updateControl==b){a.updateControl=b+1;var d=a.xScale.domain()[0],
g=a.xScale.domain()[1],e=dataPrefix+"tmpData/trackXML/"+a.gsvg.folderName+"/"+a.dataFileName+".xml",f=dataPrefix+"tmpData/trackUpload/"+a.dataFileName,l="",n=new Date,t="bed";-1<a.dataFileName.indexOf("http")&&(l=a.dataFileName,f="tmpData/tmpDownload/"+n.getTime()+"_"+a.trackClass,e=dataPrefix+"tmpData/trackXML/"+a.gsvg.folderName+"/"+a.trackClass+".xml",t="bb");d3.xml(e,function(h,p){if(h){console.log(h);if(0==b||1==c){var m="/"+pathPrefix;pathPrefix||(m="");$.ajax({url:m+"generateTrackXML.jsp",
type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:d,maxCoord:g,folder:a.gsvg.folderName,bedFile:f,outFile:e,track:a.trackClass,web:l,type:t},dataType:"json",success:function(a){ga&&ga("send","event","browser","generateTrackCustomTranscript")},error:function(a,b,c){console.log(c)}})}3>b?(m=1E4,1==b&&(m=15E3),setTimeout(function(){a.updateFullData(b+1,0)},m)):(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+a.trackClass),d3.select("#Level"+
a.gsvg.levelNumber+a.trackClass).attr("height",15),a.gsvg.addTrackErrorRemove(a.svg,"#Level"+a.gsvg.levelNumber+a.trackClass),a.hideLoading())}else m=p.documentElement.getElementsByTagName(a.xmlTag),a.draw(m),a.hideLoading(),a.updateControl=0})}};a.updateSettingsFromUI=function(){0<$("#"+a.trackClass+"Dense"+a.level+"Select").length&&(a.density=$("#"+a.trackClass+"Dense"+a.level+"Select").val());0<$("#"+a.trackClass+a.level+"colorSelect").length&&(a.colorBy=$("#"+a.trackClass+a.level+"colorSelect").val());
"Score"==a.colorBy&&(a.minValue=$("#"+a.trackClass+"minData"+a.level).val(),a.maxValue=$("#"+a.trackClass+"maxData"+a.level).val(),testIE||testSafari?(a.minColor=$("#"+a.trackClass+"minColor"+a.level).spectrum("get").toHexString(),a.maxColor=$("#"+a.trackClass+"maxColor"+a.level).spectrum("get").toHexString()):(a.minColor=$("#"+a.trackClass+"minColor"+a.level).val(),a.maxColor=$("#"+a.trackClass+"maxColor"+a.level).val()),a.createColorScale())};a.generateSettingsDiv=function(b){var c=trackInfo[a.trackClass];
a.savePrevious();d3.select(b).select("table").select("tbody").html("");if(0<c.Controls.length&&"null"!=c.Controls){var g=(new String(c.Controls)).split(",");b=d3.select(b).select("table").select("tbody");b.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name);for(c=0;c<g.length;c++)if("undefined"!==typeof g[c]&&""!=g[c]){var e=g[c].split(";"),f=b.append("tr").append("td"),l=e[0].substr(5);3<e.length&&0==e[3].indexOf("Default=")&&e[3].substr(8);if(0==e[1].toLowerCase().indexOf("select")){f.append("text").text(l+
": ");l=e[1].split(":");e=e[2].split("}");var n=a.trackClass+"Dense"+a.level+"Select";"colorSelect"==l[1]&&(n=a.trackClass+a.level+"colorSelect");f=f.append("select").attr("id",n).attr("name",l[1]);for(l=0;l<e.length;l++){var u=e[l].substr(1).split(":");if(2==u.length){var t=f.append("option").attr("value",u[1]).text(u[0]);(-1<n.indexOf("Dense")&&u[1]==a.density||-1<n.indexOf("colorSelect")&&u[1]==a.colorBy)&&t.attr("selected","selected")}}d3.select("select#"+n).on("change",function(){"Score"==$(this).val()?
$("div."+a.trackClass+"Scale"+a.level).show():"Color"==$(this).val()&&$("div."+a.trackClass+"Scale"+a.level).hide();a.updateSettingsFromUI();a.draw(a.data)})}else 0==e[1].toLowerCase().indexOf("txt")&&(f=0==$("#colorTrack"+a.level).size()?f.append("div").attr("class",a.trackClass+"Scale"+a.level).style("display","none"):d3.select("#"+a.trackClass+"Scale"+a.level),f.append("text").text(l+": "),l=e[1].split(":"),e=e[2].split("}"),e="Data",n="text",u=a.minValue,t=a.maxValue,"color"==l[1]&&(n=e="Color",
u=a.minColor,t=a.maxColor),f.append("input").attr("type",n).attr("id",a.trackClass+"min"+e+a.level).attr("class",l[1]).style("margin-left","5px").attr("value",u),f.append("text").text(" - "),f.append("input").attr("type",n).attr("id",a.trackClass+"max"+e+a.level).attr("class",l[1]).style("margin-left","5px").attr("value",t),"Color"==e&&(testIE||testSafari)?($("#"+a.trackClass+"min"+e+a.level).spectrum({change:function(b){a.updateSettingsFromUI();a.draw(a.data)}}),$("#"+a.trackClass+"max"+e+a.level).spectrum({change:function(b){a.updateSettingsFromUI();
a.draw(a.data)}})):($("input#"+a.trackClass+"min"+e+a.level).on("change",function(){a.updateSettingsFromUI();a.draw(a.data)}),$("input#"+a.trackClass+"max"+e+a.level).on("change",function(){a.updateSettingsFromUI();a.draw(a.data)})))}"Score"==$("#"+a.trackClass+a.level+"colorSelect").val()?$("div."+a.trackClass+"Scale"+a.level).show():"Color"==$("#"+a.trackClass+a.level+"colorSelect").val()&&$("div."+a.trackClass+"Scale"+a.level).hide();g=b.append("tr").append("td");g.append("input").attr("type",
"button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");a.gsvg.removeTrack(a.trackClass);var b=svgList[a.gsvg.levelNumber].currentView.ViewID,c=viewMenu[a.gsvg.levelNumber].findTrackByClass(a.trackClass,b);c=viewMenu[a.gsvg.levelNumber].findTrackIndexWithViewID(c.TrackID,b);viewMenu[a.gsvg.levelNumber].removeTrackWithIDIdx(c,b)});g.append("input").attr("type","button").attr("value","Apply").style("float",
"right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")});g.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){a.revertPrevious();a.draw(a.data);$("#trackSettingDialog").fadeOut("fast")})}else b=d3.select(b).select("table").select("tbody"),b.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name),b.append("tr").append("td").html("Sorry no settings for this track."),
g=b.append("tr").append("td"),g.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")}),g.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")})};a.generateTrackSettingString=function(){return a.trackClass+","+a.density+","+a.colorBy+","+a.minValue+","+a.maxValue+
","+a.minColor+","+a.maxColor+";"};return a}
function RepeatMaskTrack(f,e,l,n,c,b){var a=GenericTranscriptTrack(f,e,l,n,c,b);a.dataFileName="repeatMask.xml";a.density=1;a.xmlTag="Feature";a.xmlTagBlockElem="Block";a.minFeatureWidth=1;a.ttSVG=1;a.ttTrackList=[];a.ttTrackList.push("ensemblcoding");a.ttTrackList.push("braincoding");a.ttTrackList.push("liverTotal");a.ttTrackList.push("heartTotal");a.ttTrackList.push("mergedTotal");a.ttTrackList.push("refSeq");a.ttTrackList.push("spliceJnct");a.ttTrackList.push("liverspliceJnct");a.ttTrackList.push("heartspliceJnct");
a.ttTrackList.push("brainspliceJnct");a.ttTrackList.push("illuminaPolyA");a.ttTrackList.push("liverilluminaTotalPlus");a.ttTrackList.push("liverilluminaTotalMinus");a.ttTrackList.push("heartilluminaTotalPlus");a.ttTrackList.push("heartilluminaTotalMinus");a.ttTrackList.push("brainilluminaTotalPlus");a.ttTrackList.push("brainilluminaTotalMinus");a.ttSVGMinWidth=200;a.legendLbl="Smith-Waterman Alignment Score";a.typeList=[];a.typeList[0]={name:"SINE",clss:"SINE"};a.typeList[1]={name:"LINE",clss:"LINE"};
a.typeList[2]={name:"LTR",clss:"LTR"};a.typeList[3]={name:"DNA",clss:"DNA"};a.typeList[4]={name:"Simple",clss:"Simple_repeat"};a.typeList[5]={name:"Low Comp.",clss:"Low_complexity"};a.typeList[6]={name:"Satellite",clss:"Satellite"};a.typeList[7]={name:"RNA",clss:"RNA"};a.typeList[8]={name:"Other",clss:"Other"};a.typeList[9]={name:"Unknown",clss:"Unknown"};a.yList={};for(f=0;f<a.typeList.length;f++)a.yList[a.typeList[f].clss]=15+15*f;a.createToolTip=function(a){var b='<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>Name: '+
a.getAttribute("name")+"&nbsp&nbsp&nbsp&nbsp&nbspClass: "+a.getAttribute("class");b=b+"&nbsp&nbsp&nbsp&nbsp&nbspFamily: "+a.getAttribute("family")+"<BR><BR>Location: "+a.getAttribute("chromosome")+":"+a.getAttribute("start")+"-"+a.getAttribute("stop");b=b+"<BR><BR>Alignment Score: "+a.getAttribute("score")+"<BR>Mismatches(parts/thousand): "+a.getAttribute("mis")+"<BR>Insertions(parts/thousand): "+a.getAttribute("ins");return b=b+"<BR>Deletions(parts/thousand): "+a.getAttribute("del")};a.pieColor=
function(a,b){var c=d3.rgb("#000000"),d=a.data.names;"LINE"===d?c=d3.rgb("#27e5e5"):"SINE"===d?c=d3.rgb("#e57927"):"LTR"===d?c=d3.rgb("#27e527"):"DNA"===d?c=d3.rgb("#e52727"):"Simple_repeat"===d?c=d3.rgb("#e51ba2"):"Low_complexity"===d?c=d3.rgb("#9029e5"):"RNA"===d?c=d3.rgb("#005be5"):"Satellite"===d?c=d3.rgb("#cccc00"):"Other"===d&&(c=d3.rgb("#007f24"));return c};a.calcY=function(b,c,e,f){b=3===a.density||"3"===a.density?a.calcYPack(b,c,e):2===a.density||"2"===a.density?a.calcYFull(f):a.calcYDense();
a.trackYMax<b/15&&(a.trackYMax=b/15);return b};a.calcYFull=function(b){b=b.getAttribute("class");-1<b.indexOf("RNA")&&(b="RNA");return a.yList[b]};a.redraw=function(){if(a.prevDensity!=a.density)a.draw(a.data);else{a.yMaxArr=[];a.yArr=[];a.yArr[0]=[];for(var b=0;b<a.gsvg.width;b++)a.yMaxArr[b]=0,a.yArr[0][b]=0;a.trackYMax=0;d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g."+a.idPrefix+"trx"+a.gsvg.levelNumber).attr("transform",function(b,c){return"translate("+a.xScale(b.getAttribute("start"))+
","+a.calcY(parseInt(b.getAttribute("start"),10),parseInt(b.getAttribute("stop"),10),c,b)+")"}).each(function(b,c){for(var d=getAllChildrenByName(getFirstChildByName(b,a.xmlTagBlockElem+"List"),a.xmlTagBlockElem),g=0;g<d.length;g++){var e=a.idPrefix+"Ex"+d[g].getAttribute("ID");null==d[g].getAttribute("ID")&&(e=a.idPrefix+"Ex"+b.getAttribute("ID")+"_"+g);a.svg.select("g#"+a.idPrefix+"tx"+b.getAttribute("ID")+" rect#"+e).attr("x",function(c){return a.xScale(d[g].getAttribute("start"))-a.xScale(b.getAttribute("start"))}).attr("width",
function(b){return a.xScale(d[g].getAttribute("stop"))-a.xScale(d[g].getAttribute("start"))});if(0<g){e=">";"-1"==b.getAttribute("strand")&&(e="<");var f=e,p=a.xScale(d[g-1].getAttribute("stop"))-a.xScale(b.getAttribute("start")),l=a.xScale(d[g].getAttribute("start"))-a.xScale(b.getAttribute("start")),n=l-p,v=0;if(7>n)f="";else for(n-=7;8<n;)0==v?(f+=" ",v=1):(f+=e,v=0),n-=7;e=d[g-1].getAttribute("ID")+"_"+d[g].getAttribute("ID");null==d[g].getAttribute("ID")&&(e=b.getAttribute("ID")+"_"+(g-1)+"_"+
g);a.svg.select("g#"+a.idPrefix+"tx"+b.getAttribute("ID")+" line#"+a.idPrefix+"Int"+e).attr("x1",p).attr("x2",l);a.svg.select("g#"+a.idPrefix+"tx"+b.getAttribute("ID")+" #"+a.idPrefix+"IntTxt"+e).attr("dx",p+1).text(f)}}});1==a.density?a.svg.attr("height",30):2==a.density?a.svg.attr("height",15*(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g."+a.idPrefix+"trx"+a.gsvg.levelNumber).size()+1)):3==a.density&&a.svg.attr("height",15*(a.trackYMax+1));a.redrawSelectedArea()}};a.drawTrx=
function(b,c){var d=d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).select("#"+a.idPrefix+"tx"+b.getAttribute("ID"));exList=getAllChildrenByName(getFirstChildByName(b,a.xmlTagBlockElem+"List"),a.xmlTagBlockElem);1===exList.length&&d.append("rect").attr("x",function(b){return a.xScale(exList[0].getAttribute("start"))-a.xScale(b.getAttribute("start"))}).attr("rx",1).attr("ry",1).attr("height",10).attr("width",function(b){b=a.xScale(exList[0].getAttribute("stop"))-a.xScale(exList[0].getAttribute("start"));
0<a.minFeatureWidth&&b<a.minFeatureWidth&&(b=a.minFeatureWidth);return b}).attr("id",function(b,c){var d=a.idPrefix+"Ex"+exList[0].getAttribute("ID");null==exList[0].getAttribute("ID")&&(d=a.idPrefix+"Ex"+b.getAttribute("ID")+"_0");return d}).style("fill",a.color).style("cursor","pointer")};a.draw=function(b){a.data=b;a.prevDensity=a.density;a.trackYMax=0;a.yArr=[];a.yArr[0]=[];for(var c=0;c<a.gsvg.width;c++)a.yMaxArr[c]=0,a.yArr[0][c]=0;a.svg.selectAll(".repeatLine"+a.gsvg.levelNumber).remove();
a.svg.selectAll(".repeatLbl"+a.gsvg.levelNumber).remove();if(2==a.density)for(c=0;c<a.typeList.length;c++)a.svg.append("line").attr("class","repeatLine"+a.gsvg.levelNumber).attr("x1",0).attr("x2",a.gsvg.width).attr("y1",12+15*(c+1)).attr("y2",12+15*(c+1)).attr("stroke","#000000").attr("stroke-width","1px"),a.svg.append("text").attr("x",5).attr("class","repeatLbl"+a.gsvg.levelNumber).attr("y",10+15*(c+1)).style("pointer-events","none").style("opacity","0.5").style("fill","#000000").style("font-size",
"11px").text(a.typeList[c].name),a.svg.append("text").attr("class","repeatLbl"+a.gsvg.levelNumber).attr("x",a.gsvg.width-5).attr("y",10+15*(c+1)).style("text-anchor","end").style("pointer-events","none").style("opacity","0.5").style("fill","#000000").style("font-size","11px").text(a.typeList[c].name);d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("."+a.idPrefix+"trx"+a.gsvg.levelNumber).remove();a.redrawLegend();b=d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("."+a.idPrefix+
"trx"+a.gsvg.levelNumber).data(b,key).attr("transform",function(b,c){return"translate("+a.xScale(b.getAttribute("start"))+","+a.calcY(parseInt(b.getAttribute("start"),10),parseInt(b.getAttribute("stop"),10),c,b)+")"});b.enter().append("g").attr("class",a.idPrefix+"trx"+a.gsvg.levelNumber).attr("transform",function(b,c){return"translate("+a.xScale(b.getAttribute("start"))+","+a.calcY(parseInt(b.getAttribute("start"),10),parseInt(b.getAttribute("stop"),10),c,b)+")"}).attr("id",function(b){return a.idPrefix+
"tx"+b.getAttribute("ID")}).style("cursor","move").on("mouseover",function(b){0==a.gsvg.isToolTip&&0!=a.trackClass.indexOf("custom")&&(d3.select(this).selectAll("line").style("stroke","green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(a.createToolTip(b)).style("left",function(){return a.positionTTLeft(d3.event.pageX)}).style("top",function(){return a.positionTTTop(d3.event.pageY)}),
1==a.ttSVG&&a.setupToolTipSVG(b,.05))}).on("mouseout",function(b){d3.select(this).selectAll("line").style("stroke",a.color);d3.select(this).selectAll("rect").style("fill",a.color);d3.select(this).selectAll("text").style("opacity","0.6").style("fill",a.color);tt.transition().delay(100).duration(200).style("opacity",0)}).each(a.drawTrx);b.exit().remove();1==a.density?a.svg.attr("height",30):2==a.density?a.svg.attr("height",15*a.typeList.length+15):3==a.density&&a.svg.attr("height",15*(a.trackYMax+2));
a.redrawSelectedArea()};a.getDisplayedData=function(){var b=d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("."+a.idPrefix+"trx"+a.gsvg.levelNumber);a.counts=[];var c={};b=b[0];var e=[],f=0;if("undefined"!==typeof b){for(var h=0;h<b.length;h++){var l=a.xScale(b[h].__data__.getAttribute("start")),n=a.xScale(b[h].__data__.getAttribute("stop"));if(0<=l&&l<=a.gsvg.width||0<=n&&n<=a.gsvg.width)"undefined"===typeof c[b[h].__data__.getAttribute("class")]?(c[b[h].__data__.getAttribute("class")]=
{},c[b[h].__data__.getAttribute("class")].value=1,c[b[h].__data__.getAttribute("class")].names=b[h].__data__.getAttribute("class")):c[b[h].__data__.getAttribute("class")].value=c[b[h].__data__.getAttribute("class")].value+1,e[f]=b[h].__data__,f++}a.counts=[];for(x in c)a.counts.push(c[x])}else a.counts=[];return e};a.draw(e);return a}
function GenericTranscriptTrack(f,e,l,n,c,b){var a=Track(f,e,l,n);a.dataFileName=l+".xml";a.xmlTag="Feature";a.xmlTagBlockElem="block";a.idPrefix="genTrx";a.ttSVG=0;a.ttTrackList=[];a.colorValueField="score";a.colorBy="Score";a.minValue=1;a.maxValue=1E3;a.minColor="#E6E6E6";a.maxColor="#000000";a.minFeatureWidth=-1;a.ttSVGMinWidth=0;a.legendLbl="";f=new String(b);if("undefined"!==typeof b&&0<f.length)for(b=f.split(","),f=0;f<b.length;f++)e=new String(b[f]),0==e.indexOf("colorBy=")?a.colorBy=e.substr(e.indexOf("=")+
1):0==e.indexOf("minColor=")?a.minColor=e.substr(e.indexOf("=")+1):0==e.indexOf("maxColor=")?a.maxColor=e.substr(e.indexOf("=")+1):0==e.indexOf("minValue=")?a.minValue=e.substr(e.indexOf("=")+1):0==e.indexOf("maxValue=")&&(a.maxValue=e.substr(e.indexOf("=")+1));a.createColorScale=function(){"undefined"!==typeof a.minColor&&"undefined"!==typeof a.maxColor&&(a.colorScale=d3.scaleLinear().domain([a.minValue,a.maxValue]).range([a.minColor,a.maxColor]))};a.createColorScale();a.setMinColor=function(b){a.minColor=
"#"+b;a.createColorScale();a.draw(a.data)};a.setMaxColor=function(b){a.maxColor="#"+b;a.createColorScale();a.draw(a.data)};a.setMinValue=function(b){a.minValue=b;a.createColorScale();a.draw(a.data)};a.setMaxValue=function(b){a.maxValue=b;a.createColorScale();a.draw(a.data)};a.setColorBy=function(b){a.colorBy=b;a.createColorScale();a.draw(a.data)};a.getDisplayID=function(a){return a.getAttribute("ID")};a.createToolTip=function(a){return""};a.getColorValue=function(b){return b.getAttribute(a.colorValueField)};
a.color=function(b){var c=d3.rgb("#FFFFFF");"Score"==a.colorBy?c=a.colorScale(a.getColorValue(b)):"Color"==a.colorBy&&(b=(new String(b.getAttribute("color"))).split(","),3==b.length&&(c=d3.rgb(b[0],b[1],b[2])));return c};a.savePrevious=function(){a.prevSetting={};a.prevSetting.density=a.density;a.prevSetting.colorValueField=a.colorValueField;a.prevSetting.colorBy=a.colorBy;a.prevSetting.minValue=a.minValue;a.prevSetting.maxValue=a.maxValue;a.prevSetting.minColor=a.minColor;a.prevSetting.maxColor=
a.maxColor};a.revertPrevious=function(){a.density=a.prevSetting.density;a.colorValueField=a.prevSetting.colorValueField;a.colorBy=a.prevSetting.colorBy;a.minValue=a.prevSetting.minValue;a.maxValue=a.prevSetting.maxValue;a.minColor=a.prevSetting.minColor;a.maxColor=a.prevSetting.maxColor;"Score"==a.colorBy&&a.createColorScale()};a.drawTrx=function(b,c){var d=d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).select("#"+a.idPrefix+"tx"+b.getAttribute("ID"));exList=getAllChildrenByName(getFirstChildByName(b,
a.xmlTagBlockElem+"List"),a.xmlTagBlockElem);for(var e=0;e<exList.length;e++)if(d.append("rect").attr("x",function(b){return a.xScale(exList[e].getAttribute("start"))-a.xScale(b.getAttribute("start"))}).attr("rx",1).attr("ry",1).attr("height",10).attr("width",function(b){b=a.xScale(exList[e].getAttribute("stop"))-a.xScale(exList[e].getAttribute("start"));0<a.minFeatureWidth&&b<a.minFeatureWidth&&(b=a.minFeatureWidth);return b}).attr("id",function(b,c){var d=a.idPrefix+"Ex"+exList[e].getAttribute("ID");
null==exList[e].getAttribute("ID")&&(d=a.idPrefix+"Ex"+b.getAttribute("ID")+"_"+e);return d}).style("fill",a.color).style("cursor","pointer"),0<e){var g=a.xScale(exList[e-1].getAttribute("stop"))-a.xScale(b.getAttribute("start")),f=a.xScale(exList[e].getAttribute("start"))-a.xScale(b.getAttribute("start"));d.append("line").attr("x1",g).attr("x2",f).attr("y1",5).attr("y2",5).attr("stroke",a.color).attr("stroke-width","2").attr("id",function(b,c){var d=a.idPrefix+"Int"+exList[e-1].getAttribute("ID")+
"_"+exList[e].getAttribute("ID");null==exList[e].getAttribute("ID")&&(d=a.idPrefix+"Int"+b.getAttribute("ID")+"_"+(e-1)+"_"+e);return d});var l=">";"-1"==b.getAttribute("strand")&&(l="<");var n=l;f-=g;var t=0;if(7>f)n="";else for(f-=7;8<f;)0==t?(n+=" ",t=1):(n+=l,t=0),f-=7;d.append("svg:text").attr("id",function(b){var c=a.idPrefix+"IntTxt"+exList[e-1].getAttribute("ID")+"_"+exList[e].getAttribute("ID");null==exList[e].getAttribute("ID")&&(c=a.idPrefix+"IntTxt"+b.getAttribute("ID")+"_"+(e-1)+"_"+
e);return c}).attr("dx",g+1).attr("dy","11").style("pointer-events","none").style("opacity","0.5").style("fill",a.color).style("font-size","16px").text(n)}};a.redraw=function(){if(a.prevDensity!=a.density)a.draw(a.data);else{a.yMaxArr=[];a.yArr=[];a.yArr[0]=[];for(var b=0;b<a.gsvg.width;b++)a.yMaxArr[b]=0,a.yArr[0][b]=0;a.trackYMax=0;d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g."+a.idPrefix+"trx"+a.gsvg.levelNumber).attr("transform",function(b,c){return"translate("+a.xScale(b.getAttribute("start"))+
","+a.calcY(parseInt(b.getAttribute("start"),10),parseInt(b.getAttribute("stop"),10),c)+")"}).each(function(b,c){for(var d=getAllChildrenByName(getFirstChildByName(b,a.xmlTagBlockElem+"List"),a.xmlTagBlockElem),e=0;e<d.length;e++){var g=a.idPrefix+"Ex"+d[e].getAttribute("ID");null==d[e].getAttribute("ID")&&(g=a.idPrefix+"Ex"+b.getAttribute("ID")+"_"+e);a.svg.select("g#"+a.idPrefix+"tx"+b.getAttribute("ID")+" rect#"+g).attr("x",function(c){return a.xScale(d[e].getAttribute("start"))-a.xScale(b.getAttribute("start"))}).attr("width",
function(b){return a.xScale(d[e].getAttribute("stop"))-a.xScale(d[e].getAttribute("start"))});if(0<e){g=">";"-1"==b.getAttribute("strand")&&(g="<");var f=g,p=a.xScale(d[e-1].getAttribute("stop"))-a.xScale(b.getAttribute("start")),l=a.xScale(d[e].getAttribute("start"))-a.xScale(b.getAttribute("start")),n=l-p,v=0;if(7>n)f="";else for(n-=7;8<n;)0==v?(f+=" ",v=1):(f+=g,v=0),n-=7;g=d[e-1].getAttribute("ID")+"_"+d[e].getAttribute("ID");null==d[e].getAttribute("ID")&&(g=b.getAttribute("ID")+"_"+(e-1)+"_"+
e);a.svg.select("g#"+a.idPrefix+"tx"+b.getAttribute("ID")+" line#"+a.idPrefix+"Int"+g).attr("x1",p).attr("x2",l);a.svg.select("g#"+a.idPrefix+"tx"+b.getAttribute("ID")+" #"+a.idPrefix+"IntTxt"+g).attr("dx",p+1).text(f)}}});1==a.density?a.svg.attr("height",30):2==a.density?a.svg.attr("height",15*(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g."+a.idPrefix+"trx"+a.gsvg.levelNumber).size()+1)):3==a.density&&a.svg.attr("height",15*(a.trackYMax+1));a.redrawSelectedArea()}};a.update=function(b){a.redraw()};
a.updateFullData=function(b,c){var d=a.xScale.domain()[0],e=a.xScale.domain()[1];a.showLoading();d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+a.gsvg.folderName+"/"+a.dataFileName,function(g,f){if(g){if(0==b||1==c){var h="/"+pathPrefix;pathPrefix||(h="");$.ajax({url:h+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:d,maxCoord:e,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:a.trackClass,
folder:a.gsvg.folderName},dataType:"json",success:function(a){ga&&ga("send","event","browser","generateTrackTranscript")},error:function(a,b,c){}})}3>b?(h=1E4,1==b&&(h=15E3),setTimeout(function(){a.updateFullData(b+1,0)},h)):(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+a.trackClass),d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).attr("height",15),a.gsvg.addTrackErrorRemove(a.svg,"#Level"+a.gsvg.levelNumber+a.trackClass),a.hideLoading())}else null==
f?4<=b?(h=[],a.draw(h),a.hideLoading()):setTimeout(function(){a.updateFullData(b+1,0)},5E3):(h=f.documentElement.getElementsByTagName(a.xmlTag),a.draw(h),a.hideLoading())})};a.redrawLegend=function(){var b=[];"Score"==a.colorBy?a.drawScaleLegend(a.minValue,a.maxValue+"+",a.legendLbl,a.minColor,a.maxColor,0):"Color"==a.colorBy&&(b[0]={color:"#FFFFFF",label:"User assigned color from track file."},a.drawLegend(b))};a.draw=function(b){a.data=b;a.prevDensity=a.density;a.trackYMax=0;a.yArr=[];a.yArr[0]=
[];for(var c=0;c<a.gsvg.width;c++)a.yMaxArr[c]=0,a.yArr[0][c]=0;d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("."+a.idPrefix+"trx"+a.gsvg.levelNumber).remove();a.redrawLegend();b&&(b=d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("."+a.idPrefix+"trx"+a.gsvg.levelNumber).data(b,key),b.enter().append("g").attr("class",a.idPrefix+"trx"+a.gsvg.levelNumber).attr("transform",function(b,c){return"translate("+a.xScale(b.getAttribute("start"))+","+a.calcY(parseInt(b.getAttribute("start"),
10),parseInt(b.getAttribute("stop"),10),c)+")"}).attr("id",function(b){return a.idPrefix+"tx"+b.getAttribute("ID")}).style("cursor","move").on("mouseover",function(b){0==a.gsvg.isToolTip&&0!=a.trackClass.indexOf("custom")&&(d3.select(this).selectAll("line").style("stroke","green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(a.createToolTip(b)).style("left",
function(){return a.positionTTLeft(d3.event.pageX)}).style("top",function(){return a.positionTTTop(d3.event.pageY)}),1==a.ttSVG&&a.setupToolTipSVG(b,.05))}).on("mouseout",function(b){d3.select(this).selectAll("line").style("stroke",a.color);d3.select(this).selectAll("rect").style("fill",a.color);d3.select(this).selectAll("text").style("opacity","0.6").style("fill",a.color);tt.transition().delay(100).duration(200).style("opacity",0)}).merge(b).each(a.drawTrx),b.exit().remove());1==a.density?a.svg.attr("height",
30):2==a.density?a.svg.attr("height",15*(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g."+a.idPrefix+"trx"+a.gsvg.levelNumber).size()+1)):3==a.density&&a.svg.attr("height",15*(a.trackYMax+2));a.redrawSelectedArea()};return a}window.GenomeSVG=GenomeSVG;var reportSelectedTrack=null,loadedTrackTable=null,regionDetailLoaded={};$(document).on("click","span.detailMenu",function(f){f=$(this).attr("name");var e=$("span.detailMenu.selected").attr("name");$("div#"+e).hide();$("span.detailMenu.selected").removeClass("selected");$("span[name='"+f+"']").addClass("selected");$("div#"+f).show();if("undefined"!==typeof svgList[0]){e=svgList[0].xScale.domain()[0];var l=svgList[0].xScale.domain()[1];loadRegionReport(f,chr,e,l)}});
function loadRegionReport(f,e,l,n){e=e+":"+l+"-"+n;"regionTable"===f&&(e=e+":"+reportSelectedTrack);regionDetailLoaded[f]&&regionDetailLoaded[f]===e?"regionWGCNAEQTL"===f&&""===$("div#regionWGCNAEQTL").html()&&loadRegionWGCNA():("regionTable"==f&&null!=reportSelectedTrack?loadTrackTable():"regionEQTLTable"==f?($("div#regionEQTLTable").html('<span style="text-align:center;width:100%;"><img src="web/images/ucsc-loading.gif"><BR>Loading...</span>'),setTimeout(function(){loadEQTLTable()},750)):"regionWGCNAEQTL"==
f&&loadRegionWGCNA(),regionDetailLoaded[f]=e);"regionEQTLTable"===f&&tblFrom&&tblFrom.fnAdjustColumnSizing();ga&&ga("send","event","loadRegionReport",f)}
function loadTrackTable(){var f=svgList[0].xScale.domain()[0],e=svgList[0].xScale.domain()[1],l=chr+":"+minCoord+"-"+maxCoord+":"+reportSelectedTrack.trackClass;loadedTrackTable&&loadedTrackTable===l||(loadedTrackTable=l,l="",f={species:organism,minCoord:f,maxCoord:e,chromosome:chr,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,forwardPvalueCutoff:forwardPValueCutoff,folderName:regionfolderName,genomeVer:genomeVer,track:reportSelectedTrack.trackClass},-1<reportSelectedTrack.trackClass.indexOf("noncoding")?
(f.type="noncoding",f.source="ensembl",-1<reportSelectedTrack.trackClass.indexOf("brain")&&(f.source="brain"),l="web/GeneCentric/geneTable.jsp"):-1<reportSelectedTrack.trackClass.indexOf("coding")?(l="web/GeneCentric/geneTable.jsp",f.type="coding",f.source="ensembl",-1<reportSelectedTrack.trackClass.indexOf("brain")&&(f.source="brain")):"liverTotal"===reportSelectedTrack.trackClass||"heartTotal"===reportSelectedTrack.trackClass||"brainTotal"===reportSelectedTrack.trackClass||"mergedTotal"===reportSelectedTrack.trackClass?
(l="web/GeneCentric/geneTable.jsp",f.type="all",f.source="liver","heartTotal"===reportSelectedTrack.trackClass?f.source="heart":"brainTotal"===reportSelectedTrack.trackClass?f.source="brain":"mergedTotal"===reportSelectedTrack.trackClass&&(f.source="merged")):-1<reportSelectedTrack.trackClass.indexOf("smallnc")?(f.source="ensembl",-1<reportSelectedTrack.trackClass.indexOf("brain")?f.source="brain":-1<reportSelectedTrack.trackClass.indexOf("heart")&&(f.source="heart"),-1<reportSelectedTrack.trackClass.indexOf("liver")&&
(f.source="liver"),l="web/GeneCentric/smallGeneTable.jsp"):-1<(new String(reportSelectedTrack.trackClass)).indexOf("snp")||"qtl"===reportSelectedTrack.trackClass&&(l="web/GeneCentric/bqtlTable.jsp"),l&&loadDivWithPage("div#regionTable",l,!1,f,'<span style="text-align:center;width:100%;"><img src="web/images/ucsc-loading.gif"><BR>Loading...</span>'));ga&&ga("send","event","loadTrackTable",reportSelectedTrack.trackClass)}
function loadEQTLTable(){var f=svgList[0].xScale.domain()[0],e=svgList[0].xScale.domain()[1];loadDivWithPage("div#regionEQTLTable","web/GeneCentric/regionEQTLTable.jsp",!1,{species:organism,minCoord:f,maxCoord:e,chromosome:chr,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,pValueCutoff:pValueCutoff,folderName:regionfolderName,genomeVer:genomeVer},'<span style="text-align:center;width:100%;"><img src="web/images/ucsc-loading.gif"><BR>Loading...</span>');ga&&ga("send","event","loadEQTLTable","eQTLTable")}
function loadRegionWGCNA(){$("div#geneWGCNA").html("");var f=svgList[0].xScale.domain()[0],e=svgList[0].xScale.domain()[1];loadDivWithPage("div#regionWGCNAEQTL","web/GeneCentric/wgcnaGene.jsp",!0,{region:chr+":"+f+"-"+e},'<span style="text-align:center;width:100%;"><img src="web/images/ucsc-loading.gif"><BR>Loading...</span>');ga&&ga("send","event","loadWGCNA","wgcna")}
function loadEQTLTableWParams(f,e,l,n){loadDivWithPage("div#regionEQTLTable","web/GeneCentric/regionEQTLTable.jsp",!1,{species:organism,minCoord:minCoord,maxCoord:maxCoord,chromosome:chr,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,pValueCutoff:n,tissues:l,chromosomes:e,levels:f,folderName:regionfolderName},'<span style="text-align:center;width:100%;"><img src="web/images/ucsc-loading.gif"><BR>Loading...</span>');ga&&ga("send","event","loadEQTLTableWParams","eqtlwparams")}
function loadDivWithPage(f,e,l,n,c){$(f).html(c);$.ajax({url:e,type:"GET",cache:!1,data:n,dataType:"html",success:function(b){$(f).html(b);l&&setTimeout(function(){$("html, body").animate({scrollTop:$(f).offset().top},200)},300)},error:function(b,a,c){$(f).html('<span style="color:#FF0000;">An error occurred generating this page.  Please try back later.</span>')}})}function trKey(f){var e="";f&&(e=f.trackClass);return e}
function DisplayRegionReport(){if(0<d3.select("#collapsableReportList").size()){var f=svgList[0].trackList;if(reportSelectedTrack)for(var e=0;e<f.length&&!reportSelectedTrack;e++)f[e]&&f[e].getDisplayedData&&(reportSelectedTrack=f[e]);f=d3.select("#collapsableReportList").selectAll("li.report").data(f,trKey).html(function(e){var c="";e&&e.getDisplayedData&&(c=e.getDisplayedData(),c=e.label+": "+c.length);return c});f.enter().append("li").attr("class",function(e){return e?"report "+e.trackClass:"report"}).html(function(e){var c=
"";e&&e.getDisplayedData&&(c=e.getDisplayedData(),c=e.label+": "+c.length);return c}).on("click",displayDetailedView);f.exit().remove();!$("div#collapsableReport").is(":hidden")&&reportSelectedTrack&&displayDetailedView(reportSelectedTrack)}f=$("span.detailMenu.selected").attr("name");e=svgList[0].xScale.domain()[0];var l=svgList[0].xScale.domain()[1];loadRegionReport(f,chr,e,l);ga&&ga("send","event","loadRegionReport","regionReport")}
function displayDetailedView(f){reportSelectedTrack=f;$("li.report").removeClass("selected");$("li."+f.trackClass).addClass("selected");f.displayBreakDown&&setTimeout(function(){$("div#trackGraph").html("");f.displayBreakDown("div#collapsableReport div#trackGraph")},50);var e=new String(f.trackClass);-1<e.indexOf("coding")||-1<e.indexOf("noncoding")||-1<e.indexOf("smallnc")||-1<e.indexOf("liverTotal")||-1<e.indexOf("heartTotal")||-1<e.indexOf("brainTotal")||-1<e.indexOf("mergedTotal")||"qtl"==e?($("#regionTableSubHeader").show(),
$("#regionTable").show()):($("#regionTableSubHeader").hide(),$("#regionTable").hide());$("div#regionTable").is(":hidden")||loadTrackTable();ga&&ga("send","event","loaddetailedView",f)}function DisplaySelectedDetailReport(f,e){loadDivWithPage("div#selectedReport",f,!1,e,'<span style="text-align:center;width:100%;"><img src="web/images/ucsc-loading.gif"><BR>Loading...</span>')};function ViewMenu(f){var e={};e.level=f;e.viewList=[];e.selectedTrackSetting=0;e.previewLevel=100;e.previewSVG=NaN;e.curOrg=(new String(organism)).toUpperCase();e.initialized=0;e.generatePreview=function(f){$("div#previewOuter"+e.level+" div#previewContent").html("");var l=(new String(organism)).toUpperCase();if("AA"===f.Organism||f.Organism===l){l=svgList[e.level].xScale.domain()[0];var c=svgList[e.level].xScale.domain()[1];e.previewSVG=toolTipSVG("div#previewOuter"+e.level+" div#previewContent",
555,l,c,e.previewLevel,chr,svgList[e.level].type);$("div#ScrollLevel"+e.previewLevel).css("overflow","auto").css("max-height","360px");if(f=e.generateSettingsString(f))loadStateFromString(f,"",e.previewLevel,e.previewSVG),e.previewSVG.updateData(),e.previewSVG.updateFullData()}else $("div#previewOuter"+e.level+" div#previewContent").html("No Preview Available: The current organism doesn't match the tracks included in this view.")};e.removeTrackWithID=function(f){f=e.findTrackIndex(f);var l=e.findSelectedView().ViewID;
e.removeTrackWithIDIdx(f,l);ga&&ga("send","event","BrowserViews","deleteTrack")};e.removeTrackWithIDIdx=function(f,n){var c=e.findViewWithID(n),b=e.findViewIndexByID(n);"undefined"!==typeof c&&"undefined"!==typeof c.TrackList&&(c.TrackList.splice(f,1),e.generateTrackList(c),e.findSelectedView().modified=1,e.generateViewList(),e.generatePreview(c),$("#viewSelect"+e.level).prop("selectedIndex",b))};e.generateTrackList=function(f){var l=[];d3.select("table#trackListTbl"+e.level).select("tbody").selectAll("tr").remove();
if("undefined"!==typeof f.TrackList)for(var c=0;c<f.TrackList.length;c++)"AA"!==f.TrackList[c].Organism&&f.TrackList[c].Organism!==e.curOrg||l.push(f.TrackList[c]);d3.select("table#trackListTbl"+e.level).select("tbody").selectAll("tr").data(l).enter().append("tr").attr("class",function(b,a){return 0===a%2?"even":"odd"}).attr("id",function(b){return"trk"+b.TrackID}).each(function(b,a){var c='<img src="'+iconPath+'grab_flat.png" style="cursor: move; cursor: -webkit-grab; cursor: -moz-grab; " class="handle'+
e.level+'">';d3.select(this).append("td").attr("class","ind").html(c+(a+1));c='  <span class="listtooltip'+e.level+'" title= "'+b.Description+'"><img src="'+iconPath+'info.gif"></span>';d3.select(this).append("td").html(b.Name+c);c="";"AA"!==b.Organism&&(c=b.Organism,"RN"===c?c="Rat":"MM"===c&&(c="Mouse"),c+=" only");d3.select(this).append("td").html(c);c='<span class="moveUp'+e.level+'" name="'+b.TrackID+'" style="cursor:pointer;" ><img src="'+iconPath+'up_flat.png"></span>';c=c+' <span class="moveDown'+
e.level+'" name="'+b.TrackID+'" style="cursor:pointer;"><img src="'+iconPath+'down_flat.png"></span>';b.Controls&&5<b.Controls.length&&(c=c+'&nbsp&nbsp&nbsp<span class="trackSetting'+e.level+'" name="'+b.TrackID+'" style="cursor:pointer;"><img src="'+iconPath+'gear_flat.png"></span>');c=c+'&nbsp&nbsp&nbsp<span class="delete'+e.level+'" name="'+b.TrackID+'" style="cursor:pointer;"><img src="'+iconPath+'del_flat.png"></span>';d3.select(this).append("td").html(c);d3.select("table#trackListTbl"+e.level).selectAll(".trackSetting"+
e.level).on("click",function(){var a=d3.select(this).attr("name");a!==e.selectedTrackSetting?(e.previewSVG.getTrack(e.findTrack(a).TrackClass).generateSettingsDiv("div#trackSettingContent"),e.selectedTrackSetting=a,a=$(this).position(),$("#trackSettingDialog").css("top",a.top+240).css("left",$(window).width()-415),$("#trackSettingDialog").fadeIn("fast")):$("#trackSettingDialog").fadeOut("fast")}).on("mouseover",function(){$("#controlInfo"+e.level).html("Click to edit track settings.")}).on("mouseout",
function(){$("#controlInfo"+e.level).html("")});d3.select("table#trackListTbl"+e.level).selectAll(".moveUp"+e.level).on("click",function(){var a=$(this).attr("name");$("tr#trk"+a).insertBefore($("table#trackListTbl"+e.level+" tbody tr:first"));e.findSelectedView().modified=1;e.updateTrackNumber("",$("tr#trk"+a))}).on("mouseover",function(){$("#controlInfo"+e.level).html("Click to move the track to the top of the list.")}).on("mouseout",function(){$("#controlInfo"+e.level).html("")});d3.select("table#trackListTbl"+
e.level).selectAll(".moveDown"+e.level).on("click",function(){var a=$(this).attr("name");$("tr#trk"+a).insertAfter($("table#trackListTbl"+e.level+" tbody tr:last"));e.findSelectedView().modified=1;e.updateTrackNumber("",$("tr#trk"+a))}).on("mouseover",function(){$("#controlInfo"+e.level).html("Click to move the track to the end of the list.")}).on("mouseout",function(){$("#controlInfo"+e.level).html("")});d3.select("table#trackListTbl"+e.level).selectAll(".delete"+e.level).on("click",function(){var a=
d3.select(this).attr("name");e.removeTrackWithID(a)}).on("mouseover",function(){$("#controlInfo"+e.level).html("Click to remove the track from the view.")}).on("mouseout",function(){$("#controlInfo"+e.level).html("")})});$("#trackListTbl"+e.level+" tbody").sortable({handle:".handle"+e.level,stop:e.updateTrackNumber}).disableSelection();$(".listtooltip"+e.level).tooltipster({position:"top-right",maxWidth:250,offsetX:10,offsetY:5,contentAsHTML:!0,interactive:!0,interactiveTolerance:350});ga&&ga("send",
"event","BrowserViews","generateTrackList")};e.applyView=function(){var f=e.findSelectedView(),n=e.generateSettingStringFromUI();e.setupImage(n,f);$("div.viewsLevel"+e.level).hide();$("div.trackLevel"+e.level).hide();n="/"+pathPrefix;"db"===f.Source&&(pathPrefix||(n=""),$.ajax({url:n+"addBrowserCount.jsp",type:"GET",cache:!1,data:{viewID:f.ViewID},dataType:"json",success:function(c){},error:function(c,b,a){},async:!0}));ga&&ga("send","event","BrowserViews","applyView")};e.applySelectedView=function(f){for(var l=
NaN,c=-1,b=0;b<e.filterList.length&&isNaN(l);b++)e.filterList[b].ViewID===f&&(l=e.filterList[b],c=b);f=e.generateSettingStringFromView(l);e.setupImage(f,l);$("#viewSelect"+e.level).prop("selectedIndex",c);e.selectChange();ga&&ga("send","event","BrowserViews","applySelectedView")};e.setupImage=function(f,n){svgList[e.level].removeAllTracks();svgList[e.level].currentView=n;svgViewIDList[e.level]=n.ViewID;loadStateFromString(f,n.imgSettings,e.level,svgList[e.level]);$("span#viewLbl"+e.level).html("View: "+
n.Name);0===n.UserID?($("li#menusaveView"+e.level).addClass("ui-state-disabled"),$("li#menudeleteView"+e.level).addClass("ui-state-disabled")):($("li#menusaveView"+e.level).removeClass("ui-state-disabled"),$("li#menudeleteView"+e.level).removeClass("ui-state-disabled"))};e.updateTrackNumber=function(f,n){$("td.ind",$("table#trackListTbl"+e.level)).each(function(b){var a='<img src="'+iconPath+'grab_flat.png" style="cursor: move; cursor: -webkit-grab; cursor: -moz-grab; " class="handle'+e.level+'">    ';
$(this).html(a+(b+1))});d3.select("table#trackListTbl"+e.level).select("tbody").selectAll("tr").attr("class",function(b,a){return 0===a%2?"even":"odd"});var c=e.findSelectedView();e.generatePreview(c)};e.generateSettingsString=function(f){var l="";d3.select("table#trackListTbl"+e.level).select("tbody").selectAll("tr").each(function(c){l=l+c.TrackClass+","+c.Settings+";"});return l};e.generateSettingStringFromUI=function(){return e.previewSVG.generateSettingsString()};e.getViewData=function(){var f=
"/"+pathPrefix;pathPrefix||(f="");$.ajax({url:f+"getBrowserViews.jsp",type:"GET",data:{genomeVer:genomeVer},dataType:"json",success:function(f){e.viewList=[];for(var c=0;c<f.length;c++)if("AA"===f[c].Organism||f[c].Organism===e.curOrg){for(var b=0,a=0;a<f[c].TrackList.length;a++){var g=f[c].TrackList[a];"AA"!==g.Organism&&g.Organism!==e.curOrg||b++}f[c].orgCount=b;e.viewList.push(f[c])}trackInfo&&e.readCookieViews();e.generateViewList();0===e.initialized&&0===e.level?setTimeout(function(){e.initialized=
1;e.applySelectedView($("#defaultView").val())},500):1===e.level&&(e.initialized=1,e.applySelectedView(svgViewIDList[e.level]));ga&&ga("send","event","BrowserViews","getViews")},error:function(e,c,b){}})};e.readCookieViews=function(){var f="";if(!0===isLocalStorage()){var n=localStorage.getItem("phenogenCustomViews");n&&(f=n)}else $.cookie("phenogenCustomViews")&&(f=$.cookie("phenogenCustomViews"));if(f&&-1<f.indexOf("<///>"))for(f=f.split("<///>"),n=0;n<f.length;n++){var c=f[n].split("</>"),b={};
for(h=0;h<c.length;h++){var a=c[h].split("=");if("TrackSettingList"===a[0]){a=a[1].split(";");b.TrackList=[];for(var g=0;g<a.length;g++)if(0<a[g].length){var d=a[g].substr(0,a[g].indexOf(",")),p=a[g].substr(a[g].indexOf(",")+1),m={};m.TrackClass=d;m.Settings=p;m.Order=g;b.TrackList.push(m)}}else 2>=a.length?b[a[0]]=a[1]:2<a.length&&(a=c[h].substr(0,c[h].indexOf("=")),g=c[h].substr(c[h].indexOf("=")+1),b[a]=g)}b.Source="local";if(3<c.length){for(var h=c=0;h<b.TrackList.length;h++){if(a=trackInfo[b.TrackList[h].TrackClass])b.TrackList[h].TrackID=
a.TrackID,b.TrackList[h].UserID=a.UserID,b.TrackList[h].Name=a.Name,b.TrackList[h].Description=a.Description,b.TrackList[h].Organism=a.Organism,b.TrackList[h].Controls=a.Controls;a=b.TrackList[h];"AA"!==a.Organism&&a.Organism!==e.curOrg||c++}b.orgCount=c;e.viewList.push(b)}}};e.generateSettingStringFromView=function(e){var f="";e=e.TrackList;if("undefined"!==typeof e)for(var c=0;c<e.length;c++)f=f+e[c].TrackClass+","+e[c].Settings+";";return f};e.selectChange=function(){var f="",n=e.findSelectedView();
"AA"!==n.Organism&&("RN"===n.Organism?f="<BR><BR>Available for Rat Only":"MM"===n.Organism&&(f="<BR><BR>Available for Mouse Only"));0===n.UserID?$("#deleteView"+e.level).hide():$("#deleteView"+e.level).show();$("div#descOuter"+e.level+" div#descContent").html(n.Description+f);e.generateTrackList(n);e.generatePreview(n);$(".trackLevel"+e.level).is(":visible")&&trackMenu[e.level].generateTrackTable();$("#trackSettingDialog").hide()};e.setSelectedView=function(f){$("#viewTypeSelect"+e.level).val("all");
e.generateViewList();f=e.findDisplayedIndex(f);$("#viewSelect"+e.level).prop("selectedIndex",f)};e.findSelectedView=function(){for(var f=$("#viewSelect"+e.level).val(),n=NaN,c=0;c<e.viewList.length&&isNaN(n);c++)e.viewList[c].ViewID===f&&(n=e.viewList[c]);return n};e.findViewWithID=function(f){for(var l=NaN,c=0;c<e.viewList.length&&isNaN(l);c++)e.viewList[c].ViewID===f&&(l=e.viewList[c]);return l};e.findViewIndexByID=function(f){for(var l=NaN,c=0;c<e.viewList.length&&isNaN(l);c++)e.viewList[c].ViewID===
f&&(l=c);return l};e.findSelectedViewIndex=function(){for(var f=$("#viewSelect"+e.level).val(),n=NaN,c=0;c<e.viewList.length&&isNaN(n);c++)e.viewList[c].ViewID===f&&(n=c);return n};e.findDisplayedIndex=function(f){for(var l=NaN,c=0;c<e.filterList.length&&isNaN(l);c++)e.filterList[c].ViewID===f&&(l=c);return l};e.findTrackByClass=function(f,n){for(var c=e.findViewWithID(n).TrackList,b=NaN,a=0;a<c.length&&isNaN(b);a++)c[a].TrackClass===f&&(b=c[a]);return b};e.findTrack=function(f){for(var l=e.findSelectedView().TrackList,
c=NaN,b=0;b<l.length&&isNaN(c);b++)l[b].TrackID===f&&(c=l[b]);return c};e.findTrackIndex=function(f){var l=e.findSelectedView().TrackList,c=NaN;if("undefined"!==typeof l)for(var b=0;b<l.length&&isNaN(c);b++)l[b].TrackID===f&&(c=b);return c};e.findTrackIndexWithViewID=function(f,n){for(var c=e.findViewWithID(n).TrackList,b=NaN,a=0;a<c.length&&isNaN(b);a++)c[a].TrackID===f&&(b=a);return b};e.setupControls=function(){-1<f&&($(".control"+e.level+"#addTrack"+e.level).on("click",function(){if($(".trackLevel"+
e.level).is(":visible"))$(".trackLevel"+e.level).fadeOut("fast");else{var f=$("div.viewsLevel"+e.level).position(),n=0;1200<=$(window).width()&&(n=-601);trackMenu[e.level].standalone=!1;$(".trackLevel"+e.level).css("top",f.top).css("left",f.left+n);f=e.findSelectedView();$(".trackLevel"+e.level+" span#selectedViewName").html(f.Name);$(".trackLevel"+e.level).fadeIn("fast");$("div#selectTrack"+e.level).show();$("div#addUsrTrack"+e.level).hide();$("div#addUsrTrack"+e.level).hide();$("div#deleteUsrTrack"+
e.level).hide();setTimeout(function(){trackMenu[e.level].generateTrackTable()},250)}}).on("mouseover",function(){$("#controlInfo"+e.level).html("Click to add a track to the current view.")}).on("mouseout",function(){$("#controlInfo"+e.level).html("")}),$(".control"+e.level+"#addView"+e.level).on("click",function(){$("div#nameView"+e.level).show();$("div#selection"+e.level).hide();$("span#viewMenuLbl"+e.level).text("Create View");$("input#createType"+e.level).val("blank");$("input#function"+e.level).val("create")}).on("mouseover",
function(){$("#topcontrolInfo"+e.level).html("Click to create a new view with no tracks.")}).on("mouseout",function(){$("#topcontrolInfo"+e.level).html("")}),$(".control"+e.level+"#copyView"+e.level).on("click",function(){$("div#nameView"+e.level).show();$("div#selection"+e.level).hide();$("span#viewMenuLbl"+e.level).text("Create View");$("input#createType"+e.level).val("copy");$("input#function"+e.level).val("create")}).on("mouseover",function(){$("#topcontrolInfo"+e.level).html("Click to create a new view copied from the selected view.")}).on("mouseout",
function(){$("#topcontrolInfo"+e.level).html("")}),$(".control"+e.level+"#saveView"+e.level).on("click",function(){var f=e.findSelectedView();0===f.UserID?($("#predefinedSaveAs"+e.level).show(),e.saveAsView(f,e.previewSVG)):e.saveView(f.ViewID,e.previewSVG,!1)}).on("mouseover",function(){$("#topcontrolInfo"+e.level).html("Click to save changes to the currently selected view.")}).on("mouseout",function(){$("#topcontrolInfo"+e.level).html("")}),$(".control"+e.level+"#deleteView"+e.level).on("click",
function(){var f=e.findSelectedViewIndex();e.confirmDeleteView(e.viewList[f])}).on("mouseover",function(){$("#topcontrolInfo"+e.level).html("Click to delete current view.")}).on("mouseout",function(){$("#topcontrolInfo"+e.level).html("")}),$(".applyView"+e.level).on("click",function(){e.applyView()}),d3.select("#viewTypeSelect"+e.level).on("change",e.generateViewList).on("mouseover",function(){$("#topcontrolInfo"+e.level).html("Change to filter the view list by category.")}).on("mouseout",function(){$("#topcontrolInfo"+
e.level).html("")}))};e.generateViewList=function(){d3.select("#viewSelect"+e.level).html("");e.filterList=[];for(var f=$("#viewTypeSelect"+e.level).val(),n=0;n<e.viewList.length;n++)("all"===f||"predefined"===f&&0===e.viewList[n].UserID||"custom"===f&&0!==e.viewList[n].UserID)&&e.filterList.push(e.viewList[n]);d3.select("#viewSelect"+e.level).on("change",e.selectChange).on("mouseover",function(){$("#topcontrolInfo"+e.level).html("Click on a view to select it and view preview/details.")}).on("mouseout",
function(){$("#topcontrolInfo"+e.level).html("")}).selectAll("option").data(e.filterList).enter().append("option").attr("value",function(c){return c.ViewID}).text(function(c){var b=c.Name;b=0===c.UserID?b+"      (Predefined)":b+"     (Custom"+("local"===c.Source?" local":" server")+")";b=b+"     ("+c.orgCount+" tracks)";"AA"!==c.Organism&&("RN"===c.Organism?b+="      (Rat Only)":"MM"===c.Organism&&(b+="     (Mouse Only)"));c.modified&&1===c.modified&&(b+="   (Modified)");return b})};e.addTrackToView=
function(f){var l=e.findSelectedView(),c=e.findSelectedViewIndex();l.TrackList.push(f);e.generateTrackList(l);e.generatePreview(l);e.generateViewList();$("#viewSelect"+e.level).prop("selectedIndex",c);ga&&ga("send","event","BrowserViews","addTrackToView")};e.addTrackToViewWithID=function(f,n){var c=e.findViewWithID(f);c.TrackList.push(n);e.generateTrackList(c);e.generatePreview(c);e.generateViewList()};e.createNewView=function(){$("#predefinedSaveAs"+e.level).hide();if(0<uid)if("create"===$("#function"+
e.level).val()){var f=$("input#viewNameTxt"+e.level).val(),n=$("#viewDescTxt"+e.level).val(),c=$("input#createType"+e.level).val(),b=-1;"copy"===c&&(b=e.findSelectedView().ViewID);var a="/"+pathPrefix;pathPrefix||(a="");$.ajax({url:a+"createBrowserViews.jsp",type:"GET",cache:!1,data:{name:f,description:n,type:c,copyFrom:b,organism:organism},dataType:"json",success:function(a){e.getViewData();$("div#nameView"+e.level).hide();$("div#selection"+e.level).show();$("span#viewMenuLbl"+e.level).html("Select/Edit Views")},
error:function(a,b,c){console.log(c)},async:!1})}else"saveAs"===$("#function"+e.level).val()&&(f=$("input#viewNameTxt"+e.level).val(),n=$("#viewDescTxt"+e.level).val(),a="/"+pathPrefix,pathPrefix||(a=""),$.ajax({url:a+"createBrowserViews.jsp",type:"GET",cache:!1,data:{name:f,description:n,type:"blank",copyFrom:-1,organism:organism},dataType:"json",success:function(a){e.saveView(a.viewID,e.saveAsImg,!1);$("div#nameView"+e.level).hide();$("div#selection"+e.level).show();$("span#viewMenuLbl"+e.level).html("Select/Edit Views")},
error:function(a,b,c){console.log(c)},async:!1}));else{f=$("input#viewNameTxt"+e.level).val();n=$("#viewDescTxt"+e.level).val();c=$("input#createType"+e.level).val();b="";b=$.cookie("JSESSIONID");a=(new Date).getTime();b="ViewID="+(b+"_"+a)+"</>UserID=-999</>Name="+f+"</>Description="+n+"</>Organism="+organism.toUpperCase()+"</>imgSettings=displaySelect0=700;</>TrackSettingList=";if("saveAs"===$("#function"+e.level).val())f=e.saveAsImg.generateSettingsString(),b+=f;else if("copy"===c){f="";n=e.findSelectedView().TrackList;
for(c=0;c<n.length;c++)f=f+n[c].TrackClass+","+n[c].Settings+";";b+=f}b+="<///>";!0===isLocalStorage()?(f=localStorage.getItem("phenogenCustomViews"))?localStorage.setItem("phenogenCustomViews",f+b):localStorage.setItem("phenogenCustomViews",b):(f="",f=$.cookie("phenogenCustomViews")?$.cookie("phenogenCustomViews")+b:b,$.cookie("phenogenCustomViews",f));e.getViewData();$("div#nameView"+e.level).hide();$("div#selection"+e.level).show();$("span#viewMenuLbl"+e.level).html("Select/Edit Views")}$("input#viewNameTxt"+
e.level).val("");$("#viewDescTxt"+e.level).val("");$("input#createType"+e.level).val("blank");getMainViewData(1);ga&&ga("send","event","BrowserViews","createView")};e.saveView=function(f,n,c){if(0<uid){n=n.generateSettingsString();var b="/"+pathPrefix;pathPrefix||(b="");0<f&&$.ajax({url:b+"updateBrowserView.jsp",type:"GET",cache:!1,data:{viewID:f,trackList:n},dataType:"json",success:function(a){e.getViewData()},error:function(a,b,c){console.log(c)},async:c})}else{c=b="";if(!0===isLocalStorage()){var a=
localStorage.getItem("phenogenCustomViews");a&&(b=a)}else $.cookie("phenogenCustomViews")&&(b=$.cookie("phenogenCustomViews"));b=b.split("<///>");for(a=0;a<b.length;a++)if(10<b[a].length)if(-1<b[a].indexOf("ViewID="+f)){var g=b[a].substr(0,b[a].indexOf("</>TrackSettingList=")),d=n.generateSettingsString();c=c+g+"</>TrackSettingList="+d+"<///>"}else c=c+b+"<///>";!0===isLocalStorage()?localStorage.setItem("phenogenCustomViews",c):$.cookie("phenogenCustomViews",c);e.getViewData()}getMainViewData(1);
ga&&ga("send","event","BrowserViews","saveView")};e.saveAsView=function(f,n){e.saveAs=f;e.saveAsImg=n;$("div#nameView"+e.level).show();$("div#selection"+e.level).hide();$("span#viewMenuLbl"+e.level).text("Save As...");$("input#createType"+e.level).val("blank");$("input#function"+e.level).val("saveAs");ga&&ga("send","event","BrowserViews","saveAsView")};e.confirmDeleteView=function(f){e.findSelectedView().ViewID!==f.ViewID&&e.setSelectedView(f.ViewID);0<f.UserID||-999===Number(f.UserID)?($("div#selection"+
e.level).hide(),$("#deleteViewName"+e.level).html(f.Name+"    ("+f.orgCount+" tracks)"),$("#confirmDeleteView"+e.level).show()):$("#topcontrolInfo"+e.level).html("This is a predefined view, you may not delete it.")};e.cancelDeleteView=function(){$("#confirmDeleteView"+e.level).hide();$("div#selection"+e.level).show()};e.deleteView=function(){var f=e.findSelectedViewIndex(),n=e.viewList[f];if("db"===n.Source){var c="/"+pathPrefix;pathPrefix||(c="");$.ajax({url:c+"deleteView.jsp",type:"GET",data:{viewID:n.ViewID},
dataType:"json",cache:!1,success:function(a){"Deleted Successfully"===a.status&&(e.viewList.splice(f,1),e.generateViewList());$("#topcontrolInfo"+e.level).html(a.status)},error:function(a,b,c){console.log(c);$("#topcontrolInfo"+e.level).html("There was an error deleting this view.")},async:!0})}else{var b="";c="";if(!0===isLocalStorage()){var a=localStorage.getItem("phenogenCustomViews");a&&(b=a)}else $.cookie("phenogenCustomViews")&&(b=$.cookie("phenogenCustomViews"));b=b.split("<///>");for(a=0;a<
b.length;a++)-1<b[a].indexOf("ViewID="+n.ViewID)||10<b[a].length&&(c=c+b[a]+"<///>");!0===isLocalStorage()?localStorage.setItem("phenogenCustomViews",c):$.cookie("phenogenCustomViews",c);e.viewList.splice(f,1);e.generateViewList()}$("#confirmDeleteView"+e.level).hide();$("div#selection"+e.level).show();$("#viewSelect"+e.level).prop("selectedIndex",0);e.selectChange();svgList[e.level].currentView.ViewID===n.ViewID&&e.applyView();getMainViewData(1);ga&&ga("send","event","BrowserViews","deleteView")};
e.cancelView=function(){$("div#nameView"+e.level).hide();$("div#selection"+e.level).show();$("#predefinedSaveAs"+e.level).hide();$("span#viewMenuLbl"+e.level).html("Select/Edit Views")};e.getViewData();e.setupControls();return e};function TrackMenu(f){var e={};e.level=f;e.trackList=[];e.previewLevel=101;e.previewSVG=NaN;e.dataInitialized=0;e.trackDataTable;e.generateTrackTable=function(){for(var f=$("#trackTypeSelect"+e.level).val(),n=[],c=0,b=0;b<e.trackList.length;b++)!("all"===f||"allpublic"===f&&0===e.trackList[b].UserID||"custom"===f&&0!==e.trackList[b].UserID||"genome"===f&&"Genome"===e.trackList[b].GenericCategory||"trxome"===f&&"Transcriptome"===e.trackList[b].GenericCategory)||"AA"!==e.trackList[b].Organism.toUpperCase()&&
e.trackList[b].Organism.toUpperCase()!==organism.toUpperCase()||0!==$("table#trackListTbl"+e.level+" tr#trk"+e.trackList[b].TrackID).length||(n[c]=e.trackList[b],c++);try{$.fn.DataTable.isDataTable("table#trkSelList"+e.level)&&e.trackDataTable.destroy()}catch(a){Bugsense.notify(a,{datatables:"not initialized"})}"custom"===f&&0===n.length?($("#noCustomTracks").show(),0===uid?$("#notSignedIn1").show():$("#notSignedIn1").hide()):($("#noCustomTracks").hide(),$("#notSignedIn1").hide());d3.select("table#trkSelList"+
e.level).select("tbody").selectAll("tr").remove();d3.select("table#trkSelList"+e.level).select("tbody").selectAll("tr").data(n).enter().append("tr").attr("id",function(a){return"trk"+a.TrackID}).attr("class",function(a,b){var c="odd";0===b%2&&(c="even");return c}).each(function(a,b){var c="",g="";"local"===a.Source&&(g=" (Local)");0!==a.UserID&&(c=new String(a.SetupDate),c=c.substr(0,c.indexOf(":",c.indexOf(":")+1)),c="<BR><BR>File:"+a.OriginalFile+"<BR><BR>Setup Date:"+c+"<BR><BR>Type:"+a.Type,"local"===
a.Source&&(c+="<BR><BR>Local Track only available on this computer."));c='  <span class="trlisttooltip'+e.level+'" title= "'+a.Description+c+'"><img src="'+iconPath+'info.gif"></span>';d3.select(this).append("td").html(a.Name+g+c);g="";"RN"===a.Organism?g="Rat":"MM"===a.Organism&&(g="Mouse");c="Public";0!==a.UserID&&(c="Custom");d3.select(this).append("td").html(g);d3.select(this).append("td").html(a.GenericCategory);d3.select(this).append("td").html(a.Category);d3.select(this).append("td").html(c)});
$.fn.DataTable.isDataTable("table#trkSelList"+e.level)||(f=e.getInitTrackTableHeight(n),e.trackDataTable=$("table#trkSelList"+e.level).DataTable({bPaginate:!1,aaSorting:[[3,"asc"]],sScrollY:f,sDom:'<"rightSearch"fr><t>',columnDefs:[{width:"45%",targets:0}]}));e.trackDataTable.draw();$("td#selectedTrack"+e.level).hide();$("table#trkSelList"+e.level+" tbody").on("click","tr",function(){if(!$(this).hasClass("selected")){$("table#trkSelList"+e.level+" tbody tr.selected").removeClass("selected");$(this).addClass("selected");
$(this).attr("id");var a=e.findSelectedTrack(),b="Selected Track Name: "+a.Name+'  <span class="trInfotooltip'+e.level+'" title= "'+a.Description+'"><img src="'+iconPath+'info.gif"></span>';$("div#trackHeaderOuter"+e.level+" #trackHeaderContent").html(b);b=e.getTrackTableHeight(n);e.trackDataTable.settings()[0].oScroll.sy=b;try{e.trackDataTable.columns.adjust().draw()}catch(d){Bugsense.notify(d,{datatables:"error adjusting columns:136"})}$("#trkSelList"+e.level+"_wrapper div.dataTables_scroll div.dataTables_scrollBody").css("height",
b);$("td#selectedTrack"+e.level).show();$(".trInfotooltip"+e.level).tooltipster({position:"top-right",maxWidth:250,offsetX:10,offsetY:5,contentAsHTML:!0,interactive:!0,interactiveTolerance:350});e.generatePreview(a);(b=e.previewSVG.getTrack(a.TrackClass))&&b.generateSettingsDiv&&b.generateSettingsDiv("td#selectedTrack"+e.level);$("td#selectedTrack"+e.level+" #trackListTbl"+e.level+" tbody tr:first").remove();$("td#selectedTrack"+e.level+" #trackListTbl"+e.level+" tbody tr:last").remove();0!==a.UserID?
$("span#deleteCustomTrack"+e.level).show():$("span#deleteCustomTrack"+e.level).hide();b.updateSettingsFromUI()}});$(".trlisttooltip"+e.level).tooltipster({position:"top-right",maxWidth:250,offsetX:10,offsetY:5,contentAsHTML:!0,interactive:!0,interactiveTolerance:350})};e.getInitTrackTableHeight=function(e){var f="750px";0===e.length?f="30px":15>e.length&&(f=30*e.length+"px");return f};e.getTrackTableHeight=function(e){var f="300px";0===e.length?f="20px":10>e.length&&(f=30*e.length+"px");return f};
e.getTrackData=function(){var f="/"+pathPrefix;""===pathPrefix&&(f="");$.ajax({url:f+"getBrowserTracks.jsp",type:"GET",data:{genomeVer:genomeVer},dataType:"json",success:function(f){e.trackList=f;if(0===e.level)for(trackInfo=[],f=0;f<e.trackList.length;f++)trackInfo[e.trackList[f].TrackClass]=e.trackList[f];e.readCookieTracks();e.dataInitialized=1;e.generateTrackTable();trackMenu[e.level]&&trackMenu[e.level].readCookieViews&&(trackMenu[e.level].readCookieViews(),trackMenu[e.level].generateViewList())},
error:function(e,c,b){}})};e.readCookieTracks=function(){var f="";if(!0===isLocalStorage()){var n=localStorage.getItem("phenogenCustomTracks");n&&(f=n)}else $.cookie("phenogenCustomTracks")&&(f=$.cookie("phenogenCustomTracks"));if(f&&-1<f.indexOf("<;>"))for(f=f.split("<;>"),n=0;n<f.length;n++){var c=f[n].split("<->"),b={};for(k=0;k<c.length;k++){var a=c[k].split("=");if(2>=a.length)b[a[0]]=a[1];else if(2<a.length){a=c[k].substr(0,c[k].indexOf("="));var g=c[k].substr(c[k].indexOf("=")+1);b[a]=g}}b.Source=
"local";3<c.length&&(e.trackList.push(b),0===e.level&&(trackInfo[b.TrackClass]=b))}};e.findSelectedTrack=function(){var f=NaN;if(0<$("table#trkSelList"+e.level+" tbody tr.selected").length){var n=$("table#trkSelList"+e.level+" tbody tr.selected").attr("id");n=n.substr(3);for(var c=0;c<e.trackList.length&&isNaN(f);c++)e.trackList[c].TrackID===n&&(f=e.trackList[c])}return f};e.generateSettingsString=function(e){return e.TrackClass+","+e.Settings+";"};e.generatePreview=function(f){$("div#trackPreviewOuter"+
e.level+" div#trackPreviewContent").html("");var l=(new String(organism)).toUpperCase();if("AA"===f.Organism||f.Organism===l){l=svgList[e.level].xScale.domain()[0];var c=svgList[e.level].xScale.domain()[1];e.previewSVG=toolTipSVG("div#trackPreviewOuter"+e.level+" div#trackPreviewContent",565,l,c,e.previewLevel,chr,svgList[e.level].type);e.previewSVG.folderName=svgList[e.level].folderName;f=e.generateSettingsString(f);loadStateFromString(f,"",e.previewLevel,e.previewSVG);e.previewSVG.updateData();
e.previewSVG.updateFullData();$("div#trackPreviewContent div#ScrollLevel"+e.previewLevel).css("max-height","250px").css("overflow","auto")}else $("div#previewOuter"+e.level+" div#previewContent").html("No Preview Available: The current organism doesn't match the tracks included in this view.")};e.removeTrack=function(f){e.generateTrackTable()};e.confirmdeleteCustomTrack=function(){var f=e.findSelectedTrack();$("#deleteUsrTrack"+e.level).show();$("#selectTrack"+e.level).hide();f="Name: <B>"+f.Name+
"</B><BR>Description: <B>"+f.Description+"</B><BR>Original File: <B>"+f.OriginalFile+"</B><BR>Setup Date: <B>"+f.SetupDate+"</b>";$("span#customTrackInfo"+e.level).html(f);ga&&ga("send","event","BrowserTracks","deleteCustomTrack")};e.cancelDeleteTrack=function(){$("#deleteUsrTrack"+e.level).hide();$("#selectTrack"+e.level).show()};e.deleteTrack=function(){var f=e.findSelectedTrack();if("local"===f.Source){var n="TrackClass="+f.TrackClass+"<->",c="";if(!0===isLocalStorage()){var b=localStorage.getItem("phenogenCustomTracks");
b&&(c=b)}else $.cookie("phenogenCustomTracks")&&(c=$.cookie("phenogenCustomTracks"));if(c&&-1<c.indexOf("<;>")){var a="";c=c.split("<;>");for(b=0;b<c.length;b++)-1===c[b].indexOf(n)&&(a=a+c[b]+"<;>");n="/"+pathPrefix;pathPrefix||(n="");$.ajax({url:n+"removeCustomTrack.jsp",type:"GET",data:{trackID:f.TrackID},dataType:"json",success:function(b){!0===isLocalStorage()?localStorage.setItem("phenogenCustomTracks",a):$.cookie("phenogenCustomTracks",a)},error:function(a,b,c){console.log(c)},async:!1})}}else"db"===
f.Source&&(n="/"+pathPrefix,pathPrefix||(n=""),$.ajax({url:n+"deleteTrack.jsp",type:"GET",data:{trackID:f.TrackID},dataType:"json",success:function(a){"true"===a.success?$(".uploadStatus").html("<B>Track Setup Successfully</B>"):$(".uploadStatus").html("<B>Track Setup Failed</B>")},error:function(a,b,c){console.log(c)},async:!1}));e.getTrackData();$("#deleteUsrTrack"+e.level).hide();$("#selectTrack"+e.level).show();e.generateTrackTable();ga&&ga("send","event","BrowserTracks","deleteTrack")};e.confirmUpload=
function(){$("div#confirmUpload"+e.level).show();$("div#uploadBtn"+e.level).hide()};e.confirmBed=function(){$("input#hasconfirmBed"+e.level).val(1);e.createCustomTrack(e.level)};e.cancelUpload=function(){$("div#confirmUpload"+e.level).hide();$("div#confirmBed"+e.level).hide();$("div#uploadBtn"+e.level).show()};e.createCustomTrack=function(){$("div#confirmUpload"+e.level).hide();customTrackLevel=e.level;var f=$("#usrtrkFileTypeSelect"+e.level).val();"bed"===f||"bg"===f?e.createUploadedCustomTrack():
("bb"===f||"bw"===f)&&e.createRemoteCustomTrack();ga&&ga("send","event","BrowserTracks","createCustomTrack")};e.createUploadedCustomTrack=function(){var f=$("input#customUploadFile"+e.level)[0].files[0],n=$("#usrtrkFileTypeSelect"+e.level).val(),c=f.name,b=f.size/1024/1024;$(".uploadStatus").show();var a="";if(0<c.indexOf(".")){for(var g=c;-1<g.indexOf(".");)g=g.substr(g.indexOf(".")+1);""!==g&&g!==c&&(a=g)}20>b?a!==n?"gz"===a||"tar"===a||"zip"===a||"exe"===a||"bin"===a?(setTimeout(function(){$("div#uploadBtn"+
customTrackLevel).show();$(".progressInd").hide()},5E3),$(".uploadStatus").html("Error: Selected File Type is not supported.")):0===$("input#hasconfirmBed"+e.level).val()?$("div#confirmBed"+customTrackLevel).show():1===$("input#hasconfirmBed"+e.level).val()&&($("div#confirmBed"+customTrackLevel).hide(),e.createTrack(f)):e.createTrack(f):($("div#uploadBtn"+customTrackLevel).show(),$(".progressInd").hide(),$(".uploadStatus").html("File is too large.  20MB is the current limit."))};e.createTrack=function(f){e.readFile(f)};
e.createRemoteCustomTrack=function(){$(".uploadStatus").html("Setting up track...");$(".uploadStatus").show();var f=$("#customFileURL"+e.level).val(),n="",c=new Date;$.cookie("JSESSIONID")&&(n=$.cookie("JSESSIONID"),n=n+"_"+c.getTime());e.saveTrack(n,f)};e.saveTrack=function(f,n){var c=$("#usrtrkNameTxt"+e.level).val(),b=$("#usrtrkDescTxt"+e.level).val(),a=$("#usrtrkOrgSelect"+e.level).val(),g=$("#usrtrkGenCatSelect"+e.level).val(),d=$("#usrtrkCatTxt"+e.level).val(),p="",m=$("#usrtrkFileTypeSelect"+
e.level).val(),h="";if("bed"===m||"bg"===m)h=$("input#customUploadFile"+e.level)[0].files[0].name;var l="Color";0<$("#usrtrkColorSelect"+e.level).length&&(l=$("#usrtrkColorSelect"+e.level).val());if("Score"===l){var q="000000",u="FFFFFF",t=1,y=1E3;testIE||testSafari?(q=$("#usrtrkColorMin"+e.level).spectrum("get").toHexString(),u=$("#usrtrkColorMax"+e.level).spectrum("get").toHexString()):(q=$("#usrtrkColorMin"+e.level).val(),u=$("#usrtrkColorMax"+e.level).val(),console.log(q),console.log(u));q=q.substr(1);
u=u.substr(1);t=$("#usrtrkScoreMinTxt"+e.level).val();y=$("#usrtrkScoreMaxTxt"+e.level).val()}"bed"===m?p="Name=View Density;Select:trackSelect:Dense:Select;{Dense:1}{Pack:3}{Full:2};Default=3,Name=Color by;Select:colorSelect::colorSelect;{Feature Defined:Color}{Score based scale:Score};Default="+l+",Name=Scale Range;Txt:tissuecbx;{min:1}{max:1000};Default="+t+":"+y+",Name=Color Range;Txt:color;{min:FFFFFF}{max:000000};Default="+q+":"+u:"bg"===m?p="Name=View Density;Select:trackSelect:Dense:Select;{Dense:1}{Full:2};Default=1,Name=Scale Range;Slider:rangeslider;{min:1-1000}{max:1000-20000};Default=1:5000":
"bw"===m?p="Name=View Density;Select:trackSelect:Dense:Select;{Dense:1}{Full:2};Default=1,Name=Scale Range;Slider:rangeslider;{min:1-1000}{max:1000-20000};Default=1:5000":"bb"===m&&(p="Name=View Density;Select:trackSelect:Dense:Select;{Dense:1}{Pack:3}{Full:2};Default=3,Name=Color by;Select:colorSelect::colorSelect;{Feature Defined:Color}{Score based scale:Score};Default="+l+",Name=Scale Range;Txt:tissuecbx;{min:1}{max:1000};Default="+t+":"+y+",Name=Color Range;Txt:color;{min:FFFFFF}{max:000000};Default="+
q+":"+u);f="custom"+f;0<uid?(l="/"+pathPrefix,pathPrefix||(l=""),$.ajax({url:l+"addTrack.jsp",type:"GET",data:{trackClass:f,trackName:c,trackDesc:b,trackOrg:a,genericCategory:g,category:d,controls:p,location:n,type:m,file:h},dataType:"json",success:function(a){"true"===a.success?$(".uploadStatus").html("<B>Track Setup Successfully</B>"):$(".uploadStatus").html("<B>Track Setup Failed</B>")},error:function(a,b,c){console.log(c)},async:!1})):(l=new Date,c="TrackID="+f+"<->UserID=-999<->TrackClass="+
f+"<->Name="+c+"<->Description="+b+"<->Organism="+a.toUpperCase(),c=c+"<->Settings=<->Order=0<->GenericCategory="+g+"<->Category="+d+"<->Controls="+p+"<->SetupDate="+l+"<->Type="+m+"<->OriginalFile="+h+"<->Location="+n,c=c+"<->genomeVer="+genomeVer,c+="<;>",!0===isLocalStorage()?((g=localStorage.getItem("phenogenCustomTracks"))&&(c=g+c),localStorage.setItem("phenogenCustomTracks",c)):($.cookie("phenogenCustomTracks")&&(c=$.cookie("phenogenCustomTracks")+c),$.cookie("phenogenCustomTracks",c)),$(".uploadStatus").html("<B>Track Setup Successfully</B>"));
$("div#finished"+e.level).show();$("input#customUploadFile"+e.level).val("");$("input#customURL"+e.level).val("");$("input#usrtrkNameTxt"+e.level).val("");$("#usrtrkDescTxt"+e.level).val("");$("input#usrtrkOrgSelect"+e.level).val("Rn");$("input#usrtrkGenCatSelect"+e.level).val("Genome");$("input#usrtrkCatTxt"+e.level).val("");$("#usrtrkColorSelect"+e.level).val("Color");$("#customFileURL"+e.level).val("");e.getTrackData();ga&&ga("send","event","BrowserTracks","saveTrack")};e.readFile=function(f){var l=
new FileReader;l.readAsText(f,"UTF-8");l.onload=e.sendFile};e.sendFile=function(f){$.ajax({url:pathPrefix+"trackUpload.jsp",type:"POST",contentType:"text/plain",xhr:function(){var f=$.ajaxSettings.xhr();f.upload.addEventListener("progress",e.progressHandlingFunction,!1);return f},data:f.target.result,processData:!1,cache:!1,dataType:"json",success:function(f){$(".uploadStatus").html("<B>Upload Completed Successfully</b>");e.saveTrack(f.trackFile,f.trackFile);ga&&ga("send","event","BrowserTracks",
"customTrackUploaded")},error:function(e,c,b){console.log(b);$(".uploadStatus").html("Error:"+b);$("div#uploadBtn"+customTrackLevel).show()}})};e.progressHandlingFunction=function(e){$(".progressInd").show();$(".uploadStatus").html("Uploading...");e.lengthComputable&&$("progress").attr({value:e.loaded,max:e.total})};e.getTrackData();return e};$(window).resize(function(){"undefined"!==typeof wgcna&&("undefined"!==typeof wgcna.multiImage?wgcna.multiImage.draw():"undefined"!==typeof wgcna.singleImage&&wgcna.singleImage.draw())});function replaceDot(f){return f.replace(/\./g,"_")}function replaceUnderscore(f){return f.replace(/_/g,".")}function removeColon(f){return f.replace(/:/g,"")}
function WGCNABrowser(f,e,l,n,c,b){that={};that.singleID=f;that.region=e;that.dispType=n;that.viewType=c;that.geneList=l;that.moduleList=[];that.moduleGenes={};that.modules={};that.tissue=b;that.panel="";that.requests=0;that.skipGrey=1;that.chrLen=19;that.selSource="seq";"Mm"===organism?(that.panel="ILS/ISS",that.wDSID=1):"Rn"===organism&&("rn5"===genomeVer?(that.panel="BNLx/SHR",that.chrLen=20,that.wDSID=2):(that.panel="BNLx/SHR",that.chrLen=20,"seq"===that.selSource?"Whole Brain"===b?that.wDSID=
6:"Liver"===b&&(that.wDSID=7):"Whole Brain"===b?that.wDSID=3:"Heart"===b?that.wDSID=4:"Liver"===b&&(that.wDSID=5)));that.eQTLKey=function(a){return"Link_"+a.Snp};that.mirKey=function(a){return a.ID};that.modKey=function(a){return a.MODULE};that.removeInvalidIDChars=function(a){"undefined"!==typeof a&&(-1<a.indexOf("*")&&(a=a.replace(/\*/g,"star")),-1<a.indexOf(" ")&&(a=a.replace(/\s/g,"_")),-1<a.indexOf(".")&&(a=a.replace(/\./g,"_")));return a};that.setup=function(){that.requestModuleList();that.createImageControls();
that.createViewControls();that.createDataControls();$(".wgcnaControltooltip").tooltipster({position:"top-right",maxWidth:250,offsetX:5,offsetY:5,contentAsHTML:!0,interactive:!0,interactiveTolerance:350});ga&&ga("send","event","setupWGCNA","setupWGCNA")};that.requestModuleList=function(){that.moduleGenes={};that.moduleList=[];$.ajax({url:pathPrefix+"getWGCNAModules.jsp",type:"GET",async:!0,data:{source:that.selSource,modFileType:that.viewtype,id:that.singleID,organism:organism,panel:that.panel,tissue:that.tissue,
region:that.region,geneList:that.geneList,genomeVer:genomeVer},dataType:"json",beforeSend:function(){$("#waitCircos").show();console.log("request mod list:"+that.wDSID+":"+that.selSource)},success:function(a){$("#wgcnaGeneImage #message").hide();that.moduleList=[];if(0<a.length&&(1!==a.length||"grey"!==a[0].ModuleID)){for(var b=0;b<a.length;b++)"grey"!==a[b].ModuleID&&(that.moduleList.push(a[b].ModuleID),that.requests++,that.requestModule(a[b].ModuleID),"undefined"!==typeof a[b].GeneList&&(that.moduleGenes[a[b].ModuleID]=
a[b].GeneList));that.refreshRegion(1E3);setTimeout(function(){$("html, body").animate({scrollTop:$("#multiWGCNAScroll").offset().top},100)},1200)}else 0===a.length?that.displayMessage("There are no transcripts with Affymetrix Probesets that represent this gene."):1===a.length&&"grey"===a[0].ModuleID&&that.displayMessage("Only the Grey module contains transcripts for this gene.  The Grey module contains all transcripts that did not have a high enough correlation with any other transcripts to be included in another module.");
ga&&ga("send","event","requestModuleList","requestModuleList")},error:function(a,b,c){}})};that.displayMessage=function(a){$("#waitCircos").hide();$("#wgcnaGeneImage #message").html("<BR><BR><h2>"+a+"</h2><BR><BR>").show()};that.refreshRegion=function(a){setTimeout(function(){that.createMultiWGCNAImage();0<that.requests?that.refreshRegion(2E3):1!==a&&(that.refreshRegion(1),$("#waitCircos").hide())},a)};that.requestModule=function(a,b){$.ajax({url:contextRoot+"tmpData/browserCache/"+genomeVer+"/modules/ds"+
that.wDSID+"/"+a+".json",type:"GET",async:!0,data:{},dataType:"json",success:function(c){setTimeout(function(){console.log(a);if(0<that.singleID.length)that.countGeneInstance(that.singleID,c);else{var d=that.moduleGenes[a].split(",");c.GroupedGenes=d.length;that.countGeneInstance(that.moduleGenes[a],c)}that.modules[a]=c;that.requests--;b&&b(a)},20);ga&&ga("send","event","requestModule",a)},error:function(a,b,c){that.requests--}})};that.scanFilter=function(a,b){var c=[];if(a)for(var e=0;e<a.length;e++)b(a[e])&&
c.append(a[e]);return c};that.countGeneInstance=function(a,b){var c=b.TCList,e=0;b.selectGeneTC={};for(var f=0;f<c.length;f++)-1<a.indexOf(c[f].Gene.ID)&&e++;b.GeneCount=e};that.createImageControls=function(){that.imageBar=d3.select("#imageControl").append("span").style("float","left");that.imageBar.append("span").attr("class","saveImage control").style("display","inline-block").attr("id","saveImage").style("cursor","pointer").append("img").attr("src",contextRoot+"web/images/icons/savePic_dark.png").attr("pointer-events",
"all").attr("cursor","pointer").on("click",function(){var a="";if(that.singleImage){"eqtl"===that.viewType&&"eqtl"===that.singleImage.type?a=$("div#circos").html():"gene"===that.viewType&&"gene"===that.singleImage.type?a=$("div#viewGene").html():"mir"===that.viewType&&"mir"===that.singleImage.type?a=$("div#viewGene").html():"go"===that.viewType&&"go"===that.singleImage.type&&(a=$("div#viewGene").html());var b=$(window).width();a=a.replace('width="100%"','width="'+b+'px"');$.ajax({url:pathPrefix+"saveBrowserImage.jsp",
type:"POST",contentType:"text/html",data:a+"\n",processData:!1,dataType:"json",success:function(a){var b=new Date;b=b.getMonth()+1+"_"+b.getDate()+"_"+b.getFullYear();var c="http://";"https:"===location.protocol&&(c="https://");var d=c+urlprefix+"/tmpData/download/"+a.imageFile;a="";that.selectedModule&&(a=new String(that.selectedModule.MOD_NAME));a=a+"_"+that.viewType;var e=a+"_"+b+".png",f=new XMLHttpRequest;f.open("GET",d);f.responseType="blob";f.send();f.onreadystatechange=function(){if(4!=f.readyState||
200!=f.status)return!1;var a=document.createElement("a");a.href=window.URL.createObjectURL(f.response);a.download=e;a.style.display="none";document.body.appendChild(a);try{a.click()}catch(t){$("#wgcnaMouseHelp").html("<span style='color:#FF0000;'>Your browser will not save the image directly. Image will open in a popup, in the new window right click to save image.</span>"),window.open(d)}return!0}},error:function(a,b,c){console.log(c)}});ga&&ga("send","event","saveWGCNAView","saveWGCNAView")}}).on("mouseover",
function(){d3.select(this).attr("src",contextRoot+"web/images/icons/savePic_white.png");$("#wgcnaMouseHelp").html("Click to download a PNG image of the current view.")}).on("mouseout",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/savePic_dark.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});that.imageBar.append("span").attr("class","reset control").style("display","inline-block").attr("id","wgcnaresetImage").style("cursor",
"pointer").append("img").attr("src",contextRoot+"web/images/icons/reset_dark.png").attr("pointer-events","all").attr("cursor","pointer").on("click",function(){that.singleImage&&("eqtl"===that.viewType?that.singleImage.panZoomCircos.reset():"undefined"!==typeof that.singleImage&&that.singleImage.panZoom.reset());ga&&ga("send","event","resetWGCNAView","resetWGCNAView")}).on("mouseover",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/reset_white.png");$("#wgcnaMouseHelp").html("Click to reset image zoom to initial region.")}).on("mouseout",
function(){d3.select(this).attr("src",contextRoot+"web/images/icons/reset_dark.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});that.imageBar.append("span").attr("class","zoomIn control").style("display","inline-block").style("cursor","pointer").style("position","relative").style("top","7px").attr("id","wgcnazoomInImage").append("img").attr("src",contextRoot+"web/images/icons/magPlus_dark_32.png").attr("pointer-events","all").attr("cursor",
"pointer").style("position","relative").style("top","-5px").on("click",function(){"eqtl"===that.viewType&&that.singleImage?that.singleImage.panZoomCircos.zoomIn():void 0==that.singleImage&&that.multiImage?that.multiImage.zoomIn():"undefined"!==typeof that.singleImage&&that.singleImage&&that.singleImage.panZoom.zoomIn();ga&&ga("send","event","zoomInWGCNAView","zoomInWGCNAView")}).on("mouseover",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/magPlus_light_32.png");$("#wgcnaMouseHelp").html("Click to zoom in.")}).on("mouseout",
function(){d3.select(this).attr("src",contextRoot+"web/images/icons/magPlus_dark_32.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});that.imageBar.append("span").attr("class","zoomOut control").style("display","inline-block").style("cursor","pointer").style("position","relative").style("top","7px").attr("id","wgcnazoomOutImage").append("img").attr("src",contextRoot+"web/images/icons/magMinus_dark_32.png").attr("pointer-events","all").attr("cursor",
"pointer").style("position","relative").style("top","-5px").on("click",function(){"eqtl"===that.viewType&&that.singleImage?that.singleImage.panZoomCircos.zoomOut():void 0==that.singleImage&&that.multiImage?that.multiImage.zoomOut():that.singleImage&&"undefined"!==typeof that.singleImage&&"undefined"!==typeof that.singleImage.panZoom&&that.singleImage.panZoom.zoomOut();ga&&ga("send","event","zoomOutWGCNAView","zoomOutWGCNAView")}).on("mouseover",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/magMinus_light_32.png");
$("#wgcnaMouseHelp").html("Click to zoom out.")}).on("mouseout",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/magMinus_dark_32.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});that.imageBar.append("span").attr("class","back control").style("display","inline-block").style("cursor","pointer").style("position","relative").style("top","7px").attr("id","backModule").append("img").attr("src",contextRoot+"web/images/icons/back_dark_32.png").attr("pointer-events",
"all").attr("cursor","pointer").style("position","relative").style("top","-5px").on("click",function(){that.multiImage.backModule()}).on("mouseover",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/back_light_32.png");$("#wgcnaMouseHelp").html("Click to move to the previous module.")}).on("mouseout",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/back_dark_32.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});
that.imageBar.append("span").attr("class","forward control").style("display","inline-block").style("cursor","pointer").style("position","relative").style("top","7px").attr("id","forwardModule").append("img").attr("src",contextRoot+"web/images/icons/forward_dark_32.png").attr("pointer-events","all").attr("cursor","pointer").style("position","relative").style("top","-5px").on("click",function(){that.multiImage.forwardModule()}).on("mouseover",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/forward_light_32.png");
$("#wgcnaMouseHelp").html("Click to move to the next module.")}).on("mouseout",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/forward_dark_32.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")})};that.createViewControls=function(){that.viewBar=d3.select("#viewControl").append("div").attr("id","wgcnaViewControls").style("float","right").style("margin-left","10px").style("margin-right","5px").style("text-align","left");
that.viewBar.append("text").text("Views:");that.viewBar.append("span").attr("id","HelpWGCNAView").append("img").attr("src",contextRoot+"web/images/icons/help.png");that.viewBar.append("br");that.viewBar.append("input").attr("type","radio").attr("id","wgcnaGeneViewRB").attr("name","wgcnaViewRB").attr("value","gene").attr("checked","checked").style("margin-left","7px").style("margin-right","3px").on("click",function(){that.viewType="gene";that.createSingleWGCNAImage();ga&&ga("send","event","WGCNA",
"moduleView")});that.viewBar.append("text").text("Module");that.viewBar.append("span").attr("class","wgcnaControltooltip").attr("title",'View transcripts within the selected module and their connectivity based on correlation of expression.<BR><BR>Have a question about this view click the <img src="'+contextRoot+'web/images/icons/help.png"> above for a detailed description of each view.').style("margin-left","5px").append("img").attr("src","/web/images/icons/info.gif");that.viewBar.append("br");that.viewBar.append("input").attr("type",
"radio").attr("id","wgcnaEQTLViewRB").attr("name","wgcnaViewRB").attr("value","eqtl").style("margin-left","7px").style("margin-right","3px").on("click",function(){that.viewType="eqtl";that.createSingleWGCNAImage();ga&&ga("send","event","WGCNA","eQTLView")});that.viewBar.append("text").text("Eigengene eQTL");that.viewBar.append("span").attr("class","wgcnaControltooltip").attr("title",'View Circos plot of the module Eigengene eQTLs.<BR><BR>Have a question about this view click the <img src="'+contextRoot+
'web/images/icons/help.png"> above for a detailed description of each view.').style("margin-left","5px").append("img").attr("src","/web/images/icons/info.gif");that.viewBar.append("br");that.viewBar.append("input").attr("type","radio").attr("id","wgcnaGOViewRB").attr("name","wgcnaViewRB").attr("value","go").style("margin-left","7px").style("margin-right","3px").on("click",function(){that.viewType="go";that.createSingleWGCNAImage();ga&&ga("send","event","WGCNA","goView")});that.viewBar.append("text").text("Gene Ontology");
that.viewBar.append("span").attr("class","wgcnaControltooltip").attr("title",'TEMPORARILY DISABLED PLEASE CHECK BACK. View a summary of Gene Ontology terms assigned to transcripts in the selected module.<BR><BR>Have a question about this view click the <img src="'+contextRoot+'web/images/icons/help.png"> above for a detailed description of each view.').style("margin-left","5px").append("img").attr("src","/web/images/icons/info.gif");that.viewBar.append("br");that.viewBar.append("input").attr("type",
"radio").attr("id","wgcnaMirViewRB").attr("name","wgcnaViewRB").attr("value","mir").style("margin-left","7px").style("margin-right","3px").on("click",function(){that.viewType="mir";that.createSingleWGCNAImage();ga&&ga("send","event","WGCNA","mirView")});that.viewBar.append("text").text("miRNA Targets");that.viewBar.append("span").attr("class","wgcnaControltooltip").attr("title",'View a summary of miRNAs that target genes in this module.<BR><BR>Have a question about this view click the <img src="'+
contextRoot+'web/images/icons/help.png"> above for a detailed description of each view.').style("margin-left","5px").append("img").attr("src","/web/images/icons/info.gif");that.viewBar.append("br");that.viewBar.append("input").attr("type","radio").attr("id","wgcnaMetaViewRB").attr("name","wgcnaViewRB").attr("value","meta").style("margin-left","7px").style("margin-right","3px").on("click",function(){that.viewType="meta";that.createSingleWGCNAImage();ga&&ga("send","event","WGCNA","metaView")});that.viewBar.append("text").text("Meta Module (nearest neighbors)");
that.viewBar.append("span").attr("class","wgcnaControltooltip").attr("title",'View most closely correlated modules and browse those modules.<BR><BR>Have a question about this view click the <img src="'+contextRoot+'web/images/icons/help.png"> above for a detailed description of each view.').style("margin-left","5px").append("img").attr("src","/web/images/icons/info.gif");$("#HelpWGCNAView").on("click",function(a){var b=$(this).attr("id");$("#"+b+"Content").dialog("option","position",{my:"right top",
at:"left bottom",of:$(this)});$("#"+b+"Content").dialog("open").css({"font-size":12});a.stopPropagation()})};that.createDataControls=function(){that.dataBar=d3.select("#dataControl").append("span").attr("id","wgcnaDataControls").style("margin-left","10px").style("margin-right","5px").append("table").append("tr");var a=that.dataBar.append("td");a.append("text").text("Data Source:");var b=a.append("select").attr("id","wgcnaSourceSelect").on("change",function(){$("#singleWGCNASVG").hide();d3.select("#multiWGCNASVG").remove();
$("#circosModule").hide();$("#wgcnaModuleTable").hide();$("#wgcnaMirTable").hide();$("#wgcnaMirGeneTable").hide();$("#wgcnaGoTable").hide();$("#wgcnaEqtlTable").hide();that.selSource=$("#wgcnaSourceSelect").val();that.tissue=$("#wgcnaTissueSelect").val();"array"===that.selSource?("Whole Brain"===that.tissue?that.wDSID=3:"Heart"===that.tissue?that.wDSID=4:"Liver"===that.tissue&&(that.wDSID=5),d3.select("#wgcnaTissueSelect").append("option").attr("value","Heart").text("Heart")):"seq"===that.selSource&&
("Whole Brain"===that.tissue?that.wDSID=6:"Liver"===that.tissue?that.wDSID=7:(that.wDSID=6,d3.select("#wgcnaTissueSelect").select('option[value="Brain"]').attr("selected","selected")),d3.select("#wgcnaTissueSelect").select('option[value="Heart"]').remove());that.requestModuleList()});that.sources=["array"];that.dispSources=["Arrays"];"Rn"===organism&&"rn6"===genomeVer&&(that.sources=["seq","array"],that.dispSources=["RNA-Seq","Arrays"]);for(var c=0;c<that.sources.length;c++)b.append("option").attr("value",
that.sources[c]).text(that.dispSources[c]);a.append("br");a.append("text").text("Tissue:");b=a.append("select").attr("id","wgcnaTissueSelect").on("change",function(){$("#singleWGCNASVG").hide();d3.select("#multiWGCNASVG").remove();$("#circosModule").hide();$("#wgcnaModuleTable").hide();$("#wgcnaMirTable").hide();$("#wgcnaMirGeneTable").hide();$("#wgcnaGoTable").hide();$("#wgcnaEqtlTable").hide();that.selSource=$("#wgcnaSourceSelect").val();that.tissue=$("#wgcnaTissueSelect").val();"array"===that.selSource?
"Whole Brain"===that.tissue?that.wDSID=3:"Heart"===that.tissue?that.wDSID=4:"Liver"===that.tissue&&(that.wDSID=5):"seq"===that.selSource&&("Whole Brain"===that.tissue?that.wDSID=6:"Liver"===that.tissue&&(that.wDSID=7));that.requestModuleList()});that.tissues=["Brain"];that.dispTissues=["Whole Brain"];"Rn"===organism&&"rn6"===genomeVer&&(that.source&&"arrays"===that.source?(that.tissues=["Whole Brain","Heart","Liver"],that.dispTissues=["Whole Brain","Heart","Liver"]):(that.tissues=["Whole Brain","Liver"],
that.dispTissues=["Whole Brain","Liver"]));for(c=0;c<that.tissues.length;c++)b.append("option").attr("value",that.tissues[c]).text(that.dispTissues[c]);a=that.dataBar.append("td").append("div").attr("id","goCtls").attr("class","goCTL").style("display","none").style("margin-left","10px");a.append("text").text("GO Domain:");b=a.append("select").attr("id","goDomainSelect").on("change",function(){that.singleImage.goDomain=$("#goDomainSelect").val();that.singleImage.draw();ga&&ga("send","event","WGCNA_go",
"changeDomain")});b.append("option").attr("value","cc").text("Cellular Component");b.append("option").attr("value","bp").text("Biological Process");b.append("option").attr("selected","selected").attr("value","mf").text("Molecular Function");a.append("br");a.append("text").text("Number of Levels to Display:");a.append("input").attr("name","value").attr("id","goSpinner");$("#goSpinner").spinner({min:1,max:100,step:1,change:function(a,b){console.log("change");that.singleImage.displayDepth=b.value;that.singleImage.selectedNode!==
that.singleImage.data.GOList[0]&&that.singleImage.selectedNode!==that.singleImage.data.GOList[1]&&that.singleImage.selectedNode!==that.singleImage.data.GOList[2]?that.singleImage.redraw():that.singleImage.draw();ga&&ga("send","event","WGCNA_go","changeDepth")},spin:function(a,b){that.singleImage.displayDepth=b.value;that.singleImage.selectedNode!==that.singleImage.data.GOList[0]&&that.singleImage.selectedNode!==that.singleImage.data.GOList[1]&&that.singleImage.selectedNode!==that.singleImage.data.GOList[2]?
that.singleImage.redraw():that.singleImage.draw();ga&&ga("send","event","WGCNA_go","changeDepth")}}).val(3);a=that.dataBar.append("td").append("div").attr("id","mirCtls").attr("class","mirCTL").style("display","none").style("margin-left","10px");b=a.append("table").append("tr");a.append("text").style("font-weight","bold").text("Filter miRNAs:");a.append("br");a.append("input").attr("type","checkbox").style("margin-right","5px").attr("id","mirValidatedCBX").on("click",function(){$(this).is(":checked")?
that.singleImage.mirValid=1:that.singleImage.mirValid=0;that.singleImage.drawMiR();ga&&ga("send","event","WGCNA_mir","changeValidated")});a.append("text").text("only miRNAs with Validated Targets");a.append("br");a.append("text").style("margin-right","5px").text("# of targeted Genes: ");a.append("div").attr("id","minMirGeneSlider").style("display","inline-block").style("width","150px");a.append("span").attr("id","minMirGeneLabel").style("margin-left","5px").append("text").text("1");a.append("br");
a.append("text").style("margin-right","5px").text("miRNAs targeting gene: ");a.append("input").attr("type","text").attr("id","mirGeneFilterTxt").on("keyup",function(a){that.singleImage.mirTargetID=$(this).val().toLowerCase();that.singleImage.drawMiR();ga&&ga("send","event","WGCNA_mir","geneFilter")});a.append("br");a.append("text").style("margin-right","5px").text("miRNA(ID or Accession): ");a.append("input").attr("type","text").attr("id","mirIDFilterTxt").on("keyup",function(a){that.singleImage.mirID=
$(this).val().toLowerCase();that.singleImage.drawMiR();ga&&ga("send","event","WGCNA_mir","geneFilter")});a=that.dataBar.append("td").append("div").attr("id","mirCtls2").attr("class","mirCTL").style("display","none").style("margin-left","10px");a.append("text").style("font-weight","bold").text("Display Options:");a.append("br");a.append("input").attr("type","checkbox").attr("id","mirSortCBX").style("margin-right","5px").on("click",function(){$(this).prop("checked")?that.singleImage.sortMir=$("#mirSortSelect").val():
that.singleImage.sortMir=0;that.singleImage.drawMiR();ga&&ga("send","event","WGCNA_mir","mirSort")});a.append("text").text("Hovering over a node(miR or transcript):");a.append("br");a.append("input").attr("type","checkbox").attr("id","mirLinkCBX").attr("checked","checked").style("margin-left","12px").style("margin-right","3px").on("click",function(){$(this).prop("checked")?that.singleImage.showMirLinks=1:that.singleImage.showMirLinks=0;ga&&ga("send","event","WGCNA_mir","showLinks")});a.append("text").text("Display links between miRNAs and targeted transcripts");
a.append("br");a.append("input").attr("type","checkbox").attr("id","mirgeneLinkCBX").style("margin-left","12px").style("margin-right","3px").on("click",function(){$(this).prop("checked")?(that.singleImage.showLinks=0,$("div#mirLinkColorSelect").show()):(that.singleImage.showLinks=1,$("div#mirLinkColorSelect").hide());that.singleImage.setupLegend();ga&&ga("send","event","WGCNA_mir","linkColor")});a.append("text").text("Display links between correlated transcripts");b=a.append("div").attr("id","mirLinkColorSelect").style("display",
"none");b.append("text").style("margin-left","24px").text("Correlation Link Color Options:");a=b.append("select").attr("id","mirlinkColor").on("change",function(){that.singleImage.updateColor("mirlinkColor");that.singleImage.setupLegend();ga&&ga("send","event","WGCNA_mir","linkColor")});a.append("option").attr("selected","selected").attr("value","Green_Red").text("Green(+) / Red(-)");a.append("option").attr("value","Blue_Yellow").text("Blue(+) / Yellow(-)");a.append("option").attr("value","Red_Green").text("Red(+) / Green(-)");
b.append("br");b.append("input").attr("type","checkbox").style("margin-left","24px").style("margin-right","3px").on("click",function(){$(this).prop("checked")?that.singleImage.showAllFromTarget=1:that.singleImage.showAllFromTarget=0;ga&&ga("send","event","WGCNA_mir","linkColor")});b.append("text").text("Display all cor. transcript links from targeted transcripts.");$("#minMirGeneSlider").slider({min:1,max:100,step:1,value:1,slide:function(a,b){that.singleImage.mirGeneCutoff=b.value;$("span#minMirGeneLabel").html(b.value);
that.singleImage.drawMiR();ga&&ga("send","event","WGCNA_mir","minMir")}});a=that.dataBar.append("td").append("div").attr("id","linkCtls").attr("class","linkCTL").style("display","none").style("margin-left","10px");a.append("text").text("Link Correlation Values");a.append("span").style("cursor","pointer").on("click",function(){$("#linkSliderMin").slider("value",.75);that.singleImage.CorCutoff_min=.75;$("span#minLabel").html(.75);$("#linkSliderMax").slider("value",1);that.singleImage.CorCutoff_max=
1;$("span#maxLabel").html(1);that.singleImage.draw();ga&&ga("send","event","WGCNA_mir","resetCorrelation")}).append("img").attr("src",contextRoot+"/web/images/icons/reset_16.png");c=a.append("table");b=c.append("tr");b.append("td").append("text").text("Min:");b.append("td").append("div").attr("id","linkSliderMin").style("width","100px");b.append("td").append("span").attr("id","minLabel").style("margin-left","5px").append("text").text("0.75");b=c.append("tr");b.append("td").append("text").text("Max:");
b.append("td").append("div").attr("id","linkSliderMax").style("width","100px");b.append("td").append("span").attr("id","maxLabel").style("margin-left","5px").append("text").text("1");a.append("input").attr("type","checkbox").attr("id","hideLinkExceptNode").on("click",function(){that.singleImage.showLinks=!$(this).is(":checked");that.singleImage.draw();that.singleImage.panZoom=svgPanZoom("#singleWGCNASVG",{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,
minZoom:.1,maxZoom:4,fit:!0,center:!0})});a.append("text").text("Hide Links Except Selected Node");b=that.dataBar.append("td").append("div").attr("id","linkCtl2").attr("class","linkCTL").style("display","none").style("margin-left","10px");b.append("text").text("Correlation Link Color Options:");b.append("br");b=b.append("select").attr("id","linkColor").on("change",function(){that.singleImage.draw();that.singleImage.panZoom=svgPanZoom("#singleWGCNASVG",{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,
dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,minZoom:.1,maxZoom:4,fit:!0,center:!0})});b.append("option").attr("selected","selected").attr("value","Green_Red").text("Green(+) / Red(-)");b.append("option").attr("value","Blue_Yellow").text("Blue(+) / Yellow(-)");b.append("option").attr("value","Red_Green").text("Red(+) / Green(-)");$("#linkSliderMin").slider({min:.05,max:.95,step:.05,value:.75,slide:function(a,b){that.singleImage.CorCutoff_min=b.value;$("span#minLabel").html(b.value);that.singleImage.draw()}});
$("#linkSliderMax").slider({min:.1,max:1,step:.05,value:1,slide:function(a,b){that.singleImage.CorCutoff_max=b.value;$("span#maxLabel").html(b.value);that.singleImage.draw()}});a=that.dataBar.append("td").append("div").attr("class","eqtlCtls").attr("id","eqtlCtl").style("display","none").style("margin-left","10px");a.append("text").text("Select Chromosomes");a.append("br");b=a.append("select").attr("id","eqtlChr").attr("multiple","multiple").attr("size","4").style("width","100px");for(c=1;c<=that.chrLen;c++)b.append("option").attr("selected",
"selected").attr("value",organism.toLowerCase()+c).text("chr"+c);b.append("option").attr("selected","selected").attr("value",organism.toLowerCase()+"X").text("chrX");a=that.dataBar.append("td").append("div").attr("class","eqtlCtls").attr("id","eqtlCtl2").style("display","none").style("margin-left","10px");a.append("text").text("P-value cutoff:");b=a.append("select").attr("id","eqtlPval");b.append("option").attr("value","1").text("0.1");b.append("option").attr("selected","selected").attr("value","2").text("0.01");
b.append("option").attr("value","3").text("0.001");b.append("option").attr("value","4").text("0.0001");b.append("option").attr("value","5").text("0.00001");a.append("br");a.append("br");a.append("br");a.append("br");a.append("input").attr("type","button").attr("value","Apply Selections").on("click",function(){for(var a=$("#eqtlPval").val(),b=$("#eqtlChr").val(),c="",d=0;d<b.length;d++)c=c+b[d]+";";$.ajax({url:pathPrefix+"runCircosModule.jsp",type:"GET",async:!0,data:{cutoffValue:a,organism:organism,
module:that.selectedModule.MOD_NAME,modColor:that.selectedModule.ModRGB,chrList:c,genomeVer:genomeVer,tissue:that.tissue},dataType:"json",beforeSend:function(){$("#waitCircos").show()},success:function(a){$("#waitCircos").hide();that.singleImage.update(a.URL)},error:function(a,b,c){}})})};that.positionTTLeft=function(a){a+=20;a>$(window).width()/2&&(a-=250);return a+"px"};that.positionTTTop=function(a){a+="px";d3.event.clientY>.6*window.innerHeight&&(a=d3.event.pageY-2.2*$(".testToolTip").height()+
"px");return a};that.createMultiWGCNAImage=function(){that.multiImage=that.multiWGCNAImageGeneView(that.modules);that.multiImage.draw();that.img=that.multiImage};that.multiWGCNAImage=function(){var a={maxWidth:200};a.totalWidth=$(window).width();a.modPerLine=Math.floor($(window).width()/a.maxWidth);a.calcWidth=Math.floor($(window).width()/a.modPerLine);a.data=[];if(0===d3.select("#multiWGCNASVG").size()){var b=d3.select("#wgcnaGeneImage").append("div").attr("id","multiWGCNAScroll").style("overflow",
"auto").style("max-height","430px");a.svg=b.append("svg").attr("id","multiWGCNASVG").attr("height","430px").attr("width","100%");b=a.svg.append("linearGradient").attr("id","lgrad").attr("x1","11%").attr("y1","0%").attr("x2","89%").attr("y2","100%");b.append("stop").attr("offset","0%").attr("style","stop-color:rgb(153,218,255);stop-opacity:1");b.append("stop").attr("offset","100%").attr("style","stop-color:rgb(0,128,128);stop-opacity:1");b=a.svg.append("linearGradient").attr("id","selectGrad").attr("x1",
"11%").attr("y1","0%").attr("x2","89%").attr("y2","100%");b.append("stop").attr("offset","0%").attr("style","stop-color:rgb(0,163,55);stop-opacity:1");b.append("stop").attr("offset","100%").attr("style","stop-color:rgb(0,75,20);stop-opacity:1")}else a.svg=d3.select("#multiWGCNASVG");a.modKey=function(a){return a.MOD_NAME};a.calcX=function(b,c){return c%a.modPerLine*a.calcWidth};a.calcY=function(b,c){return Math.floor(c/a.modPerLine)*a.maxWidth};a.sizing=function(b){b=a.size(b.TCList.length);b>a.maxWidth/
2&&(b=a.maxWidth/2);return b};a.zoomIn=function(){a.maxWidth<$(window).width()/2&&(a.maxWidth*=2,a.draw())};a.zoomOut=function(){var b=a.maxWidth;a.maxWidth=Math.floor(a.maxWidth/2);25>a.maxWidth?a.maxWidth=b:a.draw()};a.sortTCLenDesc=function(a,b){return b.TCList.length<a.TCList.length?-1:b.TCList.length>a.TCList.length?1:0};a.sortGeneInstanceDesc=function(b,c){return c.GeneCount<b.GeneCount?-1:c.GeneCount>b.GeneCount?1:a.sortTCLenDesc(b,c)};a.draw=function(){};a.redraw=function(){};return a};that.multiWGCNAImageGeneView=
function(){var a=that.multiWGCNAImage();a.createToolTip=function(a){var b="Module Name: "+a.MOD_NAME+"<BR>Transcript Size: "+a.TCList.length;"undefined"!==typeof a.GroupedGenes?(b=b+"<BR>Genes in Region/List: "+a.GroupedGenes,b=b+"<BR>Transcripts in Region/List: "+a.GeneCount):b=b+"<BR>Selected Gene Transcripts in Module: "+a.GeneCount;return b};a.draw=function(){"undefined"!==typeof that.selectedModule&&(a.maxWidth=85);a.svg.selectAll(".modules").remove();a.svg.selectAll(".moduleGradient").remove();
a.totalWidth=$(window).width();a.modPerLine=Math.floor($(window).width()/a.maxWidth);a.calcWidth=Math.floor($(window).width()/a.modPerLine);var b=[];a.dataList={};for(var c=0,e=0;e<that.moduleList.length;e++)if(("grey"!==that.moduleList[e]||"grey"===that.moduleList[e]&&0===that.skipGrey)&&"undefined"!==typeof that.modules[that.moduleList[e]]){b[c]=that.modules[that.moduleList[e]];var f=b[c].ModRGB.split(","),h="";for(h=0;h<f.length;h++)f[h]-=70,0>f[h]&&(f[h]=0);h=f[0]+","+f[1]+","+f[2];f=a.svg.append("linearGradient").attr("id",
"grad"+b[c].MOD_NAME).attr("class","moduleGradient").attr("x1","11%").attr("y1","0%").attr("x2","89%").attr("y2","100%");f.append("stop").attr("offset","0%").attr("style","stop-color:rgb("+b[c].ModRGB+");stop-opacity:1");f.append("stop").attr("offset","100%").attr("style","stop-color:rgb("+h+");stop-opacity:1");c++}c=a.maxWidth+15;b.length>a.modPerLine&&(e=Math.floor(b.length/a.modPerLine),0<b.length%a.modPerLine&&e++,c*=e);a.svg.attr("height",c+"px");b.sort(a.sortGeneInstanceDesc);a.data=b;for(e=
0;e<b.length;e++)a.dataList[b[e].MOD_NAME]=e;c=d3.min(b,function(a){return a.TCList.length});e=d3.max(b,function(a){return a.TCList.length});a.size=d3.scaleLinear().domain([c,e]).range([10,a.maxWidth/2]);b=a.svg.selectAll(".modules").data(b,a.modKey).attr("transform",function(b,c){return"translate("+a.calcX(b,c)+","+a.calcY(b,c)+")"});b.enter().append("g").attr("class","modules").attr("id",function(a){return a.MOD_NAME}).attr("transform",function(b,c){return"translate("+a.calcX(b,c)+","+a.calcY(b,
c)+")"}).merge(b).each(function(b){var c=d3.select("g#"+b.MOD_NAME);c.append("circle").attr("cx",a.calcWidth/2).attr("cy",a.maxWidth/2).attr("r",a.sizing).attr("stroke",function(a){var b="#FFFFFF";"undefined"!==typeof that.selectedModule&&that.selectedModule===a&&(b="#000000");return b}).attr("stroke-width",function(a){var b="1px";"undefined"!==typeof that.selectedModule&&that.selectedModule===a&&(b="3px");return b}).attr("fill",function(a){var b="url(#grad"+a.MOD_NAME+")";"undefined"!==typeof that.selectedModule&&
that.selectedModule===a&&(b="url(#selectGrad)");return b}).on("click",function(){a.maxWidth=85;that.selectedModule=b;a.draw();d3.select("#multiWGCNAScroll").style("max-height","110px");a.svg.select("g#"+b.MOD_NAME).style("background","#CECECE");a.svg.select("g#"+b.MOD_NAME).select("circle").attr("fill","url(#selectGrad)").attr("stroke","#000000").attr("stroke-width","3px");a.svg.select("g#"+b.MOD_NAME).select("text.txtLbl").style("font-weight","bold");that.selectedGene={};for(var c=0;c<b.TCList.length;c++)"undefined"===
typeof that.selectedGene[b.TCList[c].Gene.ID]&&(that.selectedGene[b.TCList[c].Gene.ID]={},that.selectedGene[b.TCList[c].Gene.ID].geneSymbol=b.TCList[c].Gene.geneSymbol,that.selectedGene[b.TCList[c].Gene.ID].tcList=[]),that.selectedGene[b.TCList[c].Gene.ID].tcList.push(b.TCList[c]);setTimeout(that.createSingleWGCNAImage,20)}).on("mouseover",function(){$("#wgcnaMouseHelp").html("<B>Click</B> to select this module and see additional details.");d3.select(this).style("fill","url(#selectGrad)");tt.transition().duration(200).style("opacity",
1);tt.html(a.createToolTip(b)).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",function(){return that.positionTTTop(d3.event.pageY)})}).on("mouseout",function(){var a=d3.select(this).data()[0];"undefined"!==typeof that.selectedModule&&a.MOD_NAME===that.selectedModule.MOD_NAME||d3.select(this).style("fill","url(#grad"+a.MOD_NAME+")");tt.transition().duration(500).style("opacity",0)});"undefined"!==typeof that.selectedModule&&that.selectedModule===b?c.append("text").attr("class",
"txtLbl").attr("y",a.maxWidth+12).attr("x",function(b){return a.calcWidth/2-b.MOD_NAME.length/2*6.5}).style("font-weight","bold").text(replaceUnderscore(b.MOD_NAME)):6.5*b.MOD_NAME.length<a.calcWidth&&c.append("text").attr("class","txtLbl").attr("y",a.maxWidth+12).attr("x",function(b){return a.calcWidth/2-b.MOD_NAME.length/2*6.5}).text(replaceUnderscore(b.MOD_NAME));c.append("text").attr("y",a.maxWidth/2+5).attr("x",a.calcWidth/2-3).attr("pointer-events","none").attr("fill",function(a){var b="#000000";
a=a.ModRGB.split(",");360>a[0]+a[1]+a[2]&&(b="#FFFFFF");return b}).text(function(a){var b=a.GeneCount;"undefined"!==typeof a.GroupedGenes&&(b=a.GroupedGenes);return b})})};a.backModule=function(){if(that.selectedModule){var b=a.dataList[that.selectedModule.MOD_NAME];if(0<b){b=a.data[b-1];var c=a.svg.select("g#"+that.selectedModule.MOD_NAME);c.select("circle").attr("fill","url(#grad"+that.selectedModule.MOD_NAME+")").attr("stroke","#FFFFFF").attr("stroke-width","1px");c.select("text.txtLbl").style("font-weight",
"normal");that.selectedModule=b;b=a.svg.select("g#"+b.MOD_NAME);b.select("circle").attr("fill","url(#selectGrad)").attr("stroke","#000000").attr("stroke-width","3px");b.select("text.txtLbl").style("font-weight","bold");setTimeout(that.createSingleWGCNAImage,20)}}};a.forwardModule=function(){if(that.selectedModule){var b=a.dataList[that.selectedModule.MOD_NAME];if(b<a.data.length-1){b=a.data[b+1];var c=a.svg.select("g#"+that.selectedModule.MOD_NAME);c.select("circle").attr("fill","url(#grad"+that.selectedModule.MOD_NAME+
")").attr("stroke","#FFFFFF").attr("stroke-width","1px");c.select("text.txtLbl").style("font-weight","normal");that.selectedModule=b;b=a.svg.select("g#"+b.MOD_NAME);b.select("circle").attr("fill","url(#selectGrad)").attr("stroke","#000000").attr("stroke-width","3px");b.select("text.txtLbl").style("font-weight","bold");setTimeout(that.createSingleWGCNAImage,20)}}};return a};that.createSingleWGCNAImage=function(){d3.select("#viewGene").remove();d3.select("#circos").remove();$("#wgcnaresetImage").show();
$("#wgcnazoomInImage").show();$("#wgcnazoomOutImage").show();"gene"===that.viewType?($("#linkSliderMin").slider("value",.01),$("span#minLabel").html(.01),$("#linkSliderMax").slider("value",1),$("span#maxLabel").html(1),$("#hideLinkExceptNode").prop("checked",!1),setTimeout(function(){that.singleImage=that.singleWGCNAImageGeneView(that.modules);that.singleImage.draw();that.img=that.singleImage;that.singleWGCNATableGeneView();setTimeout(function(){that.singleImage.panZoom=svgPanZoom("#singleWGCNASVG",
{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,minZoom:.1,maxZoom:4,fit:!0,center:!0})},500)},50)):"go"===that.viewType?($("#wgcnaresetImage").hide(),$("#wgcnazoomInImage").hide(),$("#wgcnazoomOutImage").hide(),$("#goDomainSelect").val("mf"),$("#goSpinner").val(3),setTimeout(function(){that.singleImage=that.singleWGCNAImageGoView(that.modules);that.singleImage.goDomain=$("#goDomainSelect").val();that.singleImage.draw();that.img=that.singleImage},
50)):"eqtl"===that.viewType?($("#eqtlChr option").prop("selected",!0),$("#eqtlPval").val(2),setTimeout(function(){that.singleImage=that.singleWGCNAImageEQTLView(that.modules);that.singleImage.displayDefault();that.img=that.singleImage},50)):"mir"===that.viewType?($("#mirValidatedCBX").prop("checked",!1),$("#minMirGeneSlider").slider("value",1),$("span#minMirGeneLabel").html(1),$("#mirGeneFilterTxt").val(""),$("#mirIDFilterTxt").val(""),$("#mirSortCBX").prop("checked",!1),$("#mirLinkCBX").prop("checked",
!0),$("#mirgeneLinkCBX").prop("checked",!1),$("div#mirLinkColorSelect").hide(),setTimeout(function(){that.singleImage=that.singleWGCNAImageGeneView(that.modules);that.singleImage.draw();that.img=that.singleImage;setTimeout(function(){that.singleImage.panZoom=svgPanZoom("#singleWGCNASVG",{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,minZoom:.1,maxZoom:4,fit:!0,center:!0})},500)},50)):"meta"===that.viewType&&setTimeout(function(){that.singleImage=
that.singleWGCNAImageMetaView(that.modules);that.singleImage.requestMeta();that.img=that.singleImage;setTimeout(function(){that.singleImage.panZoom=svgPanZoom("#singleWGCNASVG",{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,minZoom:.1,maxZoom:4,fit:!0,center:!0})},500)},50);ga&&ga("send","event","changedWGCNAView",that.viewType)};that.singleWGCNAImage=function(){var a={};a.width=$(window).width();a.height=Math.floor(.9*window.innerHeight);a.r=a.height>
a.width?Math.floor(a.width/2*.95):Math.floor(a.height/2*.95);a.maxPerLevel=150;a.CorCutoff_min=.75;a.CorCutoff_max=1;a.showLinks=!0;a.data=[];a.maxNodeR=28;a.negColor="#DD0000";a.negDarkColor="#770000";a.posColor="#00DD00";a.posDarkColor="#007700";a.mirVal="#FFFF00";a.mirPred="#0000CC";0===d3.select("#singleWGCNASVG").size()?a.svg=d3.select("#wgcnaGeneImage").append("div").attr("id","viewGene").append("svg").attr("id","singleWGCNASVG").attr("height",a.height+"px").attr("width","100%"):a.svg=d3.select("#singleWGCNASVG");
a.geneKey=function(a){return a.ID};a.linkKey=function(a){return that.removeInvalidIDChars(a.TC1)+that.removeInvalidIDChars(a.TC2)};a.calcX=function(b,c){return c%a.modPerLine*a.calcWidth};a.calcY=function(b,c){return Math.floor(c/a.modPerLine)*a.maxWidth};a.sizing=function(b){b=a.size(b.TCList.length);b>a.maxWidth/2&&(b=a.maxWidth/2);return b};a.colorCircle=function(a){a=a.Gene.ID;var b="#DFC184";if(0==a.indexOf("PRN")||0==a.indexOf("PMM")||0==a.indexOf("Unannotated"))"Whole Brain"===that.tissue?
b="#7EB5D6":"Heart"===that.tissue?b="#DC7252":"Liver"===that.tissue&&(b="#bbbedd");return b};a.colorLink=function(b){var c=a.negColor;0<b.Cor&&(c=a.posColor);return c};a.colorLinkHighlight=function(b){var c=a.negDarkColor;0<b.Cor&&(c=a.posDarkColor);return c};a.updateColor=function(b){b=$("#"+b).val();"Red_Green"===b?(a.posColor="#DD0000",a.posDarkColor="#770000",a.negColor="#00DD00",a.negDarkColor="#007700",a.mirVal="#FFFF00",a.mirPred="#0000CC"):"Blue_Yellow"===b?(a.posColor="#0000DD",a.posDarkColor=
"#000077",a.negColor="#ffef16",a.negDarkColor="#b7ae2a",a.mirVal="#FF9C2A",a.mirPred="#BA49FF"):(a.negColor="#DD0000",a.negDarkColor="#770000",a.posColor="#00DD00",a.posDarkColor="#007700",a.mirVal="#FFFF00",a.mirPred="#0000CC")};a.nodeRadiusSum=function(b,c){var d=3+20*b.LinkSum;d>a.maxNodeR&&(d=a.maxNodeR);return d};a.zoomIn=function(){a.maxWidth<$(window).width()/2&&(a.maxWidth*=2,a.draw())};a.zoomOut=function(){var b=a.maxWidth;a.maxWidth=Math.floor(a.maxWidth/2);25>a.maxWidth?a.maxWidth=b:a.draw()};
a.draw=function(){};a.redraw=function(){};a.setupLegend=function(){a.svg.select("#legend").remove();a.svg.select("#legendDisp").remove();a.legendG=a.svg.append("g").attr("id","legend").attr("transform","translate(10,60)").style("cursor","pointer").on("mouseover",function(){a.legendDispG.transition().duration(300).style("opacity",1);ga&&ga("send","event","wgcna","viewLegend")}).on("mouseleave",function(){a.legendDispG.transition().duration(300).style("opacity",0)});a.legendG.append("image").attr("x",
0).attr("y",-20).attr("width","24px").attr("height","24px").attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAJI0lEQVRIDQEYCef2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABVVVVAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAq6ur/wAAAP4AAAAAAQAAAAAAAAAAAAAAAFtynWv/AgFSAP//BAEBAgAAAP8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/95/Plx4sH/fPbq6ur8QQAAAAAAAAAAEBAQAT/AgOLAQEACQABAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAgAJDRgG/O7xiAAAAMkEAAAAAAAAAADz8/MB/vv1pgMEBVb///4JAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//Pb+/fLiJgAAAB8AAADJBAAAAAAAAAAADQ0N//nivJACAgLfAQEBOwEBARH///8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/gAAAOoAAADxAAAAAAQAAAAAAAAAAMDAwPxAQEDkEhISuv///9wCAgIN////AQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////4AAADxAAAA2AAAAAAEAAAAAAAAAAAAAAAAFS1XJgQDAk4B//wK/gD9BQIAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//fro+OXExvj4+O8AAAAABAAAAAAAAAAAAFVVAwUHCLcBAQESAAAHAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8A/wYTKxsC79eVAAAA1QIAAAAAAAAAADPe3gIA//3Z///+/AD//v7//v7///7+///+/v///v7///7+///+/v///v7///7+///+/v///v7///7+///+/v///v7///7+/wH++v/+9+k6////JgAAAAAEAAAAAAAAAAANDQ3/9+LCcwMIDGEB/vs1AAD/DgIBAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD+/fn9//v18wAAAAAAAAAABAAAAAAAAAAAwMDA/UZGRt0N/g2q/wAA0gEBAQ39AAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////gAAAPD////YAAAAAAQAAAAAAAAAAAAAAP8LIkUAAwT9AwD8+uoCAP/x////AQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP779vD+8d3a/f395QAAAAAEAAAAAAAAAAAAAAABCQwVtQEBADQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/4+gABewTw260AAADzAgAAAAAAAAAAM2ZmBAEA/xsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8BBwD++FYBAQErAAAAAAQAAAAAAAAAAADNzQD5MRBsAwIIagD++igAAP4K////AQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAH7+PwA9+gIAAAADAAAAAAEAAAAAAAAAADNzc39FxcXzQYGBqACAgIwAgICDv///wIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAf/////+AAAA7gICAuAAAAAABAAAAAAAAAAAAAAA/uHh4ecfHx+8AwMDzAYGBgb+/v4BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/f39/wMDA/j29vboAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAA/gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAApkUqF3zKmm8AAAAASUVORK5CYII=");
a.legendG.append("text").attr("x","25").style("font-size","18").text("Legend");a.legendDispG=a.svg.append("g").attr("id","legendDisp").attr("transform","translate(10,70)").style("opacity",1);a.drawLegend();setTimeout(function(){a.legendDispG.transition().duration(750).style("opacity",0)},8E3)};a.drawLegend=function(){};a.createToolTip=function(a){var b="Gene: "+a.Gene.geneSymbol+" ("+a.Gene.ID+")<BR><BR>Transcript:"+a.ID+"<BR>";b=b+"<BR>Link Count:"+a.LinkCount;b=b+"<BR>Link Sum:"+a.LinkSum.toFixed(2);
var c=that.selectedGene[a.Gene.ID].tcList;if(1<c.length){"<BR><BR>Additional Transcripts in this Module:<BR>";c=that.selectedGene[a.Gene.ID].tcList;for(var e=0;e<c.length;e++)c[e].ID!==a.ID&&(b=b+c[e].ID+"<BR>")}a.PSList&&"array"===that.selSource&&(b=b+"<BR><BR>"+a.PSList.length+" Probe Sets in Transcript<BR>");return b};return a};that.singleWGCNAImageGeneView=function(){var a=that.singleWGCNAImage();$(".goCTL").hide();$(".eqtlCtls").hide();if("gene"===that.viewType)$(".linkCTL").show(),$(".mirCTL").hide(),
a.showMirLinks=0;else{$(".mirCTL").show();$(".linkCTL").hide();a.showLinks=1;a.geneList={};a.geneMirList={};for(var b=that.selectedModule.TCList,c=0;c<b.length;c++)a.geneList[that.selectedModule.TCList[c].Gene.ID]=that.selectedModule.TCList[c].Gene.geneSymbol;a.showMirLinks=1;a.showAllFromTarget=0}a.CorCutoff_min=.75;a.CorCutoff_max=1;a.type=that.viewType;a.truncated=0;a.filterOneDB=1;a.mirGeneCutoff=1;a.mirValid=0;a.mirTargetID="";a.mirID="";a.miRcolor=d3.scaleOrdinal(d3.schemeCategory20b);a.sortMir=
0;a.maxCorWidth=5;a.drawLinks=function(b){"gene"===that.viewType?a.updateColor("linkColor"):"mir"===that.viewType&&a.updateColor("mirlinkColor");a.svg.selectAll(".link").remove();for(var c=that.selectedModule.LinkList,d=[],e=0,f=0;f<c.length;f++)(c[f].TC1===b.ID||c[f].TC2===b.ID)&&a.CorCutoff_min<=Math.abs(c[f].Cor)&&Math.abs(c[f].Cor)<=a.CorCutoff_max&&(d[e]=c[f],e++);c=d;1E4>c.length&&(b=a.topG.selectAll(".link").data(c,a.linkKey),b.enter().append("line").attr("class","link").attr("pointer-events",
"none").attr("id",function(a){return"ln_"+that.removeInvalidIDChars(a.TC1)+that.removeInvalidIDChars(a.TC2)}).attr("x1",function(a){return d3.select("#tc_"+that.removeInvalidIDChars(a.TC1)).attr("cx")}).attr("y1",function(a){return d3.select("#tc_"+that.removeInvalidIDChars(a.TC1)).attr("cy")}).attr("x2",function(a){return d3.select("#tc_"+that.removeInvalidIDChars(a.TC2)).attr("cx")}).attr("y2",function(a){return d3.select("#tc_"+that.removeInvalidIDChars(a.TC2)).attr("cy")}).attr("stroke",a.colorLink).attr("stroke-width",
function(b){return Math.abs(b.Cor)*a.maxCorWidth}).merge(b))};a.drawLinksBetween=function(b){for(var c={},d=0;d<b.length;d++)c[b[d]]=1;"gene"===that.viewType?a.updateColor("linkColor"):"mir"===that.viewType&&a.updateColor("mirlinkColor");a.svg.selectAll(".link").remove();b=that.selectedModule.LinkList;d=[];for(var e=0,f=0;f<b.length;f++)(0===a.showAllFromTarget&&"undefined"!==typeof c[b[f].TC1]&&"undefined"!==typeof c[b[f].TC2]||1===a.showAllFromTarget&&("undefined"!==typeof c[b[f].TC1]||"undefined"!==
typeof c[b[f].TC2]))&&a.CorCutoff_min<=Math.abs(b[f].Cor)&&Math.abs(b[f].Cor)<=a.CorCutoff_max&&(d[e]=b[f],e++);b=d;1E4>b.length&&(c=a.svg.select("g.svg-pan-zoom_viewport").selectAll(".link").data(b,a.linkKey),c.enter().append("line").attr("class","link").attr("pointer-events","none").attr("id",function(a){return"ln_"+that.removeInvalidIDChars(a.TC1)+that.removeInvalidIDChars(a.TC2)}).attr("x1",function(a){return d3.select("#tc_"+that.removeInvalidIDChars(a.TC1)).attr("cx")}).attr("y1",function(a){return d3.select("#tc_"+
that.removeInvalidIDChars(a.TC1)).attr("cy")}).attr("x2",function(a){return d3.select("#tc_"+that.removeInvalidIDChars(a.TC2)).attr("cx")}).attr("y2",function(a){return d3.select("#tc_"+that.removeInvalidIDChars(a.TC2)).attr("cy")}).attr("stroke",a.colorLink).attr("stroke-width",function(b){return Math.abs(b.Cor)*a.maxCorWidth}).merge(c))};a.nodeX=function(b,c){var d=50,e=Math.floor(c/a.maxPerLevel)+1;1<e&&(d=60*e);return a.width/2+(a.r-d)*Math.cos(c%a.maxPerLevel*a.angle-1.57079633)};a.nodeY=function(b,
c){var d=50;c>a.maxPerLevel&&(d=60*(Math.floor(c/a.maxPerLevel)+1));return a.height/2+(a.r-d)*Math.sin(c%a.maxPerLevel*a.angle-1.57079633)};a.nodeXLbl=function(b,c){var d=c%a.maxPerLevel*a.angle-1.57079633,e=1;if(Math.PI/2<d&&d<1.5*Math.PI){var f=0;"undefined"!==typeof b.Gene.geneSymbol&&(f=b.Gene.geneSymbol.length);e+=7.5*f}return a.width/2+(a.r+e)*Math.cos(d)};a.nodeYLbl=function(b,c){var d=c%a.maxPerLevel*a.angle-1.57079633,e=1;if(Math.PI/2<d&&d<1.5*Math.PI){var f=0;"undefined"!==typeof b.Gene.geneSymbol&&
(f=b.Gene.geneSymbol.length);e+=7.5*f}return a.height/2+(a.r+e)*Math.sin(d)};a.drawCorLegend=function(b){a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",b).text("Positive Correlation");a.legendDispG.append("rect").attr("x","0").attr("y",b-10).attr("width","30").attr("height","10").style("fill",a.posColor);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",b+20).text("Negative Correlation");a.legendDispG.append("rect").attr("x","0").attr("y",b+
10).attr("width","30").attr("height","10").style("fill",a.negColor);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",b+40).text("Lower Correlation");a.legendDispG.append("line").attr("x1","0").attr("y1",b+30).attr("x2","30").attr("y2",b+30).style("stroke","#000000").style("stroke-width","0");a.legendDispG.append("line").attr("x1","0").attr("y1",b+35).attr("x2","30").attr("y2",b+35).style("stroke","#000000").style("stroke-width","0.5");a.legendDispG.append("line").attr("x1",
"0").attr("y1",b+40).attr("x2","30").attr("y2",b+40).style("stroke","#000000").style("stroke-width","1");a.legendDispG.append("line").attr("x1","0").attr("y1",b+45).attr("x2","30").attr("y2",b+45).style("stroke","#000000").style("stroke-width","2");a.legendDispG.append("line").attr("x1","0").attr("y1",b+55).attr("x2","30").attr("y2",b+55).style("stroke","#000000").style("stroke-width","3");a.legendDispG.append("line").attr("x1","0").attr("y1",b+65).attr("x2","30").attr("y2",b+65).style("stroke","#000000").style("stroke-width",
"5");a.legendDispG.append("line").attr("x1","0").attr("y1",b+75).attr("x2","30").attr("y2",b+75).style("stroke","#000000").style("stroke-width","7");a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",b+80).text("Higher Correlation")};a.drawMirSupportLegend=function(b){a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",b).text("Validated miRNA Target");a.legendDispG.append("rect").attr("x","0").attr("y",b-10).attr("width","30").attr("height","10").style("fill",
a.mirVal);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",b+20).text("Predicted miRNA Target");a.legendDispG.append("rect").attr("x","0").attr("y",b+10).attr("width","30").attr("height","10").style("fill",a.mirPred);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",b+40).text("Lower support of targeting");a.legendDispG.append("line").attr("x1","0").attr("y1",b+30).attr("x2","30").attr("y2",b+30).style("stroke","#000000").style("stroke-width",
"0");a.legendDispG.append("line").attr("x1","0").attr("y1",b+35).attr("x2","30").attr("y2",b+35).style("stroke","#000000").style("stroke-width","0.5");a.legendDispG.append("line").attr("x1","0").attr("y1",b+40).attr("x2","30").attr("y2",b+40).style("stroke","#000000").style("stroke-width","1");a.legendDispG.append("line").attr("x1","0").attr("y1",b+45).attr("x2","30").attr("y2",b+45).style("stroke","#000000").style("stroke-width","2");a.legendDispG.append("line").attr("x1","0").attr("y1",b+55).attr("x2",
"30").attr("y2",b+55).style("stroke","#000000").style("stroke-width","3");a.legendDispG.append("line").attr("x1","0").attr("y1",b+65).attr("x2","30").attr("y2",b+65).style("stroke","#000000").style("stroke-width","5");a.legendDispG.append("line").attr("x1","0").attr("y1",b+75).attr("x2","30").attr("y2",b+75).style("stroke","#000000").style("stroke-width","7");a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",b+80).text("Higher support of targeting")};a.drawLegend=function(){"gene"===
that.viewType?a.drawCorLegend(20):(a.drawMirSupportLegend(20),a.showLinks||a.drawCorLegend(130))};a.draw=function(){"mir"===that.viewType?(a.requestMiR(),a.updateColor("mirlinkColor")):"gene"===that.viewType&&a.updateColor("linkColor");a.width=$(window).width();a.height=Math.floor(.9*window.innerHeight);a.r=a.height>a.width?Math.floor(a.width/2*.95):Math.floor(a.height/2*.95);a.svg.attr("height",a.height+"px");a.svg.selectAll("circle").remove();a.svg.selectAll("text").remove();a.svg.selectAll("line").remove();
a.svg.selectAll(".geneTC").remove();"undefined"!==typeof a.panZoom&&(a.panZoom.destroy(),delete a.panZoom);a.svg.selectAll(".svg-pan-zoom_viewport").remove();setTimeout(function(){a.svg.append("text").style("font-size","20").attr("y",22).attr("x",5).text(function(){return that.selectedModule?replaceUnderscore(that.selectedModule.MOD_NAME):""});a.setupLegend();a.data=that.selectedModule.TCList;a.angle=2*Math.PI/a.data.length;a.angleDeg=360/a.data.length;a.data.length>a.maxPerLevel&&(a.angle=2*Math.PI/
a.maxPerLevel,a.angleDeg=360/a.maxPerLevel);a.data.sort(function(a,b){return a.LinkSum===b.LinkSum?0:a.LinkSum>b.LinkSum?-1:1});if(150<a.data.length){a.truncated=1;a.maxNodeR=15;for(var b=[],c=0;150>c;c++)b[c]=a.data[c];a.data=b;a.dataIndex={};for(c=0;c<a.data.length;c++)a.dataIndex[a.data[c].ID]=1;a.CorCutoff_min=.85;$("#linkSliderMin").slider("value",.85);$("span#minLabel").html(.85);a.svg.append("image").attr("x",7.8*that.selectedModule.MOD_NAME.length+20).attr("y",1).attr("width","24px").attr("height",
"24px").attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAJI0lEQVRIDQEYCef2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAAH/gAACcAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAADwAAALkCAABoFDEx0gIzM+/b29v4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGIAAAAvAgAAHDnn54QGBgY3SUlJBwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8AAB0AAAChAAAADAAAAAAU9vYY4RER/ecNDdLZ2dnvAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB5AAAAFgAAAAAAAAAABv7+BFHZ2UgFAgI4Ozs7DAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAtAAAAmAAAAAQAAAAAAAAAAAAAAAAU9/cM7AoKAOYYGNTZ2dnqAAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAFAAAAnQAAACf8AgIAzhgY/uIODv4V9vYBBP//AR3z8xrKHBzjDhwc2uDg4PYAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASwAAAEUAAAAB+AMDAJwyMveSODjT9QUF+AAAAAAY9PQOTN3dTxISEipAQEAEAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAADAAAAIAAAAAEAAAAAAAAAAAC/v7vAv7+tQn7+/IAAAAAAAAAAT/g4DQd8/NHCgoKFAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGcAAAAuAAAAAAAAAAAAAAAAAAEB+gP//+QF///7AAAAAAAAAAAQ+voIVtfXUggICDM5OTkJAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAP8AABYAAAB4AAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAATXm5iYt6+tMExMTHAAAAAEAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB7AAAAEwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAF/v4CVdfXSw0EBDdAQEALAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAD/AAAzAAAAkwAAAAYAAAAAAAAAAAAAAAAAAQEAAAAA/kDh4QAb8/MpAgAACAAAAAAAAAAAAAAAABT29g7vCAgB4RYW1NnZ2eoAAAD/AAAAAAAAAAAAAAAAAAAAAAD/AAAE/wAAtf8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD/5Q0N7WNKSnFHR0cSAAAAAAAAAAADAAAAAAAAAAAAAAAAgAAATAAAAHkAAAADAAAAAAAAAAAAAAAAAAAAAPgEBP+XMzP7xR8f7ivq6gcH/f0CAAAAAAAAAAAAAAAAAAAAAAz6+gj9AgIM2Bsb0QoKCujn5+f+AgAAAAAAAAAA/wAABwAAAIkAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAD9AQEA1hUV9MwZGccAAAD2AAAAAAAAAAAAAAAAAAAAAAAAAAABAAABR97eNhb390ceHh4RAAAAAAAAAAAAAAAAAP8AAG//AAD+/wAA//8AAP//AAD//wAA//8AAP//AAD//gAA/u4ICPvzBQXw/gAA/P8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP/CHR3SVVBQNgAAAAACAAAAAP8AAAgAAABfAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAER+PgEDPv7DwEAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMOnpJyHy8icAAAAABAAAAAABAAD42BMTgdUTE2buCwsz/QICCQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8BAAD/AAEBAf8AAAEAAAAAAAAAAAAAAAAAAAAAAAAAAPEHB/vhEBANAAAAAAQAAAAAAAAAAHU6OrsDAwPnAgICIQEBAQUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQH//f39zgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAs0IPw6I24JoAAAAASUVORK5CYII=").attr("pointer-events",
"all").style("cursor","pointer").on("mouseover",function(){$("#wgcnaMouseHelp").html("Warning: Transcripts displayed are truncated to the top 150 most connected transcripts due to the size of the module.")}).on("mouseout",function(){$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")})}else a.maxNodeR=28;a.topG=a.svg.append("g").attr("class","svg-pan-zoom_viewport");if("gene"===that.viewType){b=a.topG.selectAll(".geneTC").data(a.data,a.geneKey);
b.enter().append("circle").attr("class","geneTC").attr("id",function(a){return"tc_"+that.removeInvalidIDChars(a.ID)}).attr("cx",a.nodeX).attr("cy",a.nodeY).attr("r",3).attr("stroke","#000000").attr("fill","#FF0000").merge(b);b=that.selectedModule.LinkList;c=[];for(var d=0,e=0;e<b.length;e++)a.CorCutoff_min<=Math.abs(b[e].Cor)&&Math.abs(b[e].Cor)<=a.CorCutoff_max&&(0===a.truncated||"undefined"!==typeof a.dataIndex[b[e].TC1]&&"undefined"!==typeof a.dataIndex[b[e].TC2])&&(c[d]=b[e],d++);b=c;a.showLinks&&
1E4>b.length&&a.topG.selectAll(".link").data(b,a.linkKey).enter().append("line").attr("class","link").attr("id",function(a){return"ln_"+that.removeInvalidIDChars(a.TC1)+that.removeInvalidIDChars(a.TC2)}).attr("x1",function(a){return d3.select("#tc_"+that.removeInvalidIDChars(a.TC1)).attr("cx")}).attr("y1",function(a){return d3.select("#tc_"+that.removeInvalidIDChars(a.TC1)).attr("cy")}).attr("x2",function(a){return d3.select("#tc_"+that.removeInvalidIDChars(a.TC2)).attr("cx")}).attr("y2",function(a){return d3.select("#tc_"+
that.removeInvalidIDChars(a.TC2)).attr("cy")}).attr("stroke",a.colorLink).attr("stroke-width",function(b){return Math.abs(b.Cor)*a.maxCorWidth})}a.topG.selectAll(".geneTC").remove();b=a.topG.selectAll(".geneTC").data(a.data,a.geneKey);b.enter().append("g").append("circle").attr("cx",a.nodeX).attr("cy",a.nodeY).attr("r",a.nodeRadiusSum).attr("stroke","#000000").attr("fill",a.colorCircle).attr("class",function(a){return"geneTC "+a.Gene.ID}).attr("id",function(a){return"tc_"+that.removeInvalidIDChars(a.ID)}).on("click",
function(){}).on("mouseover",a.mouseoverGene).on("mouseout",a.mouseleaveGene).merge(b).each(function(b,c){d3.select(this.parentNode).append("g").attr("class","label").attr("id",function(a){return"txt_"+that.removeInvalidIDChars(a.ID)}).attr("transform",function(){var d=a.nodeXLbl(b,c),e=a.nodeYLbl(b,c);return"translate("+d+","+e+")"}).append("text").attr("transform",function(){var b=-90+c%a.maxPerLevel*a.angleDeg;90<b&&(b-=180);return"rotate("+b+")"}).text(function(){return b.Gene.geneSymbol})});
b.exit().remove();"mir"===that.viewType&&a.drawMiR()},250)};a.requestMiR=function(){$.ajax({url:contextRoot+"tmpData/browserCache/"+genomeVer+"/modules/ds"+that.wDSID+"/"+replaceUnderscore(that.selectedModule.MOD_NAME)+".miR.json",type:"GET",async:!0,data:{},dataType:"json",success:function(b){setTimeout(function(){a.mirData=b;a.geneMirList={};for(var c=0;c<a.mirData.MIRList.length;c++)for(var d=a.mirData.MIRList[c],e=d.GeneList,f=0;f<e.length;f++)if("undefined"===typeof a.geneMirList[e[f].ID])a.geneMirList[e[f].ID]=
[],a.geneMirList[e[f].ID].push(d);else{for(var g=0,p=0;p<a.geneMirList[e[f].ID].length&&0===g;p++)d.ID===a.geneMirList[e[f].ID][p].ID&&(g=1);0===g&&a.geneMirList[e[f].ID].push(d)}a.drawMiR();that.singleWGCNATableMirView()},50)},error:function(b,c,d){setTimeout(function(){a.requestMiR()},2E3)}})};a.drawMiR=function(){if("undefined"!==typeof a.topG&&"undefined"!==typeof a.mirData){a.svg.select("#mirG").remove();a.miRdiameter=1.5*a.r;a.miRformat=d3.format(",d");a.miRbubble=d3.pack().size([a.miRdiameter,
a.miRdiameter]).padding(1.5);var b=a.runMirFilter(a.mirData.MIRList);a.hierarch=d3.hierarchy({children:b}).sum(function(a){return a.filterGLSize});a.mirNode=a.miRbubble(a.hierarch.sort());b=a.topG.append("g").attr("id","mirG").attr("transform",function(){return"translate("+(a.width/2-a.miRdiameter/2)+","+(a.height/2-a.miRdiameter/2)+")"}).selectAll(".node").data(a.hierarch.leaves(),that.mirKey);b.enter().append("g").attr("class","node").attr("id",function(a){return that.removeInvalidIDChars(a.ID)}).attr("transform",
function(a){return"translate("+a.x+","+a.y+")"}).merge(b).on("mouseover",a.mouseoverMir).on("mouseleave",a.mouseleaveMir);b.exit().remove();d3.selectAll(".node").each(function(b){var c=b.data;if(0<b.depth){d3.select(this).append("circle").attr("r",function(a){return a.r}).style("fill",function(b){return a.miRcolor(c.ID)});var d=c.ID.substring(8);d.length<b.r/3&&d3.select(this).append("text").attr("dy",".2em").attr("pointer-events","none").style("text-anchor","middle").style("cursor","pointer").append("tspan").attr("x",
0).attr("dy","-0.5em").text("miR").append("tspan").attr("x",0).attr("dy","1em").text(d)}})}};a.sortMirFunction=function(b,c){return 0<a.sortMir?b.value-c.value:0>a.sortMir?c.value-b.value:0};a.runMirFilter=function(b){var c=b;if(1===a.filterOneDB||1<a.mirGeneCutoff||1===a.mirValid||0<a.mirID.length||0<a.mirTargetID.length){var d=0;c=[];for(var e=0;e<b.length;e++)a.filterMiR(b[e])&&(c[d]=b[e],d++)}return c};a.filterMiR=function(b){val=!0;b.GeneList.length<a.mirGeneCutoff&&(val=!1);val&&1===a.mirValid&&
0===b.vC&&(val=!1);val&&0<a.mirID.length&&(-1<b.ID.toLowerCase().indexOf(a.mirID)||-1<b.ACC.toLowerCase().indexOf(a.mirID)||(val=!1));if(val&&0<a.mirTargetID.length){for(var c=!1,d=0;d<b.GeneList.length&&!c;d++)if(1===a.filterOneDB)(1<b.GeneList[d].P||0<b.GeneList[d].V)&&(-1<b.GeneList[d].ID.toLowerCase().indexOf(a.mirTargetID)||-1<a.geneList[b.GeneList[d].ID].toLowerCase().indexOf(a.mirTargetID))&&(c=!0);else if(-1<b.GeneList[d].ID.toLowerCase().indexOf(a.mirTargetID)||-1<a.geneList[b.GeneList[d].ID].toLowerCase().indexOf(a.mirTargetID))c=
!0;c||(val=!1)}if(val&&1===a.filterOneDB&&"undefined"===typeof b.filterGLSize){for(d=c=0;d<b.GeneList.length;d++)(1<b.GeneList[d].P||0<b.GeneList[d].V)&&c++;b.filterGLSize=c;0===b.filterGLSize&&0===b.vC&&(val=!1)}else val&&1===a.filterOneDB&&0===b.filterGLSize&&0===b.vC&&(val=!1);return val};a.filterRevMiR=function(b){var c=[];if("undefined"!==typeof b)if(1===a.filterOneDB)for(var d=0;d<b.length;d++)(0<b[d].filterGLSize||0<b[d].vC)&&c.push(b[d]);else c=b;return c};a.filterMiRGenes=function(b){var c=
[];if(1===a.filterOneDB)for(var d=0;d<b.length;d++)(1<b[d].P||0<b[d].V)&&c.push(b[d]);else c=b;return c};a.createMirToolTip=function(a){return'<div id="ttSVG"></div>ID: '+a.ID+"<BR>Accession: "+a.ACC+"<BR><BR>Genes Targeted within Module: "+a.filterGLSize+"<BR>"};a.mouseoverMir=function(){var b=d3.select(this).data()[0],c=b.data,d=c.GeneList;d=a.filterMiRGenes(d);d3.select(this).style("opacity","0.3");tt.transition().duration(200).style("opacity",1);tt.html(a.createMirToolTip(c)).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",
function(){return that.positionTTTop(d3.event.pageY)});c=a.svg.select("g.svg-pan-zoom_viewport").selectAll(".mirlink").data(d,that.mirKey);c.enter().append("line").attr("class","mirlink").attr("pointer-events","none").attr("id",function(a){return"ln_"+a.ID}).attr("x1",function(c){return b.x+a.width/2-a.miRdiameter/2}).attr("y1",function(c){return b.y+a.height/2-a.miRdiameter/2}).attr("x2",function(c){var d=b.x+a.width/2-a.miRdiameter/2;0<d3.select("."+c.ID).size()&&(d=d3.select("."+c.ID).attr("cx"));
return d}).attr("y2",function(c){var d=b.y+a.height/2-a.miRdiameter/2;0<d3.select("."+c.ID).size()&&(d=d3.select("."+c.ID).attr("cy"));return d}).attr("stroke",function(b){var c=a.mirPred;0<b.V&&(c=a.mirVal);return c}).attr("stroke-width",function(a){return a.P+3*a.V}).merge(c);if(!a.showLinks){c=[];for(var e=0;e<d.length;e++)for(var f=d3.selectAll("."+d[e].ID).nodes(),g=0;g<f.length;g++)"undefined"!==typeof f[g]&&c.push(d3.select(f[g].parentNode).datum().ID);a.drawLinksBetween(c)}ga&&ga("send","event",
"wgcna","mouseOverMir")};a.mouseleaveMir=function(){d3.select(this).style("opacity","1");tt.transition().duration(200).style("opacity",0);a.svg.selectAll(".mirlink").remove();a.svg.selectAll(".link").remove()};a.mouseoverGene=function(){$("#wgcnaMouseHelp").html("<B>Click</B> to select this gene cluster and see additional details.");d3.select(this).style("fill","url(#selectGrad)");tt.transition().duration(200).style("opacity",1);tt.html(a.createToolTip(d3.select(this).data()[0])).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",
function(){return that.positionTTTop(d3.event.pageY)});var b=d3.select(this.parentNode).datum();"mir"===that.viewType?(a.mirTargetID=b.Gene.ID.toLowerCase(),that.singleImage.drawMiR(),a.svg.selectAll(".link").remove()):($("[id^=ln_"+that.removeInvalidIDChars(b.ID)+"]").each(function(){var b=$(this).attr("id");d3.select("line#"+b).attr("stroke",a.colorLinkHighlight)}),$("[id$="+that.removeInvalidIDChars(b.ID)+"]").each(function(){var b=$(this).attr("id");d3.select("line#"+b).attr("stroke",a.colorLinkHighlight)}));
a.showLinks||a.drawLinks(b);d3.select("#txt_"+that.removeInvalidIDChars(b.ID)).select("text").attr("fill","#00A347");for(var c=that.selectedGene[b.Gene.ID].tcList,d=0;d<c.length;d++)d3.select("#tc_"+that.removeInvalidIDChars(c[d].ID)).attr("fill","#FEFF49");if("mir"===that.viewType&&a.showMirLinks){var e=b.Gene.ID;b=a.geneMirList[b.Gene.ID];b=a.filterRevMiR(b);b=a.svg.select("g.svg-pan-zoom_viewport").selectAll(".mirlink").data(b,that.mirKey);b.enter().append("line").attr("class","mirlink").attr("pointer-events",
"none").attr("id",function(a){return"ln_"+a.ID}).attr("x1",function(b){var c=d3.select("."+e).attr("cx");0<d3.select("#"+that.removeInvalidIDChars(b.ID)).size()&&(c=d3.select("#"+that.removeInvalidIDChars(b.ID))[0][0].__data__.x+a.width/2-a.miRdiameter/2);return c}).attr("y1",function(b){var c=d3.select("."+e).attr("cy");0<d3.select("#"+that.removeInvalidIDChars(b.ID)).size()&&(c=d3.select("#"+that.removeInvalidIDChars(b.ID))[0][0].__data__.y+a.height/2-a.miRdiameter/2);return c}).attr("x2",function(a){return d3.select("."+
e).attr("cx")}).attr("y2",function(a){return d3.select("."+e).attr("cy")}).attr("stroke",function(b){var c=a.mirPred;0<b.V&&(c=a.mirVal);return c}).attr("stroke-width",function(a){return a.P+3*a.V}).merge(b)}ga&&ga("send","event","wgcna","mouseOverGene")};a.mouseleaveGene=function(){var b=d3.select(this.parentNode).datum();$("[id^=ln_"+that.removeInvalidIDChars(b.ID)+"]").each(function(){var b=$(this).attr("id");d3.select("line#"+b).attr("stroke",a.colorLink)});$("[id$="+that.removeInvalidIDChars(b.ID)+
"]").each(function(){var b=$(this).attr("id");d3.select("line#"+b).attr("stroke",a.colorLink)});d3.select(this).style("fill",a.colorCircle);d3.select("#txt_"+that.removeInvalidIDChars(b.ID)).select("text").attr("fill","#000000");tt.transition().duration(500).style("opacity",0);a.showLinks||a.svg.selectAll(".link").remove();"mir"===that.viewType&&(a.mirTargetID=$("#mirGeneFilterTxt").val().toLowerCase(),a.svg.selectAll(".mirLink").remove(),that.singleImage.drawMiR())};return a};that.singleWGCNATableGeneView=
function(){"undefined"!==typeof that.selectedModule?($("div#waitModuleTable").hide(),$("div#wgcnaEqtlTable").hide(),$("div#wgcnaMirTable").hide(),$("div#wgcnaMirGeneTable").hide(),$("div#wgcnaGoTable").hide(),$("div#wgcnaModuleTable").show(),$("span#modTableName").html(that.selectedModule.MOD_NAME),d3.select("div#tableExportCtl").selectAll("span").remove(),d3.select("div#tableExportCtl").append("span").attr("class","button").style("margin-right","10px").on("click",function(){$("#moduleTable").tableExport({type:"csv",
escape:"false"})}).html("Export CSV"),$.fn.DataTable.isDataTable("table#moduleTable")&&$("table#moduleTable").DataTable().destroy(),d3.select("table#moduleTable").select("tbody").selectAll("tr").remove(),d3.select("table#moduleTable").select("tbody").selectAll("tr").data(that.selectedModule.TCList,that.geneKey).enter().append("tr").attr("id",function(a){return"modtrx"+a.ID}).attr("class",function(a,b){var c="odd";0===b%2&&(c="even");return c}).each(function(a,b){d3.select(this).append("td").html(a.Gene.geneSymbol);
d3.select(this).append("td").html(a.Gene.ID);d3.select(this).append("td").html(a.ID);a.PSList?d3.select(this).append("td").html(a.PSList.length):d3.select(this).append("td").html("0");d3.select(this).append("td").html(a.LinkSum.toFixed(2));d3.select(this).append("td").html(function(){return b+1})}),$("table#moduleTable").DataTable({bPaginate:!1,aaSorting:[[4,"desc"]],sDom:"fi<t>"})):($("div#waitModuleTable").hide(),$("div#wgcnaEqtlTable").hide(),$("div#wgcnaModuleTable").hide(),$("div#wgcnaGoTable").hide())};
that.singleWGCNATableMirView=function(){var a={orgPref:"mmu-",runMirFilter:function(a){for(var b=[],c=0,d=0;d<a.length;d++)if(0<a[d].filterGLSize||0<a[d].vC)b[c]=a[d],c++;return b},createMirTable:function(){$("div#waitMirTable").hide();$("div#wgcnaMirGeneTable").hide();$("div#wgcnaMirTable").show();$("span#mirTableName").html(that.selectedModule.MOD_NAME);$.fn.DataTable.isDataTable("table#mirTable")&&$("table#mirTable").DataTable().destroy();d3.select("table#mirTable").select("tbody").selectAll("tr").remove();
var b=a.runMirFilter(that.singleImage.mirData.MIRList);d3.select("table#mirTable").select("tbody").selectAll("tr").data(b,that.mirKey).enter().append("tr").attr("id",function(a){return"mirTR"+that.removeInvalidIDChars(a.ID)}).attr("class",function(a,b){var c="odd";0===b%2&&(c="even");return c}).each(function(a,b){for(var c=0,d=[],e=0,f=[],g=a.GeneList,h=0;h<g.length;h++)0<g[h].V?(c++,d.push(g[h])):1<g[h].P&&(e++,f.push(g[h]));d3.select(this).append("td").html(a.ID);d3.select(this).append("td").html(a.ACC);
d3.select(this).append("td").html(function(){if(0<e){var a='<span class="triggerpL" name="pl'+b+'">'+e+"</span><BR>";a=a+'<span id="pl'+b+'" style="display:none;" >';for(var c=0;c<f.length;c++){0<c&&(a+=", ");var d=f[c].ID;"undefined"!==typeof that.singleImage.geneList[d]&&(d=that.singleImage.geneList[d]);a+=d}a+="</span>"}else a=e;return a});d3.select(this).append("td").html(function(){if(0<c){var a='<span class="triggervL" name="vl'+b+'">'+c+"</span><BR>";a=a+'<span id="vl'+b+'" style="display:none;" >';
for(var e=0;e<d.length;e++){0<e&&(a+=", ");var f=d[e].ID;"undefined"!==typeof that.singleImage.geneList[f]&&(f=that.singleImage.geneList[f]);a+=f}a+="</span>"}else a=c;return a});d3.select(this).append("td").html(function(){var a=e+c;if(0<a){a='<span class="triggerMiL" name="mil'+b+'">'+a+"</span><BR>";a=a+'<span id="mil'+b+'" style="display:none;" >';if(0<d.length){a+="Validated: ";for(var g=0;g<d.length;g++){0<g&&(a+=", ");var h=d[g].ID;"undefined"!==typeof that.singleImage.geneList[h]&&(h=that.singleImage.geneList[h]);
a+=h}}if(0<f.length)for(0<d.length&&(a+="<BR><BR>"),a+="Predicted: ",g=0;g<f.length;g++)0<g&&(a+=", "),h=f[g].ID,"undefined"!==typeof that.singleImage.geneList[h]&&(h=that.singleImage.geneList[h]),a+=h;a+="</span>"}return a})});$("#mirTable .triggerMiL").on("click",function(a){var b=this.getAttribute("name");$("#"+b).is(":hidden")?($(this).addClass("less"),$("span#"+b).show()):($(this).removeClass("less"),$("span#"+b).hide());a.stopPropagation()});$("#mirTable .triggerpL").on("click",function(a){var b=
this.getAttribute("name");$("#"+b).is(":hidden")?($(this).addClass("less"),$("span#"+b).show()):($(this).removeClass("less"),$("span#"+b).hide());a.stopPropagation()});$("#mirTable .triggervL").on("click",function(a){var b=this.getAttribute("name");$("#"+b).is(":hidden")?($(this).addClass("less"),$("span#"+b).show()):($(this).removeClass("less"),$("span#"+b).hide());a.stopPropagation()});$("table#mirTable").DataTable({bPaginate:!1,aaSorting:[[4,"desc"]],sDom:'f<"rightTable"i><t>'})},createMirGeneTable:function(){$("div#waitMirGeneTable").hide();
$("div#wgcnaMirGeneTable").show();$("div#wgcnaMirTable").hide();$("span#mirGeneTableName").html(that.selectedModule.MOD_NAME);d3.select("table#mirGeneTable").select("tbody").selectAll("tr").remove();d3.select("table#mirGeneTable").select("tbody").selectAll("tr").data(that.selectedModule.TCList,that.geneKey).enter().append("tr").attr("id",function(a){return"mirg"+that.removeInvalidIDChars(a.ID)}).attr("class",function(a,b){var c="odd";0===b%2&&(c="even");return c}).each(function(b,c){var d=that.singleImage.geneMirList[b.Gene.ID],
e=0,f=[],g=0,l=[];if("undefined"!==typeof d)for(var m=0;m<d.length;m++)for(var p=d[m].GeneList,n=0,z=0;z<p.length&&0===n;z++)p[z].ID===b.Gene.ID&&(0<p[z].V?(e++,f.push(d[m])):1<p[z].P&&(g++,l.push(d[m])),n=1);d3.select(this).append("td").html(b.Gene.geneSymbol);d3.select(this).append("td").html(b.Gene.ID);d3.select(this).append("td").html(function(b,d){if(0<g){var e='<span class="triggerpL" name="pl'+c+'">'+g+"</span><BR>";e=e+'<span id="pl'+c+'" style="display:none;" >';for(var f=0;f<l.length;f++){0<
f&&(e+=", ");var h=l[f].ID.replace(a.orgPref,"");e+=h}e+="</span>"}else e=g;return e});d3.select(this).append("td").html(function(b,d){if(0<e){var g='<span class="triggervL" name="vl'+c+'">'+e+"</span><BR>";g=g+'<span id="vl'+c+'" style="display:none;" >';for(var h=0;h<f.length;h++){0<h&&(g+=", ");var l=f[h].ID.replace(a.orgPref,"");g+=l}g+="</span>"}else g=e;return g});d3.select(this).append("td").html(function(b,d){var h=e+g;if(0<h){h='<span class="triggerMiL" name="mil'+c+'">'+h+"</span><BR>";
h=h+'<span id="mil'+c+'" style="display:none;" >';if(0<f.length){h+="Validated: ";for(var m=0;m<f.length;m++){0<m&&(h+=", ");var p=f[m].ID.replace(a.orgPref,"");h+=p}}if(0<l.length)for(0<f.length&&(h+="<BR><BR>"),h+="Predicted: ",m=0;m<l.length;m++)0<m&&(h+=", "),p=l[m].ID.replace(a.orgPref,""),h+=p;h+="</span>"}return h})});$("#mirGeneTable .triggerMiL").on("click",function(a){var b=this.getAttribute("name");$("#"+b).is(":hidden")?($(this).addClass("less"),$("span#"+b).show()):($(this).removeClass("less"),
$("span#"+b).hide());a.stopPropagation()});$("#mirGeneTable .triggerpL").on("click",function(a){var b=this.getAttribute("name");$("#"+b).is(":hidden")?($(this).addClass("less"),$("span#"+b).show()):($(this).removeClass("less"),$("span#"+b).hide());a.stopPropagation()});$("#mirGeneTable .triggervL").on("click",function(a){var b=this.getAttribute("name");$("#"+b).is(":hidden")?($(this).addClass("less"),$("span#"+b).show()):($(this).removeClass("less"),$("span#"+b).hide());a.stopPropagation()});$.fn.DataTable.isDataTable("table#mirGeneTable")&&
$("table#mirGeneTable").DataTable().destroy();$("table#mirGeneTable").DataTable({bPaginate:!1,aaSorting:[[4,"desc"]],sDom:'<"rightTable"i><"leftTable"f><t>'})}};if("undefined"!==typeof that.selectedModule){$("div#wgcnaEqtlTable").hide();$("div#wgcnaModuleTable").hide();$("div#wgcnaGoTable").hide();d3.select("div#tableExportCtl").selectAll("span").remove();var b=d3.select("div#tableExportCtl"),c=b.append("span").style("display","inline-block").style("text-align","left").style("margin-left","20px").style("margin-right",
"10px");c.append("text").text("View by:");c.append("br");c.append("input").attr("type","radio").attr("checked","checked").attr("name","wgcnaMirTableRB").on("click",function(){a.createMirTable()});c.append("text").text(" miRNA");c.append("br");c.append("input").attr("type","radio").attr("name","wgcnaMirTableRB").on("click",function(){a.createMirGeneTable()});c.append("text").text(" Gene");b.append("span").attr("class","button").style("display","inline-block").style("margin-right","10px").on("click",
function(){$("#moduleTable").tableExport({type:"csv",escape:"false"})}).html("Export CSV");a.createMirTable()}else $("div#waitModuleTable").hide(),$("div#wgcnaEqtlTable").hide(),$("div#wgcnaModuleTable").hide(),$("div#wgcnaMirTable").hide(),$("div#wgcnaMirGeneTable").hide(),$("div#wgcnaGoTable").hide();return a};that.singleWGCNAImageGoView=function(){var a=that.singleWGCNAImage();$(".goCTL").show();$(".linkCTL").hide();$(".mirCTL").hide();$(".eqtlCtls").hide();a.type=that.viewType;a.goDomain="mf";
a.lastDrawn="mf";a.selectedNode;a.displayedLevel="d1";a.width=$(window).width();a.height=Math.floor(.92*window.innerHeight);a.padding=5;a.radius=(Math.min(a.width,a.height)-2*a.padding)/2;a.duration=1E3;a.xScale=d3.scaleLinear().range([0,2*Math.PI]);a.yScale=d3.scalePow().exponent(1.3).domain([0,1]).range([0,a.radius]);a.colorGO=d3.scaleOrdinal(d3.schemeCategory20);a.displayDepth=3;a.geneList={};var b=[];if(that.selectedModule){b=that.selectedModule.TCList;for(var c=0;c<b.length;c++)a.geneList[that.selectedModule.TCList[c].Gene.ID]=
that.selectedModule.TCList[c].Gene.geneSymbol}a.pathColor=function(b){return b&&b.data?b.data.name&&0==b.data.name.indexOf("ENS")?"#DFC184":b.data.name?a.colorGO(b.data.name):"#000000":b&&b.name&&0==b.name.indexOf("ENS")?"#DFC184":b&&b.name?a.colorGO(b.name):"#000000"};a.addLabels=function(b,c,d,e,f,g,l){g=a.radius/(l+1)*b.depth+a.radius/(l+1)-12;var h=a.radius/(l+1)*b.depth,m=(f-d)/360*Math.PI*h*2;l=Math.floor((f-d)/360*Math.PI*g*2/7)-1;g=Math.floor((g-h)/12);var p=b.data.name;0===b.data.name.indexOf("ENS")&&
"undefined"!==typeof a.geneList[p]&&(p=a.geneList[p],25<f-d&&(p=p+" ("+b.data.name+")"));var n=p.split(" ")[0].split("-")[0];if(n.length<=l||-1===b.data.name.indexOf("ENS")&&n.length/2<=l&&10<f-d){m=[];n=0;if(p.length>l)for(;0<p.length;){var r=p.indexOf(" ");if(-1===r)p.length>l?(m[n]=p.substr(0,l),n++,p=p.substr(l)):(m[n]=p,n++,p="");else{for(var q=0;r<l&&1>q;){var t=p.indexOf(" ",r+1);-1!==t&&t<=l?r=t:q=1}r>l?-1<p.indexOf("-")&&p.indexOf("-")<l?(r=p.indexOf("-"),m[n]=p.substr(0,r+1),n++,p=p.substr(r+
1)):(m[n]=p.substr(0,l),n++,p=p.substr(l)):(m[n]=p.substr(0,r),n++,p=p.substr(r+1))}}else m[n]=p;n=a.topG.append("text").style("fill-opacity",1).style("fill","#000").attr("pointer-events","none").attr("class","txt"+removeColon(b.data.id)).attr("text-anchor",function(a){return"start"}).attr("dy","1em").style("opacity",function(a){return 1}).append("textPath").attr("xlink:href",function(a){return"#ap"+c}).attr("startOffset",function(a){return 0===d&&360===f?90:5});for(b=0;b<m.length&&b<g;b++)b<g&&(b===
g-1&&m.length>g&&(m[b]+="...",m[b].length>l&&(m[b]=m[b].substr(0,l-4)+"...")),n.append("tspan").attr("x",0).attr("dy","1em").text(m[b]))}else if(12<=m&&0===b.data.name.indexOf("ENS"))for(n=a.topG.append("text").style("fill-opacity",1).style("fill","#000").attr("pointer-events","none").attr("class","txt"+removeColon(b.data.id)).attr("text-anchor",function(a){a="start";180<=f&&(a="end");return a}).attr("dy",".2em").attr("transform",function(a){a=e-2.5;var b=h;0===d&&360===f&&(b=20);180<=f&&(a=e+2.5);
return"rotate("+(a-90)+")translate("+b+")rotate("+(180<a?-180:0)+")"}).style("opacity",function(a){return 1}),p=b.data.name,0===b.data.name.indexOf("ENS")&&"undefined"!==typeof a.geneList[p]&&(p=a.geneList[p]),l=p.split(" "),b=0;b<l.length;b++)n.append("tspan").attr("x",0).attr("dy","1em").text(l[b])};a.redraw=function(){a.svg.selectAll("path").remove();a.svg.select("#center").remove();var b=a.partition(a.rootN).descendants().filter(a.filterNodes),c=a.displayDepth;a.arc=d3.arc().startAngle(function(a){return Math.max(0,
Math.min(2*Math.PI,a.x0))}).endAngle(function(a){return Math.max(0,Math.min(2*Math.PI,a.x1))}).innerRadius(function(b){return b===a.selectedNode&&a.selectedNode!==a.data.GOList[0]&&a.selectedNode!==a.data.GOList[1]&&a.selectedNode!==a.data.GOList[2]?20:Math.max(0,a.radius/(c+1)*(b.depth-a.rootN.depth))}).outerRadius(function(b){return Math.max(0,a.radius/(c+1)*(b.depth-a.rootN.depth)+a.radius/(c+1))});a.topG.selectAll("path").remove();a.topG.selectAll("text").remove();var d=180/Math.PI;a.path=a.topG.selectAll("path").data(b);
a.path.enter().append("path").merge(a.path).attr("d",a.arc).attr("id",function(a,b){return"ap"+b}).attr("class",function(a,b){return removeColon(a.data.id)}).attr("fill-rule","evenodd").attr("fill",a.pathColor).attr("pointer-events","all").on("mouseover",a.mouseover).on("click",a.click).each(function(b,e){if(b.depth<a.rootN.depth+a.displayDepth){var f=Math.max(0,Math.min(2*Math.PI,b.x0))*d,g=Math.max(0,Math.min(2*Math.PI,b.x1))*d,h=f+(g-f)/2;0===f&&360===g&&(h=90);a.addLabels(b,e,f,h,g,b.depth-a.rootN.depth,
c)}});if(a.selectedNode!==a.data.GOList[0]&&a.selectedNode!==a.data.GOList[1]&&a.selectedNode!==a.data.GOList[2])a.svg.append("circle").attr("id","center").attr("cx",a.width/2+a.padding).attr("cy",a.height/2+a.padding).attr("r","20").attr("fill-rule","evenodd").attr("fill",function(){return a.pathColor(a.rootN.parent)}).attr("pointer-events","all").on("click",function(){if(a.rootN.parent.data===a.data.GOList[0]||a.rootN.parent.data===a.data.GOList[1]||a.rootN.parent.data===a.data.GOList[2])a.selectedNode=
null,a.draw();else{if(a.rootN.parent.data!==a.data.GOList[0]&&a.rootN.parent.data!==a.data.GOList[1]&&a.rootN.parent.data!==a.data.GOList[2])a.selectedNode=a.rootN.parent.data,a.rootN=a.rootN.parent,a.mouseover(a.rootN.parent);else{var b=a.data.GOList[0];"mf"===a.goDomain?b=a.data.GOList[2]:"bp"===a.goDomain&&(b=a.data.GOList[1]);a.selectedNode=b}a.redraw();d3.event.stopPropagation();ga&&ga("send","event","wgcna","mouseClickGO")}}).on("mouseover",function(b){"undefined"!==typeof a.selectedNode&&a.selectedNode.parent!==
a.data.GOList[0]&&a.selectedNode.parent!==a.data.GOList[1]&&a.selectedNode.parent!==a.data.GOList[2]?a.mouseover(a.selectedNode.parent):(tt.transition().duration(200).style("opacity",1),tt.html(a.createToolTip(a.selectedNode)).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",function(){return that.positionTTTop(d3.event.pageY)}));d3.event.stopPropagation();ga&&ga("send","event","wgcna","mouseOverGO")}).on("mouseleave",function(a){tt.transition().duration(200).style("opacity",
0)})};a.getModuleGOFile=function(b){"undefined"!==typeof that.selectedModule&&"undefined"!==typeof that.selectedModule.MOD_NAME&&$.ajax({url:contextRoot+"tmpData/browserCache/"+genomeVer+"/modules/ds"+that.wDSID+"/"+replaceUnderscore(that.selectedModule.MOD_NAME)+".GO.json",type:"GET",async:!0,data:{},dataType:"json",success:function(b){a.data=b;console.log(a.data);console.log(a.data.GOList[0]);b=a.data.GOList[0];for(var c=0,d=0;d<b.length;d++)b[d].UnqID=c,console.log(b[d]),c++;b=a.data.GOList[1];
for(d=0;d<b.length;d++)b[d].UnqID=c,c++;b=a.data.GOList[2];for(d=0;d<b.length;d++)b[d].UnqID=c,c++;a.draw()},error:function(c,d,e){console.log(e);25>b&&setTimeout(function(){a.getModuleGOFile(b+1)},1E3)}})};a.draw=function(){a.svg.attr("width",a.width).attr("height",a.height);a.initializeBreadcrumbTrail();a.topG=a.svg.append("g").attr("transform","translate("+[a.width/2+a.padding,a.height/2+a.padding]+")");a.partition=d3.partition().size([2*Math.PI,a.radius]);if("undefined"===typeof a.data.MOD_NAME||
"undefined"!==typeof that.selectedModule.MOD_NAME&&replaceUnderscore(a.data.MOD_NAME)!==replaceUnderscore(that.selectedModule.MOD_NAME))a.getModuleGOFile(0),a.selectedNode=null;else{if(a.goDomain!==a.lastDrawn||"undefined"===typeof a.selectedNode||null===a.selectedNode){var b=a.data.GOList[0];"mf"===a.goDomain?b=a.data.GOList[2]:"bp"===a.goDomain&&(b=a.data.GOList[1]);a.selectedNode=b;a.rootN=d3.hierarchy(b).sum(function(a){return a&&a.name&&-1<a.name.indexOf("ENS")?1:a.uniqueGene}).sort(function(a,
b){return b.value-a.value})}b=a.partition(a.rootN).descendants().filter(a.filterNodes);a.lastDrawn=a.goDomain;if(a.selectedNode===a.data.GOList[0]||a.selectedNode===a.data.GOList[1]||a.selectedNode===a.data.GOList[2])a.totalSize=a.selectedNode.uniqueGene;var c=a.displayDepth;a.arc=d3.arc().startAngle(function(a){return Math.max(0,Math.min(2*Math.PI,a.x0))}).endAngle(function(a){return Math.max(0,Math.min(2*Math.PI,a.x1))}).innerRadius(function(b){return Math.max(0,a.radius/(c+1)*b.depth)}).outerRadius(function(b){return Math.max(0,
a.radius/(c+1)*b.depth+a.radius/(c+1))});setTimeout(function(){that.singleWGCNATableGoView()},50);a.vis=a.topG.append("svg:circle").attr("r",a.radius+30).style("opacity",0).on("mouseover",a.mouseleave);var d=180/Math.PI;a.path=a.topG.selectAll("path").data(b);a.path.enter().append("path").attr("d",a.arc).attr("id",function(a,b){return"ap"+b}).attr("fill-rule","evenodd").attr("fill",a.pathColor).attr("pointer-events","all").on("mouseover",a.mouseover).on("click",a.click).each(function(b,e){var f=Math.max(0,
Math.min(2*Math.PI,b.x0))*d,g=Math.max(0,Math.min(2*Math.PI,b.x1))*d,h=f+(g-f)/2;0===f&&360===g&&(h=90);a.addLabels(b,e,f,h,g,b.depth-a.rootN.depth,c)});a.path.exit().remove();a.svg.append("g").attr("transform","translate(0,15)").append("text").style("fill-opacity",1).style("fill","#000").attr("pointer-events","none").attr("text-anchor","start").style("opacity",function(a){return 1}).text(a.selectedNode.uniqueGene+" genes in module with GO annotation")}};a.filterNodes=function(b,c){return b.depth<
a.rootN.depth+a.displayDepth?!0:!1};a.click=function(b){a.selectedNode=b.data;a.rootN=b;b.data!==a.data.GOList[0]&&b.data!==a.data.GOList[1]&&b.data!==a.data.GOList[2]?a.redraw():a.draw();d3.event.stopPropagation()};a.mouseover=function(b){if("undefined"!==typeof b&&null!==b){var c=a.data.GOList[0];"mf"===a.goDomain?c=a.data.GOList[2]:"bp"===a.goDomain&&(c=a.data.GOList[1]);var d=0;d="undefined"!==typeof b&&"undefined"!==typeof b.data.value?(100*b.data.value/c.uniqueGene).toPrecision(3):"undefined"!==
typeof b?(100*b.data.uniqueGene/c.uniqueGene).toPrecision(3):100;c=d+"%";.1>d&&(c="< 0.1%");"undefined"!==typeof b.data.name&&-1===b.data.name.indexOf("ENS")&&(c=b.data.uniqueGene+" genes ("+c+")");d3.select("#percentage").text(c);d3.select("#explanation").style("visibility","");var e=a.getAncestors(b);a.updateBreadcrumbs(e,c);d3.selectAll("path").style("opacity",.3);a.topG.selectAll("text").style("opacity",.3);a.topG.selectAll("path").filter(function(a){return 0<=e.indexOf(a)}).style("opacity",1).each(function(b){a.topG.selectAll(".txt"+
removeColon(b.data.id)).style("opacity",1)});a.topG.selectAll("."+removeColon(b.data.id)).style("opacity",1);tt.transition().duration(200).style("opacity",1);tt.html(a.createToolTip(b)).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",function(){return that.positionTTTop(d3.event.pageY)})}d3.event.stopPropagation()};a.createToolTip=function(b){b.data&&(b=b.data);var c="Name:"+b.name+" ("+b.id+")<BR><BR>Definition: "+b.definition+"<BR><BR>Unique Genes in this module with this term: "+
b.uniqueGene+"<BR>";if(0<b.uniqueGene)for(var d=0;d<b.uniqueGenes.length;d++){0<d&&(c+=", ");var e=b.uniqueGenes[d].id;"undefined"!==typeof a.geneList[e]&&(e=a.geneList[e]);c+=e}return c};a.mouseleave=function(a){d3.select("#trail").style("visibility","hidden");d3.selectAll("text").style("opacity",1);d3.selectAll("path").transition().duration(500).style("opacity",1);d3.select("#explanation").style("visibility","hidden");tt.transition().duration(200).style("opacity",0)};a.getAncestors=function(a){for(var b=
[];a.parent;)b.unshift(a),a=a.parent;return b};a.isParentOf=function(b,c){return b===c?!0:b.children?b.children.some(function(b){return a.isParentOf(b,c)}):!1};a.b={w:250,h:30,s:3,t:10,runW:0,runH:0};a.initializeBreadcrumbTrail=function(){d3.select("#singleWGCNASVG").remove();d3.select("#trail").remove();d3.select("#viewGene").append("svg:svg").attr("width",a.width).attr("height",68).attr("id","trail").append("svg:text").attr("id","endlabel").style("fill","#000");a.svg=d3.select("#viewGene").append("svg").attr("id",
"singleWGCNASVG").attr("height",a.height+"px").attr("width","100%")};a.breadcrumbPoints=function(b,c){var d=7.5*b.data.name.length+25,e=[];e.push("0,0");e.push(d+",0");e.push(d+a.b.t+","+a.b.h/2);e.push(d+","+a.b.h);e.push("0,"+a.b.h);0<c&&e.push(a.b.t+","+a.b.h/2);return e.join(" ")};a.updateBreadcrumbs=function(b,c){var d=d3.select("#trail").selectAll("g").data(b,function(a){return a.data.name+a.depth});d.exit().remove();a.b.runW=0;a.b.runH=0;d=d.enter().append("svg:g").merge(d).attr("transform",
function(b,c){var d=7.5*b.data.name.length+25,e=a.b.runW;e+d>a.width&&(e=0,a.b.runH=a.b.runH+a.b.h+a.b.s,a.b.runW=0);a.b.runW=a.b.runW+d+a.b.s;return"translate("+e+", "+a.b.runH+")"});d.append("svg:polygon").attr("points",a.breadcrumbPoints).style("fill",a.pathColor);d.append("svg:text").attr("x",function(b){return(7.5*b.data.name.length+25+a.b.t)/2}).attr("y",a.b.h/2).attr("dy","0.35em").attr("text-anchor","middle").text(function(b){b=b.data.name;0===b.indexOf("ENS")&&"undefined"!==typeof a.geneList[b]&&
(b=a.geneList[b]);return b});d3.select("#trail").select("#endlabel").attr("x",a.b.runW+15).attr("y",a.b.h/2+a.b.runH).attr("dy","0.35em").attr("text-anchor","start").text(c);d3.select("#trail").attr("height",function(){var b=a.b.runH+a.b.h+5;68>b&&(b=68);return b}).style("visibility","")};return a};that.flattenTree=function(a,b){-1===b.data.name.indexOf("ENS")&&a.push(b);if(b.children)for(var c=0;c<b.children.length;c++)that.flattenTree(a,b.children[c])};that.singleWGCNATableGoView=function(){$("div#waitGoTable").hide();
$("div#wgcnaModuleTable").hide();$("div#wgcnaMirTable").hide();$("div#wgcnaMirGeneTable").hide();$("div#wgcnaEqtlTable").hide();$("div#wgcnaGoTable").show();$("span#GoTableName").html(that.selectedModule.MOD_NAME);d3.select("div#tableExportCtl").selectAll("span").remove();d3.select("div#tableExportCtl").append("span").attr("class","button").style("margin-right","10px").on("click",function(){$("#GoTable").tableExport({type:"csv",escape:"false"})}).html("Export CSV");$.fn.DataTable.isDataTable("table#GoTable")&&
$("table#GoTable").DataTable().destroy();d3.select("#GoTable").select("tbody").selectAll("tr").remove();var a=[];that.flattenTree(a,that.singleImage.rootN);a=d3.select("#GoTable").select("tbody").selectAll("tr").data(a,function(a,b){return b});a.exit().remove();a.enter().append("tr").style("background-color",that.singleImage.pathColor).style("display",function(a){var b="none";a.depth<=that.singleImage.rootN.depth?b="":a.depth===that.singleImage.rootN.depth+1&&(b="");return b}).style("cursor","pointer").merge(a).attr("id",
function(a){return a.id}).attr("class",function(a){return" d"+a.depth}).on("mouseover",function(a){d3.select(this).style("background-color","#FFFFFF");ga&&ga("send","event","wgcna","mouseOverGOTbl")}).on("mouseleave",function(a){d3.select(this).style("background-color",that.singleImage.pathColor(a))}).on("click",function(a){that.singleImage.selectedNode=a.data;that.singleImage.rootN=a;$("span[name=d"+a.depth+"]").addClass("less");$("tr.d"+a.depth).show();that.singleImage.redraw();ga&&ga("send","event",
"wgcna","mouseClickGOTbl")}).each(function(a,b){var c=d3.select(this);c.append("td").style("padding-left",function(){return 20*a.depth+"px"}).html(function(){var b=a.data.name+" ("+a.data.id+")";-1<a.data.name.indexOf("ENS")&&(b=that.singleImage.geneList[a.data.name]+" ("+a.data.id+")");var c=b;if("undefined"!==typeof a.children&&0<a.children.length){c="";a.depth<=that.singleImage.rootN.depth&&(c=" less");for(var d=0,e=0;e<a.children.length&&0===d;e++)-1===a.children[e].data.name.indexOf("ENS")&&
(d=1);c=1===d?'<span class="trigger'+c+'" name="d'+(a.depth+1)+'">'+b+"</span>":b}return c});c.append("td").html(a.data.definition);c.append("td").html(function(){if(0<a.data.uniqueGene){var c='<span class="triggerGL" name="gl'+b+'">'+a.data.uniqueGene+"</span><BR>";c=c+'<span id="gl'+b+'" style="display:none;" >';for(var d=0;d<a.data.uniqueGenes.length;d++){0<d&&(c+=", ");var e=a.data.uniqueGenes[d].id;"undefined"!==typeof that.singleImage.geneList[e]&&(e=that.singleImage.geneList[e]);c+=e}c+="</span>"}else c=
"0";return c})});$("#GoTable .trigger").on("click",function(a){var b=this.getAttribute("name");if($("."+b).is(":hidden"))$("span[name="+b+"]").addClass("less"),$("tr."+b).show();else for(b=parseInt(b.substr(1));0<$("tr.d"+b).length;)$("span[name=d"+b+"]").removeClass("less"),$("tr.d"+b).hide(),b++;a.stopPropagation()});$("#GoTable .triggerGL").on("click",function(a){var b=this.getAttribute("name");$("#"+b).is(":hidden")?($(this).addClass("less"),$("span#"+b).show()):($(this).removeClass("less"),$("span#"+
b).hide());a.stopPropagation()});$("#GoTable").DataTable({bPaginate:!1,bSort:!1,asStripClasses:[],sDom:"f<t>"})};that.singleWGCNAImageEQTLView=function(){var a=that.singleWGCNAImage();$(".linkCTL").hide();$(".mirCTL").hide();$(".goCTL").hide();$(".eqtlCtls").show();a.type="eqtl";a.createToolTip=function(a){var b=that.selectedGene[a];return b.geneSymbol?"<BR>Gene: "+b.geneSymbol+"("+a+")":"<BR>Gene: "+a};a.colorGene=function(a){var b="#DFC184";if(0===a.indexOf("Brain")||0===a.indexOf("Unannotated"))b=
"#7EB5D6";return b};a.displayDefault=function(){d3.select("#viewGene").remove();d3.select("#circos").remove();that.selectedModule&&(a.update(contextRoot+"tmpData/browserCache/"+genomeVer+"/circos/ds"+that.wDSID+"/"+replaceUnderscore(that.selectedModule.MOD_NAME)+"/"+replaceUnderscore(that.selectedModule.MOD_NAME)+"_1/svg/circos_new.svg"),that.singleWGCNATableEQTLView())};a.draw=function(){};a.update=function(b){$.ajax({url:b,type:"GET",data:{},dataType:"html",success:function(b){d3.select("#circos").remove();
d3.select("#wgcnaGeneImage").append("div").attr("id","circos");$("#circos").html(b);$("#circosModule").css("width","100%");$("#circosModule").css("height",Math.floor(.9*window.innerHeight)+"px");a.panZoomCircos=svgPanZoom("#circosModule",{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,minZoom:.1,maxZoom:4,fit:!0,center:!0});d3.select("#circosModule").selectAll(".circosGene").style("cursor","pointer").on("mouseover",function(){d3.select(this).style("fill",
"#000000").attr("font-size","50px");tt.transition().duration(200).style("opacity",1);tt.html(a.createToolTip(d3.select(this).attr("id"))).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",function(){return that.positionTTTop(d3.event.pageY)});ga&&ga("send","event","wgcna","mouseOverEQTL")}).on("mouseout",function(){var b=a.colorGene(d3.select(this).attr("id"));d3.select(this).style("fill",b).attr("font-size","26px");tt.transition().duration(500).style("opacity",0)});
that.singleWGCNATableEQTLView()}})};return a};that.singleWGCNATableEQTLView=function(){$("div#waitEqtlTable").hide();$("div#wgcnaModuleTable").hide();$("div#wgcnaMirTable").hide();$("div#wgcnaMirGeneTable").hide();$("div#wgcnaGoTable").hide();$("div#wgcnaEqtlTable").show();$("span#eqtlTableName").html(that.selectedModule.MOD_NAME);d3.select("div#tableExportCtl").selectAll("span").remove();d3.select("div#tableExportCtl").append("span").attr("class","button").style("margin-right","10px").on("click",
function(){$("#eqtlTable").tableExport({type:"csv",escape:"false"})}).html("Export CSV");$.ajax({url:contextRoot+"tmpData/browserCache/"+genomeVer+"/modules/ds"+that.wDSID+"/"+replaceUnderscore(that.selectedModule.MOD_NAME)+".eQTL.json",type:"GET",async:!0,data:{},dataType:"json",beforeSend:function(){$("div#waitEqtlTable").show()},success:function(a){setTimeout(function(){$.fn.DataTable.isDataTable("table#eqtlTable")&&$("table#eqtlTable").DataTable().destroy();for(var b=[],c=1*$("#eqtlPval").val(),
e="",f=0,h=0;h<a.length;h++)a[h].Pval>=c&&(a[h].Pval>f&&(e=a[h].Snp,f=a[h].Pval),b.push(a[h]));d3.select("#eqtlTable").select("tbody").selectAll("tr").remove();d3.select("#eqtlTable").select("tbody").selectAll("tr").data(b,that.eQTLKey).enter().append("tr").attr("id",function(a){return"tblLink_"+a.Snp}).attr("class",function(a,b){var c="odd";0===b%2&&(c="even");return c}).each(function(a,b){var c=a.Start/1E6;d3.select(this).append("td").html(a.Chr);d3.select(this).append("td").html(c.toFixed(1));
d3.select(this).append("td").html(a.Snp);d3.select(this).append("td").html(a.Pval.toFixed(2))});$("#eqtlTable").DataTable({bPaginate:!1,aaSorting:[[3,"desc"]],sDom:"fi<t>"});$("div#waitEqtlTable").hide();d3.select("#circosModule").select("g#Link_"+e).select("path").style("stroke","#FFF450")},20)},error:function(a,b,c){}})};that.singleWGCNAImageMetaView=function(){var a=that.singleWGCNAImage();$(".goCTL").hide();$(".eqtlCtls").hide();$(".linkCTL").show();a.CorCutoff_min=.75;a.CorCutoff_max=1;a.type=
that.viewType;a.truncated=0;a.filterOneDB=1;a.mirGeneCutoff=1;a.mirValid=0;a.mirTargetID="";a.mirID="";a.miRcolor=d3.scaleOrdinal(d3.schemeCategory20b);a.sortMir=0;a.maxCorWidth=5;a.mlinkKey=function(a){return that.removeInvalidIDChars(a.MOD1)+"_"+that.removeInvalidIDChars(a.MOD2)};a.colorCircle=function(a){return a.COLOR};a.colorLink=function(b){var c=a.negColor;0<b.COR&&(c=a.posColor);return c};a.colorLinkHighlight=function(b){var c=a.negDarkColor;0<b.COR&&(c=a.posDarkColor);return c};a.drawLinks=
function(b){a.updateColor("linkColor");a.svg.selectAll(".link").remove();for(var c=a.metaData.LINKS,e=[],f=0,g=0;g<c.length;g++)(c[g].MOD1===b.MODULE||c[g].MOD2===b.MODULE)&&a.CorCutoff_min<=Math.abs(c[g].COR)&&Math.abs(c[g].COR)<=a.CorCutoff_max&&(e[f]=c[g],f++);c=e;1E4>c.length&&(b=a.topG.selectAll(".link").data(c,a.mlinkKey),b.enter().append("line").attr("class","link").attr("pointer-events","none").attr("id",function(a){return"ln_"+that.removeInvalidIDChars(a.MOD1)+that.removeInvalidIDChars(a.MOD2)}).attr("x1",
function(a){return d3.select("#mod_"+that.removeInvalidIDChars(a.MOD1)).attr("cx")}).attr("y1",function(a){return d3.select("#mod_"+that.removeInvalidIDChars(a.MOD1)).attr("cy")}).attr("x2",function(a){return d3.select("#mod_"+that.removeInvalidIDChars(a.MOD2)).attr("cx")}).attr("y2",function(a){return d3.select("#mod_"+that.removeInvalidIDChars(a.MOD2)).attr("cy")}).attr("stroke",a.colorLink).attr("stroke-width",function(b){return Math.abs(b.COR)*a.maxCorWidth}).merge(b))};a.drawLinksBetween=function(b){a.updateColor("linkColor");
for(var c={},e=0;e<b.length;e++)c[b[e]]=1;a.svg.selectAll(".link").remove();b=a.metaData.LINKS;e=[];for(var f=0,g=0;g<b.length;g++)(0===a.showAllFromTarget&&"undefined"!==typeof c[b[g].MOD1]&&"undefined"!==typeof c[b[g].MOD2]||1===a.showAllFromTarget&&("undefined"!==typeof c[b[g].MOD1]||"undefined"!==typeof c[b[g].MOD2]))&&a.CorCutoff_min<=Math.abs(b[g].COR)&&Math.abs(b[g].COR)<=a.CorCutoff_max&&(e[f]=b[g],f++);b=e;1E4>b.length&&(c=a.topG.selectAll(".link").data(b,a.mlinkKey),c.enter().append("line").attr("class",
"link").attr("pointer-events","none").attr("id",function(a){return"ln_"+that.removeInvalidIDChars(a.MOD1)+that.removeInvalidIDChars(a.MOD2)}).attr("x1",function(a){return d3.select("#mod_"+that.removeInvalidIDChars(a.MOD1)).attr("cx")}).attr("y1",function(a){return d3.select("#mod_"+that.removeInvalidIDChars(a.MOD1)).attr("cy")}).attr("x2",function(a){return d3.select("#mod_"+that.removeInvalidIDChars(a.MOD2)).attr("cx")}).attr("y2",function(a){return d3.select("#mod_"+that.removeInvalidIDChars(a.MOD2)).attr("cy")}).attr("stroke",
a.colorLink).attr("stroke-width",function(b){return Math.abs(b.COR)*a.maxCorWidth}).merge(c))};a.nodeX=function(b,c){var d=50,e=Math.floor(c/a.maxPerLevel)+1;1<e&&(d=60*e);return a.width/2+(a.r-d)*Math.cos(c%a.maxPerLevel*a.angle-1.57079633)};a.nodeY=function(b,c){var d=50;c>a.maxPerLevel&&(d=60*(Math.floor(c/a.maxPerLevel)+1));return a.height/2+(a.r-d)*Math.sin(c%a.maxPerLevel*a.angle-1.57079633)};a.nodeXLbl=function(b,c){var d=c%a.maxPerLevel*a.angle-1.57079633,e=1;if(Math.PI/2<d&&d<1.5*Math.PI){var f=
0;"undefined"!==typeof b.MODULE&&(f=b.MODULE.length);e+=7.5*f}return a.width/2+(a.r+e)*Math.cos(d)};a.nodeYLbl=function(b,c){var d=c%a.maxPerLevel*a.angle-1.57079633,e=1;if(Math.PI/2<d&&d<1.5*Math.PI){var f=0;"undefined"!==typeof b.MODULE&&(f=b.MODULE.length);e+=7.5*f}return a.height/2+(a.r+e)*Math.sin(d)};a.drawCorLegend=function(b){a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",b).text("Positive Correlation");a.legendDispG.append("rect").attr("x","0").attr("y",b-10).attr("width",
"30").attr("height","10").style("fill",a.posColor);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",b+20).text("Negative Correlation");a.legendDispG.append("rect").attr("x","0").attr("y",b+10).attr("width","30").attr("height","10").style("fill",a.negColor);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",b+40).text("Lower Correlation");a.legendDispG.append("line").attr("x1","0").attr("y1",b+30).attr("x2","30").attr("y2",b+30).style("stroke",
"#000000").style("stroke-width","0");a.legendDispG.append("line").attr("x1","0").attr("y1",b+35).attr("x2","30").attr("y2",b+35).style("stroke","#000000").style("stroke-width","0.5");a.legendDispG.append("line").attr("x1","0").attr("y1",b+40).attr("x2","30").attr("y2",b+40).style("stroke","#000000").style("stroke-width","1");a.legendDispG.append("line").attr("x1","0").attr("y1",b+45).attr("x2","30").attr("y2",b+45).style("stroke","#000000").style("stroke-width","2");a.legendDispG.append("line").attr("x1",
"0").attr("y1",b+55).attr("x2","30").attr("y2",b+55).style("stroke","#000000").style("stroke-width","3");a.legendDispG.append("line").attr("x1","0").attr("y1",b+65).attr("x2","30").attr("y2",b+65).style("stroke","#000000").style("stroke-width","5");a.legendDispG.append("line").attr("x1","0").attr("y1",b+75).attr("x2","30").attr("y2",b+75).style("stroke","#000000").style("stroke-width","7");a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",b+80).text("Higher Correlation")};
a.drawLegend=function(){a.drawCorLegend(20)};a.selectMetaMod=function(a){that.topselectedModule=that.selectedModule;that.selectedModule=that.modules[a];that.topselectedGene=that.selectedGene;that.selectedGene={};for(a=0;a<that.selectedModule.TCList.length;a++)"undefined"===typeof that.selectedGene[that.selectedModule.TCList[a].Gene.ID]&&(that.selectedGene[that.selectedModule.TCList[a].Gene.ID]={},that.selectedGene[that.selectedModule.TCList[a].Gene.ID].geneSymbol=that.selectedModule.TCList[a].Gene.geneSymbol,
that.selectedGene[that.selectedModule.TCList[a].Gene.ID].tcList=[]),that.selectedGene[that.selectedModule.TCList[a].Gene.ID].tcList.push(that.selectedModule.TCList[a]);that.viewType="gene";d3.select("#wgcnaGeneViewRB").property("checked",!0);that.createSingleWGCNAImage()};a.draw=function(){a.updateColor("linkColor");a.width=$(window).width();a.height=Math.floor(.9*window.innerHeight);a.r=a.height>a.width?Math.floor(a.width/2*.95):Math.floor(a.height/2*.95);a.svg.attr("height",a.height+"px");a.svg.selectAll("circle").remove();
a.svg.selectAll("text").remove();a.svg.selectAll("line").remove();a.svg.selectAll(".mod").remove();"undefined"!==typeof a.panZoom&&(a.panZoom.destroy(),delete a.panZoom);a.svg.selectAll(".svg-pan-zoom_viewport").remove();setTimeout(function(){a.svg.append("text").style("font-size","20").attr("y",22).attr("x",5).text(function(){return that.selectedModule?"Meta Module for "+replaceUnderscore(that.selectedModule.MOD_NAME):""});a.setupLegend();a.data=a.metaData.MODULES;a.angle=2*Math.PI/a.data.length;
a.angleDeg=360/a.data.length;a.data.length>a.maxPerLevel&&(a.angle=2*Math.PI/a.maxPerLevel,a.angleDeg=360/a.maxPerLevel);if(150<a.data.length){a.truncated=1;a.maxNodeR=15;for(var b=[],c=0;150>c;c++)b[c]=a.data[c];a.data=b;a.dataIndex={};for(c=0;c<a.data.length;c++)a.dataIndex[a.data[c].ID]=1;a.CorCutoff_min=.75;$("#linkSliderMin").slider("value",.75);$("span#minLabel").html(.75);a.svg.append("image").attr("x",7.8*that.selectedModule.MOD_NAME.length+20).attr("y",1).attr("width","24px").attr("height",
"24px").attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAJI0lEQVRIDQEYCef2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAAH/gAACcAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAADwAAALkCAABoFDEx0gIzM+/b29v4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGIAAAAvAgAAHDnn54QGBgY3SUlJBwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8AAB0AAAChAAAADAAAAAAU9vYY4RER/ecNDdLZ2dnvAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB5AAAAFgAAAAAAAAAABv7+BFHZ2UgFAgI4Ozs7DAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAtAAAAmAAAAAQAAAAAAAAAAAAAAAAU9/cM7AoKAOYYGNTZ2dnqAAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAFAAAAnQAAACf8AgIAzhgY/uIODv4V9vYBBP//AR3z8xrKHBzjDhwc2uDg4PYAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASwAAAEUAAAAB+AMDAJwyMveSODjT9QUF+AAAAAAY9PQOTN3dTxISEipAQEAEAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAADAAAAIAAAAAEAAAAAAAAAAAC/v7vAv7+tQn7+/IAAAAAAAAAAT/g4DQd8/NHCgoKFAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGcAAAAuAAAAAAAAAAAAAAAAAAEB+gP//+QF///7AAAAAAAAAAAQ+voIVtfXUggICDM5OTkJAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAP8AABYAAAB4AAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAATXm5iYt6+tMExMTHAAAAAEAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB7AAAAEwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAF/v4CVdfXSw0EBDdAQEALAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAD/AAAzAAAAkwAAAAYAAAAAAAAAAAAAAAAAAQEAAAAA/kDh4QAb8/MpAgAACAAAAAAAAAAAAAAAABT29g7vCAgB4RYW1NnZ2eoAAAD/AAAAAAAAAAAAAAAAAAAAAAD/AAAE/wAAtf8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD/5Q0N7WNKSnFHR0cSAAAAAAAAAAADAAAAAAAAAAAAAAAAgAAATAAAAHkAAAADAAAAAAAAAAAAAAAAAAAAAPgEBP+XMzP7xR8f7ivq6gcH/f0CAAAAAAAAAAAAAAAAAAAAAAz6+gj9AgIM2Bsb0QoKCujn5+f+AgAAAAAAAAAA/wAABwAAAIkAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAD9AQEA1hUV9MwZGccAAAD2AAAAAAAAAAAAAAAAAAAAAAAAAAABAAABR97eNhb390ceHh4RAAAAAAAAAAAAAAAAAP8AAG//AAD+/wAA//8AAP//AAD//wAA//8AAP//AAD//gAA/u4ICPvzBQXw/gAA/P8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP/CHR3SVVBQNgAAAAACAAAAAP8AAAgAAABfAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAER+PgEDPv7DwEAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMOnpJyHy8icAAAAABAAAAAABAAD42BMTgdUTE2buCwsz/QICCQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8BAAD/AAEBAf8AAAEAAAAAAAAAAAAAAAAAAAAAAAAAAPEHB/vhEBANAAAAAAQAAAAAAAAAAHU6OrsDAwPnAgICIQEBAQUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQH//f39zgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAs0IPw6I24JoAAAAASUVORK5CYII=").attr("pointer-events",
"all").style("cursor","pointer").on("mouseover",function(){$("#wgcnaMouseHelp").html("Warning: Modules displayed are truncated to the top 150 most connected modules due to the size of the meta module.")}).on("mouseout",function(){$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")})}else a.maxNodeR=28;a.topG=a.svg.append("g").attr("class","svg-pan-zoom_viewport");b=a.topG.selectAll(".mod").data(a.data,a.modKey);b.enter().append("circle").attr("class",
"mod").attr("id",function(a){return"mod_"+that.removeInvalidIDChars(a.MODULE)}).attr("cx",a.nodeX).attr("cy",a.nodeY).attr("r",3).attr("stroke","#000000").attr("fill","#FF0000").merge(b);b=a.metaData.LINKS;c=[];for(var e=0,f=0;f<b.length;f++)a.CorCutoff_min<=Math.abs(b[f].COR)&&Math.abs(b[f].COR)<=a.CorCutoff_max&&(0===a.truncated||"undefined"!==typeof a.dataIndex[b[f].MOD1]&&"undefined"!==typeof a.dataIndex[b[f].MOD2])&&(c[e]=b[f],e++);b=c;a.showLinks&&1E4>b.length&&(b=a.topG.selectAll(".link").data(b,
a.mlinkKey),b.enter().append("line").attr("class","link").attr("id",function(a){return"ln_"+that.removeInvalidIDChars(a.MOD1)+that.removeInvalidIDChars(a.MOD2)}).attr("x1",function(a){return d3.select("#mod_"+that.removeInvalidIDChars(a.MOD1)).attr("cx")}).attr("y1",function(a){return d3.select("#mod_"+that.removeInvalidIDChars(a.MOD1)).attr("cy")}).attr("x2",function(a){return d3.select("#mod_"+that.removeInvalidIDChars(a.MOD2)).attr("cx")}).attr("y2",function(a){return d3.select("#mod_"+that.removeInvalidIDChars(a.MOD2)).attr("cy")}).attr("stroke",
a.colorLink).attr("stroke-width",function(b){return Math.abs(b.COR)*a.maxCorWidth}).merge(b));a.topG.selectAll(".mod").remove();b=a.topG.selectAll(".mod").data(a.data,a.geneKey);b.enter().append("g").append("circle").attr("cx",a.nodeX).attr("cy",a.nodeY).attr("r",20).attr("stroke","#000000").attr("fill",a.colorCircle).attr("class",function(a){return"mod "+that.removeInvalidIDChars(a.MODULE)}).attr("id",function(a){return"mod_"+that.removeInvalidIDChars(a.MODULE)}).on("click",function(b){console.log("request"+
b.MODULE);that.moduleGenes[b.MODULE]||(that.moduleGenes[b.MODULE]="",that.requestModule(b.MODULE,a.selectMetaMod))}).on("mouseover",a.mouseoverModule).on("mouseout",a.mouseleaveModule).merge(b).each(function(b,c){d3.select(this.parentNode).append("g").attr("class","label").attr("id",function(a){return"txt_"+that.removeInvalidIDChars(a.MODULE)}).attr("transform",function(){var d=a.nodeXLbl(b,c),e=a.nodeYLbl(b,c);return"translate("+d+","+e+")"}).append("text").attr("transform",function(){var b=-90+
c%a.maxPerLevel*a.angleDeg;90<b&&(b-=180);return"rotate("+b+")"}).text(function(){return b.MODULE})});b.exit().remove()},250)};a.requestMeta=function(){$.ajax({url:pathPrefix+"getWGCNAMetaModules.jsp",type:"GET",async:!0,data:{source:that.selSource,id:replaceUnderscore(that.selectedModule.MOD_NAME),organism:organism,panel:that.panel,tissue:that.tissue,region:that.region,geneList:that.geneList,genomeVer:genomeVer},dataType:"json",success:function(b){setTimeout(function(){a.metaData=b[0];a.draw()},
50)},error:function(b,c,e){setTimeout(function(){a.requestMeta()},2E3)}})};a.mouseoverModule=function(){$("#wgcnaMouseHelp").html("<B>Click</B> to select this module and see additional details.");d3.select(this).style("fill","url(#selectGrad)");tt.transition().duration(200).style("opacity",1);tt.html(a.createToolTip(d3.select(this).datum())).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",function(){return that.positionTTTop(d3.event.pageY)});var b=d3.select(this.parentNode).datum();
$("[id^=ln_"+that.removeInvalidIDChars(b.MODULE)+"]").each(function(){var b=$(this).attr("id");d3.select("line#"+b).attr("stroke",a.colorLinkHighlight)});$("[id$="+that.removeInvalidIDChars(b.MODULE)+"]").each(function(){var b=$(this).attr("id");d3.select("line#"+b).attr("stroke",a.colorLinkHighlight)});a.showLinks||a.drawLinks(b);d3.select("#txt_"+that.removeInvalidIDChars(b.MODULE)).select("text").attr("fill","#00A347");ga&&ga("send","event","wgcna","mouseOverModule")};a.mouseleaveModule=function(){var b=
d3.select(this.parentNode).datum();$("[id^=ln_"+that.removeInvalidIDChars(b.MODULE)+"]").each(function(){var b=$(this).attr("id");d3.select("line#"+b).attr("stroke",a.colorLink)});$("[id$="+that.removeInvalidIDChars(b.MODULE)+"]").each(function(){var b=$(this).attr("id");d3.select("line#"+b).attr("stroke",a.colorLink)});d3.select(this).style("fill",a.colorCircle);d3.select("#txt_"+that.removeInvalidIDChars(b.MODULE)).select("text").attr("fill","#000000");tt.transition().duration(500).style("opacity",
0);a.showLinks||a.svg.selectAll(".link").remove();"mir"===that.viewType&&(a.mirTargetID=$("#mirGeneFilterTxt").val().toLowerCase(),a.svg.selectAll(".mirLink").remove(),that.singleImage.drawMiR())};a.createToolTip=function(a){return"Module: "+a.MODULE};return a};that.singleWGCNATableMetaView=function(){$("div#wgcnaModuleTable").hide();$("div#wgcnaMirTable").hide();$("div#wgcnaMirGeneTable").hide();$("div#wgcnaGoTable").hide();$("div#wgcnaEqtlTable").hide()};return that};