$.cookie.defaults.expires=365;var svgList=[],svgViewIDList=[],processAjax=0,ajaxList=[],trackInfo=[],selectedGeneSymbol="",selectedID="",trackSettings=[],overSelectable=0,zoomUpdateHandle=Math.NaN,ratOnly=[],mouseOnly=[],history=[[],[]],customTrackCount=0,testChrome=/chrom(e|ium)/.test(navigator.userAgent.toLowerCase()),testSafari=/safari/.test(navigator.userAgent.toLowerCase()),testFireFox=/firefox/.test(navigator.userAgent.toLowerCase()),testIE=/(wow|.net|ie)/.test(navigator.userAgent.toLowerCase());
testChrome&&testSafari&&(testSafari=!1);!testIE||testChrome||testFireFox||testSafari||$("#IEproblem").show();ratOnly.snpSHRJ=1;ratOnly.snpF344=1;ratOnly.snpSHRH=1;ratOnly.snpBNLX=1;ratOnly.helicos=1;ratOnly.spliceJnct=1;ratOnly.illuminaTotal=1;ratOnly.illuminaSmall=1;ratOnly.illuminaPolyA=1;ratOnly.liverTotal=1;ratOnly.liverspliceJnct=1;ratOnly.liverilluminaTotalPlus=1;ratOnly.liverilluminaTotalMinus=1;ratOnly.polyASite=1;ratOnly.braincoding=1;ratOnly.brainnoncoding=1;ratOnly.brainsmallnc=1;
ratOnly.heartTotal=1;ratOnly.kidneyTotal=1;ratOnly.heartilluminaTotalPlus=1;ratOnly.heartilluminaTotalMinus=1;ratOnly.probe=1;ratOnly.mergedTotal=1;"rn5"===genomeVer&&(mouseOnly.brainTotal=1);mouseOnly.brainilluminaTotalPlus=1;mouseOnly.brainilluminaTotalMinus=1;mouseOnly.brainspliceJnct=1;mouseOnly.probeMouse=1;
var mmVer='Mouse(<span id="verSelect"></span>) Strain:C57BL/6J',rnVer='Rat(<span id="verSelect"></span>) Strain:BN',siteVer="PhenoGen v3.8.0(9/21/2022)",trackBinCutoff=1E4,customTrackLevel=-1,mouseTTOver=0,ttHideHandle=0,tt=d3.select("body").append("div").attr("class","testToolTip").style("z-index",1001).style("opacity",0);tt.append("span").style("float","right").append("img").attr("src","web/images/icons/close.png").on("click",function(){tt.style("opacity",0)});
var tsDialog=d3.select("body").append("div").attr("class","trackSetting").attr("id","trackSettingDialog").style("z-index",1001).style("margin-left","15px").style("margin-right","15px");tsDialog.append("div").attr("id","trackSettingContent").append("table").attr("cellpadding","0").attr("cellspacing","0").append("tbody");
function updatePage(p){var m=Math.round(p.xScale.domain()[0]),r=Math.round(p.xScale.domain()[1]);if((m<p.prevMinCoord||r>p.prevMaxCoord)&&(m<p.dataMinCoord||r>p.dataMaxCoord)){processAjax=1;var t=m;var f=r;m>=p.dataMinCoord&&r>p.dataMaxCoord?t=p.dataMaxCoord+1:m<p.dataMinCoord&&r<=p.dataMaxCoord&&(f=p.dataMinCoord-1);p.setLoading();$.ajax({url:pathPrefix+"updateRegion.jsp",type:"GET",data:{chromosome:chr,minCoord:t,maxCoord:f,fullminCoord:m,fullmaxCoord:r,panel,rnaDatasetID,arrayTypeID,myOrganism:organism,
genomeVer},dataType:"json",success:function(b){p.prevMinCoord=m;p.prevMaxCoord=r;m<p.dataMinCoord&&(p.dataMinCoord=m);r>p.dataMaxCoord&&(p.dataMaxCoord=r);p.folderName=b.folderName;p.updateData();processAjax=0;gtag("event","outsideLoadedRegion",{event_category:"updatePage"})},error:function(b,a,d){console.log(d)}})}}
function back(p){if(history&&history[p]){var m=1<history[p].length?history[p].pop():history[p][0];chr==m.chr&&(m.start==svgList[p].xScale.domain()[0]&&m.stop==svgList[p].xScale.domain()[1]&&(m=1<history[p].length?history[p].pop():history[p][0]),0==p&&$("#geneTxt").val(m.chr+":"+m.start+"-"+m.stop),svgList[p].xScale.domain([m.start,m.stop]),svgList[p].scaleSVG.select(".x.axis").call(svgList[p].xAxis),svgList[p].redraw(),0===p&&updatePage(svgList[p]),svgList[p].updateFullData())}gtag("event","navigateBack",
{event_category:"stepBackSVGNaviation"})}
function zoomIn(p,m){var r={};r.chr=chr;r.start=svgList[p].xScale.domain()[0];r.stop=svgList[p].xScale.domain()[1];m=Math.floor((r.stop-r.start)*m);1>m&&(m=1);r.start+=m;r.stop-=m;20>r.stop-r.start&&(r.start-=m,r.stop+=m);svgList[p].xScale.domain([r.start,r.stop]);history[p]||(history[p]=[]);history[p].push(r);svgList[p].scaleSVG.select(".x.axis").call(svgList[p].xAxis);svgList[p].redraw();isNaN(zoomUpdateHandle)||(clearTimeout(zoomUpdateHandle),zoomUpdateHandle=Math.NaN);zoomUpdateHandle=setTimeout(function(){0===
p&&updatePage(svgList[p]);svgList[p].updateFullData();0===p&&setTimeout(function(){DisplayRegionReport()},100)},300);0===p&&$("#geneTxt").val(chr+":"+r.start+"-"+r.stop);gtag("event",p,{event_category:"calledZoomIn"})}
function zoomOut(p,m){var r={};r.chr=chr;r.start=svgList[p].xScale.domain()[0];r.stop=svgList[p].xScale.domain()[1];m=Math.floor((r.stop-r.start)*m);1>m&&(m=1);r.start-=m;r.stop+=m;svgList[p].xScale.domain([r.start,r.stop]);history[p]||(history[p]=[]);history[p].push(r);svgList[p].scaleSVG.select(".x.axis").call(svgList[p].xAxis);svgList[p].redraw();isNaN(zoomUpdateHandle)||(clearTimeout(zoomUpdateHandle),zoomUpdateHandle=Math.NaN);zoomUpdateHandle=setTimeout(function(){0===p&&updatePage(svgList[p]);
svgList[p].updateFullData();0===p&&setTimeout(function(){DisplayRegionReport()},100)},300);0===p&&$("#geneTxt").val(chr+":"+r.start+"-"+r.stop);gtag("event",p,{event_category:"calledZoomOut"})}
function mup(){var p=0;for(p=0;p<svgList.length;p++)if(svgList[p]&&"undefined"!==typeof svgList[p])if(history[p]||0!=p&&1!=p||(history[p]=[]),!(svgList[p].overSettings&&0!=svgList[p].overSettings||isNaN(svgList[p].downx)&&isNaN(svgList[p].downPanx))){if(0===p&&updatePage(svgList[p]),svgList[p].downx=Math.NaN,svgList[p].downPanx=Math.NaN,svgList[p].updateFullData(),0===p&&setTimeout(function(){DisplayRegionReport()},300),0==p||1==p){var m={};m.chr=chr;m.start=svgList[p].xScale.domain()[0];m.stop=svgList[p].xScale.domain()[1];
history[p].push(m)}}else if(!(svgList[p].overSettings&&0!=svgList[p].overSettings||isNaN(svgList[p].downZoomx))){var r=svgList[p].downZoomx;var t=d3.mouse(svgList[p].vis.node());svgList[p].downZoomxEnd=t[0];m=1;t[0]<r?(r=t[0],m=svgList[p].downZoomx-r):m=t[0]-r;t=Math.round(svgList[p].xScale.invert(r));r=Math.round(svgList[p].xScale.invert(r+m));svgList[p].downZoomx=Math.NaN;svgList[p].downZoomxEnd=Math.NaN;0===p&&$("#geneTxt").val(chr+":"+t+"-"+r);d3.select("#Level"+svgList[p].levelNumber).selectAll("svg rect.zoomRect").remove();
d3.select("#Level"+svgList[p].levelNumber).selectAll("svg text#zoomTextStart").remove();d3.select("#Level"+svgList[p].levelNumber).selectAll("svg text#zoomTextEnd").remove();svgList[p].xScale.domain([t,r]);svgList[p].scaleSVG.select(".x.axis").call(svgList[p].xAxis);svgList[p].redraw();svgList[p].updateFullData();0===p&&setTimeout(function(){DisplayRegionReport()},300);if(0==p||1==p)m={},m.chr=chr,m.start=t,m.stop=r,history[p].push(m)}gtag("event","mouseUpFromDrag",{event_category:"dragMouseUp"})}
function mmove(){var p;for(p=0;p<svgList.length;p++)if(svgList[p]&&(!svgList[p].overSettings||0===svgList[p].overSettings))if(!isNaN(svgList[p].downx)){var m=d3.mouse(svgList[p].vis.node());rupx=m[0];if(0!==rupx){var r=Math.round(svgList[p].downscalex.domain()[0]);var t=Math.round(svgList[p].mw*(svgList[p].downx-svgList[p].downscalex.domain()[0])/rupx+svgList[p].downscalex.domain()[0]);t<=svgList[p].xMax&&r>=svgList[p].xMin&&(0===p&&$("#geneTxt").val(chr+":"+r+"-"+t),svgList[p].xScale.domain([r,t]),
svgList[p].scaleSVG.select(".x.axis").call(svgList[p].xAxis),svgList[p].redraw())}}else if(isNaN(svgList[p].downPanx))isNaN(svgList[p].downZoomx)||(f=svgList[p].downZoomx,m=d3.mouse(svgList[p].vis.node()),svgList[p].downZoomxEnd=m[0],m[0]<f?(f=m[0],m=svgList[p].downZoomx-f):m=m[0]-f,r=Math.round(svgList[p].xScale.invert(f)),t=Math.round(svgList[p].xScale.invert(f+m)),d3.select("#Level"+svgList[p].levelNumber).selectAll("svg rect.zoomRect").attr("x",f).attr("width",m),d3.select("#Level"+svgList[p].levelNumber).selectAll("svg text#zoomTextStart").attr("x",
f).attr("y",15).text(numberWithCommas(r)),d3.select("#Level"+svgList[p].levelNumber).selectAll("svg text#zoomTextEnd").attr("x",f+m).attr("y",50).text(numberWithCommas(t)));else if(m=d3.mouse(svgList[p].vis.node()),rupx=m[0],0!==rupx){t=svgList[p].downPanx-rupx;var f=(svgList[p].downscalex.domain()[1]-svgList[p].downscalex.domain()[0])/svgList[p].mw;r=Math.round(svgList[p].downscalex.domain()[0]+t*f);t=Math.round(t*f+svgList[p].downscalex.domain()[1]);t<=svgList[p].xMax&&r>=svgList[p].xMin&&(0===
p&&$("#geneTxt").val(chr+":"+r+"-"+t),svgList[p].xScale.domain([r,t]),svgList[p].scaleSVG.select(".x.axis").call(svgList[p].xAxis),svgList[p].redraw(),svgList[p].downPanx=m[0])}}d3.select("html").on("mousemove",mmove).on("mouseup",mup);$(window).resize(function(){for(var p=0;p<svgList.length;p++)svgList[p]&&svgList[p].resize($(window).width()-25)});
$(document).on("click",".closeBtn",function(){var p=new String($(this).attr("id"));p=p.substr(6);$("."+p).fadeOut("fast");if(-1<p.indexOf("viewsLevel")){var m=p.substr(p.length-1);$("div#nameView"+m).hide();$("div#selection"+m).show();$("span#viewMenuLbl"+m).html("Select/Edit Views");$("div.trackLevel"+m).fadeOut("fast")}gtag("event",p,{event_category:"closeSettings"});return!1});
$(document).on("click",".viewSelect",function(){var p=$(this).attr("id");p=p.substr(p.length-1);if($(".viewsLevel"+p).is(":visible"))$(".viewsLevel"+p).fadeOut("fast");else{var m=$(this).parent().parent().position().top;$(".viewsLevel"+p).css("top",m).css("left",$(window).width()-610);$(".viewsLevel"+p).fadeIn("fast");$("#trackSettingDialog").hide();tt.transition().duration(200).style("opacity",0);gtag("event",p,{event_category:"openViews"})}return!1});
$(document).on("change","input[name='optioncbx']",function(){var p=new String($(this).attr("id")),m=p.indexOf("CBX"),r=new String(p.substr(0,m));m=p.substr(m+3,1);redrawTrack(m,r);gtag("event",p,{event_category:"changeSettingView"})});$(document).on("change","input[name='imgCBX']",function(){var p=new String($(this).attr("id")),m=p.indexOf("CBX");new String(p.substr(0,m));m=p.substr(m+3,1);svgList[m].redraw();setTimeout(function(){DisplayRegionReport()},300);gtag("event",p,{event_category:"clickCbx"})});
$(document).on("click",".reset",function(){var p=new String($(this).attr("id")),m=p.substr(p.length-1);0===p.indexOf("resetImage")?0===m&&($("#geneTxt").val(chr+":"+initMin+"-"+initMax),svgList[0].xScale.domain([initMin,initMax]),svgList[0].scaleSVG.select(".x.axis").call(svgList[0].xAxis),svgList[0].redraw()):0===p.indexOf("resetTracks")&&(svgList[m].removeAllTracks(),setupDefaultView(m));gtag("event",p,{event_category:"resetImage"})});
function numberWithCommas(p){return p.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}
function displayHelpFirstTime(){if(-1===navigator.userAgent.toLowerCase().indexOf("phantomjs"))if($.cookie("genomeBrowserHelp")){var p=$.cookie("genomeBrowserHelp"),m=p.indexOf("v")+1,r=p.indexOf(".",p.indexOf(".")+1);p=p.substr(m,r-m);m=siteVer.indexOf("v")+1;r=siteVer.indexOf(".",siteVer.indexOf(".")+1);m=siteVer.substr(m,r-m);p!==m&&(setTimeout(function(){$("a#fbhelp1").click()},1E3),$.cookie("genomeBrowserHelp",siteVer))}else setTimeout(function(){$("a#fbhelp1").click()},1E3),$.cookie("genomeBrowserHelp",
siteVer)}function removeTrack(p,m){"undefined"!==typeof svgList[p]&&svgList[p].removeTrack(m);gtag("event",p,{event_category:"removeTrack",event_label:m})}function redrawTrack(p,m){svgList[p].redrawTrack(m);gtag("event",p,{event_category:"redrawTrack",event_label:m})}function changeTrackHeight(p,m){0<m?(m+="px",$("#Scroll"+p).css({"max-height":m,overflow:"auto"})):$("#Scroll"+p).css({"max-height":"",overflow:"hidden"})}registerKeyboardHandler=function(p){d3.select(window).on("keydown",p)};
function getAllChildrenByName(p,m){var r=[],t=0;if("undefined"!==typeof p&&null!==p&&"undefined"!==typeof p.childNodes){p=p.childNodes;for(var f=0;f<p.length;f++)p.item(f).nodeName==m&&(r[t]=p.item(f),t++)}return r}function getFirstChildByName(p,m){var r=null;if(null!==p&&"undefined"!==typeof p&&"undefined"!==typeof p.childNodes){p=p.childNodes;for(var t=!1,f=0;f<p.length&&!t;f++)p.item(f).nodeName==m&&(r=p.item(f),t=!0)}return r}
function getAddMenuDiv(p,m){var r="/"+pathPrefix;""==pathPrefix&&(r="");$.ajax({url:r+"settingsMenu.jsp",type:"GET",cache:!1,data:{level:p,organism,type:m},dataType:"html",success:function(t){$("#imageMenu"+p).remove();d3.select("div#imageMenu").append("div").attr("id","imageMenu"+p);$("#imageMenu"+p).html(t)},error:function(t,f,b){$("#imageMenu"+p).remove();d3.select("div#imageMenu").append("div").attr("id","imageMenu"+p);$("#imageMenu"+p).append('<div class="settingsLevel'+p+'">An error occurred generating this menu.  Please try back later.</div>')},
async:!1})}function loadStateFromString(p,m,r,t){loadSavedConfigTracks(p,r,t);loadImageState(m,r)}
function loadSavedConfigTracks(p,m,r){p=p.split(";");var t=0;r=90>m?svgList[m]:r;for(var f=0;f<p.length;f++){var b=p[f].split(",");if(("Rn"==organism&&"undefined"===typeof mouseOnly[b[0]]||"Mm"==organism&&"undefined"===typeof ratOnly[b[0]])&&""!=b[0]){t++;var a="";if(2<b.length)for(var d=2;d<b.length;d++)a=2==d?b[d]:a+","+b[d];1==m&&(a+=",DrawTrx");r.addTrack(b[0],b[1],a,0)}}0==t&&setupDefaultView(m)}
function loadImageState(p,m){if("undefined"!==typeof p&&""!=p){p=p.split(";");for(var r=0;r<p.length;r++){var t=p[r].split("=");0==(new String(t[0])).indexOf("displaySelect")&&changeTrackHeight("Level"+m,t[1])}}}function calculateBin(p,m){p=new String(Math.floor(p/m));p=p.substr(0,1)*Math.pow(10,p.length-1);p=Math.floor(p/2);5>p&&(p=0);return p}function key(p){return"undefined"!==typeof p?p.getAttribute("ID"):"unknown"}
function keyName(p){return"undefined"!==typeof p?p.getAttribute("name"):"unknown"}function keyStart(p){return"undefined"!==typeof p?p.getAttribute("start"):"unknown"}function keyTissue(p,m){return"undefined"!==typeof p?p.getAttribute("ID")+m:"unknown"}function keyPos(p){return"undefined"!==typeof p?p.pos:"unknown"}function keyID(p){return"undefined"!==typeof p?p.id:"unknown"}function keySNP(p){return"undefined"!==typeof p?p.getAttribute("strain")+"_"+p.getAttribute("start"):"unknown"}
function GenomeSVG(p,m,r,t,f,b,a,d){var c={isToolTip:0,folderName:"",selectedTrackSetting:"",trackListHash:{},overSettings:0,zoomFactor:.05};c.strainSpecificCountColors=d3.scaleOrdinal(d3.schemeCategory20);0==f&&(c.folderName=regionfolderName);var g={};g.chr=chr;g.start=r;g.stop=t;c.allowSelectGenomeVer="undefined"===typeof d?!0:d;if(20>f){history[f]||(history[f]=[]);try{history[f].push(g)}catch(e){Rollbar.error("history["+f+"] not defined")}}c.get=function(e){return c[e]};c.getTrackData=function(e){for(var h=
[],l=0;l<c.trackList.length;l++)"undefined"!==typeof c.trackList[l]&&c.trackList[l].trackClass==e&&(h=c.trackList[l].data);return h};c.getTrack=function(e){return c.trackListHash[e]};c.addTrackErrorRemove=function(e,h){if("undefined"!==typeof e){var l=h.substr(7);e.select(".infoIcon").style("opacity",0);e.select(".settings").style("opacity",0);e.append("g").attr("class","removeErrorTrack").attr("id","remove"+l+c.levelNumber).attr("transform","translate("+(c.width-40)+",0)").append("image").attr("width",
"16px").attr("height","16px").attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAARBJREFUeNpi/P//PwMlgBHZgNNajGCO6bX/jNgUY5UHGQDCpzSB1Jn/YAxmQ8UJyaNKNitAMJoifPJMIFecvA4ktitCnPT7DwPDJlkG08X/wU4GYRAbJAaWY4CoBetBDoMpjIz/c4rlIKI/v0HohNcQeoEohGbngqjtfcSQ8x8SDiiBCDYkAar41zfUEGSDal7wGq4ZwwC4IT48WKNsypYvKJpBgAVdkbkmkHj3DasBYDk0wIQez+AA+/kPK4YFLNaEBNccC3QhF45kB3IYyBCgGnhiQolnEA3CxhA8mQGCYXwwhqqFpQOwAWBFWDTDEhKGIUjy8KQ6mwG7ZmyGIMtjpAMQjR5V+OQZKc3OAAEGAInHQgT+/r+xAAAAAElFTkSuQmCC").attr("pointer-events",
"all").style("cursor","pointer").on("click",function(n){d3.select(h).remove();gtag("event",h,{event_category:"removeErrorTrack"})}).on("mouseover",function(){c.overSettings=1;$("#mouseHelp").html("");gtag("event",h,{event_category:"mouseHelp"})}).on("mouseout",function(){c.overSettings=0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");gtag("event",h,{event_category:"hideMouseHelp"})})}};c.addTrack=function(e,h,l,n){"Trx"==c.forceDrawAsValue&&-1==
(new String(l)).indexOf("DrawTrx")&&(l=","===l.substr(l.length-1)?l+"DrawTrx,":l+",DrawTrx,");var q=new String(c.folderName);if(0>q.indexOf(chr)||0>q.indexOf(c.xScale.domain()[0]+"_")||0>q.indexOf("_"+c.xScale.domain()[1]))c.folderName="/"+chr+"/"+c.xScale.domain()[0]+"_"+c.xScale.domain()[1],0==c.levelNumber&&regionfolderName!=c.folderName&&(regionfolderName=c.folderName),$.ajax({url:pathPrefix+"getFullPath.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:c.xScale.domain()[0],maxCoord:c.xScale.domain()[1],
panel,rnaDatasetID,arrayTypeID,myOrganism:organism,genomeVer},dataType:"json",success:function(z){},error:function(z,D,A){console.log(A)}});q=null;q=d3.select("#Level"+c.levelNumber+e).nodes();if(0===q.length||null==q){q=c.topLevel.append("li").attr("class","draggable"+c.levelNumber).attr("id","li"+e).style("margin-bottom","-3px").append("svg").attr("width",c.width).attr("height",30).attr("class","track").attr("id","Level"+c.levelNumber+e).style("cursor","move").on("mouseover",function(){0===overSelectable&&
("dragzoom"===c.defaultMouseFunct?$("#mouseHelp").html("<B>Zoom:</B> Click and drag to select a region to zoom in. <B>Navigate or Reorder Tracks:</B> Select the appropriate function at the top left of the image."):"pan"===c.defaultMouseFunct?$("#mouseHelp").html("<B>Navigate:</B> Move along Genome by clicking and dragging in desired direction. <B>Zoom or Reorder Tracks:</B> Select the appropriate function at the top left of the image."):"reorder"===c.defaultMouseFunct&&$("#mouseHelp").html("<B>Reorder Tracks:</B> Click on the track and drag up or down to desired location. <B>Zoom or Navigate:</B> Select the appropriate function at the top left of the image."));
gtag("event","",{event_category:"mouseOverTrack"})}).on("mouseout",function(){0===overSelectable&&$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mousemove",function(){d3.event.shiftKey?c.changeTrackCursor("ns-resize"):d3.event.altKey&&"dragzoom"!==c.defaultMouseFunct?c.changeTrackCursor("crosshair"):d3.event.altKey&&"dragzoom"===c.defaultMouseFunct?c.changeTrackCursor("move"):d3.event.altKey||"dragzoom"!==c.defaultMouseFunct?d3.event.altKey||
"dragzoom"===c.defaultMouseFunct||c.changeTrackCursor("move"):c.changeTrackCursor("crosshair")});var u=new String("Loading...");q.append("text").text(u).attr("x",c.width/2-u.length/2*7.5).attr("y",12).attr("id","trkLbl");u=q.append("g").attr("class","infoIcon").attr("transform","translate("+(c.width-20)+",0)").style("cursor","pointer").attr("track",e).attr("title",e).on("mouseover",function(){var z=$(this).attr("track"),D=trackInfo[z];z=$(this).tooltipster({position:"top-right",maxWidth:250,offsetX:24,
offsetY:5,contentAsHTML:!0,interactive:!0,interactiveTolerance:350});z.tooltipster("content",function(){var A="";"undefined"!==typeof D&&"undefined"!==typeof D.Description&&(A=D.Description);return A});z.tooltipster("show");gtag("event",e,{event_category:"trackInfo"})}).on("mouseout",function(){$(this).tooltipster("hide")});u.append("rect").attr("x",0).attr("y",0).attr("rx",3).attr("ry",3).attr("height",14).attr("width",14).attr("fill","#A7C5E2").attr("stroke","#7795B2");u.append("text").attr("x",
2.5).attr("y",12).attr("style","font-family:monospace;font-weight:bold;").attr("fill","#FFFFFF").text("i");q.append("g").attr("class","settings").attr("id",e+"_"+c.levelNumber).attr("transform","translate("+(c.width-40)+",0)").append("image").attr("width","16px").attr("height","16px").attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAAAJdnBBZwAAABAAAAAQAFzGrcMAAAGASURBVCjPlZGxaxNhAMV/9128JF/uLsndaVoPhEopFW2RGAXpKOpQHNwEHXTVf0Chm6OL4OhccFHoYKGFQgMOLoIUEQfBSZCUBtI2yaVt8hwarI6+5cF7v+HBg/+RH1U3q2/+zdxjK0znO0EhWgru20t2J/fZnXInjrYBHAD/ut30OkW3FBURfXrtLDroduf2f4ABaARlLzkdRwFFLCFxFBMdPezDGLj5PT/yMChLNqLm6MDFI2eSvT9Dzj2/qLqu7q4+0mXVlx83BnVdUPrC9wEor6Sa0awW38oCKLy1NqsZpap8AgP5BTgk41fP6QE4u60s4xCwCQArDxofUk2q1i5NAJSmantnlWphvXkXABXf3U6GsSrytwsvC6+CTlWxat2v1+SNR96ZLA9ChSrJyspXqFDlwfkUIAfwcbrvGRwEwAgzEjLDlJ9joPXl6VK639h5cm9rEebfv14emOaZZ9+ck0uUKJTXnretfHvrik7JU+W4+QsCOdzAsOEMT7LfaTGJVMIWBCwAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTAtMDItMTFUMDA6NTM6MDItMDY6MDDZzrlFAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDA5LTA4LTE4VDAyOjI2OjEwLTA1OjAw2ytpkgAAAABJRU5ErkJggg==").attr("pointer-events",
"all").style("cursor","pointer").on("click",function(z){e!=c.selectedTrackSetting?(c.getTrack(e).generateSettingsDiv("div#trackSettingContent"),c.selectedTrackSetting=e,z=$(this).position(),$("#trackSettingDialog").css("top",z.top).css("left",$(window).width()-380),$("#trackSettingDialog").fadeIn("fast")):(c.selectedTrackSetting="",$("#trackSettingDialog").fadeOut("fast"));gtag("event","click",{event_category:"trackSettings"});return!1}).on("mouseover",function(){c.overSettings=1;$("#mouseHelp").html("Track Settings: Click to access track settings or quickly remove the track from the current view.")}).on("mouseout",
function(){c.overSettings=0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")})}if("genomeSeq"==e)q=SequenceTrack(c,e,"Reference Genomic Sequence",l),c.addTrackList(q);else if(-1<e.indexOf("noncoding"))d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/"+e+".xml",function(z,D){if(z)if(60>n){var A=1500;1==n&&(A=2500);setTimeout(function(){c.addTrack(e,h,l,n+1)},A)}else d3.select("#Level"+c.levelNumber+e).select("#trkLbl").text("An errror occurred loading Track:"+
e),d3.select("#Level"+c.levelNumber+e).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+e),"#Level"+c.levelNumber+e);else if(null==D)11<=n?(z=[],A=GeneTrack(c,z,e,"Long Non-Coding / Non-PolyA+ Genes",l),c.addTrackList(A)):setTimeout(function(){c.addTrack(e,h,l,10)},5E3);else{z=D.documentElement.getElementsByTagName("Gene");var F=0;D=D.documentElement.getElementsByTagName("GeneList");0<D.length&&"undefined"!==typeof D[0].getAttribute("ver")&&(F=D[0].getAttribute("ver"));try{A=
GeneTrack(c,z,e,"Long Non-Coding / Non-PolyA+ Genes",l),A.dataVer=F,c.addTrackList(A)}catch(H){}}});else if(-1<e.indexOf("coding"))d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/"+e+".xml",function(z,D){if(z)if(60>n){var A=1500;1==n&&(A=2500);setTimeout(function(){c.addTrack(e,h,l,n+1)},A)}else d3.select("#Level"+c.levelNumber+e).select("#trkLbl").text("An errror occurred loading Track:"+e),d3.select("#Level"+c.levelNumber+e).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+
c.levelNumber+e),"#Level"+c.levelNumber+e);else if(null==D)11<=n?(z=[],A=GeneTrack(c,z,e,"Protein Coding / PolyA+",l),c.addTrackList(A)):setTimeout(function(){c.addTrack(e,h,l,11)},5E3);else{z=D.documentElement.getElementsByTagName("Gene");var F=0;D=D.documentElement.getElementsByTagName("GeneList");0<D.length&&"undefined"!==typeof D[0].getAttribute("ver")&&(F=D[0].getAttribute("ver"));try{A=GeneTrack(c,z,e,"Protein Coding / PolyA+",l),A.dataVer=F,c.addTrackList(A)}catch(H){console.log(H)}}});else if(-1<
e.indexOf("smallnc"))d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/"+e+".xml",function(z,D){if(z){if(0===n){var A=c.xScale.domain()[0];z=c.xScale.domain()[1];D="/"+pathPrefix;pathPrefix||(D="");$.ajax({url:D+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:A,maxCoord:z,panel,rnaDatasetID,arrayTypeID,myOrganism:organism,genomeVer,track:e,folder:c.folderName},dataType:"json",success:function(F){gtag("event","generateTrack"+e,{event_category:"browser"})},
error:function(F,H,I){}})}60>n?(A=1500,1==n&&(A=2500),setTimeout(function(){c.addTrack(e,h,l,n+1)},A)):(d3.select("#Level"+c.levelNumber+e).select("#trkLbl").text("An errror occurred loading Track:"+e),d3.select("#Level"+c.levelNumber+e).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+e),"#Level"+c.levelNumber+e))}else if(null==D)11<=n?(z=[],A=GeneTrack(c,z,e,"Small RNA (<200 bp) Genes",l),c.addTrackList(A)):setTimeout(function(){c.addTrack(e,h,l,11)},5E3);else{z="rn5"===
genomeVer?D.documentElement.getElementsByTagName("smnc"):D.documentElement.getElementsByTagName("Gene");try{A=GeneTrack(c,z,e,"Small RNA (<200 bp) Genes",l),c.addTrackList(A),""!=selectGene&&A.setSelected(selectGene)}catch(F){}}});else if(0===e.indexOf("liverTotal")||"heartTotal"===e||0===e.indexOf("brainTotal")||"mergedTotal"===e||0===e.indexOf("kidneyTotal")){var v="Liver Reconstructed";"heartTotal"===e?v="Heart Reconstructed":"brainTotal"===e?v="Whole Brain Reconstructed":"mergedTotal"===e?v="Merged (Brain,Heart,Liver,Kidney) Reconstructed":
"kidneyTotal"===e&&(v="Kidney Reconstructed");if((0===e.indexOf("liverTotal")||0===e.indexOf("brainTotal"))&&0<e.indexOf("_")){var y=e.substr(e.indexOf("_")+1);v="LEStm"===y?"LE-Stm "+v:"F344Stm"===y?"F344-Stm "+v:v+" v"+y}d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/"+e+".xml",function(z,D){if(z){if(1===n&&("mergedTotal"===e||0===e.indexOf("liverTotal")||0===e.indexOf("brainTotal")||0===e.indexOf("kidneyTotal"))){var A=c.xScale.domain()[0];D=c.xScale.domain()[1];
z="/"+pathPrefix;pathPrefix||(z="");var F=panel;(0===e.indexOf("liverTotal")||0===e.indexOf("brainTotal"))&&0<e.indexOf("_")&&(F=e.substr(e.indexOf("_")+1),"LEStm"===F&&(F="LE-Stm"),"F344Stm"===F&&(F="F344-Stm"));$.ajax({url:z+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:A,maxCoord:D,panel:F,rnaDatasetID,arrayTypeID,myOrganism:organism,genomeVer,track:e,folder:c.folderName},dataType:"json",success:function(H){gtag("event","generateTrack"+e,{event_category:"browser"})},
error:function(H,I,J){}})}60>n?(A=1500,1==n&&(A=2500),setTimeout(function(){c.addTrack(e,h,l,n+1)},A)):(d3.select("#Level"+c.levelNumber+e).select("#trkLbl").text("An error occurred loading Track:"+e),d3.select("#Level"+c.levelNumber+e).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+e),"#Level"+c.levelNumber+e))}else if(null==D)11<=n?(z=[],A=GeneTrack(c,z,e,v,l),c.addTrackList(A)):setTimeout(function(){c.addTrack(e,h,l,11)},5E3);else{z=D.documentElement.getElementsByTagName("Gene");
F=0;D=D.documentElement.getElementsByTagName("GeneList");0<D.length&&"undefined"!==typeof D[0].getAttribute("ver")&&(F=D[0].getAttribute("ver"));try{A=GeneTrack(c,z,e,v,l),A.dataVer=F,c.addTrackList(A),""!=selectGene&&A.setSelected(selectGene)}catch(H){}}})}else if(0===e.indexOf("refSeq")){$("#"+e+c.levelNumber+"Select").val();var w=c.xScale.domain()[0],C=c.xScale.domain()[1];q=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/"+e+".xml";d3.xml(q,function(z,D){if(z){console.log(z);
if(0===n){var A="/"+pathPrefix;pathPrefix||(A="");$.ajax({url:A+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:w,maxCoord:C,panel,rnaDatasetID,arrayTypeID,myOrganism:organism,genomeVer,track:e,folder:c.folderName},dataType:"json",success:function(F){gtag("event","generateTrack"+e,{event_category:"browser"})},error:function(F,H,I){}})}60>n?(A=1500,1===n&&(A=2500),setTimeout(function(){c.addTrack(e,h,l,n+1)},A)):(d3.select("#Level"+c.levelNumber+e).select("#trkLbl").text("An errror occurred loading Track:"+
e),d3.select("#Level"+c.levelNumber+e).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+e),"#Level"+c.levelNumber+e))}else if(null==D)11<=n?(z=[],A=RefSeqTrack(c,z,e,"Ref Seq Genes",l),c.addTrackList(A)):setTimeout(function(){c.addTrack(e,h,l,11)},5E3);else{z=D.documentElement.getElementsByTagName("Gene");try{A=RefSeqTrack(c,z,e,"Ref Seq Genes",l),c.addTrackList(A)}catch(F){console.log(F)}}})}else if(0==e.indexOf("snp"))w=c.xScale.domain()[0],C=c.xScale.domain()[1],q=dataPrefix+
"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/"+e+".xml",d3.xml(q,function(z,D){if(z){console.log(z);if(0==n){var A="/"+pathPrefix;pathPrefix||(A="");$.ajax({url:A+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:w,maxCoord:C,panel,rnaDatasetID,arrayTypeID,myOrganism:organism,genomeVer,track:e,folder:c.folderName},dataType:"json",success:function(F){gtag("event","generateTrack"+e,{event_category:"browser"})},error:function(F,H,I){}})}60>n?(A=1500,
1===n&&(A=2500),setTimeout(function(){c.addTrack(e,h,l,n+1)},A)):(d3.select("#Level"+c.levelNumber+e).select("#trkLbl").text("An errror occurred loading Track:"+e),d3.select("#Level"+c.levelNumber+e).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+e),"#Level"+c.levelNumber+e))}else if(null==D)11<=n?(z=[],A=SNPTrack(c,z,e,h,l),c.addTrackList(A)):setTimeout(function(){c.addTrack(e,h,l,11)},5E3);else{z=D.documentElement.getElementsByTagName("Snp");try{A=SNPTrack(c,z,e,h,l),c.addTrackList(A)}catch(F){}}});
else if("qtl"===e)d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/qtl.xml",function(z,D){if(z)if(60>n){var A=1500;1===n&&(A=2500);setTimeout(function(){c.addTrack(e,h,l,n+1)},A)}else d3.select("#Level"+c.levelNumber+e).select("#trkLbl").text("An errror occurred loading Track:"+e),d3.select("#Level"+c.levelNumber+e).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+e),"#Level"+c.levelNumber+e);else if(null==D)11<=n?(z=[],A=QTLTrack(c,z,e,h),
c.addTrackList(A)):setTimeout(function(){c.addTrack(e,h,l,11)},5E3);else{z=D.documentElement.getElementsByTagName("QTL");try{A=QTLTrack(c,z,e,h),c.addTrackList(A)}catch(F){}}});else if("trx"===e)y=getAllChildrenByName(getFirstChildByName(c.selectedData,"TranscriptList"),"Transcript"),q=TranscriptTrack(c,y,e,h),c.addTrackList(q);else if("probe"===e||"probeMouse"==e)d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/probe.xml",function(z,D){if(z)if(60>n){var A=1500;1===
n&&(A=2500);setTimeout(function(){c.addTrack(e,h,l,n+1)},A)}else d3.select("#Level"+c.levelNumber+e).select("#trkLbl").text("An errror occurred loading Track:"+e),d3.select("#Level"+c.levelNumber+e).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+e),"#Level"+c.levelNumber+e);else if(null==D)11<=n?(z=[],A=ProbeTrack(c,z,e,"Affy Exon 1.0 ST Probe Sets",h+","+l),c.addTrackList(A)):setTimeout(function(){c.addTrack(e,h,l,11)},5E3);else{z=D.documentElement.getElementsByTagName("probe");
try{A=ProbeTrack(c,z,e,"Affy Exon 1.0 ST Probe Sets",h+","+l),c.addTrackList(A)}catch(F){}}});else if("helicos"===e||-1<e.indexOf("illuminaTotal")||-1<e.indexOf("illuminaSmall")||"illuminaPolyA"===e){w=c.xScale.domain()[0];C=c.xScale.domain()[1];var B=calculateBin(C-w,c.width);q=[];l&&(0<l.indexOf(",")?q=l.split(","):q[0]=l);y="Total";var E=1;2<q.length&&(g=1*q[1],2===g&&(y="Norm",E=2));q=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/tmp/"+w+"_"+C+".count."+e+"."+y+".xml";
0<B&&(w-=w%B,C+=B-C%B,q=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/tmp/"+w+"_"+C+".bincount."+B+"."+e+"."+y+".xml");d3.xml(q,function(z,D){if(z){if(0===n){var A="/"+pathPrefix;pathPrefix||(A="");tmpPanel=panel;-1<e.indexOf("-")&&(tmpPanel=e.substr(e.indexOf("-")+1));$.ajax({url:A+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:w,maxCoord:C,panel:tmpPanel,rnaDatasetID,arrayTypeID,myOrganism:organism,genomeVer,track:e,folder:c.folderName,
binSize:B,countType:E},dataType:"json",success:function(F){gtag("event","generateTrack"+e,{event_category:"browser"})},error:function(F,H,I){}});A=1E4}60>n?(A=1E3,0===n&&(A=2500),setTimeout(function(){c.addTrack(e,h,l,n+1)},A)):(d3.select("#Level"+c.levelNumber+e).select("#trkLbl").text("An errror occurred loading Track:"+e),d3.select("#Level"+c.levelNumber+e).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+e),"#Level"+c.levelNumber+e))}else if(null==D)z=[],"helicos"==e?A=
HelicosTrack(c,z,e,h):"illuminaTotal"==e?A=IlluminaTotalTrack(c,z,e,h):"illuminaSmall"==e?A=IlluminaSmallTrack(c,z,e,h):"illuminaPolyA"==e?A=IlluminaPolyATrack(c,z,e,h):"liverilluminaTotalPlus"==e?A=LiverIlluminaTotalPlusTrack(c,z,e,h):"liverilluminaTotalMinus"==e?A=LiverIlluminaTotalMinusTrack(c,z,e,h):"heartilluminaTotalPlus"==e?A=HeartIlluminaTotalPlusTrack(c,z,e,h):"heartilluminaTotalMinus"==e?A=HeartIlluminaTotalMinusTrack(c,z,e,h):"brainilluminaTotalPlus"==e?A=BrainIlluminaTotalPlusTrack(c,
z,e,h):"brainilluminaTotalMinus"==e?A=BrainIlluminaTotalMinusTrack(c,z,e,h):"liverilluminaSmall"==e?A=LiverIlluminaSmallTrack(c,z,e,h):"heartilluminaSmall"==e?A=HeartIlluminaSmallTrack(c,z,e,h):-1<e.indexOf("illuminaTotal")&&(A=StrainSpecificIlluminaTotalTrack(c,z,e,h,l)),c.addTrackList(A);else{z=D.documentElement.getElementsByTagName("Count");try{"helicos"===e?A=HelicosTrack(c,z,e,h):"illuminaTotal"===e?A=IlluminaTotalTrack(c,z,e,h):"illuminaSmall"===e?A=IlluminaSmallTrack(c,z,e,h):"illuminaPolyA"===
e?A=IlluminaPolyATrack(c,z,e,h):"liverilluminaTotalPlus"===e?A=LiverIlluminaTotalPlusTrack(c,z,e,h):"liverilluminaTotalMinus"===e?A=LiverIlluminaTotalMinusTrack(c,z,e,h):"heartilluminaTotalPlus"===e?A=HeartIlluminaTotalPlusTrack(c,z,e,h):"heartilluminaTotalMinus"===e?A=HeartIlluminaTotalMinusTrack(c,z,e,h):"brainilluminaTotalPlus"===e?A=BrainIlluminaTotalPlusTrack(c,z,e,h):"brainilluminaTotalMinus"===e?A=BrainIlluminaTotalMinusTrack(c,z,e,h):"liverilluminaSmall"===e?A=LiverIlluminaSmallTrack(c,z,
e,h):"heartilluminaSmall"===e?A=HeartIlluminaSmallTrack(c,z,e,h):-1<e.indexOf("illuminaTotal")&&(A=StrainSpecificIlluminaTotalTrack(c,z,e,h,l)),c.addTrackList(A)}catch(F){}}})}else if(-1<e.indexOf("spliceJnct")){w=c.xScale.domain()[0];C=c.xScale.domain()[1];q=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/"+e+".xml";var G="Brain ";"liverspliceJnct"==e?G="Liver ":"heartspliceJnct"==e&&(G="Heart ");d3.xml(q,function(z,D){if(z){console.log(z);if(0==n){var A="/"+pathPrefix;
pathPrefix||(A="");$.ajax({url:A+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:w,maxCoord:C,panel,rnaDatasetID,arrayTypeID,myOrganism:organism,genomeVer,track:e,folder:c.folderName},dataType:"json",success:function(F){gtag("event","generateTrack"+e,{event_category:"browser"})},error:function(F,H,I){}})}60>n?(A=1500,1===n&&(A=2500),setTimeout(function(){c.addTrack(e,h,l,n+1)},A)):(d3.select("#Level"+c.levelNumber+e).select("#trkLbl").text("An errror occurred loading Track:"+
e),d3.select("#Level"+c.levelNumber+e).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+e),"#Level"+c.levelNumber+e))}else if(null==D)11<=n?(z=[],A=SpliceJunctionTrack(c,z,e,G+"Splice Junctions",1,""),c.addTrackList(A)):setTimeout(function(){c.addTrack(e,h,l,11)},5E3);else{z=D.documentElement.getElementsByTagName("Feature");console.log(z);try{A=SpliceJunctionTrack(c,z,e,G+"Splice Junctions",3,""),c.addTrackList(A)}catch(F){console.log(F)}}})}else if("polyASite"==e)d3.xml(dataPrefix+
"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/polyASite.xml",function(z,D){if(z)if(60>n){var A=1E3;1===n&&(A=2500);setTimeout(function(){c.addTrack(e,h,l,n+1)},A)}else d3.select("#Level"+c.levelNumber+e).select("#trkLbl").text("An errror occurred loading Track:"+e),d3.select("#Level"+c.levelNumber+e).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+e),"#Level"+c.levelNumber+e);else if(null==D)4<=n?(z=[],A=PolyATrack(c,z,e,"Predicted PolyA Sites",l),c.addTrackList(A)):
setTimeout(function(){c.addTrack(e,h,l,4)},5E3);else{z=D.documentElement.getElementsByTagName("Feature");try{A=PolyATrack(c,z,e,"Predicted PolyA Sites",l),c.addTrackList(A)}catch(F){}}});else if(0===e.indexOf("repeatMask"))$("#"+e+c.levelNumber+"Select").val(),w=c.xScale.domain()[0],C=c.xScale.domain()[1],q=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/"+e+".xml",d3.xml(q,function(z,D){if(z){console.log(z);if(0===n){var A="/"+pathPrefix;pathPrefix||(A="");$.ajax({url:A+
"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:w,maxCoord:C,panel,rnaDatasetID,arrayTypeID,myOrganism:organism,genomeVer,track:e,folder:c.folderName},dataType:"json",success:function(F){gtag("event","generateTrack"+e,{event_category:"browser"})},error:function(F,H,I){}})}60>n?(A=1500,1===n&&(A=2500),setTimeout(function(){c.addTrack(e,h,l,n+1)},A)):(d3.select("#Level"+c.levelNumber+e).select("#trkLbl").text("An errror occurred loading Track:"+e),d3.select("#Level"+
c.levelNumber+e).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+e),"#Level"+c.levelNumber+e))}else if(null==D)11<=n?(z=[],A=RepeatMaskTrack(c,z,e,"Repeat Masker",h,l),c.addTrackList(A)):setTimeout(function(){c.addTrack(e,h,l,11)},5E3);else{z=D.documentElement.getElementsByTagName("Feature");try{A=RepeatMaskTrack(c,z,e,"Repeat Masker",h,l),c.addTrackList(A)}catch(F){console.log(F)}}});else if(0==e.indexOf("custom"))if(q=trackInfo[e],l=l+",Name="+q.Name,l="DataFile="+q.Location+
","+l,"bed"==q.Type||"bb"==q.Type)y=[],q=CustomTranscriptTrack(c,y,e,q.Name,3,l),c.addTrackList(q),q.updateFullData(0,0);else{if("bg"==q.Type||"bw"==q.Type)y=[],q=CustomCountTrack(c,y,e,3,l),c.addTrackList(q)}else 0<=e.indexOf("cirRNA")&&(q=trackInfo[e],q=CircRNATrack(c,y,e,q.Name,3,l),c.addTrackList(q));$(".sortable"+c.levelNumber).sortable("refresh");gtag("event",e,{event_category:"trackAdded"})};c.addTrackList=function(e){null!=e&&(c.trackList[c.trackCount]=e,c.trackCount++,c.trackListHash[e.trackClass]=
e,setTimeout(function(){DisplayRegionReport()},300))};c.updateLinks=function(){1===c.levelNumber&&d3.select("#probeSetDetailLink1").each(function(){var e=new String(d3.select(this).attr("href"));e=e.substr(0,e.lastIndexOf("=")+1);e+=c.currentView.ViewID;d3.select(this).attr("href",e)})};c.changeTrackHeight=function(e,h){0<h?d3.select("#"+e+"Scroll").style("max-height",h+"px").style("overflow","auto"):d3.select("#"+e+"Scroll").style("max-height","none").style("overflow","hidden")};c.removeAllTracks=
function(){d3.selectAll("li.draggable"+c.levelNumber).remove();c.trackList=[];setTimeout(function(){DisplayRegionReport()},300);gtag("event",c.levelNumber,{event_category:"SVGremoveAllTracks"})};c.removeTrack=function(e){d3.select("#Level"+c.levelNumber+e).remove();for(var h=0;h<c.trackList.length;h++)"undefined"!==typeof c.trackList[h]&&c.trackList[h].trackClass==e&&(c.trackList.splice(h,1),c.trackCount--);c.trackListHash[e]=void 0;setTimeout(function(){DisplayRegionReport()},300);gtag("event",c.levelNumber,
{event_category:"removeTrack",event_label:e})};c.redrawTrack=function(e){for(var h=0;h<c.trackList.length;h++)"undefined"!==typeof c.trackList[h]&&c.trackList[h].trackClass==e&&c.trackList[h].redraw();setTimeout(function(){DisplayRegionReport()},300)};c.redraw=function(){for(var e=0;e<c.trackList.length;e++)"undefined"!==typeof c.trackList[e]&&"undefined"!==typeof c.trackList[e].redraw&&c.trackList[e].redraw();c.selectSvg.redraw()};c.update=function(){for(var e=0;e<c.trackList.length;e++)"undefined"!==
typeof c.trackList[e].update&&c.trackList[e].update();setTimeout(function(){DisplayRegionReport()},300);gtag("event","genomeSVG.update",{event_category:"gsvgUpdate"})};c.updateData=function(){for(var e=0;e<c.trackList.length;e++)"undefined"!==typeof c.trackList[e]&&"undefined"!==typeof c.trackList[e].updateData&&c.trackList[e].updateData(0);c.updateFullData();setTimeout(function(){DisplayRegionReport()},300);gtag("event","genomeSVG.updateData",{event_category:"gsvgUpdateData"})};c.updateFullData=
function(){-1<(new String(c.folderName)).indexOf("img")&&(c.folderName="/"+chr+"/"+c.xScale.domain()[0]+"_"+c.xScale.domain()[1],0==c.levelNumber&&regionfolderName!=c.folderName&&(regionfolderName=c.folderName),setTimeout(function(){DisplayRegionReport()},300));for(var e=0;e<c.trackList.length;e++)"undefined"!==typeof c.trackList[e]&&"undefined"!==typeof c.trackList[e].updateFullData&&c.trackList[e].updateFullData(0,1);gtag("event","genomeSVG.updateFullData",{event_category:"gsvgUpdateFullData"})};
c.setLoading=function(){for(var e=0;e<c.trackList.length;e++)"undefined"===typeof c.trackList[e]||"undefined"===typeof c.trackList[e].updateData&&"undefined"===typeof c.trackList[e].updateFullData||c.trackList[e].showLoading()};c.clearSelection=function(){c.selectionStart=-1;c.selectionEnd=-1;c.scaleSVG.selectAll("rect.selectedArea").remove();c.selectSvg.setVis(!1);for(var e=0;e<c.trackList.length;e++)"undefined"!==typeof c.trackList[e]&&"undefined"!==typeof c.trackList[e].clearSelection&&c.trackList[e].clearSelection()};
c.mdown=function(){if(0==c.overSettings)if("dragzoom"!==c.defaultMouseFunct&&d3.event.altKey||"dragzoom"===c.defaultMouseFunct&&!d3.event.altKey){var e=d3.mouse(c.vis.node());c.downZoomx=e[0];c.scaleSVG.append("rect").attr("class","zoomRect").attr("x",e[0]).attr("y",0).attr("height",c.scaleSVG.attr("height")).attr("width",1).attr("fill","#CECECE").attr("opacity",.3);c.scaleSVG.append("text").attr("id","zoomTextStart").attr("x",c.downZoomx).attr("y",15).text(numberWithCommas(Math.round(c.xScale.invert(c.downZoomx))));
c.scaleSVG.append("text").attr("id","zoomTextEnd").attr("x",c.downZoomx).attr("y",50).text(numberWithCommas(Math.round(c.xScale.invert(c.downZoomx))))}else 0==processAjax&&(c.prevMinCoord=c.xScale.domain()[0],c.prevMaxCoord=c.xScale.domain()[1],e=d3.mouse(c.vis.node()),c.downx=c.xScale.invert(e[0]),c.downscalex=c.xScale)};c.forceDrawAs=function(e){for(var h=0;h<c.trackList.length;h++)"undefined"!==typeof c.trackList[h]&&"undefined"!==typeof c.trackList[h].drawAs&&(c.trackList[h].drawAs=e,c.trackList[h].draw(c.trackList[h].data));
c.forceDrawAsValue=e};c.resize=function(e){c.width=e;c.xScale.range([0,c.width]);c.xAxis=d3.axisTop(c.xScale).ticks(6).tickSize(8).tickPadding(10);c.scaleSVG.attr("width",c.width);c.scaleSVG.select(".x.axis").call(c.xAxis);d3.select("#Level"+c.levelNumber).select(".axisLbl").attr("x",(c.width-2*c.margin)/2);c.topLevel.style("width",c.width+18+"px");for(var h=0;h<c.trackList.length;h++)"undefined"!==typeof c.trackList[h]&&"undefined"!==typeof c.trackList[h].redraw&&c.trackList[h].resize();c.selectSvg.width=
e;c.selectSvg.draw()};c.updateCountScales=function(e,h){for(var l=0;l<c.trackList.length;l++)"undefined"!==typeof c.trackList[l]&&"undefined"!==typeof c.trackList[l].updateCountScale&&c.trackList[l].updateCountScale(e,h)};c.resetDefaultMouse=function(e){var h="/web/images/icons/"+e+"_dark.png";d3.select("span#"+e+c.levelNumber+" img").attr("src",h);d3.select("span#"+e+c.levelNumber).style("background","#DCDCDC")};c.changeTrackCursor=function(e){for(var h=0;h<c.trackList.length;h++)"undefined"!==typeof c.trackList[h]&&
"undefined"!==typeof c.trackList[h].svg&&c.trackList[h].svg.style("cursor",e)};c.changeScaleCursor=function(e){"undefined"!==typeof c.scaleSVG&&c.scaleSVG.style("cursor",e)};c.updateTrackSelectedArea=function(e,h){c.selectionStart=e;c.selectionEnd=h;var l=c.xScale(e),n=c.xScale(h)-l;c.scaleSVG.selectAll("rect.selectedArea").remove();if((0<l||0<l+n)&&l<c.width)for(1>n&&(n=1),c.scaleSVG.append("rect").attr("class","selectedArea").attr("x",l).attr("y",15).attr("height",c.scaleSVG.attr("height")-15).attr("width",
n).attr("fill","#CECECE").attr("opacity",.3).attr("pointer-events","none"),l=0;l<c.trackList.length;l++)"undefined"!==typeof c.trackList[l]&&"undefined"!==typeof c.trackList[l].setSelectedArea&&c.trackList[l].setSelectedArea(e,h)};c.getAddMenus=function(){var e="/"+pathPrefix;""==pathPrefix&&(e="");$.ajax({url:e+"trackMenu.jsp",type:"GET",cache:!1,data:{level:c.levelNumber,organism},dataType:"html",success:function(h){$("#trackMenu"+c.levelNumber).remove();d3.select("div#trackMenu").append("div").attr("id",
"trackMenu"+c.levelNumber);$("#trackMenu"+c.levelNumber).html(h)},error:function(h,l,n){$("#trackMenu"+c.levelNumber).remove();d3.select("div#trackMenu").append("div").attr("id","trackMenu"+c.levelNumber);$("#trackMenu"+c.levelNumber).append('<div class="viewsLevel'+c.levelNumber+'">An error occurred generating this menu.  Please try back later.</div>')},async:!1});$.ajax({url:e+"viewMenu.jsp",type:"GET",cache:!1,data:{level:c.levelNumber,organism},dataType:"html",success:function(h){$("#viewMenu"+
c.levelNumber).remove();d3.select("div#viewMenu").append("div").attr("id","viewMenu"+c.levelNumber);$("#viewMenu"+c.levelNumber).html(h)},error:function(h,l,n){$("#viewMenu"+c.levelNumber).remove();d3.select("div#viewMenu").append("div").attr("id","viewMenu"+c.levelNumber);$("#viewMenu"+c.levelNumber).append('<div class="viewsLevel'+c.levelNumber+'">An error occurred generating this menu.  Please try back later.</div>')},async:!1})};c.zoomMenuChange=function(e){d3.select("#zoomSelectMenu"+c.levelNumber).selectAll("li").style("background",
"#FFFFFF");c.zoomFactor=parseFloat(d3.select(e).attr("value"));d3.select(e).style("background","#CECECE")};c.setupFunctionBar=function(){d3.selectAll("span.shrt-button").on("click",function(){nameSpan=d3.select(this).attr("name");-1<nameSpan.toLowerCase().indexOf("gene")?(console.log(":"+selectedID+":"),""!==selectedID?($("div#selectedDetail").is(":visible")||0!==selectedID.indexOf("ENS")||c.getTrack("ensemblcoding").setSelected(selectedID),$("span[name='"+nameSpan+"']").click(),$("html, body").animate({scrollTop:$("#selectedReport").offset().top},
1E3)):alert("You must select a gene from an Ensembl Track before clicking on the gene shortcut.")):($("span.closeDetail").click(),$("span#"+nameSpan).click(),$("html, body").animate({scrollTop:$("#regionDiv").offset().top},1E3))});d3.select(p).select("#functLevel"+c.levelNumber).remove();c.functionBar=c.vis.append("div").attr("class","functionBar").attr("id","functLevel"+c.levelNumber).style("float","left");var e=c.functionBar.append("div").attr("class","defaultMouse").attr("id","defaultMouse"+c.levelNumber);
e.append("span").attr("id","dragzoom"+c.levelNumber).style("height","24px").style("display","inline-block").style("cursor","pointer").append("img").attr("class","mouseOpt dragzoom").attr("src","/web/images/icons/dragzoom_dark.png").attr("pointer-events","all").on("click",function(){c.resetDefaultMouse(c.defaultMouseFunct);c.defaultMouseFunct="dragzoom";d3.select(this).attr("src","/web/images/icons/dragzoom_white.png");d3.select("span#dragzoom"+c.levelNumber).style("background","#989898");c.changeTrackCursor("crosshair");
c.changeScaleCursor("crosshair");gtag("event","",{event_category:"clickDragZoom"})}).on("mouseout",function(){"dragzoom"!=c.defaultMouseFunct&&(d3.select(this).attr("src","/web/images/icons/dragzoom_dark.png"),d3.select("span#dragzoom"+c.levelNumber).style("background","#DCDCDC"))}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/dragzoom_white.png");d3.select("span#dragzoom"+c.levelNumber).style("background","#989898");$("#mouseHelp").html("Click to set default mouse function to allow click and drag to select a region to zoom in on.")});
e.append("span").attr("id","pan"+c.levelNumber).style("height","24px").style("display","inline-block").style("cursor","pointer").append("img").attr("class","mouseOpt pan").attr("src","/web/images/icons/pan_dark.png").attr("pointer-events","all").on("click",function(){c.resetDefaultMouse(c.defaultMouseFunct);c.defaultMouseFunct="pan";d3.select(this).attr("src","/web/images/icons/pan_white.png");d3.select("span#pan"+c.levelNumber).style("background","#989898");c.changeTrackCursor("move");c.changeScaleCursor("ew-resize");
gtag("event","",{event_category:"clickPan"})}).on("mouseout",function(){"pan"!=c.defaultMouseFunct&&(d3.select(this).attr("src","/web/images/icons/pan_dark.png"),d3.select("span#pan"+c.levelNumber).style("background","#DCDCDC"))}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/pan_white.png");d3.select("span#pan"+c.levelNumber).style("background","#989898");$("#mouseHelp").html("Click to set default mouse function to allow click and drag to navigate along the genome.")});
e.append("span").attr("id","reorder"+c.levelNumber).style("height","24px").style("display","inline-block").style("cursor","pointer").append("img").attr("class","mouseOpt pan").attr("src","/web/images/icons/reorder_dark.png").attr("pointer-events","all").on("click",function(){c.resetDefaultMouse(c.defaultMouseFunct);c.defaultMouseFunct="reorder";d3.select(this).attr("src","/web/images/icons/reorder_white.png");d3.select("span#reorder"+c.levelNumber).style("background","#989898");c.changeTrackCursor("ns-resize");
c.changeScaleCursor("ew-resize");gtag("event","",{event_category:"clickReorder"})}).on("mouseout",function(){"reorder"!=c.defaultMouseFunct&&(d3.select(this).attr("src","/web/images/icons/reorder_dark.png"),d3.select("span#reorder"+c.levelNumber).style("background","#DCDCDC"))}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/reorder_white.png");d3.select("span#reorder"+c.levelNumber).style("background","#989898");$("#mouseHelp").html("Click to set default mouse function to reorder image tracks. <strong>Optionally hold down shift in any mode.</strong>")});
$("span#"+c.defaultMouseFunct+c.levelNumber+" img").click();c.functionBar.append("span").attr("class","saveImage control").style("display","inline-block").attr("id","saveLevel"+c.levelNumber).style("cursor","pointer").append("img").attr("src","/web/images/icons/savePic_dark.png").attr("pointer-events","all").attr("cursor","pointer").on("click",function(){var h=$(this).parent().attr("id"),l=(new String(h)).substr(9);h=$("div#Level"+l).html();$.ajax({url:pathPrefix+"saveBrowserImage.jsp",type:"POST",
contentType:"text/html",data:h+"\n",processData:!1,dataType:"json",success:function(n){var q=new Date;q=q.getMonth()+1+"_"+q.getDate()+"_"+q.getFullYear();var u="http://";"https:"===location.protocol&&(u="https://");var v=u+urlprefix+"/tmpData/download/"+n.imageFile;n=new String($("#geneTxt").val());n=n.replace(/:/g,"_");n=n.replace(/-/g,"_");n=n.replace(/,/g,"");"Level1"==l&&(n=svgList[1].selectedData.getAttribute("geneSymbol"));var y=n+"_"+q+".png",w=new XMLHttpRequest;w.open("GET",v);w.responseType=
"blob";w.send();w.onreadystatechange=function(){if(4!=w.readyState||200!=w.status)return!1;var C=document.createElement("a");C.href=window.URL.createObjectURL(w.response);C.download=y;C.style.display="none";document.body.appendChild(C);try{C.click()}catch(B){$("#mouseHelp").html("<span style='color:#FF0000;'>Your browser will not save the image directly. Image will open in a popup, in the new window right click to save image.</span>"),window.open(v)}return!0};gtag("event","saveBrowserImage",{event_category:"browser"})},
error:function(n,q,u){console.log(u)}});gtag("event","",{event_category:"saveImage"})}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/savePic_white.png");d3.select("span#savePic"+c.levelNumber).style("background","#DCDCDC");$("#mouseHelp").html("Click to download a PNG image of the current view.")}).on("mouseout",function(){d3.select(this).attr("src","/web/images/icons/savePic_dark.png");d3.select("span#savePic"+c.levelNumber).style("background","#989898");$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});
c.functionBar.append("span").attr("class","reset control").style("display","inline-block").attr("id","resetImage"+c.levelNumber).style("cursor","pointer").append("img").attr("src","/web/images/icons/reset_dark.png").attr("pointer-events","all").attr("cursor","pointer").on("click",function(){var h=new String($(this).parent().attr("id"));h=h.substr(h.length-1);0==h?($("#geneTxt").val(chr+":"+initMin+"-"+initMax),svgList[0].xScale.domain([initMin,initMax]),svgList[0].scaleSVG.select(".x.axis").call(svgList[0].xAxis),
svgList[0].redraw()):(svgList[h].xScale.domain([svgList[h].initMin,svgList[h].initMax]),svgList[h].scaleSVG.select(".x.axis").call(svgList[h].xAxis),svgList[h].redraw());svgList[0].updateFullData();gtag("event","",{event_category:"clickResetImage"})}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/reset_white.png");d3.select("span#reset"+c.levelNumber).style("background","#DCDCDC");$("#mouseHelp").html("Click to reset image zoom to initial region.")}).on("mouseout",function(){d3.select(this).attr("src",
"/web/images/icons/reset_dark.png");d3.select("span#reset"+c.levelNumber).style("background","#989898");$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});c.functionBar.append("span").attr("class","back control").style("display","inline-block").attr("id","backButton"+c.levelNumber).style("cursor","pointer").append("img").attr("src","/web/images/icons/back_dark2.png").attr("pointer-events","all").attr("cursor","pointer").on("click",function(){back(c.levelNumber);
gtag("event","",{event_category:"clickBack"})}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/back_white2.png");$("#mouseHelp").html("Click to undo last zoom/pan.")}).on("mouseout",function(){d3.select(this).attr("src","/web/images/icons/back_dark2.png");$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});e=c.functionBar.append("span").style("display","inline-block").style("position","relative").style("top","-9px").attr("id",
"zoom"+c.levelNumber);e.append("button").attr("id","zoomInButton"+c.levelNumber).attr("class","zoomIn").style("height","2.3em").append("img").style("position","relative").style("top","-5px").attr("src","/web/images/icons/magPlus_dark_32.png").attr("pointer-events","all").attr("cursor","pointer");e.append("button").attr("id","zoomOutButton"+c.levelNumber).attr("class","zoomOut").style("height","2.3em").append("img").style("position","relative").style("top","-5px").attr("src","/web/images/icons/magMinus_dark_32.png").attr("pointer-events",
"all").attr("cursor","pointer");e.append("button").attr("id","zoomMenuSelect"+c.levelNumber).attr("class","zoomSelectMenu");testChrome?(console.log("CHROME"),d3.select("#zoomSelect"+c.levelNumber).style("height","2.3em")):testSafari&&d3.select("#zoomSelect"+c.levelNumber).style("height","2.3em");e=c.functionBar.append("ul").attr("id","zoomSelectMenu"+c.levelNumber);e.append("li").attr("id","zoom1"+c.levelNumber).attr("value","0.025").on("click",function(){c.zoomMenuChange(this)}).text("0.5x");e.append("li").attr("id",
"zoom2"+c.levelNumber).attr("value","0.05").style("background","#CECECE").on("click",function(){c.zoomMenuChange(this)}).text("1x");e.append("li").attr("id","zoom3"+c.levelNumber).attr("value","0.1").on("click",function(){c.zoomMenuChange(this)}).text("2x");e.append("li").attr("id","zoom4"+c.levelNumber).attr("value","0.25").on("click",function(){c.zoomMenuChange(this)}).text("5x");e.append("li").attr("id","zoom5"+c.levelNumber).attr("value","0.5").on("click",function(){c.zoomMenuChange(this)}).text("10x");
$("#zoomInButton"+c.levelNumber).button().click(function(){zoomIn(c.levelNumber,c.zoomFactor);gtag("event","",{event_category:"clickZoomIn"})}).on("mouseover",function(){$(this).css("background","#989898");$("img",this).attr("src","/web/images/icons/magPlus_light_32.png");$("#mouseHelp").html("Click to zoom in on the center of the region.  Click and drag the scale to zoom in or out more quickly or select the region select tool to highlight a specific region.")}).on("mouseout",function(){$(this).css("background",
"#e6e6e6");$("img",this).attr("src","/web/images/icons/magPlus_dark_32.png");$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).next().button().click(function(){zoomOut(c.levelNumber,c.zoomFactor);gtag("event","",{event_category:"clickZoomOut"})}).on("mouseover",function(){$(this).css("background","#989898");$("img",this).attr("src","/web/images/icons/magMinus_light_32.png");$("#mouseHelp").html("Click to zoom out from the center of the region.  Click and drag the scale to zoom in or out more quickly or select the region select tool to highlight a specific region.")}).on("mouseout",
function(){$(this).css("background","#e6e6e6");$("img",this).attr("src","/web/images/icons/magMinus_dark_32.png");$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).next().button({text:!1,icons:{primary:"ui-icon-triangle-1-s"}}).click(function(){var h=$(this).parent().next().show().position({my:"left top",at:"left bottom",of:this});$(document).on("click",function(){h.hide()});return!1}).parent().buttonset().next().hide().menu()};c.generateSettingsString=
function(){ret="";$("#ScrollLevel"+c.levelNumber+" li.draggable"+c.levelNumber).each(function(){var e=new String($(this).attr("id"));e=e.substr(2);"undefined"!==typeof c.trackListHash[e]&&(ret+=c.trackListHash[e].generateTrackSettingString())});return ret};c.setCurrentViewModified=function(){c.currentView.modified=1;$("span#viewModifiedCtl"+c.levelNumber).show()};c.clearCurrentView=function(){c.currentView.modified=0;$("span#viewModifiedCtl"+c.levelNumber).hide()};c.type=a;c.div=p;c.margin=0;c.halfWindowWidth=
$(window).width()/2;c.mh=400;c.downx=Math.NaN;c.downscalex;c.downPanx=Math.NaN;c.downZoomx=Math.NaN;c.downZoomxEnd=Math.NaN;c.defaultMouseFunct="pan";c.xMax=29E7;c.xMin=1;c.prevMinCoord=r;c.prevMaxCoord=t;c.initMin=r;c.initMax=t;c.dataMinCoord=r;c.dataMaxCoord=t;c.y=0;c.xScale=null;c.xAxis=null;c.vis=null;c.level=null;c.svg=null;c.txType=null;c.txList=null;c.tt=null;c.trackList=[];c.trackCount=0;c.levelNumber=f;c.selectedData=null;c.txType=null;c.selectionStart=-1;c.selectionEnd=-1;c.scrollSize=350;
c.width=m;c.mw=c.width-c.margin;d3.select(p).select("#viewsLevel"+f).remove();d3.select(p).select("#Level"+f).remove();c.vis=d3.select(p);c.setupFunctionBar();0==$("#viewSelect"+c.levelNumber).length&&(m=c.vis.append("div").style("float","right").style("display","inline-block").style("margin-right","5px"),a=m.append("div"),a.append("button").attr("id","viewSelect"+c.levelNumber).attr("class","viewSelect").text("Select/Edit Views").on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",
function(){$("#mouseHelp").html("Click to select another view or edit the current view.")}),a.append("button").attr("id","viewMenuSelect"+c.levelNumber).attr("class","viewSelectMenu").on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",function(){$("#mouseHelp").html("Click for options to quickly save and delete your current view.")}),testChrome?d3.select("#viewSelect"+c.levelNumber).style("height","2.3em"):
testSafari?d3.select("#viewSelect"+c.levelNumber).style("height","2.3em"):testFireFox||testIE&&d3.select("#viewSelect"+c.levelNumber).style("position","relative").style("top","-8px").style("height","2.3em"),m=m.append("ul").attr("id","viewSelectMenu"+c.levelNumber),m.append("li").attr("id","menusaveView"+c.levelNumber).on("click",function(){viewMenu[c.levelNumber].saveView(c.currentView.ViewID,c,!1);$("#viewModifiedCtl"+c.level).hide();gtag("event","",{event_category:"menuSaveView"})}).text("Save"),
m.append("li").attr("id","menusaveAsView"+c.levelNumber).on("click",function(){viewMenu[c.levelNumber].saveAsView(c.currentView,svgList[c.levelNumber]);$(".viewsLevel"+c.levelNumber).css("top",250).css("left",$(window).width()-610);$(".viewsLevel"+c.levelNumber).fadeIn("fast");$("#viewModifiedCtl"+c.level).hide();gtag("event","",{event_category:"menuSaveAsView"})}).text("Save As"),m.append("li").attr("id","menudeleteView"+c.levelNumber).on("click",function(){viewMenu[c.levelNumber].confirmDeleteView(c.currentView);
$(".viewsLevel"+c.levelNumber).css("top",250).css("left",$(window).width()-610);$(".viewsLevel"+c.levelNumber).fadeIn("fast");gtag("event","",{event_category:"menuDeleteView"})}).text("Delete"),$("#viewSelect"+c.levelNumber).button().click(function(){}).next().button({text:!1,icons:{primary:"ui-icon-triangle-1-s"}}).click(function(){var e=$(this).parent().next().show().position({my:"left top",at:"left bottom",of:this});$(document).on("click",function(){e.hide()});return!1}).parent().buttonset().next().hide().menu(),
c.vis.append("span").style("float","right").style("margin-right","5px").append("span").attr("id","mainAddTrack"+c.levelNumber).attr("class","control").style("height","24px").style("display","inline-block").style("cursor","pointer").append("img").attr("class","mainAddTrack").attr("src","/web/images/icons/addTrack_dark_32.png").attr("pointer-events","all").style("height","37px").style("position","relative").style("top","-8px").on("click",function(){if($(".trackLevel"+c.levelNumber).is(":visible"))$(".trackLevel"+
c.levelNumber).fadeOut("fast");else{var e=$(this).parent().parent().position();trackMenu[c.levelNumber].standalone=!0;$(".trackLevel"+c.levelNumber).css("top",e.top).css("left",e.left+-561);$(".trackLevel"+c.levelNumber+" span#selectedViewName").html(c.currentView.Name);$(".trackLevel"+c.levelNumber).fadeIn("fast");$("div#selectTrack"+c.levelNumber).show();$("div#addUsrTrack"+c.levelNumber).hide();$("div#addUsrTrack"+c.levelNumber).hide();$("div#deleteUsrTrack"+c.levelNumber).hide();setTimeout(function(){trackMenu[c.levelNumber].generateTrackTable()},
250);gtag("event","",{event_category:"clickAddTrack"})}}).on("mouseout",function(){d3.select(this).attr("src","/web/images/icons/addTrack_dark_32.png");d3.select("span#mainAddTrack"+c.levelNumber).style("background","#DCDCDC");$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/addTrack_light_32.png");d3.select("span#mainAddTrack"+c.levelNumber).style("background","#989898");$("#mouseHelp").html("Click to quickly add other tracks to the current view.")}),
m=c.vis.append("span").style("float","right").style("margin-right","5px"),m.append("input").attr("type","checkbox").attr("name","imgCBX").attr("id","forceTrxCBX"+c.levelNumber),m.append("label").attr("for","forceTrxCBX"+c.levelNumber).text("Draw Genes as Transcripts").on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",function(){$("#mouseHelp").html("Click to display Gene Tracks as Transcripts. Note: in smaller regions this occurs automatically.")}),
$("input#forceTrxCBX"+c.levelNumber).button(),m=c.vis.append("span").style("float","right").style("margin-right","5px"),a=m.append("div").attr("class","defaultMouse").style("width","64px").attr("id","scrollSize"+c.levelNumber),a.append("span").attr("id","scrollIncr"+c.levelNumber).style("height","24px").style("display","inline-block").style("cursor","pointer").append("img").attr("class","mouseOpt ").attr("src","/web/images/icons/scroll_smaller.png").attr("pointer-events","all").on("click",function(){c.scrollSize-=
100;100>c.scrollSize&&(c.scrollSize=100);changeTrackHeight("Level"+c.levelNumber,c.scrollSize);gtag("event","",{event_category:"changeScrollHeight"})}).on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",function(){$("#mouseHelp").html("Decrease the vertical length of the scrollable browser image on the page.")}),a.append("span").attr("id","pan"+c.levelNumber).style("height","24px").style("display","inline-block").style("cursor",
"pointer").append("img").attr("class","mouseOpt pan").attr("src","/web/images/icons/scroll_larger.png").attr("pointer-events","all").on("click",function(){0<$("#ScrollLevel"+c.levelNumber).length&&"undefined"!==typeof $("#ScrollLevel"+c.levelNumber)[0]&&c.scrollSize<$("#ScrollLevel"+c.levelNumber)[0].scrollHeight&&(c.scrollSize+=100,changeTrackHeight("Level"+c.levelNumber,c.scrollSize))}).on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",
function(){$("#mouseHelp").html("Increase the vertical length of the scrollable browser image on the page.")}),m.append("span").attr("class","scrollBtn control").style("display","inline-block").attr("id","scrollImage"+c.levelNumber).style("cursor","pointer").append("img").attr("src","/web/images/icons/scroll.png").attr("pointer-events","all").attr("cursor","pointer").on("click",function(){"/web/images/icons/no_scroll.png"==d3.select(this).attr("src")?(d3.select(this).attr("src","/web/images/icons/scroll.png"),
d3.select("span#reset"+c.levelNumber).style("background","#989898"),$("#scrollSize"+c.levelNumber).show(),changeTrackHeight("Level"+c.levelNumber,c.scrollSize)):(d3.select(this).attr("src","/web/images/icons/no_scroll.png"),d3.select("span#reset"+c.levelNumber).style("background","#DCDCDC"),$("#scrollSize"+c.levelNumber).hide(),changeTrackHeight("Level"+c.levelNumber,0));gtag("event","",{event_category:"toggleImageScroll"})}).on("mouseover",function(){$("#mouseHelp").html("Click to toggle browser image scrolling on/off.  <b>Off</b> the image takes as much space as needed. <b>On</b> you can adjust the maximum length of the image.")}).on("mouseout",
function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}));c.topDiv=c.vis.append("div").attr("id","Level"+f).style("text-align","left");c.xScale=d3.scaleLinear().domain([r,t]).range([0,c.width]);m={};m.chr=chr;m.start=r;m.stop=t;history[c.levelNumber]||(history[c.levelNumber]=[]);history[c.levelNumber].push(m);c.xAxis=d3.axisTop(c.xScale).ticks(6).tickSize(8).tickPadding(10);c.scaleSVG=c.topDiv.append("svg:svg").attr("width",c.width).attr("height",
60).attr("pointer-events","all").attr("class","scale").on("mousedown",c.mdown).on("mouseup",mup).on("mouseover",function(){"dragzoom"!=c.defaultMouseFunct?$("#mouseHelp").html("<B>Zoom:</b> Click and Drag right to zoom in or left to zoom out. <B>OR</B> Hold the Alt/Option Key while clicking, then drag to select a specific area."):$("#mouseHelp").html("<B>Zoom:</b> Click and Drag to select an area to zoom in on it. <B>OR</B> Hold the Alt/Option Key while clicking and drag right to zoom in or left to zoom out.");
d3.event.altKey&&"dragzoom"!=c.defaultMouseFunct?c.changeScaleCursor("crosshair"):d3.event.altKey&&"dragzoom"==c.defaultMouseFunct&&c.changeScaleCursor("ew-resize")}).on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mousemove",function(){d3.event.altKey&&"dragzoom"!=c.defaultMouseFunct?c.changeScaleCursor("crosshair"):d3.event.altKey&&"dragzoom"==c.defaultMouseFunct?c.changeScaleCursor("ew-resize"):d3.event.altKey||
"dragzoom"!=c.defaultMouseFunct?d3.event.altKey||"dragzoom"==c.defaultMouseFunct||c.changeScaleCursor("ew-resize"):c.changeScaleCursor("crosshair")}).style("cursor","ew-resize");c.scaleSVG.append("text").text(b).attr("x",(c.width-2*c.margin)/2).attr("y",10).attr("class","axisLbl");c.scaleSVG.append("g").attr("class","x axis").attr("transform","translate(0,55)").attr("shape-rendering","crispEdges").call(c.xAxis);c.topLevel=c.topDiv.append("div").attr("id","ScrollLevel"+f).attr("class","scroll").style("max-height",
"350px").style("overflow","auto").style("width","100%").append("ul").attr("id","sortable"+f);c.getAddMenus();svgList[f]=c;$("#sortable"+f).sortable({appendTo:"parent",containment:"parent",stop:function(){}}).disableSelection();$(".draggable"+f).draggable({connectToSortable:"#sortable"+f,scroll:!0,revert:"invalid",axis:"y"});r=mmVer;"Rn"==organism&&(r=rnVer);d3.select("div#imageHeader").html("Organism: "+r+"&nbsp&nbsp&nbsp&nbsp"+siteVer);setTimeout(function(){if(0<$("span#verSelect").length){var e=
d3.select("span#verSelect").append("select");if(c.allowSelectGenomeVer)if(e.on("change",function(){displayWorking();!0===isLocalStorage()?localStorage.setItem(organism+"DefGenomeVer",$(this).val()):$.cookie(organism+"DefGenomeVer",$(this).val());changeGenome($(this).val(),c.currentView);setTimeout(function(){$("form#geneCentricForm").submit()},1500)}),"Rn"===organism){console.log("running update org:");var h=e.append("option").attr("value","rn7").html("rn7");console.log("rn7 added");"rn7"===genomeVer&&
h.attr("selected","selected");h=e.append("option").attr("value","rn6").html("rn6");"rn6"===genomeVer&&h.attr("selected","selected");e=e.append("option").attr("value","rn5").html("rn5");"rn5"===genomeVer&&e.attr("selected","selected")}else"Mm"===organism&&(e=e.append("option").attr("value","mm10").html("mm10"),"mm10"===genomeVer&&e.attr("selected","selected"));else e.append("option").attr("value",genomeVer).html(genomeVer)}},500);c.addTrack("genomeSeq",3,"both",0);c.selectSvg=selectionSVG("#Level"+
c.levelNumber,c.width,c.levelNumber,c);return c}
function toolTipSVG(p,m,r,t,f,b,a){var d={isToolTip:1};d.folderName=regionfolderName;d.updateTimeoutHandle={};d.timeoutTrack=-1;d.forLevel=-1;d.strainSpecificCountColors=d3.scaleOrdinal(d3.schemeCategory20);d.get=function(c){return d[c]};d.getTrack=function(c){for(var g,e=0;e<d.trackList.length;e++)"undefined"!==typeof d.trackList[e]&&d.trackList[e].trackClass===c&&(g=d.trackList[e]);return g};d.addTrackErrorRemove=function(c,g){};d.addTrack=function(c,g,e,h){"Trx"==d.forceDrawAsValue&&-1==(new String(e)).indexOf("DrawTrx")&&
(e+="DrawTrx,");var l=d3.select("#Level"+d.levelNumber+c).nodes();if(0===l.length||null==l){l=d.topLevel.append("li").attr("class","draggable"+d.levelNumber).append("svg:svg").attr("width",d.get("width")).attr("height",30).attr("class","track").attr("id","Level"+d.levelNumber+c);var n=new String("Loading...");l.append("text").text(n).attr("x",d.width/2-n.length/2*7.5).attr("y",12).attr("id","trkLbl")}l="";-1<d.forLevel&&99==d.levelNumber&&"undefined"!==typeof svgList[d.forLevel]&&(l=svgList[d.forLevel].getTrack(c).generateTrackSettingString(),
e=l=l.substr(l.indexOf(",")+1));if("genomeSeq"===c){var q=SequenceTrack(d,c,"Reference Genomic Sequence",e);q.seqRegionSize=10;d.addTrackList(q)}else if(-1<c.indexOf("noncoding"))q=GeneTrack(d,h,c,"Non-Coding/Non-PolyA+ Transcripts",e),d.addTrackList(q);else if(-1<c.indexOf("coding"))q=GeneTrack(d,h,c,"Protein Coding/PolyA+ Transcripts",e),d.addTrackList(q);else if(0===c.indexOf("liverTotal")||"heartTotal"===c||0===c.indexOf("brainTotal")||0===c.indexOf("kidneyTotal")||"mergedTotal"===c)g="Liver Total RNA Transcripts",
"heartTotal"===c?g="Heart Total RNA Transcripts":"brainTotal"===c?g="Brain Total RNA Transcripts":"mergedTotal"===c?g="Merged (Brain,Heart,Liver,Kidney) Reconstructed":"kidneyTotal"===c&&(g="Kidney Total RNA Transcripts"),q=GeneTrack(d,h,c,g,e),d.addTrackList(q);else if(-1<c.indexOf("smallnc"))q=GeneTrack(d,h,c,"Small RNA (<200 bp) Genes",e),d.addTrackList(q);else if(0===c.indexOf("refSeq"))99===d.levelNumber&&(e+="DrawTrx,"),q=RefSeqTrack(d,h,c,"Ref Seq Genes",e),q.density=99===d.levelNumber?2:g,
d.addTrackList(q);else if(0===c.indexOf("snp"))q=SNPTrack(d,h,c,1,"4"),d.addTrackList(q);else if("qtl"===c)q=QTLTrack(d,h,c,1),d.addTrackList(q);else if("trx"===c)h=getAllChildrenByName(getFirstChildByName(d.selectedData,"TranscriptList"),"Transcript"),q=TranscriptTrack(d,h,c,g),d.addTrackList(q);else if("probe"===c||"probeMouse"===c)99!==d.levelNumber&&(e=g+","+e),q=ProbeTrack(d,h,c,"Affy Exon 1.0 ST Probe Sets",e),d.addTrackList(q);else if(-1<c.indexOf("spliceJnct"))e="Brain ","liverspliceJnct"===
c?e="Liver ":"heartspliceJnct"===c&&(e="Heart "),q=SpliceJunctionTrack(d,h,c,e+"Splice Junctions",3,""),100===d.levelNumber&&(q.density=g),d.addTrackList(q);else if("polyASite"===c)q=PolyATrack(d,h,c,"Predicted PolyA Sites",e),d.addTrackList(q);else if("helicos"===c||-1<c.indexOf("illuminaTotal")||-1<c.indexOf("illuminaSmall")||"illuminaPolyA"===c){d.updateTimeoutHandle[c]&&(d.updateTimeoutHandle[c]=-1);g=2;l=l.split(",");1<l.length&&(1===l[1]||2===l[1])&&(g=l[1]);"helicos"===c?q=HelicosTrack(d,h,
c,g):"illuminaTotal"===c?q=IlluminaTotalTrack(d,h,c,g):"illuminaSmall"===c?q=IlluminaSmallTrack(d,h,c,g):"illuminaPolyA"===c?q=IlluminaPolyATrack(d,h,c,g):"liverilluminaTotalPlus"===c?q=LiverIlluminaTotalPlusTrack(d,h,c,g):"liverilluminaTotalMinus"===c?q=LiverIlluminaTotalMinusTrack(d,h,c,g):"heartilluminaTotalPlus"===c?q=HeartIlluminaTotalPlusTrack(d,h,c,g):"heartilluminaTotalMinus"===c?q=HeartIlluminaTotalMinusTrack(d,h,c,g):"brainilluminaTotalPlus"===c?q=BrainIlluminaTotalPlusTrack(d,h,c,g):"brainilluminaTotalMinus"===
c?q=BrainIlluminaTotalMinusTrack(d,h,c,g):"liverilluminaSmall"===c?q=LiverIlluminaSmallTrack(d,h,c,g):"heartilluminaSmall"===c?q=HeartIlluminaSmallTrack(d,h,c,g):-1<c.indexOf("illuminaTotal")&&(q=StrainSpecificIlluminaTotalTrack(d,h,c,g,e));if(99===d.levelNumber){if(0!==d.updateTimeoutHandle[c]){clearTimeout(d.updateTimeoutHandle[c]);try{clearTimeout(d.timeoutTrack[c].fullDataTimeOutHandle)}catch(u){}d.updateTimeoutHandle[c]=0}d.updateTimeoutHandle[c]=setTimeout(function(){q.updateFullData(0,1);d.timeoutTrack[c]=
q;d.updateTimeoutHandle[c]=0},300)}d.addTrackList(q)}else if(0===c.indexOf("repeatMask"))q=RepeatMaskTrack(d,h,c,"Repeat Masker",1,e),d.addTrackList(q);else if(-1<c.indexOf("custom"))if(g=trackInfo[c],e="DataFile="+g.Location+","+e,"bed"===g.Type||"bb"===g.Type)h=[],q=CustomTranscriptTrack(d,h,c,g.Name,3,e),d.addTrackList(q);else{if("bg"===g.Type||"bw"===g.Type)h=[],q=CustomCountTrack(d,h,c,3,e),d.addTrackList(q)}else 0<=c.indexOf("cirRNA")&&(g=trackInfo[c],h=[],q=CircRNATrack(d,h,c,g.Name,3,e),d.addTrackList(q));
$(".sortable"+d.levelNumber).sortable("refresh")};d.addTrackList=function(c){null!=c&&(d.trackList[d.trackCount]=c,d.trackCount++,setTimeout(function(){DisplayRegionReport()},300))};d.changeTrackHeight=function(c,g){0<g?d3.select("#"+c+"Scroll").style("max-height",g+"px"):d3.select("#"+c+"Scroll").style("max-height","none")};d.removeAllTracks=function(){for(var c=0;c<d.trackList.length;c++)"undefined"!==typeof d.trackList[c]&&"genomeSeq"!==d.trackList[c].trackClass&&d3.select("#Level"+d.levelNumber+
d.trackList[c].trackClass).remove();d.trackList=[];setTimeout(function(){DisplayRegionReport()},300)};d.removeTrack=function(c){d3.select("#Level"+d.levelNumber+c).remove();for(var g=0;g<d.trackList.length;g++)"undefined"!==typeof d.trackList[g]&&d.trackList[g].trackClass==c&&(d.trackList.splice(g,1),d.trackCount--);setTimeout(function(){DisplayRegionReport()},300)};d.redrawTrack=function(c){for(var g=0;g<d.trackList.length;g++)"undefined"!==typeof d.trackList[g]&&d.trackList[g].trackClass==c&&d.trackList[g].redraw();
setTimeout(function(){DisplayRegionReport()},300)};d.redraw=function(){for(var c=0;c<d.trackList.length;c++)"undefined"!==typeof d.trackList[c]&&"undefined"!==typeof d.trackList[c].redraw&&d.trackList[c].redraw()};d.update=function(){for(var c=0;c<d.trackList.length;c++)"undefined"!==typeof d.trackList[c].update&&d.trackList[c].update();setTimeout(function(){DisplayRegionReport()},300)};d.updateData=function(){for(var c=0;c<d.trackList.length;c++)"undefined"!==typeof d.trackList[c]&&"undefined"!==
typeof d.trackList[c].updateData&&d.trackList[c].updateData(0);d.updateFullData();setTimeout(function(){DisplayRegionReport()},300)};d.updateFullData=function(){-1<(new String(d.folderName)).indexOf("img")&&(d.folderName="/"+chr+"/"+d.xScale.domain()[0]+"_"+d.xScale.domain()[1]);for(var c=0;c<d.trackList.length;c++)"undefined"!==typeof d.trackList[c]&&"undefined"!==typeof d.trackList[c].updateFullData&&d.trackList[c].updateFullData(0,1)};d.setLoading=function(){for(var c=0;c<d.trackList.length;c++)"undefined"===
typeof d.trackList[c]||"undefined"===typeof d.trackList[c].updateData&&"undefined"===typeof d.trackList[c].updateFullData||d.trackList[c].showLoading()};d.clearSelection=function(){for(var c=0;c<d.trackList.length;c++)"undefined"!==typeof d.trackList[c]&&"undefined"!==typeof d.trackList[c].clearSelection&&d.trackList[c].clearSelection()};d.mdown=function(){if(0==processAjax){d.prevMinCoord=d.xScale.domain()[0];d.prevMaxCoord=d.xScale.domain()[1];var c=d3.mouse(d.vis.node());d.downx=d.xScale.invert(c[0]);
d.downscalex=d.xScale}};d.forceDrawAs=function(c){for(var g=0;g<d.trackList.length;g++)"undefined"!==typeof d.trackList[g]&&"undefined"!==typeof d.trackList[g].drawAs&&(d.trackList[g].drawAs=c,d.trackList[g].draw(d.trackList[g].data));d.forceDrawAsValue=c};d.generateSettingsString=function(){ret="";for(var c=0;c<d.trackList.length;c++)"undefined"!==typeof d.trackList[c]&&"undefined"!==typeof d.trackList[c].generateTrackSettingString&&(ret+=d.trackList[c].generateTrackSettingString());return ret};
d.setCurrentViewModified=function(){"undefined"!==typeof d.currentView&&(d.currentView.modified=1,$("span#viewModifiedCtl"+d.levelNumber).show())};d.clearCurrentView=function(){d.currentView.modified=0;$("span#viewModifiedCtl"+d.levelNumber).hide()};d.type=a;d.div=p;d.margin=0;d.halfWindowWidth=$(window).width()/2;d.mh=400;d.downx=Math.NaN;d.downscalex;d.downPanx=Math.NaN;d.xMax=29E7;d.xMin=1;d.prevMinCoord=r;d.prevMaxCoord=t;d.dataMinCoord=r;d.dataMaxCoord=t;d.y=0;d.xScale=null;d.xAxis=null;d.vis=
null;d.level=null;d.svg=null;d.txType=null;d.txList=null;d.tt=null;d.trackList=[];d.trackCount=0;d.levelNumber=f;d.selectedData=null;d.txType=null;d.width=m;d.mw=d.width-d.margin;d.vis=d3.select(p);d.topDiv=d.vis.append("div").attr("id","Level"+f).style("text-align","left");d.xScale=d3.scaleLinear().domain([r,t]).range([0,d.width]);d.xAxis=d3.axisTop(d.xScale).ticks(3).tickSize(8).tickPadding(10);d.scaleSVG=d.topDiv.append("svg:svg").attr("width",d.width).attr("height",60).attr("class","scale");d.scaleSVG.append("g").attr("class",
"x axis").attr("transform","translate(0,55)").attr("shape-rendering","crispEdges").call(d.xAxis);d3.select("#Level"+d.levelNumber).select(".x.axis").append("text").text(b).attr("x",(d.width-2*d.margin)/2).attr("y",-40).attr("class","axisLbl");d.topLevel=d.topDiv.append("div").attr("id","ScrollLevel"+d.levelNumber).style("width",d.width+18+"px").append("ul").attr("id","sortable"+d.levelNumber);return d}
function selectionSVG(p,m,r,t){var f={};f.imageWidth=m+25;f.levelNumber=r;f.parent=t;f.coordSelectStart=0;f.coordSelectStop=0;f.visible=!1;f.changeSelection=function(b,a){f.start=b;f.stop=a;f.setVis(!0);f.draw()};f.setVis=function(b){f.visible=b;f.visible?(f.svg.style("display","inline-block"),$("div#regionDiv").hide()):(f.svg.style("display","none"),$("div#regionDiv").show())};f.draw=function(){console.log("selectionSVG.draw"+f.trackClass);if(f.visible){f.xScale(f.stop);f.xScale(f.start);f.parent.updateTrackSelectedArea(f.start,
f.stop);var b=new String(numberWithCommas(Math.floor(f.start))),a=new String(numberWithCommas(Math.floor(f.stop)));f.svg.selectAll("line").remove();f.svg.selectAll("text").remove();f.svg.append("line").attr("x1",function(){var d=f.xScale(f.start);0>d&&(d=0);return d}).attr("x2",function(){var d=f.xScale(f.start);0>d&&(d=0);return d}).attr("y1",0).attr("y2",15).attr("stroke","#00992D").attr("stroke-width","1");f.svg.append("line").attr("x1",function(){return f.xScale(f.stop)}).attr("x2",function(){return f.xScale(f.stop)}).attr("y1",
0).attr("y2",15).attr("stroke","#00992D").attr("stroke-width","1");f.svg.append("line").attr("x1",function(){var d=f.xScale(f.start);0>d&&(d=0);return d}).attr("x2",0).attr("y1",15).attr("y2",60).attr("stroke","#00992D").attr("stroke-width","1");f.svg.append("line").attr("x1",function(){return f.xScale(f.stop)}).attr("x2",f.imageWidth).attr("y1",15).attr("y2",60).attr("stroke","#00992D").attr("stroke-width","1");f.svg.append("text").attr("x",f.xScale(f.start)-7.5*b.length-10).attr("y",15).text(b);
f.svg.append("text").attr("x",f.xScale(f.stop)+10).attr("y",15).text(a)}};f.redraw=function(){f.draw()};f.setup=function(){f.svg=d3.select(p).append("svg:svg").attr("width",f.imageWidth).attr("height",60).attr("id","selectionLevel"+f.levelNumber).style("display","none");f.xScale=f.parent.xScale};f.setup();return f}
function Track(p,m,r,t){var f={};f.selectionStart=p.selectionStart;f.selectionEnd=p.selectionEnd;f.ttSVGMinWidth=20;f.panDown=function(){if(!d3.event.shiftKey&&0===f.gsvg.overSettings&&0===overSelectable&&("dragzoom"!==f.gsvg.defaultMouseFunct&&d3.event.altKey||"dragzoom"===f.gsvg.defaultMouseFunct&&!d3.event.altKey)){var b=d3.mouse(f.gsvg.vis.node());f.gsvg.downZoomx=b[0];f.svg.append("rect").attr("class","zoomRect").attr("x",b[0]).attr("y",0).attr("height",f.svg.attr("height")).attr("width",1).attr("fill",
"#CECECE").attr("opacity",.3);f.scaleSVG.append("rect").attr("class","zoomRect").attr("x",b[0]).attr("y",0).attr("height",f.scaleSVG.attr("height")).attr("width",1).attr("fill","#CECECE").attr("opacity",.3);f.scaleSVG.append("text").attr("id","zoomTextStart").attr("x",f.gsvg.downZoomx).attr("y",15).text(numberWithCommas(Math.round(f.xScale.invert(f.gsvg.downZoomx))));f.scaleSVG.append("text").attr("id","zoomTextEnd").attr("x",f.gsvg.downZoomx).attr("y",50).text(numberWithCommas(Math.round(f.xScale.invert(f.gsvg.downZoomx))))}else!d3.event.shiftKey&&
0===f.gsvg.overSettings&&0===overSelectable&&("pan"===f.gsvg.defaultMouseFunct&&!d3.event.altKey||"pan"!==f.gsvg.defaultMouseFunct&&d3.event.altKey)&&0==processAjax&&(b=d3.mouse(f.gsvg.vis.node()),f.gsvg.downPanx=b[0],f.gsvg.downscalex=f.xScale)};f.zoomToFeature=function(b){var a=parseInt(b.getAttribute("stop"),10)-parseInt(b.getAttribute("start"),10);a*=.25;var d=parseInt(b.getAttribute("start"),10)-a;b=parseInt(b.getAttribute("stop"),10)+a;b<=f.gsvg.xMax&&1<=d&&(f.xScale.domain([d,b]),f.scaleSVG.select(".x.axis").call(f.xAxis),
f.gsvg.redraw(),0==f.gsvg.levelNumber||1==f.gsvg.levelNumber)&&(a={},a.chr=chr,a.start=d,a.stop=b,history[f.gsvg.levelNumber]||(history[f.gsvg.levelNumber]=[]),history[f.gsvg.levelNumber].push(a))};f.clearSelection=function(){f.selectionStart=-1;f.selectionEnd=-1;f.svg.selectAll("rect.selectedArea").remove();f.svg.selectAll(".selected").each(function(){f.svg.select(this).attr("class","").style("fill",f.color)})};f.setSelectedArea=function(b,a){f.selectionStart=b;f.selectionEnd=a;f.redrawSelectedArea()};
f.redrawSelectedArea=function(){d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll(".selectedArea").remove();if(-1<f.selectionStart&&-1<f.selectionEnd){var b=f.xScale(f.selectionStart),a=f.xScale(f.selectionEnd)-b;1>a&&(a=1);d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).append("rect").attr("class","selectedArea").attr("x",b).attr("y",0).attr("height",function(){var d=f.svg.attr("height");15>d&&(d=15);return d}).attr("width",a).attr("fill","#CECECE").attr("opacity",.3).attr("pointer-events",
"none")}};f.colorStroke=function(b){var a="black";3>f.xScale(b.getAttribute("stop"))-f.xScale(b.getAttribute("start"))&&(a=f.color(b));return a};f.calcY=function(b,a,d){b=3===f.density||"3"===f.density?f.calcYPack(b,a,d):2===f.density||"2"===f.density?f.calcYFull(d):f.calcYDense();f.trackYMax<b/15&&(f.trackYMax=b/15);return b};f.calcYPack=function(b,a,d){if(b>=f.xScale.domain()[0]&&b<=f.xScale.domain()[1]||a>=f.xScale.domain()[0]&&a<=f.xScale.domain()[1]||b<=f.xScale.domain()[0]&&a>=f.xScale.domain()[1]){b=
Math.round(f.xScale(b));0>b&&(b=0);a=Math.round(f.xScale(a));a>=f.gsvg.width&&(a=f.gsvg.width-1);d=b-f.xPadding;0>d&&(d=0);var c=a+f.xPadding;c>=f.gsvg.width&&(c=f.gsvg.width-1);for(var g=0,e=d;e<=c;e++)f.yMaxArr[e]>g&&(g=f.yMaxArr[e]);g++;var h=g;if(f.yArr.length<=g)for(f.yArr[h]=[],e=0;e<f.gsvg.width;e++)f.yArr[h][e]=0;e=g-f.scanBackYLines;1>e&&(e=1);h=0;for(var l=e;l<g&&0==h;l++){var n=0;for(e=d;e<=c&&0==n;e++)f.yArr[l][e]>n&&(n=1);0==n&&(g=l,h=1)}g>f.trackYMax&&(f.trackYMax=g);for(e=b;e<=a;e++)f.yMaxArr[e]<
g&&(f.yMaxArr[e]=g),f.yArr[g][e]=1;b=15*g}else b=15;return b};f.calcYDense=function(){return 15};f.calcYFull=function(b){return 15*(b+1)};f.positionTTLeft=function(b){b+=20;b>f.gsvg.halfWindowWidth&&(b-=490);return b+"px"};f.positionTTTop=function(b){b=window.pageYOffset+10;var a=window.innerHeight-1.8*$(".testToolTip").height();20<a&&(b+=a/2);return b+"px"};f.drawLegend=function(b){var a=new String(f.label),d=f.gsvg.width/2+a.length/2*6.5;500>f.gsvg.width&&(d=7*a.length);d3.select("#Level"+f.gsvg.levelNumber+
f.trackClass).selectAll(".legend").remove();for(var c=0;c<b.length;c++)f.svg.append("rect").attr("class","legend").attr("x",d).attr("y",0).attr("rx",3).attr("ry",3).attr("height",12).attr("width",16).attr("fill",b[c].color).attr("stroke",b[c].color),a=new String(b[c].label),f.svg.append("text").text(a).attr("class","legend").attr("x",d+18).attr("y",12),d=d+25+7*a.length};f.drawScaleLegend=function(b,a,d,c,g,e){var h=new String(f.label),l=f.gsvg.width/2+h.length/2*7.5+16;500>f.gsvg.width&&(l=7.5*h.length);
l+=e;d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll(".legend").remove();d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll("#def1").remove();h=f.svg.append("defs").attr("id","def1").append("linearGradient").attr("id","grad"+f.gsvg.levelNumber+f.trackClass);h.append("stop").attr("offset","0%").style("stop-color",c);h.append("stop").attr("offset","100%").style("stop-color",g);h=new String(b);b=7.6*h.length;f.svg.append("text").text(h).attr("class","legend").attr("x",l).attr("y",
12);f.svg.append("rect").attr("class","legend").attr("x",l+b+5).attr("y",0).attr("rx",3).attr("ry",3).attr("height",12).attr("width",75).attr("fill","url(#grad"+f.gsvg.levelNumber+f.trackClass+")");h=new String(a);f.svg.append("text").text(h).attr("class","legend").attr("x",l+b+80).attr("y",12);a=8*h.length+5;h=new String(d);f.svg.append("text").text(h).attr("class","legend").attr("x",l+b+80+a).attr("y",12)};f.showLoading=function(){0<d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll("g.loading")?
f.loading=d3.select(f.svg).selectAll("g.loading"):(f.loading=f.svg.append("g").attr("class","loading"),f.loading.append("rect").attr("x",0).attr("y",0).attr("height",f.svg.attr("height")).attr("width",f.gsvg.width).attr("fill","#CECECE").attr("opacity",.6),f.loading.append("text").text("Loading...").attr("x",f.gsvg.width/2-37.5).attr("y",f.svg.attr("height")/2))};f.hideLoading=function(){f.loading=d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll("g.loading");"undefined"!==typeof f.loading&&
f.loading.remove()};f.displayBreakDown=function(b){$(window).width();1E3<$(window).width()&&$(window).width();if("undefined"!==typeof f.counts&&0<f.counts.length){for(var a=1,d=0;d<f.counts.length&&1===a;d++)0<f.counts[d].value&&(a=0);if(0===a){var c=d3.arc().outerRadius(140).innerRadius(0);a=d3.pie().value(function(g){return g.value});b=d3.select(b).append("svg").attr("width",300).attr("height",300).append("g").attr("transform","translate(150,150)").selectAll(".arc").data(a(f.counts)).enter().append("g").attr("class",
"arc");b.append("path").attr("d",c).attr("fill",f.pieColor).on("mouseover",function(g){d3.select(".testToolTip").transition().duration(200).style("opacity",.95);d3.select(".testToolTip").html("Name: "+g.data.names+"<BR>Count: "+g.data.value).style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px");f.triggerTableFilter(g)}).on("mouseout",function(g){d3.select(".testToolTip").transition().delay(500).duration(200).style("opacity",0);f.clearTableFilter(g)});b.append("text").attr("transform",
function(g){return"translate("+c.centroid(g)+")"}).attr("dy",".35em").attr("fill","#FFFFFF").style("text-anchor","middle").text(function(g){var e=g.value;0==g.value&&(e="");return e})}}};f.updateLabel=function(b){f.label=b;b=new String(f.label);600<f.gsvg.width?d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).select("#trkLbl").attr("x",f.gsvg.width/2-b.length/2*7.5).text(b):d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).select("#trkLbl").attr("x",0).text(b);d3.select("#Level"+f.gsvg.levelNumber+
f.trackClass).select(".infoIcon").attr("transform","translate("+(f.gsvg.width-20)+",0)");d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).select(".settings").attr("transform","translate("+(f.gsvg.width-40)+",0)")};f.resize=function(){d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).attr("width",f.gsvg.width);f.updateLabel(f.label);"undefined"!==typeof f.redrawLegend&&f.redrawLegend();f.redraw()};f.triggerTableFilter=function(b){};f.clearTableFilter=function(b){};f.getDisplayID=function(b){return b.getAttribute("ID")};
f.setupToolTipSVG=function(b,a){var d=parseInt(b.getAttribute("start"),10),c=parseInt(b.getAttribute("stop"),10),g=Math.floor((c-d)*a);20>g&&(g=20);a=d-g;g=c+g;1>a&&(a=1);"undefined"!==typeof f.ttSVGMinWidth&&g-a<f.ttSVGMinWidth&&(a=d-f.ttSVGMinWidth/2,g=c+f.ttSVGMinWidth/2);d=toolTipSVG("div#ttSVG",450,a,g,99,f.getDisplayID(b),"transcript");d.forLevel=f.gsvg.levelNumber;c=[];c.push(b);d.addTrack(f.trackClass,3,"",c);for(b=0;b<f.ttTrackList.length;b++){c=f.gsvg.getTrackData(f.ttTrackList[b]);var e=
[];if("undefined"!==typeof c&&0<c.length){for(var h=0,l=0;l<c.length;l++)if(a<=parseInt(c[l].getAttribute("start"),10)&&parseInt(c[l].getAttribute("start"),10)<=g||parseInt(c[l].getAttribute("start"),10)<=a&&parseInt(c[l].getAttribute("stop"),10)>=a)e[h]=c[l],h++;0<e.length&&d.addTrack(f.ttTrackList[b],3,"DrawTrx",e)}}};f.generateSettingsDiv=function(b){f.savePrevious();var a=trackInfo[f.trackClass];d3.select(b).select("table").select("tbody").html("");if("undefined"!==typeof a&&0<a.Controls.length&&
"null"!=a.Controls){var d=(new String(a.Controls)).split(",");b=d3.select(b).select("table").select("tbody");b.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+a.Name);for(a=0;a<d.length;a++)if("undefined"!==typeof d[a]&&""!=d[a]){var c=d[a].split(";"),g=b.append("tr").append("td"),e=c[0].substr(5);g.append("text").text(e+": ");e="";3<c.length&&0==c[3].indexOf("Default=")&&(e=c[3].substr(8));if(0==c[1].toLowerCase().indexOf("select")){var h=c[1].split(":");c=c[2].split("}");
var l="",n="";2<h.length&&(l=h[2]);3<h.length&&(n=h[3]);g=g.append("select").attr("id",f.trackClass+l+f.level+n).attr("name",h[1]);for(h=0;h<c.length;h++){var q=c[h].substr(1).split(":");if(2==q.length){var u=g.append("option").attr("value",q[1]).text(q[0]);"Dense"===l&&q[1]==f.density?u.attr("selected","selected"):"Version"===l&&q[1]==f.dataVer?u.attr("selected","selected"):q[1]==e&&u.attr("selected","selected")}}d3.select("select#"+f.trackClass+l+f.level+n).on("change",function(){f.updateSettingsFromUI();
f.redraw()})}else console.log("Undefined track settings:  "+d[a])}d=b.append("tr").append("td");d.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");f.gsvg.setCurrentViewModified();f.gsvg.removeTrack(f.trackClass);var v=svgList[f.gsvg.levelNumber].currentView.ViewID,y=viewMenu[f.gsvg.levelNumber].findTrackByClass(f.trackClass,v);y=viewMenu[f.gsvg.levelNumber].findTrackIndexWithViewID(y.TrackID,
v);viewMenu[f.gsvg.levelNumber].removeTrackWithIDIdx(y,v)});d.append("input").attr("type","button").attr("value","Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");f.density!=f.prevSetting.density&&f.gsvg.setCurrentViewModified()});d.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){f.revertPrevious();f.draw(f.data);$("#trackSettingDialog").fadeOut("fast")})}else a&&
(b=d3.select(b).select("table").select("tbody"),b.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+a.Name),b.append("tr").append("td").html("Sorry no settings for this track."),d=b.append("tr").append("td"),d.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");f.gsvg.setCurrentViewModified();f.gsvg.removeTrack(f.trackClass)}),d.append("input").attr("type",
"button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")}))};f.updateSettingsFromUI=function(){0<$("#"+f.trackClass+"Dense"+f.level+"Select").length&&(f.density=$("#"+f.trackClass+"Dense"+f.level+"Select").val())};f.savePrevious=function(){f.prevSetting={};f.prevSetting.density=f.density};f.revertPrevious=function(){f.density=f.prevSetting.density};f.updateSettings=function(b){};f.generateTrackSettingString=function(){return f.trackClass+
","+f.density+";"};f.gsvg=p;f.level=f.gsvg.levelNumber;f.data=m;f.label=t;f.density=3;f.loading;f.trackYMax=0;f.trackClass=r;f.topLevel=f.gsvg.get("topLevel");f.xScale=f.gsvg.get("xScale");f.scaleSVG=f.gsvg.get("scaleSVG");f.xAxis=f.gsvg.get("xAxis");f.yMaxArr=[];f.yArr=[];f.yArr[0]=[];for(p=0;p<f.gsvg.width;p++)f.yMaxArr[p]=0,f.yArr[0][p]=0;f.scanBackYLines=12;f.xPadding=2;3E6<f.gsvg.xScale.domain()[1]-f.gsvg.xScale.domain()[0]&&(f.xPadding=1);f.vis=d3.select("#Level"+f.gsvg.levelNumber+f.trackClass);
f.svg=d3.select("svg#Level"+f.gsvg.levelNumber+f.trackClass);f.svg.on("mousedown",f.panDown);f.updateLabel(f.label);return f}
function SequenceTrack(p,m,r,t){t=[];var f=Track(p,t,m,r);f.dispCutoff=300;f.aaDispCutoff=2900;f.seqRegionSize=4E3;f.strands="both";f.includeAA=1;f.labelBase=r;f.lastUpdate=0;f.seqRegionMin=0;f.seqRegionMax=0;f.color=function(b){};f.colorAA=function(b,a){d3.rgb("#FFFFFF");a=0==b.pos%2?d3.rgb("#C3C3C3"):d3.rgb("#838383");"M"==b.aa&&(a=d3.rgb("#00FF00"));"*"==b.aa&&(a=d3.rgb("#FF0000"));return a};f.createCodon=function(){f.codons=[];f.codons.AAA="K";f.codons.AAT="N";f.codons.AAG="K";f.codons.AAC="N";
f.codons.ATA="I";f.codons.ATT="I";f.codons.ATG="M";f.codons.ATC="I";f.codons.ACA="T";f.codons.ACT="T";f.codons.ACG="T";f.codons.ACC="T";f.codons.AGA="R";f.codons.AGT="S";f.codons.AGG="R";f.codons.AGC="S";f.codons.TAA="*";f.codons.TAT="Y";f.codons.TAG="*";f.codons.TAC="Y";f.codons.TTA="L";f.codons.TTT="F";f.codons.TTG="L";f.codons.TTC="F";f.codons.TCA="S";f.codons.TCT="S";f.codons.TCG="S";f.codons.TCC="S";f.codons.TGA="*";f.codons.TGT="C";f.codons.TGG="W";f.codons.TGC="C";f.codons.CAA="Q";f.codons.CAT=
"H";f.codons.CAG="Q";f.codons.CAC="H";f.codons.CTA="L";f.codons.CTT="L";f.codons.CTG="L";f.codons.CTC="L";f.codons.CCA="P";f.codons.CCT="P";f.codons.CCG="P";f.codons.CCC="P";f.codons.CGA="R";f.codons.CGT="R";f.codons.CGG="R";f.codons.CGC="R";f.codons.GAA="E";f.codons.GAT="D";f.codons.GAG="E";f.codons.GAC="D";f.codons.GTA="V";f.codons.GTT="V";f.codons.GTG="V";f.codons.GTC="V";f.codons.GCA="A";f.codons.GCT="A";f.codons.GCG="A";f.codons.GCC="A";f.codons.GGA="G";f.codons.GGT="G";f.codons.GGG="G";f.codons.GGC=
"G"};f.translate=function(b){b=b.toUpperCase();return f.codons[b]};f.translateRegion=function(b,a,d,c){var g=[],e=0,h=0;if(f.data){if(d>c){h=1;var l=d;d=c;c=l}for(l=d;l<=c;l+=3){var n=f.data.substring(l,l+3);1==h&&(n=f.reverseCompliment(n));g[e]=[];g[e].aa=f.translate(n);g[e].pos=a+(l-d);g[e].id=b+":"+l+":"+f.translate(n);e++}}return g};f.reverseCompliment=function(b){for(var a="",d=b.length-1;-1<d;d--)a+=f.complement(b.charAt(d));return a};f.complement=function(b){var a="N";"A"==b?a="T":"T"==b?a=
"A":"G"==b?a="C":"C"==b&&(a="G");return a};f.redraw=function(){f.redrawSelectedArea();var b=f.xScale.domain()[0],a=f.xScale.domain()[1];if(f.prevStrand!=f.strands||f.prevIncldAA!=f.includeAA)d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll("g.base").each(function(B){d3.select(this).remove()}),d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll("g.aa0").each(function(B){d3.select(this).remove()}),d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll("g.aa1").each(function(B){d3.select(this).remove()}),
d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll("g.aa2").each(function(B){d3.select(this).remove()}),d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll("g.aarev0").each(function(B){d3.select(this).remove()}),d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll("g.aarev1").each(function(B){d3.select(this).remove()}),d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll("g.aarev2").each(function(B){d3.select(this).remove()}),b<f.seqRegionMin||a>f.seqRegionMax?
f.updateData(0):f.draw(f.data);else if(b<f.seqRegionMin||a>f.seqRegionMax)f.updateData(0);else{var d=a-b,c="12px";200<d&&(c="10px");if(d<=f.aaDispCutoff&&1==f.includeAA||d<=f.dispCutoff){if(f.seqRegionMin<=b&&b<=f.seqRegionMax&&f.seqRegionMin<=a&&a<=f.seqRegionMax){var g=f.gsvg.width/d,e=g/2;a=b-f.seqRegionMin;var h=d+a,l=27;1==f.includeAA&&"-"!=f.strands&&(l+=30);if(d<f.dispCutoff){d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll("g.line").remove();for(var n=[],q=a;q<h;q++)n[q-a]=[],
n[q-a].base=f.data.charAt(q),n[q-a].id=q,n[q-a].pos=q-a;f.textSize(d);var u=f.yPosition(d);q=f.svg.selectAll(".base").data(n,keyID).attr("transform",function(B,E){return"translate("+(B.pos*g-e)+","+l+")"});n=q.enter().append("g").attr("class","base").attr("transform",function(B,E){return"translate("+(B.pos*g-e)+","+l+")"});n.each(function(B){d3.select(this).append("text").text(function(E){return"-"!=f.strands?E.base:f.complement(E.base)});"both"==f.strands&&d3.select(this).append("text").attr("class",
"comp").attr("y",u).text(function(E){return f.complement(E.base)})});q.exit().remove();q.selectAll("text").attr("font-size",function(B){return f.textSize(d)});q.selectAll("text.comp").attr("y",u)}else d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll("g.base").remove(),f.svg.append("g").attr("class","line").append("line").attr("stroke","#000000").attr("x1",0).attr("y1",l).attr("x2",f.gsvg.width).attr("y2",l);if(1==f.includeAA){var v=3*g,y=v/2-4,w=25;if("both"==f.strands||"+"==f.strands)for(q=
b%3,n=a-q,h=[],h[0]=f.translateRegion(0,b-q,n,n+d),h[1]=f.translateRegion(1,b-q-1,n-1,n-1+d),h[2]=f.translateRegion(2,b-q-2,n-2,n-2+d),w=25,q=0;3>q;q++){var C=f.svg.selectAll(".aa"+q).data(h[q],keyID).attr("transform",function(B,E){return"translate("+(f.xScale(B.pos)-g)+","+w+")"}).each(function(B){d3.select(this).select("rect").attr("width",v);d<f.dispCutoff?0==d3.select(this).select("text").size()?d3.select(this).append("text").attr("x",y).attr("font-size",c).text(function(E){return E.aa}):d3.select(this).select("text").attr("x",
y).attr("font-size",c):d3.select(this).select("text").remove()});n=C.enter().append("g").attr("class","aa"+q).attr("transform",function(B,E){return"translate("+(f.xScale(B.pos)-g)+","+w+")"});n.each(function(B){d3.select(this).append("rect").attr("y",-10).attr("height",10).attr("width",v).attr("stroke",f.colorAA).attr("fill",f.colorAA);d<f.dispCutoff&&d3.select(this).append("text").attr("x",y).attr("font-size",c).text(function(E){return E.aa})});C.exit().remove();w+=11}w="both"==f.strands?80:45;if("both"==
f.strands||"-"==f.strands)for(q=b%3,n=a-q,h=[],h[0]=f.translateRegion(0,b-q,n+d,n),h[1]=f.translateRegion(1,b-q-1,n-1+d,n-1),h[2]=f.translateRegion(2,b-q-2,n-2+d,n-2),q=0;3>q;q++)C=f.svg.selectAll(".aarev"+q).data(h[q],keyID).attr("transform",function(B,E){return"translate("+(f.xScale(B.pos)-g)+","+w+")"}).each(function(B){d3.select(this).select("rect").attr("width",v);d<f.dispCutoff?0==d3.select(this).select("text").size()?d3.select(this).append("text").attr("x",y).attr("font-size",c).text(function(E){return E.aa}):
d3.select(this).select("text").attr("x",y).attr("font-size",c):d3.select(this).select("text").remove()}),n=C.enter().append("g").attr("class","aarev"+q).attr("transform",function(B,E){return"translate("+f.xScale(B.pos)+","+w+")"}),n.each(function(B){d3.select(this).append("rect").attr("y",-10).attr("height",10).attr("width",v).attr("stroke",f.colorAA).attr("fill",f.colorAA);d<f.dispCutoff&&d3.select(this).append("text").attr("x",y).attr("font-size",c).text(function(E){return E.aa})}),C.exit().remove(),
w+=11;"both"==f.strands?f.svg.attr("height",125):f.svg.attr("height",75)}else"both"==f.strands?f.svg.attr("height",45):f.svg.attr("height",30)}else f.updateData(0);$("li.draggable"+f.gsvg.levelNumber+"#li"+f.trackClass).show()}else f.svg.attr("height",0),$("li.draggable"+f.gsvg.levelNumber+"#li"+f.trackClass).hide()}};f.draw=function(b){f.redrawSelectedArea();var a=f.xScale.domain()[0],d=f.xScale.domain()[1]-a,c="";1==f.includeAA&&(c=" and Amino Acids");"both"==f.strands?f.label=f.labelBase+c+" on +/- strands":
"+"==f.strands?f.label=f.labelBase+c+" on + strand":"-"==f.strands&&(f.label=f.labelBase+c+" on - strand");d<=f.aaDispCutoff&&1==f.includeAA||d<=f.dispCutoff||(f.label="");f.updateLabel(f.label);f.data=new String(b);var g="10px";200<d&&(g="8px");if(f.data&&d<=f.aaDispCutoff&&1==f.includeAA||d<=f.dispCutoff){c=a-f.seqRegionMin;var e=d+c,h=f.gsvg.width/d;f.svg.selectAll("text.dir").remove();"both"==f.strands?(f.svg.append("text").attr("class","dir").attr("x",5).attr("y",15).text("--\x3e"),f.svg.append("text").attr("class",
"dir").attr("x",5).attr("y",120).text("<--"),f.svg.append("text").attr("class","dir").attr("x",f.gsvg.width-60).attr("y",15).text("--\x3e"),f.svg.append("text").attr("class","dir").attr("x",f.gsvg.width-20).attr("y",120).text("<--")):"+"==f.strands?(f.svg.append("text").attr("class","dir").attr("x",5).attr("y",15).text("--\x3e"),f.svg.append("text").attr("class","dir").attr("x",f.gsvg.width-60).attr("y",15).text("--\x3e")):"-"==f.strands&&(f.svg.append("text").attr("class","dir").attr("x",5).attr("y",
15).text("<--"),f.svg.append("text").attr("class","dir").attr("x",f.gsvg.width-60).attr("y",15).text("<--"));if(d<f.dispCutoff&&1<b.length){for(var l=[],n=c;n<e;n++)l[n-c]=[],l[n-c].base=b.charAt(n),l[n-c].id=n,l[n-c].pos=n-c;n=f.textSize(d);var q=f.yPosition(d),u=27;1==f.includeAA&&"-"!=f.strands&&(u+=30);l=f.svg.selectAll(".base").data(l,keyID).attr("transform",function(C,B){return"translate("+C.pos*h+","+u+")"});b=l.enter().append("g").attr("class","base").attr("transform",function(C,B){return"translate("+
C.pos*h+","+u+")"});b.each(function(C){d3.select(this).append("text").text(function(B){return"-"!=f.strands?C.base:f.complement(C.base)});"both"==f.strands&&d3.select(this).append("text").attr("class","comp").attr("y",q).text(function(B){return f.complement(C.base)})});l.exit().remove();l.selectAll("text").attr("font-size",n)}else f.svg.append("g").attr("class","base").append("line").attr("stroke","#000000").attr("x1",0).attr("y1",57).attr("x2",f.gsvg.width).attr("y2",57);if(f.data&&1==f.includeAA){var v=
3*h,y=v/2-4,w=25;if("both"==f.strands||"+"==f.strands)for(n=a%3,b=c-n,l=[],l[0]=f.translateRegion(0,a-n,b,b+d),l[1]=f.translateRegion(1,a-n-2,b-2,b-2+d),l[2]=f.translateRegion(2,a-n-1,b-1,b-1+d),w=25,n=0;3>n;n++)e=f.svg.selectAll(".aa"+n).data(l[n],keyID).attr("transform",function(C,B){return"translate("+f.xScale(C.pos)+","+w+")"}).each(function(C){d3.select(this).select("rect").attr("width",v);d<f.dispCutoff?0==d3.select(this).select("text").size()?d3.select(this).append("text").attr("x",y).attr("font-size",
g).text(function(B){return C.aa}):d3.select(this).select("text").attr("x",y).attr("font-size",g):d3.select(this).select("text").remove()}),e.enter().append("g").attr("class","aa"+n).attr("transform",function(C,B){return"translate("+f.xScale(C.pos)+","+w+")"}).each(function(C){d3.select(this).append("rect").attr("y",-10).attr("height",10).attr("width",v).attr("stroke",f.colorAA(C)).attr("fill",f.colorAA(C));d<f.dispCutoff&&d3.select(this).append("text").attr("x",y).attr("font-size",g).text(function(){return C.aa})}),
e.exit().remove(),w+=11;w="both"==f.strands?80:45;if("both"==f.strands||"-"==f.strands)for(n=a%3,b=c-n,l=[],l[0]=f.translateRegion(0,a-n,b+d,b),l[1]=f.translateRegion(1,a-n-1,b-1+d,b-1),l[2]=f.translateRegion(2,a-n-2,b-2+d,b-2),n=0;3>n;n++)e=f.svg.selectAll(".aarev"+n).data(l[n],keyID).attr("transform",function(C,B){return"translate("+f.xScale(C.pos)+","+w+")"}),b=e.enter().append("g").attr("class","aarev"+n).attr("transform",function(C,B){return"translate("+f.xScale(C.pos)+","+w+")"}),b.each(function(C){d3.select(this).append("rect").attr("y",
-10).attr("height",10).attr("width",v).attr("stroke",f.colorAA(C)).attr("fill",f.colorAA(C));d<f.dispCutoff&&d3.select(this).append("text").attr("x",y).attr("font-size",g).text(function(B){return C.aa})}),e.exit().remove(),w+=11;"both"==f.strands?f.svg.attr("height",125):f.svg.attr("height",75)}else"both"==f.strands?f.svg.attr("height",45):f.svg.attr("height",30);f.prevStrand=f.strands;f.prevIncldAA=f.includeAA;$("li.draggable"+f.gsvg.levelNumber+"#li"+f.trackClass).show()}else f.svg.attr("height",
0),$("li.draggable"+f.gsvg.levelNumber+"#li"+f.trackClass).hide()};f.textSize=function(b){var a="9px";100>=b?a="11px":150>=b?a="8px":200>=b?a="6.8px":250>=b?a="5.8px":300>=b&&(a="4.8px");return a};f.yPosition=function(b){var a=12;100>=b?a=12:150>=b?a=10:200>=b?a=8:250>=b?a=6:300>=b&&(a=5);return a};f.updateData=function(b){var a=(new Date).getTime();if(25E3<a-f.lastUpdate||0<b)0===b&&(0===f.lastUpdate||25E3>a-f.lastUpdate)&&(f.tmpseqRegionMin=f.xScale.domain()[0]-f.seqRegionSize,f.tmpseqRegionMax=
f.xScale.domain()[1]+f.seqRegionSize,0>f.tmpseqRegionMin&&(f.tmpseqRegionMin=0)),f.xScale.domain()[1]-f.xScale.domain()[0]<f.aaDispCutoff&&(f.lastUpdate=a,f.svg&&30>f.svg.attr("height")&&f.svg.attr("height",30),0===b&&f.showLoading(),d3.text(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+f.gsvg.folderName+"/"+f.tmpseqRegionMin+"_"+f.tmpseqRegionMax+".seq",function(d,c){d?(0===b&&(d="/"+pathPrefix,pathPrefix||(d=""),$.ajax({url:d+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,
minCoord:f.tmpseqRegionMin,maxCoord:f.tmpseqRegionMax,panel,rnaDatasetID,arrayTypeID,myOrganism:organism,genomeVer,track:f.trackClass,folder:f.gsvg.folderName},dataType:"json",success:function(g){gtag("event","generateTrackSequence",{event_category:"browser"})},error:function(g,e,h){}})),3>b?(d=1E4,1===b&&(d=15E3),setTimeout(function(){f.updateData(b+1)},d)):(f.seqRegionMin=0,f.seqRegionMax=0,f.hideLoading(),d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+
f.trackClass),d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).attr("height",15),f.gsvg.addTrackErrorRemove(f.svg,"#Level"+f.gsvg.levelNumber+f.trackClass),f.lastUpdate=0)):(f.seqRegionMin=f.tmpseqRegionMin,f.seqRegionMax=f.tmpseqRegionMax,f.hideLoading(),f.draw(c),f.lastUpdate=0,setTimeout(function(){DisplayRegionReport()},300))}))};f.updateSettingsFromUI=function(){0<$("#"+f.trackClass+f.level+"Select").length&&(f.strands=$("#"+f.trackClass+f.level+"Select").val());0<$("#"+f.trackClass+"CBX"+
f.level+"dispAA").length&&($("#"+f.trackClass+"CBX"+f.level+"dispAA").is(":checked")?f.includeAA=1:f.includeAA=0)};f.savePrevious=function(){f.prevSetting={};f.prevSetting.strands=f.strands;f.prevSetting.includeAA=f.includeAA};f.revertPrevious=function(){f.strands=f.prevSetting.strands;f.includeAA=f.prevSetting.includeAA};f.generateTrackSettingString=function(){return f.trackClass+","+f.strands+","+f.includeAA+";"};f.generateSettingsDiv=function(b){var a=trackInfo[f.trackClass];f.savePrevious();d3.select(b).select("table").select("tbody").html("");
if(0<a.Controls.length&&"null"!=a.Controls){var d=(new String(a.Controls)).split(",");b=d3.select(b).select("table").select("tbody");b.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+a.Name);for(a=0;a<d.length;a++)if(d[a]&&""!=d[a]){var c=d[a].split(";"),g=b.append("tr").append("td"),e=c[0].substr(5);3<c.length&&0===c[3].indexOf("Default=")&&c[3].substr(8);if(0===c[1].toLowerCase().indexOf("select")){g.append("text").text(e+": ");e=c[1].split(":");c=c[2].split("}");for(var h=
f.trackClass+f.level+"Select",l=g.append("select").attr("id",h).attr("name",e[1]),n=0;n<c.length;n++){var q=c[n].substr(1).split(":");2==q.length&&(g=l.append("option").attr("value",q[1]).text(q[0]),q[1]==f.strands&&g.attr("selected","selected"))}d3.select("select#"+h).on("change",function(){f.updateSettingsFromUI();f.redraw()})}else if(0===c[1].toLowerCase().indexOf("cbx"))for(g.append("text").text(e),e=c[1].split(":"),c=c[2].split("}"),n=0;n<c.length;n++)if(q=c[n].substr(1).split(":"),2===q.length){h=
g.append("div").style("display","inline-block");var u="",v="";2<e.length&&(v=e[2]);3<e.length&&(u=e[3]);l=h.append("input").attr("type","checkbox").attr("id",f.trackClass+v+"CBX"+f.level+u).attr("name",e[1]).style("margin-left","5px");h.append("text").text(q[0]);1==f.includeAA?$("#"+f.trackClass+v+"CBX"+f.level+u).prop("checked",!0):$("#"+f.trackClass+v+"CBX"+f.level+u).prop("checked",!1);d3.select("input#"+f.trackClass+v+"CBX"+f.level+u).on("change",function(){f.updateSettingsFromUI();f.redraw()})}}d=
b.append("tr").append("td");d.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");f.gsvg.removeTrack(f.trackClass);f.gsvg.setCurrentViewModified();var y=svgList[f.gsvg.levelNumber].currentView.ViewID,w=viewMenu[f.gsvg.levelNumber].findTrackByClass(f.trackClass,y);w=viewMenu[f.gsvg.levelNumber].findTrackIndexWithViewID(w.TrackID,y);viewMenu[f.gsvg.levelNumber].removeTrackWithIDIdx(w,
y)});d.append("input").attr("type","button").attr("value","Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");f.strands==f.prevSetting.strands&&f.includeAA==f.prevSetting.includeAA||f.gsvg.setCurrentViewModified()});d.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){f.revertPrevious();f.draw(f.data);$("#trackSettingDialog").fadeOut("fast")})}else b=
d3.select(b).select("table").select("tbody"),b.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+a.Name),b.append("tr").append("td").html("Sorry no settings for this track."),d=b.append("tr").append("td"),d.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")}),d.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left",
"5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")})};f.createCodon();f.updateData(0);f.draw(t);return f}
function GeneTrack(p,m,r,t,f){var b=Track(p,m,r,t);b.counts=[{value:0,names:"Ensembl"},{value:0,names:"Brain RNA-Seq"}];p=new String(f);b.drawAs="Gene";b.trxCutoff=1E5;p=new String(f);b.xScale.domain();b.xScale.domain();-1<p.indexOf("DrawTrx")&&(b.drawAs="Trx");b.density=3;b.dataVer=0;b.reqDataVer=0;b.ttTrackList=[];-1===b.trackClass.indexOf("smallnc")?(b.ttTrackList.push("ensemblcoding"),b.ttTrackList.push("braincoding"),b.ttTrackList.push("brainTotal"),b.ttTrackList.push("liverTotal"),b.ttTrackList.push("heartTotal"),
b.ttTrackList.push("kidneyTotal"),b.ttTrackList.push("mergedTotal"),b.ttTrackList.push("refSeq"),b.ttTrackList.push("ensemblnoncoding"),b.ttTrackList.push("brainnoncoding")):(b.ttTrackList.push("ensemblsmallnc"),b.ttTrackList.push("brainsmallnc"),b.ttTrackList.push("liversmallnc"),b.ttTrackList.push("heartsmallnc"),b.ttTrackList.push("refSeq"));b.ttTrackList.push("repeatMask");b.ttTrackList.push("snpSHRH");b.ttTrackList.push("snpBNLX");b.ttTrackList.push("snpF344");b.ttTrackList.push("snpSHRJ");"braincoding"===
r?(b.ttTrackList.push("spliceJnct"),b.ttTrackList.push("illuminaPolyA")):0===r.indexOf("liverTotal")?(b.ttTrackList.push("liverspliceJnct"),b.ttTrackList.push("liverilluminaTotalPlus"),b.ttTrackList.push("liverilluminaTotalMinus")):"heartTotal"===r?(b.ttTrackList.push("heartspliceJnct"),b.ttTrackList.push("heartilluminaTotalPlus"),b.ttTrackList.push("heartilluminaTotalMinus")):0===r.indexOf("brainTotal")?(b.ttTrackList.push("brainspliceJnct"),b.ttTrackList.push("brainilluminaTotalPlus"),b.ttTrackList.push("brainilluminaTotalMinus")):
"brainsmallnc"===r?b.ttTrackList.push("illuminaSmall"):"heartsmallnc"===r?b.ttTrackList.push("heartilluminaSmall"):"liversmallnc"===r&&b.ttTrackList.push("liverilluminaSmall");b.pieColorPalette=d3.scaleOrdinal(d3.schemeCategory20);b.cleanID=function(a){return a=a.replace(/\./g,"_")};b.color=function(a){var d="#000000";"ensemblcoding"===b.trackClass?d="#DFC184":"braincoding"===b.trackClass?(d="#7EB5D6",null!==a.getAttribute("strain")&&"undefined"!==typeof a.getAttribute("strain")&&"All"!==a.getAttribute("strain")&&
(d=b.strainSpecColor(d,a))):"ensemblnoncoding"===b.trackClass?d="#B58AA5":"brainnoncoding"===b.trackClass?(d="#CECFCE",null!==a.getAttribute("strain")&&"undefined"!==typeof a.getAttribute("strain")&&"BNLX"===a.getAttribute("strain").toUpperCase()?d="#3E75FF":null===a.getAttribute("strain")||"undefined"===typeof a.getAttribute("strain")||"SHR"!==a.getAttribute("strain").toUpperCase()&&"SHRH"!==a.getAttribute("strain").toUpperCase()||(d="#FE7596")):"ensemblsmallnc"===b.trackClass?d="#FFCC00":"brainsmallnc"===
b.trackClass?(d="#3E7596",null!==a.getAttribute("strain")&&"undefined"!==typeof a.getAttribute("strain")&&"All"!==a.getAttribute("strain")&&(d=b.strainSpecColor(d,a))):0===b.trackClass.indexOf("liverTotal")?(d="#bbbedd",0<b.trackClass.indexOf("_F344Stm")?d="#abaefd":0<b.trackClass.indexOf("_LEStm")&&(d="#dbaecd"),null!==a.getAttribute("strain")&&"undefined"!==typeof a.getAttribute("strain")&&"All"!==a.getAttribute("strain")&&(d=b.strainSpecColor(d,a))):"heartTotal"===b.trackClass?(d="#DC7252",null!==
a.getAttribute("strain")&&"undefined"!==typeof a.getAttribute("strain")&&"All"!==a.getAttribute("strain")&&(d=b.strainSpecColor(d,a))):"kidneyTotal"===b.trackClass?(d="#fdb462",null!==a.getAttribute("strain")&&"undefined"!==typeof a.getAttribute("strain")&&"All"!==a.getAttribute("strain")&&(d=b.strainSpecColor(d,a))):0===b.trackClass.indexOf("brainTotal")?(d="#7EB5D6",0<b.trackClass.indexOf("_F344Stm")?d="#6EA5F6":0<b.trackClass.indexOf("_LEStm")&&(d="#9EA5C6"),null!==a.getAttribute("strain")&&"undefined"!==
typeof a.getAttribute("strain")&&"All"!==a.getAttribute("strain")&&(d=b.strainSpecColor(d,a))):"liversmallnc"===b.trackClass?(d="#7b7e9d",null!==a.getAttribute("strain")&&"undefined"!==typeof a.getAttribute("strain")&&"All"!==a.getAttribute("strain")&&(d=b.strainSpecColor(d,a))):"heartsmallnc"===b.trackClass?(d="#9C3212",null!==a.getAttribute("strain")&&"undefined"!==typeof a.getAttribute("strain")&&"All"!==a.getAttribute("strain")&&(d=b.strainSpecColor(d,a))):"mergedTotal"===b.trackClass&&(d="#9F4F92");
return d=d3.rgb(d)};b.strainSpecColor=function(a,d){var c=parseInt(a.substr(1,2),16),g=parseInt(a.substr(3,2),16);a=parseInt(a.substr(5),16);"BNLX"===d.getAttribute("strain").toUpperCase()?(a+=64,c-=32,g-=32):"SHR"===d.getAttribute("strain").toUpperCase()||"SHRH"===d.getAttribute("strain").toUpperCase()?(c+=64,a-=32,g-=32):"F344_ST"===d.getAttribute("strain").toUpperCase()?(a+=32,c-=16,g-=16):"LE_ST"===d.getAttribute("strain").toUpperCase()&&(c+=32,a-=16,g-=16);255<c&&(c=255);255<g&&(g=255);255<a&&
(a=255);return"#"+c.toString(16)+g.toString(16)+a.toString(16)};b.pieStrainSpecColor=function(a,d){var c=parseInt(a.substr(1,2),16),g=parseInt(a.substr(3,2),16);a=parseInt(a.substr(5),16);if("BNLX"===d.toUpperCase())a+=64,c-=32,g-=32;else if("SHR"===d.toUpperCase()||"SHRH"===d.toUpperCase())c+=64,a-=32,g-=32;255<c&&(c=255);255<g&&(g=255);255<a&&(a=255);return a="#"+c.toString(16)+g.toString(16)+a.toString(16)};b.pieColor=function(a,d){d="#000000";"ensemblcoding"===b.trackClass?d="#DFC184":"braincoding"===
b.trackClass?d=b.pieStrainSpecColor("#7EB5D6",a.data.names):"ensemblnoncoding"===b.trackClass?d="#B58AA5":"brainnoncoding"===b.trackClass?(d="#CECFCE",null!==a.data.names&&"undefined"!==typeof a.data.names&&"BNLX"===a.data.names.toUpperCase()?d="#3E75FF":null===a.data.names||"undefined"===typeof a.data.names||"SHR"!==a.data.names.toUpperCase()&&"SHRH"!==a.data.names.toUpperCase()||(d="#FE7596")):"ensemblsmallnc"===b.trackClass?d=b.pieColorPalette(a.data.names):"brainsmallnc"===b.trackClass?d=b.pieStrainSpecColor("#99CC99",
a.data.names):0===b.trackClass.indexOf("liverTotal")?d=b.pieStrainSpecColor("#bbbedd",a.data.names):"heartTotal"===b.trackClass?d=b.pieStrainSpecColor("#DC7252",a.data.names):"kidneyTotal"===b.trackClass?d="#fdb462":0===b.trackClass.indexOf("brainTotal")?d=b.pieStrainSpecColor("#7EB5D6",a.data.names):"liversmallnc"===b.trackClass?d=b.pieStrainSpecColor("#8b8ead",a.data.names):"heartsmallnc"===b.trackClass?d=b.pieStrainSpecColor("#BC5232",a.data.names):"mergedTotal"===b.trackClass&&(d="#9F4F92");return d=
d3.rgb(d)};b.getDisplayID=function(a){-1<b.trackClass.indexOf("smallnc")||-1<a.indexOf("_")&&(a=a.substr(a.indexOf("_")+1));return a};b.createToolTip=function(a){var d="";if(-1<b.trackClass.indexOf("smallnc")){d="Known - "+a.getAttribute("biotype");var c=".";1==a.getAttribute("strand")?c="+":-1==a.getAttribute("strand")&&(c="-");if(0===(new String(a.getAttribute("ID"))).indexOf("P")){var g=getAllChildrenByName(getFirstChildByName(a,"TranscriptList"),"Transcript");getAllChildrenByName(getFirstChildByName(a,
"StrainQuantList"),"Strains")[1].getAttribute("strain");d=g[0].getAttribute("category")+" - "+g[0].getAttribute("source")}g='<BR><div id="ttSVG" style="background:#FFFFFF;"></div>ID: '+a.getAttribute("ID");-1===b.trackClass.indexOf("ensembl")&&(g=g+"<BR>PhenoGen ID: "+a.getAttribute("intGeneID"));g=g+"<BR>Length: "+(a.getAttribute("stop")-a.getAttribute("start"))+"<BR>Type:"+d+"<BR>Location: "+a.getAttribute("chromosome")+":"+numberWithCommas(a.getAttribute("start"))+"-"+numberWithCommas(a.getAttribute("stop"))+
"<BR>Strand: "+c+"<BR>"}else{var e=a.getAttribute("ID");e=b.getDisplayID(e);var h="";a.getAttribute("geneSymbol")?h=a.getAttribute("geneSymbol"):a.parent&&a.parent.getAttribute("geneSymbol")&&(h=a.parent.getAttribute("geneSymbol"));c=".";1==a.getAttribute("strand")?c="+":-1==a.getAttribute("strand")&&(c="-");if(a.parent){g=getAllChildrenByName(getFirstChildByName(a.parent,"TranscriptList"),"Transcript");for(var l=0;l<g.length;l++){var n=new String(g[l].getAttribute("ID"));e!=n&&(-1<(new String(g[l].getAttribute("ID"))).indexOf("ENS")?
d+="<B>"+n+"</B>":(d+="<B>"+n+"</B>",-1==(new String(g[l].getAttribute("ID"))).indexOf("ENS")&&(n=getFirstChildByName(getFirstChildByName(g[l],"annotationList"),"annotation"),null!=n&&(d+=" - "+n.getAttribute("reason")))),d+="<br>");if(""==h){n=getAllChildrenByName(getFirstChildByName(g[l],"annotationList"),"annotation");for(var q=0;q<n.length&&""==h;q++)"AKA"==n[q].getAttribute("source")&&(h=n[q].getAttribute("annot_value"),h=(new String(h)).split(":"),h=0!=(new String(h[h.length-1])).indexOf("ENS")?
h[h.length-1]:h[0])}}g='<BR><div id="ttSVG" style="background:#FFFFFF;overflow:"></div><BR>Transcript ID: '+e+"<BR>Location: "+a.getAttribute("chromosome")+":"+numberWithCommas(a.getAttribute("start"))+"-"+numberWithCommas(a.getAttribute("stop"))+"<BR>Strand: "+c;g=g+"<BR><BR>Gene Symbol: "+h+"<BR>Gene ID: "+b.getDisplayID(a.parent.getAttribute("ID"))+"<BR><BR>Other Transcripts:<BR>"+d+"<BR>"}else{g=getAllChildrenByName(getFirstChildByName(a,"TranscriptList"),"Transcript");for(l=0;l<g.length;l++)if(n=
new String(g[l].getAttribute("ID")),-1<(new String(g[l].getAttribute("ID"))).indexOf("ENS")?d+="<B>"+n+"</B>":(d+="<B>"+n+"</B>",-1===(new String(g[l].getAttribute("ID"))).indexOf("ENS")&&(n=getFirstChildByName(getFirstChildByName(g[l],"annotationList"),"annotation"),null!=n&&(d+=" - "+n.getAttribute("reason")))),d+="<br>",0===h.length)for(n=getAllChildrenByName(getFirstChildByName(g[l],"annotationList"),"annotation"),q=0;q<n.length&&0===h.length;q++)"AKA"===n[q].getAttribute("source")&&(h=n[q].getAttribute("annot_value"),
h=(new String(h)).split(":"),h=0!==(new String(h[h.length-1])).indexOf("ENS")?h[h.length-1]:h[0]);g='<BR><div id="ttSVG" style="background:#FFFFFF;overflow:scroll;max-height:400px;"></div>Gene ID: '+e+"<BR>Gene Symbol: "+h+"<BR>Location: "+a.getAttribute("chromosome")+":"+numberWithCommas(a.getAttribute("start"))+"-"+numberWithCommas(a.getAttribute("stop"))+"<BR>Strand: "+c+"<BR><BR>Transcripts:<BR>"+d+"<BR>"}if(("brainTotal"===b.trackClass||"liverTotal"===b.trackClass||"kidenyTotal"===b.trackClass)&&
(-1<a.getAttribute("ID").indexOf("PRN6")||-1<a.getAttribute("ID").indexOf("PRN6"))){c="Gene";if(-1<a.getAttribute("ID").indexOf("PRN6T")||-1<a.getAttribute("ID").indexOf("PRN6.5T"))c="Transcript";g=g+'<div>Heritability: <span id="ttsingleHerit"></span></div>'+c+' Expression:<BR><div style="text-align:center;">Median Estimated Counts Per Million</div><div id="ttChart"></div>';d="Brain";e="Whole Brain";"liverTotal"===b.trackClass?e=d="Liver":"kidneyTotal"===b.trackClass&&(e=d="Kidney");tmpChart=chart({data:"tmpData/browserCache/"+
genomeVer+"/regionData/"+b.gsvg.folderName+"/"+d+"expr.json",selector:"#ttChart",allowResize:!1,type:"scatter",width:"400",height:"275",displayHerit:!1,displayControls:!1,title:c+" Expression",titlePrefix:e,filterID:a.getAttribute("ID")})}}return g};b.redraw=function(){b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(var a=0;a<b.gsvg.width;a++)b.yMaxArr[a]=0,b.yArr[0][a]=0;b.trackYMax=0;a=b.xScale.domain()[0];a=b.xScale.domain()[1]-a;var d=0;if(b.reqDataVer!==b.dataVer)b.updateDataVersion(b.reqDataVer,0);
else if("undefined"!==typeof b.prevSetting&&b.prevSetting.density!==b.density)b.draw(b.data);else if(a<b.trxCutoff&&"Gene"===b.drawnAs||a>=b.trxCutoff&&"Trx"===b.drawnAs&&"Trx"!==b.drawAs||"Gene"===b.drawnAs&&$("#forceTrxCBX"+b.gsvg.levelNumber).is(":checked"))b.draw(b.data);else if(a<b.trxCutoff&&"Trx"===b.drawnAs&&"Trx"!==b.drawAs&&(d=1),"Gene"===b.drawAs&&0===d||-1<b.trackClass.indexOf("smallnc"))b.svg&&(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").attr("transform",function(c,
g){return"translate("+b.xScale(c.getAttribute("start"))+","+b.calcY(parseInt(c.getAttribute("start"),10),parseInt(c.getAttribute("stop"),10),g)+")"}),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene rect").attr("width",function(c){var g=1;1<b.xScale(c.getAttribute("stop"))-b.xScale(c.getAttribute("start"))&&(g=b.xScale(c.getAttribute("stop"))-b.xScale(c.getAttribute("start")));return g}).attr("stroke",b.colorStroke),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").each(function(c){var g=
d3.select(this),e=parseInt(c.getAttribute("strand"),10);if(-1===e||1===e){var h=">";-1===e&&(h="<");e="";var l=g.select("rect").attr("width");if(8.3<=l&&15.8>=l)e=h;else for(;8.5<l;)e+=h,l-=8.5;g.select("text#strandTxt").text(e)}if(2===b.density){var n=c.getAttribute("ID");c.getAttribute("geneSymbol")&&0<c.getAttribute("geneSymbol").length&&(n=n+" ("+c.getAttribute("geneSymbol")+")");0===g.select("text#lblTxt").size()?g.append("svg:text").attr("dx",function(){var q=b.xScale(c.getAttribute("start"));
return q=q<$(window).width()/2?b.xScale(c.getAttribute("stop"))-b.xScale(c.getAttribute("start"))+5:-9*n.length}).attr("dy",10).attr("id","lblTxt").text(n):g.select("text#lblTxt").attr("dx",function(){var q=b.xScale(c.getAttribute("start"));return q=q<$(window).width()/2?b.xScale(c.getAttribute("stop"))-b.xScale(c.getAttribute("start"))+5:-9*n.length})}else g.select("text#lblTxt").remove()})),1===b.density?b.svg.attr("height",30):2===b.density?b.svg.attr("height",15*(b.trackYMax+1)):3===b.density&&
b.svg.attr("height",15*(b.trackYMax+1));else if(1===d||"Trx"===b.drawAs)b.svg.selectAll(".trx"+b.gsvg.levelNumber).attr("transform",function(c,g){return"translate(0,"+b.calcY(parseInt(c.getAttribute("start"),10),parseInt(c.getAttribute("stop"),10),g)+")"}).each(function(c,g){g=parseInt(c.getAttribute("start"),10);var e=parseInt(c.getAttribute("stop"),10);c.getAttribute("cdsStart")&&c.getAttribute("cdsStop")&&(g=parseInt(c.getAttribute("cdsStart"),10),e=parseInt(c.getAttribute("cdsStop"),10));exList=
getAllChildrenByName(getFirstChildByName(c,"exonList"),"exon");var h="";1===b.gsvg.levelNumber?h="tx":99===b.gsvg.levelNumber&&(h="ttTx");for(var l=0;l<exList.length;l++){var n=exList[l].getAttribute("start"),q=exList[l].getAttribute("stop");if(n<g&&g<q||q>e&&e>n){var u=n,v=g;q>e?(u=e,v=q,q=e):n=g;d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g#"+h+b.cleanID(c.getAttribute("ID"))+b.gsvg.levelNumber+" rect#ExNC"+exList[l].getAttribute("ID")).attr("x",function(D){return b.xScale(u)}).attr("width",
function(D){return b.xScale(v)-b.xScale(u)})}d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g#"+h+b.cleanID(c.getAttribute("ID"))+b.gsvg.levelNumber+" rect#Ex"+exList[l].getAttribute("ID")).attr("x",function(D){return b.xScale(n)}).attr("width",function(D){return b.xScale(q)-b.xScale(n)});if(0<l){var y=">";"-1"==c.getAttribute("strand")&&(y="<");var w=y,C=b.xScale(exList[l-1].getAttribute("stop")),B=b.xScale(exList[l].getAttribute("start")),E=B-C,G=0;if(7>E||"0"==c.getAttribute("strand")||"."==
c.getAttribute("strand"))w="";else for(E-=7;8<E;)0===G?(w+=" ",G=1):(w+=y,G=0),E-=7;d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g.trx"+b.gsvg.levelNumber+"#"+h+b.cleanID(c.getAttribute("ID"))+b.gsvg.levelNumber+" line#Int"+exList[l-1].getAttribute("ID")+"_"+exList[l].getAttribute("ID")).attr("x1",C).attr("x2",B);d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g.trx"+b.gsvg.levelNumber+"#"+h+b.cleanID(c.getAttribute("ID"))+b.gsvg.levelNumber+" #IntTxt"+exList[l-1].getAttribute("ID")+
"_"+exList[l].getAttribute("ID")).attr("dx",C+1).text(w)}}if(2===b.density){var z=c.getAttribute("ID");c.getAttribute("geneSymbol")&&0<c.getAttribute("geneSymbol").length&&(z=z+" ("+c.getAttribute("geneSymbol")+")");0===d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g.trx"+b.gsvg.levelNumber+"#"+h+b.cleanID(c.getAttribute("ID"))+b.gsvg.levelNumber+" text#lblTxt").size()?d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g.trx"+b.gsvg.levelNumber+"#"+h+b.cleanID(c.getAttribute("ID"))+b.gsvg.levelNumber).append("svg:text").attr("dx",
function(){var D=b.xScale(c.parent.getAttribute("start"));return D=D<$(window).width()/2?b.xScale(c.parent.getAttribute("stop"))-b.xScale(c.parent.getAttribute("start"))+5:-9*z.length}).attr("dy",10).attr("id","lblTxt").text(z):d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g.trx"+b.gsvg.levelNumber+"#"+h+b.cleanID(c.getAttribute("ID"))+b.gsvg.levelNumber+" text#lblTxt").attr("dx",function(){var D=b.xScale(c.getAttribute("start"));return D=D<$(window).width()/2?b.xScale(c.getAttribute("stop"))-
b.xScale(c.getAttribute("start"))+5:-9*z.length})}else d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g.trx"+b.gsvg.levelNumber+"#"+h+b.cleanID(c.getAttribute("ID"))+b.gsvg.levelNumber+" text#lblTxt").remove()}),1===b.density?b.svg.attr("height",30):2===b.density?b.svg.attr("height",15*(b.trackYMax+1)):3===b.density&&b.svg.attr("height",15*(b.trackYMax+1));b.redrawSelectedArea()};b.setSelected=function(a){if(a)if(0<d3.selectAll("g.gene").size()){if(d3.selectAll("rect.selected").each(function(){d3.select(this).attr("class",
"").style("fill",b.color)}),a=d3.select("g.gene rect#"+a))a.attr("class","selected").style("fill","green"),b.setupDetailedView(a.data()[0]),selectGene=""}else 0<d3.selectAll("g.trx"+b.gsvg.levelNumber).size()&&(a=(new String(a)).replace(".","_"),b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("line").style("stroke",b.color),b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("rect").style("fill",b.color),b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("text").style("opacity",
"0.6").style("fill",b.color),b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").each(function(){var d=new String($(this).attr("class"));d=d.replace(" selected","");$(this).attr("class",d)}),b.svg.selectAll("g.gene"+a).each(function(){var d=$(this).attr("class")+" selected";$(this).attr("class",d)}),b.svg.selectAll("g.gene"+a).selectAll("line").style("stroke","green"),b.svg.selectAll("g.gene"+a).selectAll("rect").style("fill","green"),b.svg.selectAll("g.gene"+a).selectAll("text").style("opacity",
"0.3").style("fill","green"),b.svg.selectAll("g.gene"+a)&&((a=b.svg.selectAll("g.gene"+a).data())&&0<a.length?b.setupDetailedView(a[0].parent):(console.log("tmp[0]"),console.log(a))),selectGene="")};b.clearSelection=function(){b.selectionStart=-1;b.selectionEnd=-1;b.svg.selectAll("rect.selectedArea").remove();0<b.svg.selectAll("g.gene").size()?b.svg.selectAll("rect.selected").each(function(a){d3.select(this).attr("class","").style("fill",b.color)}):0<b.svg.selectAll("g.trx"+b.gsvg.levelNumber).size()&&
(b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("line").style("stroke",b.color),b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("rect").style("fill",b.color),b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("text").style("opacity","0.6").style("fill",b.color),b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").each(function(){var a=new String($(this).attr("class"));a=a.replace(" selected","");$(this).attr("class",a)}))};b.setupDetailedView=
function(a){if(a){b.gsvg.clearSelection();jQuery.Event("keyup").which=32;var d=b.gsvg.levelNumber+1;$("div#collapsableReport").is(":hidden")||($("div#collapsableReport").hide(),$("span[name='collapsableReport']").removeClass("less"));$("div#selectedDetailHeader").is(":hidden")&&$("div#selectedDetailHeader").show();$("div#selectedDetail").is(":hidden")&&$("div#selectedDetail").show();var c="none";0===b.trackClass.indexOf("brainTotal")||0===b.trackClass.indexOf("liverTotal")||"heartTotal"===b.trackClass||
"mergedTotal"===b.trackClass?c=b.trackClass:"protein_coding"===a.getAttribute("biotype")&&200<=a.getAttribute("stop")-a.getAttribute("start")?c="protein":"protein_coding"!==a.getAttribute("biotype")&&200<=a.getAttribute("stop")-a.getAttribute("start")?c="long":200>a.getAttribute("stop")-a.getAttribute("start")&&(c="small");var g=0,e=0;if("protein"===c||"long"===c||0===c.indexOf("liverTotal")||"heartTotal"===c||0===c.indexOf("brainTotal")||"mergedTotal"===c||"kidneyTotal"===c||"small"===c&&"rn5"!==
genomeVer||"small"===c&&-1<(new String(a.getAttribute("ID"))).indexOf("ENS")){console.log("totalType");g=a.getAttribute("ID");var h="";if(a.getAttribute("geneSymbol")&&0<a.getAttribute("geneSymbol").length)g=g+" ("+a.getAttribute("geneSymbol")+")";else{e=getAllChildrenByName(getFirstChildByName(a,"TranscriptList"),"Transcript");for(var l=0;l<e.length&&""===h;l++)if(""===h)for(var n=getAllChildrenByName(getFirstChildByName(e[l],"annotationList"),"annotation"),q=0;q<n.length&&0===h.length;q++)if("AKA"===
n[q].getAttribute("source")){var u=n[q].getAttribute("annot_value");u=(new String(u)).split(":");1<=u.length?(h=u[0],g=g+" ("+h+")"):2<=u.length&&(h=u[0],u=u[1],g=g+" ("+u+")")}}e=parseInt(a.getAttribute("start"),10);n=parseInt(a.getAttribute("stop"),10);a.getAttribute("extStart")&&a.getAttribute("extStop")&&(e=parseInt(a.getAttribute("extStart"),10),n=parseInt(a.getAttribute("extStop"),10));svgViewIDList[d]||(svgViewIDList[d]=b.gsvg.currentView?b.gsvg.currentView.ViewID:defaultView);l=GenomeSVG("div#selectedImage",
b.gsvg.width,e,n,d,g,"transcript");l.xMin=e-.05*(n-e);l.xMax=n+.05*(n-e);g=l.xMin;e=l.xMax;svgList[d]=l;svgList[d].txType=c;svgList[d].selectedData=a;selectedGeneSymbol=a.getAttribute("geneSymbol");b.gsvg.selectedGeneSymbol=a.getAttribute("geneSymbol");selectedID=new String(a.getAttribute("ID"));-1===selectedID.indexOf("ENS")&&0<h.length&&(selectedID=h);$("div#selectedImage").show();console.log("here");-1<(new String(selectedID)).indexOf("ENS")&&-1<b.trackClass.indexOf("ensembl")?(console.log("geneReport"),
$("div#selectedReport").show(),d=pathPrefix+"geneReport.jsp",a={id:selectedID,geneSymbol:selectedGeneSymbol,chromosome:chr,species:organism,genomeVer},DisplaySelectedDetailReport(d,a)):"small"!==c?$("div#selectedReport").html("<BR><BR>Detailed Gene Reports are not currently provided for RNA-Seq(Cufflinks) generated genes that are novel and have not been matched to an existing annotated gene.  In the future overlapping probesets and SNPs will be summarized in the same manner.  This feature should be added by December 2014.  Please keep checking back or let us know you'd like to see it sooner."):
"rn6"===genomeVer&&(a=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/"+b.trackClass+".xml",d=pathPrefix+"smallRNAReport.jsp",a={dataPath:a,id:selectedID},DisplaySelectedDetailReport(d,a))}else"small"===c&&-1===(new String(a.getAttribute("ID"))).indexOf("ENS")&&"rn5"===genomeVer&&($("div#selectedImage").hide(),$("div#selectedReport").show(),g=a.getAttribute("start"),e=a.getAttribute("stop"),d=pathPrefix+"viewSmallNonCoding.jsp",a={id:a.getAttribute("ID"),name:"smRNA_"+
a.getAttribute("ID")},DisplaySelectedDetailReport(d,a));b.gsvg&&b.gsvg.selectSvg&&b.gsvg.selectSvg.changeSelection(g,e);$("html, body").animate({scrollTop:$("#selectedDetail").offset().top},200)}};b.getDisplayedData=function(){var a=[],d=0,c=[];if(-1<b.trackClass.indexOf("smallnc")){var g=0;b.counts=[];b.trackClass.indexOf("ensembl");"Gene"===b.drawnAs?c=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene"):"Trx"===b.drawnAs&&(c=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.trx"));
c.each&&c.each(function(h){var l=b.xScale(h.getAttribute("start")),n=b.xScale(h.getAttribute("stop"));if(0<=l&&l<=b.gsvg.width||0<=n&&n<=b.gsvg.width||0>=l&&n>=b.gsvg.width)l="Ensembl","undefined"!==typeof h.getAttribute("strain")?l=h.getAttribute("strain"):"undefined"!==typeof h.getAttribute("biotype")&&(l=h.getAttribute("biotype")),"undefined"===typeof b.counts[l]?(b.counts[l]={},b.counts[g]=b.counts[l],g++,b.counts[l].value=1,b.counts[l].names=l):b.counts[l].value++,a[d]=h,d++,e++})}else if("Gene"===
b.drawnAs)c=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene"),b.counts=[{value:0,names:"Ensembl"},{value:0,names:"Brain RNA-Seq"},{value:0,names:"Liver RNA-Seq"},{value:0,names:"Heart RNA-Seq"},{value:0,names:"Merged RNA-Seq"}],c.each(function(h){var l=b.xScale(h.getAttribute("start")),n=b.xScale(h.getAttribute("stop"));if(0<=l&&l<=b.gsvg.width||0<=n&&n<=b.gsvg.width)-1<(new String(h.childNodes[0].id)).indexOf("ENS")?b.counts[0].value++:-1<b.trackClass.indexOf("brain")?b.counts[1].value++:
-1<b.trackClass.indexOf("liver")?b.counts[2].value++:-1<b.trackClass.indexOf("heart")?b.counts[3].value++:-1<b.trackClass.indexOf("merged")&&b.counts[4].value++,a[d]=h,d++}),0===c.size()&&(b.counts=[]);else if("Trx"===b.drawnAs){c=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.trx"+b.gsvg.levelNumber);b.counts=[];var e=g=0;c.each(function(h){var l=b.xScale(h.getAttribute("start")),n=b.xScale(h.getAttribute("stop"));if(0<=l&&l<=b.gsvg.width||0<=n&&n<=b.gsvg.width||0>=l&&n>=b.gsvg.width)l=
"Ensembl","undefined"!==typeof h.getAttribute("strain")&&(l=h.getAttribute("strain")),"undefined"===typeof b.counts[l]?(b.counts[l]={},b.counts[g]=b.counts[l],g++,b.counts[l].value=1,b.counts[l].names=l):b.counts[l].value++,a[d]=h,d++,e++})}return a};b.updateData=function(a){d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/"+b.trackClass+".xml",function(d,c){if(d){if(0===a&&(0===b.trackClass.indexOf("heartTotal")||0===b.trackClass.indexOf("liverTotal")||0===b.trackClass.indexOf("brainTotal")||
0===b.trackClass.indexOf("kidneyTotal")||"mergedTotal"===b.trackClass||-1<b.trackClass.indexOf("smallnc"))){d="/"+pathPrefix;pathPrefix||(d="");c=b.trackClass;var g=panel;(0===b.trackClass.indexOf("liverTotal")||0===b.trackClass.indexOf("brainTotal"))&&0<b.trackClass.indexOf("_")&&(g=track.substr(track.indexOf("_")+1),"LEStm"===g&&(g="LE-Stm"),"F344Stm"===g&&(g="F344-Stm"));$.ajax({url:d+"generateTrackXML.jsp",type:"GET",cache:!1,asyn:!0,data:{chromosome:chr,minCoord:b.gsvg.xScale.domain()[0],maxCoord:b.gsvg.xScale.domain()[1],
panel:g,rnaDatasetID,arrayTypeID,myOrganism:organism,genomeVer,track:c,folder:b.gsvg.folderName},dataType:"json",success:function(l){gtag("event","generateTrackGene",{event_category:"browser"})},error:function(l,n,q){}})}10>a?(d=2E3,1===a&&(d=5E3),setTimeout(function(){b.updateData(a+1)},d)):(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+b.trackClass),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).attr("height",15),b.gsvg.addTrackErrorRemove(b.svg,
"#Level"+b.gsvg.levelNumber+b.trackClass))}else if(c){d=c.documentElement.getElementsByTagName("Gene");c=[];g=[];for(var e=0,h=0;h<d.length;h++)d[h]&&(c[e]=d[h],g[d[h].getAttribute("ID")]=1,e++);for(h=0;h<b.data.length;h++)b.data[h]&&!g[b.data[h].getAttribute("ID")]&&(c[e]=b.data[h],e++);b.draw(c);b.hideLoading();setTimeout(function(){DisplayRegionReport()},300)}else b.hideLoading()})};b.updateDataVersion=function(a,d){var c=b.trackClass+"_"+a;d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+
b.gsvg.folderName+"/"+c+".xml",function(g,e){g?(0===d&&(g="/"+pathPrefix,pathPrefix||(g=""),e=panel,(0===track.indexOf("liverTotal")||0===track.indexOf("brainTotal"))&&0<track.indexOf("_")&&(e=track.substr(track.indexOf("_")+1),"LEStm"===e&&(e="LE-Stm"),"F344Stm"===e&&(e="F344-Stm")),$.ajax({url:g+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:b.gsvg.xScale.domain()[0],maxCoord:b.gsvg.xScale.domain()[1],panel:e,rnaDatasetID,arrayTypeID,myOrganism:organism,genomeVer,
track:c,folder:b.gsvg.folderName},dataType:"json",success:function(h){gtag("event","generateTrackGene",{event_category:"browser"})},error:function(h,l,n){}})),5>d?(g=1E4,0===d&&(g=5E3),setTimeout(function(){b.updateDataVersion(a,d+1)},g)):(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+b.trackClass),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).attr("height",15),b.gsvg.addTrackErrorRemove(b.svg,"#Level"+b.gsvg.levelNumber+b.trackClass))):
(g=e.documentElement.getElementsByTagName("Gene"),e=parseInt(a),b.dataVer=e,b.draw(g),b.hideLoading(),setTimeout(function(){DisplayRegionReport()},300))})};b.drawTrx=function(a,d){d=parseInt(a.getAttribute("start"),10);var c=parseInt(a.getAttribute("stop"),10);a.getAttribute("cdsStart")&&a.getAttribute("cdsStop")&&(d=parseInt(a.getAttribute("cdsStart"),10),c=parseInt(a.getAttribute("cdsStop"),10));var g="";1===b.gsvg.levelNumber?g="tx":99===b.gsvg.levelNumber&&(g="ttTx");g=d3.select("#Level"+b.gsvg.levelNumber+
b.trackClass+" #"+g+b.cleanID(a.getAttribute("ID"))+b.gsvg.levelNumber);exList=getAllChildrenByName(getFirstChildByName(a,"exonList"),"exon");for(var e=0;e<exList.length;e++){var h=parseInt(exList[e].getAttribute("start"),10),l=parseInt(exList[e].getAttribute("stop"),10);if(h<d&&d<l||l>c&&c>h){var n=0,q=0,u=0,v=0;h<d?(n=b.xScale(h),q=b.xScale(d)-b.xScale(h),u=b.xScale(d),v=b.xScale(l)-b.xScale(d)):l>c&&(u=b.xScale(h),v=b.xScale(c)-b.xScale(h),n=b.xScale(c),q=b.xScale(l)-b.xScale(c));g.append("rect").attr("x",
n).attr("y",2.5).attr("height",5).attr("width",q).attr("title",function(w){return exList[e].getAttribute("ID")}).attr("id",function(w){return"ExNC"+exList[e].getAttribute("ID")}).style("fill",b.color).style("cursor","pointer");g.append("rect").attr("x",u).attr("height",10).attr("width",v).attr("title",function(w){return exList[e].getAttribute("ID")}).attr("id",function(w){return"Ex"+exList[e].getAttribute("ID")}).style("fill",b.color).style("cursor","pointer")}else{n=10;q=0;if(h<d&&l<d||l>c&&h>c)n=
5,q=2.5;g.append("rect").attr("x",function(w){return b.xScale(exList[e].getAttribute("start"))}).attr("y",q).attr("id",function(w){return"Ex"+exList[e].getAttribute("ID")}).attr("height",n).attr("width",function(w){return b.xScale(exList[e].getAttribute("stop"))-b.xScale(exList[e].getAttribute("start"))}).attr("title",function(w){return exList[e].getAttribute("ID")}).style("fill",b.color).style("cursor","pointer")}if(0<e&&(g.append("line").attr("x1",function(w){return b.xScale(exList[e-1].getAttribute("stop"))}).attr("x2",
function(w){return b.xScale(exList[e].getAttribute("start"))}).attr("y1",5).attr("y2",5).attr("id",function(w){return"Int"+exList[e-1].getAttribute("ID")+"_"+exList[e].getAttribute("ID")}).attr("stroke",b.color).attr("stroke-width","2"),"1"==a.getAttribute("strand")||"-1"==a.getAttribute("strand"))){h=">";if("-1"==a.getAttribute("strand")||"-"==a.getAttribute("strand"))h="<";l=h;n=b.xScale(exList[e-1].getAttribute("stop"));q=b.xScale(exList[e].getAttribute("start"))-n;u=0;if(7>q)l="";else for(q-=
7;8<q;)0==u?(l+=" ",u=1):(l+=h,u=0),q-=7;g.append("svg:text").attr("id",function(w){return"IntTxt"+exList[e-1].getAttribute("ID")+"_"+exList[e].getAttribute("ID")}).attr("dx",n+1).attr("dy","11").style("pointer-events","none").style("opacity","0.5").style("fill",b.color).style("font-size","16px").text(l)}}if(2==b.density){var y=a.getAttribute("ID");"undefined"!==typeof a.getAttribute("geneSymbol")&&0<a.getAttribute("geneSymbol").length&&(y=y+" ("+a.getAttribute("geneSymbol")+")");g.append("svg:text").attr("dx",
function(){var w=b.xScale(a.getAttribute("start"));return w=w<$(window).width()/2?b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start"))+5:-9*y.length}).attr("dy",10).attr("id","lblTxt").text(y)}else g.select("text#lblTxt").remove()};b.getSVGID=function(a){return b.getDisplayID(a.getAttribute("ID"))+" ("+a.getAttribute("geneSymbol")+")"};b.setupToolTipSVG=function(a,d){if("undefined"!==typeof a.getAttribute("extStart")&&null!==a.getAttribute("extStart")){var c=parseInt(a.getAttribute("extStart"),
10);var g=parseInt(a.getAttribute("extStop"),10)}else c=parseInt(a.getAttribute("start"),10),g=parseInt(a.getAttribute("stop"),10);d=Math.floor((g-c)*d);10>d&&(d=10);c-=d;g+=d;d=toolTipSVG("div#ttSVG",450,c,g,99,b.getSVGID(a),"transcript");d.xMin=c;d.xMax=g;var e="none";0===b.trackClass.indexOf("brainTotal")||0===b.trackClass.indexOf("liverTotal")||0===b.trackClass.indexOf("kidneyTotal")||"heartTotal"===b.trackClass||"mergedTotal"==b.trackClass?e=b.trackClass:200>parseInt(a.getAttribute("stop"),10)-
parseInt(a.getAttribute("start"),10)?e="small":"protein_coding"==a.getAttribute("biotype")&&200<=parseInt(a.getAttribute("stop"),10)-parseInt(a.getAttribute("start"),10)?e="protein":"protein_coding"!=a.getAttribute("biotype")&&200<=parseInt(a.getAttribute("stop"),10)-parseInt(a.getAttribute("start"),10)&&(e="long");d.txType=e;d.selectedData=a;e=[];e[0]=a;"undefined"!==typeof a.parent&&(e[0]=a.parent);d.addTrack(b.trackClass,2,"DrawTrx",e);for(a=0;a<b.ttTrackList.length;a++)if(b.trackClass!==b.ttTrackList[a]){e=
b.gsvg.getTrackData(b.ttTrackList[a]);var h=[];if("undefined"!==typeof e&&0<e.length){for(var l=0,n=0;n<e.length;n++)if(c<=parseInt(e[n].getAttribute("start"),10)&&parseInt(e[n].getAttribute("start"),10)<=g||c<=parseInt(e[n].getAttribute("stop"),10)&&parseInt(e[n].getAttribute("stop"),10)<=g||parseInt(e[n].getAttribute("start"),10)<=c&&parseInt(e[n].getAttribute("stop"),10)>=c)h[l]=e[n],l++;0<h.length&&d.addTrack(b.ttTrackList[a],3,"DrawTrx",h)}}};b.draw=function(a){b.data=a;b.trackYMax=0;b.yMaxArr=
[];b.yArr=[];b.yArr[0]=[];for(var d=0;d<b.gsvg.width;d++)b.yMaxArr[d]=0,b.yArr[0][d]=0;b.svg.selectAll(".gene").remove();d=b.drawAs;var c=b.xScale.domain()[0];if(b.xScale.domain()[1]-c<b.trxCutoff||$("#forceTrxCBX"+b.gsvg.levelNumber).is(":checked"))b.drawAs="Trx";c="Genes";"Trx"==b.drawAs&&(c="Transcripts");var g="Protein Coding",e=" / PolyA+";-1<b.trackClass.indexOf("noncoding")?(g="Long Non-Coding",e=" / Non-PolyA+"):-1<b.trackClass.indexOf("smallnc")?(g="Brain",-1<b.trackClass.indexOf("liver")?
g="Liver":-1<b.trackClass.indexOf("heart")&&(g="Heart"),g+=" Small RNA",e=""):0===b.trackClass.indexOf("liverTotal")?(g="Liver RNA-Seq  ",e="Total RNA"):"heartTotal"==b.trackClass?(g="Heart RNA-Seq Reconstruction ",e="Total RNA"):0===b.trackClass.indexOf("brainTotal")?(g="Whole Brain RNA-Seq Reconstruction ",e="Total RNA"):0===b.trackClass.indexOf("kidneyTotal")?(g="Kidney RNA-Seq Reconstruction ",e="Total RNA"):"mergedTotal"==b.trackClass&&(g="Merged (Brain,Heart,Liver,Kidney) Reconstructed",e="Total RNA");
g=-1<b.trackClass.indexOf("ensembl")?"Ensembl "+g+" "+c:-1===b.trackClass.indexOf("brainTotal")&&-1===b.trackClass.indexOf("liverTotal")&&"heartTotal"!=b.trackClass&&"mergedTotal"!=b.trackClass&&-1===b.trackClass.indexOf("kidenyTotal")?"Reconstruction "+g+e+" "+c:g+e+" "+c;(0===b.trackClass.indexOf("liverTotal")||0===b.trackClass.indexOf("brainTotal"))&&0<b.trackClass.indexOf("_")&&(c=b.trackClass.substr(b.trackClass.indexOf("_")+1),"LEStm"===c&&(c="LE-Stm"),"F344Stm"===c&&(c="F344-Stm"),g=c+" Filtered (>=1.0TPM) "+
g);b.updateLabel(g);b.redrawLegend();c=a;if("Trx"===b.drawAs&&-1===b.trackClass.indexOf("smallnc"))for(c=[],e=g=0;e<a.length;e++)if("undefined"!==typeof a[e])for(var h=getAllChildrenByName(getFirstChildByName(a[e],"TranscriptList"),"Transcript"),l=0;l<h.length;l++)c[g]=h[l],c[g].parent=a[e],g++;0<c.length&&("Gene"===b.drawAs||-1<b.trackClass.indexOf("smallnc")?(b.drawnAs="Gene",b.svg.selectAll(".trx0").each(function(){d3.select(this).remove()}),a=b.svg.selectAll(".gene").data(c,key).attr("transform",
function(n,q){return"translate("+b.xScale(n.getAttribute("start"))+","+b.calcY(parseInt(n.getAttribute("start"),10),parseInt(n.getAttribute("stop"),10),q)+")"}),a.enter().append("g").attr("class","gene").attr("transform",function(n,q){return"translate("+b.xScale(n.getAttribute("start"))+","+b.calcY(parseInt(n.getAttribute("start"),10),parseInt(n.getAttribute("stop"),10),q)+")"}).merge(a).append("rect").attr("height",10).attr("rx",1).attr("ry",1).attr("width",function(n){return b.xScale(n.getAttribute("stop"))-
b.xScale(n.getAttribute("start"))}).attr("title",function(n){return n.getAttribute("ID")}).attr("stroke",b.colorStroke).attr("stroke-width","1").attr("id",function(n){return b.cleanID(n.getAttribute("ID"))}).style("fill",b.color).style("cursor","pointer").on("click",function(n){setTimeout(function(){b.setupDetailedView(n);d3.select(this).attr("class","selected").style("fill","green")}.bind(this),10)}).on("dblclick",b.zoomToFeature).on("mouseover",function(n){0===b.gsvg.isToolTip&&(overSelectable=
1,$("#mouseHelp").html("<B>Click</B> to see additional details. <B>Double Click</B> to zoom in on this feature."),d3.select(this).style("fill","green"),tt.transition().duration(200).style("opacity",1).style("top",function(){return b.positionTTTop(d3.event.pageY)}).style("left",function(){return b.positionTTLeft(d3.event.pageX)}),tt.html(b.createToolTip(n)),n&&(b.triggerTableFilter(n),-1===b.trackClass.indexOf("smallnc")?"Trx"===b.drawAs?b.setupToolTipSVG(n.parent,.05):b.setupToolTipSVG(n,.05):b.setupToolTipSVG(n,
.05),tt.style("top",function(){return b.positionTTTop(d3.event.pageY)})))}).on("mouseout",function(n){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");"selected"!==d3.select(this).attr("class")&&d3.select(this).style("fill",b.color);tt.transition().delay(500).duration(200).style("opacity",0);b.clearTableFilter(n)}),a.exit().remove(),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").each(function(n){if(n){var q=d3.select(this);
if("-1"==n.getAttribute("strand")||"1"==n.getAttribute("strand")){var u=">";"-1"==n.getAttribute("strand")&&(u="<");var v=u,y=q.select("rect").attr("width");if(8.5>y)v="";else for(y-=8.5,v=u;8.7<y;)v+=u,y-=8.5;q.append("svg:text").attr("dx","1").attr("dy","10").attr("id","strandTxt").style("pointer-events","none").text(v)}if(2===b.density){var w=n.getAttribute("ID");n.getAttribute("geneSymbol")&&0<n.getAttribute("geneSymbol").length&&(w=w+" ("+n.getAttribute("geneSymbol")+")");q.append("svg:text").attr("dx",
function(){var C=b.xScale(n.getAttribute("start"));return C=C<$(window).width()/2?b.xScale(n.getAttribute("stop"))-b.xScale(n.getAttribute("start"))+5:-9*w.length}).attr("dy",10).attr("id","lblTxt").text(w)}else q.select("text#lblTxt").remove()}}),1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").size()+1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1))):"Trx"==b.drawAs&&(b.drawnAs="Trx",b.svg.selectAll(".gene").each(function(){d3.select(this).remove()}),
b.svg.selectAll(".trx"+b.gsvg.levelNumber).remove(),a=b.svg.selectAll(".trx"+b.gsvg.levelNumber).data(c,key).attr("transform",function(n,q){return"translate("+b.xScale(n.getAttribute("start"))+","+b.calcY(parseInt(n.getAttribute("start"),10),parseInt(n.getAttribute("stop"),10),q)+")"}),a.enter().append("g").attr("class",function(n){n=new String(n.parent.getAttribute("ID"));return"trx"+b.gsvg.levelNumber+" gene"+n.replace(".","_")}).attr("transform",function(n,q){return"translate(0,"+b.calcY(parseInt(n.getAttribute("start"),
10),parseInt(n.getAttribute("stop"),10),q)+")"}).attr("id",function(n){var q="";1==b.gsvg.levelNumber&&(q="tx");99==b.gsvg.levelNumber&&(q="ttTx");return q+b.cleanID(n.getAttribute("ID"))+b.gsvg.levelNumber}).style("cursor","pointer").on("click",function(n){setTimeout(function(){if(0==b.gsvg.levelNumber){var q=(new String(n.parent.getAttribute("ID"))).replace(".","_");b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("line").style("stroke",b.color);b.svg.selectAll("g.trx"+b.gsvg.levelNumber+
".selected").selectAll("rect").style("fill",b.color);b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("text").style("opacity","0.6").style("fill",b.color);b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").each(function(){var u=new String($(this).attr("class"));u=u.replace(" selected","");$(this).attr("class",u)});b.svg.selectAll("g.gene"+q).each(function(){var u=$(this).attr("class")+" selected";$(this).attr("class",u)});b.svg.selectAll("g.gene"+q).selectAll("line").style("stroke",
"green");b.svg.selectAll("g.gene"+q).selectAll("rect").style("fill","green");b.svg.selectAll("g.gene"+q).selectAll("text").style("opacity","0.3").style("fill","green");b.setupDetailedView(n.parent)}},10)}).on("dblclick",b.zoomToFeature).on("mouseover",function(n){if(0===b.gsvg.isToolTip){if(0===b.gsvg.levelNumber&&"undefined"!==typeof n.parent){var q=(new String(n.parent.getAttribute("ID"))).replace(".","_");b.svg.selectAll("g.gene"+q).selectAll("line").style("stroke","green");b.svg.selectAll("g.gene"+
q).selectAll("rect").style("fill","green");b.svg.selectAll("g.gene"+q).selectAll("text").style("opacity","0.3").style("fill","green")}else d3.select(this).selectAll("line").style("stroke","green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green");tt.transition().duration(200).style("opacity",1);tt.html(b.createToolTip(n)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)});
b.triggerTableFilter(n);if("undefined"!==typeof n){if(-1===b.trackClass.indexOf("smallnc"))b.setupToolTipSVG(n,.05);else{q=toolTipSVG("div#ttSVG",450,parseInt(n.getAttribute("start"),10)-10,parseInt(n.getAttribute("stop"),10)+10,99,b.getDisplayID(n.getAttribute("ID")),"");q.xMin=parseInt(n.getAttribute("start"),10)-20;q.xMax=parseInt(n.getAttribute("stop"),10)+20;var u=[];u[0]=n;q.addTrack(b.trackClass,2,"",u)}tt.style("top",function(){return b.positionTTTop(d3.event.pageY)})}}}).on("mouseout",function(n){if(-1==
(new String(d3.select(this).attr("class"))).indexOf("selected"))if(0==b.gsvg.levelNumber){var q=(new String(n.parent.getAttribute("ID"))).replace(".","_");b.svg.selectAll("g.gene"+q).selectAll("line").style("stroke",b.color);b.svg.selectAll("g.gene"+q).selectAll("rect").style("fill",b.color);b.svg.selectAll("g.gene"+q).selectAll("text").style("opacity","0.6").style("fill",b.color)}else d3.select(this).selectAll("line").style("stroke",b.color),d3.select(this).selectAll("rect").style("fill",b.color),
d3.select(this).selectAll("text").style("opacity","0.6").style("fill",b.color);tt.transition().delay(500).duration(200).style("opacity",0);b.clearTableFilter(n)}).merge(a).each(b.drawTrx),a.exit().remove(),a,1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.trx"+b.gsvg.levelNumber).size()+1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1))));""!=selectGene&&b.setSelected(selectGene);b.redrawSelectedArea();
b.drawAs=d};b.redrawLegend=function(){var a=[],d=0;"Trx"===b.drawAs&&("braincoding"===b.trackClass?"Rn"===organism&&(a[d]={color:"#7EB5D6",label:"All"},d++,a[d]={color:"#5E95FF",label:"BN-Lx"},d++,a[d]={color:"#BE95B6",label:"SHR"},d++):"brainnoncoding"===b.trackClass?"Rn"===organism&&(a[d]={color:"#CECFCE",label:"All"},d++,a[d]={color:"#3E75FF",label:"BN-Lx"},d++,a[d]={color:"#FE7596",label:"SHR"},d++):"liverTotal"===b.trackClass?(a[d]={color:"#bbbedd",label:"All"},d++,a[d]={color:"#9b9eFF",label:"BN-Lx"},
d++,a[d]={color:"#Fb9eBd",label:"SHR"},d++):"heartTotal"===b.trackClass?(a[d]={color:"#DC7252",label:"All"},d++,a[d]={color:"#BC5292",label:"BN-Lx"},d++,a[d]={color:"#FF5232",label:"SHR"},d++):"mergedTotal"!==b.trackClass&&"brainTotal"===b.trackClass&&(a[d]={color:"#7EB5D6",label:"All"},d++,a[d]={color:"#5E95FF",label:"BN-Lx"},d++,a[d]={color:"#BE95B6",label:"SHR"},d++));"brainsmallnc"===b.trackClass?(a[d]={color:"#3E7596",label:"All"},d++,a[d]={color:"#1E55D6",label:"BN-Lx"},d++,a[d]={color:"#7E5576",
label:"SHR"}):"heartsmallnc"===b.trackClass?(a[d]={color:"#9C3212",label:"All"},d++,a[d]={color:"#7C1252",label:"BN-Lx"},d++,a[d]={color:"#DC1200",label:"SHR"}):"liversmallnc"===b.trackClass&&(a[d]={color:"#7b7e9d",label:"All"},d++,a[d]={color:"#5b5eDd",label:"BN-Lx"},d++,a[d]={color:"#bb5e7d",label:"SHR"});b.drawLegend(a)};b.triggerTableFilter=function(a){var d=jQuery.Event("keyup");d.which=32;var c="";"undefined"!==typeof a.getAttribute&&"undefined"!==typeof a.getAttribute("ID")&&(c=b.getDisplayID(a.getAttribute("ID")));
-1==b.trackClass.indexOf("smallnc")?$("#tblGenes"+b.trackClass+"_filter input").val(c).trigger(d):$("#tblsmGenes_filter input").val(c).trigger(d)};b.clearTableFilter=function(a){a=jQuery.Event("keyup");a.which=32;"smallnc"!=b.trackClass?$("#tblGenes"+b.trackClass+"_filter input").val("").trigger(a):$("#tblsmGenes_filter input").val("").trigger(a)};b.updateSettingsFromUI=function(){0<$("#"+b.trackClass+"Dense"+b.level+"Select").length&&(b.density=$("#"+b.trackClass+"Dense"+b.level+"Select").val(),
"string"===typeof b.density&&(b.density=parseInt(b.density)));0<$("#"+b.trackClass+"Version"+b.level+"Select").length&&(b.reqDataVer=$("#"+b.trackClass+"Version"+b.level+"Select").val())};b.savePrevious=function(){b.prevSetting={};b.prevSetting.density=b.density;b.prevSetting.dataVer=b.dataVer};b.revertPrevious=function(){b.density=b.prevSetting.density;b.dataVer=b.prevSetting.dataVer};b.updateSettings=function(a){};b.generateTrackSettingString=function(){return b.trackClass+","+b.density+","+b.dataVer+
";"};b.redrawLegend();b.draw(m);return b}
function RefSeqTrack(p,m,r,t,f){var b=GeneTrack(p,m,r,t);b.counts=[{value:0,names:"Ensembl"},{value:0,names:"RNA-Seq"}];b.drawAs="Gene";b.trxCutoff=1E5;b.density=3;-1<(new String(f)).indexOf("DrawTrx")&&(b.drawAs="Trx");b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(p=0;p<b.gsvg.width;p++)b.yMaxArr[p]=0,b.yArr[0][p]=0;b.ttTrackList=[];b.ttTrackList.push("ensemblcoding");b.ttTrackList.push("braincoding");b.ttTrackList.push("liverTotal");b.ttTrackList.push("heartTotal");b.ttTrackList.push("mergedTotal");b.ttTrackList.push("ensemblnoncoding");
b.ttTrackList.push("brainnoncoding");b.ttTrackList.push("repeatMask");b.ttTrackList.push("snpSHRH");b.ttTrackList.push("snpBNLX");b.ttTrackList.push("snpF344");b.ttTrackList.push("snpSHRJ");b.cleanID=function(a){return a=a.replace(/\./g,"_")};b.color=function(a){var d=d3.rgb("#000000");if("Gene"==b.drawnAs){a=getAllChildrenByName(getFirstChildByName(a,"TranscriptList"),"Transcript");for(var c=-1,g=0;g<a.length;g++){var e=new String(a[g].getAttribute("category")),h=-1;"Reviewed"==e?h=5:"Validated"==
e?h=4:"Provisional"==e?h=3:"Inferred"==e?h=2:"Predicted"==e?h=1:"Model"==e?h=1:"Unknown"==e&&(h=0);c<h&&(c=h)}5===c&&(d=d3.rgb("#18814F"));4===c?d=d3.rgb("#38A16F"):3===c?d=d3.rgb("#78E1AF"):2===c?d=d3.rgb("#A8FFDF"):1===c?d=d3.rgb("#A8DFFF"):0===c&&(d=d3.rgb("#C8FFFF"))}else"Trx"==b.drawnAs&&(e=new String(a.getAttribute("category")),"Reviewed"==e?d=d3.rgb("#18814F"):"Validated"==e?d=d3.rgb("#38A16F"):"Provisional"==e?d=d3.rgb("#78E1AF"):"Inferred"==e?d=d3.rgb("#A8FFDF"):"Predicted"==e?d=d3.rgb("#A8DFFF"):
"Model"===e?d=d3.rgb("#A8DFFF"):"Unknown"===e&&(d=d3.rgb("#C8FFFF")));return d};b.pieColor=function(a,d){d=d3.rgb("#000000");a=new String(a.data.names);-1<a.indexOf("Reviewed")?d=d3.rgb("#18814F"):-1<a.indexOf("Validated")?d=d3.rgb("#38A16F"):-1<a.indexOf("Provisional")?d=d3.rgb("#78E1AF"):-1<a.indexOf("Inferred")?d=d3.rgb("#A8FFDF"):-1<a.indexOf("Predicted")?d=d3.rgb("#A8DFFF"):-1<a.indexOf("Model")?d=d3.rgb("#A8DFFF"):-1<a.indexOf("Unknown")&&(d=d3.rgb("#C8FFFF"));return d};b.getDisplayedData=function(){var a=
[],d=0,c=0;if("Gene"==b.drawnAs){var g=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".gene");b.counts=[];var e=0;g.each(function(h){var l=b.xScale(h.getAttribute("start")),n=b.xScale(h.getAttribute("stop"));if(0<=l&&l<=b.gsvg.width||0<=n&&n<=b.gsvg.width||0>=l&&n>=b.gsvg.width){n=getAllChildrenByName(getFirstChildByName(h,"TranscriptList"),"Transcript");l=-1;for(var q=0;q<n.length;q++){var u=new String(n[q].getAttribute("category")),v=-1;"Reviewed"==u?v=5:"Validated"==u?v=4:"Provisional"==
u?v=3:"Inferred"==u?v=2:"Predicted"==u?v=1:"Model"==u?v=1:"Unknown"==u&&(v=1);l<v&&(l=v)}n="Unknown";5==l?n="Reviewed":4==l?n="Validated":3==l?n="Provisional":2==l?n="Inferred":1==l&&(n="Predicted/Model");"undefined"===typeof b.counts[n]?(b.counts[n]={},b.counts[e]=b.counts[n],e++,b.counts[n].value=1,b.counts[n].names=n):b.counts[n].value++;a[d]=h;d++;c++}})}else b.counts=[],e=0,b.svg.selectAll("g.trx"+b.gsvg.levelNumber).each(function(h){var l=b.xScale(h.getAttribute("start")),n=b.xScale(h.getAttribute("stop"));
if(0<=l&&l<=b.gsvg.width||0<=n&&n<=b.gsvg.width||0>=l&&n>=b.gsvg.width)l=new String(h.getAttribute("category")),"undefined"===typeof b.counts[l]?(b.counts[l]={},b.counts[e]=b.counts[l],e++,b.counts[l].value=1,b.counts[l].names=l):b.counts[l].value++,a[d]=h,d++,c++});return a};b.createToolTip=function(a){var d="",c=a.getAttribute("strand");c="1"==c||"+"==c?"+":"-1"==c||"-"==c?"-":".";if("Gene"===b.drawnAs){d="";for(var g=getAllChildrenByName(getFirstChildByName(a,"TranscriptList"),"Transcript"),e=
0;e<g.length;e++){var h=new String(g[e].getAttribute("ID"));d+="<B>"+h+"</B> - "+g[e].getAttribute("category");d+="<br>"}d='<BR><div id="ttSVG" style="background:#FFFFFF;"></div>Gene Symbol: '+a.getAttribute("geneSymbol")+"<BR>Location: "+a.getAttribute("chromosome")+":"+numberWithCommas(a.getAttribute("start"))+"-"+numberWithCommas(a.getAttribute("stop"))+"<BR>Strand: "+c+"<BR>Transcripts:<BR>"+d}else"Trx"===b.drawnAs&&(h=new String(a.getAttribute("ID")),d='<BR><div id="ttSVG" style="background:#FFFFFF;"></div>RefSeq ID:<B>'+
(h+"</B><BR>Status: ")+a.getAttribute("category")+"<BR>Gene Symbol: "+a.getAttribute("geneSymbol")+"<BR>Location: "+a.getAttribute("chromosome")+":"+numberWithCommas(a.getAttribute("start"))+"-"+numberWithCommas(a.getAttribute("stop"))+"<BR>Strand: "+c);return d};b.getSVGID=function(a){return a.getAttribute("geneSymbol")};b.setupToolTipSVG=function(a,d){var c=parseInt(a.getAttribute("start"),10),g=parseInt(a.getAttribute("stop"),10),e=Math.floor((g-c)*d);20>e&&(e=20);d=c-e;e=g+e;1>d&&(d=1);"undefined"!==
typeof b.ttSVGMinWidth&&e-d<b.ttSVGMinWidth&&(d=c-b.ttSVGMinWidth/2,e=g+b.ttSVGMinWidth/2);c=toolTipSVG("div#ttSVG",450,d,e,99,b.getSVGID(a),"transcript");c.forLevel=b.gsvg.levelNumber;g=[];g.push(a);c.addTrack(b.trackClass,3,"DrawTrx",g);for(a=0;a<b.ttTrackList.length;a++){g=b.gsvg.getTrackData(b.ttTrackList[a]);var h=[];if("undefined"!==typeof g&&0<g.length){for(var l=0,n=0;n<g.length;n++)if(d<=parseInt(g[n].getAttribute("start"),10)&&parseInt(g[n].getAttribute("start"),10)<=e||parseInt(g[n].getAttribute("start"),
10)<=d&&parseInt(g[n].getAttribute("stop"),10)>=d)h[l]=g[n],l++;0<h.length&&c.addTrack(b.ttTrackList[a],3,"DrawTrx",h)}}};b.calcY=function(a,d,c){if(3==b.density)if(a>=b.xScale.domain()[0]&&a<=b.xScale.domain()[1]||d>=b.xScale.domain()[0]&&d<=b.xScale.domain()[1]||a<=b.xScale.domain()[0]&&d>=b.xScale.domain()[1]){a=Math.floor(b.xScale(a));0>a&&(a=0);d=Math.floor(b.xScale(d))+1;d>=b.gsvg.width&&(d=b.gsvg.width-1);c=a-5;0>c&&(c=0);var g=d+5;g>=b.gsvg.width&&(g=b.gsvg.width-1);for(var e=0,h=c;h<=g;h++)b.yMaxArr[h]>
e&&(e=b.yMaxArr[h]);e++;var l=e;if(b.yArr.length<=e)for(b.yArr[l]=[],h=0;h<b.gsvg.width;h++)b.yArr[l][h]=0;h=e-12;1>h&&(h=1);l=0;for(var n=h;n<e&&0==l;n++){var q=0;for(h=c;h<=g&&0==q;h++)b.yArr[n][h]>q&&(q=1);0==q&&(e=n,l=1)}e>b.trackYMax&&(b.trackYMax=e);for(h=a;h<=d;h++)b.yMaxArr[h]<e&&(b.yMaxArr[h]=e),b.yArr[e][h]=1;a=15*e}else a=15;else a=2==b.density?15*(c+1):15;b.trackYMax<a/15&&(b.trackYMax=a/15);return a};b.redraw=function(){var a=b.xScale.domain()[0];a=b.xScale.domain()[1]-a;var d=0;b.yMaxArr=
[];b.yArr=[];b.yArr[0]=[];for(var c=0;c<b.gsvg.width;c++)b.yMaxArr[c]=0,b.yArr[0][c]=0;b.trackYMax=0;if(a<b.trxCutoff&&"Gene"==b.drawnAs||a>=b.trxCutoff&&"Trx"==b.drawnAs&&"Trx"!=b.drawAs||"Gene"==b.drawnAs&&$("#forceTrxCBX"+b.gsvg.levelNumber).is(":checked"))b.draw(b.data);else if(a<b.trxCutoff&&"Trx"==b.drawnAs&&"Trx"!=b.drawAs&&(d=1),"Gene"==b.drawAs&&0==d)b.svg.node()&&(b.svg.selectAll(".trx").each(function(){d3.select(this).remove()}),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").attr("transform",
function(g,e){return"translate("+b.xScale(g.getAttribute("start"))+","+b.calcY(parseInt(g.getAttribute("start"),10),parseInt(g.getAttribute("stop"),10),e)+")"}),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene rect").attr("width",function(g){var e=1;1<b.xScale(g.getAttribute("stop"))-b.xScale(g.getAttribute("start"))&&(e=b.xScale(g.getAttribute("stop"))-b.xScale(g.getAttribute("start")));return e}).attr("stroke",b.colorStroke),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").each(function(g){var e=
d3.select(this);if("1"==g.getAttribute("strand")||"-1"==g.getAttribute("strand")||"-"==g.getAttribute("strand")||"+"==g.getAttribute("strand")){var h=">";if("-1"==g.getAttribute("strand")||"-"==g.getAttribute("strand"))h="<";g="";var l=e.select("rect").attr("width");if(8.5<=l&&15.8>=l)g=h;else for(;8.7<l;)g+=h,l-=8.5;e.select("text").text(g)}})),1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").size()+
1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1));else if(1==d||"Trx"==b.drawAs)b.svg.selectAll("g.trx"+b.gsvg.levelNumber).attr("transform",function(g,e){return"translate(0,"+b.calcY(parseInt(g.getAttribute("start"),10),parseInt(g.getAttribute("stop"),10),e)+")"}).each(function(g,e){e=parseInt(g.getAttribute("cdsStart"),10);var h=parseInt(g.getAttribute("cdsStop"),10);exList=getAllChildrenByName(getFirstChildByName(g,"exonList"),"exon");var l="";1==b.gsvg.levelNumber&&(l="tx");for(var n=
0;n<exList.length;n++){var q=parseInt(exList[n].getAttribute("start"),10),u=parseInt(exList[n].getAttribute("stop"),10);if(q<e&&e<u||u>h&&h>q){var v=q,y=e;u>h?(v=h,y=u,u=h):q=e;d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).select("g#"+l+b.cleanID(g.getAttribute("ID"))+" rect#ExNC"+exList[n].getAttribute("ID")).attr("x",function(D){return b.xScale(v)}).attr("width",function(D){return b.xScale(y)-b.xScale(v)})}d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).select("g#"+l+b.cleanID(g.getAttribute("ID"))+
" rect#Ex"+exList[n].getAttribute("ID")).attr("x",function(D){return b.xScale(q)}).attr("width",function(D){return b.xScale(u)-b.xScale(q)});if(0<n){var w=b.xScale(exList[n-1].getAttribute("stop")),C=b.xScale(exList[n].getAttribute("start"));if("1"==g.getAttribute("strand")||"-1"==g.getAttribute("strand")||"-"==g.getAttribute("strand")||"+"==g.getAttribute("strand")){var B=">";"-1"==g.getAttribute("strand")&&(B="<");var E=B,G=C-w,z=0;if(7>G)E="";else for(G-=7;8<G;)0==z?(E+=" ",z=1):(E+=B,z=0),G-=
7;d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).select("g#"+l+b.cleanID(g.getAttribute("ID"))+" #IntTxt"+exList[n-1].getAttribute("ID")+"_"+exList[n].getAttribute("ID")).attr("dx",w+1).text(E)}d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).select("g#"+l+b.cleanID(g.getAttribute("ID"))+" line#Int"+exList[n-1].getAttribute("ID")+"_"+exList[n].getAttribute("ID")).attr("x1",w).attr("x2",C)}}}),1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(d3.select("#Level"+b.gsvg.levelNumber+
b.trackClass).selectAll("g.trx"+b.gsvg.levelNumber).size()+1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1));b.redrawSelectedArea()};b.updateData=function(a){var d=b.xScale.domain()[0],c=b.xScale.domain()[1];d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/refSeq.xml",function(g,e){if(g)0==a&&(g="/"+pathPrefix,pathPrefix||(g=""),$.ajax({url:g+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:d,maxCoord:c,rnaDatasetID,arrayTypeID,
myOrganism:organism,track:b.trackClass,folder:b.gsvg.folderName,panel},dataType:"json",success:function(q){},error:function(q,u,v){}})),10>a?(g=2500,1==a&&(g=1E4),setTimeout(function(){b.updateData(a+1)},g)):(d3.select("#Level"+b.levelNumber+b.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+b.trackClass),d3.select("#Level"+b.levelNumber+b.trackClass).attr("height",15),b.gsvg.addTrackErrorRemove(b.svg,"#Level"+b.gsvg.levelNumber+b.trackClass));else if(e){g=e.documentElement.getElementsByTagName("Gene");
e=[];for(var h=[],l=0,n=0;n<g.length;n++)g[n]&&(e[l]=g[n],e[l].setAttribute("ID",l),h[g[n].getAttribute("geneSymbol")]=1,l++);for(n=0;n<b.data.length;n++)b.data[n]&&!h[b.data[n].getAttribute("geneSymbol")]&&(e[l]=b.data[n],e[l].setAttribute("ID",l),l++);b.draw(e);b.hideLoading();b.getDisplayedData();setTimeout(function(){DisplayRegionReport()},300)}else b.updateData(a+1),b.hideLoading()})};b.drawTrx=function(a,d){d=parseInt(a.getAttribute("cdsStart"),10);var c=parseInt(a.getAttribute("cdsStop"),10),
g="";1==b.gsvg.levelNumber&&(g="tx");g=b.svg.select("#"+g+b.cleanID(a.getAttribute("ID")));exList=getAllChildrenByName(getFirstChildByName(a,"exonList"),"exon");for(var e=0;e<exList.length;e++){var h=parseInt(exList[e].getAttribute("start"),10),l=parseInt(exList[e].getAttribute("stop"),10);if(h<d&&d<l||l>c&&c>h){var n=0,q=0,u=0,v=0;h<d?(n=b.xScale(h),q=b.xScale(d)-b.xScale(h),u=b.xScale(d),v=b.xScale(l)-b.xScale(d)):l>c&&(u=b.xScale(h),v=b.xScale(c)-b.xScale(h),n=b.xScale(c),q=b.xScale(l)-b.xScale(c));
g.append("rect").attr("x",n).attr("y",2.5).attr("height",5).attr("width",q).attr("title",function(y){return exList[e].getAttribute("ID")}).attr("id",function(y){return"ExNC"+exList[e].getAttribute("ID")}).style("fill",b.color).style("cursor","pointer");g.append("rect").attr("x",u).attr("height",10).attr("width",v).attr("title",function(y){return exList[e].getAttribute("ID")}).attr("id",function(y){return"Ex"+exList[e].getAttribute("ID")}).style("fill",b.color).style("cursor","pointer")}else{n=10;
q=0;if(h<d&&l<d||l>c&&h>c)n=5,q=2.5;g.append("rect").attr("x",function(y){return b.xScale(exList[e].getAttribute("start"))}).attr("y",q).attr("height",n).attr("width",function(y){return b.xScale(exList[e].getAttribute("stop"))-b.xScale(exList[e].getAttribute("start"))}).attr("title",function(y){return exList[e].getAttribute("ID")}).attr("id",function(y){return"Ex"+exList[e].getAttribute("ID")}).style("fill",b.color).style("cursor","pointer")}if(0<e&&(g.append("line").attr("x1",function(y){return b.xScale(exList[e-
1].getAttribute("stop"))}).attr("x2",function(y){return b.xScale(exList[e].getAttribute("start"))}).attr("y1",5).attr("y2",5).attr("id",function(y){return"Int"+exList[e-1].getAttribute("ID")+"_"+exList[e].getAttribute("ID")}).attr("stroke",b.color).attr("stroke-width","2"),"1"==a.getAttribute("strand")||"-1"==a.getAttribute("strand")||"-"==a.getAttribute("strand")||"+"==a.getAttribute("strand"))){h=">";if("-"==a.getAttribute("strand")||"-1"==a.getAttribute("strand"))h="<";l=h;n=b.xScale(exList[e-
1].getAttribute("stop"));q=b.xScale(exList[e].getAttribute("start"))-n;u=0;if(7>q)l="";else for(q-=7;8<q;)0==u?(l+=" ",u=1):(l+=h,u=0),q-=7;g.append("svg:text").attr("id",function(y){return"IntTxt"+exList[e-1].getAttribute("ID")+"_"+exList[e].getAttribute("ID")}).attr("dx",n+1).attr("dy","11").style("pointer-events","none").style("opacity","0.5").style("fill",b.color).style("font-size","16px").text(l)}}};b.draw=function(a){b.data=a;b.trackYMax=0;b.yArr=[];b.yArr[0]=[];for(var d=0;d<b.gsvg.width;d++)b.yMaxArr[d]=
0,b.yArr[0][d]=0;b.svg.selectAll(".gene").remove();b.svg.selectAll(".trx"+b.gsvg.levelNumber).remove();var c=b.drawAs;d=b.xScale.domain()[0];if(b.xScale.domain()[1]-d<b.trxCutoff||$("#forceTrxCBX"+b.gsvg.levelNumber).is(":checked"))b.drawAs="Trx";if(0!=a&&"Gene"===b.drawAs)b.drawnAs="Gene",b.label="Ref Seq Genes",b.updateLabel(b.label),b.redrawLegend(),a=b.svg.selectAll(".gene").data(a,key).attr("transform",function(n,q){return"translate("+b.xScale(n.getAttribute("start"))+","+b.calcY(parseInt(n.getAttribute("start"),
10),parseInt(n.getAttribute("stop"),10),q)+")"}),a.enter().append("g").attr("class","gene").attr("transform",function(n,q){return"translate("+b.xScale(n.getAttribute("start"))+","+b.calcY(parseInt(n.getAttribute("start"),10),parseInt(n.getAttribute("stop"),10),q)+")"}).append("rect").attr("height",10).attr("rx",1).attr("ry",1).attr("width",function(n){return b.xScale(n.getAttribute("stop"))-b.xScale(n.getAttribute("start"))}).attr("title",function(n){return n.getAttribute("ID")}).attr("stroke",b.colorStroke).attr("stroke-width",
"1").attr("id",function(n){return b.cleanID(n.getAttribute("ID"))}).style("fill",b.color).on("dblclick",b.zoomToFeature).on("mouseover",function(n){0==b.gsvg.isToolTip&&(overSelectable=1,$("#mouseHelp").html("<B>Double Click</B> to zoom in on this feature."),d3.select(this).style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(b.createToolTip(n)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)}),
b.setupToolTipSVG(n,.05));return!1}).on("mouseout",function(n){overSelectable=0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");"selected"!=d3.select(this).attr("class")&&d3.select(this).style("fill",b.color);tt.transition().delay(500).duration(200).style("opacity",0)}),a.exit().remove(),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").each(function(n){if("undefined"!==typeof n){var q=d3.select(this);if("1"==n.getAttribute("strand")||
"-1"==n.getAttribute("strand")||"-"==n.getAttribute("strand")||"+"==n.getAttribute("strand")){var u=">";if("-"==n.getAttribute("strand")||"-1"==n.getAttribute("strand"))u="<";var v=q.select("rect").attr("width");if(8.5>v)n="";else for(v-=8.5,n=u;8.7<v;)n+=u,v-=8.5;q.append("svg:text").attr("dx","1").attr("dy","10").style("pointer-events","none").text(n)}}}),1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").size()+
1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1));else if(0!=a&&"Trx"===b.drawAs){b.drawnAs="Trx";b.label="Ref Seq Transcripts";b.updateLabel(b.label);b.redrawLegend();var g=[],e=0;for(d=0;d<a.length;d++)for(var h=getAllChildrenByName(getFirstChildByName(a[d],"TranscriptList"),"Transcript"),l=0;l<h.length;l++)g[e]=h[l],g[e].parent=a[d],e++;d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".trx"+b.gsvg.levelNumber).remove();a=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".trx"+
b.gsvg.levelNumber).data(g,key).attr("transform",function(n,q){return"translate("+b.xScale(n.getAttribute("start"))+","+b.calcY(parseInt(n.getAttribute("start"),10),parseInt(n.getAttribute("stop"),10),q)+")"});a.enter().append("g").attr("class","trx"+b.gsvg.levelNumber).attr("transform",function(n,q){return"translate(0,"+b.calcY(parseInt(n.getAttribute("start"),10),parseInt(n.getAttribute("stop"),10),q)+")"}).attr("id",function(n){var q="";1==b.gsvg.levelNumber&&(q="tx");return q+b.cleanID(n.getAttribute("ID"))}).on("mouseover",
function(n){0==b.gsvg.isToolTip&&(d3.select(this).selectAll("line").style("stroke","green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(b.createToolTip(n)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)}),"undefined"!==typeof n&&b.setupToolTipSVG(n.parent,.05))}).on("mouseout",
function(n){d3.select(this).selectAll("line").style("stroke",function(q){return b.color(q)});d3.select(this).selectAll("rect").style("fill",function(q){return b.color(q)});d3.select(this).selectAll("text").style("opacity","0.6").style("fill",function(q){return b.color(q)});tt.transition().delay(500).duration(200).style("opacity",0)}).each(b.drawTrx);a.exit().remove();2==b.density?b.svg.attr("height",15*(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.trx"+b.gsvg.levelNumber).size()+
1)):3==b.density?b.svg.attr("height",15*(b.trackYMax+1)):b.svg.attr("height",30)}b.redrawSelectedArea();b.drawAs=c};b.redrawLegend=function(){b.drawLegend([{color:"#18814F",label:"Reviewed"},{color:"#38A16F",label:"Validated"},{color:"#78E1AF",label:"Provisional"},{color:"#A8FFDF",label:"Inferred"},{color:"#A8DFFF",label:"Predicted/Model"},{color:"#C8FFFF",label:"Unknown"}])};b.redrawLegend();b.draw(m);DisplayRegionReport();return b}
function ProbeTrack(p,m,r,t,f){var b=Track(p,m,r,t);p=(new String(f)).split(",");0<p.length?(b.density=p[0],"string"===typeof b.density&&(b.density=parseInt(b.density)),b.colorSelect=1<p.length?p[1]:"annot",2<p.length?b.tissues=p[2].split(":"):(b.tissues=["Brain"],"Rn"==organism&&(b.tissues=["Brain","BrownAdipose","Heart","Liver"]))):(b.density=3,b.colorSelect="annot",b.tissues=["Brain"],"Rn"==organism&&(b.tissues=["Brain","BrownAdipose","Heart","Liver"]));1E6<b.gsvg.xScale.domain()[1]-b.gsvg.xScale.domain()[0]&&
(b.density=1);b.tissuesAll=["Brain"];"Rn"==organism&&(b.tissuesAll=["Brain","BrownAdipose","Heart","Liver"]);b.xPadding=1;b.scanBackYLines=75;b.curColor=b.colorSelect;b.ttTrackList=[];b.ttTrackList.push("ensemblcoding");b.ttTrackList.push("braincoding");b.ttTrackList.push("liverTotal");b.ttTrackList.push("heartTotal");b.ttTrackList.push("mergedTotal");b.ttTrackList.push("ensemblnoncoding");b.ttTrackList.push("brainnoncoding");b.ttTrackList.push("repeatMask");b.color=function(a,d){var c=d3.rgb("#000000");
"annot"==b.colorSelect?c=b.colorAnnotation(a):"herit"==b.colorSelect?(a=getFirstChildByName(a,"herit").getAttribute(d),a=Math.floor(255*a),c=d3.rgb(a,0,0)):"dabg"==b.colorSelect&&(a=getFirstChildByName(a,"dabg").getAttribute(d),a=Math.floor(2.55*a),c=d3.rgb(0,a,0));return c};b.colorAnnotation=function(a){var d=d3.rgb("#000000");"core"==a.getAttribute("type")?d=d3.rgb(255,0,0):"extended"==a.getAttribute("type")?d=d3.rgb(0,0,255):"full"==a.getAttribute("type")?d=d3.rgb(0,100,0):"ambiguous"==a.getAttribute("type")&&
(d=d3.rgb(0,0,0));return d};b.pieColor=function(a,d){d=d3.rgb("#000000");a=new String(a.data.names);"Core"==a?d=d3.rgb(255,0,0):"Extended"==a?d=d3.rgb(0,0,255):"Full"==a?d=d3.rgb(0,100,0):"Ambiguous"==a&&(d=d3.rgb(0,0,0));return d};b.createToolTip=function(a){var d=".";1==a.getAttribute("strand")?d="+":-1==a.getAttribute("strand")&&(d="-");var c=parseInt(a.getAttribute("stop"),10)-parseInt(a.getAttribute("start"),10);d='<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>Affy Probe Set ID: '+
a.getAttribute("ID")+"<BR>Strand: "+d+"<BR>Location: "+a.getAttribute("chromosome")+":"+numberWithCommas(a.getAttribute("start"))+"-"+numberWithCommas(a.getAttribute("stop"))+" ("+c+"bp)<BR>";d=d+"Type: "+a.getAttribute("type")+"<BR><BR>";c=getFirstChildByName(a,"herit");a=getFirstChildByName(a,"dabg");d+='<table class="tooltipTable" width="100%" colSpace="0"><tr><TH>Tissue</TH><TH>Heritability</TH><TH>DABG</TH></TR>';b.tissues.length<b.tissuesAll.length&&(d+='<TR><TD colspan="3">Displayed Tissues:</TD></TR>');
for(var g={},e=0;e<b.tissues.length;e++){var h=new String(b.tissues[e]);-1<h.indexOf("Affy")&&(h=h.substr(0,h.indexOf("Affy")));g[h]=1;var l=Math.floor(255*c.getAttribute(h));l=d3.rgb(l,0,0);var n=Math.floor(2.55*a.getAttribute(h));n=d3.rgb(0,n,0);d=d+"<TR><TD>"+h+'</TD><TD style="background:'+l+';color:white;">'+c.getAttribute(h)+'</TD><TD style="background:'+n+';color:white;">'+a.getAttribute(h)+"%</TD></TR>"}if(b.tissues.length<b.tissuesAll.length)for(d+='<TR><TD colspan="3">Other Tissues:</TD></TR>',
e=0;e<b.tissuesAll.length;e++)h=new String(b.tissuesAll[e]),-1<h.indexOf("Affy")&&(h=h.substr(0,h.indexOf("Affy"))),1!=g[h]&&(l=Math.floor(255*c.getAttribute(h)),l=d3.rgb(l,0,0),n=Math.floor(2.55*a.getAttribute(h)),n=d3.rgb(0,n,0),d=d+"<TR><TD>"+h+'</TD><TD style="background:'+l+';color:white;">'+c.getAttribute(h)+'</TD><TD style="background:'+n+';color:white;">'+a.getAttribute(h)+"%</TD></TR>");return d+"</table>"};b.updateSettingsFromUI=function(){0<$("#"+b.trackClass+"Dense"+b.level+"Select").length?
b.density=$("#"+b.trackClass+"Dense"+b.level+"Select").val():b.density||(b.density=1);b.curColor=b.colorSelect;0<$("#"+b.trackClass+b.level+"colorSelect").length?b.curColor=$("#"+b.trackClass+b.level+"colorSelect").val():b.curColor||(b.curColor="annot");var a=0;if(0<$("#affyTissues"+b.level+' input[name="tissuecbx"]').length){b.tissues=[];for(var d=$("#affyTissues"+b.level+' input[name="tissuecbx"]:checked'),c=0;c<d.length;c++){var g=new String(d[c].id);g=g.substr(0,g.indexOf("Affy"));b.tissues[a]=
g;a++}}};b.savePrevious=function(){b.prevSetting={};b.prevSetting.density=b.density;b.prevSetting.curColor=b.curColor;b.prevSetting.tissues=b.tissues};b.revertPrevious=function(){b.density=b.prevSetting.density;b.curColor=b.prevSetting.curColor;b.tissues=b.prevSetting.tissues};b.calcY=function(a,d,c,g){var e=8*g+5;if(3===b.density||"3"===b.density)if(a>=b.xScale.domain()[0]&&a<=b.xScale.domain()[1]||d>=b.xScale.domain()[0]&&d<=b.xScale.domain()[1]||a<=b.xScale.domain()[0]&&d>=b.xScale.domain()[1]){a=
Math.round(b.xScale(a));0>a&&(a=0);d=Math.round(b.xScale(d));d>=b.gsvg.width&&(d=b.gsvg.width-1);c=a-b.xPadding;0>c&&(c=0);g=d+b.xPadding;g>=b.gsvg.width&&(g=b.gsvg.width-1);g+e<b.gsvg.width?(g+=e,d+=e):0<c-e&&(c-=e,a-=e);e=0;for(var h=c;h<=g;h++)b.yMaxArr[h]>e&&(e=b.yMaxArr[h]);e++;var l=e;if(b.yArr.length<=e)for(b.yArr[l]=[],h=0;h<b.gsvg.width;h++)b.yArr[l][h]=0;h=e-b.scanBackYLines;1>h&&(h=1);l=0;for(var n=h;n<e&&0==l;n++){var q=0;for(h=c;h<=g&&0==q;h++)b.yArr[n][h]>q&&(q=1);0==q&&(e=n,l=1)}e>
b.trackYMax&&(b.trackYMax=e);for(h=a;h<=d;h++)b.yMaxArr[h]<e&&(b.yMaxArr[h]=e),b.yArr[e][h]=1;a=15*e}else a=15;else a=2===b.density||"2"===b.density?15*(c+1):15;b.trackYMax<a/15&&(b.trackYMax=a/15);return a};b.redraw=function(){var a=b.tissues.length;if(b.curColor!=b.colorSelect||("herit"===b.colorSelect||"dabg"===b.colorSelect)&&a!=b.tissueLen)b.tissueLen=a,b.draw(b.data);else{b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(var d=0;d<b.gsvg.width;d++)b.yMaxArr[d]=0,b.yArr[0][d]=0;b.colorSelect=
b.curColor;b.tissueLen=a;if("dabg"==b.colorSelect||"herit"==b.colorSelect){"dabg"==b.colorSelect?b.drawScaleLegend("0%","100%","of Samples DABG","#000000","#00FF00",0):"herit"==b.colorSelect&&b.drawScaleLegend("0","1.0","Probeset Heritability","#000000","#FF0000",0);var c=1;for(a=0;a<b.tissues.length;a++){var g=new String(b.tissues[a]);b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(d=0;d<b.gsvg.width;d++)b.yMaxArr[d]=0,b.yArr[0][d]=0;c++;b.svg.select("text."+g).attr("y",15*c);b.svg.selectAll("g.probe."+
g).attr("transform",function(e,h){var l=b.gsvg.xScale(e.getAttribute("start"));e=b.calcY(parseInt(e.getAttribute("start"),10),parseInt(e.getAttribute("stop"),10),h,e.getAttribute("ID").length)+15*c-10;return"translate("+l+","+e+")"}).each(function(e){var h=d3.select(this),l=1;1<b.gsvg.xScale(e.getAttribute("stop"))-b.gsvg.xScale(e.getAttribute("start"))&&(l=b.gsvg.xScale(e.getAttribute("stop"))-b.gsvg.xScale(e.getAttribute("start")));h.selectAll("rect").attr("width",l).attr("fill",b.color(e,g));var n=
">";"-1"==e.getAttribute("strand")&&(n="<");var q="";if(7.5<=l&&15>=l)q=n;else if(15<l)for(l-=7.5;7.5<l;)q+=n,l-=7.5;h.select("text#strand").text(q);if(2==b.density||3==b.density){var u=e.getAttribute("ID");0===h.select("text#lblTxt").size()?h.append("svg:text").attr("dx",function(){var v=b.xScale(e.getAttribute("stop"))+8*u.length+5,y=b.xScale(e.getAttribute("stop"))-b.xScale(e.getAttribute("start"))+5;v>b.gsvg.width&&(y=-8*u.length);return y}).attr("dy",10).attr("id","lblTxt").text(u):h.select("text#lblTxt").attr("dx",
function(){var v=b.xScale(e.getAttribute("stop"))+8*u.length+5,y=b.xScale(e.getAttribute("stop"))-b.xScale(e.getAttribute("start"))+5;v>b.gsvg.width&&(y=-8*u.length);return y})}else h.selectAll("text#lblTxt").remove()});c+=b.trackYMax}b.trackYMax=15*c;b.svg.attr("height",b.trackYMax)}else if("annot"===b.colorSelect){b.drawLegend([{color:"#FF0000",label:"Core"},{color:"#0000FF",label:"Extended"},{color:"#006400",label:"Full"},{color:"#000000",label:"Ambiguous"}]);b.trackYMax=0;b.yMaxArr=[];b.yArr=
[];b.yArr[0]=[];for(d=0;d<b.gsvg.width;d++)b.yMaxArr[d]=0,b.yArr[0][d]=0;b.svg.selectAll("g.probe").attr("transform",function(e,h){return"translate("+b.xScale(e.getAttribute("start"))+","+b.calcY(parseInt(e.getAttribute("start"),10),parseInt(e.getAttribute("stop"),10),h,e.getAttribute("ID").length)+")"});b.svg.selectAll("g.probe rect").attr("width",function(e){var h=1;1<b.xScale(e.getAttribute("stop"))-b.xScale(e.getAttribute("start"))&&(h=b.xScale(e.getAttribute("stop"))-b.xScale(e.getAttribute("start")));
return h}).attr("fill",function(e){return b.color(e,"")});b.svg.selectAll("g.probe").each(function(e){var h=d3.select(this),l=">";"-1"==e.getAttribute("strand")&&(l="<");var n="",q=h.select("rect").attr("width");if(7.5<=q&&15>=q)n=l;else if(15<q)for(q-=7.5;7.5<q;)n+=l,q-=7.5;h.select("text").text(n);if(2==b.density||3==b.density){var u=e.getAttribute("ID");0===h.select("text#lblTxt").size()?h.append("svg:text").attr("dx",function(){var v=b.xScale(e.getAttribute("stop"))+8*u.length+5,y=b.xScale(e.getAttribute("stop"))-
b.xScale(e.getAttribute("start"))+5;v>b.gsvg.width&&(y=-8*u.length);return y}).attr("dy",10).attr("id","lblTxt").text(u):h.select("text#lblTxt").attr("dx",function(){var v=b.xScale(e.getAttribute("stop"))+8*u.length+5,y=b.xScale(e.getAttribute("stop"))-b.xScale(e.getAttribute("start"))+5;v>b.gsvg.width&&(y=-8*u.length);return y})}else h.selectAll("text#lblTxt").remove()});1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(b.trackYMax+1)):3==b.density&&b.svg.attr("height",15*
(b.trackYMax+1))}}b.redrawSelectedArea()};b.update=function(a){b.redraw()};b.updateData=function(a){d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/probe.xml",function(d,c){if(d)3>a?(d=5E3,1==a&&(d=1E4),setTimeout(function(){b.updateData(a+1)},d)):3<=a&&(d3.select("#Level"+b.levelNumber+b.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+b.trackClass),d3.select("#Level"+b.levelNumber+b.trackClass).attr("height",15),b.gsvg.addTrackErrorRemove(b.svg,
"#Level"+b.gsvg.levelNumber+b.trackClass));else{if(c){d=c.documentElement.getElementsByTagName("probe");c=[];for(var g=[],e=0,h=0;h<b.data.length;h++)"undefined"!==typeof b.data[h]&&(c[e]=b.data[h],g[b.data[h].getAttribute("ID")]=1,e++);for(h=0;h<d.length;h++)"undefined"!==typeof d[h]&&"undefined"===typeof g[d[h].getAttribute("ID")]&&(c[e]=d[h],e++);b.draw(c)}b.hideLoading()}})};b.draw=function(a){b.data=a;b.colorSelect=b.curColor;b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(var d=0;d<b.gsvg.width;d++)b.yMaxArr[d]=
0,b.yArr[0][d]=0;if("dabg"==b.colorSelect||"herit"==b.colorSelect){"dabg"==b.colorSelect?b.drawScaleLegend("0%","100%","of Samples DABG","#000000","#00FF00",0):"herit"==b.colorSelect&&b.drawScaleLegend("0","1.0","Probeset Heritability","#000000","#FF0000",0);b.svg.selectAll(".probe").remove();b.svg.selectAll(".tissueLbl").remove();b.tissueLen=b.tissues.length;for(var c=1,g=0;g<b.tissues.length;g++){var e=new String(b.tissues[g]);0<e.indexOf(";")&&(e=e.substr(0,e.indexOf(";")));0<e.indexOf(":")&&(e=
e.substr(0,e.indexOf(":")));b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(d=0;d<b.gsvg.width;d++)b.yMaxArr[d]=0,b.yArr[0][d]=0;d=e;"BrownAdipose"==d?d="Brown Adipose":"Brain"==d&&(d="Whole Brain");d=new String("Tissue: "+d);c++;b.svg.append("text").attr("class","tissueLbl "+e).attr("x",b.gsvg.width/2-d.length/2*7.5).attr("y",15*c).text(d);0<a.length&&(d=b.svg.selectAll(".probe."+e).data(a,function(h){return keyTissue(h,e)}).attr("transform",function(h,l){return"translate("+b.xScale(h.getAttribute("start"))+
","+(b.calcY(parseInt(h.getAttribute("start"),10),parseInt(h.getAttribute("stop"),10),l,h.getAttribute("ID").length)+15*c-10)+")"}),d.enter().append("g").attr("class","probe "+e).attr("transform",function(h,l){return"translate("+b.xScale(h.getAttribute("start"))+","+(b.calcY(parseInt(h.getAttribute("start"),10),parseInt(h.getAttribute("stop"),10),l,h.getAttribute("ID").length)+15*c-10)+")"}).append("rect").attr("height",10).attr("rx",1).attr("ry",1).attr("width",function(h){var l=1;1<b.xScale(h.getAttribute("stop"))-
b.xScale(h.getAttribute("start"))&&(l=b.xScale(h.getAttribute("stop"))-b.xScale(h.getAttribute("start")));return l}).attr("id",function(h){return h.getAttribute("ID")+e}).style("fill",function(h){return b.color(h,e)}).style("cursor","pointer").on("dblclick",b.zoomToFeature).on("mouseover",function(h){if(0==b.gsvg.isToolTip){overSelectable=1;$("#mouseHelp").html("<B>Double Click</B> to zoom in on this feature.");var l=d3.select(this);b.curTTColor=l.style("fill");0<l.style("opacity")&&(l.style("fill",
"green"),tt.transition().duration(200).style("opacity",1),tt.html(b.createToolTip(h)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)}),b.setupToolTipSVG(h,.2))}}).on("mouseout",function(h){overSelectable=0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");h=d3.select(this);0<h.style("opacity")&&(h.style("fill",b.curTTColor),tt.transition().delay(500).duration(200).style("opacity",
0))}),b.svg.selectAll("g.probe."+e).each(function(h){var l=d3.select(this),n=">";"-1"==h.getAttribute("strand")&&(n="<");var q=n,u=l.select("rect").attr("width");if(7.5>u)q="";else for(u-=7.5;8.5<u;)q+=n,u-=7.5;l.append("svg:text").attr("dx","1").attr("id","strand").attr("dy","10").style("pointer-events","none").style("fill","white").text(q);if(2==b.density||3==b.density){var v=h.getAttribute("ID");l.append("svg:text").attr("dx",function(){var y=b.xScale(h.getAttribute("stop"))+8*v.length+5,w=b.xScale(h.getAttribute("stop"))-
b.xScale(h.getAttribute("start"))+5;y>b.gsvg.width&&(w=-8*v.length);return w}).attr("dy",10).attr("id","lblTxt").text(v)}else l.selectAll("text#lblTxt").remove()}),c=c+b.trackYMax+1)}b.trackYMax=c;b.svg.attr("height",15*c+45)}else if("annot"==b.colorSelect){b.drawLegend([{color:"#FF0000",label:"Core"},{color:"#0000FF",label:"Extended"},{color:"#006400",label:"Full"},{color:"#000000",label:"Ambiguous"}]);b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(d=0;d<b.gsvg.width;d++)b.yMaxArr[d]=0,b.yArr[0][d]=
0;b.svg.selectAll(".probe").remove();b.svg.selectAll(".tissueLbl").remove();d=b.svg.selectAll(".probe.annot").data(a,key).attr("transform",function(h,l){return"translate("+b.xScale(h.getAttribute("start"))+","+b.calcY(parseInt(h.getAttribute("start"),10),parseInt(h.getAttribute("stop"),10),l,h.getAttribute("ID").length)+")"});d.enter().append("g").attr("class","probe annot").attr("transform",function(h,l){return"translate("+b.xScale(h.getAttribute("start"))+","+b.calcY(parseInt(h.getAttribute("start"),
10),parseInt(h.getAttribute("stop"),10),l,h.getAttribute("ID").length)+")"}).append("rect").attr("height",10).attr("rx",1).attr("ry",1).attr("width",function(h){var l=1;1<b.xScale(h.getAttribute("stop"))-b.xScale(h.getAttribute("start"))&&(l=b.xScale(h.getAttribute("stop"))-b.xScale(h.getAttribute("start")));return l}).attr("id",function(h){return h.getAttribute("ID")}).style("fill",function(h){return b.color(h,"")}).style("cursor","pointer").on("dblclick",b.zoomToFeature).on("mouseover",function(h){if(0==
b.gsvg.isToolTip){overSelectable=1;$("#mouseHelp").html("<B>Double Click</B> to zoom in on this feature.");var l=d3.select(this);0<l.style("opacity")&&(l.style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(b.createToolTip(h)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)}),b.setupToolTipSVG(h,.2))}}).on("mouseout",function(h){overSelectable=0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");
h=d3.select(this);0<h.style("opacity")&&(h.style("fill",b.color),tt.transition().delay(500).duration(200).style("opacity",0))});b.svg.selectAll("g.probe").each(function(h){var l=d3.select(this),n=">";"-1"==h.getAttribute("strand")&&(n="<");var q=n,u=l.select("rect").attr("width");if(7.5>u)q="";else for(u-=7.5;15<u;)q+=n,u-=7.5;l.append("svg:text").attr("dx","1").attr("dy","10").style("pointer-events","none").style("fill","white").text(q);if(2==b.density||3==b.density){var v=h.getAttribute("ID");l.append("svg:text").attr("dx",
function(){var y=b.xScale(h.getAttribute("stop"))+8*v.length+5,w=b.xScale(h.getAttribute("stop"))-b.xScale(h.getAttribute("start"))+5;y>b.gsvg.width&&(w=-8*v.length);return w}).attr("dy",10).attr("id","lblTxt").text(v)}else l.select("text#lblTxt").remove()});1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(b.trackYMax+1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1))}b.redrawSelectedArea()};b.getDisplayedData=function(){var a=d3.select("#Level"+b.gsvg.levelNumber+
b.trackClass).selectAll("g.probe");b.counts=[{value:0,names:"Core"},{value:0,names:"Extended"},{value:0,names:"Full"},{value:0,names:"Ambiguous"}];var d=[],c=0;a.each(function(g){var e=b.xScale(g.getAttribute("start")),h=b.xScale(g.getAttribute("stop"));if(0<=e&&e<=b.gsvg.width||0<=h&&h<=b.gsvg.width)"core"==g.getAttribute("type")?b.counts[0].value++:"extended"==g.getAttribute("type")?b.counts[1].value++:"full"==g.getAttribute("type")?b.counts[2].value++:"ambiguous"==g.getAttribute("type")&&b.counts[3].value++,
d[c]=g,c++});0===a.size()&&(b.counts=[]);return d};b.generateSettingsDiv=function(a){var d=trackInfo[b.trackClass];b.savePrevious();d3.select(a).select("table").select("tbody").html("");if("undefined"!==typeof d&&"undefined"!==typeof d.Controls&&"null"!=d.Controls&&0<d.Controls.length){var c=(new String(d.Controls)).split(",");a=d3.select(a).select("table").select("tbody");a.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+d.Name);for(d=0;d<c.length;d++)if("undefined"!==
typeof c[d]&&""!=c[d]){var g=c[d].split(";"),e=a.append("tr").append("td"),h=g[0].substr(5);3<g.length&&0==g[3].indexOf("Default=")&&g[3].substr(8);if(0==g[1].toLowerCase().indexOf("select")){e.append("text").text(h+": ");h=g[1].split(":");g=g[2].split("}");var l=b.trackClass+"Dense"+b.level+"Select";"colorSelect"==h[1]&&(l=b.trackClass+b.level+"colorSelect");for(var n=e.append("select").attr("id",l).attr("name",h[1]),q=0;q<g.length;q++){var u=g[q].substr(1).split(":");2==u.length&&(e=n.append("option").attr("value",
u[1]).text(u[0]),"colorSelect"==h[1]&&u[1]==b.curColor?e.attr("selected","selected"):u[1]==b.density&&e.attr("selected","selected"))}d3.select("select#"+l).on("change",function(){"dabg"==$(this).val()||"herit"==$(this).val()?$("div#affyTissues"+b.level).show():$("div#affyTissues"+b.level).hide();b.updateSettingsFromUI();b.redraw()})}else if(0==g[1].toLowerCase().indexOf("cbx"))for(e=e.append("div").attr("id","affyTissues"+b.level).style("display","none"),e.append("text").text(h+": "),h=g[1].split(":"),
g=g[2].split("}"),q=0;q<g.length;q++)u=g[q].substr(1).split(":"),2==u.length&&(l=e.append("div").style("display","inline-block"),n=l.append("input").attr("type","checkbox").attr("id",u[1]+"CBX"+b.level).attr("name",h[1]).style("margin-left","5px"),l.append("text").text(u[0]),d3.select("input#"+u[1]+"CBX"+b.level).on("change",function(){b.updateSettingsFromUI();b.redraw()}))}"dabg"==b.curColor||"herit"==b.curColor?$("div#affyTissues"+b.level).show():$("div#affyTissues"+b.level).hide();for(c=0;c<b.tissues.length;c++)$("#"+
b.tissues[c]+"AffyCBX"+b.level).prop("checked",!0);c=a.append("tr").append("td");c.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");b.gsvg.removeTrack(b.trackClass);var v=svgList[b.gsvg.levelNumber].currentView.ViewID,y=viewMenu[b.gsvg.levelNumber].findTrackByClass(b.trackClass,v);y=viewMenu[b.gsvg.levelNumber].findTrackIndexWithViewID(y.TrackID,v);viewMenu[b.gsvg.levelNumber].removeTrackWithIDIdx(y,
v)});c.append("input").attr("type","button").attr("value","Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");b.density==b.prevSetting.density&&b.curColor==b.prevSetting.curColor&&b.tissues==b.prevSetting.tissues||b.gsvg.setCurrentViewModified()});c.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){b.revertPrevious();b.draw(b.data);$("#trackSettingDialog").fadeOut("fast")})}else a=
d3.select(a).select("table").select("tbody"),a.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+d.Name),a.append("tr").append("td").html("Sorry no settings for this track."),c=a.append("tr").append("td"),c.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")}),c.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left",
"5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")})};b.generateTrackSettingString=function(){for(var a="",d=0;d<b.tissues.length;d++)0<d&&(a+=":"),a+=b.tissues[d];return b.trackClass+","+b.density+","+b.curColor+","+a+";"};b.draw(m);return b}
function SNPTrack(p,m,r,t,f){var b=Track(p,m,r,a);p=(new String(r)).substr(3);f=(new String(f)).split(",");b.include=0<f.length?f[0]:4;b.density=t;var a=p;"SHRH"==a?a="SHR/OlaPrin":"BNLX"==a?a="BN-Lx/CubPrin":"SHRJ"==a&&(a="SHR/NCrlPrin");b.displayStrain=a;1==b.include?a+=" SNPs":2==b.include?a+=" Insertions":3==b.include?a+=" Deletions":4==b.include&&(a+=" SNPs/Indels");b.counts=[{value:0,perc:0,names:"SNP "+b.displayStrain},{value:0,perc:0,names:"Insertion "+b.displayStrain},{value:0,perc:0,names:"Deletion "+
b.displayStrain}];b.strain=p;b.ttTrackList=[];b.ttTrackList.push("ensemblcoding");b.ttTrackList.push("braincoding");b.ttTrackList.push("liverTotal");b.ttTrackList.push("heartTotal");b.ttTrackList.push("mergedTotal");b.ttTrackList.push("refSeq");b.ttTrackList.push("ensemblnoncoding");b.ttTrackList.push("brainnoncoding");b.ttTrackList.push("ensemblsmallnc");b.ttTrackList.push("brainsmallnc");b.ttTrackList.push("probe");b.ttTrackList.push("repeatMask");b.xPadding=1;b.scanBackYLines=50;b.updateSettingsFromUI=
function(){0<$("#"+b.trackClass+"Dense"+b.level+"Select").length&&(b.density=$("#"+b.trackClass+"Dense"+b.level+"Select").val());0<$("#"+b.trackClass+b.level+"Select").length&&(b.include=$("#"+b.trackClass+b.level+"Select").val())};b.savePrevious=function(){b.prevSetting={};b.prevSetting.density=b.density;b.prevSetting.include=b.include};b.revertPrevious=function(){b.density=b.prevSetting.density;b.include=b.prevSetting.include};b.generateTrackSettingString=function(){return b.trackClass+","+b.density+
","+b.include+";"};b.generateSettingsDiv=function(d){var c=trackInfo[b.trackClass];b.savePrevious();d3.select(d).select("table").select("tbody").html("");if(0<c.Controls.length&&"null"!=c.Controls){var g=(new String(c.Controls)).split(",");d=d3.select(d).select("table").select("tbody");d.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name);for(c=0;c<g.length;c++)if("undefined"!==typeof g[c]&&""!=g[c]){var e=g[c].split(";"),h=d.append("tr").append("td"),l=e[0].substr(5);
h.append("text").text(l+": ");3<e.length&&0==e[3].indexOf("Default=")&&e[3].substr(8);if(0==e[1].toLowerCase().indexOf("select")){var n=e[1].split(":");e=e[2].split("}");var q=l="";2<n.length&&(l=n[2]);3<n.length&&(q=n[3]);h=h.append("select").attr("id",b.trackClass+l+b.level+q).attr("name",n[1]);for(n=0;n<e.length;n++){var u=e[n].substr(1).split(":");if(2==u.length){var v=h.append("option").attr("value",u[1]).text(u[0]);("Dense"==l&&u[1]==b.density||""==l&&u[1]==b.include)&&v.attr("selected","selected")}}d3.select("#"+
b.trackClass+l+b.level+q).on("change",function(){b.updateSettingsFromUI();b.updateData()})}else console.log("Undefined track settings:  "+g[c])}g=d.append("tr").append("td");g.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");b.gsvg.removeTrack(b.trackClass);var y=svgList[b.gsvg.levelNumber].currentView.ViewID,w=viewMenu[b.gsvg.levelNumber].findTrackByClass(b.trackClass,
y);w=viewMenu[b.gsvg.levelNumber].findTrackIndexWithViewID(w.TrackID,y);viewMenu[b.gsvg.levelNumber].removeTrackWithIDIdx(w,y)});g.append("input").attr("type","button").attr("value","Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");b.density==b.prevSetting.density&&b.include==b.prevSetting.include||b.gsvg.setCurrentViewModified()});g.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left",
"5px").on("click",function(){b.revertPrevious();b.draw(b.data);$("#trackSettingDialog").fadeOut("fast")})}else d=d3.select(d).select("table").select("tbody"),d.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name),d.append("tr").append("td").html("Sorry no settings for this track."),g=d.append("tr").append("td"),g.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")}),
g.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")})};b.redraw=function(){b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(var d=0;d<b.gsvg.width;d++)b.yMaxArr[d]=0,b.yArr[0][d]=0;b.svg.selectAll("g.snp").attr("transform",function(c,g){return"translate("+b.xScale(c.getAttribute("start"))+","+b.calcY(parseInt(c.getAttribute("start"),10),parseInt(c.getAttribute("stop"),10),
g)+")"});b.svg.selectAll("g.snp rect").attr("width",function(c){var g=1;1<b.xScale(c.getAttribute("stop"))-b.xScale(c.getAttribute("start"))&&(g=b.xScale(c.getAttribute("stop"))-b.xScale(c.getAttribute("start")));return g});6<b.xScale(b.xScale.domain()[0]+1)?b.svg.selectAll(".snp").each(function(c){var g=b.xScale(c.getAttribute("stop"))-b.xScale(c.getAttribute("start")),e=new String(c.getAttribute("strainSeq")),h="8px",l=3.2,n=8;"SNP"!=c.getAttribute("type")&&(h="7px",l=3,n=7);0==d3.select(this).selectAll("text").size()&&
e.length*l<g?d3.select(this).append("text").attr("y",n).attr("x",function(q){q=0;7<g&&(q=g/2-e.length/2*l);return q}).attr("font-size",h).attr("stroke",d3.rgb("#FFFFFF")).attr("class","snpLbl").text(e):d3.select(this).selectAll(".snpLbl").attr("x",function(q){q=0;7<g&&(q=g/2-e.length/2*l);return q})}):b.svg.selectAll("text.snpLbl").remove();1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(b.trackYMax+1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1));b.redrawSelectedArea()};
b.color=function(d){d3.rgb("#000000");return"SNP"===d.getAttribute("type")?"BNLX"===d.getAttribute("strain")?d3.rgb(0,0,255):"SHRH"===d.getAttribute("strain")?d3.rgb(255,0,0):"SHRJ"===d.getAttribute("strain")?d3.rgb("#00FF00"):"F344"===d.getAttribute("strain")?d3.rgb("#00FFFF"):d3.rgb(100,100,100):"BNLX"===d.getAttribute("strain")?d3.rgb(0,0,150):"SHRH"===d.getAttribute("strain")?d3.rgb(150,0,0):"SHRJ"===d.getAttribute("strain")?d3.rgb("#009600"):"F344"===d.getAttribute("strain")?d3.rgb("#009696"):
d3.rgb(50,50,50)};b.getDisplayID=function(d){return d.getAttribute("type")+"_"+keySNP(d)};b.createToolTip=function(d){var c=d.getAttribute("strain");"SHRH"==c&&(c="SHR");c='<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>Type: '+d.getAttribute("type")+"<BR>Strain: "+c+"<BR>Sequence: "+d.getAttribute("refSeq")+"->"+d.getAttribute("strainSeq")+"<BR>Location: chr"+d.getAttribute("chromosome")+":"+numberWithCommas(d.getAttribute("start"));"SNP"!=d.getAttribute("type")&&(c=c+"-"+numberWithCommas(d.getAttribute("stop")));
return c};b.update=function(d){b.redraw()};b.updateData=function(d){d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/snp"+b.strain+".xml",function(c,g){if(c)3>d?(c=1E4,1==d&&(c=15E3),setTimeout(function(){b.updateData(d+1)},c)):3<=d&&(d3.select("#Level"+b.levelNumber+b.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+b.trackClass),d3.select("#Level"+b.levelNumber+b.trackClass).attr("height",15),b.gsvg.addTrackErrorRemove(b.svg,"#Level"+b.gsvg.levelNumber+
b.trackClass));else{c=g.documentElement.getElementsByTagName("Snp");g=[];for(var e=[],h=0,l=0;l<c.length;l++)"undefined"!==typeof c[l]&&(g[h]=c[l],e[keySNP(c[l])]=1,h++);for(l=0;l<b.data.length;l++)"undefined"!==typeof b.data[l]&&"undefined"===typeof e[keySNP(b.data[l])]&&(g[h]=b.data[l],h++);b.draw(g);b.hideLoading()}})};b.getDisplayedData=function(){var d=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".snp");b.counts=[{value:0,perc:0,names:"SNP"},{value:0,perc:0,names:"Insertion"},
{value:0,perc:0,names:"Deletion"}];var c=[],g=0,e=0;d.each(function(h){var l=b.xScale(h.getAttribute("start")),n=b.xScale(h.getAttribute("stop"));if(0<=l&&l<=b.gsvg.width||0<=n&&n<=b.gsvg.width)l=0,"Insertion"==h.getAttribute("type")?l++:"Deletion"==h.getAttribute("type")&&(l+=2),b.counts[l].value++,c[g]=h,g++,e++});return c};b.draw=function(d){b.data=d;b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(var c=0;c<b.gsvg.width;c++)b.yMaxArr[c]=0,b.yArr[0][c]=0;c=b.strain;"SHRH"==c?c="SHR/OlaPrin":
"BNLX"==c?c="BN-Lx/CubPrin":"SHRJ"==c&&(c="SHR/NCrlPrin");1==b.include?c+=" SNPs":2==b.include?c+=" Insertions":3==b.include?c+=" Deletions":4==b.include&&(c+=" SNPs/Indels");b.updateLabel(c);b.redrawLegend();if(4>b.include){c=[];for(var g=0,e=0;e<d.length;e++)"undefined"!==typeof d[e]&&(1==b.include&&"SNP"==d[e].getAttribute("type")?(c[g]=d[e],g++):2==b.include&&"Insertion"==d[e].getAttribute("type")?(c[g]=d[e],g++):3==b.include&&"Deletion"==d[e].getAttribute("type")&&(c[g]=d[e],g++));b.data=c}b.svg.selectAll(".snp").remove();
0<b.data.length&&(d=b.svg.selectAll(".snp").data(d,keySNP).attr("transform",function(h,l){return"translate("+b.xScale(h.getAttribute("start"))+","+b.calcY(parseInt(h.getAttribute("start"),10),parseInt(h.getAttribute("stop"),10),l)+")"}),d.enter().append("g").attr("class","snp").attr("transform",function(h,l){return"translate("+b.xScale(h.getAttribute("start"))+","+b.calcY(parseInt(h.getAttribute("start"),10),parseInt(h.getAttribute("stop"),10),l)+")"}).append("rect").attr("height",10).attr("rx",1).attr("ry",
1).attr("width",function(h){var l=1;1<b.xScale(h.getAttribute("stop"))-b.xScale(h.getAttribute("start"))&&(l=b.xScale(h.getAttribute("stop"))-b.xScale(h.getAttribute("start")));return l}).attr("id",keySNP).style("fill",b.color).on("mouseover",function(h){0==b.gsvg.isToolTip&&(d3.select(this).style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(b.createToolTip(h)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)}),
b.setupToolTipSVG(h,.2))}).on("mouseout",function(h){d3.select(this).style("fill",b.color);tt.transition().delay(500).duration(200).style("opacity",0)}),1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(b.trackYMax+1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1)),d.merge(d),d.exit().remove());b.redrawSelectedArea()};b.pieColor=function(d,c){c=d3.rgb("#000000");d=new String(d.data.names);"BNLX"==b.strain?c=-1<d.indexOf("SNP")?d3.rgb(0,0,255):-1<d.indexOf("Insertion")?
d3.rgb(0,0,175):d3.rgb(0,0,125):"SHRJ"==b.strain?c=-1<d.indexOf("SNP")?d3.rgb(0,255,0):-1<d.indexOf("Insertion")?d3.rgb(0,175,0):d3.rgb(0,125,0):"F344"==b.strain?c=-1<d.indexOf("SNP")?d3.rgb(0,255,255):-1<d.indexOf("Insertion")?d3.rgb(0,175,175):d3.rgb(0,125,125):"SHRH"==b.strain&&(c=-1<d.indexOf("SNP")?d3.rgb(255,0,0):-1<d.indexOf("Insertion")?d3.rgb(175,0,0):d3.rgb(125,0,0));return c};b.redrawLegend=function(){var d=[];4==b.include?d="BNLX"==b.strain?[{color:"#0000FF",label:"SNP"},{color:"#000096",
label:"Insertion/Deletion"}]:"SHRH"==b.strain?[{color:"#FF0000",label:"SNP"},{color:"#960000",label:"Insertion/Deletion"}]:"SHRJ"==b.strain?[{color:"#00FF00",label:"SNP"},{color:"#009600",label:"Insertion/Deletion"}]:"F344"==b.strain?[{color:"#00FFFF",label:"SNP"},{color:"#009696",label:"Insertion/Deletion"}]:[{color:"#DEDEDE",label:"SNP"},{color:"#969696",label:"Insertion/Deletion"}]:3==b.include||2==b.include?d="BNLX"==b.strain?[{color:"#000096",label:"Insertion/Deletion"}]:"SHRH"==b.strain?[{color:"#960000",
label:"Insertion/Deletion"}]:"SHRJ"==b.strain?[{color:"#009600",label:"Insertion/Deletion"}]:"F344"==b.strain?[{color:"#009696",label:"Insertion/Deletion"}]:[{color:"#969696",label:"Insertion/Deletion"}]:1==b.include&&(d="BNLX"==b.strain?[{color:"#0000FF",label:"SNP"}]:"SHRH"==b.strain?[{color:"#FF0000",label:"SNP"}]:"SHRJ"==b.strain?[{color:"#00FF00",label:"SNP"}]:"F344"==b.strain?[{color:"#00FFFF",label:"SNP"}]:[{color:"#DEDEDE",label:"SNP"}]);b.drawLegend(d)};b.strain=p;b.redrawLegend();b.draw(m);
return b}
function QTLTrack(p,m,r,t){var f=Track(p,m,r,"QTLs Overlapping Region");f.color=function(b){return f.pieColorPalette(b)};f.redraw=function(){f.yCount=0;f.idList=[];f.svg.selectAll("g.qtl").attr("transform",function(b,a){return"translate("+f.xScale(b.getAttribute("start"))+","+f.calcY(b,a)+")"});d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll("g.qtl rect").attr("width",function(b){var a=1;1<f.xScale(b.getAttribute("stop"))-f.xScale(b.getAttribute("start"))&&(a=f.xScale(b.getAttribute("stop"))-f.xScale(b.getAttribute("start")));
return a});f.svg.attr("height",15*f.yCount);f.redrawSelectedArea()};f.createToolTip=function(b){return"Name: "+b.getAttribute("name")+"<BR>Location: "+b.getAttribute("chromosome")+":"+numberWithCommas(b.getAttribute("start"))+"-"+numberWithCommas(b.getAttribute("stop"))+"<BR>Trait:<BR>"+b.getAttribute("trait")+"<BR><BR>Phenotype:<BR>"+b.getAttribute("phenotype")+"<BR><BR>Candidate Genes:<BR>"+b.getAttribute("candidate")};f.pieColorPalette=d3.scaleOrdinal(d3.schemeCategory20);f.pieColor=function(b){return f.pieColorPalette(b.data.names)};
f.triggerTableFilter=function(b){var a=jQuery.Event("keyup");a.which=32;var d="";"undefined"===typeof b.getAttribute||"undefined"===typeof b.getAttribute("ID")?"undefined"!==typeof b.data&&"undefined"!==typeof b.data.names&&(d=b.data.names):d=b.getAttribute("ID");$("#tblBQTL_filter input").val(d).trigger(a)};f.clearTableFilter=function(b){b=jQuery.Event("keyup");b.which=32;$("#tblBQTL_filter input").val("").trigger(b)};f.getDisplayedData=function(){var b=d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll(".qtl");
f.counts=[];var a=0,d=b.data();console.log(b);console.log(d);b=[];var c=0,g=0;if("undefined"!==typeof d)for(var e=0;e<d.length;e++){var h=f.xScale(d[e].getAttribute("start")),l=f.xScale(d[e].getAttribute("stop"));if(0<=h&&h<=f.gsvg.width||0<=l&&l<=f.gsvg.width||0>=h&&l>=f.gsvg.width)h=new String(d[e].getAttribute("name")),l=/[0-9]+\s*$/g,l=h.search(l),-1<l&&(h=h.substr(0,l)),l=/QTL\s*$/g,l=h.search(l),-1<l&&(h=h.substr(0,l)),l=/traits+\s*$/g,l=h.search(l),-1<l&&(h=h.substr(0,l+5)),"undefined"===typeof f.counts[h]?
(f.counts[h]={},f.counts[a]=f.counts[h],a++,f.counts[h].value=1,f.counts[h].names=h):f.counts[h].value++,b[c]=d[e],c++,g++}return b};f.setupDetailedView=function(b){$("div#collapsableReport").is(":hidden")||($("div#collapsableReport").hide(),$("span[name='collapsableReport']").removeClass("less"));$("div#selectedDetailHeader").is(":hidden")&&$("div#selectedDetailHeader").show();$("div#selectedDetail").is(":hidden")&&$("div#selectedDetail").show();$("div#selectedImage").hide();$("div#selectedReport").show();
var a=pathPrefix+"bQTLReport.jsp";b={id:b.getAttribute("ID"),species:organism,genomeVer};DisplaySelectedDetailReport(a,b)};f.updateData=function(b){d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+f.gsvg.folderName+"/qtl.xml",function(a,d){if(a)3>b?(a=1E4,1==b&&(a=15E3),setTimeout(function(){f.updateData(b+1)},a)):(d3.select("#Level"+f.levelNumber+f.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+f.trackClass),d3.select("#Level"+f.levelNumber+f.trackClass).attr("height",
15),f.gsvg.addTrackErrorRemove(f.svg,"#Level"+f.gsvg.levelNumber+f.trackClass));else{if(d){a=d.documentElement.getElementsByTagName("QTL");d=[];for(var c=[],g=0,e=0;e<a.length;e++)"undefined"!==typeof a[e]&&(d[g]=a[e],c[a[e].getAttribute("ID")]=1,g++);for(e=0;e<f.data.length;e++)"undefined"!==typeof f.data[e]&&"undefined"===typeof c[f.data[e].getAttribute("ID")]&&(d[g]=f.data[e],g++);f.draw(d)}f.hideLoading()}})};f.calcY=function(b,a){a=0;"undefined"===typeof f.idList[b.getAttribute("ID")]&&(a=f.yCount++);
return 15*(a+1)};f.draw=function(b){f.data=b;f.yCount=0;f.idList=[];f.data&&0<f.data.length?(console.log(f.svg),console.log(f.svg.selectAll(".qtl")),b=f.svg.selectAll(".qtl").data(b,key),console.log(b),b.enter().append("g").attr("class","qtl").attr("transform",function(a,d){return"translate("+f.xScale(a.getAttribute("start"))+","+f.calcY(a,d)+")"}).append("rect").attr("height",10).attr("rx",1).attr("ry",1).attr("width",function(a){var d=1;1<f.xScale(a.getAttribute("stop"))-f.xScale(a.getAttribute("start"))&&
(d=f.xScale(a.getAttribute("stop"))-f.xScale(a.getAttribute("start")));return d}).attr("id",function(a){return a.getAttribute("id")}).style("fill","blue").style("cursor","pointer").on("click",f.setupDetailedView).on("mouseover",function(a){0==f.gsvg.isToolTip&&(overSelectable=1,$("#mouseHelp").html("<B>Click</B> to see additional details. <B>Double Click</B> to zoom in on this feature."),d3.select(this).style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(f.createToolTip(a)).style("left",
function(){return f.positionTTLeft(d3.event.pageX)}).style("top",function(){return f.positionTTTop(d3.event.pageY)}),f.triggerTableFilter(a))}).on("mouseout",function(a){overSelectable=0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");var d=a.getAttribute("name"),c=/[0-9]+\s*$/g;c=d.search(c);-1<c&&(d=d.substr(0,c));c=/QTL\s*$/g;c=d.search(c);-1<c&&(d=d.substr(0,c));c=/traits?\s*$/g;c=d.search(c);-1<c&&(d=d.substr(0,c+5));d3.select(this).style("fill",
f.color(d));tt.transition().delay(500).duration(200).style("opacity",0);f.clearTableFilter(a)}).merge(b),b.exit().remove(),"undefined"!==typeof b[0]&&b[0].forEach(function(a){if("undefined"!==typeof a){var d=new String(a.data().getAttribute("name")),c=/[0-9]+\s*$/g;c=d.search(c);-1<c&&(d=d.substr(0,c));c=/QTL\s*$/g;c=d.search(c);-1<c&&(d=d.substr(0,c));c=/traits?\s*$/g;c=d.search(c);-1<c&&(d=d.substr(0,c+5));d3.select(a).select("rect").style("fill",f.color(d))}}),f.svg.attr("height",15*f.yCount)):
f.svg.attr("height",15);f.redrawSelectedArea()};f.draw(m);f.redraw();return f}
function TranscriptTrack(p,m,r,t){var f=Track(p,m,r,"Selected Gene Transcripts");f.createToolTip=function(b){var a=".";1==b.getAttribute("strand")?a="+":-1==b.getAttribute("strand")&&(a="-");a="ID: "+b.getAttribute("ID")+"<BR>Location: chr"+b.getAttribute("chromosome")+":"+numberWithCommas(b.getAttribute("start"))+"-"+numberWithCommas(b.getAttribute("stop"))+"<BR>Strand: "+a;-1==(new String(b.getAttribute("ID"))).indexOf("ENS")&&(b=getFirstChildByName(getFirstChildByName(b,"annotationList"),"annotation"),
null!=b&&(a+="<BR>Matching: "+b.getAttribute("reason")));return a};f.color=function(b){var a=d3.rgb("#000000");"protein"==f.gsvg.txType?a=-1<(new String(b.getAttribute("ID"))).indexOf("ENS")?d3.rgb("#DFC184"):d3.rgb("#7EB5D6"):"long"==f.gsvg.txType?a=-1<(new String(b.getAttribute("ID"))).indexOf("ENS")?d3.rgb("#B58AA5"):d3.rgb("#CECFCE"):"small"==f.gsvg.txType?a=-1<(new String(b.getAttribute("ID"))).indexOf("ENS")?d3.rgb("#FFCC00"):d3.rgb("#99CC99"):"liverTotal"==f.gsvg.txType?a=d3.rgb("#bbbedd"):
"heartTotal"==f.gsvg.txType?a=d3.rgb("#DC7252"):"mergedTotal"==f.gsvg.txType&&(a=d3.rgb("#9F4F92"));return a};f.drawTrx=function(b,a){a=parseInt(b.getAttribute("start"),10);var d=parseInt(b.getAttribute("stop"),10);"undefined"!==typeof b.getAttribute("cdsStart")&&"undefined"!==typeof b.getAttribute("cdsStop")&&(a=parseInt(b.getAttribute("cdsStart"),10),d=parseInt(b.getAttribute("cdsStop"),10));var c=d3.select("#Level"+f.gsvg.levelNumber+f.trackClass+" #tx"+b.getAttribute("ID"));exList=getAllChildrenByName(getFirstChildByName(b,
"exonList"),"exon");for(var g=0;g<exList.length;g++){var e=parseInt(exList[g].getAttribute("start"),10),h=parseInt(exList[g].getAttribute("stop"),10);if(e<a&&a<h||h>d&&d>e){var l=0,n=0,q=0,u=0;e<a?(l=f.xScale(exList[g].getAttribute("start")),n=f.xScale(a)-f.xScale(exList[g].getAttribute("start")),q=f.xScale(a),u=f.xScale(exList[g].getAttribute("stop"))-f.xScale(a)):h>d&&(q=f.xScale(exList[g].getAttribute("start")),u=f.xScale(d)-f.xScale(exList[g].getAttribute("start")),l=f.xScale(d),n=f.xScale(exList[g].getAttribute("stop"))-
f.xScale(d));c.append("rect").attr("x",l).attr("y",2.5).attr("height",5).attr("width",n).attr("title",function(v){return exList[g].getAttribute("ID")}).attr("id",function(v){return"ExNC"+exList[g].getAttribute("ID")}).style("fill",f.color).style("cursor","pointer");c.append("rect").attr("x",q).attr("height",10).attr("width",u).attr("title",function(v){return exList[g].getAttribute("ID")}).attr("id",function(v){return"Ex"+exList[g].getAttribute("ID")}).style("fill",f.color).style("cursor","pointer")}else{l=
10;n=0;if(e<a&&h<a||h>d&&e>d)l=5,n=2.5;c.append("rect").attr("x",function(v){return f.xScale(exList[g].getAttribute("start"))}).attr("y",n).attr("height",l).attr("width",function(v){return f.xScale(exList[g].getAttribute("stop"))-f.xScale(exList[g].getAttribute("start"))}).attr("title",function(v){return exList[g].getAttribute("ID")}).attr("id",function(v){return"Ex"+exList[g].getAttribute("ID")}).style("fill",f.color).style("cursor","pointer")}if(0<g){c.append("line").attr("x1",function(v){return f.xScale(exList[g-
1].getAttribute("stop"))}).attr("x2",function(v){return f.xScale(exList[g].getAttribute("start"))}).attr("y1",5).attr("y2",5).attr("id",function(v){return"Int"+exList[g-1].getAttribute("ID")+"_"+exList[g].getAttribute("ID")}).attr("stroke",f.color).attr("stroke-width","2");e=">";"-1"==b.getAttribute("strand")&&(e="<");h=e;l=f.xScale(exList[g-1].getAttribute("stop"));n=f.xScale(exList[g].getAttribute("start"))-l;q=0;if(7>n)h="";else for(n-=7;8<n;)0==q?(h+=" ",q=1):(h+=e,q=0),n-=7;c.append("svg:text").attr("id",
function(v){return"IntTxt"+exList[g-1].getAttribute("ID")+"_"+exList[g].getAttribute("ID")}).attr("dx",l+1).attr("dy","11").style("pointer-events","none").style("opacity","0.5").style("fill",f.color).style("font-size","16px").text(h)}}};f.redraw=function(){d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll("g.trx"+f.gsvg.levelNumber).each(function(b,a){a=parseInt(b.getAttribute("start"),10);var d=parseInt(b.getAttribute("stop"),10);"undefined"!==typeof b.getAttribute("cdsStart")&&"undefined"!==
typeof b.getAttribute("cdsStop")&&(a=parseInt(b.getAttribute("cdsStart"),10),d=parseInt(b.getAttribute("cdsStop"),10));exList=getAllChildrenByName(getFirstChildByName(b,"exonList"),"exon");for(var c=0;c<exList.length;c++){var g=parseInt(exList[c].getAttribute("start"),10),e=parseInt(exList[c].getAttribute("stop"),10);if(g<a&&a<e||e>d&&d>g){var h=g,l=a;e>d?(h=d,l=e,e=d):g=a;d3.select("#Level"+f.gsvg.levelNumber+f.trackClass+" g#tx"+b.getAttribute("ID")+" rect#ExNC"+exList[c].getAttribute("ID")).attr("x",
function(C){return f.xScale(h)}).attr("width",function(C){return f.xScale(l)-f.xScale(h)})}d3.select("#Level"+f.gsvg.levelNumber+f.trackClass+" g#tx"+b.getAttribute("ID")+" rect#Ex"+exList[c].getAttribute("ID")).attr("x",function(C){return f.xScale(g)}).attr("width",function(C){return f.xScale(e)-f.xScale(g)});if(0<c){var n=">";"-1"==b.getAttribute("strand")&&(n="<");var q=n,u=f.xScale(exList[c-1].getAttribute("stop")),v=f.xScale(exList[c].getAttribute("start")),y=v-u,w=0;if(7>y)q="";else for(y-=
7;8<y;)0==w?(q+=" ",w=1):(q+=n,w=0),y-=7;d3.select("#Level"+f.gsvg.levelNumber+f.trackClass+" g#tx"+b.getAttribute("ID")+" line#Int"+exList[c-1].getAttribute("ID")+"_"+exList[c].getAttribute("ID")).attr("x1",u).attr("x2",v);d3.select("#Level"+f.gsvg.levelNumber+f.trackClass+" g#tx"+b.getAttribute("ID")+" #IntTxt"+exList[c-1].getAttribute("ID")+"_"+exList[c].getAttribute("ID")).attr("dx",u+1).text(q)}}});f.redrawSelectedArea()};f.update=function(){var b=getAllChildrenByName(getFirstChildByName(f.gsvg.selectedData,
"TranscriptList"),"Transcript"),a=parseInt(f.gsvg.selectedData.getAttribute("start"),10),d=parseInt(f.gsvg.selectedData.getAttribute("stop"),10);"undefined"!==typeof f.gsvg.selectedData.getAttribute("extStart")&&"undefined"!==typeof f.gsvg.selectedData.getAttribute("extStop")&&(a=parseInt(f.gsvg.selectedData.getAttribute("extStart"),10),d=parseInt(f.gsvg.selectedData.getAttribute("extStop"),10));f.txMin=a;f.txMax=d;f.svg.attr("height",15*(1+b.length));d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll(".trx"+
f.gsvg.levelNumber).remove();b=d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll(".trx"+f.gsvg.levelNumber).data(b,key).attr("transform",function(c,g){return"translate("+f.xScale(c.getAttribute("start"))+","+f.calcY(c,g)+")"});b.enter().append("g").attr("class","trx"+f.gsvg.levelNumber).attr("transform",function(c,g){return"translate(0,"+f.calcY(c,g)+")"}).attr("id",function(c){return c.getAttribute("ID")}).style("cursor","pointer").on("mouseover",function(c){0==f.gsvg.isToolTip&&(d3.select(this).selectAll("line").style("stroke",
"green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(f.createToolTip(c)).style("left",function(){return f.positionTTLeft(d3.event.pageX)}).style("top",function(){return f.positionTTTop(d3.event.pageY)}))}).on("mouseout",function(c){d3.select(this).selectAll("line").style("stroke",f.color);d3.select(this).selectAll("rect").style("fill",f.color);d3.select(this).selectAll("text").style("opacity",
"0.6").style("fill",f.color);tt.transition().delay(500).duration(200).style("opacity",0)}).each(f.drawTrx);b.exit().remove();f.svg.selectAll(".legend").remove();b=[];"protein"==f.gsvg.txType?b=[{color:"#DFC184",label:"Ensembl"},{color:"#7EB5D6",label:"RNA-Seq"}]:"long"==f.gsvg.txType?b=[{color:"#B58AA5",label:"Ensembl"},{color:"#CECFCE",label:"RNA-Seq"}]:"small"==f.gsvg.txType?b=[{color:"#FFCC00",label:"Ensembl"},{color:"#99CC99",label:"RNA-Seq"}]:"liverTotal"==f.gsvg.txType?b=[{color:"#bbbedd",label:"Liver RNA-Seq"}]:
"mergedTotal"==f.gsvg.txType&&(b=[{color:"#9F4F92",label:"Merged RNA-Seq"}]);f.drawLegend(b)};f.calcY=function(b,a){return 15*(a+1)};f.redrawLegend=function(){};"undefined"!==typeof f.gsvg.selectedData.getAttribute("extStart")?(f.txMin=parseInt(f.gsvg.selectedData.getAttribute("extStart"),10),f.txMax=parseInt(f.gsvg.selectedData.getAttribute("extStop"),10)):(f.txMin=parseInt(f.gsvg.selectedData.getAttribute("start"),10),f.txMax=parseInt(f.gsvg.selectedData.getAttribute("stop"),10));d3.select("#Level"+
f.gsvg.levelNumber+f.trackClass).attr("height",15*(1+m.length));d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll(".trx"+f.gsvg.levelNumber).remove();p=d3.select("#Level"+f.gsvg.levelNumber+f.trackClass).selectAll(".trx"+f.gsvg.levelNumber).data(m,key).attr("transform",function(b,a){return"translate("+f.xScale(b.getAttribute("start"))+","+f.calcY(b,a)+")"});p.enter().append("g").attr("class","trx"+f.gsvg.levelNumber).attr("transform",function(b,a){return"translate(0,"+f.calcY(b,a)+")"}).attr("id",
function(b){return"tx"+b.getAttribute("ID")}).style("cursor","pointer").on("mouseover",function(b){0==f.gsvg.isToolTip&&(d3.select(this).selectAll("line").style("stroke","green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(f.createToolTip(b)).style("left",function(){return f.positionTTLeft(d3.event.pageX)}).style("top",function(){return f.positionTTTop(d3.event.pageY)}))}).on("mouseout",
function(b){d3.select(this).selectAll("line").style("stroke",f.color);d3.select(this).selectAll("rect").style("fill",f.color);d3.select(this).selectAll("text").style("opacity","0.6").style("fill",f.color);tt.transition().delay(500).duration(200).style("opacity",0)}).each(f.drawTrx);p.exit().remove();f.redrawLegend();f.scaleSVG.transition().duration(300).style("opacity",1);f.svg.transition().duration(300).style("opacity",1);f.redraw();return f}
function HelicosTrack(p,m,r,t){p=CountTrack(p,m,r,t);p.graphColorText="#DD0000";p.updateLabel("Brain Helicos RNA Read Counts");p.redrawLegend();p.redraw();return p}function IlluminaSmallTrack(p,m,r,t){p=CountTrack(p,m,r,t);p.graphColorText="#99CC99";p.updateLabel("Brain Illumina Small RNA Read Counts");p.redrawLegend();p.redraw();p.redraw();return p}
function IlluminaTotalTrack(p,m,r,t){p=CountTrack(p,m,r,t);p.updateLabel("BNLx/SHR Brain Illumina Total-RNA(rRNA depleted) Read Counts");p.redrawLegend();return p}function LiverIlluminaTotalPlusTrack(p,m,r,t){p=CountTrack(p,m,r,t);p.graphColorText="#abaecd";p.updateLabel("BNLx/SHR Liver + Strand Total-RNA Read Counts");p.redrawLegend();p.redraw();return p}
function LiverIlluminaTotalMinusTrack(p,m,r,t){p=CountTrack(p,m,r,t);p.graphColorText="#dbdefd";p.updateLabel("BNLx/SHR Liver - Strand Total-RNA Read Counts");p.redrawLegend();p.redraw();return p}function LiverIlluminaSmallTrack(p,m,r,t){p=CountTrack(p,m,r,t);p.graphColorText="#7b7e9d";p.updateLabel("Liver  Illumina Small RNA Read Counts");p.redrawLegend();p.redraw();return p}
function HeartIlluminaTotalPlusTrack(p,m,r,t){p=CountTrack(p,m,r,t);p.graphColorText="#CC6242";p.updateLabel("BNLx/SHR Heart + Strand Total-RNA Read Counts");p.redrawLegend();p.redraw();return p}function HeartIlluminaTotalMinusTrack(p,m,r,t){p=CountTrack(p,m,r,t);p.graphColorText="#FC9272";p.updateLabel("BNLx/SHR Heart - Strand Total-RNA Read Counts");p.redrawLegend();p.redraw();return p}
function HeartIlluminaSmallTrack(p,m,r,t){p=CountTrack(p,m,r,t);p.graphColorText="#9C3212";p.updateLabel("Heart Illumina Small RNA Read Counts");p.redrawLegend();p.redraw();return p}function BrainIlluminaTotalPlusTrack(p,m,r,t){p=CountTrack(p,m,r,t);p.graphColorText="#7EB5D6";p.updateLabel("Brain + Strand Total-RNA Read Counts");p.redrawLegend();p.redraw();return p}
function BrainIlluminaTotalMinusTrack(p,m,r,t){p=CountTrack(p,m,r,t);p.updateLabel("Brain - Strand Total-RNA Read Counts");p.redrawLegend();p.redraw();return p}
function StrainSpecificIlluminaTotalTrack(p,m,r,t,f){m=CountTrack(p,m,r,t,f);t=r.substr(r.indexOf("-")+1);f=".";0<r.indexOf("Plus")?f="+":0<r.indexOf("Minus")&&(f="-");r=r.substr(0,r.indexOf("illumina"));"brain"===r?r="Whole Brain":"liver"===r&&(r="Liver");m.graphColorText=p.strainSpecificCountColors(t);p="";2===m.countType&&(p=" Sampled");m.updateLabel(t+" "+r+" "+f+" Strand Total-RNA"+p+" Read Counts");m.redrawLegend();m.redraw();return m}
function IlluminaPolyATrack(p,m,r,t){p=CountTrack(p,m,r,t);p.graphColorText="#7EB5D6";p.updateLabel("Brain Illumina PolyA+ RNA Read Counts");p.redrawLegend();p.redraw();return p}
function SpliceJunctionTrack(p,m,r,t,f,b){p=GenericTranscriptTrack(p,m,r,t,f,b);p.dataFileName=r+".xml";p.xmlTag="Feature";p.xmlTagBlockElem="block";p.idPrefix="splcJnct";"liverspliceJnct"===r?p.idPrefix="lvrsplcJnct":"heartspliceJnct"===r&&(p.idPrefix="hrtsplcJnct");p.ttSVG=1;p.ttTrackList=[];p.ttTrackList.push(r);p.ttTrackList.push("ensemblcoding");p.ttTrackList.push("braincoding");p.ttTrackList.push("brainTotal");p.ttTrackList.push("liverTotal");p.ttTrackList.push("heartTotal");p.ttTrackList.push("kidneyTotal");
p.ttTrackList.push("mergedTotal");p.ttTrackList.push("refSeq");p.ttTrackList.push("repeatMask");"splcJnct"===r?p.ttTrackList.push("illuminaPolyA"):"liverspliceJnct"===r?(p.ttTrackList.push("liverilluminaTotalPlus"),p.ttTrackList.push("liverilluminaTotalMinus")):"heartspliceJnct"===r?(p.ttTrackList.push("heartilluminaTotalPlus"),p.ttTrackList.push("heartilluminaTotalMinus")):"brainspliceJnct"===r&&(p.ttTrackList.push("brainilluminaTotalPlus"),p.ttTrackList.push("brainilluminaTotalMinus"));p.colorValueField=
"readCount";p.colorScale=d3.scaleLinear().domain([1,1E3]).range(["#E6E6E6","#000000"]);p.legendLbl="Read Depth";p.density=3;p.getDisplayID=function(a){return a.getAttribute("name")};p.createToolTip=function(a){var d='<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>ID: '+a.getAttribute("name");d=d+"<BR>Read Counts="+numberWithCommas(a.getAttribute("readCount"));d=d+"<BR>Splice Junction in "+a.getAttribute("sampleCount")+" of ";"Rn"===organism?d+="6 samples(3 BN-Lx, 3 SHR)":"Mm"===organism&&
(d+="6 samples(3 ILS, 3 ISS)");var c=getAllChildrenByName(getFirstChildByName(a,"blockList"),"block"),g=0,e=1,h="start",l="stop";-1==a.getAttribute("strand")&&(g=1,e=0,h="stop",l="start");d=d+"<BR><BR>Coverage Exon 1: "+numberWithCommas(c[g].getAttribute(h))+"-"+numberWithCommas(c[g].getAttribute(l))+" ("+(parseInt(c[g].getAttribute("stop"),10)-parseInt(c[g].getAttribute("start"),10))+" bp)";d=d+"<BR>Coverage Exon 2: "+numberWithCommas(c[e].getAttribute(h))+"-"+numberWithCommas(c[e].getAttribute(l))+
" ("+(parseInt(c[e].getAttribute("stop"),10)-parseInt(c[e].getAttribute("start"),10))+" bp)";return d=d+"<BR>Intron: "+numberWithCommas(parseInt(c[1].getAttribute("start"),10)-parseInt(c[0].getAttribute("stop"),10))+" bp<BR>"};p.drawScaleLegend("1","1000+","Read Counts","#E6E6E6","#000000",0);p.draw(m);return p}
function CustomCountTrack(p,m,r,t,f){var b=CountTrack(p,m,r,t,f);b.graphColorText="#4E85A6";b.updateControl=0;b.updateFullData=function(a,d){if(b.updateControl==a){b.updateControl=a+1;var c=b.xScale.domain()[0],g=b.xScale.domain()[1],e=g-c;b.showLoading();b.bin=b.calculateBin(e);var h=dataPrefix+"tmpData/trackXML/"+b.gsvg.folderName+"/tmp/"+c+"_"+g+".count."+b.trackClass+".xml",l=dataPrefix+"tmpData/trackUpload/"+b.trackClass.substr(6),n="bg",q="";0<b.bin&&(c-=2*b.bin,c-=c%(2*b.bin),g+=2*b.bin,g+=
2*b.bin-g%(2*b.bin),h=dataPrefix+"tmpData/trackXML/"+b.gsvg.folderName+"/"+c+"_"+g+".bincount."+b.bin+"."+b.trackClass+".xml");-1<b.dataFileName.indexOf("http")&&(q=l=b.dataFileName,n="bw");d3.xml(h,function(u,v){if(u){if(0==a||1==d)u="/"+pathPrefix,pathPrefix||(u=""),$.ajax({url:u+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:c,maxCoord:g,myOrganism:organism,genomeVer,track:b.trackClass,bedFile:l,outFile:h,folder:b.gsvg.folderName,binSize:b.bin,type:n,web:q},dataType:"json",
success:function(y){gtag("event","generateTrackCount",{event_category:"browser"})},error:function(y,w,C){}});8>a?b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1)},500):30>a?b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1)},1E3):32>a?b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1)},1E4):(d3.select("#Level"+b.levelNumber+b.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+b.trackClass),d3.select("#Level"+b.levelNumber+b.trackClass).attr("height",
15),b.gsvg.addTrackErrorRemove(b.svg,"#Level"+b.gsvg.levelNumber+b.trackClass),b.hideLoading(),b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1,0)},15E3))}else null==v?32<=a?(u=[],b.draw(u)):b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1,0)},5E3):(b.fullDataTimeOutHandle=0,b.loadedDataMin=c,b.loadedDataMax=g,u=v.documentElement.getElementsByTagName("Count"),b.draw(u),b.updateControl=0)})}};b.updateLabel("Custom Count Track");b.redrawLegend();b.redraw();return b}
function CountTrack(p,m,r,t,f){var b=Track(p,m,r,"Generic Counts");b.loadedDataMin=b.xScale.domain()[0];b.loadedDataMax=b.xScale.domain()[1];b.dataFileName=b.trackClass;b.scaleMin=1;b.scaleMax=5E3;b.graphColorText="steelblue";b.colorScale=d3.scaleLinear().domain([b.scaleMin,b.scaleMax]).range(["#EEEEEE","#000000"]);b.ttSVG=1;b.data=m;b.density=t;b.prevDensity=t;b.countType=1;b.displayBreakDown=null;b.gsvg.xScale.domain();b.gsvg.xScale.domain();console.log(b.trackClass+":"+f);p=[];f&&(0<f.indexOf(",")?
p=f.split(","):p[0]=f);1<p.length&&(tmp=p[0].split(":"),b.scaleMin=1*tmp[0],b.scaleMax=1*tmp[1],console.log("scale:"+b.scaleMin+":"+b.scaleMax));2<p.length&&(b.countType=1*p[1],console.log("countType:"+b.countType));b.fullDataTimeOutHandle=0;b.ttTrackList=[];-1<r.indexOf("illuminaSmall")?(b.ttTrackList.push("ensemblsmallnc"),b.ttTrackList.push("brainsmallnc"),b.ttTrackList.push("liversmallnc"),b.ttTrackList.push("heartsmallnc")):(b.ttTrackList.push("ensemblcoding"),b.ttTrackList.push("braincoding"),
b.ttTrackList.push("liverTotal"),b.ttTrackList.push("heartTotal"),b.ttTrackList.push("mergedTotal"),b.ttTrackList.push("refSeq"),b.ttTrackList.push("ensemblnoncoding"),b.ttTrackList.push("brainnoncoding"),b.ttTrackList.push("probe"),b.ttTrackList.push("polyASite"),b.ttTrackList.push("spliceJnct"),b.ttTrackList.push("liverspliceJnct"),b.ttTrackList.push("heartspliceJnct"));b.ttTrackList.push("repeatMask");b.calculateBin=function(a){a=new String(Math.floor(a/b.gsvg.width));a=a.substr(0,1)*Math.pow(10,
a.length-1);a=Math.floor(a/2);5>a&&(a=0);return a};b.color=function(a){var d="#FFFFFF";a.getAttribute("count")>=b.scaleMin&&(d=d3.rgb(b.colorScale(a.getAttribute("count"))));return d};b.redraw=function(){var a=b.gsvg.xScale.domain()[0],d=b.gsvg.xScale.domain()[1];b.xScale(a+b.bin);b.xScale(a);b.prevMinCoord=a;b.prevMaxCoord=d;a=b.xScale.domain()[0];d=b.xScale.domain()[1];for(var c=[],g=0,e=0,h=0;h<b.data.length;h++)if("undefined"!==typeof b.data[h]){var l=parseInt(b.data[h].getAttribute("start"),
10),n=parseInt(b.data[h].getAttribute("stop"),10),q=parseInt(b.data[h].getAttribute("count"),10);if(1!=b.density||1==b.density&&l!=n)if(h+1<b.data.length){if(n=parseInt(b.data[h+1].getAttribute("start"),10),l>=a&&l<=d||n>=a&&n<=d)c[g]=b.data[h],q>e&&(e=q),g++}else l>=a&&l<=d&&(c[g]=b.data[h],q>e&&(e=q),g++)}1==b.density?(b.density!=b.prevDensity?(b.redrawLegend(),d=b.gsvg.xScale.domain()[1],b.prevDensity=b.density,b.svg.selectAll(".area").remove(),b.svg.selectAll("g.y").remove(),b.svg.selectAll(".grid").remove(),
b.svg.selectAll(".leftLbl").remove(),a=b.svg.selectAll("."+b.trackClass).data(c,keyStart),a.each().remove(),a=b.svg.selectAll("."+b.trackClass).data(c,keyStart),a.enter().append("rect").attr("x",function(u){return b.xScale(u.getAttribute("start"))}).attr("y",15).attr("class",b.trackClass).attr("height",10).attr("width",function(u,v){return b.xScale(u.getAttribute("stop"))-b.xScale(u.getAttribute("start"))}).attr("fill",b.color).on("mouseover",function(u){0==b.gsvg.isToolTip&&(d3.select(this).style("fill",
"green"),tt.transition().duration(200).style("opacity",1),tt.html(b.createToolTip(u)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)}))}).on("mouseout",function(u){d3.select(this).style("fill",b.color);tt.transition().delay(500).duration(200).style("opacity",0)}),a.exit().remove()):b.svg.selectAll("."+b.trackClass).attr("x",function(u){return b.xScale(u.getAttribute("start"))}).attr("width",function(u,v){return b.xScale(u.getAttribute("stop"))-
b.xScale(u.getAttribute("start"))}).attr("fill",b.color),b.svg.attr("height",30)):2==b.density&&(b.svg.selectAll("."+b.trackClass).remove(),b.svg.select(".y.axis").remove(),b.svg.select("g.grid").remove(),b.svg.selectAll(".leftLbl").remove(),b.yScale.domain([0,e]),b.svg.select(".area").remove(),b.area=d3.area().x(function(u){return b.xScale(u.getAttribute("start"))}).y0(140).y1(function(u){return b.yScale(u.getAttribute("count"))}),b.redrawLegend(),b.prevDensity=b.density,b.svg.append("g").attr("class",
"y axis").call(b.yAxis),b.svg.append("g").attr("class","grid").call(b.yAxis.tickSize(-b.gsvg.width+10,0,0).tickFormat("")),b.svg.select("g.y").selectAll("text").each(function(u){var v=new String(u);d3.select(this).attr("x",function(){return 7.7*v.length+5}).attr("dy","0.05em");b.svg.append("svg:text").attr("class","leftLbl").attr("x",b.gsvg.width-(7.8*v.length+5)).attr("y",function(){return b.yScale(u)}).attr("dy","0.01em").style("font-weight","bold").text(numberWithCommas(u))}),b.svg.append("path").datum(c).attr("class",
"area").attr("stroke",b.graphColorText).attr("fill",b.graphColorText).attr("d",b.area),b.svg.attr("height",140));b.redrawSelectedArea()};b.createToolTip=function(a){var d='<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>Read Count='+numberWithCommas(a.getAttribute("count"));if(0<b.bin){var c=parseInt(a.getAttribute("start"),10)+parseInt(b.bin,10);d=d+"*<BR><BR>*Data compressed for display. Using 90th percentile of<BR>region:"+numberWithCommas(a.getAttribute("start"))+"-"+numberWithCommas(c)+
"<BR><BR>Zoom in further to see raw data(roughly a region <1000bp). The bin size will decrease as you zoom in thus the resolution of the count data will improve as you zoom in."}return d};b.update=function(a){a=b.xScale.domain()[0];var d=b.xScale.domain()[1];b.loadedDataMin<=a&&d<=b.loadedDataMax?b.redraw():(console.log("Update caused updateFullData()"+this.trackID),b.updateFullData(0,0))};b.updateFullData=function(a,d){var c=b.xScale.domain()[0],g=b.xScale.domain()[1],e=g-c;b.showLoading();if(0===
a||1==d)b.bin=b.calculateBin(e),console.log(b.trackClass+":bin size:"+b.bin);e="Total";2===b.countType&&(e="Norm");var h=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/tmp/"+c+"_"+g+".count."+b.trackClass+"."+e+".xml";0<b.bin&&(c-=2*b.bin,c-=c%(2*b.bin),g+=2*b.bin,g+=2*b.bin-g%(2*b.bin),h=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/tmp/"+c+"_"+g+".bincount."+b.bin+"."+b.trackClass+"."+e+".xml");console.log(b.trackClass+":file="+
h);console.log(b.trackClass+":folder="+b.gsvg.folderName);d3.xml(h,function(l,n){if(l){console.log("error:"+b.bin+":"+h);if(0==a||1==d)l="/"+pathPrefix,pathPrefix||(l=""),tmpPanel=panel,-1<b.trackClass.indexOf("-")&&(tmpPanel=b.trackClass.substr(b.trackClass.indexOf("-")+1)),$.ajax({url:l+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:c,maxCoord:g,panel:tmpPanel,rnaDatasetID,arrayTypeID,myOrganism:organism,genomeVer,track:b.trackClass,folder:b.gsvg.folderName,binSize:b.bin,
countType:b.countType},dataType:"json",success:function(q){gtag("event","generateTrackCount",{event_category:"browser"})},error:function(q,u,v){}});8>a?b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1,0)},1E3):30>a?b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1,0)},2E3):38>a?b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1,0)},1E4):(d3.select("#Level"+b.levelNumber+b.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+b.trackClass),
d3.select("#Level"+b.levelNumber+b.trackClass).attr("height",15),b.gsvg.addTrackErrorRemove(b.svg,"#Level"+b.gsvg.levelNumber+b.trackClass),b.hideLoading(),b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1,1)},15E3))}else console.log("update data"),null==n?(console.log("is null"),32<=a?(m=[],b.draw(m)):b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1,0)},5E3)):(console.log("not null is drawing"),b.fullDataTimeOutHandle=0,b.loadedDataMin=c,b.loadedDataMax=g,setTimeout(function(){var q=
n.documentElement.getElementsByTagName("Count");b.draw(q)},10))})};b.updateCountScale=function(a,d){b.scaleMin=a;b.scaleMax=d;b.colorScale=d3.scaleLinear().domain([b.scaleMin,b.scaleMax]).range(["#EEEEEE","#000000"]);1==b.density&&(b.redrawLegend(),b.redraw())};b.setupToolTipSVG=function(a,d){var c=b.xScale.domain()[0],g=b.xScale.domain()[1],e=parseInt(a.getAttribute("start"),10),h=parseInt(a.getAttribute("stop"),10);c=Math.floor((g-c)*d);20>c&&(c=20);d=e-c;c=h+c;1>d&&(d=1);"undefined"!==typeof b.ttSVGMinWidth&&
c-d<b.ttSVGMinWidth&&(d=e-b.ttSVGMinWidth/2,c=h+b.ttSVGMinWidth/2);a=toolTipSVG("div#ttSVG",450,d,c,99,a.getAttribute("ID"),"transcript");a.addTrack(b.trackClass,3,"",b.data);for(e=0;e<b.ttTrackList.length;e++)if(h=b.gsvg.getTrackData(b.ttTrackList[e]),g=[],"undefined"!==typeof h&&0<h.length){for(var l=0,n=0;n<h.length;n++)if(d<=parseInt(h[n].getAttribute("start"),10)&&parseInt(h[n].getAttribute("start"),10)<=c||parseInt(h[n].getAttribute("start"),10)<=d&&parseInt(h[n].getAttribute("stop"),10)>=d)g[l]=
h[n],l++;0<g.length&&a.addTrack(b.ttTrackList[e],3,"DrawTrx",g)}};b.draw=function(a){b.hideLoading();b.data=a;console.log("draw:"+b.trackClass+":"+a.length);var d=b.gsvg.xScale.domain()[0],c=b.gsvg.xScale.domain()[1];b.xScale(d+b.bin);b.xScale(d);b.redrawLegend();for(var g=[],e=0,h=0,l=0;l<b.data.length;l++)if("undefined"!==typeof b.data[l]){var n=parseInt(b.data[l].getAttribute("start"),10),q=parseInt(b.data[l].getAttribute("stop"),10),u=parseInt(b.data[l].getAttribute("count"),10);if(1!=b.density||
1==b.density&&n!=q)if(l+1<b.data.length){if(q=parseInt(a[l+1].getAttribute("start"),10),n>=d&&n<=c||q>=d&&q<=c)g[e]=b.data[l],u>h&&(h=u),e++}else n>=d&&n<=c&&(g[e]=b.data[l],u>h&&(h=u),e++)}console.log("newData:"+g.length);ndata=g;console.log("data:"+ndata.length);b.svg.select(".y.axis").remove();b.svg.select("g.grid").remove();b.svg.selectAll(".leftLbl").remove();b.svg.select(".area").remove();b.svg.selectAll(".area").remove();1==b.density?(console.log("draw:den1"),c=b.gsvg.xScale.domain()[1],b.svg.selectAll("."+
b.trackClass).data(ndata,keyStart).enter().append("rect").attr("x",function(v){console.log("x:"+v.getAttribute("start")+":"+b.xScale(v.getAttribute("start")));return b.xScale(v.getAttribute("start"))}).attr("y",15).attr("class",b.trackClass).attr("height",10).attr("width",function(v,y){return b.xScale(v.getAttribute("stop"))-b.xScale(v.getAttribute("start"))}).attr("fill",b.color).on("mouseover",function(v){0==b.gsvg.isToolTip&&(d3.select(this).style("fill","green"),tt.transition().duration(200).style("opacity",
1),tt.html(b.createToolTip(v)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)}),1==b.ttSVG&&b.setupToolTipSVG(v,.005))}).on("mouseout",function(v){d3.select(this).style("fill",b.color);tt.transition().delay(500).duration(200).style("opacity",0)}),b.svg.attr("height",30)):2==b.density&&(console.log("draw:den2"),b.yScale.domain([0,h]),b.yAxis=d3.axisLeft(b.yScale).ticks(5),b.svg.select("g.grid").remove(),b.svg.select(".y.axis").remove(),
b.svg.selectAll(".leftLbl").remove(),b.svg.append("g").attr("class","y axis").call(b.yAxis),b.svg.select("g.y").selectAll("text").each(function(v){var y=new String(v);b.svg.append("svg:text").attr("class","leftLbl").attr("x",b.gsvg.width-(7.8*y.length+5)).attr("y",function(){return b.yScale(v)}).attr("dy","0.01em").style("font-weight","bold").text(numberWithCommas(v));d3.select(this).attr("x",function(){return 7.7*y.length+5}).attr("dy","0.05em")}),b.svg.append("g").attr("class","grid").call(b.yAxis.tickSize(-b.gsvg.width+
10,0,0).tickFormat("")),b.svg.select(".area").remove(),b.area=d3.area().x(function(v){return b.xScale(v.getAttribute("start"))}).y0(140).y1(function(v,y){return b.yScale(v.getAttribute("count"))}),b.svg.append("path").datum(a).attr("class","area").attr("stroke",b.graphColorText).attr("fill",b.graphColorText).attr("d",b.area),b.svg.attr("height",140));b.redrawSelectedArea()};b.redrawLegend=function(){if(2==b.density)d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".legend").remove();
else if(1==b.density){var a=new String(b.label);a=b.gsvg.width/2+a.length/2*7.5-10;var d=new String("<"+b.scaleMin);b.drawScaleLegend(b.scaleMin,numberWithCommas(b.scaleMax)+"+","Read Counts","#EEEEEE","#00000",15+7.6*d.length);b.svg.append("text").text("<"+b.scaleMin).attr("class","legend").attr("x",a).attr("y",12);b.svg.append("rect").attr("class","legend").attr("x",a+7.6*d.length+5).attr("y",0).attr("rx",2).attr("ry",2).attr("height",12).attr("width",15).attr("fill","#FFFFFF").attr("stroke","#CECECE")}};
b.redrawSelectedArea=function(){if(1<b.density){var a=b.svg.attr("height");d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".selectedArea").remove();if(-1<b.selectionStart&&-1<b.selectionEnd){var d=b.xScale(b.selectionStart),c=b.xScale(b.selectionEnd)-d;1>c&&(c=1);d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).append("rect").attr("class","selectedArea").attr("x",d).attr("y",0).attr("height",a).attr("width",c).attr("fill","#CECECE").attr("opacity",.3).attr("pointer-events","none")}}else d3.select("#Level"+
b.gsvg.levelNumber+b.trackClass).selectAll(".selectedArea").remove()};b.savePrevious=function(){b.prevSetting={};b.prevSetting.density=b.density;b.prevSetting.scaleMin=b.scaleMin;b.prevSetting.scaleMax=b.scaleMax;b.prevSetting.countType=b.countType};b.revertPrevious=function(){b.density=b.prevSetting.density;b.scaleMin=b.prevSetting.scaleMin;b.scaleMax=b.prevSetting.scaleMax;b.countType=b.prevSetting.countType};b.generateTrackSettingString=function(){return b.trackClass+","+b.density+","+b.scaleMin+
":"+b.scaleMax+","+b.countType+";"};b.generateSettingsDiv=function(a){var d=trackInfo[b.trackClass];b.savePrevious();d3.select(a).select("table").select("tbody").html("");if(d&&d.Controls&&0<d.Controls.length){var c=(new String(d.Controls)).split(",");a=d3.select(a).select("table").select("tbody");a.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+d.Name);for(d=0;d<c.length;d++)if("undefined"!==typeof c[d]&&""!=c[d]){var g=c[d].split(";"),e=a.append("tr").append("td"),
h=g[0].substr(5),l="";3<g.length&&0==g[3].indexOf("Default=")&&(l=g[3].substr(8));if(0==g[1].toLowerCase().indexOf("select")){e.append("text").text(h+": ");var n=g[1].split(":");g=g[2].split("}");h=b.trackClass+"Dense"+b.level+"Select";"colorSelect"==n[1]?h=b.trackClass+b.level+"colorSelect":"countSelect"==n[1]&&(h=b.trackClass+b.level+"countSelect");e=e.append("select").attr("id",h).attr("name",n[1]);for(n=0;n<g.length;n++){var q=g[n].substr(1).split(":");if(2==q.length){var u=e.append("option").attr("value",
q[1]).text(q[0]);-1<h.indexOf("Dense")?q[1]==b.density&&u.attr("selected","selected"):q[1]==l&&u.attr("selected","selected")}}d3.select("select#"+h).on("change",function(){$(this).attr("id")==b.trackClass+"Dense"+b.level+"Select"&&1==$(this).val()?$("#scaleControl"+b.level).show():$("#scaleControl"+b.level).hide();b.updateSettingsFromUI();b.redraw()})}else 0==g[1].toLowerCase().indexOf("slider")&&(l="none",1==b.density&&(l="inline-block"),e=e.append("div").attr("id","scaleControl"+b.level).style("display",
l),e.append("text").text(h+": "),e.append("input").attr("type","text").attr("id","amount").attr("value",b.scaleMin+"-"+b.scaleMax).style("border",0).style("color","#f6931f").style("font-weight","bold").style("background-color","#EEEEEE"),n=g[1].split(":"),g=g[2].split("}"),e=e.append("div"),e.append("text").text("Min:"),e.append("div").attr("id","min-"+n[1]).style("width","60%").style("display","inline-block").style("float","right"),e.append("br"),e.append("text").text("Max:"),e.append("div").attr("id",
"max-"+n[1]).style("width","60%").style("display","inline-block").style("float","right"),$("#min-"+n[1]).slider({min:1,max:1E3,step:1,value:b.scaleMin,slide:b.processSlider}),$("#max-"+n[1]).slider({min:1E3,max:2E4,step:100,value:b.scaleMax,slide:b.processSlider}),b.updateSettingsFromUI(),b.redraw())}c=a.append("tr").append("td");c.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");
b.gsvg.setCurrentViewModified();b.gsvg.removeTrack(b.trackClass);var v=svgList[b.gsvg.levelNumber].currentView.ViewID,y=viewMenu[b.gsvg.levelNumber].findTrackByClass(b.trackClass,v);y=viewMenu[b.gsvg.levelNumber].findTrackIndexWithViewID(y.TrackID,v);viewMenu[b.gsvg.levelNumber].removeTrackWithIDIdx(y,v)});c.append("input").attr("type","button").attr("value","Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");b.density==b.prevSetting.density&&
b.scaleMin==b.prevSetting.scaleMin&&b.scaleMax==b.prevSetting.scaleMax||b.gsvg.setCurrentViewModified()});c.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){b.revertPrevious();b.updateCountScale(b.scaleMin,b.scaleMax);b.draw(b.data);$("#trackSettingDialog").fadeOut("fast")})}else a=d3.select(a).select("table").select("tbody"),a.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+d.Name),a.append("tr").append("td").html("Sorry no settings for this track."),
c=a.append("tr").append("td"),c.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){b.gsvg.setCurrentViewModified();$("#trackSettingDialog").fadeOut("fast")}),c.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")})};b.processSlider=function(a,d){a=$("#min-rangeslider").slider("value");d=$("#max-rangeslider").slider("value");
$("#amount").val(a+" - "+d);b.updateCountScale(a,d)};b.yScale=d3.scaleLinear().range([140,20]).domain([0,d3.max(m,function(a){return a.getAttribute("count")})]);b.area=d3.area().x(function(a){return b.xScale(a.getAttribute("start"))}).y0(140).y1(function(a){return a.getAttribute("count")});b.yAxis=d3.axisLeft(b.yScale).ticks(5);b.redrawLegend();b.draw(m);return b}
function PolyATrack(p,m,r,t,f,b){var a=GenericTranscriptTrack(p,m,r,t,f,b);a.dataFileName="polyASite.xml";a.density=3;a.minFeatureWidth=1;a.colorBy="Color";a.ttSVG=1;a.ttTrackList=[];a.ttTrackList.push("ensemblcoding");a.ttTrackList.push("braincoding");a.ttTrackList.push("liverTotal");a.ttTrackList.push("heartTotal");a.ttTrackList.push("mergedTotal");a.ttTrackList.push("refSeq");a.ttTrackList.push("repeatMask");a.ttSVGMinWidth=200;a.createToolTip=function(d){var c=".";1==d.getAttribute("strand")?
c="+":-1==d.getAttribute("strand")&&(c="-");var g="0";1==d.getAttribute("pvalue")&&(g="");return'<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>Motif:'+d.getAttribute("motif")+"<BR>Strand:"+c+"<BR>Location: chr"+d.getAttribute("chromosome")+":"+d.getAttribute("start")+"-"+d.getAttribute("stop")+"<BR>Probability of site: "+g+d.getAttribute("pvalue")};a.updateData=function(d){d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+a.gsvg.folderName+"/"+a.dataFileName,function(c,
g){if(c)3>d?(c=1E4,1==d&&(c=15E3),setTimeout(function(){a.updateData(d+1)},c)):3<=d&&(d3.select("#Level"+a.levelNumber+a.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+a.trackClass),d3.select("#Level"+a.levelNumber+a.trackClass).attr("height",15),a.gsvg.addTrackErrorRemove(a.svg,"#Level"+a.gsvg.levelNumber+a.trackClass));else{c=g.documentElement.getElementsByTagName(a.xmlTag);g=[];for(var e=[],h=0,l=0;l<c.length;l++)"undefined"!==typeof c[l]&&(g[h]=c[l],e[c[l].getAttribute("ID")]=
1,h++);for(l=0;l<a.data.length;l++)"undefined"!==typeof a.data[l]&&"undefined"===typeof e[a.data[l].getAttribute("ID")]&&(g[h]=a.data[l],h++);a.draw(g);a.hideLoading()}})};a.redrawLegend=function(){a.drawLegend([{color:"#FF8000",label:"+ Strand >>>"},{color:"#330570",label:"- Strand <<<"}])};a.updateFullData=void 0;a.draw(m);return a}
function CustomTranscriptTrack(p,m,r,t,f,b){var a=GenericTranscriptTrack(p,m,r,t,f,b);p=[];b&&(0<b.indexOf(",")?p=b.split(","):p[0]=b);a.xmlTag="Feature";a.xmlTagBlockElem="block";a.density=f;1!==a.density&&2!==a.density&&3!==a.density&&(a.density=3);0<p.length&&(a.dataFileName=p[0].substr(9));a.colorBy=1<p.length?p[1]:"Score";2<p.length&&(a.minValue=p[2]);3<p.length&&(a.maxValue=p[3]);4<p.length&&(a.minColor=p[4]);5<p.length&&(a.maxColor=p[5]);a.colorValueField="score";a.minFeatureWidth=1;a.updateControl=
0;"Score"==a.colorBy&&a.createColorScale();a.updateFullData=function(d,c){if(a.updateControl==d){a.updateControl=d+1;var g=a.xScale.domain()[0],e=a.xScale.domain()[1],h=dataPrefix+"tmpData/trackXML/"+a.gsvg.folderName+"/"+a.dataFileName+".xml",l=dataPrefix+"tmpData/trackUpload/"+a.dataFileName,n="",q=new Date,u="bed";-1<a.dataFileName.indexOf("http")&&(n=a.dataFileName,l="tmpData/tmpDownload/"+q.getTime()+"_"+a.trackClass,h=dataPrefix+"tmpData/trackXML/"+a.gsvg.folderName+"/"+a.trackClass+".xml",
u="bb");d3.xml(h,function(v,y){if(v){console.log(v);if(0==d||1==c)v="/"+pathPrefix,pathPrefix||(v=""),$.ajax({url:v+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:g,maxCoord:e,folder:a.gsvg.folderName,bedFile:l,outFile:h,track:a.trackClass,web:n,type:u},dataType:"json",success:function(w){gtag("event","generateTrackCustomTranscript",{event_category:"browser"})},error:function(w,C,B){console.log(B)}});3>d?(v=1E4,1==d&&(v=15E3),setTimeout(function(){a.updateFullData(d+
1,0)},v)):(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+a.trackClass),d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).attr("height",15),a.gsvg.addTrackErrorRemove(a.svg,"#Level"+a.gsvg.levelNumber+a.trackClass),a.hideLoading())}else v=y.documentElement.getElementsByTagName(a.xmlTag),a.draw(v),a.hideLoading(),a.updateControl=0})}};a.updateSettingsFromUI=function(){0<$("#"+a.trackClass+"Dense"+a.level+"Select").length&&(a.density=
$("#"+a.trackClass+"Dense"+a.level+"Select").val());0<$("#"+a.trackClass+a.level+"colorSelect").length&&(a.colorBy=$("#"+a.trackClass+a.level+"colorSelect").val());"Score"==a.colorBy&&(a.minValue=$("#"+a.trackClass+"minData"+a.level).val(),a.maxValue=$("#"+a.trackClass+"maxData"+a.level).val(),testIE||testSafari?(a.minColor=$("#"+a.trackClass+"minColor"+a.level).spectrum("get").toHexString(),a.maxColor=$("#"+a.trackClass+"maxColor"+a.level).spectrum("get").toHexString()):(a.minColor=$("#"+a.trackClass+
"minColor"+a.level).val(),a.maxColor=$("#"+a.trackClass+"maxColor"+a.level).val()),a.createColorScale())};a.generateSettingsDiv=function(d){var c=trackInfo[a.trackClass];a.savePrevious();d3.select(d).select("table").select("tbody").html("");if(0<c.Controls.length&&"null"!=c.Controls){var g=(new String(c.Controls)).split(",");d=d3.select(d).select("table").select("tbody");d.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name);for(c=0;c<g.length;c++)if("undefined"!==
typeof g[c]&&""!=g[c]){var e=g[c].split(";"),h=d.append("tr").append("td"),l=e[0].substr(5);3<e.length&&0==e[3].indexOf("Default=")&&e[3].substr(8);if(0==e[1].toLowerCase().indexOf("select")){h.append("text").text(l+": ");l=e[1].split(":");e=e[2].split("}");var n=a.trackClass+"Dense"+a.level+"Select";"colorSelect"==l[1]&&(n=a.trackClass+a.level+"colorSelect");h=h.append("select").attr("id",n).attr("name",l[1]);for(l=0;l<e.length;l++){var q=e[l].substr(1).split(":");if(2==q.length){var u=h.append("option").attr("value",
q[1]).text(q[0]);(-1<n.indexOf("Dense")&&q[1]==a.density||-1<n.indexOf("colorSelect")&&q[1]==a.colorBy)&&u.attr("selected","selected")}}d3.select("select#"+n).on("change",function(){"Score"==$(this).val()?$("div."+a.trackClass+"Scale"+a.level).show():"Color"==$(this).val()&&$("div."+a.trackClass+"Scale"+a.level).hide();a.updateSettingsFromUI();a.draw(a.data)})}else 0==e[1].toLowerCase().indexOf("txt")&&(h=0==$("#colorTrack"+a.level).size()?h.append("div").attr("class",a.trackClass+"Scale"+a.level).style("display",
"none"):d3.select("#"+a.trackClass+"Scale"+a.level),h.append("text").text(l+": "),l=e[1].split(":"),e=e[2].split("}"),e="Data",n="text",q=a.minValue,u=a.maxValue,"color"==l[1]&&(n=e="Color",q=a.minColor,u=a.maxColor),h.append("input").attr("type",n).attr("id",a.trackClass+"min"+e+a.level).attr("class",l[1]).style("margin-left","5px").attr("value",q),h.append("text").text(" - "),h.append("input").attr("type",n).attr("id",a.trackClass+"max"+e+a.level).attr("class",l[1]).style("margin-left","5px").attr("value",
u),"Color"==e&&(testIE||testSafari)?($("#"+a.trackClass+"min"+e+a.level).spectrum({change:function(v){a.updateSettingsFromUI();a.draw(a.data)}}),$("#"+a.trackClass+"max"+e+a.level).spectrum({change:function(v){a.updateSettingsFromUI();a.draw(a.data)}})):($("input#"+a.trackClass+"min"+e+a.level).on("change",function(){a.updateSettingsFromUI();a.draw(a.data)}),$("input#"+a.trackClass+"max"+e+a.level).on("change",function(){a.updateSettingsFromUI();a.draw(a.data)})))}"Score"==$("#"+a.trackClass+a.level+
"colorSelect").val()?$("div."+a.trackClass+"Scale"+a.level).show():"Color"==$("#"+a.trackClass+a.level+"colorSelect").val()&&$("div."+a.trackClass+"Scale"+a.level).hide();g=d.append("tr").append("td");g.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");a.gsvg.removeTrack(a.trackClass);var v=svgList[a.gsvg.levelNumber].currentView.ViewID,y=viewMenu[a.gsvg.levelNumber].findTrackByClass(a.trackClass,
v);y=viewMenu[a.gsvg.levelNumber].findTrackIndexWithViewID(y.TrackID,v);viewMenu[a.gsvg.levelNumber].removeTrackWithIDIdx(y,v)});g.append("input").attr("type","button").attr("value","Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")});g.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){a.revertPrevious();a.draw(a.data);$("#trackSettingDialog").fadeOut("fast")})}else d=
d3.select(d).select("table").select("tbody"),d.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name),d.append("tr").append("td").html("Sorry no settings for this track."),g=d.append("tr").append("td"),g.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")}),g.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left",
"5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")})};a.generateTrackSettingString=function(){return a.trackClass+","+a.density+","+a.colorBy+","+a.minValue+","+a.maxValue+","+a.minColor+","+a.maxColor+";"};return a}
function RepeatMaskTrack(p,m,r,t,f,b){var a=GenericTranscriptTrack(p,m,r,t,f,b);a.dataFileName="repeatMask.xml";a.density=1;a.xmlTag="Feature";a.xmlTagBlockElem="Block";a.minFeatureWidth=1;a.ttSVG=1;a.ttTrackList=[];a.ttTrackList.push("ensemblcoding");a.ttTrackList.push("braincoding");a.ttTrackList.push("liverTotal");a.ttTrackList.push("heartTotal");a.ttTrackList.push("mergedTotal");a.ttTrackList.push("refSeq");a.ttTrackList.push("spliceJnct");a.ttTrackList.push("liverspliceJnct");a.ttTrackList.push("heartspliceJnct");
a.ttTrackList.push("brainspliceJnct");a.ttTrackList.push("illuminaPolyA");a.ttTrackList.push("liverilluminaTotalPlus");a.ttTrackList.push("liverilluminaTotalMinus");a.ttTrackList.push("heartilluminaTotalPlus");a.ttTrackList.push("heartilluminaTotalMinus");a.ttTrackList.push("brainilluminaTotalPlus");a.ttTrackList.push("brainilluminaTotalMinus");a.ttSVGMinWidth=200;a.legendLbl="Smith-Waterman Alignment Score";a.typeList=[];a.typeList[0]={name:"SINE",clss:"SINE"};a.typeList[1]={name:"LINE",clss:"LINE"};
a.typeList[2]={name:"LTR",clss:"LTR"};a.typeList[3]={name:"DNA",clss:"DNA"};a.typeList[4]={name:"Simple",clss:"Simple_repeat"};a.typeList[5]={name:"Low Comp.",clss:"Low_complexity"};a.typeList[6]={name:"Satellite",clss:"Satellite"};a.typeList[7]={name:"RNA",clss:"RNA"};a.typeList[8]={name:"Other",clss:"Other"};a.typeList[9]={name:"Unknown",clss:"Unknown"};a.yList={};for(p=0;p<a.typeList.length;p++)a.yList[a.typeList[p].clss]=15+15*p;a.createToolTip=function(d){var c='<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>Name: '+
d.getAttribute("name")+"&nbsp&nbsp&nbsp&nbsp&nbspClass: "+d.getAttribute("class");c=c+"&nbsp&nbsp&nbsp&nbsp&nbspFamily: "+d.getAttribute("family")+"<BR><BR>Location: "+d.getAttribute("chromosome")+":"+d.getAttribute("start")+"-"+d.getAttribute("stop");c=c+"<BR><BR>Alignment Score: "+d.getAttribute("score")+"<BR>Mismatches(parts/thousand): "+d.getAttribute("mis")+"<BR>Insertions(parts/thousand): "+d.getAttribute("ins");return c=c+"<BR>Deletions(parts/thousand): "+d.getAttribute("del")};a.pieColor=
function(d,c){c=d3.rgb("#000000");d=d.data.names;"LINE"===d?c=d3.rgb("#27e5e5"):"SINE"===d?c=d3.rgb("#e57927"):"LTR"===d?c=d3.rgb("#27e527"):"DNA"===d?c=d3.rgb("#e52727"):"Simple_repeat"===d?c=d3.rgb("#e51ba2"):"Low_complexity"===d?c=d3.rgb("#9029e5"):"RNA"===d?c=d3.rgb("#005be5"):"Satellite"===d?c=d3.rgb("#cccc00"):"Other"===d&&(c=d3.rgb("#007f24"));return c};a.calcY=function(d,c,g,e){d=3===a.density||"3"===a.density?a.calcYPack(d,c,g):2===a.density||"2"===a.density?a.calcYFull(e):a.calcYDense();
a.trackYMax<d/15&&(a.trackYMax=d/15);return d};a.calcYFull=function(d){d=d.getAttribute("class");-1<d.indexOf("RNA")&&(d="RNA");return a.yList[d]};a.redraw=function(){if(a.prevDensity!=a.density)a.draw(a.data);else{a.yMaxArr=[];a.yArr=[];a.yArr[0]=[];for(var d=0;d<a.gsvg.width;d++)a.yMaxArr[d]=0,a.yArr[0][d]=0;a.trackYMax=0;d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g."+a.idPrefix+"trx"+a.gsvg.levelNumber).attr("transform",function(c,g){return"translate("+a.xScale(c.getAttribute("start"))+
","+a.calcY(parseInt(c.getAttribute("start"),10),parseInt(c.getAttribute("stop"),10),g,c)+")"}).each(function(c,g){for(var e=getAllChildrenByName(getFirstChildByName(c,a.xmlTagBlockElem+"List"),a.xmlTagBlockElem),h=0;h<e.length;h++){var l=a.idPrefix+"Ex"+e[h].getAttribute("ID");null==e[h].getAttribute("ID")&&(l=a.idPrefix+"Ex"+c.getAttribute("ID")+"_"+h);a.svg.select("g#"+a.idPrefix+"tx"+c.getAttribute("ID")+" rect#"+l).attr("x",function(y){return a.xScale(e[h].getAttribute("start"))-a.xScale(c.getAttribute("start"))}).attr("width",
function(y){return a.xScale(e[h].getAttribute("stop"))-a.xScale(e[h].getAttribute("start"))});if(0<h){l=">";"-1"==c.getAttribute("strand")&&(l="<");g=l;var n=a.xScale(e[h-1].getAttribute("stop"))-a.xScale(c.getAttribute("start")),q=a.xScale(e[h].getAttribute("start"))-a.xScale(c.getAttribute("start")),u=q-n,v=0;if(7>u)g="";else for(u-=7;8<u;)0==v?(g+=" ",v=1):(g+=l,v=0),u-=7;l=e[h-1].getAttribute("ID")+"_"+e[h].getAttribute("ID");null==e[h].getAttribute("ID")&&(l=c.getAttribute("ID")+"_"+(h-1)+"_"+
h);a.svg.select("g#"+a.idPrefix+"tx"+c.getAttribute("ID")+" line#"+a.idPrefix+"Int"+l).attr("x1",n).attr("x2",q);a.svg.select("g#"+a.idPrefix+"tx"+c.getAttribute("ID")+" #"+a.idPrefix+"IntTxt"+l).attr("dx",n+1).text(g)}}});1==a.density?a.svg.attr("height",30):2==a.density?a.svg.attr("height",15*(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g."+a.idPrefix+"trx"+a.gsvg.levelNumber).size()+1)):3==a.density&&a.svg.attr("height",15*(a.trackYMax+1));a.redrawSelectedArea()}};a.drawTrx=
function(d,c){c=d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).select("#"+a.idPrefix+"tx"+d.getAttribute("ID"));exList=getAllChildrenByName(getFirstChildByName(d,a.xmlTagBlockElem+"List"),a.xmlTagBlockElem);1===exList.length&&c.append("rect").attr("x",function(g){return a.xScale(exList[0].getAttribute("start"))-a.xScale(g.getAttribute("start"))}).attr("rx",1).attr("ry",1).attr("height",10).attr("width",function(g){g=a.xScale(exList[0].getAttribute("stop"))-a.xScale(exList[0].getAttribute("start"));
0<a.minFeatureWidth&&g<a.minFeatureWidth&&(g=a.minFeatureWidth);return g}).attr("id",function(g,e){e=a.idPrefix+"Ex"+exList[0].getAttribute("ID");null==exList[0].getAttribute("ID")&&(e=a.idPrefix+"Ex"+g.getAttribute("ID")+"_0");return e}).style("fill",a.color).style("cursor","pointer")};a.draw=function(d){a.data=d;a.prevDensity=a.density;a.trackYMax=0;a.yArr=[];a.yArr[0]=[];for(var c=0;c<a.gsvg.width;c++)a.yMaxArr[c]=0,a.yArr[0][c]=0;a.svg.selectAll(".repeatLine"+a.gsvg.levelNumber).remove();a.svg.selectAll(".repeatLbl"+
a.gsvg.levelNumber).remove();if(2==a.density)for(c=0;c<a.typeList.length;c++)a.svg.append("line").attr("class","repeatLine"+a.gsvg.levelNumber).attr("x1",0).attr("x2",a.gsvg.width).attr("y1",12+15*(c+1)).attr("y2",12+15*(c+1)).attr("stroke","#000000").attr("stroke-width","1px"),a.svg.append("text").attr("x",5).attr("class","repeatLbl"+a.gsvg.levelNumber).attr("y",10+15*(c+1)).style("pointer-events","none").style("opacity","0.5").style("fill","#000000").style("font-size","11px").text(a.typeList[c].name),
a.svg.append("text").attr("class","repeatLbl"+a.gsvg.levelNumber).attr("x",a.gsvg.width-5).attr("y",10+15*(c+1)).style("text-anchor","end").style("pointer-events","none").style("opacity","0.5").style("fill","#000000").style("font-size","11px").text(a.typeList[c].name);d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("."+a.idPrefix+"trx"+a.gsvg.levelNumber).remove();a.redrawLegend();d=d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("."+a.idPrefix+"trx"+a.gsvg.levelNumber).data(d,
key).attr("transform",function(g,e){return"translate("+a.xScale(g.getAttribute("start"))+","+a.calcY(parseInt(g.getAttribute("start"),10),parseInt(g.getAttribute("stop"),10),e,g)+")"});d.enter().append("g").attr("class",a.idPrefix+"trx"+a.gsvg.levelNumber).attr("transform",function(g,e){return"translate("+a.xScale(g.getAttribute("start"))+","+a.calcY(parseInt(g.getAttribute("start"),10),parseInt(g.getAttribute("stop"),10),e,g)+")"}).attr("id",function(g){return a.idPrefix+"tx"+g.getAttribute("ID")}).style("cursor",
"move").on("mouseover",function(g){0==a.gsvg.isToolTip&&0!=a.trackClass.indexOf("custom")&&(d3.select(this).selectAll("line").style("stroke","green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(a.createToolTip(g)).style("left",function(){return a.positionTTLeft(d3.event.pageX)}).style("top",function(){return a.positionTTTop(d3.event.pageY)}),1==a.ttSVG&&
a.setupToolTipSVG(g,.05))}).on("mouseout",function(g){d3.select(this).selectAll("line").style("stroke",a.color);d3.select(this).selectAll("rect").style("fill",a.color);d3.select(this).selectAll("text").style("opacity","0.6").style("fill",a.color);tt.transition().delay(100).duration(200).style("opacity",0)}).each(a.drawTrx);d.exit().remove();1==a.density?a.svg.attr("height",30):2==a.density?a.svg.attr("height",15*a.typeList.length+15):3==a.density&&a.svg.attr("height",15*(a.trackYMax+2));a.redrawSelectedArea()};
a.getDisplayedData=function(){var d=d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("."+a.idPrefix+"trx"+a.gsvg.levelNumber);a.counts=[];var c={};d=d[0];var g=[],e=0;if("undefined"!==typeof d){for(var h=0;h<d.length;h++){var l=a.xScale(d[h].__data__.getAttribute("start")),n=a.xScale(d[h].__data__.getAttribute("stop"));if(0<=l&&l<=a.gsvg.width||0<=n&&n<=a.gsvg.width)"undefined"===typeof c[d[h].__data__.getAttribute("class")]?(c[d[h].__data__.getAttribute("class")]={},c[d[h].__data__.getAttribute("class")].value=
1,c[d[h].__data__.getAttribute("class")].names=d[h].__data__.getAttribute("class")):c[d[h].__data__.getAttribute("class")].value=c[d[h].__data__.getAttribute("class")].value+1,g[e]=d[h].__data__,e++}a.counts=[];for(x in c)a.counts.push(c[x])}else a.counts=[];return g};a.draw(m);return a}
function GenericTranscriptTrack(p,m,r,t,f,b){var a=Track(p,m,r,t);a.dataFileName=r+".xml";a.xmlTag="Feature";a.xmlTagBlockElem="block";a.idPrefix="genTrx";a.ttSVG=0;a.ttTrackList=[];a.colorValueField="score";a.colorBy="Score";a.minValue=1;a.maxValue=1E3;a.minColor="#E6E6E6";a.maxColor="#000000";a.minFeatureWidth=-1;a.ttSVGMinWidth=0;a.legendLbl="";p=new String(b);if("undefined"!==typeof b&&0<p.length)for(b=p.split(","),p=0;p<b.length;p++)m=new String(b[p]),0==m.indexOf("colorBy=")?a.colorBy=m.substr(m.indexOf("=")+
1):0==m.indexOf("minColor=")?a.minColor=m.substr(m.indexOf("=")+1):0==m.indexOf("maxColor=")?a.maxColor=m.substr(m.indexOf("=")+1):0==m.indexOf("minValue=")?a.minValue=m.substr(m.indexOf("=")+1):0==m.indexOf("maxValue=")&&(a.maxValue=m.substr(m.indexOf("=")+1));a.createColorScale=function(){"undefined"!==typeof a.minColor&&"undefined"!==typeof a.maxColor&&(a.colorScale=d3.scaleLinear().domain([a.minValue,a.maxValue]).range([a.minColor,a.maxColor]))};a.createColorScale();a.setMinColor=function(d){a.minColor=
"#"+d;a.createColorScale();a.draw(a.data)};a.setMaxColor=function(d){a.maxColor="#"+d;a.createColorScale();a.draw(a.data)};a.setMinValue=function(d){a.minValue=d;a.createColorScale();a.draw(a.data)};a.setMaxValue=function(d){a.maxValue=d;a.createColorScale();a.draw(a.data)};a.setColorBy=function(d){a.colorBy=d;a.createColorScale();a.draw(a.data)};a.getDisplayID=function(d){return d.getAttribute("ID")};a.createToolTip=function(d){return""};a.getColorValue=function(d){return d.getAttribute(a.colorValueField)};
a.color=function(d){var c=d3.rgb("#FFFFFF");"Score"==a.colorBy?c=a.colorScale(a.getColorValue(d)):"Color"==a.colorBy&&(d=(new String(d.getAttribute("color"))).split(","),3==d.length&&(c=d3.rgb(d[0],d[1],d[2])));return c};a.savePrevious=function(){a.prevSetting={};a.prevSetting.density=a.density;a.prevSetting.colorValueField=a.colorValueField;a.prevSetting.colorBy=a.colorBy;a.prevSetting.minValue=a.minValue;a.prevSetting.maxValue=a.maxValue;a.prevSetting.minColor=a.minColor;a.prevSetting.maxColor=
a.maxColor};a.revertPrevious=function(){a.density=a.prevSetting.density;a.colorValueField=a.prevSetting.colorValueField;a.colorBy=a.prevSetting.colorBy;a.minValue=a.prevSetting.minValue;a.maxValue=a.prevSetting.maxValue;a.minColor=a.prevSetting.minColor;a.maxColor=a.prevSetting.maxColor;"Score"==a.colorBy&&a.createColorScale()};a.drawTrx=function(d,c){c=d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).select("#"+a.idPrefix+"tx"+d.getAttribute("ID"));exList=getAllChildrenByName(getFirstChildByName(d,
a.xmlTagBlockElem+"List"),a.xmlTagBlockElem);for(var g=0;g<exList.length;g++)if(c.append("rect").attr("x",function(u){return a.xScale(exList[g].getAttribute("start"))-a.xScale(u.getAttribute("start"))}).attr("rx",1).attr("ry",1).attr("height",10).attr("width",function(u){u=a.xScale(exList[g].getAttribute("stop"))-a.xScale(exList[g].getAttribute("start"));0<a.minFeatureWidth&&u<a.minFeatureWidth&&(u=a.minFeatureWidth);return u}).attr("id",function(u,v){v=a.idPrefix+"Ex"+exList[g].getAttribute("ID");
null==exList[g].getAttribute("ID")&&(v=a.idPrefix+"Ex"+u.getAttribute("ID")+"_"+g);return v}).style("fill",a.color).style("cursor","pointer"),0<g){var e=a.xScale(exList[g-1].getAttribute("stop"))-a.xScale(d.getAttribute("start")),h=a.xScale(exList[g].getAttribute("start"))-a.xScale(d.getAttribute("start"));c.append("line").attr("x1",e).attr("x2",h).attr("y1",5).attr("y2",5).attr("stroke",a.color).attr("stroke-width","2").attr("id",function(u,v){v=a.idPrefix+"Int"+exList[g-1].getAttribute("ID")+"_"+
exList[g].getAttribute("ID");null==exList[g].getAttribute("ID")&&(v=a.idPrefix+"Int"+u.getAttribute("ID")+"_"+(g-1)+"_"+g);return v});var l=">";"-1"==d.getAttribute("strand")&&(l="<");var n=l;h-=e;var q=0;if(7>h)n="";else for(h-=7;8<h;)0==q?(n+=" ",q=1):(n+=l,q=0),h-=7;c.append("svg:text").attr("id",function(u){var v=a.idPrefix+"IntTxt"+exList[g-1].getAttribute("ID")+"_"+exList[g].getAttribute("ID");null==exList[g].getAttribute("ID")&&(v=a.idPrefix+"IntTxt"+u.getAttribute("ID")+"_"+(g-1)+"_"+g);return v}).attr("dx",
e+1).attr("dy","11").style("pointer-events","none").style("opacity","0.5").style("fill",a.color).style("font-size","16px").text(n)}};a.redraw=function(){if(a.prevDensity!=a.density)a.draw(a.data);else{a.yMaxArr=[];a.yArr=[];a.yArr[0]=[];for(var d=0;d<a.gsvg.width;d++)a.yMaxArr[d]=0,a.yArr[0][d]=0;a.trackYMax=0;d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g."+a.idPrefix+"trx"+a.gsvg.levelNumber).attr("transform",function(c,g){return"translate("+a.xScale(c.getAttribute("start"))+","+
a.calcY(parseInt(c.getAttribute("start"),10),parseInt(c.getAttribute("stop"),10),g)+")"}).each(function(c,g){for(var e=getAllChildrenByName(getFirstChildByName(c,a.xmlTagBlockElem+"List"),a.xmlTagBlockElem),h=0;h<e.length;h++){var l=a.idPrefix+"Ex"+e[h].getAttribute("ID");null==e[h].getAttribute("ID")&&(l=a.idPrefix+"Ex"+c.getAttribute("ID")+"_"+h);a.svg.select("g#"+a.idPrefix+"tx"+c.getAttribute("ID")+" rect#"+l).attr("x",function(y){return a.xScale(e[h].getAttribute("start"))-a.xScale(c.getAttribute("start"))}).attr("width",
function(y){return a.xScale(e[h].getAttribute("stop"))-a.xScale(e[h].getAttribute("start"))});if(0<h){l=">";"-1"==c.getAttribute("strand")&&(l="<");g=l;var n=a.xScale(e[h-1].getAttribute("stop"))-a.xScale(c.getAttribute("start")),q=a.xScale(e[h].getAttribute("start"))-a.xScale(c.getAttribute("start")),u=q-n,v=0;if(7>u)g="";else for(u-=7;8<u;)0==v?(g+=" ",v=1):(g+=l,v=0),u-=7;l=e[h-1].getAttribute("ID")+"_"+e[h].getAttribute("ID");null==e[h].getAttribute("ID")&&(l=c.getAttribute("ID")+"_"+(h-1)+"_"+
h);a.svg.select("g#"+a.idPrefix+"tx"+c.getAttribute("ID")+" line#"+a.idPrefix+"Int"+l).attr("x1",n).attr("x2",q);a.svg.select("g#"+a.idPrefix+"tx"+c.getAttribute("ID")+" #"+a.idPrefix+"IntTxt"+l).attr("dx",n+1).text(g)}}});1==a.density?a.svg.attr("height",30):2==a.density?a.svg.attr("height",15*(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g."+a.idPrefix+"trx"+a.gsvg.levelNumber).size()+1)):3==a.density&&a.svg.attr("height",15*(a.trackYMax+1));a.redrawSelectedArea()}};a.update=function(d){a.redraw()};
a.updateFullData=function(d,c){var g=a.xScale.domain()[0],e=a.xScale.domain()[1];a.showLoading();d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+a.gsvg.folderName+"/"+a.dataFileName,function(h,l){if(h){if(0==d||1==c)h="/"+pathPrefix,pathPrefix||(h=""),$.ajax({url:h+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:g,maxCoord:e,panel,rnaDatasetID,arrayTypeID,myOrganism:organism,genomeVer,track:a.trackClass,folder:a.gsvg.folderName},dataType:"json",
success:function(n){gtag("event","generateTrackTranscript",{event_category:"browser"})},error:function(n,q,u){}});3>d?(h=1E4,1==d&&(h=15E3),setTimeout(function(){a.updateFullData(d+1,0)},h)):(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+a.trackClass),d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).attr("height",15),a.gsvg.addTrackErrorRemove(a.svg,"#Level"+a.gsvg.levelNumber+a.trackClass),a.hideLoading())}else null==l?4<=d?(h=[],
a.draw(h),a.hideLoading()):setTimeout(function(){a.updateFullData(d+1,0)},5E3):(h=l.documentElement.getElementsByTagName(a.xmlTag),a.draw(h),a.hideLoading())})};a.redrawLegend=function(){var d=[];"Score"==a.colorBy?a.drawScaleLegend(a.minValue,a.maxValue+"+",a.legendLbl,a.minColor,a.maxColor,0):"Color"==a.colorBy&&(d[0]={color:"#FFFFFF",label:"User assigned color from track file."},a.drawLegend(d))};a.draw=function(d){a.data=d;a.prevDensity=a.density;a.trackYMax=0;a.yArr=[];a.yArr[0]=[];for(var c=
0;c<a.gsvg.width;c++)a.yMaxArr[c]=0,a.yArr[0][c]=0;d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("."+a.idPrefix+"trx"+a.gsvg.levelNumber).remove();a.redrawLegend();d&&(d=d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("."+a.idPrefix+"trx"+a.gsvg.levelNumber).data(d,key),d.enter().append("g").attr("class",a.idPrefix+"trx"+a.gsvg.levelNumber).attr("transform",function(g,e){return"translate("+a.xScale(g.getAttribute("start"))+","+a.calcY(parseInt(g.getAttribute("start"),
10),parseInt(g.getAttribute("stop"),10),e)+")"}).attr("id",function(g){return a.idPrefix+"tx"+g.getAttribute("ID")}).style("cursor","move").on("mouseover",function(g){0==a.gsvg.isToolTip&&0!=a.trackClass.indexOf("custom")&&(d3.select(this).selectAll("line").style("stroke","green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(a.createToolTip(g)).style("left",
function(){return a.positionTTLeft(d3.event.pageX)}).style("top",function(){return a.positionTTTop(d3.event.pageY)}),1==a.ttSVG&&a.setupToolTipSVG(g,.05))}).on("mouseout",function(g){d3.select(this).selectAll("line").style("stroke",a.color);d3.select(this).selectAll("rect").style("fill",a.color);d3.select(this).selectAll("text").style("opacity","0.6").style("fill",a.color);tt.transition().delay(100).duration(200).style("opacity",0)}).merge(d).each(a.drawTrx),d.exit().remove());1==a.density?a.svg.attr("height",
30):2==a.density?a.svg.attr("height",15*(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g."+a.idPrefix+"trx"+a.gsvg.levelNumber).size()+1)):3==a.density&&a.svg.attr("height",15*(a.trackYMax+2));a.redrawSelectedArea()};return a}
function CircRNATrack(p,m,r,t,f,b){var a=GenericTranscriptTrack(p,m,r,t,f,b);p=[];b&&(0<b.indexOf(",")?p=b.split(","):p[0]=b);a.density=f;0<p.length&&(a.dataFileName=p[0].substr(9));a.colorBy=1<p.length?p[1]:"Score";2<p.length&&(a.minValue=p[2]);3<p.length&&(a.maxValue=p[3]);4<p.length&&(a.minColor=p[4]);5<p.length&&(a.maxColor=p[5]);a.colorValueField="score";a.minFeatureWidth=1;a.updateControl=0;a.xmlTag="Gene";a.xmlTagBlockElem="Block";a.idPrefix="cirRNA";a.xCirLineWidth=4;a.xPadding=7;a.featureHeight=
30;"Score"==a.colorBy&&a.createColorScale();a.color=function(d){var c=d3.rgb("#000000");"1"===d.getAttribute("Array")&&"1"===d.getAttribute("Ciri")&&"1"===d.getAttribute("Circexplorer")?c=d3.rgb("#DD9C56"):"0"===d.getAttribute("Array")&&"1"===d.getAttribute("Ciri")&&"1"===d.getAttribute("Circexplorer")?c=d3.rgb("#0f4c75"):"0"!==d.getAttribute("Array")||"1"!==d.getAttribute("Ciri")&&"1"!==d.getAttribute("Circexplorer")?"1"===d.getAttribute("Array")&&"0"===d.getAttribute("Ciri")&&"0"===d.getAttribute("Circexplorer")?
c=d3.rgb("#5D576B"):"1"!==d.getAttribute("Array")||"1"!==d.getAttribute("Ciri")&&"1"!==d.getAttribute("Circexplorer")||(c=d3.rgb("#7A9D98")):c=d3.rgb("#3282b8");return c};a.calcY=function(d,c,g){d=3===a.density||"3"===a.density?a.calcYPack(d,c,g):2===a.density||"2"===a.density?a.calcYFull(g):a.calcYDense();a.trackYMax<d/a.featureHeight&&(a.trackYMax=d/a.featureHeight);return d};a.calcYPack=function(d,c,g){if(d>=a.xScale.domain()[0]&&d<=a.xScale.domain()[1]||c>=a.xScale.domain()[0]&&c<=a.xScale.domain()[1]||
d<=a.xScale.domain()[0]&&c>=a.xScale.domain()[1]){d=Math.round(a.xScale(d));0>d&&(d=0);c=Math.round(a.xScale(c));c>=a.gsvg.width&&(c=a.gsvg.width-1);g=d-a.xPadding;0>g&&(g=0);var e=c+a.xPadding;e>=a.gsvg.width&&(e=a.gsvg.width-1);for(var h=0,l=g;l<=e;l++)a.yMaxArr[l]>h&&(h=a.yMaxArr[l]);h++;var n=h;if(a.yArr.length<=h)for(a.yArr[n]=[],l=0;l<a.gsvg.width;l++)a.yArr[n][l]=0;l=h-a.scanBackYLines;1>l&&(l=1);n=0;for(var q=l;q<h&&0==n;q++){var u=0;for(l=g;l<=e&&0==u;l++)a.yArr[q][l]>u&&(u=1);0==u&&(h=q,
n=1)}h>a.trackYMax&&(a.trackYMax=h);for(l=d;l<=c;l++)a.yMaxArr[l]<h&&(a.yMaxArr[l]=h),a.yArr[h][l]=1;d=h*a.featureHeight}else d=a.featureHeight;return d};a.calcYFull=function(d){return(d+1)*a.featureHeight};a.draw=function(d){a.data=d;a.prevDensity=a.density;a.trackYMax=0;a.yArr=[];a.yArr[0]=[];for(var c=0;c<a.gsvg.width;c++)a.yMaxArr[c]=0,a.yArr[0][c]=0;d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("."+a.idPrefix+"trx"+a.gsvg.levelNumber).remove();a.redrawLegend();d&&(d=d3.select("#Level"+
a.gsvg.levelNumber+a.trackClass).selectAll("."+a.idPrefix+"trx"+a.gsvg.levelNumber).data(d,key),d.enter().append("g").attr("class",a.idPrefix+"trx"+a.gsvg.levelNumber).attr("transform",function(g,e){return"translate("+a.xScale(g.getAttribute("start"))+","+a.calcY(parseInt(g.getAttribute("start"),10),parseInt(g.getAttribute("stop"),10),e)+")"}).attr("id",function(g){return a.idPrefix+"tx"+g.getAttribute("ID")}).style("cursor","move").on("mouseover",function(g){0==a.gsvg.isToolTip&&0!=a.trackClass.indexOf("custom")&&
(d3.select(this).selectAll("line").style("stroke","green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(a.createToolTip(g)).style("left",function(){return a.positionTTLeft(d3.event.pageX)}).style("top",function(){return a.positionTTTop(d3.event.pageY)}),1==a.ttSVG&&a.setupToolTipSVG(g,.05))}).on("mouseout",function(g){d3.select(this).selectAll("line").style("stroke",
a.color);d3.select(this).selectAll("rect").style("fill",a.color);d3.select(this).selectAll("text").style("opacity","0.6").style("fill",a.color);tt.transition().delay(100).duration(200).style("opacity",0)}).merge(d).each(a.drawTrx),d.exit().remove());1==a.density?a.svg.attr("height",30):2==a.density?a.svg.attr("height",15*(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g."+a.idPrefix+"trx"+a.gsvg.levelNumber).size()+1)):3==a.density&&a.svg.attr("height",30*(a.trackYMax+2));a.redrawSelectedArea()};
a.drawTrx=function(d,c){c=d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).select("#"+a.idPrefix+"tx"+d.getAttribute("ID"));exList=getAllChildrenByName(getFirstChildByName(d,a.xmlTagBlockElem+"List"),a.xmlTagBlockElem);minStart=a.xScale(d.getAttribute("start"));maxEnd=a.xScale(d.getAttribute("stop"));c.append("line").attr("id",function(){return"l"+d.getAttribute("ID")+"_x1"}).attr("x1",function(){return a.calcXLine(exList,0,-1,"start",minStart)}).attr("x2",function(){return a.calcXLine(exList,
0,-1,"start",minStart)}).attr("y1",5).attr("y2",20).attr("stroke",a.color).attr("stroke-width","1");c.append("line").attr("id",function(){return"l"+d.getAttribute("ID")+"_x2"}).attr("x1",function(){return a.calcXLine(exList,exList.length-1,1,"stop",minStart)}).attr("x2",function(){return a.calcXLine(exList,exList.length-1,1,"stop",minStart)}).attr("y1",5).attr("y2",20).attr("stroke",a.color).attr("stroke-width","1");c.append("line").attr("id",function(){return"l"+d.getAttribute("ID")+"_x3"}).attr("x1",
function(){return a.calcXLine(exList,0,-1,"start",minStart)}).attr("x2",function(){return a.calcXLine(exList,exList.length-1,1,"stop",minStart)}).attr("y1",5).attr("y2",5).attr("stroke",a.color).attr("stroke-width","1");c.append("line").attr("id",function(){return"l"+d.getAttribute("ID")+"_x4"}).attr("x1",function(){return a.calcXLine(exList,0,-1,"start",minStart)}).attr("x2",function(){return a.calcXLine(exList,0,0,"start",minStart)}).attr("y1",20).attr("y2",20).attr("stroke",a.color).attr("stroke-width",
"1");c.append("line").attr("id",function(){return"l"+d.getAttribute("ID")+"_x5"}).attr("x1",function(){return a.calcXLine(exList,exList.length-1,0,"stop",minStart)}).attr("x2",function(){return a.calcXLine(exList,exList.length-1,1,"stop",minStart)}).attr("y1",20).attr("y2",20).attr("stroke",a.color).attr("stroke-width","1");for(var g=0;g<exList.length;g++)if(c.append("rect").attr("x",function(u){return a.xScale(exList[g].getAttribute("start"))-a.xScale(u.getAttribute("start"))}).attr("y",15).attr("rx",
1).attr("ry",1).attr("height",10).attr("width",function(u){u=a.xScale(exList[g].getAttribute("stop"))-a.xScale(exList[g].getAttribute("start"));0<a.minFeatureWidth&&u<a.minFeatureWidth&&(u=a.minFeatureWidth);return u}).attr("id",function(u,v){v=a.idPrefix+"Ex"+exList[g].getAttribute("ID");null==exList[g].getAttribute("ID")&&(v=a.idPrefix+"Ex"+u.getAttribute("ID")+"_"+g);return v}).style("fill",a.color).style("cursor","pointer"),0<g){var e=a.xScale(exList[g-1].getAttribute("stop"))-a.xScale(d.getAttribute("start")),
h=a.xScale(exList[g].getAttribute("start"))-a.xScale(d.getAttribute("start"));c.append("line").attr("x1",e).attr("x2",h).attr("y1",20).attr("y2",20).attr("stroke",a.color).attr("stroke-width","2").attr("id",function(u,v){v=a.idPrefix+"Int"+exList[g-1].getAttribute("ID")+"_"+exList[g].getAttribute("ID");null==exList[g].getAttribute("ID")&&(v=a.idPrefix+"Int"+u.getAttribute("ID")+"_"+(g-1)+"_"+g);return v});var l=">";"-"===d.getAttribute("strand")&&(l="<");var n=l;h-=e;var q=0;if(7>h)n="";else for(h-=
7;8<h;)0==q?(n+=" ",q=1):(n+=l,q=0),h-=7;c.append("svg:text").attr("id",function(u){var v=a.idPrefix+"IntTxt"+exList[g-1].getAttribute("ID")+"_"+exList[g].getAttribute("ID");null==exList[g].getAttribute("ID")&&(v=a.idPrefix+"IntTxt"+u.getAttribute("ID")+"_"+(g-1)+"_"+g);return v}).attr("y",15).attr("dx",e+1).attr("dy","11").style("pointer-events","none").style("opacity","0.5").style("fill",a.color).style("font-size","16px").text(n)}};a.calcXLine=function(d,c,g,e,h){g*=a.xCirLineWidth;return 0<d.length?
a.xScale(d[c].getAttribute(e))-h+g:0+g};a.redraw=function(){if(a.prevDensity!=a.density)a.draw(a.data);else{a.yMaxArr=[];a.yArr=[];a.yArr[0]=[];for(var d=0;d<a.gsvg.width;d++)a.yMaxArr[d]=0,a.yArr[0][d]=0;a.trackYMax=0;d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g."+a.idPrefix+"trx"+a.gsvg.levelNumber).attr("transform",function(c,g){return"translate("+a.xScale(c.getAttribute("start"))+","+a.calcY(parseInt(c.getAttribute("start"),10),parseInt(c.getAttribute("stop"),10),g)+")"}).each(function(c,
g){minStart=a.xScale(c.getAttribute("start"));maxEnd=a.xScale(c.getAttribute("stop"));var e=getAllChildrenByName(getFirstChildByName(c,a.xmlTagBlockElem+"List"),a.xmlTagBlockElem);a.svg.select("#l"+c.getAttribute("ID")+"_x1").attr("x1",function(){return a.calcXLine(e,0,-1,"start",minStart)}).attr("x2",function(){return a.calcXLine(e,0,-1,"start",minStart)});a.svg.select("#l"+c.getAttribute("ID")+"_x2").attr("x1",function(){return a.calcXLine(e,e.length-1,1,"stop",minStart)}).attr("x2",function(){return a.calcXLine(e,
e.length-1,1,"stop",minStart)});a.svg.select("#l"+c.getAttribute("ID")+"_x3").attr("x1",function(){return a.calcXLine(e,0,-1,"start",minStart)}).attr("x2",function(){return a.calcXLine(e,e.length-1,1,"stop",minStart)});a.svg.select("#l"+c.getAttribute("ID")+"_x4").attr("x1",function(){return a.calcXLine(e,0,-1,"start",minStart)}).attr("x2",function(){return a.calcXLine(e,0,0,"start",minStart)});a.svg.select("#l"+c.getAttribute("ID")+"_x5").attr("x1",function(){return a.calcXLine(e,e.length-1,0,"stop",
minStart)}).attr("x2",function(){return a.calcXLine(e,e.length-1,1,"stop",minStart)});for(var h=0;h<e.length;h++){var l=a.idPrefix+"Ex"+e[h].getAttribute("ID");null==e[h].getAttribute("ID")&&(l=a.idPrefix+"Ex"+c.getAttribute("ID")+"_"+h);a.svg.select("g#"+a.idPrefix+"tx"+c.getAttribute("ID")+" rect#"+l).attr("x",function(y){return a.xScale(e[h].getAttribute("start"))-a.xScale(c.getAttribute("start"))}).attr("width",function(y){return a.xScale(e[h].getAttribute("stop"))-a.xScale(e[h].getAttribute("start"))});
if(0<h){l=">";"-"===c.getAttribute("strand")&&(l="<");g=l;var n=a.xScale(e[h-1].getAttribute("stop"))-a.xScale(c.getAttribute("start")),q=a.xScale(e[h].getAttribute("start"))-a.xScale(c.getAttribute("start")),u=q-n,v=0;if(7>u)g="";else for(u-=7;8<u;)0==v?(g+=" ",v=1):(g+=l,v=0),u-=7;l=e[h-1].getAttribute("ID")+"_"+e[h].getAttribute("ID");null==e[h].getAttribute("ID")&&(l=c.getAttribute("ID")+"_"+(h-1)+"_"+h);a.svg.select("g#"+a.idPrefix+"tx"+c.getAttribute("ID")+" line#"+a.idPrefix+"Int"+l).attr("x1",
n).attr("x2",q);a.svg.select("g#"+a.idPrefix+"tx"+c.getAttribute("ID")+" #"+a.idPrefix+"IntTxt"+l).attr("dx",n+1).text(g)}}});1==a.density?a.svg.attr("height",40):2==a.density?a.svg.attr("height",25*(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g."+a.idPrefix+"trx"+a.gsvg.levelNumber).size()+1)):3==a.density&&a.svg.attr("height",25*(a.trackYMax+1));a.redrawSelectedArea()}};a.updateFullData=function(d,c){if(a.updateControl==d){a.updateControl=d+1;var g=a.xScale.domain()[0],e=a.xScale.domain()[1];
d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+a.gsvg.folderName+"/"+a.trackClass+".xml",function(h,l){if(h){console.log(h);if(0==d||1==c)h="/"+pathPrefix,pathPrefix||(h=""),$.ajax({url:h+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:g,maxCoord:e,folder:a.gsvg.folderName,track:a.trackClass,myOrganism:organism,genomeVer},dataType:"json",success:function(n){gtag("event","generateTrackCustomTranscript",{event_category:"browser"})},error:function(n,
q,u){console.log(u)}});3>d?(h=1E4,1==d&&(h=15E3),setTimeout(function(){a.updateFullData(d+1,0)},h)):(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+a.trackClass),d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).attr("height",15),a.gsvg.addTrackErrorRemove(a.svg,"#Level"+a.gsvg.levelNumber+a.trackClass),a.hideLoading())}else h=l.documentElement.getElementsByTagName(a.xmlTag),a.draw(h),a.hideLoading(),a.updateControl=0})}};a.updateSettingsFromUI=
function(){0<$("#"+a.trackClass+"Dense"+a.level+"Select").length&&(a.density=$("#"+a.trackClass+"Dense"+a.level+"Select").val());0<$("#"+a.trackClass+a.level+"colorSelect").length&&(a.colorBy=$("#"+a.trackClass+a.level+"colorSelect").val())};a.generateSettingsDiv=function(d){var c=trackInfo[a.trackClass];a.savePrevious();d3.select(d).select("table").select("tbody").html("");if(0<c.Controls.length&&"null"!=c.Controls){var g=(new String(c.Controls)).split(",");d=d3.select(d).select("table").select("tbody");
d.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name);for(c=0;c<g.length;c++)if("undefined"!==typeof g[c]&&""!=g[c]){var e=g[c].split(";"),h=d.append("tr").append("td"),l=e[0].substr(5);3<e.length&&0==e[3].indexOf("Default=")&&e[3].substr(8);if(0==e[1].toLowerCase().indexOf("select")){h.append("text").text(l+": ");l=e[1].split(":");e=e[2].split("}");var n=a.trackClass+"Dense"+a.level+"Select";"colorSelect"==l[1]&&(n=a.trackClass+a.level+"colorSelect");h=h.append("select").attr("id",
n).attr("name",l[1]);for(l=0;l<e.length;l++){var q=e[l].substr(1).split(":");if(2==q.length){var u=h.append("option").attr("value",q[1]).text(q[0]);(-1<n.indexOf("Dense")&&q[1]==a.density||-1<n.indexOf("colorSelect")&&q[1]==a.colorBy)&&u.attr("selected","selected")}}d3.select("select#"+n).on("change",function(){"Score"==$(this).val()?$("div."+a.trackClass+"Scale"+a.level).show():"Color"==$(this).val()&&$("div."+a.trackClass+"Scale"+a.level).hide();a.updateSettingsFromUI();a.draw(a.data)})}else 0==
e[1].toLowerCase().indexOf("txt")&&(h=0==$("#colorTrack"+a.level).size()?h.append("div").attr("class",a.trackClass+"Scale"+a.level).style("display","none"):d3.select("#"+a.trackClass+"Scale"+a.level),h.append("text").text(l+": "),l=e[1].split(":"),e=e[2].split("}"),e="Data",n="text",q=a.minValue,u=a.maxValue,"color"==l[1]&&(n=e="Color",q=a.minColor,u=a.maxColor),h.append("input").attr("type",n).attr("id",a.trackClass+"min"+e+a.level).attr("class",l[1]).style("margin-left","5px").attr("value",q),h.append("text").text(" - "),
h.append("input").attr("type",n).attr("id",a.trackClass+"max"+e+a.level).attr("class",l[1]).style("margin-left","5px").attr("value",u),"Color"==e&&(testIE||testSafari)?($("#"+a.trackClass+"min"+e+a.level).spectrum({change:function(v){a.updateSettingsFromUI();a.draw(a.data)}}),$("#"+a.trackClass+"max"+e+a.level).spectrum({change:function(v){a.updateSettingsFromUI();a.draw(a.data)}})):($("input#"+a.trackClass+"min"+e+a.level).on("change",function(){a.updateSettingsFromUI();a.draw(a.data)}),$("input#"+
a.trackClass+"max"+e+a.level).on("change",function(){a.updateSettingsFromUI();a.draw(a.data)})))}"Score"==$("#"+a.trackClass+a.level+"colorSelect").val()?$("div."+a.trackClass+"Scale"+a.level).show():"Color"==$("#"+a.trackClass+a.level+"colorSelect").val()&&$("div."+a.trackClass+"Scale"+a.level).hide();g=d.append("tr").append("td");g.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");
a.gsvg.removeTrack(a.trackClass);var v=svgList[a.gsvg.levelNumber].currentView.ViewID,y=viewMenu[a.gsvg.levelNumber].findTrackByClass(a.trackClass,v);y=viewMenu[a.gsvg.levelNumber].findTrackIndexWithViewID(y.TrackID,v);viewMenu[a.gsvg.levelNumber].removeTrackWithIDIdx(y,v)});g.append("input").attr("type","button").attr("value","Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")});g.append("input").attr("type","button").attr("value",
"Cancel").style("float","right").style("margin-left","5px").on("click",function(){a.revertPrevious();a.draw(a.data);$("#trackSettingDialog").fadeOut("fast")})}else d=d3.select(d).select("table").select("tbody"),d.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name),d.append("tr").append("td").html("Sorry no settings for this track."),g=d.append("tr").append("td"),g.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left",
"5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")}),g.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")})};a.generateTrackSettingString=function(){return a.trackClass+","+a.density+","+a.colorBy+","+a.minValue+","+a.maxValue+","+a.minColor+","+a.maxColor+";"};a.updateFullData(0,0);a.redrawLegend=function(){a.drawLegend([{color:"#DD9C56",label:"All"},{color:"#0f4c75",
label:"Predicted(Multi)"},{color:"#3282b8",label:"Predicted(Single)"},{color:"#5D576B",label:"Array"},{color:"#7A9D98",label:"Array/Predicted"}])};return a}window.GenomeSVG=GenomeSVG;var reportSelectedTrack=null,loadedTrackTable=null,regionDetailLoaded={};$(document).on("click","span.detailMenu",function(p){p=$(this).attr("name");var m=$("span.detailMenu.selected").attr("name");$("div#"+m).hide();$("span.detailMenu.selected").removeClass("selected");$("span[name='"+p+"']").addClass("selected");$("div#"+p).show();if("undefined"!==typeof svgList[0]){m=svgList[0].xScale.domain()[0];var r=svgList[0].xScale.domain()[1];loadRegionReport(p,chr,m,r)}});
function loadRegionReport(p,m,r,t){m=m+":"+r+"-"+t;"regionTable"===p&&(m=m+":"+reportSelectedTrack);regionDetailLoaded[p]&&regionDetailLoaded[p]===m?"regionWGCNAEQTL"===p&&""===$("div#regionWGCNAEQTL").html()&&loadRegionWGCNA():("regionTable"==p&&null!=reportSelectedTrack?loadTrackTable():"regionEQTLTable"==p?($("div#regionEQTLTable").html('<span style="text-align:center;width:100%;"><img src="web/images/ucsc-loading.gif"><BR>Loading...</span>'),setTimeout(function(){loadEQTLTable()},750)):"regionWGCNAEQTL"==
p&&loadRegionWGCNA(),regionDetailLoaded[p]=m);gtag("event",p,{event_category:"loadRegionReport"})}
function loadTrackTable(){var p=svgList[0].xScale.domain()[0],m=svgList[0].xScale.domain()[1],r=chr+":"+minCoord+"-"+maxCoord+":"+reportSelectedTrack.trackClass;loadedTrackTable&&loadedTrackTable===r||(loadedTrackTable=r,r="",p={species:organism,minCoord:p,maxCoord:m,chromosome:chr,rnaDatasetID,arrayTypeID,forwardPvalueCutoff:forwardPValueCutoff,folderName:regionfolderName,genomeVer,track:reportSelectedTrack.trackClass},-1<reportSelectedTrack.trackClass.indexOf("noncoding")?(p.type="noncoding",p.source=
"ensembl",-1<reportSelectedTrack.trackClass.indexOf("brain")&&(p.source="brain"),r="web/GeneCentric/geneTable.jsp"):-1<reportSelectedTrack.trackClass.indexOf("coding")?(r="web/GeneCentric/geneTable.jsp",p.type="coding",p.source="ensembl",-1<reportSelectedTrack.trackClass.indexOf("brain")&&(p.source="brain")):"liverTotal"===reportSelectedTrack.trackClass||"heartTotal"===reportSelectedTrack.trackClass||"brainTotal"===reportSelectedTrack.trackClass||"mergedTotal"===reportSelectedTrack.trackClass||"kidneyTotal"===
reportSelectedTrack.trackClass?(r="web/GeneCentric/geneTable.jsp",p.type="all",p.source="liver","heartTotal"===reportSelectedTrack.trackClass?p.source="heart":-1<reportSelectedTrack.trackClass.indexOf("brainTotal")?p.source="brain":"mergedTotal"===reportSelectedTrack.trackClass?p.source="merged":-1<reportSelectedTrack.trackClass.indexOf("kidneyTotal")&&(p.source="kidney")):-1<reportSelectedTrack.trackClass.indexOf("smallnc")?(p.source="ensembl",-1<reportSelectedTrack.trackClass.indexOf("brain")?p.source=
"brain":-1<reportSelectedTrack.trackClass.indexOf("heart")&&(p.source="heart"),-1<reportSelectedTrack.trackClass.indexOf("liver")&&(p.source="liver"),r="web/GeneCentric/smallGeneTable.jsp"):-1<(new String(reportSelectedTrack.trackClass)).indexOf("snp")||"qtl"===reportSelectedTrack.trackClass&&(r="web/GeneCentric/bqtlTable.jsp"),r&&loadDivWithPage("div#regionTable",r,!1,p,'<span style="text-align:center;width:100%;"><img src="web/images/ucsc-loading.gif"><BR>Loading...</span>'));gtag("event",reportSelectedTrack.trackClass,
{event_category:"loadTrackTable"})}
function loadEQTLTable(){var p=svgList[0].xScale.domain()[0],m=svgList[0].xScale.domain()[1];transcriptome=$("#transriptome").val();cisOnly=$("#cisTrans").val();pValueCutoff=$("#pvalueCutoffSelect2").val();loadDivWithPage("div#regionEQTLTable","web/GeneCentric/regionEQTLTableSeq.jsp",!1,{species:organism,minCoord:p,maxCoord:m,chromosome:chr,rnaDatasetID,arrayTypeID,pValueCutoff,folderName:regionfolderName,genomeVer,transcriptome,cisOnly},'<span style="text-align:center;width:100%;"><img src="web/images/ucsc-loading.gif"><BR>Loading...</span>');gtag("event",
"eQTLTable",{event_category:"loadEQTLTable"})}function loadRegionWGCNA(){$("div#geneWGCNA").html("");var p=svgList[0].xScale.domain()[0],m=svgList[0].xScale.domain()[1];loadDivWithPage("div#regionWGCNAEQTL","web/GeneCentric/wgcnaGene.jsp",!0,{region:chr+":"+p+"-"+m},'<span style="text-align:center;width:100%;"><img src="web/images/ucsc-loading.gif"><BR>Loading...</span>');gtag("event","wgcna",{event_category:"loadWGCNA"})}
function loadEQTLTableWParams(p,m,r,t,f){p=svgList[0].xScale.domain()[0];t=svgList[0].xScale.domain()[1];transcriptome=$("#transriptome").val();cisOnly=$("#cisTrans").val();pValueCutoff=$("#pvalueCutoffSelect2").val();loadDivWithPage("div#regionEQTLTable","web/GeneCentric/regionEQTLTableSeq.jsp",!1,{genomeVer,species:organism,minCoord:p,maxCoord:t,chromosome:chr,rnaDatasetID,arrayTypeID,pValueCutoff,tissues:r,chromosomes:m,folderName:regionfolderName,transcriptome,cisOnly},'<span style="text-align:center;width:100%;"><img src="web/images/ucsc-loading.gif"><BR>Loading...</span>');
gtag("event","eqtlwparams",{event_category:"loadEQTLTableWParams"})}
function loadDivWithPage(p,m,r,t,f){$(p).html(f);$.ajax({url:m,type:"GET",cache:!1,data:t,dataType:"html",async:!0,success:function(b){$(p).html(b);r&&setTimeout(function(){$("html, body").animate({scrollTop:$(p).offset().top},200)},300)},error:function(b,a,d){$(p).html('<span style="color:#FF0000;">An error occurred generating this page.  This can occur when loading the report the first time. Will automatically continue trying to load the report.</span>');setTimeout(function(){loadDivWithPage(p,
m,r,t,f)},15E3)}})}function trKey(p){var m="";p&&(m=p.trackClass);return m}
function DisplayRegionReport(){if(0<d3.select("#collapsableReportList").size()){var p=svgList[0].trackList;if(reportSelectedTrack)for(var m=0;m<p.length&&!reportSelectedTrack;m++)p[m]&&p[m].getDisplayedData&&(reportSelectedTrack=p[m]);p=d3.select("#collapsableReportList").selectAll("li.report").data(p,trKey).html(function(t){var f="";t&&t.getDisplayedData&&(f=t.getDisplayedData(),f=t.label+": "+f.length);return f});p.enter().append("li").attr("class",function(t){return t?"report "+t.trackClass:"report"}).html(function(t){var f=
"";t&&t.getDisplayedData&&(f=t.getDisplayedData(),f=t.label+": "+f.length);return f}).on("click",displayDetailedView);p.exit().remove();!$("div#collapsableReport").is(":hidden")&&reportSelectedTrack&&displayDetailedView(reportSelectedTrack)}p=$("span.detailMenu.selected").attr("name");m=svgList[0].xScale.domain()[0];var r=svgList[0].xScale.domain()[1];loadRegionReport(p,chr,m,r);gtag("event","regionReport",{event_category:"loadRegionReport"})}
function displayDetailedView(p){reportSelectedTrack=p;$("li.report").removeClass("selected");$("li."+p.trackClass).addClass("selected");p.displayBreakDown&&setTimeout(function(){$("div#trackGraph").html("");p.displayBreakDown("div#collapsableReport div#trackGraph")},50);var m=new String(p.trackClass);-1<m.indexOf("coding")||-1<m.indexOf("noncoding")||-1<m.indexOf("smallnc")||-1<m.indexOf("liverTotal")||-1<m.indexOf("heartTotal")||-1<m.indexOf("brainTotal")||-1<m.indexOf("mergedTotal")||-1<m.indexOf("kidneyTotal")||
"qtl"==m?($("#regionTableSubHeader").show(),$("#regionTable").show()):($("#regionTableSubHeader").hide(),$("#regionTable").hide());$("div#regionTable").is(":hidden")||loadTrackTable();gtag("event",p,{event_category:"loaddetailedView"})}
function DisplaySelectedDetailReport(p,m){timeout=5;0<p.indexOf("geneReport.jsp")&&($("div#selectedReport").hide(),timeout=3E3);setTimeout(function(){loadDivWithPage("div#selectedReport",p,!1,m,'<span style="text-align:center;width:100%;"><img src="web/images/ucsc-loading.gif"><BR>Loading...</span>');0<p.indexOf("geneReport.jsp")&&$("div#selectedReport").show()},timeout)};function ViewMenu(p){var m={};m.level=p;m.viewList=[];m.selectedTrackSetting=0;m.previewLevel=100;m.previewSVG=NaN;m.curOrg=(new String(organism)).toUpperCase();m.initialized=0;m.generatePreview=function(r){$("div#previewOuter"+m.level+" div#previewContent").html("");var t=(new String(organism)).toUpperCase();if("AA"===r.Organism||r.Organism===t){t=svgList[m.level].xScale.domain()[0];var f=svgList[m.level].xScale.domain()[1];m.previewSVG=toolTipSVG("div#previewOuter"+m.level+" div#previewContent",
555,t,f,m.previewLevel,chr,svgList[m.level].type);$("div#ScrollLevel"+m.previewLevel).css("overflow","auto").css("max-height","360px");if(r=m.generateSettingsString(r))loadStateFromString(r,"",m.previewLevel,m.previewSVG),m.previewSVG.updateData(),m.previewSVG.updateFullData()}else $("div#previewOuter"+m.level+" div#previewContent").html("No Preview Available: The current organism doesn't match the tracks included in this view.")};m.removeTrackWithID=function(r){r=m.findTrackIndex(r);var t=m.findSelectedView().ViewID;
m.removeTrackWithIDIdx(r,t);gtag("event","deleteTrack",{event_category:"BrowserViews"})};m.removeTrackWithIDIdx=function(r,t){var f=m.findViewWithID(t);t=m.findViewIndexByID(t);"undefined"!==typeof f&&"undefined"!==typeof f.TrackList&&(f.TrackList.splice(r,1),m.generateTrackList(f),m.findSelectedView().modified=1,m.generateViewList(),m.generatePreview(f),$("#viewSelect"+m.level).prop("selectedIndex",t))};m.generateTrackList=function(r){var t=[];d3.select("table#trackListTbl"+m.level).select("tbody").selectAll("tr").remove();
if("undefined"!==typeof r.TrackList)for(var f=0;f<r.TrackList.length;f++)"AA"!==r.TrackList[f].Organism&&r.TrackList[f].Organism!==m.curOrg||t.push(r.TrackList[f]);d3.select("table#trackListTbl"+m.level).select("tbody").selectAll("tr").data(t).enter().append("tr").attr("class",function(b,a){return 0===a%2?"even":"odd"}).attr("id",function(b){return"trk"+b.TrackID}).each(function(b,a){var d='<img src="'+iconPath+'grab_flat.png" style="cursor: move; cursor: -webkit-grab; cursor: -moz-grab; " class="handle'+
m.level+'">';d3.select(this).append("td").attr("class","ind").html(d+(a+1));a='  <span class="listtooltip'+m.level+'" title= "'+b.Description+'"><img src="'+iconPath+'info.gif"></span>';d3.select(this).append("td").html(b.Name+a);a="";"AA"!==b.Organism&&(a=b.Organism,"RN"===a?a="Rat":"MM"===a&&(a="Mouse"),a+=" only");d3.select(this).append("td").html(a);a='<span class="moveUp'+m.level+'" name="'+b.TrackID+'" style="cursor:pointer;" ><img src="'+iconPath+'up_flat.png"></span>';a=a+' <span class="moveDown'+
m.level+'" name="'+b.TrackID+'" style="cursor:pointer;"><img src="'+iconPath+'down_flat.png"></span>';b.Controls&&5<b.Controls.length&&(a=a+'&nbsp&nbsp&nbsp<span class="trackSetting'+m.level+'" name="'+b.TrackID+'" style="cursor:pointer;"><img src="'+iconPath+'gear_flat.png"></span>');a=a+'&nbsp&nbsp&nbsp<span class="delete'+m.level+'" name="'+b.TrackID+'" style="cursor:pointer;"><img src="'+iconPath+'del_flat.png"></span>';d3.select(this).append("td").html(a);d3.select("table#trackListTbl"+m.level).selectAll(".trackSetting"+
m.level).on("click",function(){var c=d3.select(this).attr("name");c!==m.selectedTrackSetting?(m.previewSVG.getTrack(m.findTrack(c).TrackClass).generateSettingsDiv("div#trackSettingContent"),m.selectedTrackSetting=c,c=$(this).position(),$("#trackSettingDialog").css("top",c.top+240).css("left",$(window).width()-415),$("#trackSettingDialog").fadeIn("fast")):$("#trackSettingDialog").fadeOut("fast")}).on("mouseover",function(){$("#controlInfo"+m.level).html("Click to edit track settings.")}).on("mouseout",
function(){$("#controlInfo"+m.level).html("")});d3.select("table#trackListTbl"+m.level).selectAll(".moveUp"+m.level).on("click",function(){var c=$(this).attr("name");$("tr#trk"+c).insertBefore($("table#trackListTbl"+m.level+" tbody tr:first"));m.findSelectedView().modified=1;m.updateTrackNumber("",$("tr#trk"+c))}).on("mouseover",function(){$("#controlInfo"+m.level).html("Click to move the track to the top of the list.")}).on("mouseout",function(){$("#controlInfo"+m.level).html("")});d3.select("table#trackListTbl"+
m.level).selectAll(".moveDown"+m.level).on("click",function(){var c=$(this).attr("name");$("tr#trk"+c).insertAfter($("table#trackListTbl"+m.level+" tbody tr:last"));m.findSelectedView().modified=1;m.updateTrackNumber("",$("tr#trk"+c))}).on("mouseover",function(){$("#controlInfo"+m.level).html("Click to move the track to the end of the list.")}).on("mouseout",function(){$("#controlInfo"+m.level).html("")});d3.select("table#trackListTbl"+m.level).selectAll(".delete"+m.level).on("click",function(){var c=
d3.select(this).attr("name");m.removeTrackWithID(c)}).on("mouseover",function(){$("#controlInfo"+m.level).html("Click to remove the track from the view.")}).on("mouseout",function(){$("#controlInfo"+m.level).html("")})});$("#trackListTbl"+m.level+" tbody").sortable({handle:".handle"+m.level,stop:m.updateTrackNumber}).disableSelection();$(".listtooltip"+m.level).tooltipster({position:"top-right",maxWidth:250,offsetX:10,offsetY:5,contentAsHTML:!0,interactive:!0,interactiveTolerance:350});gtag("event",
"generateTrackList",{event_category:"BrowserViews"})};m.applyView=function(){var r=m.findSelectedView(),t=m.generateSettingStringFromUI();m.setupImage(t,r);$("div.viewsLevel"+m.level).hide();$("div.trackLevel"+m.level).hide();t="/"+pathPrefix;"db"===r.Source&&(pathPrefix||(t=""),$.ajax({url:t+"addBrowserCount.jsp",type:"GET",cache:!1,data:{viewID:r.ViewID},dataType:"json",success:function(f){},error:function(f,b,a){},async:!0}));gtag("event","applyView",{event_category:"BrowserViews"})};m.applySelectedView=
function(r){for(var t=NaN,f=-1,b=0;b<m.filterList.length&&isNaN(t);b++)m.filterList[b].ViewID===r&&(t=m.filterList[b],f=b);r=m.generateSettingStringFromView(t);m.setupImage(r,t);$("#viewSelect"+m.level).prop("selectedIndex",f);m.selectChange();gtag("event","applySelectedView",{event_category:"BrowserViews"})};m.setupImage=function(r,t){svgList[m.level].removeAllTracks();svgList[m.level].currentView=t;svgViewIDList[m.level]=t.ViewID;loadStateFromString(r,t.imgSettings,m.level,svgList[m.level]);$("span#viewLbl"+
m.level).html("View: "+t.Name);0===t.UserID?($("li#menusaveView"+m.level).addClass("ui-state-disabled"),$("li#menudeleteView"+m.level).addClass("ui-state-disabled")):($("li#menusaveView"+m.level).removeClass("ui-state-disabled"),$("li#menudeleteView"+m.level).removeClass("ui-state-disabled"))};m.updateTrackNumber=function(r,t){$("td.ind",$("table#trackListTbl"+m.level)).each(function(f){var b='<img src="'+iconPath+'grab_flat.png" style="cursor: move; cursor: -webkit-grab; cursor: -moz-grab; " class="handle'+
m.level+'">    ';$(this).html(b+(f+1))});d3.select("table#trackListTbl"+m.level).select("tbody").selectAll("tr").attr("class",function(f,b){return 0===b%2?"even":"odd"});r=m.findSelectedView();m.generatePreview(r)};m.generateSettingsString=function(r){var t="";d3.select("table#trackListTbl"+m.level).select("tbody").selectAll("tr").each(function(f){t=t+f.TrackClass+","+f.Settings+";"});return t};m.generateSettingStringFromUI=function(){return m.previewSVG.generateSettingsString()};m.getViewData=function(){var r=
"/"+pathPrefix;pathPrefix||(r="");params={genomeVer};PhenogenAnonSession||(PhenogenAnonSession=SetupAnonSession(),PhenogenAnonSession.setupSession());params.UUID=PhenogenAnonSession.UUID;$.ajax({url:r+"getBrowserViews.jsp",type:"GET",data:params,dataType:"json",success:function(t){m.viewList=[];for(var f=0;f<t.length;f++)if("AA"===t[f].Organism||t[f].Organism===m.curOrg){for(var b=0,a=0;a<t[f].TrackList.length;a++){var d=t[f].TrackList[a];"AA"!==d.Organism&&d.Organism!==m.curOrg||b++}t[f].orgCount=
b;m.viewList.push(t[f])}trackInfo&&m.readCookieViews();m.generateViewList();0===m.initialized&&0===m.level?setTimeout(function(){m.initialized=1;m.applySelectedView($("#defaultView").val())},500):1===m.level&&(m.initialized=1,m.applySelectedView(svgViewIDList[m.level]));gtag("event","getViews",{event_category:"BrowserViews"})},error:function(t,f,b){}})};m.readCookieViews=function(){var r="";if(!0===isLocalStorage()){var t=localStorage.getItem("phenogenCustomViews");t&&(r=t)}else $.cookie("phenogenCustomViews")&&
(r=$.cookie("phenogenCustomViews"));if(r&&-1<r.indexOf("<///>"))for(r=r.split("<///>"),t=0;t<r.length;t++){var f=r[t].split("</>"),b={};for(h=0;h<f.length;h++){var a=f[h].split("=");if("TrackSettingList"===a[0]){a=a[1].split(";");b.TrackList=[];for(var d=0;d<a.length;d++)if(0<a[d].length){var c=a[d].substr(0,a[d].indexOf(",")),g=a[d].substr(a[d].indexOf(",")+1),e={};e.TrackClass=c;e.Settings=g;e.Order=d;b.TrackList.push(e)}}else 2>=a.length?b[a[0]]=a[1]:2<a.length&&(a=f[h].substr(0,f[h].indexOf("=")),
d=f[h].substr(f[h].indexOf("=")+1),b[a]=d)}b.Source="local";if(3<f.length){for(var h=f=0;h<b.TrackList.length;h++){if(a=trackInfo[b.TrackList[h].TrackClass])b.TrackList[h].TrackID=a.TrackID,b.TrackList[h].UserID=a.UserID,b.TrackList[h].Name=a.Name,b.TrackList[h].Description=a.Description,b.TrackList[h].Organism=a.Organism,b.TrackList[h].Controls=a.Controls;a=b.TrackList[h];"AA"!==a.Organism&&a.Organism!==m.curOrg||f++}b.orgCount=f;m.viewList.push(b)}}};m.generateSettingStringFromView=function(r){var t=
"";r=r.TrackList;if("undefined"!==typeof r)for(var f=0;f<r.length;f++)t=t+r[f].TrackClass+","+r[f].Settings+";";return t};m.selectChange=function(){var r="",t=m.findSelectedView();"AA"!==t.Organism&&("RN"===t.Organism?r="<BR><BR>Available for Rat Only":"MM"===t.Organism&&(r="<BR><BR>Available for Mouse Only"));0===t.UserID?$("#deleteView"+m.level).hide():$("#deleteView"+m.level).show();$("div#descOuter"+m.level+" div#descContent").html(t.Description+r);m.generateTrackList(t);m.generatePreview(t);
$(".trackLevel"+m.level).is(":visible")&&trackMenu[m.level].generateTrackTable();$("#trackSettingDialog").hide()};m.setSelectedView=function(r){$("#viewTypeSelect"+m.level).val("all");m.generateViewList();r=m.findDisplayedIndex(r);$("#viewSelect"+m.level).prop("selectedIndex",r)};m.findSelectedView=function(){for(var r=$("#viewSelect"+m.level).val(),t=NaN,f=0;f<m.viewList.length&&isNaN(t);f++)m.viewList[f].ViewID===r&&(t=m.viewList[f]);return t};m.findViewWithID=function(r){for(var t=NaN,f=0;f<m.viewList.length&&
isNaN(t);f++)m.viewList[f].ViewID===r&&(t=m.viewList[f]);return t};m.findViewIndexByID=function(r){for(var t=NaN,f=0;f<m.viewList.length&&isNaN(t);f++)m.viewList[f].ViewID===r&&(t=f);return t};m.findSelectedViewIndex=function(){for(var r=$("#viewSelect"+m.level).val(),t=NaN,f=0;f<m.viewList.length&&isNaN(t);f++)m.viewList[f].ViewID===r&&(t=f);return t};m.findDisplayedIndex=function(r){for(var t=NaN,f=0;f<m.filterList.length&&isNaN(t);f++)m.filterList[f].ViewID===r&&(t=f);return t};m.findTrackByClass=
function(r,t){t=m.findViewWithID(t).TrackList;for(var f=NaN,b=0;b<t.length&&isNaN(f);b++)t[b].TrackClass===r&&(f=t[b]);return f};m.findTrack=function(r){for(var t=m.findSelectedView().TrackList,f=NaN,b=0;b<t.length&&isNaN(f);b++)t[b].TrackID===r&&(f=t[b]);return f};m.findTrackIndex=function(r){var t=m.findSelectedView().TrackList,f=NaN;if("undefined"!==typeof t)for(var b=0;b<t.length&&isNaN(f);b++)t[b].TrackID===r&&(f=b);return f};m.findTrackIndexWithViewID=function(r,t){t=m.findViewWithID(t).TrackList;
for(var f=NaN,b=0;b<t.length&&isNaN(f);b++)t[b].TrackID===r&&(f=b);return f};m.setupControls=function(){-1<p&&($(".control"+m.level+"#addTrack"+m.level).on("click",function(){if($(".trackLevel"+m.level).is(":visible"))$(".trackLevel"+m.level).fadeOut("fast");else{var r=$("div.viewsLevel"+m.level).position(),t=0;1200<=$(window).width()&&(t=-601);trackMenu[m.level].standalone=!1;$(".trackLevel"+m.level).css("top",r.top).css("left",r.left+t);r=m.findSelectedView();$(".trackLevel"+m.level+" span#selectedViewName").html(r.Name);
$(".trackLevel"+m.level).fadeIn("fast");$("div#selectTrack"+m.level).show();$("div#addUsrTrack"+m.level).hide();$("div#addUsrTrack"+m.level).hide();$("div#deleteUsrTrack"+m.level).hide();setTimeout(function(){trackMenu[m.level].generateTrackTable()},250)}}).on("mouseover",function(){$("#controlInfo"+m.level).html("Click to add a track to the current view.")}).on("mouseout",function(){$("#controlInfo"+m.level).html("")}),$(".control"+m.level+"#addView"+m.level).on("click",function(){$("div#nameView"+
m.level).show();$("div#selection"+m.level).hide();$("span#viewMenuLbl"+m.level).text("Create View");$("input#createType"+m.level).val("blank");$("input#function"+m.level).val("create")}).on("mouseover",function(){$("#topcontrolInfo"+m.level).html("Click to create a new view with no tracks.")}).on("mouseout",function(){$("#topcontrolInfo"+m.level).html("")}),$(".control"+m.level+"#copyView"+m.level).on("click",function(){$("div#nameView"+m.level).show();$("div#selection"+m.level).hide();$("span#viewMenuLbl"+
m.level).text("Create View");$("input#createType"+m.level).val("copy");$("input#function"+m.level).val("create")}).on("mouseover",function(){$("#topcontrolInfo"+m.level).html("Click to create a new view copied from the selected view.")}).on("mouseout",function(){$("#topcontrolInfo"+m.level).html("")}),$(".control"+m.level+"#saveView"+m.level).on("click",function(){var r=m.findSelectedView();0===r.UserID?($("#predefinedSaveAs"+m.level).show(),m.saveAsView(r,m.previewSVG)):m.saveView(r.ViewID,m.previewSVG,
!1)}).on("mouseover",function(){$("#topcontrolInfo"+m.level).html("Click to save changes to the currently selected view.")}).on("mouseout",function(){$("#topcontrolInfo"+m.level).html("")}),$(".control"+m.level+"#deleteView"+m.level).on("click",function(){var r=m.findSelectedViewIndex();m.confirmDeleteView(m.viewList[r])}).on("mouseover",function(){$("#topcontrolInfo"+m.level).html("Click to delete current view.")}).on("mouseout",function(){$("#topcontrolInfo"+m.level).html("")}),$(".applyView"+m.level).on("click",
function(){m.applyView()}),d3.select("#viewTypeSelect"+m.level).on("change",m.generateViewList).on("mouseover",function(){$("#topcontrolInfo"+m.level).html("Change to filter the view list by category.")}).on("mouseout",function(){$("#topcontrolInfo"+m.level).html("")}))};m.generateViewList=function(){d3.select("#viewSelect"+m.level).html("");m.filterList=[];for(var r=$("#viewTypeSelect"+m.level).val(),t=0;t<m.viewList.length;t++)("all"===r||"predefined"===r&&0===m.viewList[t].UserID||"custom"===r&&
0!==m.viewList[t].UserID)&&m.filterList.push(m.viewList[t]);d3.select("#viewSelect"+m.level).on("change",m.selectChange).on("mouseover",function(){$("#topcontrolInfo"+m.level).html("Click on a view to select it and view preview/details.")}).on("mouseout",function(){$("#topcontrolInfo"+m.level).html("")}).selectAll("option").data(m.filterList).enter().append("option").attr("value",function(f){return f.ViewID}).text(function(f){var b=f.Name;b=0===f.UserID?b+"      (Predefined)":b+"     (Custom"+("local"===
f.Source?" local":" server")+")";b=b+"     ("+f.orgCount+" tracks)";"AA"!==f.Organism&&("RN"===f.Organism?b+="      (Rat Only)":"MM"===f.Organism&&(b+="     (Mouse Only)"));f.modified&&1===f.modified&&(b+="   (Modified)");return b})};m.addTrackToView=function(r){var t=m.findSelectedView(),f=m.findSelectedViewIndex();t.TrackList.push(r);m.generateTrackList(t);m.generatePreview(t);m.generateViewList();$("#viewSelect"+m.level).prop("selectedIndex",f);ga&&ga("send","event","BrowserViews","addTrackToView")};
m.addTrackToViewWithID=function(r,t){r=m.findViewWithID(r);r.TrackList.push(t);m.generateTrackList(r);m.generatePreview(r);m.generateViewList()};m.createNewView=function(){$("#predefinedSaveAs"+m.level).hide();if(0<uid)if("create"===$("#function"+m.level).val()){var r=$("input#viewNameTxt"+m.level).val(),t=$("#viewDescTxt"+m.level).val(),f=$("input#createType"+m.level).val(),b=-1;"copy"===f&&(b=m.findSelectedView().ViewID);var a="/"+pathPrefix;pathPrefix||(a="");$.ajax({url:a+"createBrowserViews.jsp",
type:"GET",cache:!1,data:{name:r,description:t,type:f,copyFrom:b,organism},dataType:"json",success:function(d){m.getViewData();$("div#nameView"+m.level).hide();$("div#selection"+m.level).show();$("span#viewMenuLbl"+m.level).html("Select/Edit Views")},error:function(d,c,g){console.log(g)},async:!1})}else"saveAs"===$("#function"+m.level).val()&&(r=$("input#viewNameTxt"+m.level).val(),t=$("#viewDescTxt"+m.level).val(),a="/"+pathPrefix,pathPrefix||(a=""),$.ajax({url:a+"createBrowserViews.jsp",type:"GET",
cache:!1,data:{name:r,description:t,type:"blank",copyFrom:-1,organism},dataType:"json",success:function(d){m.saveView(d.viewID,m.saveAsImg,!1);$("div#nameView"+m.level).hide();$("div#selection"+m.level).show();$("span#viewMenuLbl"+m.level).html("Select/Edit Views")},error:function(d,c,g){console.log(g)},async:!1}));else{r=$("input#viewNameTxt"+m.level).val();t=$("#viewDescTxt"+m.level).val();f=$("input#createType"+m.level).val();b="";b=$.cookie("JSESSIONID");a=(new Date).getTime();b="ViewID="+(b+
"_"+a)+"</>UserID=-999</>Name="+r+"</>Description="+t+"</>Organism="+organism.toUpperCase()+"</>imgSettings=displaySelect0=700;</>TrackSettingList=";if("saveAs"===$("#function"+m.level).val())r=m.saveAsImg.generateSettingsString(),b+=r;else if("copy"===f){r="";t=m.findSelectedView().TrackList;for(f=0;f<t.length;f++)r=r+t[f].TrackClass+","+t[f].Settings+";";b+=r}b+="<///>";!0===isLocalStorage()?(r=localStorage.getItem("phenogenCustomViews"))?localStorage.setItem("phenogenCustomViews",r+b):localStorage.setItem("phenogenCustomViews",
b):(r="",r=$.cookie("phenogenCustomViews")?$.cookie("phenogenCustomViews")+b:b,$.cookie("phenogenCustomViews",r));m.getViewData();$("div#nameView"+m.level).hide();$("div#selection"+m.level).show();$("span#viewMenuLbl"+m.level).html("Select/Edit Views")}$("input#viewNameTxt"+m.level).val("");$("#viewDescTxt"+m.level).val("");$("input#createType"+m.level).val("blank");getMainViewData(1);gtag("event","createView",{event_category:"BrowserViews"})};m.saveView=function(r,t,f){if(0<uid){t=t.generateSettingsString();
var b="/"+pathPrefix;pathPrefix||(b="");0<r&&$.ajax({url:b+"updateBrowserView.jsp",type:"GET",cache:!1,data:{viewID:r,trackList:t},dataType:"json",success:function(g){m.getViewData()},error:function(g,e,h){console.log(h)},async:f})}else{f=b="";if(!0===isLocalStorage()){var a=localStorage.getItem("phenogenCustomViews");a&&(b=a)}else $.cookie("phenogenCustomViews")&&(b=$.cookie("phenogenCustomViews"));b=b.split("<///>");for(a=0;a<b.length;a++)if(10<b[a].length)if(-1<b[a].indexOf("ViewID="+r)){var d=
b[a].substr(0,b[a].indexOf("</>TrackSettingList=")),c=t.generateSettingsString();f=f+d+"</>TrackSettingList="+c+"<///>"}else f=f+b+"<///>";!0===isLocalStorage()?localStorage.setItem("phenogenCustomViews",f):$.cookie("phenogenCustomViews",f);m.getViewData()}getMainViewData(1);gtag("event","saveView",{event_category:"BrowserViews"})};m.saveAsView=function(r,t){m.saveAs=r;m.saveAsImg=t;$("div#nameView"+m.level).show();$("div#selection"+m.level).hide();$("span#viewMenuLbl"+m.level).text("Save As...");
$("input#createType"+m.level).val("blank");$("input#function"+m.level).val("saveAs");gtag("event","saveAsView",{event_category:"BrowserViews"})};m.confirmDeleteView=function(r){m.findSelectedView().ViewID!==r.ViewID&&m.setSelectedView(r.ViewID);0<r.UserID||-999===Number(r.UserID)?($("div#selection"+m.level).hide(),$("#deleteViewName"+m.level).html(r.Name+"    ("+r.orgCount+" tracks)"),$("#confirmDeleteView"+m.level).show()):$("#topcontrolInfo"+m.level).html("This is a predefined view, you may not delete it.")};
m.cancelDeleteView=function(){$("#confirmDeleteView"+m.level).hide();$("div#selection"+m.level).show()};m.deleteView=function(){var r=m.findSelectedViewIndex(),t=m.viewList[r];if("db"===t.Source){var f="/"+pathPrefix;pathPrefix||(f="");$.ajax({url:f+"deleteView.jsp",type:"GET",data:{viewID:t.ViewID},dataType:"json",cache:!1,success:function(d){"Deleted Successfully"===d.status&&(m.viewList.splice(r,1),m.generateViewList());$("#topcontrolInfo"+m.level).html(d.status)},error:function(d,c,g){console.log(g);
$("#topcontrolInfo"+m.level).html("There was an error deleting this view.")},async:!0})}else{var b="";f="";if(!0===isLocalStorage()){var a=localStorage.getItem("phenogenCustomViews");a&&(b=a)}else $.cookie("phenogenCustomViews")&&(b=$.cookie("phenogenCustomViews"));b=b.split("<///>");for(a=0;a<b.length;a++)-1<b[a].indexOf("ViewID="+t.ViewID)||10<b[a].length&&(f=f+b[a]+"<///>");!0===isLocalStorage()?localStorage.setItem("phenogenCustomViews",f):$.cookie("phenogenCustomViews",f);m.viewList.splice(r,
1);m.generateViewList()}$("#confirmDeleteView"+m.level).hide();$("div#selection"+m.level).show();$("#viewSelect"+m.level).prop("selectedIndex",0);m.selectChange();svgList[m.level].currentView.ViewID===t.ViewID&&m.applyView();getMainViewData(1);gtag("event","deleteView",{event_category:"BrowserViews"})};m.cancelView=function(){$("div#nameView"+m.level).hide();$("div#selection"+m.level).show();$("#predefinedSaveAs"+m.level).hide();$("span#viewMenuLbl"+m.level).html("Select/Edit Views")};m.getViewData();
m.setupControls();return m};function TrackMenu(p){var m={};m.level=p;m.trackList=[];m.previewLevel=101;m.previewSVG=NaN;m.dataInitialized=0;m.trackDataTable;m.generateTrackTable=function(){for(var r=$("#trackTypeSelect"+m.level).val(),t=[],f=0,b=0;b<m.trackList.length;b++)!("all"===r||"allpublic"===r&&0===m.trackList[b].UserID||"custom"===r&&0!==m.trackList[b].UserID||"genome"===r&&"Genome"===m.trackList[b].GenericCategory||"trxome"===r&&"Transcriptome"===m.trackList[b].GenericCategory)||"AA"!==m.trackList[b].Organism.toUpperCase()&&
m.trackList[b].Organism.toUpperCase()!==organism.toUpperCase()&&m.trackList[b].Organism.toUpperCase()!==organism.toUpperCase()&&m.trackList[b].Organism.substring(0,2).toUpperCase()!==organism.toUpperCase()||0!==$("table#trackListTbl"+m.level+" tr#trk"+m.trackList[b].TrackID).length||(t[f]=m.trackList[b],f++);try{$.fn.DataTable.isDataTable("table#trkSelList"+m.level)&&m.trackDataTable.destroy()}catch(a){}"custom"===r&&0===t.length?($("#noCustomTracks").show(),0===uid?$("#notSignedIn1").show():$("#notSignedIn1").hide()):
($("#noCustomTracks").hide(),$("#notSignedIn1").hide());d3.select("table#trkSelList"+m.level).select("tbody").selectAll("tr").remove();d3.select("table#trkSelList"+m.level).select("tbody").selectAll("tr").data(t).enter().append("tr").attr("id",function(a){return"trk"+a.TrackID}).attr("class",function(a,d){a="odd";0===d%2&&(a="even");return a}).each(function(a,d){var c="";d="";"local"===a.Source&&(d=" (Local)");0!==a.UserID&&(c=new String(a.SetupDate),c=c.substr(0,c.indexOf(":",c.indexOf(":")+1)),
c="<BR><BR>File:"+a.OriginalFile+"<BR><BR>Setup Date:"+c+"<BR><BR>Type:"+a.Type,"local"===a.Source&&(c+="<BR><BR>Local Track only available on this computer."));c='  <span class="trlisttooltip'+m.level+'" title= "'+a.Description+c+'"><img src="'+iconPath+'info.gif"></span>';d3.select(this).append("td").html(a.Name+d+c);d="";"RN"===a.Organism?d="Rat":"MM"===a.Organism&&(d="Mouse");c="Public";0!==a.UserID&&(c="Custom");d3.select(this).append("td").html(d);d3.select(this).append("td").html(a.GenericCategory);
d3.select(this).append("td").html(a.Category);d3.select(this).append("td").html(c)});$.fn.DataTable.isDataTable("table#trkSelList"+m.level)||(r=m.getInitTrackTableHeight(t),m.trackDataTable=$("table#trkSelList"+m.level).DataTable({bPaginate:!1,aaSorting:[[3,"asc"]],sScrollY:r,sDom:'<"rightSearch"fr><t>',columnDefs:[{width:"45%",targets:0}]}));m.trackDataTable.draw();$("td#selectedTrack"+m.level).hide();$("table#trkSelList"+m.level+" tbody").on("click","tr",function(){if(!$(this).hasClass("selected")){$("table#trkSelList"+
m.level+" tbody tr.selected").removeClass("selected");$(this).addClass("selected");$(this).attr("id");var a=m.findSelectedTrack(),d="Selected Track Name: "+a.Name+'  <span class="trInfotooltip'+m.level+'" title= "'+a.Description+'"><img src="'+iconPath+'info.gif"></span>';$("div#trackHeaderOuter"+m.level+" #trackHeaderContent").html(d);d=m.getTrackTableHeight(t);m.trackDataTable.settings()[0].oScroll.sy=d;try{m.trackDataTable.columns.adjust().draw()}catch(c){}$("#trkSelList"+m.level+"_wrapper div.dataTables_scroll div.dataTables_scrollBody").css("height",
d);$("td#selectedTrack"+m.level).show();$(".trInfotooltip"+m.level).tooltipster({position:"top-right",maxWidth:250,offsetX:10,offsetY:5,contentAsHTML:!0,interactive:!0,interactiveTolerance:350});m.generatePreview(a);(d=m.previewSVG.getTrack(a.TrackClass))&&d.generateSettingsDiv&&d.generateSettingsDiv("td#selectedTrack"+m.level);$("td#selectedTrack"+m.level+" #trackListTbl"+m.level+" tbody tr:first").remove();$("td#selectedTrack"+m.level+" #trackListTbl"+m.level+" tbody tr:last").remove();0!==a.UserID?
$("span#deleteCustomTrack"+m.level).show():$("span#deleteCustomTrack"+m.level).hide();d.updateSettingsFromUI()}});$(".trlisttooltip"+m.level).tooltipster({position:"top-right",maxWidth:250,offsetX:10,offsetY:5,contentAsHTML:!0,interactive:!0,interactiveTolerance:350})};m.getInitTrackTableHeight=function(r){var t="750px";0===r.length?t="30px":15>r.length&&(t=30*r.length+"px");return t};m.getTrackTableHeight=function(r){var t="300px";0===r.length?t="20px":10>r.length&&(t=30*r.length+"px");return t};
m.getTrackData=function(){var r="/"+pathPrefix;""===pathPrefix&&(r="");$.ajax({url:r+"getBrowserTracks.jsp",type:"GET",data:{genomeVer},dataType:"json",success:function(t){m.trackList=t;if(0===m.level)for(trackInfo=[],t=0;t<m.trackList.length;t++)trackInfo[m.trackList[t].TrackClass]=m.trackList[t];m.readCookieTracks();m.dataInitialized=1;m.generateTrackTable();trackMenu[m.level]&&trackMenu[m.level].readCookieViews&&(trackMenu[m.level].readCookieViews(),trackMenu[m.level].generateViewList())},error:function(t,
f,b){console.log(b)}})};m.readCookieTracks=function(){var r="";if(!0===isLocalStorage()){var t=localStorage.getItem("phenogenCustomTracks");t&&(r=t)}else $.cookie("phenogenCustomTracks")&&(r=$.cookie("phenogenCustomTracks"));if(r&&-1<r.indexOf("<;>"))for(r=r.split("<;>"),t=0;t<r.length;t++){var f=r[t].split("<->"),b={};for(k=0;k<f.length;k++){var a=f[k].split("=");if(2>=a.length)b[a[0]]=a[1];else if(2<a.length){a=f[k].substr(0,f[k].indexOf("="));var d=f[k].substr(f[k].indexOf("=")+1);if("TrackID"===
a||"TrackClass"===a)d=d.replace(/\./g,"_");b[a]=d}}b.Source="local";3<f.length&&(m.trackList.push(b),0===m.level&&(trackInfo[b.TrackClass]=b))}};m.findSelectedTrack=function(){var r=NaN;if(0<$("table#trkSelList"+m.level+" tbody tr.selected").length){var t=$("table#trkSelList"+m.level+" tbody tr.selected").attr("id");t=t.substr(3);for(var f=0;f<m.trackList.length&&isNaN(r);f++)m.trackList[f].TrackID===t&&(r=m.trackList[f])}return r};m.generateSettingsString=function(r){return r.TrackClass+","+r.Settings+
";"};m.generatePreview=function(r){$("div#trackPreviewOuter"+m.level+" div#trackPreviewContent").html("");var t=(new String(organism)).toUpperCase();if("AA"===r.Organism.substring(0,2)||r.Organism.substring(0,2)===t){t=svgList[m.level].xScale.domain()[0];var f=svgList[m.level].xScale.domain()[1];m.previewSVG=toolTipSVG("div#trackPreviewOuter"+m.level+" div#trackPreviewContent",565,t,f,m.previewLevel,chr,svgList[m.level].type);m.previewSVG.folderName=svgList[m.level].folderName;r=m.generateSettingsString(r);
loadStateFromString(r,"",m.previewLevel,m.previewSVG);m.previewSVG.updateData();m.previewSVG.updateFullData();$("div#trackPreviewContent div#ScrollLevel"+m.previewLevel).css("max-height","250px").css("overflow","auto")}else $("div#previewOuter"+m.level+" div#previewContent").html("No Preview Available: The current organism doesn't match the tracks included in this view.")};m.removeTrack=function(r){m.generateTrackTable()};m.confirmdeleteCustomTrack=function(){var r=m.findSelectedTrack();$("#deleteUsrTrack"+
m.level).show();$("#selectTrack"+m.level).hide();r="Name: <B>"+r.Name+"</B><BR>Description: <B>"+r.Description+"</B><BR>Original File: <B>"+r.OriginalFile+"</B><BR>Setup Date: <B>"+r.SetupDate+"</b>";$("span#customTrackInfo"+m.level).html(r);gtag("event","deleteCustomTrack",{event_category:"BrowserTracks"})};m.cancelDeleteTrack=function(){$("#deleteUsrTrack"+m.level).hide();$("#selectTrack"+m.level).show()};m.deleteTrack=function(){var r=m.findSelectedTrack();if("local"===r.Source){var t="TrackClass="+
r.TrackClass+"<->",f="";if(!0===isLocalStorage()){var b=localStorage.getItem("phenogenCustomTracks");b&&(f=b)}else $.cookie("phenogenCustomTracks")&&(f=$.cookie("phenogenCustomTracks"));if(f&&-1<f.indexOf("<;>")){var a="";f=f.split("<;>");for(b=0;b<f.length;b++)-1===f[b].indexOf(t)&&(a=a+f[b]+"<;>");t="/"+pathPrefix;pathPrefix||(t="");$.ajax({url:t+"removeCustomTrack.jsp",type:"GET",data:{trackID:r.TrackID},dataType:"json",success:function(d){!0===isLocalStorage()?localStorage.setItem("phenogenCustomTracks",
a):$.cookie("phenogenCustomTracks",a)},error:function(d,c,g){console.log(g)},async:!1})}}else"db"===r.Source&&(t="/"+pathPrefix,pathPrefix||(t=""),$.ajax({url:t+"deleteTrack.jsp",type:"GET",data:{trackID:r.TrackID},dataType:"json",success:function(d){"true"===d.success?$(".uploadStatus").html("<B>Track Setup Successfully</B>"):$(".uploadStatus").html("<B>Track Setup Failed</B>")},error:function(d,c,g){console.log(g)},async:!1}));m.getTrackData();$("#deleteUsrTrack"+m.level).hide();$("#selectTrack"+
m.level).show();m.generateTrackTable();gtag("event","deleteTrack",{event_category:"BrowserTracks"})};m.confirmUpload=function(){$("div#confirmUpload"+m.level).show();$("div#uploadBtn"+m.level).hide()};m.confirmBed=function(){$("input#hasconfirmBed"+m.level).val(1);m.createCustomTrack(m.level)};m.cancelUpload=function(){$("div#confirmUpload"+m.level).hide();$("div#confirmBed"+m.level).hide();$("div#uploadBtn"+m.level).show()};m.createCustomTrack=function(){$("div#confirmUpload"+m.level).hide();customTrackLevel=
m.level;var r=$("#usrtrkFileTypeSelect"+m.level).val();"bed"===r||"bg"===r?m.createUploadedCustomTrack():("bb"===r||"bw"===r)&&m.createRemoteCustomTrack();gtag("event","createCustomTrack",{event_category:"BrowserTracks"})};m.createUploadedCustomTrack=function(){var r=$("input#customUploadFile"+m.level)[0].files[0],t=$("#usrtrkFileTypeSelect"+m.level).val(),f=r.name,b=r.size/1024/1024;$(".uploadStatus").show();var a="";if(0<f.indexOf(".")){for(var d=f;-1<d.indexOf(".");)d=d.substr(d.indexOf(".")+1);
""!==d&&d!==f&&(a=d)}20>b?a!==t?"gz"===a||"tar"===a||"zip"===a||"exe"===a||"bin"===a?(setTimeout(function(){$("div#uploadBtn"+customTrackLevel).show();$(".progressInd").hide()},5E3),$(".uploadStatus").html("Error: Selected File Type is not supported.")):0===$("input#hasconfirmBed"+m.level).val()?$("div#confirmBed"+customTrackLevel).show():1===$("input#hasconfirmBed"+m.level).val()&&($("div#confirmBed"+customTrackLevel).hide(),m.createTrack(r)):m.createTrack(r):($("div#uploadBtn"+customTrackLevel).show(),
$(".progressInd").hide(),$(".uploadStatus").html("File is too large.  20MB is the current limit."))};m.createTrack=function(r){m.readFile(r)};m.createRemoteCustomTrack=function(){$(".uploadStatus").html("Setting up track...");$(".uploadStatus").show();var r=$("#customFileURL"+m.level).val(),t="",f=new Date;$.cookie("JSESSIONID")&&(t=$.cookie("JSESSIONID"),t=t+"_"+f.getTime());m.saveTrack(t,r)};m.saveTrack=function(r,t){var f=$("#usrtrkNameTxt"+m.level).val(),b=$("#usrtrkDescTxt"+m.level).val(),a=
$("#usrtrkOrgSelect"+m.level).val(),d=$("#usrtrkGenCatSelect"+m.level).val(),c=$("#usrtrkCatTxt"+m.level).val(),g="",e=$("#usrtrkFileTypeSelect"+m.level).val(),h="";if("bed"===e||"bg"===e)h=$("input#customUploadFile"+m.level)[0].files[0].name;var l="Color";0<$("#usrtrkColorSelect"+m.level).length&&(l=$("#usrtrkColorSelect"+m.level).val());if("Score"===l){var n="000000",q="FFFFFF",u=1,v=1E3;testIE||testSafari?(n=$("#usrtrkColorMin"+m.level).spectrum("get").toHexString(),q=$("#usrtrkColorMax"+m.level).spectrum("get").toHexString()):
(n=$("#usrtrkColorMin"+m.level).val(),q=$("#usrtrkColorMax"+m.level).val());n=n.substr(1);q=q.substr(1);u=$("#usrtrkScoreMinTxt"+m.level).val();v=$("#usrtrkScoreMaxTxt"+m.level).val()}"bed"===e?g="Name=View Density;Select:trackSelect:Dense:Select;{Dense:1}{Pack:3}{Full:2};Default=3,Name=Color by;Select:colorSelect::colorSelect;{Feature Defined:Color}{Score based scale:Score};Default="+l+",Name=Scale Range;Txt:tissuecbx;{min:1}{max:1000};Default="+u+":"+v+",Name=Color Range;Txt:color;{min:FFFFFF}{max:000000};Default="+
n+":"+q:"bg"===e?g="Name=View Density;Select:trackSelect:Dense:Select;{Dense:1}{Full:2};Default=1,Name=Scale Range;Slider:rangeslider;{min:1-1000}{max:1000-20000};Default=1:5000":"bw"===e?g="Name=View Density;Select:trackSelect:Dense:Select;{Dense:1}{Full:2};Default=1,Name=Scale Range;Slider:rangeslider;{min:1-1000}{max:1000-20000};Default=1:5000":"bb"===e&&(g="Name=View Density;Select:trackSelect:Dense:Select;{Dense:1}{Pack:3}{Full:2};Default=3,Name=Color by;Select:colorSelect::colorSelect;{Feature Defined:Color}{Score based scale:Score};Default="+
l+",Name=Scale Range;Txt:tissuecbx;{min:1}{max:1000};Default="+u+":"+v+",Name=Color Range;Txt:color;{min:FFFFFF}{max:000000};Default="+n+":"+q);r="custom"+r;0<uid?(l="/"+pathPrefix,pathPrefix||(l=""),$.ajax({url:l+"addTrack.jsp",type:"GET",data:{trackClass:r,trackName:f,trackDesc:b,trackOrg:a,genericCategory:d,category:c,controls:g,location:t,type:e,file:h},dataType:"json",success:function(y){"true"===y.success?$(".uploadStatus").html("<B>Track Setup Successfully</B>"):$(".uploadStatus").html("<B>Track Setup Failed</B>")},
error:function(y,w,C){console.log(C)},async:!1})):(l=new Date,r="TrackID="+r+"<->UserID=-999<->TrackClass="+r+"<->Name="+f+"<->Description="+b+"<->Organism="+a.toUpperCase(),r=r+"<->Settings=<->Order=0<->GenericCategory="+d+"<->Category="+c+"<->Controls="+g+"<->SetupDate="+l+"<->Type="+e+"<->OriginalFile="+h+"<->Location="+t,r=r+"<->genomeVer="+genomeVer,r+="<;>",!0===isLocalStorage()?((t=localStorage.getItem("phenogenCustomTracks"))&&(r=t+r),localStorage.setItem("phenogenCustomTracks",r)):($.cookie("phenogenCustomTracks")&&
(r=$.cookie("phenogenCustomTracks")+r),$.cookie("phenogenCustomTracks",r)),$(".uploadStatus").html("<B>Track Setup Successfully</B>"));$("div#finished"+m.level).show();$("input#customUploadFile"+m.level).val("");$("input#customURL"+m.level).val("");$("input#usrtrkNameTxt"+m.level).val("");$("#usrtrkDescTxt"+m.level).val("");$("input#usrtrkOrgSelect"+m.level).val("Rn");$("input#usrtrkGenCatSelect"+m.level).val("Genome");$("input#usrtrkCatTxt"+m.level).val("");$("#usrtrkColorSelect"+m.level).val("Color");
$("#customFileURL"+m.level).val("");m.getTrackData();gtag("event","saveTrack",{event_category:"BrowserTracks"})};m.readFile=function(r){var t=new FileReader;t.readAsText(r,"UTF-8");t.onload=m.sendFile};m.sendFile=function(r){$.ajax({url:pathPrefix+"trackUpload.jsp",type:"POST",contentType:"text/plain",xhr:function(){var t=$.ajaxSettings.xhr();t.upload.addEventListener("progress",m.progressHandlingFunction,!1);return t},data:r.target.result,processData:!1,cache:!1,dataType:"json",success:function(t){$(".uploadStatus").html("<B>Upload Completed Successfully</b>");
m.saveTrack(t.trackFile,t.trackFile);gtag("event","customTrackUploaded",{event_category:"BrowserTracks"})},error:function(t,f,b){console.log(b);$(".uploadStatus").html("Error:"+b);$("div#uploadBtn"+customTrackLevel).show()}})};m.progressHandlingFunction=function(r){$(".progressInd").show();$(".uploadStatus").html("Uploading...");r.lengthComputable&&$("progress").attr({value:r.loaded,max:r.total})};m.getTrackData();return m};$(window).resize(function(){"undefined"!==typeof wgcna&&("undefined"!==typeof wgcna.multiImage?wgcna.multiImage.draw():"undefined"!==typeof wgcna.singleImage&&wgcna.singleImage.draw())});function replaceDot(p){return p.replace(/\./g,"_")}function replaceUnderscore(p){return p.replace(/_/g,".")}function removeColon(p){return p.replace(/:/g,"")}
function WGCNABrowser(p,m,r,t,f,b){that={};that.singleID=p;that.region=m;that.dispType=t;that.viewType=f;that.geneList=r;that.moduleList=[];that.moduleGenes={};that.modules={};that.tissue=b;that.panel="";that.requests=0;that.skipGrey=1;that.chrLen=19;that.selSource="seq";that.version="5";that.moduleRequestList=[];that.modSelect="gene";that.modSelectCutoff=2;"Mm"===organism?(that.panel="ILS/ISS",that.wDSID=1):"Rn"===organism&&("rn5"===genomeVer?(that.panel="BNLx/SHR",that.chrLen=20,that.wDSID=2):(that.panel=
"BNLx/SHR",that.chrLen=20,"seq"===that.selSource?"5"===that.version?"Whole Brain"===b?that.wDSID=11:"Liver"===b&&(that.wDSID=12):"2"===that.version?"Whole Brain"===b?that.wDSID=8:"Liver"===b&&(that.wDSID=9):"Whole Brain"===b?that.wDSID=6:"Liver"===b&&(that.wDSID=7):"Whole Brain"===b?that.wDSID=3:"Heart"===b?that.wDSID=4:"Liver"===b&&(that.wDSID=5)));that.eQTLKey=function(a){return"Link_"+a.Snp};that.mirKey=function(a){return a.ID};that.modKey=function(a){return a.MODULE};that.removeInvalidIDChars=
function(a){"undefined"!==typeof a&&(-1<a.indexOf("*")&&(a=a.replace(/\*/g,"star")),-1<a.indexOf(" ")&&(a=a.replace(/\s/g,"_")),-1<a.indexOf(".")&&(a=a.replace(/\./g,"_")));return a};that.setup=function(){that.requestModuleList();that.createImageControls();that.createViewControls();that.createDataControls();$(".wgcnaControltooltip").tooltipster({position:"top-right",maxWidth:250,offsetX:5,offsetY:5,contentAsHTML:!0,interactive:!0,interactiveTolerance:350});gtag("event","setupWGCNA",{event_category:"setupWGCNA"})};
that.requestModuleList=function(){that.moduleGenes={};that.moduleList=[];that.modules={};var a=that.modSelect;"eQTL"==that.modSelect&&(a=a+":"+that.modSelectCutoff);$.ajax({url:pathPrefix+"getWGCNAModules.jsp",type:"GET",async:!0,data:{source:that.selSource,modFileType:that.viewtype,id:that.singleID,organism,panel:that.panel,tissue:that.tissue,region:that.region,geneList:that.geneList,genomeVer,version:that.version,modSelection:a},dataType:"json",beforeSend:function(){$("#waitCircos").show();for(var d=
0;d<that.moduleRequestList.length;d++)that.moduleRequestList[d].abort();that.moduleRequestList=[];console.log(that.modSelect+":"+that.modSelectCutoff);console.log(a);console.log("request mod list:"+that.wDSID+":"+that.selSource)},success:function(d){$("#wgcnaGeneImage #message").hide();that.moduleList=[];0<d.length&&(1!==d.length||"grey"!==d[0].ModuleID)?setTimeout(function(){for(var c=0;c<d.length;c++)"grey"!==d[c].ModuleID&&(that.moduleList.push(d[c].ModuleID),that.requests++,that.requestModule(d[c].ModuleID),
"undefined"!==typeof d[c].GeneList&&(that.moduleGenes[d[c].ModuleID]=d[c].GeneList));that.refreshRegion(1E3);setTimeout(function(){$("html, body").animate({scrollTop:$("#multiWGCNAScroll").offset().top},100)},1200)},1):0===d.length?that.displayMessage("There are no transcripts with Affymetrix Probesets that represent this gene."):1===d.length&&"grey"===d[0].ModuleID&&that.displayMessage("Only the Grey module contains transcripts for this gene.  The Grey module contains all transcripts that did not have a high enough correlation with any other transcripts to be included in another module.");
gtag("event","requestModuleList",{event_category:"requestModuleList"})},error:function(d,c,g){}})};that.displayMessage=function(a){$("#waitCircos").hide();$("#wgcnaGeneImage #message").html("<BR><BR><h2>"+a+"</h2><BR><BR>").show()};that.refreshRegion=function(a){setTimeout(function(){that.createMultiWGCNAImage();0<that.requests?that.refreshRegion(2E3):1!==a&&(that.refreshRegion(1),$("#waitCircos").hide())},a)};that.requestModule=function(a,d){xhr=$.ajax({url:contextRoot+"tmpData/browserCache/"+genomeVer+
"/modules/ds"+that.wDSID+"/"+a+".json",type:"GET",async:!0,data:{},dataType:"json",success:function(c){console.log("success:"+contextRoot+"tmpData/browserCache/"+genomeVer+"/modules/ds"+that.wDSID+"/"+a+".json");setTimeout(function(){console.log("countingGeneInstances");console.log(a);if(0<that.singleID.length)that.countGeneInstance(that.singleID,c);else{var g=that.moduleGenes[a].split(",");c.GroupedGenes=g.length;that.countGeneInstance(that.moduleGenes[a],c)}that.modules[a]=c;that.requests--;d&&
d(a)},20);gtag("event",a,{event_category:"requestModule"})},error:function(c,g,e){console.log(e);that.requests--}});that.moduleRequestList.push(xhr)};that.scanFilter=function(a,d){var c=[];if(a)for(var g=0;g<a.length;g++)d(a[g])&&c.append(a[g]);return c};that.countGeneInstance=function(a,d){var c=d.TCList,g=0;d.selectGeneTC={};for(var e=0;e<c.length;e++)-1<a.indexOf(c[e].Gene.ID)&&g++;d.GeneCount=g};that.createImageControls=function(){that.imageBar=d3.select("#imageControl").append("span").style("float",
"left");that.imageBar.append("span").attr("class","saveImage control").style("display","inline-block").attr("id","saveImage").style("cursor","pointer").append("img").attr("src",contextRoot+"web/images/icons/savePic_dark.png").attr("pointer-events","all").attr("cursor","pointer").on("click",function(){var a="";if(that.singleImage){"eqtl"===that.viewType&&"eqtl"===that.singleImage.type?a=$("div#circos").html():"gene"===that.viewType&&"gene"===that.singleImage.type?a=$("div#viewGene").html():"mir"===
that.viewType&&"mir"===that.singleImage.type?a=$("div#viewGene").html():"go"===that.viewType&&"go"===that.singleImage.type&&(a=$("div#viewGene").html());var d=$(window).width();a=a.replace('width="100%"','width="'+d+'px"');$.ajax({url:pathPrefix+"saveBrowserImage.jsp",type:"POST",contentType:"text/html",data:a+"\n",processData:!1,dataType:"json",success:function(c){var g=new Date;g=g.getMonth()+1+"_"+g.getDate()+"_"+g.getFullYear();var e="http://";"https:"===location.protocol&&(e="https://");var h=
e+urlprefix+"/tmpData/download/"+c.imageFile;c="";that.selectedModule&&(c=new String(that.selectedModule.MOD_NAME));c=c+"_"+that.viewType;var l=c+"_"+g+".png",n=new XMLHttpRequest;n.open("GET",h);n.responseType="blob";n.send();n.onreadystatechange=function(){if(4!=n.readyState||200!=n.status)return!1;var q=document.createElement("a");q.href=window.URL.createObjectURL(n.response);q.download=l;q.style.display="none";document.body.appendChild(q);try{q.click()}catch(u){$("#wgcnaMouseHelp").html("<span style='color:#FF0000;'>Your browser will not save the image directly. Image will open in a popup, in the new window right click to save image.</span>"),
window.open(h)}return!0}},error:function(c,g,e){console.log(e)}});gtag("event","saveWGCNAView",{event_category:"saveWGCNAView"})}}).on("mouseover",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/savePic_white.png");$("#wgcnaMouseHelp").html("Click to download a PNG image of the current view.")}).on("mouseout",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/savePic_dark.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});
that.imageBar.append("span").attr("class","reset control").style("display","inline-block").attr("id","wgcnaresetImage").style("cursor","pointer").append("img").attr("src",contextRoot+"web/images/icons/reset_dark.png").attr("pointer-events","all").attr("cursor","pointer").on("click",function(){that.singleImage&&("eqtl"===that.viewType?that.singleImage.panZoomCircos.reset():"undefined"!==typeof that.singleImage&&that.singleImage.panZoom.reset());gtag("event","resetWGCNAView",{event_category:"resetWGCNAView"})}).on("mouseover",
function(){d3.select(this).attr("src",contextRoot+"web/images/icons/reset_white.png");$("#wgcnaMouseHelp").html("Click to reset image zoom to initial region.")}).on("mouseout",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/reset_dark.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});that.imageBar.append("span").attr("class","zoomIn control").style("display","inline-block").style("cursor","pointer").style("position",
"relative").style("top","7px").attr("id","wgcnazoomInImage").append("img").attr("src",contextRoot+"web/images/icons/magPlus_dark_32.png").attr("pointer-events","all").attr("cursor","pointer").style("position","relative").style("top","-5px").on("click",function(){"eqtl"===that.viewType&&that.singleImage?that.singleImage.panZoomCircos.zoomIn():void 0==that.singleImage&&that.multiImage?that.multiImage.zoomIn():"undefined"!==typeof that.singleImage&&that.singleImage&&that.singleImage.panZoom.zoomIn();
gtag("event","zoomInWGCNAView",{event_category:"zoomInWGCNAView"})}).on("mouseover",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/magPlus_light_32.png");$("#wgcnaMouseHelp").html("Click to zoom in.")}).on("mouseout",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/magPlus_dark_32.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});that.imageBar.append("span").attr("class","zoomOut control").style("display",
"inline-block").style("cursor","pointer").style("position","relative").style("top","7px").attr("id","wgcnazoomOutImage").append("img").attr("src",contextRoot+"web/images/icons/magMinus_dark_32.png").attr("pointer-events","all").attr("cursor","pointer").style("position","relative").style("top","-5px").on("click",function(){"eqtl"===that.viewType&&that.singleImage?that.singleImage.panZoomCircos.zoomOut():void 0==that.singleImage&&that.multiImage?that.multiImage.zoomOut():that.singleImage&&"undefined"!==
typeof that.singleImage&&"undefined"!==typeof that.singleImage.panZoom&&that.singleImage.panZoom.zoomOut();gtag("event","zoomOutWGCNAView",{event_category:"zoomOutWGCNAView"})}).on("mouseover",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/magMinus_light_32.png");$("#wgcnaMouseHelp").html("Click to zoom out.")}).on("mouseout",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/magMinus_dark_32.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});
that.imageBar.append("span").attr("class","back control").style("display","inline-block").style("cursor","pointer").style("position","relative").style("top","7px").attr("id","backModule").append("img").attr("src",contextRoot+"web/images/icons/back_dark_32.png").attr("pointer-events","all").attr("cursor","pointer").style("position","relative").style("top","-5px").on("click",function(){that.multiImage.backModule()}).on("mouseover",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/back_light_32.png");
$("#wgcnaMouseHelp").html("Click to move to the previous module.")}).on("mouseout",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/back_dark_32.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});that.imageBar.append("span").attr("class","forward control").style("display","inline-block").style("cursor","pointer").style("position","relative").style("top","7px").attr("id","forwardModule").append("img").attr("src",contextRoot+
"web/images/icons/forward_dark_32.png").attr("pointer-events","all").attr("cursor","pointer").style("position","relative").style("top","-5px").on("click",function(){that.multiImage.forwardModule()}).on("mouseover",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/forward_light_32.png");$("#wgcnaMouseHelp").html("Click to move to the next module.")}).on("mouseout",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/forward_dark_32.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")})};
that.createViewControls=function(){that.viewBar=d3.select("#viewControl").append("div").attr("id","wgcnaViewControls").style("float","right").style("margin-left","10px").style("margin-right","5px").style("text-align","left");that.viewBar.append("text").text("Views:");that.viewBar.append("span").attr("id","HelpWGCNAView").append("img").attr("src",contextRoot+"web/images/icons/help.png");that.viewBar.append("br");that.viewBar.append("input").attr("type","radio").attr("id","wgcnaGeneViewRB").attr("name",
"wgcnaViewRB").attr("value","gene").attr("checked","checked").style("margin-left","7px").style("margin-right","3px").on("click",function(){that.viewType="gene";that.createSingleWGCNAImage();gtag("event","moduleView",{event_category:"WGCNA"})});that.viewBar.append("text").text("Module");that.viewBar.append("span").attr("class","wgcnaControltooltip").attr("title",'View transcripts within the selected module and their connectivity based on correlation of expression.<BR><BR>Have a question about this view click the <img src="'+
contextRoot+'web/images/icons/help.png"> above for a detailed description of each view.').style("margin-left","5px").append("img").attr("src","/web/images/icons/info.gif");that.viewBar.append("br");that.viewBar.append("input").attr("type","radio").attr("id","wgcnaEQTLViewRB").attr("name","wgcnaViewRB").attr("value","eqtl").style("margin-left","7px").style("margin-right","3px").on("click",function(){that.viewType="eqtl";that.createSingleWGCNAImage();gtag("event","eQTLView",{event_category:"WGCNA"})});
that.viewBar.append("text").text("Eigengene eQTL");that.viewBar.append("span").attr("class","wgcnaControltooltip").attr("title",'View Circos plot of the module Eigengene eQTLs.<BR><BR>Have a question about this view click the <img src="'+contextRoot+'web/images/icons/help.png"> above for a detailed description of each view.').style("margin-left","5px").append("img").attr("src","/web/images/icons/info.gif");that.viewBar.append("br");that.viewBar.append("input").attr("type","radio").attr("id","wgcnaGOViewRB").attr("name",
"wgcnaViewRB").attr("value","go").style("margin-left","7px").style("margin-right","3px").attr("disabled",function(){return 10<that.wDSID?!0:!1}).on("click",function(){that.viewType="go";that.createSingleWGCNAImage();gtag("event","goView",{event_category:"WGCNA"})});that.viewBar.append("text").text("Gene Ontology");that.viewBar.append("span").attr("class","wgcnaControltooltip").attr("title",'TEMPORARILY DISABLED PLEASE CHECK BACK. View a summary of Gene Ontology terms assigned to transcripts in the selected module.<BR><BR>Have a question about this view click the <img src="'+
contextRoot+'web/images/icons/help.png"> above for a detailed description of each view.').style("margin-left","5px").append("img").attr("src","/web/images/icons/info.gif");that.viewBar.append("br");that.viewBar.append("input").attr("type","radio").attr("id","wgcnaMirViewRB").attr("name","wgcnaViewRB").attr("value","mir").style("margin-left","7px").style("margin-right","3px").on("click",function(){that.viewType="mir";that.createSingleWGCNAImage();gtag("event","mirView",{event_category:"WGCNA"})});
that.viewBar.append("text").text("miRNA Targets");that.viewBar.append("span").attr("class","wgcnaControltooltip").attr("title",'View a summary of miRNAs that target genes in this module.<BR><BR>Have a question about this view click the <img src="'+contextRoot+'web/images/icons/help.png"> above for a detailed description of each view.').style("margin-left","5px").append("img").attr("src","/web/images/icons/info.gif");that.viewBar.append("br");that.viewBar.append("input").attr("type","radio").attr("id",
"wgcnaMetaViewRB").attr("name","wgcnaViewRB").attr("value","meta").style("margin-left","7px").style("margin-right","3px").attr("disabled",function(){return 10<that.wDSID?!0:!1}).on("click",function(){that.viewType="meta";that.createSingleWGCNAImage();gtag("event","metaView",{event_category:"WGCNA"})});that.viewBar.append("text").text("Meta Module (nearest neighbors)");that.viewBar.append("span").attr("class","wgcnaControltooltip").attr("title",'View most closely correlated modules and browse those modules.<BR><BR>Have a question about this view click the <img src="'+
contextRoot+'web/images/icons/help.png"> above for a detailed description of each view.').style("margin-left","5px").append("img").attr("src","/web/images/icons/info.gif");$("#HelpWGCNAView").on("click",function(a){var d=$(this).attr("id");$("#"+d+"Content").dialog("option","position",{my:"right top",at:"left bottom",of:$(this)});$("#"+d+"Content").dialog("open").css({"font-size":12});a.stopPropagation()})};that.createDataControls=function(){that.dataBar=d3.select("#dataControl").append("span").attr("id",
"wgcnaDataControls").style("margin-left","10px").style("margin-right","5px").append("table").append("tr");var a=that.dataBar.append("td");a.append("text").text("Data Source:");var d=a.append("select").attr("id","wgcnaSourceSelect").on("change",function(){$("#singleWGCNASVG").hide();d3.select("#multiWGCNASVG").remove();$("#circosModule").hide();$("#wgcnaModuleTable").hide();$("#wgcnaMirTable").hide();$("#wgcnaMirGeneTable").hide();$("#wgcnaGoTable").hide();$("#wgcnaEqtlTable").hide();that.selSource=
$("#wgcnaSourceSelect").val();that.tissue=$("#wgcnaTissueSelect").val();"array"===that.selSource?($("span#spanVersion").hide(),"Whole Brain"===that.tissue?that.wDSID=3:"Heart"===that.tissue?that.wDSID=4:"Liver"===that.tissue&&(that.wDSID=5),d3.select("#wgcnaTissueSelect").append("option").attr("value","Heart").text("Heart")):"seq"===that.selSource&&($("span#spanVersion").show(),"Whole Brain"===that.tissue?(that.wDSID=11,"2"===that.version?that.wDSID=8:"1"===that.version&&(that.wDSID=6)):"Liver"===
that.tissue?(that.wDSID=12,"2"===that.version?that.wDSID=9:"1"===that.version&&(that.wDSID=7)):(that.wDSID=11,that.version="5",d3.select("#wgcnaTissueSelect").select('option[value="Brain"]').attr("selected","selected"),d3.select("#wgcnaVersionSelect").select('option[value="2"]').attr("selected","selected")),d3.select("#wgcnaTissueSelect").select('option[value="Heart"]').remove());that.requestModuleList()});that.sources=["array"];that.dispSources=["Arrays"];"Rn"===organism&&"rn6"===genomeVer&&(that.sources=
["seq","array"],that.dispSources=["RNA-Seq","Arrays"]);for(var c=0;c<that.sources.length;c++)d.append("option").attr("value",that.sources[c]).text(that.dispSources[c]);a.append("br");a.append("text").text("Tissue:");d=a.append("select").attr("id","wgcnaTissueSelect").on("change",function(){$("#singleWGCNASVG").hide();d3.select("#multiWGCNASVG").remove();$("#circosModule").hide();$("#wgcnaModuleTable").hide();$("#wgcnaMirTable").hide();$("#wgcnaMirGeneTable").hide();$("#wgcnaGoTable").hide();$("#wgcnaEqtlTable").hide();
that.selSource=$("#wgcnaSourceSelect").val();that.tissue=$("#wgcnaTissueSelect").val();"array"===that.selSource?"Whole Brain"===that.tissue?that.wDSID=3:"Heart"===that.tissue?that.wDSID=4:"Liver"===that.tissue&&(that.wDSID=5):"seq"===that.selSource&&("Whole Brain"===that.tissue?(that.wDSID=11,"2"===that.version?that.wDSID=8:"1"===that.version&&(that.wDSID=6)):"Liver"===that.tissue&&(that.wDSID=12,"2"===that.version?that.wDSID=9:"1"===that.version&&(that.wDSID=7)));that.requestModuleList()});that.tissues=
["Brain"];that.dispTissues=["Whole Brain"];"Rn"===organism&&"rn6"===genomeVer&&(that.source&&"arrays"===that.source?(that.tissues=["Whole Brain","Heart","Liver"],that.dispTissues=["Whole Brain","Heart","Liver"]):(that.tissues=["Whole Brain","Liver"],that.dispTissues=["Whole Brain","Liver"]));for(c=0;c<that.tissues.length;c++)d.append("option").attr("value",that.tissues[c]).text(that.dispTissues[c]);a.append("br");c=a.append("span").attr("id","spanVersion");c.append("text").text("Version:");d=c.append("select").attr("id",
"wgcnaVersionSelect").on("change",function(){that.version=$("#wgcnaVersionSelect").val();"Whole Brain"===that.tissue?(that.wDSID=11,"2"===that.version?that.wDSID=8:"1"===that.version&&(that.wDSID=6)):"Liver"===that.tissue&&(that.wDSID=12,"2"===that.version?that.wDSID=9:"1"===that.version&&(that.wDSID=7));that.requestModuleList()});that.ver=["5","2","1"];that.dispVer=["HRDP v5","HRDP v4","HRDP v3"];for(c=0;c<that.ver.length;c++)d.append("option").attr("value",that.ver[c]).text(that.dispVer[c]);d3.select("#wgcnaVersionSelect").select('option[value="'+
that.version+'"]').attr("selected","selected");a.append("br");c=a.append("span").attr("id","spanReturnType");c.append("text").text("Module selection by:");d=c.append("select").attr("id","wgcnaModuleSelect").on("change",function(){that.modSelect=$("#wgcnaModuleSelect").val();that.requestModuleList();"eQTL"===that.modSelect?$("#spaneQTLCutoff").show():$("#spaneQTLCutoff").hide()});c.append("text").text("in this region");a.append("br");a=a.append("span").attr("id","spaneQTLCutoff").style("display","none");
a.append("text").text("eQTL Cutoff P-value:");var g=["gene","eQTL"],e=["genes","module Eigengene QTL"];for(c=0;c<g.length;c++)d.append("option").attr("value",g[c]).text(e[c]);d3.select("#wgcnaModuleSelect").select('option[value="'+that.modSelect+'"]').attr("selected","selected");$("span#spanReturnType").show();d=a.append("select").attr("id","wgcnaModuleEQTLCutoff").on("change",function(){that.modSelectCutoff=$("#wgcnaModuleEQTLCutoff").val();that.requestModuleList()});g=["1","2","3","4"];e=["0.1",
"0.01","0.001","0.0001"];for(c=0;c<g.length;c++)d.append("option").attr("value",g[c]).text(e[c]);d3.select("#wgcnaModuleEQTLCutoff").select('option[value="'+that.modSelectCutoff+'"]').attr("selected","selected");c=that.dataBar.append("td").append("div").attr("id","goCtls").attr("class","goCTL").style("display","none").style("margin-left","10px");c.append("text").text("GO Domain:");d=c.append("select").attr("id","goDomainSelect").on("change",function(){that.singleImage.goDomain=$("#goDomainSelect").val();
that.singleImage.draw();gtag("event","changeDomain",{event_category:"WGCNA_go"})});d.append("option").attr("value","cc").text("Cellular Component");d.append("option").attr("value","bp").text("Biological Process");d.append("option").attr("selected","selected").attr("value","mf").text("Molecular Function");c.append("br");c.append("text").text("Number of Levels to Display:");c.append("input").attr("name","value").attr("id","goSpinner");$("#goSpinner").spinner({min:1,max:100,step:1,change:function(h,
l){that.singleImage.displayDepth=l.value;that.singleImage.selectedNode!==that.singleImage.data.GOList[0]&&that.singleImage.selectedNode!==that.singleImage.data.GOList[1]&&that.singleImage.selectedNode!==that.singleImage.data.GOList[2]?that.singleImage.redraw():that.singleImage.draw();gtag("event","changeDepth",{event_category:"WGCNA_go"})},spin:function(h,l){that.singleImage.displayDepth=l.value;that.singleImage.selectedNode!==that.singleImage.data.GOList[0]&&that.singleImage.selectedNode!==that.singleImage.data.GOList[1]&&
that.singleImage.selectedNode!==that.singleImage.data.GOList[2]?that.singleImage.redraw():that.singleImage.draw();gtag("event","changeDepth",{event_category:"WGCNA_go"})}}).val(3);c=that.dataBar.append("td").append("div").attr("id","mirCtls").attr("class","mirCTL").style("display","none").style("margin-left","10px");d=c.append("table").append("tr");c.append("text").style("font-weight","bold").text("Filter miRNAs:");c.append("br");c.append("input").attr("type","checkbox").style("margin-right","5px").attr("id",
"mirValidatedCBX").on("click",function(){$(this).is(":checked")?that.singleImage.mirValid=1:that.singleImage.mirValid=0;that.singleImage.drawMiR();gtag("event","changeValidated",{event_category:"WGCNA_mir"})});c.append("text").text("only miRNAs with Validated Targets");c.append("br");c.append("text").style("margin-right","5px").text("# of targeted Genes: ");c.append("div").attr("id","minMirGeneSlider").style("display","inline-block").style("width","150px");c.append("span").attr("id","minMirGeneLabel").style("margin-left",
"5px").append("text").text("1");c.append("br");c.append("text").style("margin-right","5px").text("miRNAs targeting gene: ");c.append("input").attr("type","text").attr("id","mirGeneFilterTxt").on("keyup",function(h){that.singleImage.mirTargetID=$(this).val().toLowerCase();that.singleImage.drawMiR();gtag("event","geneFilter",{event_category:"WGCNA_mir"})});c.append("br");c.append("text").style("margin-right","5px").text("miRNA(ID or Accession): ");c.append("input").attr("type","text").attr("id","mirIDFilterTxt").on("keyup",
function(h){that.singleImage.mirID=$(this).val().toLowerCase();that.singleImage.drawMiR();gtag("event","geneFilter",{event_category:"WGCNA_mir"})});c=that.dataBar.append("td").append("div").attr("id","mirCtls2").attr("class","mirCTL").style("display","none").style("margin-left","10px");c.append("text").style("font-weight","bold").text("Display Options:");c.append("br");c.append("input").attr("type","checkbox").attr("id","mirSortCBX").style("margin-right","5px").on("click",function(){$(this).prop("checked")?
that.singleImage.sortMir=$("#mirSortSelect").val():that.singleImage.sortMir=0;that.singleImage.drawMiR();gtag("event","mirSort",{event_category:"WGCNA_mir"})});c.append("text").text("Hovering over a node(miR or transcript):");c.append("br");c.append("input").attr("type","checkbox").attr("id","mirLinkCBX").attr("checked","checked").style("margin-left","12px").style("margin-right","3px").on("click",function(){$(this).prop("checked")?that.singleImage.showMirLinks=1:that.singleImage.showMirLinks=0;gtag("event",
"showLinks",{event_category:"WGCNA_mir"})});c.append("text").text("Display links between miRNAs and targeted transcripts");c.append("br");c.append("input").attr("type","checkbox").attr("id","mirgeneLinkCBX").style("margin-left","12px").style("margin-right","3px").on("click",function(){$(this).prop("checked")?(that.singleImage.showLinks=0,$("div#mirLinkColorSelect").show()):(that.singleImage.showLinks=1,$("div#mirLinkColorSelect").hide());that.singleImage.setupLegend();gtag("event","linkColor",{event_category:"WGCNA_mir"})});
c.append("text").text("Display links between correlated transcripts");d=c.append("div").attr("id","mirLinkColorSelect").style("display","none");d.append("text").style("margin-left","24px").text("Correlation Link Color Options:");c=d.append("select").attr("id","mirlinkColor").on("change",function(){that.singleImage.updateColor("mirlinkColor");that.singleImage.setupLegend();gtag("event","linkColor",{event_category:"WGCNA_mir"})});c.append("option").attr("selected","selected").attr("value","Green_Red").text("Green(+) / Red(-)");
c.append("option").attr("value","Blue_Yellow").text("Blue(+) / Yellow(-)");c.append("option").attr("value","Red_Green").text("Red(+) / Green(-)");d.append("br");d.append("input").attr("type","checkbox").style("margin-left","24px").style("margin-right","3px").on("click",function(){$(this).prop("checked")?that.singleImage.showAllFromTarget=1:that.singleImage.showAllFromTarget=0;gtag("event","linkColor",{event_category:"WGCNA_mir"})});d.append("text").text("Display all cor. transcript links from targeted transcripts.");
$("#minMirGeneSlider").slider({min:1,max:100,step:1,value:1,slide:function(h,l){that.singleImage.mirGeneCutoff=l.value;$("span#minMirGeneLabel").html(l.value);that.singleImage.drawMiR();gtag("event","minMir",{event_category:"WGCNA_mir"})}});c=that.dataBar.append("td").append("div").attr("id","linkCtls").attr("class","linkCTL").style("display","none").style("margin-left","10px");c.append("text").text("Link Correlation Values");c.append("span").style("cursor","pointer").on("click",function(){$("#linkSliderMin").slider("value",
.75);that.singleImage.CorCutoff_min=.75;$("span#minLabel").html(.75);$("#linkSliderMax").slider("value",1);that.singleImage.CorCutoff_max=1;$("span#maxLabel").html(1);that.singleImage.draw();gtag("event","resetCorrelation",{event_category:"WGCNA_mir"})}).append("img").attr("src",contextRoot+"/web/images/icons/reset_16.png");a=c.append("table");d=a.append("tr");d.append("td").append("text").text("Min:");d.append("td").append("div").attr("id","linkSliderMin").style("width","100px");d.append("td").append("span").attr("id",
"minLabel").style("margin-left","5px").append("text").text("0.75");d=a.append("tr");d.append("td").append("text").text("Max:");d.append("td").append("div").attr("id","linkSliderMax").style("width","100px");d.append("td").append("span").attr("id","maxLabel").style("margin-left","5px").append("text").text("1");c.append("input").attr("type","checkbox").attr("id","hideLinkExceptNode").on("click",function(){that.singleImage.showLinks=!$(this).is(":checked");that.singleImage.draw();that.singleImage.panZoom=
svgPanZoom("#singleWGCNASVG",{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,minZoom:.1,maxZoom:4,fit:!0,center:!0})});c.append("text").text("Hide Links Except Selected Node");d=that.dataBar.append("td").append("div").attr("id","linkCtl2").attr("class","linkCTL").style("display","none").style("margin-left","10px");d.append("text").text("Correlation Link Color Options:");d.append("br");d=d.append("select").attr("id","linkColor").on("change",function(){that.singleImage.draw();
that.singleImage.panZoom=svgPanZoom("#singleWGCNASVG",{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,minZoom:.1,maxZoom:4,fit:!0,center:!0})});d.append("option").attr("selected","selected").attr("value","Green_Red").text("Green(+) / Red(-)");d.append("option").attr("value","Blue_Yellow").text("Blue(+) / Yellow(-)");d.append("option").attr("value","Red_Green").text("Red(+) / Green(-)");$("#linkSliderMin").slider({min:.05,max:.95,step:.05,value:.75,
slide:function(h,l){that.singleImage.CorCutoff_min=l.value;$("span#minLabel").html(l.value);that.singleImage.draw()}});$("#linkSliderMax").slider({min:.1,max:1,step:.05,value:1,slide:function(h,l){that.singleImage.CorCutoff_max=l.value;$("span#maxLabel").html(l.value);that.singleImage.draw()}});c=that.dataBar.append("td").append("div").attr("class","eqtlCtls").attr("id","eqtlCtl").style("display","none").style("margin-left","10px");c.append("text").text("Select Chromosomes");c.append("br");d=c.append("select").attr("id",
"eqtlChr").attr("multiple","multiple").attr("size","4").style("width","100px");for(c=1;c<=that.chrLen;c++)d.append("option").attr("selected","selected").attr("value",organism.toLowerCase()+c).text("chr"+c);d.append("option").attr("selected","selected").attr("value",organism.toLowerCase()+"X").text("chrX");c=that.dataBar.append("td").append("div").attr("class","eqtlCtls").attr("id","eqtlCtl2").style("display","none").style("margin-left","10px");c.append("text").text("P-value cutoff:");d=c.append("select").attr("id",
"eqtlPval");d.append("option").attr("value","1").text("0.1");d.append("option").attr("selected","selected").attr("value","2").text("0.01");d.append("option").attr("value","3").text("0.001");d.append("option").attr("value","4").text("0.0001");d.append("option").attr("value","5").text("0.00001");c.append("br");c.append("br");c.append("br");c.append("br");c.append("input").attr("type","button").attr("value","Apply Selections").on("click",function(){for(var h=$("#eqtlPval").val(),l=$("#eqtlChr").val(),
n="",q=0;q<l.length;q++)n=n+l[q]+";";$.ajax({url:pathPrefix+"runCircosModule.jsp",type:"GET",async:!0,data:{cutoffValue:h,organism,module:that.selectedModule.MOD_NAME,modColor:that.selectedModule.ModRGB,chrList:n,genomeVer,tissue:that.tissue},dataType:"json",beforeSend:function(){$("#waitCircos").show()},success:function(u){$("#waitCircos").hide();that.singleImage.update(u.URL)},error:function(u,v,y){}})})};that.positionTTLeft=function(a){a+=20;a>$(window).width()/2&&(a-=250);return a+"px"};that.positionTTTop=
function(a){a+="px";d3.event.clientY>.6*window.innerHeight&&(a=d3.event.pageY-2.2*$(".testToolTip").height()+"px");return a};that.createMultiWGCNAImage=function(){that.multiImage=that.multiWGCNAImageGeneView();that.multiImage.draw();that.img=that.multiImage};that.multiWGCNAImage=function(){var a={maxWidth:200};a.totalWidth=$(window).width();a.modPerLine=Math.floor($(window).width()/a.maxWidth);a.calcWidth=Math.floor($(window).width()/a.modPerLine);a.data=[];if(0===d3.select("#multiWGCNASVG").size()){var d=
d3.select("#wgcnaGeneImage").append("div").attr("id","multiWGCNAScroll").style("overflow","auto").style("max-height","430px");a.svg=d.append("svg").attr("id","multiWGCNASVG").attr("height","430px").attr("width","100%");d=a.svg.append("linearGradient").attr("id","lgrad").attr("x1","11%").attr("y1","0%").attr("x2","89%").attr("y2","100%");d.append("stop").attr("offset","0%").attr("style","stop-color:rgb(153,218,255);stop-opacity:1");d.append("stop").attr("offset","100%").attr("style","stop-color:rgb(0,128,128);stop-opacity:1");
d=a.svg.append("linearGradient").attr("id","selectGrad").attr("x1","11%").attr("y1","0%").attr("x2","89%").attr("y2","100%");d.append("stop").attr("offset","0%").attr("style","stop-color:rgb(0,163,55);stop-opacity:1");d.append("stop").attr("offset","100%").attr("style","stop-color:rgb(0,75,20);stop-opacity:1")}else a.svg=d3.select("#multiWGCNASVG");a.modKey=function(c){return c.MOD_NAME};a.calcX=function(c,g){return g%a.modPerLine*a.calcWidth};a.calcY=function(c,g){return Math.floor(g/a.modPerLine)*
a.maxWidth};a.sizing=function(c){c=a.size(c.TCList.length);c>a.maxWidth/2&&(c=a.maxWidth/2);return c};a.zoomIn=function(){a.maxWidth<$(window).width()/2&&(a.maxWidth*=2,a.draw())};a.zoomOut=function(){var c=a.maxWidth;a.maxWidth=Math.floor(a.maxWidth/2);25>a.maxWidth?a.maxWidth=c:a.draw()};a.sortTCLenDesc=function(c,g){return g.TCList.length<c.TCList.length?-1:g.TCList.length>c.TCList.length?1:0};a.sortGeneInstanceDesc=function(c,g){return g.GeneCount<c.GeneCount?-1:g.GeneCount>c.GeneCount?1:a.sortTCLenDesc(c,
g)};a.draw=function(){};a.redraw=function(){};return a};that.multiWGCNAImageGeneView=function(){var a=that.multiWGCNAImage();a.createToolTip=function(d){var c="Module Name: "+d.MOD_NAME+"<BR>Transcript Size: "+d.TCList.length;"undefined"!==typeof d.GroupedGenes?(c=c+"<BR>Genes in Region/List: "+d.GroupedGenes,c=c+"<BR>Transcripts in Region/List: "+d.GeneCount):c=c+"<BR>Selected Gene Transcripts in Module: "+d.GeneCount;return c};a.draw=function(){"undefined"!==typeof that.selectedModule&&(a.maxWidth=
85);a.svg.selectAll(".modules").remove();a.svg.selectAll(".moduleGradient").remove();a.totalWidth=$(window).width();a.modPerLine=Math.floor($(window).width()/a.maxWidth);a.calcWidth=Math.floor($(window).width()/a.modPerLine);var d=[];a.dataList={};for(var c=0,g=0;g<that.moduleList.length;g++)if(("grey"!==that.moduleList[g]||"grey"===that.moduleList[g]&&0===that.skipGrey)&&"undefined"!==typeof that.modules[that.moduleList[g]]){d[c]=that.modules[that.moduleList[g]];var e=d[c].ModRGB.split(","),h="";
for(h=0;h<e.length;h++)e[h]-=70,0>e[h]&&(e[h]=0);h=e[0]+","+e[1]+","+e[2];e=a.svg.append("linearGradient").attr("id","grad"+d[c].MOD_NAME).attr("class","moduleGradient").attr("x1","11%").attr("y1","0%").attr("x2","89%").attr("y2","100%");e.append("stop").attr("offset","0%").attr("style","stop-color:rgb("+d[c].ModRGB+");stop-opacity:1");e.append("stop").attr("offset","100%").attr("style","stop-color:rgb("+h+");stop-opacity:1");c++}c=a.maxWidth+15;d.length>a.modPerLine&&(g=Math.floor(d.length/a.modPerLine),
0<d.length%a.modPerLine&&g++,c*=g);a.svg.attr("height",c+"px");d.sort(a.sortGeneInstanceDesc);a.data=d;for(g=0;g<d.length;g++)a.dataList[d[g].MOD_NAME]=g;c=d3.min(d,function(l){return l.TCList.length});g=d3.max(d,function(l){return l.TCList.length});a.size=d3.scaleLinear().domain([c,g]).range([10,a.maxWidth/2]);d=a.svg.selectAll(".modules").data(d,a.modKey).attr("transform",function(l,n){return"translate("+a.calcX(l,n)+","+a.calcY(l,n)+")"});d.enter().append("g").attr("class","modules").attr("id",
function(l){return l.MOD_NAME}).attr("transform",function(l,n){return"translate("+a.calcX(l,n)+","+a.calcY(l,n)+")"}).merge(d).each(function(l){var n=d3.select("g#"+l.MOD_NAME);n.append("circle").attr("cx",a.calcWidth/2).attr("cy",a.maxWidth/2).attr("r",a.sizing).attr("stroke",function(q){var u="#FFFFFF";"undefined"!==typeof that.selectedModule&&that.selectedModule===q&&(u="#000000");return u}).attr("stroke-width",function(q){var u="1px";"undefined"!==typeof that.selectedModule&&that.selectedModule===
q&&(u="3px");return u}).attr("fill",function(q){var u="url(#grad"+q.MOD_NAME+")";"undefined"!==typeof that.selectedModule&&that.selectedModule===q&&(u="url(#selectGrad)");return u}).on("click",function(){a.maxWidth=85;that.selectedModule=l;a.draw();d3.select("#multiWGCNAScroll").style("max-height","110px");a.svg.select("g#"+l.MOD_NAME).style("background","#CECECE");a.svg.select("g#"+l.MOD_NAME).select("circle").attr("fill","url(#selectGrad)").attr("stroke","#000000").attr("stroke-width","3px");a.svg.select("g#"+
l.MOD_NAME).select("text.txtLbl").style("font-weight","bold");that.selectedGene={};for(var q=0;q<l.TCList.length;q++)"undefined"===typeof that.selectedGene[l.TCList[q].Gene.ID]&&(that.selectedGene[l.TCList[q].Gene.ID]={},that.selectedGene[l.TCList[q].Gene.ID].geneSymbol=l.TCList[q].Gene.geneSymbol,that.selectedGene[l.TCList[q].Gene.ID].tcList=[]),that.selectedGene[l.TCList[q].Gene.ID].tcList.push(l.TCList[q]);setTimeout(that.createSingleWGCNAImage,20)}).on("mouseover",function(){$("#wgcnaMouseHelp").html("<B>Click</B> to select this module and see additional details.");
d3.select(this).style("fill","url(#selectGrad)");tt.transition().duration(200).style("opacity",1);tt.html(a.createToolTip(l)).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",function(){return that.positionTTTop(d3.event.pageY)})}).on("mouseout",function(){var q=d3.select(this).data()[0];"undefined"!==typeof that.selectedModule&&q.MOD_NAME===that.selectedModule.MOD_NAME||d3.select(this).style("fill","url(#grad"+q.MOD_NAME+")");tt.transition().duration(500).style("opacity",
0)});"undefined"!==typeof that.selectedModule&&that.selectedModule===l?n.append("text").attr("class","txtLbl").attr("y",a.maxWidth+12).attr("x",function(q){return a.calcWidth/2-q.MOD_NAME.length/2*6.5}).style("font-weight","bold").text(replaceUnderscore(l.MOD_NAME)):6.5*l.MOD_NAME.length<a.calcWidth&&n.append("text").attr("class","txtLbl").attr("y",a.maxWidth+12).attr("x",function(q){return a.calcWidth/2-q.MOD_NAME.length/2*6.5}).text(replaceUnderscore(l.MOD_NAME));n.append("text").attr("y",a.maxWidth/
2+5).attr("x",a.calcWidth/2-3).attr("pointer-events","none").attr("fill",function(q){var u="#000000";q=q.ModRGB.split(",");360>q[0]+q[1]+q[2]&&(u="#FFFFFF");return u}).text(function(q){var u=q.GeneCount;"undefined"!==typeof q.GroupedGenes&&(u=q.GroupedGenes);return u})})};a.backModule=function(){if(that.selectedModule){var d=a.dataList[that.selectedModule.MOD_NAME];if(0<d){d=a.data[d-1];var c=a.svg.select("g#"+that.selectedModule.MOD_NAME);c.select("circle").attr("fill","url(#grad"+that.selectedModule.MOD_NAME+
")").attr("stroke","#FFFFFF").attr("stroke-width","1px");c.select("text.txtLbl").style("font-weight","normal");that.selectedModule=d;d=a.svg.select("g#"+d.MOD_NAME);d.select("circle").attr("fill","url(#selectGrad)").attr("stroke","#000000").attr("stroke-width","3px");d.select("text.txtLbl").style("font-weight","bold");setTimeout(that.createSingleWGCNAImage,20)}}};a.forwardModule=function(){if(that.selectedModule){var d=a.dataList[that.selectedModule.MOD_NAME];if(d<a.data.length-1){d=a.data[d+1];var c=
a.svg.select("g#"+that.selectedModule.MOD_NAME);c.select("circle").attr("fill","url(#grad"+that.selectedModule.MOD_NAME+")").attr("stroke","#FFFFFF").attr("stroke-width","1px");c.select("text.txtLbl").style("font-weight","normal");that.selectedModule=d;d=a.svg.select("g#"+d.MOD_NAME);d.select("circle").attr("fill","url(#selectGrad)").attr("stroke","#000000").attr("stroke-width","3px");d.select("text.txtLbl").style("font-weight","bold");setTimeout(that.createSingleWGCNAImage,20)}}};return a};that.createSingleWGCNAImage=
function(){d3.select("#viewGene").remove();d3.select("#circos").remove();$("#wgcnaresetImage").show();$("#wgcnazoomInImage").show();$("#wgcnazoomOutImage").show();"gene"===that.viewType?($("#linkSliderMin").slider("value",.01),$("span#minLabel").html(.01),$("#linkSliderMax").slider("value",1),$("span#maxLabel").html(1),$("#hideLinkExceptNode").prop("checked",!1),setTimeout(function(){that.singleImage=that.singleWGCNAImageGeneView(that.modules);that.singleImage.draw();that.img=that.singleImage;that.singleWGCNATableGeneView();
setTimeout(function(){that.singleImage.panZoom=svgPanZoom("#singleWGCNASVG",{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,minZoom:.1,maxZoom:4,fit:!0,center:!0})},500)},50)):"go"===that.viewType?($("#wgcnaresetImage").hide(),$("#wgcnazoomInImage").hide(),$("#wgcnazoomOutImage").hide(),$("#goDomainSelect").val("mf"),$("#goSpinner").val(3),setTimeout(function(){that.singleImage=that.singleWGCNAImageGoView(that.modules);that.singleImage.goDomain=
$("#goDomainSelect").val();that.singleImage.draw();that.img=that.singleImage},50)):"eqtl"===that.viewType?($("#eqtlChr option").prop("selected",!0),$("#eqtlPval").val(2),setTimeout(function(){that.singleImage=that.singleWGCNAImageEQTLView(that.modules);that.singleImage.displayDefault();that.img=that.singleImage},50)):"mir"===that.viewType?($("#mirValidatedCBX").prop("checked",!1),$("#minMirGeneSlider").slider("value",1),$("span#minMirGeneLabel").html(1),$("#mirGeneFilterTxt").val(""),$("#mirIDFilterTxt").val(""),
$("#mirSortCBX").prop("checked",!1),$("#mirLinkCBX").prop("checked",!0),$("#mirgeneLinkCBX").prop("checked",!1),$("div#mirLinkColorSelect").hide(),setTimeout(function(){that.singleImage=that.singleWGCNAImageGeneView(that.modules);that.singleImage.draw();that.img=that.singleImage;setTimeout(function(){that.singleImage.panZoom=svgPanZoom("#singleWGCNASVG",{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,minZoom:.1,maxZoom:4,fit:!0,center:!0})},500)},
50)):"meta"===that.viewType&&setTimeout(function(){that.singleImage=that.singleWGCNAImageMetaView(that.modules);that.singleImage.requestMeta();that.img=that.singleImage;setTimeout(function(){that.singleImage.panZoom=svgPanZoom("#singleWGCNASVG",{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,minZoom:.1,maxZoom:4,fit:!0,center:!0})},500)},50);gtag("event",that.viewType,{event_category:"changedWGCNAView"})};that.singleWGCNAImage=function(){var a={};
a.width=$(window).width();a.height=Math.floor(.9*window.innerHeight);a.r=a.height>a.width?Math.floor(a.width/2*.95):Math.floor(a.height/2*.95);a.maxPerLevel=150;a.CorCutoff_min=.75;a.CorCutoff_max=1;a.showLinks=!0;a.data=[];a.maxNodeR=28;a.negColor="#DD0000";a.negDarkColor="#770000";a.posColor="#00DD00";a.posDarkColor="#007700";a.mirVal="#FFFF00";a.mirPred="#0000CC";0===d3.select("#singleWGCNASVG").size()?a.svg=d3.select("#wgcnaGeneImage").append("div").attr("id","viewGene").append("svg").attr("id",
"singleWGCNASVG").attr("height",a.height+"px").attr("width","100%"):a.svg=d3.select("#singleWGCNASVG");a.geneKey=function(d){return d.ID};a.linkKey=function(d){return that.removeInvalidIDChars(d.TC1)+that.removeInvalidIDChars(d.TC2)};a.calcX=function(d,c){return c%a.modPerLine*a.calcWidth};a.calcY=function(d,c){return Math.floor(c/a.modPerLine)*a.maxWidth};a.sizing=function(d){d=a.size(d.TCList.length);d>a.maxWidth/2&&(d=a.maxWidth/2);return d};a.colorCircle=function(d){d=d.Gene.ID;var c="#DFC184";
if(0==d.indexOf("PRN")||0==d.indexOf("PMM")||0==d.indexOf("Unannotated"))"Whole Brain"===that.tissue?c="#7EB5D6":"Heart"===that.tissue?c="#DC7252":"Liver"===that.tissue&&(c="#bbbedd");return c};a.colorLink=function(d){var c=a.negColor;0<d.Cor&&(c=a.posColor);return c};a.colorLinkHighlight=function(d){var c=a.negDarkColor;0<d.Cor&&(c=a.posDarkColor);return c};a.updateColor=function(d){d=$("#"+d).val();"Red_Green"===d?(a.posColor="#DD0000",a.posDarkColor="#770000",a.negColor="#00DD00",a.negDarkColor=
"#007700",a.mirVal="#FFFF00",a.mirPred="#0000CC"):"Blue_Yellow"===d?(a.posColor="#0000DD",a.posDarkColor="#000077",a.negColor="#ffef16",a.negDarkColor="#b7ae2a",a.mirVal="#FF9C2A",a.mirPred="#BA49FF"):(a.negColor="#DD0000",a.negDarkColor="#770000",a.posColor="#00DD00",a.posDarkColor="#007700",a.mirVal="#FFFF00",a.mirPred="#0000CC")};a.nodeRadiusSum=function(d,c){d=3+20*d.LinkSum;d>a.maxNodeR&&(d=a.maxNodeR);return d};a.zoomIn=function(){a.maxWidth<$(window).width()/2&&(a.maxWidth*=2,a.draw())};a.zoomOut=
function(){var d=a.maxWidth;a.maxWidth=Math.floor(a.maxWidth/2);25>a.maxWidth?a.maxWidth=d:a.draw()};a.draw=function(){};a.redraw=function(){};a.setupLegend=function(){a.svg.select("#legend").remove();a.svg.select("#legendDisp").remove();a.legendG=a.svg.append("g").attr("id","legend").attr("transform","translate(10,60)").style("cursor","pointer").on("mouseover",function(){a.legendDispG.transition().duration(300).style("opacity",1);gtag("event","viewLegend",{event_category:"wgcna"})}).on("mouseleave",
function(){a.legendDispG.transition().duration(300).style("opacity",0)});a.legendG.append("image").attr("x",0).attr("y",-20).attr("width","24px").attr("height","24px").attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAJI0lEQVRIDQEYCef2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABVVVVAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAq6ur/wAAAP4AAAAAAQAAAAAAAAAAAAAAAFtynWv/AgFSAP//BAEBAgAAAP8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/95/Plx4sH/fPbq6ur8QQAAAAAAAAAAEBAQAT/AgOLAQEACQABAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAgAJDRgG/O7xiAAAAMkEAAAAAAAAAADz8/MB/vv1pgMEBVb///4JAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//Pb+/fLiJgAAAB8AAADJBAAAAAAAAAAADQ0N//nivJACAgLfAQEBOwEBARH///8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/gAAAOoAAADxAAAAAAQAAAAAAAAAAMDAwPxAQEDkEhISuv///9wCAgIN////AQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////4AAADxAAAA2AAAAAAEAAAAAAAAAAAAAAAAFS1XJgQDAk4B//wK/gD9BQIAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//fro+OXExvj4+O8AAAAABAAAAAAAAAAAAFVVAwUHCLcBAQESAAAHAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8A/wYTKxsC79eVAAAA1QIAAAAAAAAAADPe3gIA//3Z///+/AD//v7//v7///7+///+/v///v7///7+///+/v///v7///7+///+/v///v7///7+///+/v///v7///7+/wH++v/+9+k6////JgAAAAAEAAAAAAAAAAANDQ3/9+LCcwMIDGEB/vs1AAD/DgIBAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD+/fn9//v18wAAAAAAAAAABAAAAAAAAAAAwMDA/UZGRt0N/g2q/wAA0gEBAQ39AAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////gAAAPD////YAAAAAAQAAAAAAAAAAAAAAP8LIkUAAwT9AwD8+uoCAP/x////AQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP779vD+8d3a/f395QAAAAAEAAAAAAAAAAAAAAABCQwVtQEBADQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/4+gABewTw260AAADzAgAAAAAAAAAAM2ZmBAEA/xsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8BBwD++FYBAQErAAAAAAQAAAAAAAAAAADNzQD5MRBsAwIIagD++igAAP4K////AQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAH7+PwA9+gIAAAADAAAAAAEAAAAAAAAAADNzc39FxcXzQYGBqACAgIwAgICDv///wIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAf/////+AAAA7gICAuAAAAAABAAAAAAAAAAAAAAA/uHh4ecfHx+8AwMDzAYGBgb+/v4BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/f39/wMDA/j29vboAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAA/gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAApkUqF3zKmm8AAAAASUVORK5CYII=");
a.legendG.append("text").attr("x","25").style("font-size","18").text("Legend");a.legendDispG=a.svg.append("g").attr("id","legendDisp").attr("transform","translate(10,70)").style("opacity",1);a.drawLegend();setTimeout(function(){a.legendDispG.transition().duration(750).style("opacity",0)},8E3)};a.drawLegend=function(){};a.createToolTip=function(d){var c="Gene: "+d.Gene.geneSymbol+" ("+d.Gene.ID+")<BR><BR>Transcript:"+d.ID+"<BR>";c=c+"<BR>Link Count:"+d.LinkCount;c=c+"<BR>Link Sum:"+d.LinkSum.toFixed(2);
var g=that.selectedGene[d.Gene.ID].tcList;if(1<g.length){"<BR><BR>Additional Transcripts in this Module:<BR>";g=that.selectedGene[d.Gene.ID].tcList;for(var e=0;e<g.length;e++)g[e].ID!==d.ID&&(c=c+g[e].ID+"<BR>")}d.PSList&&"array"===that.selSource&&(c=c+"<BR><BR>"+d.PSList.length+" Probe Sets in Transcript<BR>");return c};return a};that.singleWGCNAImageGeneView=function(){var a=that.singleWGCNAImage();$(".goCTL").hide();$(".eqtlCtls").hide();if("gene"===that.viewType)$(".linkCTL").show(),$(".mirCTL").hide(),
a.showMirLinks=0;else{$(".mirCTL").show();$(".linkCTL").hide();a.showLinks=1;a.geneList={};a.geneMirList={};for(var d=that.selectedModule.TCList,c=0;c<d.length;c++)a.geneList[that.selectedModule.TCList[c].Gene.ID]=that.selectedModule.TCList[c].Gene.geneSymbol;a.showMirLinks=1;a.showAllFromTarget=0}a.CorCutoff_min=.75;a.CorCutoff_max=1;a.type=that.viewType;a.truncated=0;a.filterOneDB=1;a.mirGeneCutoff=1;a.mirValid=0;a.mirTargetID="";a.mirID="";a.miRcolor=d3.scaleOrdinal(d3.schemeCategory20b);a.sortMir=
0;a.maxCorWidth=5;a.drawLinks=function(g){"gene"===that.viewType?a.updateColor("linkColor"):"mir"===that.viewType&&a.updateColor("mirlinkColor");a.svg.selectAll(".link").remove();for(var e=that.selectedModule.LinkList,h=[],l=0,n=0;n<e.length;n++)(e[n].TC1===g.ID||e[n].TC2===g.ID)&&a.CorCutoff_min<=Math.abs(e[n].Cor)&&Math.abs(e[n].Cor)<=a.CorCutoff_max&&(h[l]=e[n],l++);e=h;1E4>e.length&&(g=a.topG.selectAll(".link").data(e,a.linkKey),g.enter().append("line").attr("class","link").attr("pointer-events",
"none").attr("id",function(q){return"ln_"+that.removeInvalidIDChars(q.TC1)+that.removeInvalidIDChars(q.TC2)}).attr("x1",function(q){return d3.select("#tc_"+that.removeInvalidIDChars(q.TC1)).attr("cx")}).attr("y1",function(q){return d3.select("#tc_"+that.removeInvalidIDChars(q.TC1)).attr("cy")}).attr("x2",function(q){return d3.select("#tc_"+that.removeInvalidIDChars(q.TC2)).attr("cx")}).attr("y2",function(q){return d3.select("#tc_"+that.removeInvalidIDChars(q.TC2)).attr("cy")}).attr("stroke",a.colorLink).attr("stroke-width",
function(q){return Math.abs(q.Cor)*a.maxCorWidth}).merge(g))};a.drawLinksBetween=function(g){for(var e={},h=0;h<g.length;h++)e[g[h]]=1;"gene"===that.viewType?a.updateColor("linkColor"):"mir"===that.viewType&&a.updateColor("mirlinkColor");a.svg.selectAll(".link").remove();g=that.selectedModule.LinkList;h=[];for(var l=0,n=0;n<g.length;n++)(0===a.showAllFromTarget&&"undefined"!==typeof e[g[n].TC1]&&"undefined"!==typeof e[g[n].TC2]||1===a.showAllFromTarget&&("undefined"!==typeof e[g[n].TC1]||"undefined"!==
typeof e[g[n].TC2]))&&a.CorCutoff_min<=Math.abs(g[n].Cor)&&Math.abs(g[n].Cor)<=a.CorCutoff_max&&(h[l]=g[n],l++);g=h;1E4>g.length&&(e=a.svg.select("g.svg-pan-zoom_viewport").selectAll(".link").data(g,a.linkKey),e.enter().append("line").attr("class","link").attr("pointer-events","none").attr("id",function(q){return"ln_"+that.removeInvalidIDChars(q.TC1)+that.removeInvalidIDChars(q.TC2)}).attr("x1",function(q){return d3.select("#tc_"+that.removeInvalidIDChars(q.TC1)).attr("cx")}).attr("y1",function(q){return d3.select("#tc_"+
that.removeInvalidIDChars(q.TC1)).attr("cy")}).attr("x2",function(q){return d3.select("#tc_"+that.removeInvalidIDChars(q.TC2)).attr("cx")}).attr("y2",function(q){return d3.select("#tc_"+that.removeInvalidIDChars(q.TC2)).attr("cy")}).attr("stroke",a.colorLink).attr("stroke-width",function(q){return Math.abs(q.Cor)*a.maxCorWidth}).merge(e))};a.nodeX=function(g,e){g=50;var h=Math.floor(e/a.maxPerLevel)+1;1<h&&(g=60*h);return a.width/2+(a.r-g)*Math.cos(e%a.maxPerLevel*a.angle-1.57079633)};a.nodeY=function(g,
e){g=50;e>a.maxPerLevel&&(g=60*(Math.floor(e/a.maxPerLevel)+1));return a.height/2+(a.r-g)*Math.sin(e%a.maxPerLevel*a.angle-1.57079633)};a.nodeXLbl=function(g,e){e=e%a.maxPerLevel*a.angle-1.57079633;var h=1;if(Math.PI/2<e&&e<1.5*Math.PI){var l=0;"undefined"!==typeof g.Gene.geneSymbol&&(l=g.Gene.geneSymbol.length);h+=7.5*l}return a.width/2+(a.r+h)*Math.cos(e)};a.nodeYLbl=function(g,e){e=e%a.maxPerLevel*a.angle-1.57079633;var h=1;if(Math.PI/2<e&&e<1.5*Math.PI){var l=0;"undefined"!==typeof g.Gene.geneSymbol&&
(l=g.Gene.geneSymbol.length);h+=7.5*l}return a.height/2+(a.r+h)*Math.sin(e)};a.drawCorLegend=function(g){a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",g).text("Positive Correlation");a.legendDispG.append("rect").attr("x","0").attr("y",g-10).attr("width","30").attr("height","10").style("fill",a.posColor);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",g+20).text("Negative Correlation");a.legendDispG.append("rect").attr("x","0").attr("y",g+
10).attr("width","30").attr("height","10").style("fill",a.negColor);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",g+40).text("Lower Correlation");a.legendDispG.append("line").attr("x1","0").attr("y1",g+30).attr("x2","30").attr("y2",g+30).style("stroke","#000000").style("stroke-width","0");a.legendDispG.append("line").attr("x1","0").attr("y1",g+35).attr("x2","30").attr("y2",g+35).style("stroke","#000000").style("stroke-width","0.5");a.legendDispG.append("line").attr("x1",
"0").attr("y1",g+40).attr("x2","30").attr("y2",g+40).style("stroke","#000000").style("stroke-width","1");a.legendDispG.append("line").attr("x1","0").attr("y1",g+45).attr("x2","30").attr("y2",g+45).style("stroke","#000000").style("stroke-width","2");a.legendDispG.append("line").attr("x1","0").attr("y1",g+55).attr("x2","30").attr("y2",g+55).style("stroke","#000000").style("stroke-width","3");a.legendDispG.append("line").attr("x1","0").attr("y1",g+65).attr("x2","30").attr("y2",g+65).style("stroke","#000000").style("stroke-width",
"5");a.legendDispG.append("line").attr("x1","0").attr("y1",g+75).attr("x2","30").attr("y2",g+75).style("stroke","#000000").style("stroke-width","7");a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",g+80).text("Higher Correlation")};a.drawMirSupportLegend=function(g){a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",g).text("Validated miRNA Target");a.legendDispG.append("rect").attr("x","0").attr("y",g-10).attr("width","30").attr("height","10").style("fill",
a.mirVal);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",g+20).text("Predicted miRNA Target");a.legendDispG.append("rect").attr("x","0").attr("y",g+10).attr("width","30").attr("height","10").style("fill",a.mirPred);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",g+40).text("Lower support of targeting");a.legendDispG.append("line").attr("x1","0").attr("y1",g+30).attr("x2","30").attr("y2",g+30).style("stroke","#000000").style("stroke-width",
"0");a.legendDispG.append("line").attr("x1","0").attr("y1",g+35).attr("x2","30").attr("y2",g+35).style("stroke","#000000").style("stroke-width","0.5");a.legendDispG.append("line").attr("x1","0").attr("y1",g+40).attr("x2","30").attr("y2",g+40).style("stroke","#000000").style("stroke-width","1");a.legendDispG.append("line").attr("x1","0").attr("y1",g+45).attr("x2","30").attr("y2",g+45).style("stroke","#000000").style("stroke-width","2");a.legendDispG.append("line").attr("x1","0").attr("y1",g+55).attr("x2",
"30").attr("y2",g+55).style("stroke","#000000").style("stroke-width","3");a.legendDispG.append("line").attr("x1","0").attr("y1",g+65).attr("x2","30").attr("y2",g+65).style("stroke","#000000").style("stroke-width","5");a.legendDispG.append("line").attr("x1","0").attr("y1",g+75).attr("x2","30").attr("y2",g+75).style("stroke","#000000").style("stroke-width","7");a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",g+80).text("Higher support of targeting")};a.drawLegend=function(){"gene"===
that.viewType?a.drawCorLegend(20):(a.drawMirSupportLegend(20),a.showLinks||a.drawCorLegend(130))};a.draw=function(){"mir"===that.viewType?(a.requestMiR(),a.updateColor("mirlinkColor")):"gene"===that.viewType&&a.updateColor("linkColor");a.width=$(window).width();a.height=Math.floor(.9*window.innerHeight);a.r=a.height>a.width?Math.floor(a.width/2*.95):Math.floor(a.height/2*.95);a.svg.attr("height",a.height+"px");a.svg.selectAll("circle").remove();a.svg.selectAll("text").remove();a.svg.selectAll("line").remove();
a.svg.selectAll(".geneTC").remove();"undefined"!==typeof a.panZoom&&(a.panZoom.destroy(),delete a.panZoom);a.svg.selectAll(".svg-pan-zoom_viewport").remove();setTimeout(function(){a.svg.append("text").style("font-size","20").attr("y",22).attr("x",5).text(function(){return that.selectedModule?replaceUnderscore(that.selectedModule.MOD_NAME):""});a.setupLegend();a.data=that.selectedModule.TCList;a.angle=2*Math.PI/a.data.length;a.angleDeg=360/a.data.length;a.data.length>a.maxPerLevel&&(a.angle=2*Math.PI/
a.maxPerLevel,a.angleDeg=360/a.maxPerLevel);a.data.sort(function(n,q){return n.LinkSum===q.LinkSum?0:n.LinkSum>q.LinkSum?-1:1});if(150<a.data.length){a.truncated=1;a.maxNodeR=15;for(var g=[],e=0;150>e;e++)g[e]=a.data[e];a.data=g;a.dataIndex={};for(e=0;e<a.data.length;e++)a.dataIndex[a.data[e].ID]=1;a.CorCutoff_min=.85;$("#linkSliderMin").slider("value",.85);$("span#minLabel").html(.85);a.svg.append("image").attr("x",7.8*that.selectedModule.MOD_NAME.length+20).attr("y",1).attr("width","24px").attr("height",
"24px").attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAJI0lEQVRIDQEYCef2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAAH/gAACcAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAADwAAALkCAABoFDEx0gIzM+/b29v4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGIAAAAvAgAAHDnn54QGBgY3SUlJBwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8AAB0AAAChAAAADAAAAAAU9vYY4RER/ecNDdLZ2dnvAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB5AAAAFgAAAAAAAAAABv7+BFHZ2UgFAgI4Ozs7DAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAtAAAAmAAAAAQAAAAAAAAAAAAAAAAU9/cM7AoKAOYYGNTZ2dnqAAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAFAAAAnQAAACf8AgIAzhgY/uIODv4V9vYBBP//AR3z8xrKHBzjDhwc2uDg4PYAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASwAAAEUAAAAB+AMDAJwyMveSODjT9QUF+AAAAAAY9PQOTN3dTxISEipAQEAEAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAADAAAAIAAAAAEAAAAAAAAAAAC/v7vAv7+tQn7+/IAAAAAAAAAAT/g4DQd8/NHCgoKFAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGcAAAAuAAAAAAAAAAAAAAAAAAEB+gP//+QF///7AAAAAAAAAAAQ+voIVtfXUggICDM5OTkJAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAP8AABYAAAB4AAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAATXm5iYt6+tMExMTHAAAAAEAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB7AAAAEwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAF/v4CVdfXSw0EBDdAQEALAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAD/AAAzAAAAkwAAAAYAAAAAAAAAAAAAAAAAAQEAAAAA/kDh4QAb8/MpAgAACAAAAAAAAAAAAAAAABT29g7vCAgB4RYW1NnZ2eoAAAD/AAAAAAAAAAAAAAAAAAAAAAD/AAAE/wAAtf8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD/5Q0N7WNKSnFHR0cSAAAAAAAAAAADAAAAAAAAAAAAAAAAgAAATAAAAHkAAAADAAAAAAAAAAAAAAAAAAAAAPgEBP+XMzP7xR8f7ivq6gcH/f0CAAAAAAAAAAAAAAAAAAAAAAz6+gj9AgIM2Bsb0QoKCujn5+f+AgAAAAAAAAAA/wAABwAAAIkAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAD9AQEA1hUV9MwZGccAAAD2AAAAAAAAAAAAAAAAAAAAAAAAAAABAAABR97eNhb390ceHh4RAAAAAAAAAAAAAAAAAP8AAG//AAD+/wAA//8AAP//AAD//wAA//8AAP//AAD//gAA/u4ICPvzBQXw/gAA/P8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP/CHR3SVVBQNgAAAAACAAAAAP8AAAgAAABfAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAER+PgEDPv7DwEAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMOnpJyHy8icAAAAABAAAAAABAAD42BMTgdUTE2buCwsz/QICCQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8BAAD/AAEBAf8AAAEAAAAAAAAAAAAAAAAAAAAAAAAAAPEHB/vhEBANAAAAAAQAAAAAAAAAAHU6OrsDAwPnAgICIQEBAQUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQH//f39zgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAs0IPw6I24JoAAAAASUVORK5CYII=").attr("pointer-events",
"all").style("cursor","pointer").on("mouseover",function(){$("#wgcnaMouseHelp").html("Warning: Transcripts displayed are truncated to the top 150 most connected transcripts due to the size of the module.")}).on("mouseout",function(){$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")})}else a.maxNodeR=28;a.topG=a.svg.append("g").attr("class","svg-pan-zoom_viewport");if("gene"===that.viewType){g=a.topG.selectAll(".geneTC").data(a.data,a.geneKey);
g.enter().append("circle").attr("class","geneTC").attr("id",function(n){return"tc_"+that.removeInvalidIDChars(n.ID)}).attr("cx",a.nodeX).attr("cy",a.nodeY).attr("r",3).attr("stroke","#000000").attr("fill","#FF0000").merge(g);g=that.selectedModule.LinkList;e=[];for(var h=0,l=0;l<g.length;l++)a.CorCutoff_min<=Math.abs(g[l].Cor)&&Math.abs(g[l].Cor)<=a.CorCutoff_max&&(0===a.truncated||"undefined"!==typeof a.dataIndex[g[l].TC1]&&"undefined"!==typeof a.dataIndex[g[l].TC2])&&(e[h]=g[l],h++);g=e;a.showLinks&&
1E4>g.length&&a.topG.selectAll(".link").data(g,a.linkKey).enter().append("line").attr("class","link").attr("id",function(n){return"ln_"+that.removeInvalidIDChars(n.TC1)+that.removeInvalidIDChars(n.TC2)}).attr("x1",function(n){return d3.select("#tc_"+that.removeInvalidIDChars(n.TC1)).attr("cx")}).attr("y1",function(n){return d3.select("#tc_"+that.removeInvalidIDChars(n.TC1)).attr("cy")}).attr("x2",function(n){return d3.select("#tc_"+that.removeInvalidIDChars(n.TC2)).attr("cx")}).attr("y2",function(n){return d3.select("#tc_"+
that.removeInvalidIDChars(n.TC2)).attr("cy")}).attr("stroke",a.colorLink).attr("stroke-width",function(n){return Math.abs(n.Cor)*a.maxCorWidth})}a.topG.selectAll(".geneTC").remove();g=a.topG.selectAll(".geneTC").data(a.data,a.geneKey);g.enter().append("g").append("circle").attr("cx",a.nodeX).attr("cy",a.nodeY).attr("r",a.nodeRadiusSum).attr("stroke","#000000").attr("fill",a.colorCircle).attr("class",function(n){return"geneTC "+n.Gene.ID}).attr("id",function(n){return"tc_"+that.removeInvalidIDChars(n.ID)}).on("click",
function(){}).on("mouseover",a.mouseoverGene).on("mouseout",a.mouseleaveGene).merge(g).each(function(n,q){d3.select(this.parentNode).append("g").attr("class","label").attr("id",function(u){return"txt_"+that.removeInvalidIDChars(u.ID)}).attr("transform",function(){var u=a.nodeXLbl(n,q),v=a.nodeYLbl(n,q);return"translate("+u+","+v+")"}).append("text").attr("transform",function(){var u=-90+q%a.maxPerLevel*a.angleDeg;90<u&&(u-=180);return"rotate("+u+")"}).text(function(){return n.Gene.geneSymbol})});
g.exit().remove();"mir"===that.viewType&&a.drawMiR()},250)};a.requestMiR=function(){$.ajax({url:contextRoot+"tmpData/browserCache/"+genomeVer+"/modules/ds"+that.wDSID+"/"+replaceUnderscore(that.selectedModule.MOD_NAME)+".miR.json",type:"GET",async:!0,data:{},dataType:"json",success:function(g){setTimeout(function(){a.mirData=g;a.geneMirList={};for(var e=0;e<a.mirData.MIRList.length;e++)for(var h=a.mirData.MIRList[e],l=h.GeneList,n=0;n<l.length;n++)if("undefined"===typeof a.geneMirList[l[n].ID])a.geneMirList[l[n].ID]=
[],a.geneMirList[l[n].ID].push(h);else{for(var q=0,u=0;u<a.geneMirList[l[n].ID].length&&0===q;u++)h.ID===a.geneMirList[l[n].ID][u].ID&&(q=1);0===q&&a.geneMirList[l[n].ID].push(h)}a.drawMiR();that.singleWGCNATableMirView()},50)},error:function(g,e,h){setTimeout(function(){a.requestMiR()},2E3)}})};a.drawMiR=function(){if("undefined"!==typeof a.topG&&"undefined"!==typeof a.mirData){a.svg.select("#mirG").remove();a.miRdiameter=1.5*a.r;a.miRformat=d3.format(",d");a.miRbubble=d3.pack().size([a.miRdiameter,
a.miRdiameter]).padding(1.5);var g=a.runMirFilter(a.mirData.MIRList);a.hierarch=d3.hierarchy({children:g}).sum(function(e){return e.filterGLSize});a.mirNode=a.miRbubble(a.hierarch.sort());g=a.topG.append("g").attr("id","mirG").attr("transform",function(){return"translate("+(a.width/2-a.miRdiameter/2)+","+(a.height/2-a.miRdiameter/2)+")"}).selectAll(".node").data(a.hierarch.leaves(),that.mirKey);g.enter().append("g").attr("class","node").attr("id",function(e){return that.removeInvalidIDChars(e.ID)}).attr("transform",
function(e){return"translate("+e.x+","+e.y+")"}).merge(g).on("mouseover",a.mouseoverMir).on("mouseleave",a.mouseleaveMir);g.exit().remove();d3.selectAll(".node").each(function(e){var h=e.data;if(0<e.depth){d3.select(this).append("circle").attr("r",function(n){return n.r}).style("fill",function(n){return a.miRcolor(h.ID)});var l=h.ID.substring(8);l.length<e.r/3&&d3.select(this).append("text").attr("dy",".2em").attr("pointer-events","none").style("text-anchor","middle").style("cursor","pointer").append("tspan").attr("x",
0).attr("dy","-0.5em").text("miR").append("tspan").attr("x",0).attr("dy","1em").text(l)}})}};a.sortMirFunction=function(g,e){return 0<a.sortMir?g.value-e.value:0>a.sortMir?e.value-g.value:0};a.runMirFilter=function(g){var e=g;if(1===a.filterOneDB||1<a.mirGeneCutoff||1===a.mirValid||0<a.mirID.length||0<a.mirTargetID.length){var h=0;e=[];for(var l=0;l<g.length;l++)a.filterMiR(g[l])&&(e[h]=g[l],h++)}return e};a.filterMiR=function(g){val=!0;g.GeneList.length<a.mirGeneCutoff&&(val=!1);val&&1===a.mirValid&&
0===g.vC&&(val=!1);val&&0<a.mirID.length&&(-1<g.ID.toLowerCase().indexOf(a.mirID)||-1<g.ACC.toLowerCase().indexOf(a.mirID)||(val=!1));if(val&&0<a.mirTargetID.length){for(var e=!1,h=0;h<g.GeneList.length&&!e;h++)if(1===a.filterOneDB)(1<g.GeneList[h].P||0<g.GeneList[h].V)&&(-1<g.GeneList[h].ID.toLowerCase().indexOf(a.mirTargetID)||-1<a.geneList[g.GeneList[h].ID].toLowerCase().indexOf(a.mirTargetID))&&(e=!0);else if(-1<g.GeneList[h].ID.toLowerCase().indexOf(a.mirTargetID)||-1<a.geneList[g.GeneList[h].ID].toLowerCase().indexOf(a.mirTargetID))e=
!0;e||(val=!1)}if(val&&1===a.filterOneDB&&"undefined"===typeof g.filterGLSize){for(h=e=0;h<g.GeneList.length;h++)(1<g.GeneList[h].P||0<g.GeneList[h].V)&&e++;g.filterGLSize=e;0===g.filterGLSize&&0===g.vC&&(val=!1)}else val&&1===a.filterOneDB&&0===g.filterGLSize&&0===g.vC&&(val=!1);return val};a.filterRevMiR=function(g){var e=[];if("undefined"!==typeof g)if(1===a.filterOneDB)for(var h=0;h<g.length;h++)(0<g[h].filterGLSize||0<g[h].vC)&&e.push(g[h]);else e=g;return e};a.filterMiRGenes=function(g){var e=
[];if(1===a.filterOneDB)for(var h=0;h<g.length;h++)(1<g[h].P||0<g[h].V)&&e.push(g[h]);else e=g;return e};a.createMirToolTip=function(g){return'<div id="ttSVG"></div>ID: '+g.ID+"<BR>Accession: "+g.ACC+"<BR><BR>Genes Targeted within Module: "+g.filterGLSize+"<BR>"};a.mouseoverMir=function(){var g=d3.select(this).data()[0],e=g.data,h=e.GeneList;h=a.filterMiRGenes(h);d3.select(this).style("opacity","0.3");tt.transition().duration(200).style("opacity",1);tt.html(a.createMirToolTip(e)).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",
function(){return that.positionTTTop(d3.event.pageY)});e=a.svg.select("g.svg-pan-zoom_viewport").selectAll(".mirlink").data(h,that.mirKey);e.enter().append("line").attr("class","mirlink").attr("pointer-events","none").attr("id",function(u){return"ln_"+u.ID}).attr("x1",function(u){return g.x+a.width/2-a.miRdiameter/2}).attr("y1",function(u){return g.y+a.height/2-a.miRdiameter/2}).attr("x2",function(u){var v=g.x+a.width/2-a.miRdiameter/2;0<d3.select("."+u.ID).size()&&(v=d3.select("."+u.ID).attr("cx"));
return v}).attr("y2",function(u){var v=g.y+a.height/2-a.miRdiameter/2;0<d3.select("."+u.ID).size()&&(v=d3.select("."+u.ID).attr("cy"));return v}).attr("stroke",function(u){var v=a.mirPred;0<u.V&&(v=a.mirVal);return v}).attr("stroke-width",function(u){return u.P+3*u.V}).merge(e);if(!a.showLinks){e=[];for(var l=0;l<h.length;l++)for(var n=d3.selectAll("."+h[l].ID).nodes(),q=0;q<n.length;q++)"undefined"!==typeof n[q]&&e.push(d3.select(n[q].parentNode).datum().ID);a.drawLinksBetween(e)}gtag("event","mouseOverMir",
{event_category:"wgcna"})};a.mouseleaveMir=function(){d3.select(this).style("opacity","1");tt.transition().duration(200).style("opacity",0);a.svg.selectAll(".mirlink").remove();a.svg.selectAll(".link").remove()};a.mouseoverGene=function(){$("#wgcnaMouseHelp").html("<B>Click</B> to select this gene cluster and see additional details.");d3.select(this).style("fill","url(#selectGrad)");tt.transition().duration(200).style("opacity",1);tt.html(a.createToolTip(d3.select(this).data()[0])).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",
function(){return that.positionTTTop(d3.event.pageY)});var g=d3.select(this.parentNode).datum();"mir"===that.viewType?(a.mirTargetID=g.Gene.ID.toLowerCase(),that.singleImage.drawMiR(),a.svg.selectAll(".link").remove()):($("[id^=ln_"+that.removeInvalidIDChars(g.ID)+"]").each(function(){var n=$(this).attr("id");d3.select("line#"+n).attr("stroke",a.colorLinkHighlight)}),$("[id$="+that.removeInvalidIDChars(g.ID)+"]").each(function(){var n=$(this).attr("id");d3.select("line#"+n).attr("stroke",a.colorLinkHighlight)}));
a.showLinks||a.drawLinks(g);d3.select("#txt_"+that.removeInvalidIDChars(g.ID)).select("text").attr("fill","#00A347");for(var e=that.selectedGene[g.Gene.ID].tcList,h=0;h<e.length;h++)d3.select("#tc_"+that.removeInvalidIDChars(e[h].ID)).attr("fill","#FEFF49");if("mir"===that.viewType&&a.showMirLinks){var l=g.Gene.ID;g=a.geneMirList[g.Gene.ID];g=a.filterRevMiR(g);g=a.svg.select("g.svg-pan-zoom_viewport").selectAll(".mirlink").data(g,that.mirKey);g.enter().append("line").attr("class","mirlink").attr("pointer-events",
"none").attr("id",function(n){return"ln_"+n.ID}).attr("x1",function(n){var q=d3.select("."+l).attr("cx");0<d3.select("#"+that.removeInvalidIDChars(n.ID)).size()&&(q=d3.select("#"+that.removeInvalidIDChars(n.ID))[0][0].__data__.x+a.width/2-a.miRdiameter/2);return q}).attr("y1",function(n){var q=d3.select("."+l).attr("cy");0<d3.select("#"+that.removeInvalidIDChars(n.ID)).size()&&(q=d3.select("#"+that.removeInvalidIDChars(n.ID))[0][0].__data__.y+a.height/2-a.miRdiameter/2);return q}).attr("x2",function(n){return d3.select("."+
l).attr("cx")}).attr("y2",function(n){return d3.select("."+l).attr("cy")}).attr("stroke",function(n){var q=a.mirPred;0<n.V&&(q=a.mirVal);return q}).attr("stroke-width",function(n){return n.P+3*n.V}).merge(g)}gtag("event","mouseOverGene",{event_category:"wgcna"})};a.mouseleaveGene=function(){var g=d3.select(this.parentNode).datum();$("[id^=ln_"+that.removeInvalidIDChars(g.ID)+"]").each(function(){var e=$(this).attr("id");d3.select("line#"+e).attr("stroke",a.colorLink)});$("[id$="+that.removeInvalidIDChars(g.ID)+
"]").each(function(){var e=$(this).attr("id");d3.select("line#"+e).attr("stroke",a.colorLink)});d3.select(this).style("fill",a.colorCircle);d3.select("#txt_"+that.removeInvalidIDChars(g.ID)).select("text").attr("fill","#000000");tt.transition().duration(500).style("opacity",0);a.showLinks||a.svg.selectAll(".link").remove();"mir"===that.viewType&&(a.mirTargetID=$("#mirGeneFilterTxt").val().toLowerCase(),a.svg.selectAll(".mirLink").remove(),that.singleImage.drawMiR())};return a};that.singleWGCNATableGeneView=
function(){"undefined"!==typeof that.selectedModule?($("div#waitModuleTable").hide(),$("div#wgcnaEqtlTable").hide(),$("div#wgcnaMirTable").hide(),$("div#wgcnaMirGeneTable").hide(),$("div#wgcnaGoTable").hide(),$("div#wgcnaModuleTable").show(),$("span#modTableName").html(that.selectedModule.MOD_NAME),$.fn.DataTable.isDataTable("table#moduleTable")&&$("table#moduleTable").DataTable().destroy(),d3.select("table#moduleTable").select("tbody").selectAll("tr").remove(),d3.select("table#moduleTable").select("tbody").selectAll("tr").data(that.selectedModule.TCList,
that.geneKey).enter().append("tr").attr("id",function(a){return"modtrx"+a.ID}).attr("class",function(a,d){a="odd";0===d%2&&(a="even");return a}).each(function(a,d){d3.select(this).append("td").html(a.Gene.geneSymbol);d3.select(this).append("td").html(a.Gene.ID);d3.select(this).append("td").html(a.ID);a.PSList?d3.select(this).append("td").html(a.PSList.length):d3.select(this).append("td").html("0");d3.select(this).append("td").html(a.LinkSum.toFixed(2))}),that.datatbl=$("table#moduleTable").DataTable({bPaginate:!1,
aaSorting:[[4,"desc"]],sDom:'<"centerSearch"f>i<t>',buttons:[$.extend(!0,{},that.buttonCommon,{extend:"copyHtml5"}),$.extend(!0,{},that.buttonCommon,{extend:"csvHtml5"}),$.extend(!0,{},that.buttonCommon,{extend:"excelHtml5"})],columnDefs:[{type:"num",targets:[3,4]}]}),setTimeout(function(){that.PhenogenList=PhenoGenGeneList(that.datatbl,1,void 0,organism,"#tableExportCtlMod")},50),that.buttonCommon={exportOptions:{format:{body:function(a,d,c,g){a=a.replace(/(<.*?>)*/g,"");a=a.replace(/\s*/g,"");if(3===
c||4===c)a=a.replace(/&nbsp;/g," ");return a}},columns:[0,1,2,3,4]}}):($("div#waitModuleTable").hide(),$("div#wgcnaEqtlTable").hide(),$("div#wgcnaModuleTable").hide(),$("div#wgcnaGoTable").hide())};that.singleWGCNATableMirView=function(){var a={orgPref:"mmu-",runMirFilter:function(g){for(var e=[],h=0,l=0;l<g.length;l++)if(0<g[l].filterGLSize||0<g[l].vC)e[h]=g[l],h++;return e},createMirTable:function(){$("div#waitMirTable").hide();$("div#wgcnaMirGeneTable").hide();$("div#wgcnaMirTable").show();$("span#mirTableName").html(that.selectedModule.MOD_NAME);
$.fn.DataTable.isDataTable("table#mirTable")&&$("table#mirTable").DataTable().destroy();d3.select("table#mirTable").select("tbody").selectAll("tr").remove();var g=a.runMirFilter(that.singleImage.mirData.MIRList);d3.select("table#mirTable").select("tbody").selectAll("tr").data(g,that.mirKey).enter().append("tr").attr("id",function(e){return"mirTR"+that.removeInvalidIDChars(e.ID)}).attr("class",function(e,h){e="odd";0===h%2&&(e="even");return e}).each(function(e,h){for(var l=0,n=[],q=0,u=[],v=e.GeneList,
y=0;y<v.length;y++)0<v[y].V?(l++,n.push(v[y])):1<v[y].P&&(q++,u.push(v[y]));d3.select(this).append("td").html(e.ID);d3.select(this).append("td").html(e.ACC);d3.select(this).append("td").html(function(){if(0<q){var w='<span class="triggerpL" name="pl'+h+'">'+q+"</span><BR>";w=w+'<span id="pl'+h+'" style="display:none;" >';for(var C=0;C<u.length;C++){0<C&&(w+=", ");var B=u[C].ID;"undefined"!==typeof that.singleImage.geneList[B]&&(B=that.singleImage.geneList[B]);w+=B}w+="</span>"}else w=q;return w});
d3.select(this).append("td").html(function(){if(0<l){var w='<span class="triggervL" name="vl'+h+'">'+l+"</span><BR>";w=w+'<span id="vl'+h+'" style="display:none;" >';for(var C=0;C<n.length;C++){0<C&&(w+=", ");var B=n[C].ID;"undefined"!==typeof that.singleImage.geneList[B]&&(B=that.singleImage.geneList[B]);w+=B}w+="</span>"}else w=l;return w});d3.select(this).append("td").html(function(){var w=q+l;if(0<w){w='<span class="triggerMiL" name="mil'+h+'">'+w+"</span><BR>";w=w+'<span id="mil'+h+'" style="display:none;" >';
if(0<n.length){w+="Validated: ";for(var C=0;C<n.length;C++){0<C&&(w+=", ");var B=n[C].ID;"undefined"!==typeof that.singleImage.geneList[B]&&(B=that.singleImage.geneList[B]);w+=B}}if(0<u.length)for(0<n.length&&(w+="<BR><BR>"),w+="Predicted: ",C=0;C<u.length;C++)0<C&&(w+=", "),B=u[C].ID,"undefined"!==typeof that.singleImage.geneList[B]&&(B=that.singleImage.geneList[B]),w+=B;w+="</span>"}return w})});$("#mirTable .triggerMiL").on("click",function(e){var h=this.getAttribute("name");$("#"+h).is(":hidden")?
($(this).addClass("less"),$("span#"+h).show()):($(this).removeClass("less"),$("span#"+h).hide());e.stopPropagation()});$("#mirTable .triggerpL").on("click",function(e){var h=this.getAttribute("name");$("#"+h).is(":hidden")?($(this).addClass("less"),$("span#"+h).show()):($(this).removeClass("less"),$("span#"+h).hide());e.stopPropagation()});$("#mirTable .triggervL").on("click",function(e){var h=this.getAttribute("name");$("#"+h).is(":hidden")?($(this).addClass("less"),$("span#"+h).show()):($(this).removeClass("less"),
$("span#"+h).hide());e.stopPropagation()});that.datatbl=$("table#mirTable").DataTable({bPaginate:!1,aaSorting:[[4,"desc"]],sDom:'<"leftSearch"B><"centerSearch"f><"rightTable"i><t>',buttons:[$.extend(!0,{},that.buttonCommon,{extend:"copyHtml5"}),$.extend(!0,{},that.buttonCommon,{extend:"csvHtml5"}),$.extend(!0,{},that.buttonCommon,{extend:"excelHtml5"})]});that.PhenogenList=PhenoGenGeneList(that.datatbl,4,that.buttonCommon);that.buttonCommon={exportOptions:{format:{body:function(e,h,l,n){e=e.replace(/(<.*?>)*/g,
"");0!==l&&3!==l?e=e.replace(/\s*/g,""):3===l?e=e.replace(/&nbsp;/g," "):0===l&&(e=e.replace(/PRN/g,";PRN"),e=e.replace(/ENS/g,";ENS"),e=e.substring(1));0===e.indexOf("ENS")&&0<e.indexOf("AllOrganisms:")&&(e=e.substring(0,e.indexOf("AllOrganisms:")));if(7===l||8===l||9===l||11===l||14===l||16===l||19===l||21===l||24===l||26===l)e="\u200c"+e;else if(12===l||13===l||17===l||18===l||22===l||23===l||27===l||28===l)e=e.replace(/chr/g," ");return e}},columns:[0,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,
19,20,21,22,23,24,25,26,27,28,29]}}},createMirGeneTable:function(){$("div#waitMirGeneTable").hide();$("div#wgcnaMirGeneTable").show();$("div#wgcnaMirTable").hide();$("span#mirGeneTableName").html(that.selectedModule.MOD_NAME);d3.select("table#mirGeneTable").select("tbody").selectAll("tr").remove();d3.select("table#mirGeneTable").select("tbody").selectAll("tr").data(that.selectedModule.TCList,that.geneKey).enter().append("tr").attr("id",function(g){return"mirg"+that.removeInvalidIDChars(g.ID)}).attr("class",
function(g,e){g="odd";0===e%2&&(g="even");return g}).each(function(g,e){var h=that.singleImage.geneMirList[g.Gene.ID],l=0,n=[],q=0,u=[];if("undefined"!==typeof h)for(var v=0;v<h.length;v++)for(var y=h[v].GeneList,w=0,C=0;C<y.length&&0===w;C++)y[C].ID===g.Gene.ID&&(0<y[C].V?(l++,n.push(h[v])):1<y[C].P&&(q++,u.push(h[v])),w=1);d3.select(this).append("td").html(g.Gene.geneSymbol);d3.select(this).append("td").html(g.Gene.ID);d3.select(this).append("td").html(function(B,E){if(0<q){B='<span class="triggerpL" name="pl'+
e+'">'+q+"</span><BR>";B=B+'<span id="pl'+e+'" style="display:none;" >';for(E=0;E<u.length;E++){0<E&&(B+=", ");var G=u[E].ID.replace(a.orgPref,"");B+=G}B+="</span>"}else B=q;return B});d3.select(this).append("td").html(function(B,E){if(0<l){B='<span class="triggervL" name="vl'+e+'">'+l+"</span><BR>";B=B+'<span id="vl'+e+'" style="display:none;" >';for(E=0;E<n.length;E++){0<E&&(B+=", ");var G=n[E].ID.replace(a.orgPref,"");B+=G}B+="</span>"}else B=l;return B});d3.select(this).append("td").html(function(B,
E){B=l+q;if(0<B){B='<span class="triggerMiL" name="mil'+e+'">'+B+"</span><BR>";B=B+'<span id="mil'+e+'" style="display:none;" >';if(0<n.length)for(B+="Validated: ",E=0;E<n.length;E++){0<E&&(B+=", ");var G=n[E].ID.replace(a.orgPref,"");B+=G}if(0<u.length)for(0<n.length&&(B+="<BR><BR>"),B+="Predicted: ",E=0;E<u.length;E++)0<E&&(B+=", "),G=u[E].ID.replace(a.orgPref,""),B+=G;B+="</span>"}return B})});$("#mirGeneTable .triggerMiL").on("click",function(g){var e=this.getAttribute("name");$("#"+e).is(":hidden")?
($(this).addClass("less"),$("span#"+e).show()):($(this).removeClass("less"),$("span#"+e).hide());g.stopPropagation()});$("#mirGeneTable .triggerpL").on("click",function(g){var e=this.getAttribute("name");$("#"+e).is(":hidden")?($(this).addClass("less"),$("span#"+e).show()):($(this).removeClass("less"),$("span#"+e).hide());g.stopPropagation()});$("#mirGeneTable .triggervL").on("click",function(g){var e=this.getAttribute("name");$("#"+e).is(":hidden")?($(this).addClass("less"),$("span#"+e).show()):
($(this).removeClass("less"),$("span#"+e).hide());g.stopPropagation()});$.fn.DataTable.isDataTable("table#mirGeneTable")&&$("table#mirGeneTable").DataTable().destroy();$("table#mirGeneTable").DataTable({bPaginate:!1,aaSorting:[[4,"desc"]],sDom:'<"rightTable"i><"leftTable"fB><t>',buttons:["copy","excel","pdf"]})}};if("undefined"!==typeof that.selectedModule){$("div#wgcnaEqtlTable").hide();$("div#wgcnaModuleTable").hide();$("div#wgcnaGoTable").hide();d3.select("div#tableExportCtl").selectAll("span").remove();
var d=d3.select("div#tableExportCtl"),c=d.append("span").style("display","inline-block").style("text-align","left").style("margin-left","20px").style("margin-right","10px");c.append("text").text("View by:");c.append("br");c.append("input").attr("type","radio").attr("checked","checked").attr("name","wgcnaMirTableRB").on("click",function(){a.createMirTable()});c.append("text").text(" miRNA");c.append("br");c.append("input").attr("type","radio").attr("name","wgcnaMirTableRB").on("click",function(){a.createMirGeneTable()});
c.append("text").text(" Gene");d.append("span").attr("class","button").style("display","inline-block").style("margin-right","10px").on("click",function(){$("#moduleTable").tableExport({type:"csv",escape:"false"})}).html("Export CSV");a.createMirTable()}else $("div#waitModuleTable").hide(),$("div#wgcnaEqtlTable").hide(),$("div#wgcnaModuleTable").hide(),$("div#wgcnaMirTable").hide(),$("div#wgcnaMirGeneTable").hide(),$("div#wgcnaGoTable").hide();return a};that.singleWGCNAImageGoView=function(){var a=
that.singleWGCNAImage();$(".goCTL").show();$(".linkCTL").hide();$(".mirCTL").hide();$(".eqtlCtls").hide();a.type=that.viewType;a.goDomain="mf";a.lastDrawn="mf";a.selectedNode;a.displayedLevel="d1";a.width=$(window).width();a.height=Math.floor(.92*window.innerHeight);a.padding=5;a.radius=(Math.min(a.width,a.height)-2*a.padding)/2;a.duration=1E3;a.xScale=d3.scaleLinear().range([0,2*Math.PI]);a.yScale=d3.scalePow().exponent(1.3).domain([0,1]).range([0,a.radius]);a.colorGO=d3.scaleOrdinal(d3.schemeCategory20);
a.displayDepth=3;a.geneList={};var d=[];if(that.selectedModule){d=that.selectedModule.TCList;for(var c=0;c<d.length;c++)a.geneList[that.selectedModule.TCList[c].Gene.ID]=that.selectedModule.TCList[c].Gene.geneSymbol}a.pathColor=function(g){return g&&g.data?g.data.name&&0==g.data.name.indexOf("ENS")?"#DFC184":g.data.name?a.colorGO(g.data.name):"#000000":g&&g.name&&0==g.name.indexOf("ENS")?"#DFC184":g&&g.name?a.colorGO(g.name):"#000000"};a.addLabels=function(g,e,h,l,n,q,u){q=a.radius/(u+1)*g.depth+
a.radius/(u+1)-12;var v=a.radius/(u+1)*g.depth,y=(n-h)/360*Math.PI*v*2;u=Math.floor((n-h)/360*Math.PI*q*2/7)-1;q=Math.floor((q-v)/12);var w=g.data.name;0===g.data.name.indexOf("ENS")&&"undefined"!==typeof a.geneList[w]&&(w=a.geneList[w],25<n-h&&(w=w+" ("+g.data.name+")"));var C=w.split(" ")[0].split("-")[0];if(C.length<=u||-1===g.data.name.indexOf("ENS")&&C.length/2<=u&&10<n-h){y=[];C=0;if(w.length>u)for(;0<w.length;){var B=w.indexOf(" ");if(-1===B)w.length>u?(y[C]=w.substr(0,u),C++,w=w.substr(u)):
(y[C]=w,C++,w="");else{for(var E=0;B<u&&1>E;){var G=w.indexOf(" ",B+1);-1!==G&&G<=u?B=G:E=1}B>u?-1<w.indexOf("-")&&w.indexOf("-")<u?(B=w.indexOf("-"),y[C]=w.substr(0,B+1),C++,w=w.substr(B+1)):(y[C]=w.substr(0,u),C++,w=w.substr(u)):(y[C]=w.substr(0,B),C++,w=w.substr(B+1))}}else y[C]=w;C=a.topG.append("text").style("fill-opacity",1).style("fill","#000").attr("pointer-events","none").attr("class","txt"+removeColon(g.data.id)).attr("text-anchor",function(z){return"start"}).attr("dy","1em").style("opacity",
function(z){return 1}).append("textPath").attr("xlink:href",function(z){return"#ap"+e}).attr("startOffset",function(z){return 0===h&&360===n?90:5});for(g=0;g<y.length&&g<q;g++)g<q&&(g===q-1&&y.length>q&&(y[g]+="...",y[g].length>u&&(y[g]=y[g].substr(0,u-4)+"...")),C.append("tspan").attr("x",0).attr("dy","1em").text(y[g]))}else if(12<=y&&0===g.data.name.indexOf("ENS"))for(C=a.topG.append("text").style("fill-opacity",1).style("fill","#000").attr("pointer-events","none").attr("class","txt"+removeColon(g.data.id)).attr("text-anchor",
function(z){z="start";180<=n&&(z="end");return z}).attr("dy",".2em").attr("transform",function(z){z=l-2.5;var D=v;0===h&&360===n&&(D=20);180<=n&&(z=l+2.5);return"rotate("+(z-90)+")translate("+D+")rotate("+(180<z?-180:0)+")"}).style("opacity",function(z){return 1}),w=g.data.name,0===g.data.name.indexOf("ENS")&&"undefined"!==typeof a.geneList[w]&&(w=a.geneList[w]),u=w.split(" "),g=0;g<u.length;g++)C.append("tspan").attr("x",0).attr("dy","1em").text(u[g])};a.redraw=function(){a.svg.selectAll("path").remove();
a.svg.select("#center").remove();var g=a.partition(a.rootN).descendants().filter(a.filterNodes),e=a.displayDepth;a.arc=d3.arc().startAngle(function(l){return Math.max(0,Math.min(2*Math.PI,l.x0))}).endAngle(function(l){return Math.max(0,Math.min(2*Math.PI,l.x1))}).innerRadius(function(l){return l===a.selectedNode&&a.selectedNode!==a.data.GOList[0]&&a.selectedNode!==a.data.GOList[1]&&a.selectedNode!==a.data.GOList[2]?20:Math.max(0,a.radius/(e+1)*(l.depth-a.rootN.depth))}).outerRadius(function(l){return Math.max(0,
a.radius/(e+1)*(l.depth-a.rootN.depth)+a.radius/(e+1))});a.topG.selectAll("path").remove();a.topG.selectAll("text").remove();var h=180/Math.PI;a.path=a.topG.selectAll("path").data(g);a.path.enter().append("path").merge(a.path).attr("d",a.arc).attr("id",function(l,n){return"ap"+n}).attr("class",function(l,n){return removeColon(l.data.id)}).attr("fill-rule","evenodd").attr("fill",a.pathColor).attr("pointer-events","all").on("mouseover",a.mouseover).on("click",a.click).each(function(l,n){if(l.depth<
a.rootN.depth+a.displayDepth){var q=Math.max(0,Math.min(2*Math.PI,l.x0))*h,u=Math.max(0,Math.min(2*Math.PI,l.x1))*h,v=q+(u-q)/2;0===q&&360===u&&(v=90);a.addLabels(l,n,q,v,u,l.depth-a.rootN.depth,e)}});if(a.selectedNode!==a.data.GOList[0]&&a.selectedNode!==a.data.GOList[1]&&a.selectedNode!==a.data.GOList[2])a.svg.append("circle").attr("id","center").attr("cx",a.width/2+a.padding).attr("cy",a.height/2+a.padding).attr("r","20").attr("fill-rule","evenodd").attr("fill",function(){return a.pathColor(a.rootN.parent)}).attr("pointer-events",
"all").on("click",function(){if(a.rootN.parent.data===a.data.GOList[0]||a.rootN.parent.data===a.data.GOList[1]||a.rootN.parent.data===a.data.GOList[2])a.selectedNode=null,a.draw();else{if(a.rootN.parent.data!==a.data.GOList[0]&&a.rootN.parent.data!==a.data.GOList[1]&&a.rootN.parent.data!==a.data.GOList[2])a.selectedNode=a.rootN.parent.data,a.rootN=a.rootN.parent,a.mouseover(a.rootN.parent);else{var l=a.data.GOList[0];"mf"===a.goDomain?l=a.data.GOList[2]:"bp"===a.goDomain&&(l=a.data.GOList[1]);a.selectedNode=
l}a.redraw();d3.event.stopPropagation();gtag("event","mouseClickGO",{event_category:"wgcna"})}}).on("mouseover",function(l){"undefined"!==typeof a.selectedNode&&a.selectedNode.parent!==a.data.GOList[0]&&a.selectedNode.parent!==a.data.GOList[1]&&a.selectedNode.parent!==a.data.GOList[2]?a.mouseover(a.selectedNode.parent):(tt.transition().duration(200).style("opacity",1),tt.html(a.createToolTip(a.selectedNode)).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",function(){return that.positionTTTop(d3.event.pageY)}));
d3.event.stopPropagation();gtag("event","mouseOverGO",{event_category:"wgcna"})}).on("mouseleave",function(l){tt.transition().duration(200).style("opacity",0)})};a.getModuleGOFile=function(g){"undefined"!==typeof that.selectedModule&&"undefined"!==typeof that.selectedModule.MOD_NAME&&$.ajax({url:contextRoot+"tmpData/browserCache/"+genomeVer+"/modules/ds"+that.wDSID+"/"+replaceUnderscore(that.selectedModule.MOD_NAME)+".GO.json",type:"GET",async:!0,data:{},dataType:"json",success:function(e){a.data=
e;e=a.data.GOList[0];for(var h=0,l=0;l<e.length;l++)e[l].UnqID=h,h++;e=a.data.GOList[1];for(l=0;l<e.length;l++)e[l].UnqID=h,h++;e=a.data.GOList[2];for(l=0;l<e.length;l++)e[l].UnqID=h,h++;a.draw()},error:function(e,h,l){console.log(l);25>g&&setTimeout(function(){a.getModuleGOFile(g+1)},1E3)}})};a.draw=function(){a.svg.attr("width",a.width).attr("height",a.height);a.initializeBreadcrumbTrail();a.topG=a.svg.append("g").attr("transform","translate("+[a.width/2+a.padding,a.height/2+a.padding]+")");a.partition=
d3.partition().size([2*Math.PI,a.radius]);if("undefined"===typeof a.data.MOD_NAME||"undefined"!==typeof that.selectedModule.MOD_NAME&&replaceUnderscore(a.data.MOD_NAME)!==replaceUnderscore(that.selectedModule.MOD_NAME))a.getModuleGOFile(0),a.selectedNode=null;else{if(a.goDomain!==a.lastDrawn||"undefined"===typeof a.selectedNode||null===a.selectedNode){var g=a.data.GOList[0];"mf"===a.goDomain?g=a.data.GOList[2]:"bp"===a.goDomain&&(g=a.data.GOList[1]);a.selectedNode=g;a.rootN=d3.hierarchy(g).sum(function(l){return l&&
l.name&&-1<l.name.indexOf("ENS")?1:l.uniqueGene}).sort(function(l,n){return n.value-l.value})}g=a.partition(a.rootN).descendants().filter(a.filterNodes);a.lastDrawn=a.goDomain;if(a.selectedNode===a.data.GOList[0]||a.selectedNode===a.data.GOList[1]||a.selectedNode===a.data.GOList[2])a.totalSize=a.selectedNode.uniqueGene;var e=a.displayDepth;a.arc=d3.arc().startAngle(function(l){return Math.max(0,Math.min(2*Math.PI,l.x0))}).endAngle(function(l){return Math.max(0,Math.min(2*Math.PI,l.x1))}).innerRadius(function(l){return Math.max(0,
a.radius/(e+1)*l.depth)}).outerRadius(function(l){return Math.max(0,a.radius/(e+1)*l.depth+a.radius/(e+1))});setTimeout(function(){that.singleWGCNATableGoView()},50);a.vis=a.topG.append("svg:circle").attr("r",a.radius+30).style("opacity",0).on("mouseover",a.mouseleave);var h=180/Math.PI;a.path=a.topG.selectAll("path").data(g);a.path.enter().append("path").attr("d",a.arc).attr("id",function(l,n){return"ap"+n}).attr("fill-rule","evenodd").attr("fill",a.pathColor).attr("pointer-events","all").on("mouseover",
a.mouseover).on("click",a.click).each(function(l,n){var q=Math.max(0,Math.min(2*Math.PI,l.x0))*h,u=Math.max(0,Math.min(2*Math.PI,l.x1))*h,v=q+(u-q)/2;0===q&&360===u&&(v=90);a.addLabels(l,n,q,v,u,l.depth-a.rootN.depth,e)});a.path.exit().remove();a.svg.append("g").attr("transform","translate(0,15)").append("text").style("fill-opacity",1).style("fill","#000").attr("pointer-events","none").attr("text-anchor","start").style("opacity",function(l){return 1}).text(a.selectedNode.uniqueGene+" genes in module with GO annotation")}};
a.filterNodes=function(g,e){return g.depth<a.rootN.depth+a.displayDepth?!0:!1};a.click=function(g){a.selectedNode=g.data;a.rootN=g;g.data!==a.data.GOList[0]&&g.data!==a.data.GOList[1]&&g.data!==a.data.GOList[2]?a.redraw():a.draw();d3.event.stopPropagation()};a.mouseover=function(g){if("undefined"!==typeof g&&null!==g){var e=a.data.GOList[0];"mf"===a.goDomain?e=a.data.GOList[2]:"bp"===a.goDomain&&(e=a.data.GOList[1]);var h=0;h="undefined"!==typeof g&&"undefined"!==typeof g.data.value?(100*g.data.value/
e.uniqueGene).toPrecision(3):"undefined"!==typeof g?(100*g.data.uniqueGene/e.uniqueGene).toPrecision(3):100;e=h+"%";.1>h&&(e="< 0.1%");"undefined"!==typeof g.data.name&&-1===g.data.name.indexOf("ENS")&&(e=g.data.uniqueGene+" genes ("+e+")");d3.select("#percentage").text(e);d3.select("#explanation").style("visibility","");var l=a.getAncestors(g);a.updateBreadcrumbs(l,e);d3.selectAll("path").style("opacity",.3);a.topG.selectAll("text").style("opacity",.3);a.topG.selectAll("path").filter(function(n){return 0<=
l.indexOf(n)}).style("opacity",1).each(function(n){a.topG.selectAll(".txt"+removeColon(n.data.id)).style("opacity",1)});a.topG.selectAll("."+removeColon(g.data.id)).style("opacity",1);tt.transition().duration(200).style("opacity",1);tt.html(a.createToolTip(g)).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",function(){return that.positionTTTop(d3.event.pageY)})}d3.event.stopPropagation()};a.createToolTip=function(g){g.data&&(g=g.data);var e="Name:"+g.name+" ("+g.id+
")<BR><BR>Definition: "+g.definition+"<BR><BR>Unique Genes in this module with this term: "+g.uniqueGene+"<BR>";if(0<g.uniqueGene)for(var h=0;h<g.uniqueGenes.length;h++){0<h&&(e+=", ");var l=g.uniqueGenes[h].id;"undefined"!==typeof a.geneList[l]&&(l=a.geneList[l]);e+=l}return e};a.mouseleave=function(g){d3.select("#trail").style("visibility","hidden");d3.selectAll("text").style("opacity",1);d3.selectAll("path").transition().duration(500).style("opacity",1);d3.select("#explanation").style("visibility",
"hidden");tt.transition().duration(200).style("opacity",0)};a.getAncestors=function(g){for(var e=[];g.parent;)e.unshift(g),g=g.parent;return e};a.isParentOf=function(g,e){return g===e?!0:g.children?g.children.some(function(h){return a.isParentOf(h,e)}):!1};a.b={w:250,h:30,s:3,t:10,runW:0,runH:0};a.initializeBreadcrumbTrail=function(){d3.select("#singleWGCNASVG").remove();d3.select("#trail").remove();d3.select("#viewGene").append("svg:svg").attr("width",a.width).attr("height",68).attr("id","trail").append("svg:text").attr("id",
"endlabel").style("fill","#000");a.svg=d3.select("#viewGene").append("svg").attr("id","singleWGCNASVG").attr("height",a.height+"px").attr("width","100%")};a.breadcrumbPoints=function(g,e){g=7.5*g.data.name.length+25;var h=[];h.push("0,0");h.push(g+",0");h.push(g+a.b.t+","+a.b.h/2);h.push(g+","+a.b.h);h.push("0,"+a.b.h);0<e&&h.push(a.b.t+","+a.b.h/2);return h.join(" ")};a.updateBreadcrumbs=function(g,e){g=d3.select("#trail").selectAll("g").data(g,function(h){return h.data.name+h.depth});g.exit().remove();
a.b.runW=0;a.b.runH=0;g=g.enter().append("svg:g").merge(g).attr("transform",function(h,l){h=7.5*h.data.name.length+25;l=a.b.runW;l+h>a.width&&(l=0,a.b.runH=a.b.runH+a.b.h+a.b.s,a.b.runW=0);a.b.runW=a.b.runW+h+a.b.s;return"translate("+l+", "+a.b.runH+")"});g.append("svg:polygon").attr("points",a.breadcrumbPoints).style("fill",a.pathColor);g.append("svg:text").attr("x",function(h){return(7.5*h.data.name.length+25+a.b.t)/2}).attr("y",a.b.h/2).attr("dy","0.35em").attr("text-anchor","middle").text(function(h){h=
h.data.name;0===h.indexOf("ENS")&&"undefined"!==typeof a.geneList[h]&&(h=a.geneList[h]);return h});d3.select("#trail").select("#endlabel").attr("x",a.b.runW+15).attr("y",a.b.h/2+a.b.runH).attr("dy","0.35em").attr("text-anchor","start").text(e);d3.select("#trail").attr("height",function(){var h=a.b.runH+a.b.h+5;68>h&&(h=68);return h}).style("visibility","")};return a};that.flattenTree=function(a,d){-1===d.data.name.indexOf("ENS")&&a.push(d);if(d.children)for(var c=0;c<d.children.length;c++)that.flattenTree(a,
d.children[c])};that.singleWGCNATableGoView=function(){$("div#waitGoTable").hide();$("div#wgcnaModuleTable").hide();$("div#wgcnaMirTable").hide();$("div#wgcnaMirGeneTable").hide();$("div#wgcnaEqtlTable").hide();$("div#wgcnaGoTable").show();$("span#GoTableName").html(that.selectedModule.MOD_NAME);d3.select("div#tableExportCtl").selectAll("span").remove();d3.select("div#tableExportCtl").append("span").attr("class","button").style("margin-right","10px").on("click",function(){$("#GoTable").tableExport({type:"csv",
escape:"false"})}).html("Export CSV");$.fn.DataTable.isDataTable("table#GoTable")&&$("table#GoTable").DataTable().destroy();d3.select("#GoTable").select("tbody").selectAll("tr").remove();var a=[];that.flattenTree(a,that.singleImage.rootN);a=d3.select("#GoTable").select("tbody").selectAll("tr").data(a,function(d,c){return c});a.exit().remove();a.enter().append("tr").style("background-color",that.singleImage.pathColor).style("display",function(d){var c="none";d.depth<=that.singleImage.rootN.depth?c=
"":d.depth===that.singleImage.rootN.depth+1&&(c="");return c}).style("cursor","pointer").merge(a).attr("id",function(d){return d.id}).attr("class",function(d){return" d"+d.depth}).on("mouseover",function(d){d3.select(this).style("background-color","#FFFFFF");gtag("event","mouseOverGOTbl",{event_category:"wgcna"})}).on("mouseleave",function(d){d3.select(this).style("background-color",that.singleImage.pathColor(d))}).on("click",function(d){that.singleImage.selectedNode=d.data;that.singleImage.rootN=
d;$("span[name=d"+d.depth+"]").addClass("less");$("tr.d"+d.depth).show();that.singleImage.redraw();gtag("event","wgcna",{event_category:"mouseClickGOTbl"})}).each(function(d,c){var g=d3.select(this);g.append("td").style("padding-left",function(){return 20*d.depth+"px"}).html(function(){var e=d.data.name+" ("+d.data.id+")";-1<d.data.name.indexOf("ENS")&&(e=that.singleImage.geneList[d.data.name]+" ("+d.data.id+")");var h=e;if("undefined"!==typeof d.children&&0<d.children.length){h="";d.depth<=that.singleImage.rootN.depth&&
(h=" less");for(var l=0,n=0;n<d.children.length&&0===l;n++)-1===d.children[n].data.name.indexOf("ENS")&&(l=1);h=1===l?'<span class="trigger'+h+'" name="d'+(d.depth+1)+'">'+e+"</span>":e}return h});g.append("td").html(d.data.definition);g.append("td").html(function(){if(0<d.data.uniqueGene){var e='<span class="triggerGL" name="gl'+c+'">'+d.data.uniqueGene+"</span><BR>";e=e+'<span id="gl'+c+'" style="display:none;" >';for(var h=0;h<d.data.uniqueGenes.length;h++){0<h&&(e+=", ");var l=d.data.uniqueGenes[h].id;
"undefined"!==typeof that.singleImage.geneList[l]&&(l=that.singleImage.geneList[l]);e+=l}e+="</span>"}else e="0";return e})});$("#GoTable .trigger").on("click",function(d){var c=this.getAttribute("name");if($("."+c).is(":hidden"))$("span[name="+c+"]").addClass("less"),$("tr."+c).show();else for(c=parseInt(c.substr(1));0<$("tr.d"+c).length;)$("span[name=d"+c+"]").removeClass("less"),$("tr.d"+c).hide(),c++;d.stopPropagation()});$("#GoTable .triggerGL").on("click",function(d){var c=this.getAttribute("name");
$("#"+c).is(":hidden")?($(this).addClass("less"),$("span#"+c).show()):($(this).removeClass("less"),$("span#"+c).hide());d.stopPropagation()});$("#GoTable").DataTable({bPaginate:!1,bSort:!1,asStripClasses:[],sDom:"f<t>"})};that.singleWGCNAImageEQTLView=function(){var a=that.singleWGCNAImage();$(".linkCTL").hide();$(".mirCTL").hide();$(".goCTL").hide();$(".eqtlCtls").show();a.type="eqtl";a.createToolTip=function(d){var c=that.selectedGene[d];return c.geneSymbol?"<BR>Gene: "+c.geneSymbol+"("+d+")":"<BR>Gene: "+
d};a.colorGene=function(d){var c="#DFC184";if(0===d.indexOf("Brain")||0===d.indexOf("Unannotated"))c="#7EB5D6";return c};a.displayDefault=function(){d3.select("#viewGene").remove();d3.select("#circos").remove();that.selectedModule&&(a.update(contextRoot+"tmpData/browserCache/"+genomeVer+"/circos/ds"+that.wDSID+"/"+replaceUnderscore(that.selectedModule.MOD_NAME)+"/"+replaceUnderscore(that.selectedModule.MOD_NAME)+"_1/svg/circos_new.svg"),that.singleWGCNATableEQTLView())};a.draw=function(){};a.update=
function(d){$.ajax({url:d,type:"GET",data:{},dataType:"html",success:function(c){d3.select("#circos").remove();d3.select("#wgcnaGeneImage").append("div").attr("id","circos");$("#circos").html(c);$("#circosModule").css("width","100%");$("#circosModule").css("height",Math.floor(.9*window.innerHeight)+"px");a.panZoomCircos=svgPanZoom("#circosModule",{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,minZoom:.1,maxZoom:4,fit:!0,center:!0});d3.select("#circosModule").selectAll(".circosGene").style("cursor",
"pointer").on("mouseover",function(){d3.select(this).style("fill","#000000").attr("font-size","50px");tt.transition().duration(200).style("opacity",1);tt.html(a.createToolTip(d3.select(this).attr("id"))).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",function(){return that.positionTTTop(d3.event.pageY)});gtag("event","mouseOverEQTL",{event_category:"wgcna"})}).on("mouseout",function(){var g=a.colorGene(d3.select(this).attr("id"));d3.select(this).style("fill",g).attr("font-size",
"26px");tt.transition().duration(500).style("opacity",0)});that.singleWGCNATableEQTLView()}})};return a};that.singleWGCNATableEQTLView=function(){$("div#waitEqtlTable").hide();$("div#wgcnaModuleTable").hide();$("div#wgcnaMirTable").hide();$("div#wgcnaMirGeneTable").hide();$("div#wgcnaGoTable").hide();$("div#wgcnaEqtlTable").show();$("span#eqtlTableName").html(that.selectedModule.MOD_NAME);d3.select("div#tableExportCtl").selectAll("span").remove();d3.select("div#tableExportCtl").append("span").attr("class",
"button").style("margin-right","10px").on("click",function(){$("#eqtlTable").tableExport({type:"csv",escape:"false"})}).html("Export CSV");$.ajax({url:contextRoot+"tmpData/browserCache/"+genomeVer+"/modules/ds"+that.wDSID+"/"+replaceUnderscore(that.selectedModule.MOD_NAME)+".eQTL.json",type:"GET",async:!0,data:{},dataType:"json",beforeSend:function(){$("div#waitEqtlTable").show()},success:function(a){setTimeout(function(){$.fn.DataTable.isDataTable("table#eqtlTable")&&$("table#eqtlTable").DataTable().destroy();
for(var d=[],c=1*$("#eqtlPval").val(),g="",e=0,h=0;h<a.length;h++)a[h].Pval>=c&&(a[h].Pval>e&&(g=a[h].Snp,e=a[h].Pval),d.push(a[h]));d3.select("#eqtlTable").select("tbody").selectAll("tr").remove();d3.select("#eqtlTable").select("tbody").selectAll("tr").data(d,that.eQTLKey).enter().append("tr").attr("id",function(l){return"tblLink_"+l.Snp}).attr("class",function(l,n){l="odd";0===n%2&&(l="even");return l}).each(function(l,n){n=l.Start/1E6;d3.select(this).append("td").html(l.Chr);d3.select(this).append("td").html(n.toFixed(1));
d3.select(this).append("td").html(l.Snp);d3.select(this).append("td").html(l.Pval.toFixed(2))});$("#eqtlTable").DataTable({bPaginate:!1,aaSorting:[[3,"desc"]],sDom:"fiB<t>",buttons:["copy","excel","pdf"]});$("div#waitEqtlTable").hide();d3.select("#circosModule").select("g#Link_"+g).select("path").style("stroke","#FFF450")},20)},error:function(a,d,c){}})};that.singleWGCNAImageMetaView=function(){var a=that.singleWGCNAImage();$(".goCTL").hide();$(".eqtlCtls").hide();$(".linkCTL").show();$(".mirCTL").hide();
a.CorCutoff_min=.75;a.CorCutoff_max=1;a.type=that.viewType;a.truncated=0;a.filterOneDB=1;a.mirGeneCutoff=1;a.mirValid=0;a.mirTargetID="";a.mirID="";a.miRcolor=d3.scaleOrdinal(d3.schemeCategory20b);a.sortMir=0;a.maxCorWidth=5;a.mlinkKey=function(d){return that.removeInvalidIDChars(d.MOD1)+"_"+that.removeInvalidIDChars(d.MOD2)};a.colorCircle=function(d){return d.COLOR};a.colorLink=function(d){var c=a.negColor;0<d.COR&&(c=a.posColor);return c};a.colorLinkHighlight=function(d){var c=a.negDarkColor;0<
d.COR&&(c=a.posDarkColor);return c};a.drawLinks=function(d){a.updateColor("linkColor");a.svg.selectAll(".link").remove();for(var c=a.metaData.LINKS,g=[],e=0,h=0;h<c.length;h++)(c[h].MOD1===d.MODULE||c[h].MOD2===d.MODULE)&&a.CorCutoff_min<=Math.abs(c[h].COR)&&Math.abs(c[h].COR)<=a.CorCutoff_max&&(g[e]=c[h],e++);c=g;1E4>c.length&&(d=a.topG.selectAll(".link").data(c,a.mlinkKey),d.enter().append("line").attr("class","link").attr("pointer-events","none").attr("id",function(l){return"ln_"+that.removeInvalidIDChars(l.MOD1)+
that.removeInvalidIDChars(l.MOD2)}).attr("x1",function(l){return d3.select("#mod_"+that.removeInvalidIDChars(l.MOD1)).attr("cx")}).attr("y1",function(l){return d3.select("#mod_"+that.removeInvalidIDChars(l.MOD1)).attr("cy")}).attr("x2",function(l){return d3.select("#mod_"+that.removeInvalidIDChars(l.MOD2)).attr("cx")}).attr("y2",function(l){return d3.select("#mod_"+that.removeInvalidIDChars(l.MOD2)).attr("cy")}).attr("stroke",a.colorLink).attr("stroke-width",function(l){return Math.abs(l.COR)*a.maxCorWidth}).merge(d))};
a.drawLinksBetween=function(d){a.updateColor("linkColor");for(var c={},g=0;g<d.length;g++)c[d[g]]=1;a.svg.selectAll(".link").remove();d=a.metaData.LINKS;g=[];for(var e=0,h=0;h<d.length;h++)(0===a.showAllFromTarget&&"undefined"!==typeof c[d[h].MOD1]&&"undefined"!==typeof c[d[h].MOD2]||1===a.showAllFromTarget&&("undefined"!==typeof c[d[h].MOD1]||"undefined"!==typeof c[d[h].MOD2]))&&a.CorCutoff_min<=Math.abs(d[h].COR)&&Math.abs(d[h].COR)<=a.CorCutoff_max&&(g[e]=d[h],e++);d=g;1E4>d.length&&(c=a.topG.selectAll(".link").data(d,
a.mlinkKey),c.enter().append("line").attr("class","link").attr("pointer-events","none").attr("id",function(l){return"ln_"+that.removeInvalidIDChars(l.MOD1)+that.removeInvalidIDChars(l.MOD2)}).attr("x1",function(l){return d3.select("#mod_"+that.removeInvalidIDChars(l.MOD1)).attr("cx")}).attr("y1",function(l){return d3.select("#mod_"+that.removeInvalidIDChars(l.MOD1)).attr("cy")}).attr("x2",function(l){return d3.select("#mod_"+that.removeInvalidIDChars(l.MOD2)).attr("cx")}).attr("y2",function(l){return d3.select("#mod_"+
that.removeInvalidIDChars(l.MOD2)).attr("cy")}).attr("stroke",a.colorLink).attr("stroke-width",function(l){return Math.abs(l.COR)*a.maxCorWidth}).merge(c))};a.nodeX=function(d,c){d=50;var g=Math.floor(c/a.maxPerLevel)+1;1<g&&(d=60*g);return a.width/2+(a.r-d)*Math.cos(c%a.maxPerLevel*a.angle-1.57079633)};a.nodeY=function(d,c){d=50;c>a.maxPerLevel&&(d=60*(Math.floor(c/a.maxPerLevel)+1));return a.height/2+(a.r-d)*Math.sin(c%a.maxPerLevel*a.angle-1.57079633)};a.nodeXLbl=function(d,c){c=c%a.maxPerLevel*
a.angle-1.57079633;var g=1;if(Math.PI/2<c&&c<1.5*Math.PI){var e=0;"undefined"!==typeof d.MODULE&&(e=d.MODULE.length);g+=7.5*e}return a.width/2+(a.r+g)*Math.cos(c)};a.nodeYLbl=function(d,c){c=c%a.maxPerLevel*a.angle-1.57079633;var g=1;if(Math.PI/2<c&&c<1.5*Math.PI){var e=0;"undefined"!==typeof d.MODULE&&(e=d.MODULE.length);g+=7.5*e}return a.height/2+(a.r+g)*Math.sin(c)};a.drawCorLegend=function(d){a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",d).text("Positive Correlation");
a.legendDispG.append("rect").attr("x","0").attr("y",d-10).attr("width","30").attr("height","10").style("fill",a.posColor);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",d+20).text("Negative Correlation");a.legendDispG.append("rect").attr("x","0").attr("y",d+10).attr("width","30").attr("height","10").style("fill",a.negColor);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",d+40).text("Lower Correlation");a.legendDispG.append("line").attr("x1",
"0").attr("y1",d+30).attr("x2","30").attr("y2",d+30).style("stroke","#000000").style("stroke-width","0");a.legendDispG.append("line").attr("x1","0").attr("y1",d+35).attr("x2","30").attr("y2",d+35).style("stroke","#000000").style("stroke-width","0.5");a.legendDispG.append("line").attr("x1","0").attr("y1",d+40).attr("x2","30").attr("y2",d+40).style("stroke","#000000").style("stroke-width","1");a.legendDispG.append("line").attr("x1","0").attr("y1",d+45).attr("x2","30").attr("y2",d+45).style("stroke",
"#000000").style("stroke-width","2");a.legendDispG.append("line").attr("x1","0").attr("y1",d+55).attr("x2","30").attr("y2",d+55).style("stroke","#000000").style("stroke-width","3");a.legendDispG.append("line").attr("x1","0").attr("y1",d+65).attr("x2","30").attr("y2",d+65).style("stroke","#000000").style("stroke-width","5");a.legendDispG.append("line").attr("x1","0").attr("y1",d+75).attr("x2","30").attr("y2",d+75).style("stroke","#000000").style("stroke-width","7");a.legendDispG.append("text").style("font-size",
"16").attr("x","35").attr("y",d+80).text("Higher Correlation")};a.drawLegend=function(){a.drawCorLegend(20)};a.selectMetaMod=function(d){that.topselectedModule=that.selectedModule;that.selectedModule=that.modules[d];that.topselectedGene=that.selectedGene;that.selectedGene={};for(d=0;d<that.selectedModule.TCList.length;d++)"undefined"===typeof that.selectedGene[that.selectedModule.TCList[d].Gene.ID]&&(that.selectedGene[that.selectedModule.TCList[d].Gene.ID]={},that.selectedGene[that.selectedModule.TCList[d].Gene.ID].geneSymbol=
that.selectedModule.TCList[d].Gene.geneSymbol,that.selectedGene[that.selectedModule.TCList[d].Gene.ID].tcList=[]),that.selectedGene[that.selectedModule.TCList[d].Gene.ID].tcList.push(that.selectedModule.TCList[d]);that.viewType="gene";d3.select("#wgcnaGeneViewRB").property("checked",!0);that.createSingleWGCNAImage()};a.draw=function(){a.updateColor("linkColor");a.width=$(window).width();a.height=Math.floor(.9*window.innerHeight);a.r=a.height>a.width?Math.floor(a.width/2*.95):Math.floor(a.height/2*
.95);a.svg.attr("height",a.height+"px");a.svg.selectAll("circle").remove();a.svg.selectAll("text").remove();a.svg.selectAll("line").remove();a.svg.selectAll(".mod").remove();"undefined"!==typeof a.panZoom&&(a.panZoom.destroy(),delete a.panZoom);a.svg.selectAll(".svg-pan-zoom_viewport").remove();setTimeout(function(){a.svg.append("text").style("font-size","20").attr("y",22).attr("x",5).text(function(){return that.selectedModule?"Meta Module for "+replaceUnderscore(that.selectedModule.MOD_NAME):""});
a.setupLegend();a.data=a.metaData.MODULES;a.angle=2*Math.PI/a.data.length;a.angleDeg=360/a.data.length;a.data.length>a.maxPerLevel&&(a.angle=2*Math.PI/a.maxPerLevel,a.angleDeg=360/a.maxPerLevel);if(150<a.data.length){a.truncated=1;a.maxNodeR=15;for(var d=[],c=0;150>c;c++)d[c]=a.data[c];a.data=d;a.dataIndex={};for(c=0;c<a.data.length;c++)a.dataIndex[a.data[c].ID]=1;a.CorCutoff_min=.75;$("#linkSliderMin").slider("value",.75);$("span#minLabel").html(.75);a.svg.append("image").attr("x",7.8*that.selectedModule.MOD_NAME.length+
20).attr("y",1).attr("width","24px").attr("height","24px").attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAJI0lEQVRIDQEYCef2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAAH/gAACcAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAADwAAALkCAABoFDEx0gIzM+/b29v4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGIAAAAvAgAAHDnn54QGBgY3SUlJBwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8AAB0AAAChAAAADAAAAAAU9vYY4RER/ecNDdLZ2dnvAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB5AAAAFgAAAAAAAAAABv7+BFHZ2UgFAgI4Ozs7DAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAtAAAAmAAAAAQAAAAAAAAAAAAAAAAU9/cM7AoKAOYYGNTZ2dnqAAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAFAAAAnQAAACf8AgIAzhgY/uIODv4V9vYBBP//AR3z8xrKHBzjDhwc2uDg4PYAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASwAAAEUAAAAB+AMDAJwyMveSODjT9QUF+AAAAAAY9PQOTN3dTxISEipAQEAEAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAADAAAAIAAAAAEAAAAAAAAAAAC/v7vAv7+tQn7+/IAAAAAAAAAAT/g4DQd8/NHCgoKFAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGcAAAAuAAAAAAAAAAAAAAAAAAEB+gP//+QF///7AAAAAAAAAAAQ+voIVtfXUggICDM5OTkJAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAP8AABYAAAB4AAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAATXm5iYt6+tMExMTHAAAAAEAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB7AAAAEwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAF/v4CVdfXSw0EBDdAQEALAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAD/AAAzAAAAkwAAAAYAAAAAAAAAAAAAAAAAAQEAAAAA/kDh4QAb8/MpAgAACAAAAAAAAAAAAAAAABT29g7vCAgB4RYW1NnZ2eoAAAD/AAAAAAAAAAAAAAAAAAAAAAD/AAAE/wAAtf8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD/5Q0N7WNKSnFHR0cSAAAAAAAAAAADAAAAAAAAAAAAAAAAgAAATAAAAHkAAAADAAAAAAAAAAAAAAAAAAAAAPgEBP+XMzP7xR8f7ivq6gcH/f0CAAAAAAAAAAAAAAAAAAAAAAz6+gj9AgIM2Bsb0QoKCujn5+f+AgAAAAAAAAAA/wAABwAAAIkAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAD9AQEA1hUV9MwZGccAAAD2AAAAAAAAAAAAAAAAAAAAAAAAAAABAAABR97eNhb390ceHh4RAAAAAAAAAAAAAAAAAP8AAG//AAD+/wAA//8AAP//AAD//wAA//8AAP//AAD//gAA/u4ICPvzBQXw/gAA/P8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP/CHR3SVVBQNgAAAAACAAAAAP8AAAgAAABfAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAER+PgEDPv7DwEAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMOnpJyHy8icAAAAABAAAAAABAAD42BMTgdUTE2buCwsz/QICCQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8BAAD/AAEBAf8AAAEAAAAAAAAAAAAAAAAAAAAAAAAAAPEHB/vhEBANAAAAAAQAAAAAAAAAAHU6OrsDAwPnAgICIQEBAQUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQH//f39zgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAs0IPw6I24JoAAAAASUVORK5CYII=").attr("pointer-events",
"all").style("cursor","pointer").on("mouseover",function(){$("#wgcnaMouseHelp").html("Warning: Modules displayed are truncated to the top 150 most connected modules due to the size of the meta module.")}).on("mouseout",function(){$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")})}else a.maxNodeR=28;a.topG=a.svg.append("g").attr("class","svg-pan-zoom_viewport");d=a.topG.selectAll(".mod").data(a.data,a.modKey);d.enter().append("circle").attr("class",
"mod").attr("id",function(h){return"mod_"+that.removeInvalidIDChars(h.MODULE)}).attr("cx",a.nodeX).attr("cy",a.nodeY).attr("r",3).attr("stroke","#000000").attr("fill","#FF0000").merge(d);d=a.metaData.LINKS;c=[];for(var g=0,e=0;e<d.length;e++)a.CorCutoff_min<=Math.abs(d[e].COR)&&Math.abs(d[e].COR)<=a.CorCutoff_max&&(0===a.truncated||"undefined"!==typeof a.dataIndex[d[e].MOD1]&&"undefined"!==typeof a.dataIndex[d[e].MOD2])&&(c[g]=d[e],g++);d=c;a.showLinks&&1E4>d.length&&(d=a.topG.selectAll(".link").data(d,
a.mlinkKey),d.enter().append("line").attr("class","link").attr("id",function(h){return"ln_"+that.removeInvalidIDChars(h.MOD1)+that.removeInvalidIDChars(h.MOD2)}).attr("x1",function(h){return d3.select("#mod_"+that.removeInvalidIDChars(h.MOD1)).attr("cx")}).attr("y1",function(h){return d3.select("#mod_"+that.removeInvalidIDChars(h.MOD1)).attr("cy")}).attr("x2",function(h){return d3.select("#mod_"+that.removeInvalidIDChars(h.MOD2)).attr("cx")}).attr("y2",function(h){return d3.select("#mod_"+that.removeInvalidIDChars(h.MOD2)).attr("cy")}).attr("stroke",
a.colorLink).attr("stroke-width",function(h){return Math.abs(h.COR)*a.maxCorWidth}).merge(d));a.topG.selectAll(".mod").remove();d=a.topG.selectAll(".mod").data(a.data,a.geneKey);d.enter().append("g").append("circle").attr("cx",a.nodeX).attr("cy",a.nodeY).attr("r",20).attr("stroke","#000000").attr("fill",a.colorCircle).attr("class",function(h){return"mod "+that.removeInvalidIDChars(h.MODULE)}).attr("id",function(h){return"mod_"+that.removeInvalidIDChars(h.MODULE)}).on("click",function(h){that.moduleGenes[h.MODULE]||
(that.moduleGenes[h.MODULE]="",that.requestModule(h.MODULE,a.selectMetaMod))}).on("mouseover",a.mouseoverModule).on("mouseout",a.mouseleaveModule).merge(d).each(function(h,l){d3.select(this.parentNode).append("g").attr("class","label").attr("id",function(n){return"txt_"+that.removeInvalidIDChars(n.MODULE)}).attr("transform",function(){var n=a.nodeXLbl(h,l),q=a.nodeYLbl(h,l);return"translate("+n+","+q+")"}).append("text").attr("transform",function(){var n=-90+l%a.maxPerLevel*a.angleDeg;90<n&&(n-=180);
return"rotate("+n+")"}).text(function(){return h.MODULE})});d.exit().remove()},250)};a.requestMeta=function(){$.ajax({url:pathPrefix+"getWGCNAMetaModules.jsp",type:"GET",async:!0,data:{source:that.selSource,id:replaceUnderscore(that.selectedModule.MOD_NAME),organism,panel:that.panel,tissue:that.tissue,region:that.region,geneList:that.geneList,genomeVer},dataType:"json",success:function(d){setTimeout(function(){a.metaData=d[0];a.draw();that.singleWGCNATableMetaView()},50)},error:function(d,c,g){setTimeout(function(){a.requestMeta()},
2E3)}})};a.mouseoverModule=function(){$("#wgcnaMouseHelp").html("<B>Click</B> to select this module and see additional details.");d3.select(this).style("fill","url(#selectGrad)");tt.transition().duration(200).style("opacity",1);tt.html(a.createToolTip(d3.select(this).datum())).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",function(){return that.positionTTTop(d3.event.pageY)});var d=d3.select(this.parentNode).datum();$("[id^=ln_"+that.removeInvalidIDChars(d.MODULE)+
"]").each(function(){var c=$(this).attr("id");d3.select("line#"+c).attr("stroke",a.colorLinkHighlight)});$("[id$="+that.removeInvalidIDChars(d.MODULE)+"]").each(function(){var c=$(this).attr("id");d3.select("line#"+c).attr("stroke",a.colorLinkHighlight)});a.showLinks||a.drawLinks(d);d3.select("#txt_"+that.removeInvalidIDChars(d.MODULE)).select("text").attr("fill","#00A347");gtag("event","mouseOverModule",{event_category:"wgcna"})};a.mouseleaveModule=function(){var d=d3.select(this.parentNode).datum();
$("[id^=ln_"+that.removeInvalidIDChars(d.MODULE)+"]").each(function(){var c=$(this).attr("id");d3.select("line#"+c).attr("stroke",a.colorLink)});$("[id$="+that.removeInvalidIDChars(d.MODULE)+"]").each(function(){var c=$(this).attr("id");d3.select("line#"+c).attr("stroke",a.colorLink)});d3.select(this).style("fill",a.colorCircle);d3.select("#txt_"+that.removeInvalidIDChars(d.MODULE)).select("text").attr("fill","#000000");tt.transition().duration(500).style("opacity",0);a.showLinks||a.svg.selectAll(".link").remove();
"mir"===that.viewType&&(a.mirTargetID=$("#mirGeneFilterTxt").val().toLowerCase(),a.svg.selectAll(".mirLink").remove(),that.singleImage.drawMiR())};a.createToolTip=function(d){return"Module: "+d.MODULE};return a};that.singleWGCNATableMetaView=function(){$("div#wgcnaModuleTable").hide();$("div#wgcnaMirTable").hide();$("div#wgcnaMirGeneTable").hide();$("div#wgcnaGoTable").hide();$("div#wgcnaEqtlTable").hide()};return that};
