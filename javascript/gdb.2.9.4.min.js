$.cookie.defaults.expires=365;var svgList=[],svgViewIDList=[],processAjax=0,ajaxList=[],trackInfo=[],selectedGeneSymbol="",selectedID="",trackSettings=[],overSelectable=0,zoomUpdateHandle=Math.NaN,ratOnly=[],mouseOnly=[],history=[[],[]],customTrackCount=0,testChrome=/chrom(e|ium)/.test(navigator.userAgent.toLowerCase()),testSafari=/safari/.test(navigator.userAgent.toLowerCase()),testFireFox=/firefox/.test(navigator.userAgent.toLowerCase()),testIE=/(wow|.net|ie)/.test(navigator.userAgent.toLowerCase());
testChrome&&testSafari&&(testSafari=!1);!testIE||testChrome||testFireFox||testSafari||$("#IEproblem").show();ratOnly.snpSHRJ=1;ratOnly.snpF344=1;ratOnly.snpSHRH=1;ratOnly.snpBNLX=1;ratOnly.helicos=1;ratOnly.spliceJnct=1;ratOnly.illuminaTotal=1;ratOnly.illuminaSmall=1;ratOnly.illuminaPolyA=1;ratOnly.liverTotal=1;ratOnly.liverspliceJnct=1;ratOnly.liverilluminaTotalPlus=1;ratOnly.liverilluminaTotalMinus=1;ratOnly.polyASite=1;ratOnly.braincoding=1;ratOnly.brainnoncoding=1;ratOnly.brainsmallnc=1;
ratOnly.heartTotal=1;ratOnly.heartilluminaTotalPlus=1;ratOnly.heartilluminaTotalMinus=1;ratOnly.probe=1;ratOnly.mergedTotal=1;"rn5"===genomeVer&&(mouseOnly.brainTotal=1);mouseOnly.brainilluminaTotalPlus=1;mouseOnly.brainilluminaTotalMinus=1;mouseOnly.brainspliceJnct=1;mouseOnly.probeMouse=1;
var mmVer='Mouse(<span id="verSelect"></span>) Strain:C57BL/6J',rnVer='Rat(<span id="verSelect"></span>) Strain:BN',siteVer="PhenoGen v3.7.1(2/26/2020)",trackBinCutoff=1E4,customTrackLevel=-1,mouseTTOver=0,ttHideHandle=0,tt=d3.select("body").append("div").attr("class","testToolTip").style("z-index",1001).style("opacity",0);tt.append("span").style("float","right").append("img").attr("src","web/images/icons/close.png").on("click",function(){tt.style("opacity",0)});
var tsDialog=d3.select("body").append("div").attr("class","trackSetting").attr("id","trackSettingDialog").style("z-index",1001).style("margin-left","15px").style("margin-right","15px");tsDialog.append("div").attr("id","trackSettingContent").append("table").attr("cellpadding","0").attr("cellspacing","0").append("tbody");
function updatePage(q){var m=Math.round(q.xScale.domain()[0]),r=Math.round(q.xScale.domain()[1]);if((m<q.prevMinCoord||r>q.prevMaxCoord)&&(m<q.dataMinCoord||r>q.dataMaxCoord)){processAjax=1;var u=m;var d=r;m>=q.dataMinCoord&&r>q.dataMaxCoord?u=q.dataMaxCoord+1:m<q.dataMinCoord&&r<=q.dataMaxCoord&&(d=q.dataMinCoord-1);q.setLoading();$.ajax({url:pathPrefix+"updateRegion.jsp",type:"GET",data:{chromosome:chr,minCoord:u,maxCoord:d,fullminCoord:m,fullmaxCoord:r,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,
myOrganism:organism,genomeVer:genomeVer},dataType:"json",success:function(b){q.prevMinCoord=m;q.prevMaxCoord=r;m<q.dataMinCoord&&(q.dataMinCoord=m);r>q.dataMaxCoord&&(q.dataMaxCoord=r);q.folderName=b.folderName;q.updateData();processAjax=0;gtag("event","outsideLoadedRegion",{event_category:"updatePage"})},error:function(b,a,e){console.log(e)}})}}
function back(q){if(history&&history[q]){var m=1<history[q].length?history[q].pop():history[q][0];chr==m.chr&&(m.start==svgList[q].xScale.domain()[0]&&m.stop==svgList[q].xScale.domain()[1]&&(m=1<history[q].length?history[q].pop():history[q][0]),0==q&&$("#geneTxt").val(m.chr+":"+m.start+"-"+m.stop),svgList[q].xScale.domain([m.start,m.stop]),svgList[q].scaleSVG.select(".x.axis").call(svgList[q].xAxis),svgList[q].redraw(),0===q&&updatePage(svgList[q]),svgList[q].updateFullData())}gtag("event","navigateBack",
{event_category:"stepBackSVGNaviation"})}
function zoomIn(q,m){var r={};r.chr=chr;r.start=svgList[q].xScale.domain()[0];r.stop=svgList[q].xScale.domain()[1];var u=Math.floor((r.stop-r.start)*m);1>u&&(u=1);r.start+=u;r.stop-=u;20>r.stop-r.start&&(r.start-=u,r.stop+=u);svgList[q].xScale.domain([r.start,r.stop]);history[q]||(history[q]=[]);history[q].push(r);svgList[q].scaleSVG.select(".x.axis").call(svgList[q].xAxis);svgList[q].redraw();isNaN(zoomUpdateHandle)||(clearTimeout(zoomUpdateHandle),zoomUpdateHandle=Math.NaN);zoomUpdateHandle=setTimeout(function(){0===
q&&updatePage(svgList[q]);svgList[q].updateFullData();0===q&&setTimeout(function(){DisplayRegionReport()},100)},300);0===q&&$("#geneTxt").val(chr+":"+r.start+"-"+r.stop);gtag("event",q,{event_category:"calledZoomIn"})}
function zoomOut(q,m){var r={};r.chr=chr;r.start=svgList[q].xScale.domain()[0];r.stop=svgList[q].xScale.domain()[1];var u=Math.floor((r.stop-r.start)*m);1>u&&(u=1);r.start-=u;r.stop+=u;svgList[q].xScale.domain([r.start,r.stop]);history[q]||(history[q]=[]);history[q].push(r);svgList[q].scaleSVG.select(".x.axis").call(svgList[q].xAxis);svgList[q].redraw();isNaN(zoomUpdateHandle)||(clearTimeout(zoomUpdateHandle),zoomUpdateHandle=Math.NaN);zoomUpdateHandle=setTimeout(function(){0===q&&updatePage(svgList[q]);
svgList[q].updateFullData();0===q&&setTimeout(function(){DisplayRegionReport()},100)},300);0===q&&$("#geneTxt").val(chr+":"+r.start+"-"+r.stop);gtag("event",q,{event_category:"calledZoomOut"})}
function mup(){var q=0;for(q=0;q<svgList.length;q++)if(svgList[q]&&"undefined"!==typeof svgList[q])if(history[q]||0!=q&&1!=q||(history[q]=[]),!(svgList[q].overSettings&&0!=svgList[q].overSettings||isNaN(svgList[q].downx)&&isNaN(svgList[q].downPanx))){if(0===q&&updatePage(svgList[q]),svgList[q].downx=Math.NaN,svgList[q].downPanx=Math.NaN,svgList[q].updateFullData(),0===q&&setTimeout(function(){DisplayRegionReport()},300),0==q||1==q){var m={};m.chr=chr;m.start=svgList[q].xScale.domain()[0];m.stop=svgList[q].xScale.domain()[1];
history[q].push(m)}}else if(!(svgList[q].overSettings&&0!=svgList[q].overSettings||isNaN(svgList[q].downZoomx))){var r=svgList[q].downZoomx;var u=d3.mouse(svgList[q].vis.node());svgList[q].downZoomxEnd=u[0];m=1;u[0]<r?(r=u[0],m=svgList[q].downZoomx-r):m=u[0]-r;u=Math.round(svgList[q].xScale.invert(r));r=Math.round(svgList[q].xScale.invert(r+m));svgList[q].downZoomx=Math.NaN;svgList[q].downZoomxEnd=Math.NaN;0===q&&$("#geneTxt").val(chr+":"+u+"-"+r);d3.select("#Level"+svgList[q].levelNumber).selectAll("svg rect.zoomRect").remove();
d3.select("#Level"+svgList[q].levelNumber).selectAll("svg text#zoomTextStart").remove();d3.select("#Level"+svgList[q].levelNumber).selectAll("svg text#zoomTextEnd").remove();svgList[q].xScale.domain([u,r]);svgList[q].scaleSVG.select(".x.axis").call(svgList[q].xAxis);svgList[q].redraw();svgList[q].updateFullData();0===q&&setTimeout(function(){DisplayRegionReport()},300);if(0==q||1==q)m={},m.chr=chr,m.start=u,m.stop=r,history[q].push(m)}gtag("event","mouseUpFromDrag",{event_category:"dragMouseUp"})}
function mmove(){var q;for(q=0;q<svgList.length;q++)if(svgList[q]&&(!svgList[q].overSettings||0===svgList[q].overSettings))if(!isNaN(svgList[q].downx)){var m=d3.mouse(svgList[q].vis.node());rupx=m[0];if(0!==rupx){var r=Math.round(svgList[q].downscalex.domain()[0]);var u=Math.round(svgList[q].mw*(svgList[q].downx-svgList[q].downscalex.domain()[0])/rupx+svgList[q].downscalex.domain()[0]);u<=svgList[q].xMax&&r>=svgList[q].xMin&&(0===q&&$("#geneTxt").val(chr+":"+r+"-"+u),svgList[q].xScale.domain([r,u]),
svgList[q].scaleSVG.select(".x.axis").call(svgList[q].xAxis),svgList[q].redraw())}}else if(isNaN(svgList[q].downPanx))isNaN(svgList[q].downZoomx)||(d=svgList[q].downZoomx,m=d3.mouse(svgList[q].vis.node()),svgList[q].downZoomxEnd=m[0],m[0]<d?(d=m[0],m=svgList[q].downZoomx-d):m=m[0]-d,r=Math.round(svgList[q].xScale.invert(d)),u=Math.round(svgList[q].xScale.invert(d+m)),d3.select("#Level"+svgList[q].levelNumber).selectAll("svg rect.zoomRect").attr("x",d).attr("width",m),d3.select("#Level"+svgList[q].levelNumber).selectAll("svg text#zoomTextStart").attr("x",
d).attr("y",15).text(numberWithCommas(r)),d3.select("#Level"+svgList[q].levelNumber).selectAll("svg text#zoomTextEnd").attr("x",d+m).attr("y",50).text(numberWithCommas(u)));else if(m=d3.mouse(svgList[q].vis.node()),rupx=m[0],0!==rupx){u=svgList[q].downPanx-rupx;var d=(svgList[q].downscalex.domain()[1]-svgList[q].downscalex.domain()[0])/svgList[q].mw;r=Math.round(svgList[q].downscalex.domain()[0]+u*d);u=Math.round(u*d+svgList[q].downscalex.domain()[1]);u<=svgList[q].xMax&&r>=svgList[q].xMin&&(0===
q&&$("#geneTxt").val(chr+":"+r+"-"+u),svgList[q].xScale.domain([r,u]),svgList[q].scaleSVG.select(".x.axis").call(svgList[q].xAxis),svgList[q].redraw(),svgList[q].downPanx=m[0])}}d3.select("html").on("mousemove",mmove).on("mouseup",mup);$(window).resize(function(){for(var q=0;q<svgList.length;q++)svgList[q]&&svgList[q].resize($(window).width()-25)});
$(document).on("click",".closeBtn",function(){var q=new String($(this).attr("id"));q=q.substr(6);$("."+q).fadeOut("fast");if(-1<q.indexOf("viewsLevel")){var m=q.substr(q.length-1);$("div#nameView"+m).hide();$("div#selection"+m).show();$("span#viewMenuLbl"+m).html("Select/Edit Views");$("div.trackLevel"+m).fadeOut("fast")}gtag("event",q,{event_category:"closeSettings"});return!1});
$(document).on("click",".viewSelect",function(){var q=$(this).attr("id");q=q.substr(q.length-1);if($(".viewsLevel"+q).is(":visible"))$(".viewsLevel"+q).fadeOut("fast");else{var m=$(this).parent().parent().position().top;$(".viewsLevel"+q).css("top",m).css("left",$(window).width()-610);$(".viewsLevel"+q).fadeIn("fast");$("#trackSettingDialog").hide();tt.transition().duration(200).style("opacity",0);gtag("event",q,{event_category:"openViews"})}return!1});
$(document).on("change","input[name='optioncbx']",function(){var q=new String($(this).attr("id")),m=q.indexOf("CBX"),r=new String(q.substr(0,m));m=q.substr(m+3,1);redrawTrack(m,r);gtag("event",q,{event_category:"changeSettingView"})});$(document).on("change","input[name='imgCBX']",function(){var q=new String($(this).attr("id")),m=q.indexOf("CBX");new String(q.substr(0,m));m=q.substr(m+3,1);svgList[m].redraw();setTimeout(function(){DisplayRegionReport()},300);gtag("event",q,{event_category:"clickCbx"})});
$(document).on("click",".reset",function(){var q=new String($(this).attr("id")),m=q.substr(q.length-1);0===q.indexOf("resetImage")?0===m&&($("#geneTxt").val(chr+":"+initMin+"-"+initMax),svgList[0].xScale.domain([initMin,initMax]),svgList[0].scaleSVG.select(".x.axis").call(svgList[0].xAxis),svgList[0].redraw()):0===q.indexOf("resetTracks")&&(svgList[m].removeAllTracks(),setupDefaultView(m));gtag("event",q,{event_category:"resetImage"})});
function numberWithCommas(q){return q.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}
function displayHelpFirstTime(){if(-1===navigator.userAgent.toLowerCase().indexOf("phantomjs"))if($.cookie("genomeBrowserHelp")){var q=$.cookie("genomeBrowserHelp"),m=q.indexOf("v")+1,r=q.indexOf(".",q.indexOf(".")+1);q=q.substr(m,r-m);m=siteVer.indexOf("v")+1;r=siteVer.indexOf(".",siteVer.indexOf(".")+1);m=siteVer.substr(m,r-m);q!==m&&(setTimeout(function(){$("a#fbhelp1").click()},1E3),$.cookie("genomeBrowserHelp",siteVer))}else setTimeout(function(){$("a#fbhelp1").click()},1E3),$.cookie("genomeBrowserHelp",
siteVer)}function removeTrack(q,m){"undefined"!==typeof svgList[q]&&svgList[q].removeTrack(m);gtag("event",q,{event_category:"removeTrack",event_label:m})}function redrawTrack(q,m){svgList[q].redrawTrack(m);gtag("event",q,{event_category:"redrawTrack",event_label:m})}function changeTrackHeight(q,m){if(0<m){var r=m+"px";$("#Scroll"+q).css({"max-height":r,overflow:"auto"})}else $("#Scroll"+q).css({"max-height":"",overflow:"hidden"})}
registerKeyboardHandler=function(q){d3.select(window).on("keydown",q)};function getAllChildrenByName(q,m){var r=[],u=0;if("undefined"!==typeof q&&null!==q&&"undefined"!==typeof q.childNodes)for(var d=q.childNodes,b=0;b<d.length;b++)d.item(b).nodeName==m&&(r[u]=d.item(b),u++);return r}
function getFirstChildByName(q,m){var r=null;if(null!==q&&"undefined"!==typeof q&&"undefined"!==typeof q.childNodes)for(var u=q.childNodes,d=!1,b=0;b<u.length&&!d;b++)u.item(b).nodeName==m&&(r=u.item(b),d=!0);return r}
function getAddMenuDiv(q,m){var r="/"+pathPrefix;""==pathPrefix&&(r="");$.ajax({url:r+"settingsMenu.jsp",type:"GET",cache:!1,data:{level:q,organism:organism,type:m},dataType:"html",success:function(u){$("#imageMenu"+q).remove();d3.select("div#imageMenu").append("div").attr("id","imageMenu"+q);$("#imageMenu"+q).html(u)},error:function(u,d,b){$("#imageMenu"+q).remove();d3.select("div#imageMenu").append("div").attr("id","imageMenu"+q);$("#imageMenu"+q).append('<div class="settingsLevel'+q+'">An error occurred generating this menu.  Please try back later.</div>')},
async:!1})}function loadStateFromString(q,m,r,u){loadSavedConfigTracks(q,r,u);loadImageState(m,r)}
function loadSavedConfigTracks(q,m,r){q=q.split(";");var u=0;r=90>m?svgList[m]:r;for(var d=0;d<q.length;d++){var b=q[d].split(",");if(("Rn"==organism&&"undefined"===typeof mouseOnly[b[0]]||"Mm"==organism&&"undefined"===typeof ratOnly[b[0]])&&""!=b[0]){u++;var a="";if(2<b.length)for(var e=2;e<b.length;e++)a=2==e?b[e]:a+","+b[e];1==m&&(a+=",DrawTrx");r.addTrack(b[0],b[1],a,0)}}0==u&&setupDefaultView(m)}
function loadImageState(q,m){if("undefined"!==typeof q&&""!=q)for(var r=q.split(";"),u=0;u<r.length;u++){var d=r[u].split("=");0==(new String(d[0])).indexOf("displaySelect")&&changeTrackHeight("Level"+m,d[1])}}function calculateBin(q,m){var r=new String(Math.floor(q/m));r=r.substr(0,1)*Math.pow(10,r.length-1);r=Math.floor(r/2);5>r&&(r=0);return r}function key(q){return"undefined"!==typeof q?q.getAttribute("ID"):"unknown"}
function keyName(q){return"undefined"!==typeof q?q.getAttribute("name"):"unknown"}function keyStart(q){return"undefined"!==typeof q?q.getAttribute("start"):"unknown"}function keyTissue(q,m){return"undefined"!==typeof q?q.getAttribute("ID")+m:"unknown"}function keyPos(q){return"undefined"!==typeof q?q.pos:"unknown"}function keyID(q){return"undefined"!==typeof q?q.id:"unknown"}function keySNP(q){return"undefined"!==typeof q?q.getAttribute("strain")+"_"+q.getAttribute("start"):"unknown"}
function GenomeSVG(q,m,r,u,d,b,a,e){var c={isToolTip:0,folderName:"",selectedTrackSetting:"",trackListHash:{},overSettings:0,zoomFactor:.05};c.strainSpecificCountColors=d3.scaleOrdinal(d3.schemeCategory20);0==d&&(c.folderName=regionfolderName);var h={};h.chr=chr;h.start=r;h.stop=u;c.allowSelectGenomeVer="undefined"===typeof e?!0:e;if(20>d){history[d]||(history[d]=[]);try{history[d].push(h)}catch(f){Rollbar.error("history["+d+"] not defined")}}c.get=function(f){return c[f]};c.getTrackData=function(f){for(var g=
[],l=0;l<c.trackList.length;l++)"undefined"!==typeof c.trackList[l]&&c.trackList[l].trackClass==f&&(g=c.trackList[l].data);return g};c.getTrack=function(f){return c.trackListHash[f]};c.addTrackErrorRemove=function(f,g){if("undefined"!==typeof f){var l=g.substr(7);f.select(".infoIcon").style("opacity",0);f.select(".settings").style("opacity",0);f.append("g").attr("class","removeErrorTrack").attr("id","remove"+l+c.levelNumber).attr("transform","translate("+(c.width-40)+",0)").append("image").attr("width",
"16px").attr("height","16px").attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAARBJREFUeNpi/P//PwMlgBHZgNNajGCO6bX/jNgUY5UHGQDCpzSB1Jn/YAxmQ8UJyaNKNitAMJoifPJMIFecvA4ktitCnPT7DwPDJlkG08X/wU4GYRAbJAaWY4CoBetBDoMpjIz/c4rlIKI/v0HohNcQeoEohGbngqjtfcSQ8x8SDiiBCDYkAar41zfUEGSDal7wGq4ZwwC4IT48WKNsypYvKJpBgAVdkbkmkHj3DasBYDk0wIQez+AA+/kPK4YFLNaEBNccC3QhF45kB3IYyBCgGnhiQolnEA3CxhA8mQGCYXwwhqqFpQOwAWBFWDTDEhKGIUjy8KQ6mwG7ZmyGIMtjpAMQjR5V+OQZKc3OAAEGAInHQgT+/r+xAAAAAElFTkSuQmCC").attr("pointer-events",
"all").style("cursor","pointer").on("click",function(n){d3.select(g).remove();gtag("event",g,{event_category:"removeErrorTrack"})}).on("mouseover",function(){c.overSettings=1;$("#mouseHelp").html("");gtag("event",g,{event_category:"mouseHelp"})}).on("mouseout",function(){c.overSettings=0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");gtag("event",g,{event_category:"hideMouseHelp"})})}};c.addTrack=function(f,g,l,n){"Trx"==c.forceDrawAsValue&&-1==
(new String(l)).indexOf("DrawTrx")&&(l=","===l.substr(l.length-1)?l+"DrawTrx,":l+",DrawTrx,");var p=new String(c.folderName);if(0>p.indexOf(chr)||0>p.indexOf(c.xScale.domain()[0]+"_")||0>p.indexOf("_"+c.xScale.domain()[1]))c.folderName="/"+chr+"/"+c.xScale.domain()[0]+"_"+c.xScale.domain()[1],0==c.levelNumber&&regionfolderName!=c.folderName&&(regionfolderName=c.folderName),$.ajax({url:pathPrefix+"getFullPath.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:c.xScale.domain()[0],maxCoord:c.xScale.domain()[1],
panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer},dataType:"json",success:function(E){},error:function(E,D,z){console.log(z)}});p=null;p=d3.select("#Level"+c.levelNumber+f).nodes();if(0===p.length||null==p){p=c.topLevel.append("li").attr("class","draggable"+c.levelNumber).attr("id","li"+f).style("margin-bottom","-3px").append("svg").attr("width",c.width).attr("height",30).attr("class","track").attr("id","Level"+c.levelNumber+f).style("cursor","move").on("mouseover",
function(){0===overSelectable&&("dragzoom"===c.defaultMouseFunct?$("#mouseHelp").html("<B>Zoom:</B> Click and drag to select a region to zoom in. <B>Navigate or Reorder Tracks:</B> Select the appropriate function at the top left of the image."):"pan"===c.defaultMouseFunct?$("#mouseHelp").html("<B>Navigate:</B> Move along Genome by clicking and dragging in desired direction. <B>Zoom or Reorder Tracks:</B> Select the appropriate function at the top left of the image."):"reorder"===c.defaultMouseFunct&&
$("#mouseHelp").html("<B>Reorder Tracks:</B> Click on the track and drag up or down to desired location. <B>Zoom or Navigate:</B> Select the appropriate function at the top left of the image."));gtag("event","",{event_category:"mouseOverTrack"})}).on("mouseout",function(){0===overSelectable&&$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mousemove",function(){d3.event.shiftKey?c.changeTrackCursor("ns-resize"):d3.event.altKey&&"dragzoom"!==
c.defaultMouseFunct?c.changeTrackCursor("crosshair"):d3.event.altKey&&"dragzoom"===c.defaultMouseFunct?c.changeTrackCursor("move"):d3.event.altKey||"dragzoom"!==c.defaultMouseFunct?d3.event.altKey||"dragzoom"===c.defaultMouseFunct||c.changeTrackCursor("move"):c.changeTrackCursor("crosshair")});var t=new String("Loading...");p.append("text").text(t).attr("x",c.width/2-t.length/2*7.5).attr("y",12).attr("id","trkLbl");t=p.append("g").attr("class","infoIcon").attr("transform","translate("+(c.width-20)+
",0)").style("cursor","pointer").attr("track",f).attr("title",f).on("mouseover",function(){var E=$(this).attr("track"),D=trackInfo[E];E=$(this).tooltipster({position:"top-right",maxWidth:250,offsetX:24,offsetY:5,contentAsHTML:!0,interactive:!0,interactiveTolerance:350});E.tooltipster("content",function(){var z="";"undefined"!==typeof D&&"undefined"!==typeof D.Description&&(z=D.Description);return z});E.tooltipster("show");gtag("event",f,{event_category:"trackInfo"})}).on("mouseout",function(){$(this).tooltipster("hide")});
t.append("rect").attr("x",0).attr("y",0).attr("rx",3).attr("ry",3).attr("height",14).attr("width",14).attr("fill","#A7C5E2").attr("stroke","#7795B2");t.append("text").attr("x",2.5).attr("y",12).attr("style","font-family:monospace;font-weight:bold;").attr("fill","#FFFFFF").text("i");p.append("g").attr("class","settings").attr("id",f+"_"+c.levelNumber).attr("transform","translate("+(c.width-40)+",0)").append("image").attr("width","16px").attr("height","16px").attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAAAJdnBBZwAAABAAAAAQAFzGrcMAAAGASURBVCjPlZGxaxNhAMV/9128JF/uLsndaVoPhEopFW2RGAXpKOpQHNwEHXTVf0Chm6OL4OhccFHoYKGFQgMOLoIUEQfBSZCUBtI2yaVt8hwarI6+5cF7v+HBg/+RH1U3q2/+zdxjK0znO0EhWgru20t2J/fZnXInjrYBHAD/ut30OkW3FBURfXrtLDroduf2f4ABaARlLzkdRwFFLCFxFBMdPezDGLj5PT/yMChLNqLm6MDFI2eSvT9Dzj2/qLqu7q4+0mXVlx83BnVdUPrC9wEor6Sa0awW38oCKLy1NqsZpap8AgP5BTgk41fP6QE4u60s4xCwCQArDxofUk2q1i5NAJSmantnlWphvXkXABXf3U6GsSrytwsvC6+CTlWxat2v1+SNR96ZLA9ChSrJyspXqFDlwfkUIAfwcbrvGRwEwAgzEjLDlJ9joPXl6VK639h5cm9rEebfv14emOaZZ9+ck0uUKJTXnretfHvrik7JU+W4+QsCOdzAsOEMT7LfaTGJVMIWBCwAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTAtMDItMTFUMDA6NTM6MDItMDY6MDDZzrlFAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDA5LTA4LTE4VDAyOjI2OjEwLTA1OjAw2ytpkgAAAABJRU5ErkJggg==").attr("pointer-events",
"all").style("cursor","pointer").on("click",function(E){f!=c.selectedTrackSetting?(c.getTrack(f).generateSettingsDiv("div#trackSettingContent"),c.selectedTrackSetting=f,E=$(this).position(),$("#trackSettingDialog").css("top",E.top).css("left",$(window).width()-380),$("#trackSettingDialog").fadeIn("fast")):(c.selectedTrackSetting="",$("#trackSettingDialog").fadeOut("fast"));gtag("event","click",{event_category:"trackSettings"});return!1}).on("mouseover",function(){c.overSettings=1;$("#mouseHelp").html("Track Settings: Click to access track settings or quickly remove the track from the current view.")}).on("mouseout",
function(){c.overSettings=0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")})}if("genomeSeq"==f)p=SequenceTrack(c,f,"Reference Genomic Sequence",l),c.addTrackList(p);else if(-1<f.indexOf("noncoding"))d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/"+f+".xml",function(E,D){if(E)if(60>n){var z=1500;1==n&&(z=2500);setTimeout(function(){c.addTrack(f,g,l,n+1)},z)}else d3.select("#Level"+c.levelNumber+f).select("#trkLbl").text("An errror occurred loading Track:"+
f),d3.select("#Level"+c.levelNumber+f).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+f),"#Level"+c.levelNumber+f);else if(null==D)if(11<=n){z=[];var B=GeneTrack(c,z,f,"Long Non-Coding / Non-PolyA+ Genes",l);c.addTrackList(B)}else setTimeout(function(){c.addTrack(f,g,l,10)},5E3);else{z=D.documentElement.getElementsByTagName("Gene");var G=0,H=D.documentElement.getElementsByTagName("GeneList");0<H.length&&"undefined"!==typeof H[0].getAttribute("ver")&&(G=H[0].getAttribute("ver"));
try{B=GeneTrack(c,z,f,"Long Non-Coding / Non-PolyA+ Genes",l),B.dataVer=G,c.addTrackList(B)}catch(I){}}});else if(-1<f.indexOf("coding"))d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/"+f+".xml",function(E,D){if(E)if(60>n){var z=1500;1==n&&(z=2500);setTimeout(function(){c.addTrack(f,g,l,n+1)},z)}else d3.select("#Level"+c.levelNumber+f).select("#trkLbl").text("An errror occurred loading Track:"+f),d3.select("#Level"+c.levelNumber+f).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+
c.levelNumber+f),"#Level"+c.levelNumber+f);else if(null==D)if(11<=n){z=[];var B=GeneTrack(c,z,f,"Protein Coding / PolyA+",l);c.addTrackList(B)}else setTimeout(function(){c.addTrack(f,g,l,11)},5E3);else{z=D.documentElement.getElementsByTagName("Gene");var G=0,H=D.documentElement.getElementsByTagName("GeneList");0<H.length&&"undefined"!==typeof H[0].getAttribute("ver")&&(G=H[0].getAttribute("ver"));try{B=GeneTrack(c,z,f,"Protein Coding / PolyA+",l),B.dataVer=G,c.addTrackList(B)}catch(I){console.log(I)}}});
else if(-1<f.indexOf("smallnc"))d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/"+f+".xml",function(E,D){if(E){if(0===n){var z=c.xScale.domain()[0],B=c.xScale.domain()[1],G="/"+pathPrefix;pathPrefix||(G="");$.ajax({url:G+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:z,maxCoord:B,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:f,folder:c.folderName},dataType:"json",success:function(H){gtag("event",
"generateTrack"+f,{event_category:"browser"})},error:function(H,I,J){}})}60>n?(z=1500,1==n&&(z=2500),setTimeout(function(){c.addTrack(f,g,l,n+1)},z)):(d3.select("#Level"+c.levelNumber+f).select("#trkLbl").text("An errror occurred loading Track:"+f),d3.select("#Level"+c.levelNumber+f).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+f),"#Level"+c.levelNumber+f))}else if(null==D)11<=n?(z=[],B=GeneTrack(c,z,f,"Small RNA (<200 bp) Genes",l),c.addTrackList(B)):setTimeout(function(){c.addTrack(f,
g,l,11)},5E3);else{z="rn5"===genomeVer?D.documentElement.getElementsByTagName("smnc"):D.documentElement.getElementsByTagName("Gene");try{B=GeneTrack(c,z,f,"Small RNA (<200 bp) Genes",l),c.addTrackList(B),""!=selectGene&&B.setSelected(selectGene)}catch(H){}}});else if(0===f.indexOf("liverTotal")||"heartTotal"===f||0===f.indexOf("brainTotal")||"mergedTotal"===f){var v="Liver Reconstructed";"heartTotal"===f?v="Heart Reconstructed":"brainTotal"===f?v="Whole Brain Reconstructed":"mergedTotal"===f&&(v=
"Merged (Brain,Heart,Liver) Reconstructed");if((0===f.indexOf("liverTotal")||0===f.indexOf("brainTotal"))&&0<f.indexOf("_")){var y=f.substr(f.indexOf("_")+1);v="LEStm"===y?"LE-Stm "+v:"F344Stm"===y?"F344-Stm "+v:v+" v"+y}d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/"+f+".xml",function(E,D){if(E){if(1===n&&("mergedTotal"===f||0===f.indexOf("liverTotal")||0===f.indexOf("brainTotal"))){var z=c.xScale.domain()[0],B=c.xScale.domain()[1],G="/"+pathPrefix;pathPrefix||
(G="");var H=panel;(0===f.indexOf("liverTotal")||0===f.indexOf("brainTotal"))&&0<f.indexOf("_")&&(H=f.substr(f.indexOf("_")+1),"LEStm"===H&&(H="LE-Stm"),"F344Stm"===H&&(H="F344-Stm"));$.ajax({url:G+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:z,maxCoord:B,panel:H,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:f,folder:c.folderName},dataType:"json",success:function(I){gtag("event","generateTrack"+f,{event_category:"browser"})},
error:function(I,J,K){}})}60>n?(z=1500,1==n&&(z=2500),setTimeout(function(){c.addTrack(f,g,l,n+1)},z)):(d3.select("#Level"+c.levelNumber+f).select("#trkLbl").text("An errror occurred loading Track:"+f),d3.select("#Level"+c.levelNumber+f).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+f),"#Level"+c.levelNumber+f))}else if(null==D)11<=n?(z=[],B=GeneTrack(c,z,f,v,l),c.addTrackList(B)):setTimeout(function(){c.addTrack(f,g,l,11)},5E3);else{z=D.documentElement.getElementsByTagName("Gene");
G=0;H=D.documentElement.getElementsByTagName("GeneList");0<H.length&&"undefined"!==typeof H[0].getAttribute("ver")&&(G=H[0].getAttribute("ver"));try{B=GeneTrack(c,z,f,v,l),B.dataVer=G,c.addTrackList(B),""!=selectGene&&B.setSelected(selectGene)}catch(I){}}})}else if(0===f.indexOf("refSeq")){$("#"+f+c.levelNumber+"Select").val();var w=c.xScale.domain()[0],A=c.xScale.domain()[1];y=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/"+f+".xml";d3.xml(y,function(E,D){if(E){console.log(E);
if(0===n){var z="/"+pathPrefix;pathPrefix||(z="");$.ajax({url:z+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:w,maxCoord:A,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:f,folder:c.folderName},dataType:"json",success:function(G){gtag("event","generateTrack"+f,{event_category:"browser"})},error:function(G,H,I){}})}60>n?(z=1500,1===n&&(z=2500),setTimeout(function(){c.addTrack(f,g,l,n+1)},z)):(d3.select("#Level"+
c.levelNumber+f).select("#trkLbl").text("An errror occurred loading Track:"+f),d3.select("#Level"+c.levelNumber+f).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+f),"#Level"+c.levelNumber+f))}else if(null==D)if(11<=n){z=[];var B=RefSeqTrack(c,z,f,"Ref Seq Genes",l);c.addTrackList(B)}else setTimeout(function(){c.addTrack(f,g,l,11)},5E3);else{z=D.documentElement.getElementsByTagName("Gene");try{B=RefSeqTrack(c,z,f,"Ref Seq Genes",l),c.addTrackList(B)}catch(G){console.log(G)}}})}else if(0==
f.indexOf("snp"))w=c.xScale.domain()[0],A=c.xScale.domain()[1],y=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/"+f+".xml",d3.xml(y,function(E,D){if(E){console.log(E);if(0==n){var z="/"+pathPrefix;pathPrefix||(z="");$.ajax({url:z+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:w,maxCoord:A,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:f,folder:c.folderName},dataType:"json",success:function(G){gtag("event",
"generateTrack"+f,{event_category:"browser"})},error:function(G,H,I){}})}60>n?(z=1500,1===n&&(z=2500),setTimeout(function(){c.addTrack(f,g,l,n+1)},z)):(d3.select("#Level"+c.levelNumber+f).select("#trkLbl").text("An errror occurred loading Track:"+f),d3.select("#Level"+c.levelNumber+f).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+f),"#Level"+c.levelNumber+f))}else if(null==D)if(11<=n){z=[];var B=SNPTrack(c,z,f,g,l);c.addTrackList(B)}else setTimeout(function(){c.addTrack(f,
g,l,11)},5E3);else{z=D.documentElement.getElementsByTagName("Snp");try{B=SNPTrack(c,z,f,g,l),c.addTrackList(B)}catch(G){}}});else if("qtl"===f)d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/qtl.xml",function(E,D){if(E)if(60>n){var z=1500;1===n&&(z=2500);setTimeout(function(){c.addTrack(f,g,l,n+1)},z)}else d3.select("#Level"+c.levelNumber+f).select("#trkLbl").text("An errror occurred loading Track:"+f),d3.select("#Level"+c.levelNumber+f).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+
c.levelNumber+f),"#Level"+c.levelNumber+f);else if(null==D)if(11<=n){z=[];var B=QTLTrack(c,z,f,g);c.addTrackList(B)}else setTimeout(function(){c.addTrack(f,g,l,11)},5E3);else{z=D.documentElement.getElementsByTagName("QTL");try{B=QTLTrack(c,z,f,g),c.addTrackList(B)}catch(G){}}});else if("trx"===f)y=getAllChildrenByName(getFirstChildByName(c.selectedData,"TranscriptList"),"Transcript"),p=TranscriptTrack(c,y,f,g),c.addTrackList(p);else if("probe"===f||"probeMouse"==f)d3.xml(dataPrefix+"tmpData/browserCache/"+
genomeVer+"/regionData/"+c.folderName+"/probe.xml",function(E,D){if(E)if(60>n){var z=1500;1===n&&(z=2500);setTimeout(function(){c.addTrack(f,g,l,n+1)},z)}else d3.select("#Level"+c.levelNumber+f).select("#trkLbl").text("An errror occurred loading Track:"+f),d3.select("#Level"+c.levelNumber+f).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+f),"#Level"+c.levelNumber+f);else if(null==D)11<=n?(B=[],z=ProbeTrack(c,B,f,"Affy Exon 1.0 ST Probe Sets",g+","+l),c.addTrackList(z)):setTimeout(function(){c.addTrack(f,
g,l,11)},5E3);else{var B=D.documentElement.getElementsByTagName("probe");try{z=ProbeTrack(c,B,f,"Affy Exon 1.0 ST Probe Sets",g+","+l),c.addTrackList(z)}catch(G){}}});else if("helicos"===f||-1<f.indexOf("illuminaTotal")||-1<f.indexOf("illuminaSmall")||"illuminaPolyA"===f){w=c.xScale.domain()[0];A=c.xScale.domain()[1];var C=calculateBin(A-w,c.width);y=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/tmp/"+w+"_"+A+".count."+f+".xml";0<C&&(w-=w%C,A+=C-A%C,y=dataPrefix+"tmpData/browserCache/"+
genomeVer+"/regionData/"+c.folderName+"/tmp/"+w+"_"+A+".bincount."+C+"."+f+".xml");d3.xml(y,function(E,D){if(E){if(0===n||3===n){var z="/"+pathPrefix;pathPrefix||(z="");tmpPanel=panel;-1<f.indexOf("-")&&(tmpPanel=f.substr(f.indexOf("-")+1));$.ajax({url:z+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:w,maxCoord:A,panel:tmpPanel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:f,folder:c.folderName,binSize:C},dataType:"json",
success:function(G){gtag("event","generateTrack"+f,{event_category:"browser"})},error:function(G,H,I){}});z=1E4}60>n?(z=1E3,0===n&&(z=2500),setTimeout(function(){c.addTrack(f,g,l,n+1)},z)):(d3.select("#Level"+c.levelNumber+f).select("#trkLbl").text("An errror occurred loading Track:"+f),d3.select("#Level"+c.levelNumber+f).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+f),"#Level"+c.levelNumber+f))}else if(null==D)4<=n?(z=[],"helicos"==f?B=HelicosTrack(c,z,f,g):"illuminaTotal"==
f?B=IlluminaTotalTrack(c,z,f,g):"illuminaSmall"==f?B=IlluminaSmallTrack(c,z,f,g):"illuminaPolyA"==f?B=IlluminaPolyATrack(c,z,f,g):"liverilluminaTotalPlus"==f?B=LiverIlluminaTotalPlusTrack(c,z,f,g):"liverilluminaTotalMinus"==f?B=LiverIlluminaTotalMinusTrack(c,z,f,g):"heartilluminaTotalPlus"==f?B=HeartIlluminaTotalPlusTrack(c,z,f,g):"heartilluminaTotalMinus"==f?B=HeartIlluminaTotalMinusTrack(c,z,f,g):"brainilluminaTotalPlus"==f?B=BrainIlluminaTotalPlusTrack(c,z,f,g):"brainilluminaTotalMinus"==f?B=BrainIlluminaTotalMinusTrack(c,
z,f,g):"liverilluminaSmall"==f?B=LiverIlluminaSmallTrack(c,z,f,g):"heartilluminaSmall"==f?B=HeartIlluminaSmallTrack(c,z,f,g):-1<f.indexOf("illuminaTotal")&&(B=StrainSpecificIlluminaTotalTrack(c,z,f,g)),c.addTrackList(B)):setTimeout(function(){c.addTrack(f,g,l,4)},3E3);else{z=D.documentElement.getElementsByTagName("Count");var B;try{"helicos"===f?B=HelicosTrack(c,z,f,g):"illuminaTotal"===f?B=IlluminaTotalTrack(c,z,f,g):"illuminaSmall"===f?B=IlluminaSmallTrack(c,z,f,g):"illuminaPolyA"===f?B=IlluminaPolyATrack(c,
z,f,g):"liverilluminaTotalPlus"===f?B=LiverIlluminaTotalPlusTrack(c,z,f,g):"liverilluminaTotalMinus"===f?B=LiverIlluminaTotalMinusTrack(c,z,f,g):"heartilluminaTotalPlus"===f?B=HeartIlluminaTotalPlusTrack(c,z,f,g):"heartilluminaTotalMinus"===f?B=HeartIlluminaTotalMinusTrack(c,z,f,g):"brainilluminaTotalPlus"===f?B=BrainIlluminaTotalPlusTrack(c,z,f,g):"brainilluminaTotalMinus"===f?B=BrainIlluminaTotalMinusTrack(c,z,f,g):"liverilluminaSmall"===f?B=LiverIlluminaSmallTrack(c,z,f,g):"heartilluminaSmall"===
f?B=HeartIlluminaSmallTrack(c,z,f,g):-1<f.indexOf("illuminaTotal")&&(B=StrainSpecificIlluminaTotalTrack(c,z,f,g)),c.addTrackList(B)}catch(G){}}})}else if(-1<f.indexOf("spliceJnct")){w=c.xScale.domain()[0];A=c.xScale.domain()[1];y=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/"+f+".xml";var F="Brain ";"liverspliceJnct"==f?F="Liver ":"heartspliceJnct"==f&&(F="Heart ");d3.xml(y,function(E,D){if(E){console.log(E);if(0==n){var z="/"+pathPrefix;pathPrefix||(z="");$.ajax({url:z+
"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:w,maxCoord:A,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:f,folder:c.folderName},dataType:"json",success:function(G){gtag("event","generateTrack"+f,{event_category:"browser"})},error:function(G,H,I){}})}60>n?(z=1500,1===n&&(z=2500),setTimeout(function(){c.addTrack(f,g,l,n+1)},z)):(d3.select("#Level"+c.levelNumber+f).select("#trkLbl").text("An errror occurred loading Track:"+
f),d3.select("#Level"+c.levelNumber+f).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+f),"#Level"+c.levelNumber+f))}else if(null==D)if(11<=n){z=[];var B=SpliceJunctionTrack(c,z,f,F+"Splice Junctions",1,"");c.addTrackList(B)}else setTimeout(function(){c.addTrack(f,g,l,11)},5E3);else{z=D.documentElement.getElementsByTagName("Feature");console.log(z);try{B=SpliceJunctionTrack(c,z,f,F+"Splice Junctions",3,""),c.addTrackList(B)}catch(G){console.log(G)}}})}else if("polyASite"==
f)d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/polyASite.xml",function(E,D){if(E)if(60>n){var z=1E3;1===n&&(z=2500);setTimeout(function(){c.addTrack(f,g,l,n+1)},z)}else d3.select("#Level"+c.levelNumber+f).select("#trkLbl").text("An errror occurred loading Track:"+f),d3.select("#Level"+c.levelNumber+f).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+f),"#Level"+c.levelNumber+f);else if(null==D)if(4<=n){z=[];var B=PolyATrack(c,z,f,"Predicted PolyA Sites",
l);c.addTrackList(B)}else setTimeout(function(){c.addTrack(f,g,l,4)},5E3);else{z=D.documentElement.getElementsByTagName("Feature");try{B=PolyATrack(c,z,f,"Predicted PolyA Sites",l),c.addTrackList(B)}catch(G){}}});else if(0===f.indexOf("repeatMask"))$("#"+f+c.levelNumber+"Select").val(),w=c.xScale.domain()[0],A=c.xScale.domain()[1],y=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.folderName+"/"+f+".xml",d3.xml(y,function(E,D){if(E){console.log(E);if(0===n){var z="/"+pathPrefix;pathPrefix||
(z="");$.ajax({url:z+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:w,maxCoord:A,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:f,folder:c.folderName},dataType:"json",success:function(G){gtag("event","generateTrack"+f,{event_category:"browser"})},error:function(G,H,I){}})}60>n?(z=1500,1===n&&(z=2500),setTimeout(function(){c.addTrack(f,g,l,n+1)},z)):(d3.select("#Level"+c.levelNumber+f).select("#trkLbl").text("An errror occurred loading Track:"+
f),d3.select("#Level"+c.levelNumber+f).attr("height",15),c.addTrackErrorRemove(d3.select("#Level"+c.levelNumber+f),"#Level"+c.levelNumber+f))}else if(null==D)if(11<=n){z=[];var B=RepeatMaskTrack(c,z,f,"Repeat Masker",g,l);c.addTrackList(B)}else setTimeout(function(){c.addTrack(f,g,l,11)},5E3);else{z=D.documentElement.getElementsByTagName("Feature");try{B=RepeatMaskTrack(c,z,f,"Repeat Masker",g,l),c.addTrackList(B)}catch(G){console.log(G)}}});else if(0==f.indexOf("custom"))if(p=trackInfo[f],l=l+",Name="+
p.Name,l="DataFile="+p.Location+","+l,"bed"==p.Type||"bb"==p.Type)y=[],p=CustomTranscriptTrack(c,y,f,p.Name,3,l),c.addTrackList(p),p.updateFullData(0,0);else{if("bg"==p.Type||"bw"==p.Type)y=[],p=CustomCountTrack(c,y,f,3,l),c.addTrackList(p)}else 0<=f.indexOf("cirRNA")&&(p=trackInfo[f],p=CircRNATrack(c,y,f,p.Name,3,l),c.addTrackList(p));$(".sortable"+c.levelNumber).sortable("refresh");gtag("event",f,{event_category:"trackAdded"})};c.addTrackList=function(f){null!=f&&(c.trackList[c.trackCount]=f,c.trackCount++,
c.trackListHash[f.trackClass]=f,setTimeout(function(){DisplayRegionReport()},300))};c.updateLinks=function(){1===c.levelNumber&&d3.select("#probeSetDetailLink1").each(function(){var f=new String(d3.select(this).attr("href"));f=f.substr(0,f.lastIndexOf("=")+1);f+=c.currentView.ViewID;d3.select(this).attr("href",f)})};c.changeTrackHeight=function(f,g){0<g?d3.select("#"+f+"Scroll").style("max-height",g+"px").style("overflow","auto"):d3.select("#"+f+"Scroll").style("max-height","none").style("overflow",
"hidden")};c.removeAllTracks=function(){d3.selectAll("li.draggable"+c.levelNumber).remove();c.trackList=[];setTimeout(function(){DisplayRegionReport()},300);gtag("event",c.levelNumber,{event_category:"SVGremoveAllTracks"})};c.removeTrack=function(f){d3.select("#Level"+c.levelNumber+f).remove();for(var g=0;g<c.trackList.length;g++)"undefined"!==typeof c.trackList[g]&&c.trackList[g].trackClass==f&&(c.trackList.splice(g,1),c.trackCount--);c.trackListHash[f]=void 0;setTimeout(function(){DisplayRegionReport()},
300);gtag("event",c.levelNumber,{event_category:"removeTrack",event_label:f})};c.redrawTrack=function(f){for(var g=0;g<c.trackList.length;g++)"undefined"!==typeof c.trackList[g]&&c.trackList[g].trackClass==f&&c.trackList[g].redraw();setTimeout(function(){DisplayRegionReport()},300)};c.redraw=function(){for(var f=0;f<c.trackList.length;f++)"undefined"!==typeof c.trackList[f]&&"undefined"!==typeof c.trackList[f].redraw&&c.trackList[f].redraw();c.selectSvg.redraw()};c.update=function(){for(var f=0;f<
c.trackList.length;f++)"undefined"!==typeof c.trackList[f].update&&c.trackList[f].update();setTimeout(function(){DisplayRegionReport()},300);gtag("event","genomeSVG.update",{event_category:"gsvgUpdate"})};c.updateData=function(){for(var f=0;f<c.trackList.length;f++)"undefined"!==typeof c.trackList[f]&&"undefined"!==typeof c.trackList[f].updateData&&c.trackList[f].updateData(0);c.updateFullData();setTimeout(function(){DisplayRegionReport()},300);gtag("event","genomeSVG.updateData",{event_category:"gsvgUpdateData"})};
c.updateFullData=function(){-1<(new String(c.folderName)).indexOf("img")&&(c.folderName="/"+chr+"/"+c.xScale.domain()[0]+"_"+c.xScale.domain()[1],0==c.levelNumber&&regionfolderName!=c.folderName&&(regionfolderName=c.folderName),setTimeout(function(){DisplayRegionReport()},300));for(var f=0;f<c.trackList.length;f++)"undefined"!==typeof c.trackList[f]&&"undefined"!==typeof c.trackList[f].updateFullData&&c.trackList[f].updateFullData(0,1);gtag("event","genomeSVG.updateFullData",{event_category:"gsvgUpdateFullData"})};
c.setLoading=function(){for(var f=0;f<c.trackList.length;f++)"undefined"===typeof c.trackList[f]||"undefined"===typeof c.trackList[f].updateData&&"undefined"===typeof c.trackList[f].updateFullData||c.trackList[f].showLoading()};c.clearSelection=function(){c.selectionStart=-1;c.selectionEnd=-1;c.scaleSVG.selectAll("rect.selectedArea").remove();c.selectSvg.setVis(!1);for(var f=0;f<c.trackList.length;f++)"undefined"!==typeof c.trackList[f]&&"undefined"!==typeof c.trackList[f].clearSelection&&c.trackList[f].clearSelection()};
c.mdown=function(){if(0==c.overSettings)if("dragzoom"!==c.defaultMouseFunct&&d3.event.altKey||"dragzoom"===c.defaultMouseFunct&&!d3.event.altKey){var f=d3.mouse(c.vis.node());c.downZoomx=f[0];c.scaleSVG.append("rect").attr("class","zoomRect").attr("x",f[0]).attr("y",0).attr("height",c.scaleSVG.attr("height")).attr("width",1).attr("fill","#CECECE").attr("opacity",.3);c.scaleSVG.append("text").attr("id","zoomTextStart").attr("x",c.downZoomx).attr("y",15).text(numberWithCommas(Math.round(c.xScale.invert(c.downZoomx))));
c.scaleSVG.append("text").attr("id","zoomTextEnd").attr("x",c.downZoomx).attr("y",50).text(numberWithCommas(Math.round(c.xScale.invert(c.downZoomx))))}else 0==processAjax&&(c.prevMinCoord=c.xScale.domain()[0],c.prevMaxCoord=c.xScale.domain()[1],f=d3.mouse(c.vis.node()),c.downx=c.xScale.invert(f[0]),c.downscalex=c.xScale)};c.forceDrawAs=function(f){for(var g=0;g<c.trackList.length;g++)"undefined"!==typeof c.trackList[g]&&"undefined"!==typeof c.trackList[g].drawAs&&(c.trackList[g].drawAs=f,c.trackList[g].draw(c.trackList[g].data));
c.forceDrawAsValue=f};c.resize=function(f){c.width=f;c.xScale.range([0,c.width]);c.xAxis=d3.axisTop(c.xScale).ticks(6).tickSize(8).tickPadding(10);c.scaleSVG.attr("width",c.width);c.scaleSVG.select(".x.axis").call(c.xAxis);d3.select("#Level"+c.levelNumber).select(".axisLbl").attr("x",(c.width-2*c.margin)/2);c.topLevel.style("width",c.width+18+"px");for(var g=0;g<c.trackList.length;g++)"undefined"!==typeof c.trackList[g]&&"undefined"!==typeof c.trackList[g].redraw&&c.trackList[g].resize();c.selectSvg.width=
f;c.selectSvg.draw()};c.updateCountScales=function(f,g){for(var l=0;l<c.trackList.length;l++)"undefined"!==typeof c.trackList[l]&&"undefined"!==typeof c.trackList[l].updateCountScale&&c.trackList[l].updateCountScale(f,g)};c.resetDefaultMouse=function(f){var g="/web/images/icons/"+f+"_dark.png";d3.select("span#"+f+c.levelNumber+" img").attr("src",g);d3.select("span#"+f+c.levelNumber).style("background","#DCDCDC")};c.changeTrackCursor=function(f){for(var g=0;g<c.trackList.length;g++)"undefined"!==typeof c.trackList[g]&&
"undefined"!==typeof c.trackList[g].svg&&c.trackList[g].svg.style("cursor",f)};c.changeScaleCursor=function(f){"undefined"!==typeof c.scaleSVG&&c.scaleSVG.style("cursor",f)};c.updateTrackSelectedArea=function(f,g){c.selectionStart=f;c.selectionEnd=g;var l=c.xScale(f),n=c.xScale(g)-l;c.scaleSVG.selectAll("rect.selectedArea").remove();if((0<l||0<l+n)&&l<c.width)for(1>n&&(n=1),c.scaleSVG.append("rect").attr("class","selectedArea").attr("x",l).attr("y",15).attr("height",c.scaleSVG.attr("height")-15).attr("width",
n).attr("fill","#CECECE").attr("opacity",.3).attr("pointer-events","none"),l=0;l<c.trackList.length;l++)"undefined"!==typeof c.trackList[l]&&"undefined"!==typeof c.trackList[l].setSelectedArea&&c.trackList[l].setSelectedArea(f,g)};c.getAddMenus=function(){var f="/"+pathPrefix;""==pathPrefix&&(f="");$.ajax({url:f+"trackMenu.jsp",type:"GET",cache:!1,data:{level:c.levelNumber,organism:organism},dataType:"html",success:function(g){$("#trackMenu"+c.levelNumber).remove();d3.select("div#trackMenu").append("div").attr("id",
"trackMenu"+c.levelNumber);$("#trackMenu"+c.levelNumber).html(g)},error:function(g,l,n){$("#trackMenu"+c.levelNumber).remove();d3.select("div#trackMenu").append("div").attr("id","trackMenu"+c.levelNumber);$("#trackMenu"+c.levelNumber).append('<div class="viewsLevel'+c.levelNumber+'">An error occurred generating this menu.  Please try back later.</div>')},async:!1});$.ajax({url:f+"viewMenu.jsp",type:"GET",cache:!1,data:{level:c.levelNumber,organism:organism},dataType:"html",success:function(g){$("#viewMenu"+
c.levelNumber).remove();d3.select("div#viewMenu").append("div").attr("id","viewMenu"+c.levelNumber);$("#viewMenu"+c.levelNumber).html(g)},error:function(g,l,n){$("#viewMenu"+c.levelNumber).remove();d3.select("div#viewMenu").append("div").attr("id","viewMenu"+c.levelNumber);$("#viewMenu"+c.levelNumber).append('<div class="viewsLevel'+c.levelNumber+'">An error occurred generating this menu.  Please try back later.</div>')},async:!1})};c.zoomMenuChange=function(f){d3.select("#zoomSelectMenu"+c.levelNumber).selectAll("li").style("background",
"#FFFFFF");c.zoomFactor=parseFloat(d3.select(f).attr("value"));d3.select(f).style("background","#CECECE")};c.setupFunctionBar=function(){d3.selectAll("span.shrt-button").on("click",function(){nameSpan=d3.select(this).attr("name");-1<nameSpan.toLowerCase().indexOf("gene")?(console.log(":"+selectedID+":"),""!==selectedID?($("div#selectedDetail").is(":visible")||0!==selectedID.indexOf("ENS")||c.getTrack("ensemblcoding").setSelected(selectedID),$("span[name='"+nameSpan+"']").click(),$("html, body").animate({scrollTop:$("#selectedReport").offset().top},
1E3)):alert("You must select a gene from an Ensembl Track before clicking on the gene shortcut.")):($("span.closeDetail").click(),$("span#"+nameSpan).click(),$("html, body").animate({scrollTop:$("#regionDiv").offset().top},1E3))});d3.select(q).select("#functLevel"+c.levelNumber).remove();c.functionBar=c.vis.append("div").attr("class","functionBar").attr("id","functLevel"+c.levelNumber).style("float","left");var f=c.functionBar.append("div").attr("class","defaultMouse").attr("id","defaultMouse"+c.levelNumber);
f.append("span").attr("id","dragzoom"+c.levelNumber).style("height","24px").style("display","inline-block").style("cursor","pointer").append("img").attr("class","mouseOpt dragzoom").attr("src","/web/images/icons/dragzoom_dark.png").attr("pointer-events","all").on("click",function(){c.resetDefaultMouse(c.defaultMouseFunct);c.defaultMouseFunct="dragzoom";d3.select(this).attr("src","/web/images/icons/dragzoom_white.png");d3.select("span#dragzoom"+c.levelNumber).style("background","#989898");c.changeTrackCursor("crosshair");
c.changeScaleCursor("crosshair");gtag("event","",{event_category:"clickDragZoom"})}).on("mouseout",function(){"dragzoom"!=c.defaultMouseFunct&&(d3.select(this).attr("src","/web/images/icons/dragzoom_dark.png"),d3.select("span#dragzoom"+c.levelNumber).style("background","#DCDCDC"))}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/dragzoom_white.png");d3.select("span#dragzoom"+c.levelNumber).style("background","#989898");$("#mouseHelp").html("Click to set default mouse function to allow click and drag to select a region to zoom in on.")});
f.append("span").attr("id","pan"+c.levelNumber).style("height","24px").style("display","inline-block").style("cursor","pointer").append("img").attr("class","mouseOpt pan").attr("src","/web/images/icons/pan_dark.png").attr("pointer-events","all").on("click",function(){c.resetDefaultMouse(c.defaultMouseFunct);c.defaultMouseFunct="pan";d3.select(this).attr("src","/web/images/icons/pan_white.png");d3.select("span#pan"+c.levelNumber).style("background","#989898");c.changeTrackCursor("move");c.changeScaleCursor("ew-resize");
gtag("event","",{event_category:"clickPan"})}).on("mouseout",function(){"pan"!=c.defaultMouseFunct&&(d3.select(this).attr("src","/web/images/icons/pan_dark.png"),d3.select("span#pan"+c.levelNumber).style("background","#DCDCDC"))}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/pan_white.png");d3.select("span#pan"+c.levelNumber).style("background","#989898");$("#mouseHelp").html("Click to set default mouse function to allow click and drag to navigate along the genome.")});
f.append("span").attr("id","reorder"+c.levelNumber).style("height","24px").style("display","inline-block").style("cursor","pointer").append("img").attr("class","mouseOpt pan").attr("src","/web/images/icons/reorder_dark.png").attr("pointer-events","all").on("click",function(){c.resetDefaultMouse(c.defaultMouseFunct);c.defaultMouseFunct="reorder";d3.select(this).attr("src","/web/images/icons/reorder_white.png");d3.select("span#reorder"+c.levelNumber).style("background","#989898");c.changeTrackCursor("ns-resize");
c.changeScaleCursor("ew-resize");gtag("event","",{event_category:"clickReorder"})}).on("mouseout",function(){"reorder"!=c.defaultMouseFunct&&(d3.select(this).attr("src","/web/images/icons/reorder_dark.png"),d3.select("span#reorder"+c.levelNumber).style("background","#DCDCDC"))}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/reorder_white.png");d3.select("span#reorder"+c.levelNumber).style("background","#989898");$("#mouseHelp").html("Click to set default mouse function to reorder image tracks. <strong>Optionally hold down shift in any mode.</strong>")});
$("span#"+c.defaultMouseFunct+c.levelNumber+" img").click();c.functionBar.append("span").attr("class","saveImage control").style("display","inline-block").attr("id","saveLevel"+c.levelNumber).style("cursor","pointer").append("img").attr("src","/web/images/icons/savePic_dark.png").attr("pointer-events","all").attr("cursor","pointer").on("click",function(){var g=$(this).parent().attr("id"),l=(new String(g)).substr(9);g=$("div#Level"+l).html();$.ajax({url:pathPrefix+"saveBrowserImage.jsp",type:"POST",
contentType:"text/html",data:g+"\n",processData:!1,dataType:"json",success:function(n){var p=new Date;p=p.getMonth()+1+"_"+p.getDate()+"_"+p.getFullYear();var t="http://";"https:"===location.protocol&&(t="https://");var v=t+urlprefix+"/tmpData/download/"+n.imageFile;n=new String($("#geneTxt").val());n=n.replace(/:/g,"_");n=n.replace(/-/g,"_");n=n.replace(/,/g,"");"Level1"==l&&(n=svgList[1].selectedData.getAttribute("geneSymbol"));var y=n+"_"+p+".png",w=new XMLHttpRequest;w.open("GET",v);w.responseType=
"blob";w.send();w.onreadystatechange=function(){if(4!=w.readyState||200!=w.status)return!1;var A=document.createElement("a");A.href=window.URL.createObjectURL(w.response);A.download=y;A.style.display="none";document.body.appendChild(A);try{A.click()}catch(C){$("#mouseHelp").html("<span style='color:#FF0000;'>Your browser will not save the image directly. Image will open in a popup, in the new window right click to save image.</span>"),window.open(v)}return!0};gtag("event","saveBrowserImage",{event_category:"browser"})},
error:function(n,p,t){console.log(t)}});gtag("event","",{event_category:"saveImage"})}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/savePic_white.png");d3.select("span#savePic"+c.levelNumber).style("background","#DCDCDC");$("#mouseHelp").html("Click to download a PNG image of the current view.")}).on("mouseout",function(){d3.select(this).attr("src","/web/images/icons/savePic_dark.png");d3.select("span#savePic"+c.levelNumber).style("background","#989898");$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});
c.functionBar.append("span").attr("class","reset control").style("display","inline-block").attr("id","resetImage"+c.levelNumber).style("cursor","pointer").append("img").attr("src","/web/images/icons/reset_dark.png").attr("pointer-events","all").attr("cursor","pointer").on("click",function(){var g=new String($(this).parent().attr("id"));g=g.substr(g.length-1);0==g?($("#geneTxt").val(chr+":"+initMin+"-"+initMax),svgList[0].xScale.domain([initMin,initMax]),svgList[0].scaleSVG.select(".x.axis").call(svgList[0].xAxis),
svgList[0].redraw()):(svgList[g].xScale.domain([svgList[g].initMin,svgList[g].initMax]),svgList[g].scaleSVG.select(".x.axis").call(svgList[g].xAxis),svgList[g].redraw());svgList[0].updateFullData();gtag("event","",{event_category:"clickResetImage"})}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/reset_white.png");d3.select("span#reset"+c.levelNumber).style("background","#DCDCDC");$("#mouseHelp").html("Click to reset image zoom to initial region.")}).on("mouseout",function(){d3.select(this).attr("src",
"/web/images/icons/reset_dark.png");d3.select("span#reset"+c.levelNumber).style("background","#989898");$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});c.functionBar.append("span").attr("class","back control").style("display","inline-block").attr("id","backButton"+c.levelNumber).style("cursor","pointer").append("img").attr("src","/web/images/icons/back_dark2.png").attr("pointer-events","all").attr("cursor","pointer").on("click",function(){back(c.levelNumber);
gtag("event","",{event_category:"clickBack"})}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/back_white2.png");$("#mouseHelp").html("Click to undo last zoom/pan.")}).on("mouseout",function(){d3.select(this).attr("src","/web/images/icons/back_dark2.png");$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});f=c.functionBar.append("span").style("display","inline-block").style("position","relative").style("top","-9px").attr("id",
"zoom"+c.levelNumber);f.append("button").attr("id","zoomInButton"+c.levelNumber).attr("class","zoomIn").style("height","2.3em").append("img").style("position","relative").style("top","-5px").attr("src","/web/images/icons/magPlus_dark_32.png").attr("pointer-events","all").attr("cursor","pointer");f.append("button").attr("id","zoomOutButton"+c.levelNumber).attr("class","zoomOut").style("height","2.3em").append("img").style("position","relative").style("top","-5px").attr("src","/web/images/icons/magMinus_dark_32.png").attr("pointer-events",
"all").attr("cursor","pointer");f.append("button").attr("id","zoomMenuSelect"+c.levelNumber).attr("class","zoomSelectMenu");testChrome?(console.log("CHROME"),d3.select("#zoomSelect"+c.levelNumber).style("height","2.3em")):testSafari&&d3.select("#zoomSelect"+c.levelNumber).style("height","2.3em");f=c.functionBar.append("ul").attr("id","zoomSelectMenu"+c.levelNumber);f.append("li").attr("id","zoom1"+c.levelNumber).attr("value","0.025").on("click",function(){c.zoomMenuChange(this)}).text("0.5x");f.append("li").attr("id",
"zoom2"+c.levelNumber).attr("value","0.05").style("background","#CECECE").on("click",function(){c.zoomMenuChange(this)}).text("1x");f.append("li").attr("id","zoom3"+c.levelNumber).attr("value","0.1").on("click",function(){c.zoomMenuChange(this)}).text("2x");f.append("li").attr("id","zoom4"+c.levelNumber).attr("value","0.25").on("click",function(){c.zoomMenuChange(this)}).text("5x");f.append("li").attr("id","zoom5"+c.levelNumber).attr("value","0.5").on("click",function(){c.zoomMenuChange(this)}).text("10x");
$("#zoomInButton"+c.levelNumber).button().click(function(){zoomIn(c.levelNumber,c.zoomFactor);gtag("event","",{event_category:"clickZoomIn"})}).on("mouseover",function(){$(this).css("background","#989898");$("img",this).attr("src","/web/images/icons/magPlus_light_32.png");$("#mouseHelp").html("Click to zoom in on the center of the region.  Click and drag the scale to zoom in or out more quickly or select the region select tool to highlight a specific region.")}).on("mouseout",function(){$(this).css("background",
"#e6e6e6");$("img",this).attr("src","/web/images/icons/magPlus_dark_32.png");$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).next().button().click(function(){zoomOut(c.levelNumber,c.zoomFactor);gtag("event","",{event_category:"clickZoomOut"})}).on("mouseover",function(){$(this).css("background","#989898");$("img",this).attr("src","/web/images/icons/magMinus_light_32.png");$("#mouseHelp").html("Click to zoom out from the center of the region.  Click and drag the scale to zoom in or out more quickly or select the region select tool to highlight a specific region.")}).on("mouseout",
function(){$(this).css("background","#e6e6e6");$("img",this).attr("src","/web/images/icons/magMinus_dark_32.png");$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).next().button({text:!1,icons:{primary:"ui-icon-triangle-1-s"}}).click(function(){var g=$(this).parent().next().show().position({my:"left top",at:"left bottom",of:this});$(document).on("click",function(){g.hide()});return!1}).parent().buttonset().next().hide().menu()};c.generateSettingsString=
function(){ret="";$("#ScrollLevel"+c.levelNumber+" li.draggable"+c.levelNumber).each(function(){var f=new String($(this).attr("id"));f=f.substr(2);"undefined"!==typeof c.trackListHash[f]&&(ret+=c.trackListHash[f].generateTrackSettingString())});return ret};c.setCurrentViewModified=function(){c.currentView.modified=1;$("span#viewModifiedCtl"+c.levelNumber).show()};c.clearCurrentView=function(){c.currentView.modified=0;$("span#viewModifiedCtl"+c.levelNumber).hide()};c.type=a;c.div=q;c.margin=0;c.halfWindowWidth=
$(window).width()/2;c.mh=400;c.downx=Math.NaN;c.downscalex;c.downPanx=Math.NaN;c.downZoomx=Math.NaN;c.downZoomxEnd=Math.NaN;c.defaultMouseFunct="pan";c.xMax=29E7;c.xMin=1;c.prevMinCoord=r;c.prevMaxCoord=u;c.initMin=r;c.initMax=u;c.dataMinCoord=r;c.dataMaxCoord=u;c.y=0;c.xScale=null;c.xAxis=null;c.vis=null;c.level=null;c.svg=null;c.txType=null;c.txList=null;c.tt=null;c.trackList=[];c.trackCount=0;c.levelNumber=d;c.selectedData=null;c.txType=null;c.selectionStart=-1;c.selectionEnd=-1;c.scrollSize=350;
c.width=m;c.mw=c.width-c.margin;d3.select(q).select("#viewsLevel"+d).remove();d3.select(q).select("#Level"+d).remove();c.vis=d3.select(q);c.setupFunctionBar();0==$("#viewSelect"+c.levelNumber).length&&(m=c.vis.append("div").style("float","right").style("display","inline-block").style("margin-right","5px"),a=m.append("div"),a.append("button").attr("id","viewSelect"+c.levelNumber).attr("class","viewSelect").text("Select/Edit Views").on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",
function(){$("#mouseHelp").html("Click to select another view or edit the current view.")}),a.append("button").attr("id","viewMenuSelect"+c.levelNumber).attr("class","viewSelectMenu").on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",function(){$("#mouseHelp").html("Click for options to quickly save and delete your current view.")}),testChrome?d3.select("#viewSelect"+c.levelNumber).style("height","2.3em"):
testSafari?d3.select("#viewSelect"+c.levelNumber).style("height","2.3em"):testFireFox||testIE&&d3.select("#viewSelect"+c.levelNumber).style("position","relative").style("top","-8px").style("height","2.3em"),m=m.append("ul").attr("id","viewSelectMenu"+c.levelNumber),m.append("li").attr("id","menusaveView"+c.levelNumber).on("click",function(){viewMenu[c.levelNumber].saveView(c.currentView.ViewID,c,!1);$("#viewModifiedCtl"+c.level).hide();gtag("event","",{event_category:"menuSaveView"})}).text("Save"),
m.append("li").attr("id","menusaveAsView"+c.levelNumber).on("click",function(){viewMenu[c.levelNumber].saveAsView(c.currentView,svgList[c.levelNumber]);$(".viewsLevel"+c.levelNumber).css("top",250).css("left",$(window).width()-610);$(".viewsLevel"+c.levelNumber).fadeIn("fast");$("#viewModifiedCtl"+c.level).hide();gtag("event","",{event_category:"menuSaveAsView"})}).text("Save As"),m.append("li").attr("id","menudeleteView"+c.levelNumber).on("click",function(){viewMenu[c.levelNumber].confirmDeleteView(c.currentView);
$(".viewsLevel"+c.levelNumber).css("top",250).css("left",$(window).width()-610);$(".viewsLevel"+c.levelNumber).fadeIn("fast");gtag("event","",{event_category:"menuDeleteView"})}).text("Delete"),$("#viewSelect"+c.levelNumber).button().click(function(){}).next().button({text:!1,icons:{primary:"ui-icon-triangle-1-s"}}).click(function(){var f=$(this).parent().next().show().position({my:"left top",at:"left bottom",of:this});$(document).on("click",function(){f.hide()});return!1}).parent().buttonset().next().hide().menu(),
c.vis.append("span").style("float","right").style("margin-right","5px").append("span").attr("id","mainAddTrack"+c.levelNumber).attr("class","control").style("height","24px").style("display","inline-block").style("cursor","pointer").append("img").attr("class","mainAddTrack").attr("src","/web/images/icons/addTrack_dark_32.png").attr("pointer-events","all").style("height","37px").style("position","relative").style("top","-8px").on("click",function(){if($(".trackLevel"+c.levelNumber).is(":visible"))$(".trackLevel"+
c.levelNumber).fadeOut("fast");else{var f=$(this).parent().parent().position();trackMenu[c.levelNumber].standalone=!0;$(".trackLevel"+c.levelNumber).css("top",f.top).css("left",f.left+-561);$(".trackLevel"+c.levelNumber+" span#selectedViewName").html(c.currentView.Name);$(".trackLevel"+c.levelNumber).fadeIn("fast");$("div#selectTrack"+c.levelNumber).show();$("div#addUsrTrack"+c.levelNumber).hide();$("div#addUsrTrack"+c.levelNumber).hide();$("div#deleteUsrTrack"+c.levelNumber).hide();setTimeout(function(){trackMenu[c.levelNumber].generateTrackTable()},
250);gtag("event","",{event_category:"clickAddTrack"})}}).on("mouseout",function(){d3.select(this).attr("src","/web/images/icons/addTrack_dark_32.png");d3.select("span#mainAddTrack"+c.levelNumber).style("background","#DCDCDC");$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/addTrack_light_32.png");d3.select("span#mainAddTrack"+c.levelNumber).style("background","#989898");$("#mouseHelp").html("Click to quickly add other tracks to the current view.")}),
m=c.vis.append("span").style("float","right").style("margin-right","5px"),m.append("input").attr("type","checkbox").attr("name","imgCBX").attr("id","forceTrxCBX"+c.levelNumber),m.append("label").attr("for","forceTrxCBX"+c.levelNumber).text("Draw Genes as Transcripts").on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",function(){$("#mouseHelp").html("Click to display Gene Tracks as Transcripts. Note: in smaller regions this occurs automatically.")}),
$("input#forceTrxCBX"+c.levelNumber).button(),m=c.vis.append("span").style("float","right").style("margin-right","5px"),a=m.append("div").attr("class","defaultMouse").style("width","64px").attr("id","scrollSize"+c.levelNumber),a.append("span").attr("id","scrollIncr"+c.levelNumber).style("height","24px").style("display","inline-block").style("cursor","pointer").append("img").attr("class","mouseOpt ").attr("src","/web/images/icons/scroll_smaller.png").attr("pointer-events","all").on("click",function(){c.scrollSize-=
100;100>c.scrollSize&&(c.scrollSize=100);changeTrackHeight("Level"+c.levelNumber,c.scrollSize);gtag("event","",{event_category:"changeScrollHeight"})}).on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",function(){$("#mouseHelp").html("Decrease the vertical length of the scrollable browser image on the page.")}),a.append("span").attr("id","pan"+c.levelNumber).style("height","24px").style("display","inline-block").style("cursor",
"pointer").append("img").attr("class","mouseOpt pan").attr("src","/web/images/icons/scroll_larger.png").attr("pointer-events","all").on("click",function(){0<$("#ScrollLevel"+c.levelNumber).length&&"undefined"!==typeof $("#ScrollLevel"+c.levelNumber)[0]&&c.scrollSize<$("#ScrollLevel"+c.levelNumber)[0].scrollHeight&&(c.scrollSize+=100,changeTrackHeight("Level"+c.levelNumber,c.scrollSize))}).on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",
function(){$("#mouseHelp").html("Increase the vertical length of the scrollable browser image on the page.")}),m.append("span").attr("class","scrollBtn control").style("display","inline-block").attr("id","scrollImage"+c.levelNumber).style("cursor","pointer").append("img").attr("src","/web/images/icons/scroll.png").attr("pointer-events","all").attr("cursor","pointer").on("click",function(){"/web/images/icons/no_scroll.png"==d3.select(this).attr("src")?(d3.select(this).attr("src","/web/images/icons/scroll.png"),
d3.select("span#reset"+c.levelNumber).style("background","#989898"),$("#scrollSize"+c.levelNumber).show(),changeTrackHeight("Level"+c.levelNumber,c.scrollSize)):(d3.select(this).attr("src","/web/images/icons/no_scroll.png"),d3.select("span#reset"+c.levelNumber).style("background","#DCDCDC"),$("#scrollSize"+c.levelNumber).hide(),changeTrackHeight("Level"+c.levelNumber,0));gtag("event","",{event_category:"toggleImageScroll"})}).on("mouseover",function(){$("#mouseHelp").html("Click to toggle browser image scrolling on/off.  <b>Off</b> the image takes as much space as needed. <b>On</b> you can adjust the maximum length of the image.")}).on("mouseout",
function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}));c.topDiv=c.vis.append("div").attr("id","Level"+d).style("text-align","left");c.xScale=d3.scaleLinear().domain([r,u]).range([0,c.width]);m={};m.chr=chr;m.start=r;m.stop=u;history[c.levelNumber]||(history[c.levelNumber]=[]);history[c.levelNumber].push(m);c.xAxis=d3.axisTop(c.xScale).ticks(6).tickSize(8).tickPadding(10);c.scaleSVG=c.topDiv.append("svg:svg").attr("width",c.width).attr("height",
60).attr("pointer-events","all").attr("class","scale").on("mousedown",c.mdown).on("mouseup",mup).on("mouseover",function(){"dragzoom"!=c.defaultMouseFunct?$("#mouseHelp").html("<B>Zoom:</b> Click and Drag right to zoom in or left to zoom out. <B>OR</B> Hold the Alt/Option Key while clicking, then drag to select a specific area."):$("#mouseHelp").html("<B>Zoom:</b> Click and Drag to select an area to zoom in on it. <B>OR</B> Hold the Alt/Option Key while clicking and drag right to zoom in or left to zoom out.");
d3.event.altKey&&"dragzoom"!=c.defaultMouseFunct?c.changeScaleCursor("crosshair"):d3.event.altKey&&"dragzoom"==c.defaultMouseFunct&&c.changeScaleCursor("ew-resize")}).on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mousemove",function(){d3.event.altKey&&"dragzoom"!=c.defaultMouseFunct?c.changeScaleCursor("crosshair"):d3.event.altKey&&"dragzoom"==c.defaultMouseFunct?c.changeScaleCursor("ew-resize"):d3.event.altKey||
"dragzoom"!=c.defaultMouseFunct?d3.event.altKey||"dragzoom"==c.defaultMouseFunct||c.changeScaleCursor("ew-resize"):c.changeScaleCursor("crosshair")}).style("cursor","ew-resize");c.scaleSVG.append("text").text(b).attr("x",(c.width-2*c.margin)/2).attr("y",10).attr("class","axisLbl");c.scaleSVG.append("g").attr("class","x axis").attr("transform","translate(0,55)").attr("shape-rendering","crispEdges").call(c.xAxis);c.topLevel=c.topDiv.append("div").attr("id","ScrollLevel"+d).attr("class","scroll").style("max-height",
"350px").style("overflow","auto").style("width","100%").append("ul").attr("id","sortable"+d);c.getAddMenus();svgList[d]=c;$("#sortable"+d).sortable({appendTo:"parent",containment:"parent",stop:function(){}}).disableSelection();$(".draggable"+d).draggable({connectToSortable:"#sortable"+d,scroll:!0,revert:"invalid",axis:"y"});r=mmVer;"Rn"==organism&&(r=rnVer);d3.select("div#imageHeader").html("Organism: "+r+"&nbsp&nbsp&nbsp&nbsp"+siteVer);0<$("span#verSelect").length&&(r=d3.select("span#verSelect").append("select"),
c.allowSelectGenomeVer?(r.on("change",function(){displayWorking();!0===isLocalStorage()?localStorage.setItem(organism+"DefGenomeVer",$(this).val()):$.cookie(organism+"DefGenomeVer",$(this).val());changeGenome($(this).val(),c.currentView);setTimeout(function(){$("form#geneCentricForm").submit()},1500)}),"Rn"===organism?(u=r.append("option").attr("value","rn6").html("rn6"),"rn6"===genomeVer&&u.attr("selected","selected"),r=r.append("option").attr("value","rn5").html("rn5"),"rn5"===genomeVer&&r.attr("selected",
"selected")):"Mm"===organism&&(r=r.append("option").attr("value","mm10").html("mm10"),"mm10"===genomeVer&&r.attr("selected","selected"))):r.append("option").attr("value",genomeVer).html(genomeVer));c.addTrack("genomeSeq",3,"both",0);c.selectSvg=selectionSVG("#Level"+c.levelNumber,c.width,c.levelNumber,c);return c}
function toolTipSVG(q,m,r,u,d,b,a){var e={isToolTip:1};e.folderName=regionfolderName;e.updateTimeoutHandle={};e.timeoutTrack=-1;e.forLevel=-1;e.strainSpecificCountColors=d3.scaleOrdinal(d3.schemeCategory20);e.get=function(c){return e[c]};e.getTrack=function(c){for(var h,f=0;f<e.trackList.length;f++)"undefined"!==typeof e.trackList[f]&&e.trackList[f].trackClass===c&&(h=e.trackList[f]);return h};e.addTrackErrorRemove=function(c,h){};e.addTrack=function(c,h,f,g){"Trx"==e.forceDrawAsValue&&-1==(new String(f)).indexOf("DrawTrx")&&
(f+="DrawTrx,");var l=d3.select("#Level"+e.levelNumber+c).nodes();if(0===l.length||null==l){l=e.topLevel.append("li").attr("class","draggable"+e.levelNumber).append("svg:svg").attr("width",e.get("width")).attr("height",30).attr("class","track").attr("id","Level"+e.levelNumber+c);var n=new String("Loading...");l.append("text").text(n).attr("x",e.width/2-n.length/2*7.5).attr("y",12).attr("id","trkLbl")}l="";-1<e.forLevel&&99==e.levelNumber&&"undefined"!==typeof svgList[e.forLevel]&&(l=svgList[e.forLevel].getTrack(c).generateTrackSettingString(),
f=l=l.substr(l.indexOf(",")+1));if("genomeSeq"===c){var p=SequenceTrack(e,c,"Reference Genomic Sequence",f);p.seqRegionSize=10;e.addTrackList(p)}else if(-1<c.indexOf("noncoding"))p=GeneTrack(e,g,c,"Non-Coding/Non-PolyA+ Transcripts",f),e.addTrackList(p);else if(-1<c.indexOf("coding"))p=GeneTrack(e,g,c,"Protein Coding/PolyA+ Transcripts",f),e.addTrackList(p);else if(0===c.indexOf("liverTotal")||"heartTotal"===c||0===c.indexOf("brainTotal")||"mergedTotal"===c)h="Liver Total RNA Transcripts","heartTotal"===
c?h="Heart Total RNA Transcripts":"brainTotal"===c?h="Brain Total RNA Transcripts":"mergedTotal"===c&&(h="Merged (Brain,Heart,Liver) Reconstructed"),p=GeneTrack(e,g,c,h,f),e.addTrackList(p);else if(-1<c.indexOf("smallnc"))p=GeneTrack(e,g,c,"Small RNA (<200 bp) Genes",f),e.addTrackList(p);else if(0===c.indexOf("refSeq"))99===e.levelNumber&&(f+="DrawTrx,"),p=RefSeqTrack(e,g,c,"Ref Seq Genes",f),p.density=99===e.levelNumber?2:h,e.addTrackList(p);else if(0===c.indexOf("snp"))p=SNPTrack(e,g,c,1,"4"),e.addTrackList(p);
else if("qtl"===c)p=QTLTrack(e,g,c,1),e.addTrackList(p);else if("trx"===c)g=getAllChildrenByName(getFirstChildByName(e.selectedData,"TranscriptList"),"Transcript"),p=TranscriptTrack(e,g,c,h),e.addTrackList(p);else if("probe"===c||"probeMouse"===c)99!==e.levelNumber&&(f=h+","+f),p=ProbeTrack(e,g,c,"Affy Exon 1.0 ST Probe Sets",f),e.addTrackList(p);else if(-1<c.indexOf("spliceJnct"))f="Brain ","liverspliceJnct"===c?f="Liver ":"heartspliceJnct"===c&&(f="Heart "),p=SpliceJunctionTrack(e,g,c,f+"Splice Junctions",
3,""),100===e.levelNumber&&(p.density=h),e.addTrackList(p);else if("polyASite"===c)p=PolyATrack(e,g,c,"Predicted PolyA Sites",f),e.addTrackList(p);else if("helicos"===c||-1<c.indexOf("illuminaTotal")||-1<c.indexOf("illuminaSmall")||"illuminaPolyA"===c){e.updateTimeoutHandle[c]&&(e.updateTimeoutHandle[c]=-1);h=2;f=l.split(",");1<f.length&&(1===f[1]||2===f[1])&&(h=f[1]);"helicos"===c?p=HelicosTrack(e,g,c,h):"illuminaTotal"===c?p=IlluminaTotalTrack(e,g,c,h):"illuminaSmall"===c?p=IlluminaSmallTrack(e,
g,c,h):"illuminaPolyA"===c?p=IlluminaPolyATrack(e,g,c,h):"liverilluminaTotalPlus"===c?p=LiverIlluminaTotalPlusTrack(e,g,c,h):"liverilluminaTotalMinus"===c?p=LiverIlluminaTotalMinusTrack(e,g,c,h):"heartilluminaTotalPlus"===c?p=HeartIlluminaTotalPlusTrack(e,g,c,h):"heartilluminaTotalMinus"===c?p=HeartIlluminaTotalMinusTrack(e,g,c,h):"brainilluminaTotalPlus"===c?p=BrainIlluminaTotalPlusTrack(e,g,c,h):"brainilluminaTotalMinus"===c?p=BrainIlluminaTotalMinusTrack(e,g,c,h):"liverilluminaSmall"===c?p=LiverIlluminaSmallTrack(e,
g,c,h):"heartilluminaSmall"===c?p=HeartIlluminaSmallTrack(e,g,c,h):-1<c.indexOf("illuminaTotal")&&(p=StrainSpecificIlluminaTotalTrack(e,g,c,h));if(99===e.levelNumber){if(0!==e.updateTimeoutHandle[c]){clearTimeout(e.updateTimeoutHandle[c]);try{clearTimeout(e.timeoutTrack[c].fullDataTimeOutHandle)}catch(t){}e.updateTimeoutHandle[c]=0}e.updateTimeoutHandle[c]=setTimeout(function(){p.updateFullData(0,1);e.timeoutTrack[c]=p;e.updateTimeoutHandle[c]=0},300)}e.addTrackList(p)}else if(0===c.indexOf("repeatMask"))p=
RepeatMaskTrack(e,g,c,"Repeat Masker",1,f),e.addTrackList(p);else if(-1<c.indexOf("custom"))if(h=trackInfo[c],f="DataFile="+h.Location+","+f,"bed"===h.Type||"bb"===h.Type)g=[],p=CustomTranscriptTrack(e,g,c,h.Name,3,f),e.addTrackList(p);else{if("bg"===h.Type||"bw"===h.Type)g=[],p=CustomCountTrack(e,g,c,3,f),e.addTrackList(p)}else 0<=c.indexOf("cirRNA")&&(h=trackInfo[c],g=[],p=CircRNATrack(e,g,c,h.Name,3,f),e.addTrackList(p));$(".sortable"+e.levelNumber).sortable("refresh")};e.addTrackList=function(c){null!=
c&&(e.trackList[e.trackCount]=c,e.trackCount++,setTimeout(function(){DisplayRegionReport()},300))};e.changeTrackHeight=function(c,h){0<h?d3.select("#"+c+"Scroll").style("max-height",h+"px"):d3.select("#"+c+"Scroll").style("max-height","none")};e.removeAllTracks=function(){for(var c=0;c<e.trackList.length;c++)"undefined"!==typeof e.trackList[c]&&"genomeSeq"!==e.trackList[c].trackClass&&d3.select("#Level"+e.levelNumber+e.trackList[c].trackClass).remove();e.trackList=[];setTimeout(function(){DisplayRegionReport()},
300)};e.removeTrack=function(c){d3.select("#Level"+e.levelNumber+c).remove();for(var h=0;h<e.trackList.length;h++)"undefined"!==typeof e.trackList[h]&&e.trackList[h].trackClass==c&&(e.trackList.splice(h,1),e.trackCount--);setTimeout(function(){DisplayRegionReport()},300)};e.redrawTrack=function(c){for(var h=0;h<e.trackList.length;h++)"undefined"!==typeof e.trackList[h]&&e.trackList[h].trackClass==c&&e.trackList[h].redraw();setTimeout(function(){DisplayRegionReport()},300)};e.redraw=function(){for(var c=
0;c<e.trackList.length;c++)"undefined"!==typeof e.trackList[c]&&"undefined"!==typeof e.trackList[c].redraw&&e.trackList[c].redraw()};e.update=function(){for(var c=0;c<e.trackList.length;c++)"undefined"!==typeof e.trackList[c].update&&e.trackList[c].update();setTimeout(function(){DisplayRegionReport()},300)};e.updateData=function(){for(var c=0;c<e.trackList.length;c++)"undefined"!==typeof e.trackList[c]&&"undefined"!==typeof e.trackList[c].updateData&&e.trackList[c].updateData(0);e.updateFullData();
setTimeout(function(){DisplayRegionReport()},300)};e.updateFullData=function(){-1<(new String(e.folderName)).indexOf("img")&&(e.folderName="/"+chr+"/"+e.xScale.domain()[0]+"_"+e.xScale.domain()[1]);for(var c=0;c<e.trackList.length;c++)"undefined"!==typeof e.trackList[c]&&"undefined"!==typeof e.trackList[c].updateFullData&&e.trackList[c].updateFullData(0,1)};e.setLoading=function(){for(var c=0;c<e.trackList.length;c++)"undefined"===typeof e.trackList[c]||"undefined"===typeof e.trackList[c].updateData&&
"undefined"===typeof e.trackList[c].updateFullData||e.trackList[c].showLoading()};e.clearSelection=function(){for(var c=0;c<e.trackList.length;c++)"undefined"!==typeof e.trackList[c]&&"undefined"!==typeof e.trackList[c].clearSelection&&e.trackList[c].clearSelection()};e.mdown=function(){if(0==processAjax){e.prevMinCoord=e.xScale.domain()[0];e.prevMaxCoord=e.xScale.domain()[1];var c=d3.mouse(e.vis.node());e.downx=e.xScale.invert(c[0]);e.downscalex=e.xScale}};e.forceDrawAs=function(c){for(var h=0;h<
e.trackList.length;h++)"undefined"!==typeof e.trackList[h]&&"undefined"!==typeof e.trackList[h].drawAs&&(e.trackList[h].drawAs=c,e.trackList[h].draw(e.trackList[h].data));e.forceDrawAsValue=c};e.generateSettingsString=function(){ret="";for(var c=0;c<e.trackList.length;c++)"undefined"!==typeof e.trackList[c]&&"undefined"!==typeof e.trackList[c].generateTrackSettingString&&(ret+=e.trackList[c].generateTrackSettingString());return ret};e.setCurrentViewModified=function(){"undefined"!==typeof e.currentView&&
(e.currentView.modified=1,$("span#viewModifiedCtl"+e.levelNumber).show())};e.clearCurrentView=function(){e.currentView.modified=0;$("span#viewModifiedCtl"+e.levelNumber).hide()};e.type=a;e.div=q;e.margin=0;e.halfWindowWidth=$(window).width()/2;e.mh=400;e.downx=Math.NaN;e.downscalex;e.downPanx=Math.NaN;e.xMax=29E7;e.xMin=1;e.prevMinCoord=r;e.prevMaxCoord=u;e.dataMinCoord=r;e.dataMaxCoord=u;e.y=0;e.xScale=null;e.xAxis=null;e.vis=null;e.level=null;e.svg=null;e.txType=null;e.txList=null;e.tt=null;e.trackList=
[];e.trackCount=0;e.levelNumber=d;e.selectedData=null;e.txType=null;e.width=m;e.mw=e.width-e.margin;e.vis=d3.select(q);e.topDiv=e.vis.append("div").attr("id","Level"+d).style("text-align","left");e.xScale=d3.scaleLinear().domain([r,u]).range([0,e.width]);e.xAxis=d3.axisTop(e.xScale).ticks(3).tickSize(8).tickPadding(10);e.scaleSVG=e.topDiv.append("svg:svg").attr("width",e.width).attr("height",60).attr("class","scale");e.scaleSVG.append("g").attr("class","x axis").attr("transform","translate(0,55)").attr("shape-rendering",
"crispEdges").call(e.xAxis);d3.select("#Level"+e.levelNumber).select(".x.axis").append("text").text(b).attr("x",(e.width-2*e.margin)/2).attr("y",-40).attr("class","axisLbl");e.topLevel=e.topDiv.append("div").attr("id","ScrollLevel"+e.levelNumber).style("width",e.width+18+"px").append("ul").attr("id","sortable"+e.levelNumber);return e}
function selectionSVG(q,m,r,u){var d={};d.imageWidth=m+25;d.levelNumber=r;d.parent=u;d.coordSelectStart=0;d.coordSelectStop=0;d.visible=!1;d.changeSelection=function(b,a){d.start=b;d.stop=a;d.setVis(!0);d.draw()};d.setVis=function(b){d.visible=b;d.visible?(d.svg.style("display","inline-block"),$("div#regionDiv").hide()):(d.svg.style("display","none"),$("div#regionDiv").show())};d.draw=function(){console.log("selectionSVG.draw"+d.trackClass);if(d.visible){d.xScale(d.stop);d.xScale(d.start);d.parent.updateTrackSelectedArea(d.start,
d.stop);var b=new String(numberWithCommas(Math.floor(d.start))),a=new String(numberWithCommas(Math.floor(d.stop)));d.svg.selectAll("line").remove();d.svg.selectAll("text").remove();d.svg.append("line").attr("x1",function(){var e=d.xScale(d.start);0>e&&(e=0);return e}).attr("x2",function(){var e=d.xScale(d.start);0>e&&(e=0);return e}).attr("y1",0).attr("y2",15).attr("stroke","#00992D").attr("stroke-width","1");d.svg.append("line").attr("x1",function(){return d.xScale(d.stop)}).attr("x2",function(){return d.xScale(d.stop)}).attr("y1",
0).attr("y2",15).attr("stroke","#00992D").attr("stroke-width","1");d.svg.append("line").attr("x1",function(){var e=d.xScale(d.start);0>e&&(e=0);return e}).attr("x2",0).attr("y1",15).attr("y2",60).attr("stroke","#00992D").attr("stroke-width","1");d.svg.append("line").attr("x1",function(){return d.xScale(d.stop)}).attr("x2",d.imageWidth).attr("y1",15).attr("y2",60).attr("stroke","#00992D").attr("stroke-width","1");d.svg.append("text").attr("x",d.xScale(d.start)-7.5*b.length-10).attr("y",15).text(b);
d.svg.append("text").attr("x",d.xScale(d.stop)+10).attr("y",15).text(a)}};d.redraw=function(){d.draw()};d.setup=function(){d.svg=d3.select(q).append("svg:svg").attr("width",d.imageWidth).attr("height",60).attr("id","selectionLevel"+d.levelNumber).style("display","none");d.xScale=d.parent.xScale};d.setup();return d}
function Track(q,m,r,u){var d={};d.selectionStart=q.selectionStart;d.selectionEnd=q.selectionEnd;d.ttSVGMinWidth=20;d.panDown=function(){if(!d3.event.shiftKey&&0===d.gsvg.overSettings&&0===overSelectable&&("dragzoom"!==d.gsvg.defaultMouseFunct&&d3.event.altKey||"dragzoom"===d.gsvg.defaultMouseFunct&&!d3.event.altKey)){var b=d3.mouse(d.gsvg.vis.node());d.gsvg.downZoomx=b[0];d.svg.append("rect").attr("class","zoomRect").attr("x",b[0]).attr("y",0).attr("height",d.svg.attr("height")).attr("width",1).attr("fill",
"#CECECE").attr("opacity",.3);d.scaleSVG.append("rect").attr("class","zoomRect").attr("x",b[0]).attr("y",0).attr("height",d.scaleSVG.attr("height")).attr("width",1).attr("fill","#CECECE").attr("opacity",.3);d.scaleSVG.append("text").attr("id","zoomTextStart").attr("x",d.gsvg.downZoomx).attr("y",15).text(numberWithCommas(Math.round(d.xScale.invert(d.gsvg.downZoomx))));d.scaleSVG.append("text").attr("id","zoomTextEnd").attr("x",d.gsvg.downZoomx).attr("y",50).text(numberWithCommas(Math.round(d.xScale.invert(d.gsvg.downZoomx))))}else!d3.event.shiftKey&&
0===d.gsvg.overSettings&&0===overSelectable&&("pan"===d.gsvg.defaultMouseFunct&&!d3.event.altKey||"pan"!==d.gsvg.defaultMouseFunct&&d3.event.altKey)&&0==processAjax&&(b=d3.mouse(d.gsvg.vis.node()),d.gsvg.downPanx=b[0],d.gsvg.downscalex=d.xScale)};d.zoomToFeature=function(b){var a=parseInt(b.getAttribute("stop"),10)-parseInt(b.getAttribute("start"),10);a*=.25;var e=parseInt(b.getAttribute("start"),10)-a;b=parseInt(b.getAttribute("stop"),10)+a;b<=d.gsvg.xMax&&1<=e&&(d.xScale.domain([e,b]),d.scaleSVG.select(".x.axis").call(d.xAxis),
d.gsvg.redraw(),0==d.gsvg.levelNumber||1==d.gsvg.levelNumber)&&(a={},a.chr=chr,a.start=e,a.stop=b,history[d.gsvg.levelNumber]||(history[d.gsvg.levelNumber]=[]),history[d.gsvg.levelNumber].push(a))};d.clearSelection=function(){d.selectionStart=-1;d.selectionEnd=-1;d.svg.selectAll("rect.selectedArea").remove();d.svg.selectAll(".selected").each(function(){d.svg.select(this).attr("class","").style("fill",d.color)})};d.setSelectedArea=function(b,a){d.selectionStart=b;d.selectionEnd=a;d.redrawSelectedArea()};
d.redrawSelectedArea=function(){d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).selectAll(".selectedArea").remove();if(-1<d.selectionStart&&-1<d.selectionEnd){var b=d.xScale(d.selectionStart),a=d.xScale(d.selectionEnd)-b;1>a&&(a=1);d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).append("rect").attr("class","selectedArea").attr("x",b).attr("y",0).attr("height",function(){var e=d.svg.attr("height");15>e&&(e=15);return e}).attr("width",a).attr("fill","#CECECE").attr("opacity",.3).attr("pointer-events",
"none")}};d.colorStroke=function(b){var a="black";3>d.xScale(b.getAttribute("stop"))-d.xScale(b.getAttribute("start"))&&(a=d.color(b));return a};d.calcY=function(b,a,e){b=3===d.density||"3"===d.density?d.calcYPack(b,a,e):2===d.density||"2"===d.density?d.calcYFull(e):d.calcYDense();d.trackYMax<b/15&&(d.trackYMax=b/15);return b};d.calcYPack=function(b,a,e){if(b>=d.xScale.domain()[0]&&b<=d.xScale.domain()[1]||a>=d.xScale.domain()[0]&&a<=d.xScale.domain()[1]||b<=d.xScale.domain()[0]&&a>=d.xScale.domain()[1]){b=
Math.round(d.xScale(b));0>b&&(b=0);a=Math.round(d.xScale(a));a>=d.gsvg.width&&(a=d.gsvg.width-1);e=b-d.xPadding;0>e&&(e=0);var c=a+d.xPadding;c>=d.gsvg.width&&(c=d.gsvg.width-1);for(var h=0,f=e;f<=c;f++)d.yMaxArr[f]>h&&(h=d.yMaxArr[f]);h++;var g=h;if(d.yArr.length<=h)for(d.yArr[g]=[],f=0;f<d.gsvg.width;f++)d.yArr[g][f]=0;f=h-d.scanBackYLines;1>f&&(f=1);g=0;for(var l=f;l<h&&0==g;l++){var n=0;for(f=e;f<=c&&0==n;f++)d.yArr[l][f]>n&&(n=1);0==n&&(h=l,g=1)}h>d.trackYMax&&(d.trackYMax=h);for(f=b;f<=a;f++)d.yMaxArr[f]<
h&&(d.yMaxArr[f]=h),d.yArr[h][f]=1;b=15*h}else b=15;return b};d.calcYDense=function(){return 15};d.calcYFull=function(b){return 15*(b+1)};d.positionTTLeft=function(b){b+=20;b>d.gsvg.halfWindowWidth&&(b-=490);return b+"px"};d.positionTTTop=function(b){b=window.pageYOffset+10;var a=window.innerHeight-1.8*$(".testToolTip").height();20<a&&(b+=a/2);return b+"px"};d.drawLegend=function(b){var a=new String(d.label),e=d.gsvg.width/2+a.length/2*6.5;500>d.gsvg.width&&(e=7*a.length);d3.select("#Level"+d.gsvg.levelNumber+
d.trackClass).selectAll(".legend").remove();for(var c=0;c<b.length;c++)d.svg.append("rect").attr("class","legend").attr("x",e).attr("y",0).attr("rx",3).attr("ry",3).attr("height",12).attr("width",16).attr("fill",b[c].color).attr("stroke",b[c].color),a=new String(b[c].label),d.svg.append("text").text(a).attr("class","legend").attr("x",e+18).attr("y",12),e=e+25+7*a.length};d.drawScaleLegend=function(b,a,e,c,h,f){var g=new String(d.label),l=d.gsvg.width/2+g.length/2*7.5+16;500>d.gsvg.width&&(l=7.5*g.length);
l+=f;d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).selectAll(".legend").remove();d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).selectAll("#def1").remove();g=d.svg.append("defs").attr("id","def1").append("linearGradient").attr("id","grad"+d.gsvg.levelNumber+d.trackClass);g.append("stop").attr("offset","0%").style("stop-color",c);g.append("stop").attr("offset","100%").style("stop-color",h);g=new String(b);b=7.6*g.length;d.svg.append("text").text(g).attr("class","legend").attr("x",l).attr("y",
12);d.svg.append("rect").attr("class","legend").attr("x",l+b+5).attr("y",0).attr("rx",3).attr("ry",3).attr("height",12).attr("width",75).attr("fill","url(#grad"+d.gsvg.levelNumber+d.trackClass+")");g=new String(a);d.svg.append("text").text(g).attr("class","legend").attr("x",l+b+80).attr("y",12);a=8*g.length+5;g=new String(e);d.svg.append("text").text(g).attr("class","legend").attr("x",l+b+80+a).attr("y",12)};d.showLoading=function(){0<d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).selectAll("g.loading")?
d.loading=d3.select(d.svg).selectAll("g.loading"):(d.loading=d.svg.append("g").attr("class","loading"),d.loading.append("rect").attr("x",0).attr("y",0).attr("height",d.svg.attr("height")).attr("width",d.gsvg.width).attr("fill","#CECECE").attr("opacity",.6),d.loading.append("text").text("Loading...").attr("x",d.gsvg.width/2-37.5).attr("y",d.svg.attr("height")/2))};d.hideLoading=function(){d.loading=d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).selectAll("g.loading");"undefined"!==typeof d.loading&&
d.loading.remove()};d.displayBreakDown=function(b){$(window).width();1E3<$(window).width()&&$(window).width();if("undefined"!==typeof d.counts&&0<d.counts.length){for(var a=1,e=0;e<d.counts.length&&1===a;e++)0<d.counts[e].value&&(a=0);if(0===a){var c=d3.arc().outerRadius(140).innerRadius(0);a=d3.pie().value(function(h){return h.value});b=d3.select(b).append("svg").attr("width",300).attr("height",300).append("g").attr("transform","translate(150,150)").selectAll(".arc").data(a(d.counts)).enter().append("g").attr("class",
"arc");b.append("path").attr("d",c).attr("fill",d.pieColor).on("mouseover",function(h){d3.select(".testToolTip").transition().duration(200).style("opacity",.95);d3.select(".testToolTip").html("Name: "+h.data.names+"<BR>Count: "+h.data.value).style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px");d.triggerTableFilter(h)}).on("mouseout",function(h){d3.select(".testToolTip").transition().delay(500).duration(200).style("opacity",0);d.clearTableFilter(h)});b.append("text").attr("transform",
function(h){return"translate("+c.centroid(h)+")"}).attr("dy",".35em").attr("fill","#FFFFFF").style("text-anchor","middle").text(function(h){var f=h.value;0==h.value&&(f="");return f})}}};d.updateLabel=function(b){d.label=b;b=new String(d.label);600<d.gsvg.width?d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).select("#trkLbl").attr("x",d.gsvg.width/2-b.length/2*7.5).text(b):d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).select("#trkLbl").attr("x",0).text(b);d3.select("#Level"+d.gsvg.levelNumber+
d.trackClass).select(".infoIcon").attr("transform","translate("+(d.gsvg.width-20)+",0)");d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).select(".settings").attr("transform","translate("+(d.gsvg.width-40)+",0)")};d.resize=function(){d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).attr("width",d.gsvg.width);d.updateLabel(d.label);"undefined"!==typeof d.redrawLegend&&d.redrawLegend();d.redraw()};d.triggerTableFilter=function(b){};d.clearTableFilter=function(b){};d.getDisplayID=function(b){return b.getAttribute("ID")};
d.setupToolTipSVG=function(b,a){var e=parseInt(b.getAttribute("start"),10),c=parseInt(b.getAttribute("stop"),10),h=Math.floor((c-e)*a);20>h&&(h=20);var f=e-h;h=c+h;1>f&&(f=1);"undefined"!==typeof d.ttSVGMinWidth&&h-f<d.ttSVGMinWidth&&(f=e-d.ttSVGMinWidth/2,h=c+d.ttSVGMinWidth/2);e=toolTipSVG("div#ttSVG",450,f,h,99,d.getDisplayID(b),"transcript");e.forLevel=d.gsvg.levelNumber;c=[];c.push(b);e.addTrack(d.trackClass,3,"",c);for(c=0;c<d.ttTrackList.length;c++){var g=d.gsvg.getTrackData(d.ttTrackList[c]),
l=[];if("undefined"!==typeof g&&0<g.length){for(var n=0,p=0;p<g.length;p++)if(f<=parseInt(g[p].getAttribute("start"),10)&&parseInt(g[p].getAttribute("start"),10)<=h||parseInt(g[p].getAttribute("start"),10)<=f&&parseInt(g[p].getAttribute("stop"),10)>=f)l[n]=g[p],n++;0<l.length&&e.addTrack(d.ttTrackList[c],3,"DrawTrx",l)}}};d.generateSettingsDiv=function(b){d.savePrevious();var a=trackInfo[d.trackClass];d3.select(b).select("table").select("tbody").html("");if("undefined"!==typeof a&&0<a.Controls.length&&
"null"!=a.Controls){var e=(new String(a.Controls)).split(",");b=d3.select(b).select("table").select("tbody");b.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+a.Name);for(a=0;a<e.length;a++)if("undefined"!==typeof e[a]&&""!=e[a]){var c=e[a].split(";"),h=b.append("tr").append("td"),f=c[0].substr(5);h.append("text").text(f+": ");f="";3<c.length&&0==c[3].indexOf("Default=")&&(f=c[3].substr(8));if(0==c[1].toLowerCase().indexOf("select")){var g=c[1].split(":");c=c[2].split("}");
var l="",n="";2<g.length&&(l=g[2]);3<g.length&&(n=g[3]);h=h.append("select").attr("id",d.trackClass+l+d.level+n).attr("name",g[1]);for(g=0;g<c.length;g++){var p=c[g].substr(1).split(":");if(2==p.length){var t=h.append("option").attr("value",p[1]).text(p[0]);"Dense"===l&&p[1]==d.density?t.attr("selected","selected"):"Version"===l&&p[1]==d.dataVer?t.attr("selected","selected"):p[1]==f&&t.attr("selected","selected")}}d3.select("select#"+d.trackClass+l+d.level+n).on("change",function(){d.updateSettingsFromUI();
d.redraw()})}else console.log("Undefined track settings:  "+e[a])}e=b.append("tr").append("td");e.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");d.gsvg.setCurrentViewModified();d.gsvg.removeTrack(d.trackClass);var v=svgList[d.gsvg.levelNumber].currentView.ViewID,y=viewMenu[d.gsvg.levelNumber].findTrackByClass(d.trackClass,v);y=viewMenu[d.gsvg.levelNumber].findTrackIndexWithViewID(y.TrackID,
v);viewMenu[d.gsvg.levelNumber].removeTrackWithIDIdx(y,v)});e.append("input").attr("type","button").attr("value","Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");d.density!=d.prevSetting.density&&d.gsvg.setCurrentViewModified()});e.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){d.revertPrevious();d.draw(d.data);$("#trackSettingDialog").fadeOut("fast")})}else a&&
(b=d3.select(b).select("table").select("tbody"),b.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+a.Name),b.append("tr").append("td").html("Sorry no settings for this track."),e=b.append("tr").append("td"),e.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");d.gsvg.setCurrentViewModified();d.gsvg.removeTrack(d.trackClass)}),e.append("input").attr("type",
"button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")}))};d.updateSettingsFromUI=function(){0<$("#"+d.trackClass+"Dense"+d.level+"Select").length&&(d.density=$("#"+d.trackClass+"Dense"+d.level+"Select").val())};d.savePrevious=function(){d.prevSetting={};d.prevSetting.density=d.density};d.revertPrevious=function(){d.density=d.prevSetting.density};d.updateSettings=function(b){};d.generateTrackSettingString=function(){return d.trackClass+
","+d.density+";"};d.gsvg=q;d.level=d.gsvg.levelNumber;d.data=m;d.label=u;d.density=3;d.loading;d.trackYMax=0;d.trackClass=r;d.topLevel=d.gsvg.get("topLevel");d.xScale=d.gsvg.get("xScale");d.scaleSVG=d.gsvg.get("scaleSVG");d.xAxis=d.gsvg.get("xAxis");d.yMaxArr=[];d.yArr=[];d.yArr[0]=[];for(q=0;q<d.gsvg.width;q++)d.yMaxArr[q]=0,d.yArr[0][q]=0;d.scanBackYLines=12;d.xPadding=2;3E6<d.gsvg.xScale.domain()[1]-d.gsvg.xScale.domain()[0]&&(d.xPadding=1);d.vis=d3.select("#Level"+d.gsvg.levelNumber+d.trackClass);
d.svg=d3.select("svg#Level"+d.gsvg.levelNumber+d.trackClass);d.svg.on("mousedown",d.panDown);d.updateLabel(d.label);return d}
function SequenceTrack(q,m,r,u){u=[];var d=Track(q,u,m,r);d.dispCutoff=300;d.aaDispCutoff=2900;d.seqRegionSize=4E3;d.strands="both";d.includeAA=1;d.labelBase=r;d.lastUpdate=0;d.seqRegionMin=0;d.seqRegionMax=0;d.color=function(b){};d.colorAA=function(b,a){d3.rgb("#FFFFFF");var e=0==b.pos%2?d3.rgb("#C3C3C3"):d3.rgb("#838383");"M"==b.aa&&(e=d3.rgb("#00FF00"));"*"==b.aa&&(e=d3.rgb("#FF0000"));return e};d.createCodon=function(){d.codons=[];d.codons.AAA="K";d.codons.AAT="N";d.codons.AAG="K";d.codons.AAC=
"N";d.codons.ATA="I";d.codons.ATT="I";d.codons.ATG="M";d.codons.ATC="I";d.codons.ACA="T";d.codons.ACT="T";d.codons.ACG="T";d.codons.ACC="T";d.codons.AGA="R";d.codons.AGT="S";d.codons.AGG="R";d.codons.AGC="S";d.codons.TAA="*";d.codons.TAT="Y";d.codons.TAG="*";d.codons.TAC="Y";d.codons.TTA="L";d.codons.TTT="F";d.codons.TTG="L";d.codons.TTC="F";d.codons.TCA="S";d.codons.TCT="S";d.codons.TCG="S";d.codons.TCC="S";d.codons.TGA="*";d.codons.TGT="C";d.codons.TGG="W";d.codons.TGC="C";d.codons.CAA="Q";d.codons.CAT=
"H";d.codons.CAG="Q";d.codons.CAC="H";d.codons.CTA="L";d.codons.CTT="L";d.codons.CTG="L";d.codons.CTC="L";d.codons.CCA="P";d.codons.CCT="P";d.codons.CCG="P";d.codons.CCC="P";d.codons.CGA="R";d.codons.CGT="R";d.codons.CGG="R";d.codons.CGC="R";d.codons.GAA="E";d.codons.GAT="D";d.codons.GAG="E";d.codons.GAC="D";d.codons.GTA="V";d.codons.GTT="V";d.codons.GTG="V";d.codons.GTC="V";d.codons.GCA="A";d.codons.GCT="A";d.codons.GCG="A";d.codons.GCC="A";d.codons.GGA="G";d.codons.GGT="G";d.codons.GGG="G";d.codons.GGC=
"G"};d.translate=function(b){b=b.toUpperCase();return d.codons[b]};d.translateRegion=function(b,a,e,c){var h=[],f=0,g=0;if(d.data){if(e>c){g=1;var l=e;e=c;c=l}for(l=e;l<=c;l+=3){var n=d.data.substring(l,l+3);1==g&&(n=d.reverseCompliment(n));h[f]=[];h[f].aa=d.translate(n);h[f].pos=a+(l-e);h[f].id=b+":"+l+":"+d.translate(n);f++}}return h};d.reverseCompliment=function(b){for(var a="",e=b.length-1;-1<e;e--)a+=d.complement(b.charAt(e));return a};d.complement=function(b){var a="N";"A"==b?a="T":"T"==b?a=
"A":"G"==b?a="C":"C"==b&&(a="G");return a};d.redraw=function(){d.redrawSelectedArea();var b=d.xScale.domain()[0],a=d.xScale.domain()[1];if(d.prevStrand!=d.strands||d.prevIncldAA!=d.includeAA)d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).selectAll("g.base").each(function(C){d3.select(this).remove()}),d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).selectAll("g.aa0").each(function(C){d3.select(this).remove()}),d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).selectAll("g.aa1").each(function(C){d3.select(this).remove()}),
d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).selectAll("g.aa2").each(function(C){d3.select(this).remove()}),d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).selectAll("g.aarev0").each(function(C){d3.select(this).remove()}),d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).selectAll("g.aarev1").each(function(C){d3.select(this).remove()}),d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).selectAll("g.aarev2").each(function(C){d3.select(this).remove()}),b<d.seqRegionMin||a>d.seqRegionMax?
d.updateData(0):d.draw(d.data);else if(b<d.seqRegionMin||a>d.seqRegionMax)d.updateData(0);else{var e=a-b,c="12px";200<e&&(c="10px");if(e<=d.aaDispCutoff&&1==d.includeAA||e<=d.dispCutoff){if(d.seqRegionMin<=b&&b<=d.seqRegionMax&&d.seqRegionMin<=a&&a<=d.seqRegionMax){var h=d.gsvg.width/e,f=h/2;a=b-d.seqRegionMin;var g=e+a,l=27;1==d.includeAA&&"-"!=d.strands&&(l+=30);if(e<d.dispCutoff){d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).selectAll("g.line").remove();for(var n=[],p=a;p<g;p++)n[p-a]=[],
n[p-a].base=d.data.charAt(p),n[p-a].id=p,n[p-a].pos=p-a;d.textSize(e);var t=d.yPosition(e);p=d.svg.selectAll(".base").data(n,keyID).attr("transform",function(C,F){return"translate("+(C.pos*h-f)+","+l+")"});n=p.enter().append("g").attr("class","base").attr("transform",function(C,F){return"translate("+(C.pos*h-f)+","+l+")"});n.each(function(C){d3.select(this).append("text").text(function(F){return"-"!=d.strands?F.base:d.complement(F.base)});"both"==d.strands&&d3.select(this).append("text").attr("class",
"comp").attr("y",t).text(function(F){return d.complement(F.base)})});p.exit().remove();p.selectAll("text").attr("font-size",function(C){return d.textSize(e)});p.selectAll("text.comp").attr("y",t)}else d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).selectAll("g.base").remove(),d.svg.append("g").attr("class","line").append("line").attr("stroke","#000000").attr("x1",0).attr("y1",l).attr("x2",d.gsvg.width).attr("y2",l);if(1==d.includeAA){var v=3*h,y=v/2-4,w=25;if("both"==d.strands||"+"==d.strands)for(p=
b%3,n=a-p,g=[],g[0]=d.translateRegion(0,b-p,n,n+e),g[1]=d.translateRegion(1,b-p-1,n-1,n-1+e),g[2]=d.translateRegion(2,b-p-2,n-2,n-2+e),w=25,p=0;3>p;p++){var A=d.svg.selectAll(".aa"+p).data(g[p],keyID).attr("transform",function(C,F){return"translate("+(d.xScale(C.pos)-h)+","+w+")"}).each(function(C){d3.select(this).select("rect").attr("width",v);e<d.dispCutoff?0==d3.select(this).select("text").size()?d3.select(this).append("text").attr("x",y).attr("font-size",c).text(function(F){return F.aa}):d3.select(this).select("text").attr("x",
y).attr("font-size",c):d3.select(this).select("text").remove()});n=A.enter().append("g").attr("class","aa"+p).attr("transform",function(C,F){return"translate("+(d.xScale(C.pos)-h)+","+w+")"});n.each(function(C){d3.select(this).append("rect").attr("y",-10).attr("height",10).attr("width",v).attr("stroke",d.colorAA).attr("fill",d.colorAA);e<d.dispCutoff&&d3.select(this).append("text").attr("x",y).attr("font-size",c).text(function(F){return F.aa})});A.exit().remove();w+=11}w="both"==d.strands?80:45;if("both"==
d.strands||"-"==d.strands)for(p=b%3,n=a-p,g=[],g[0]=d.translateRegion(0,b-p,n+e,n),g[1]=d.translateRegion(1,b-p-1,n-1+e,n-1),g[2]=d.translateRegion(2,b-p-2,n-2+e,n-2),p=0;3>p;p++)A=d.svg.selectAll(".aarev"+p).data(g[p],keyID).attr("transform",function(C,F){return"translate("+(d.xScale(C.pos)-h)+","+w+")"}).each(function(C){d3.select(this).select("rect").attr("width",v);e<d.dispCutoff?0==d3.select(this).select("text").size()?d3.select(this).append("text").attr("x",y).attr("font-size",c).text(function(F){return F.aa}):
d3.select(this).select("text").attr("x",y).attr("font-size",c):d3.select(this).select("text").remove()}),n=A.enter().append("g").attr("class","aarev"+p).attr("transform",function(C,F){return"translate("+d.xScale(C.pos)+","+w+")"}),n.each(function(C){d3.select(this).append("rect").attr("y",-10).attr("height",10).attr("width",v).attr("stroke",d.colorAA).attr("fill",d.colorAA);e<d.dispCutoff&&d3.select(this).append("text").attr("x",y).attr("font-size",c).text(function(F){return F.aa})}),A.exit().remove(),
w+=11;"both"==d.strands?d.svg.attr("height",125):d.svg.attr("height",75)}else"both"==d.strands?d.svg.attr("height",45):d.svg.attr("height",30)}else d.updateData(0);$("li.draggable"+d.gsvg.levelNumber+"#li"+d.trackClass).show()}else d.svg.attr("height",0),$("li.draggable"+d.gsvg.levelNumber+"#li"+d.trackClass).hide()}};d.draw=function(b){d.redrawSelectedArea();var a=d.xScale.domain()[0],e=d.xScale.domain()[1]-a,c="";1==d.includeAA&&(c=" and Amino Acids");"both"==d.strands?d.label=d.labelBase+c+" on +/- strands":
"+"==d.strands?d.label=d.labelBase+c+" on + strand":"-"==d.strands&&(d.label=d.labelBase+c+" on - strand");e<=d.aaDispCutoff&&1==d.includeAA||e<=d.dispCutoff||(d.label="");d.updateLabel(d.label);d.data=new String(b);var h="10px";200<e&&(h="8px");if(d.data&&e<=d.aaDispCutoff&&1==d.includeAA||e<=d.dispCutoff){c=a-d.seqRegionMin;var f=e+c,g=d.gsvg.width/e;d.svg.selectAll("text.dir").remove();"both"==d.strands?(d.svg.append("text").attr("class","dir").attr("x",5).attr("y",15).text("--\x3e"),d.svg.append("text").attr("class",
"dir").attr("x",5).attr("y",120).text("<--"),d.svg.append("text").attr("class","dir").attr("x",d.gsvg.width-60).attr("y",15).text("--\x3e"),d.svg.append("text").attr("class","dir").attr("x",d.gsvg.width-20).attr("y",120).text("<--")):"+"==d.strands?(d.svg.append("text").attr("class","dir").attr("x",5).attr("y",15).text("--\x3e"),d.svg.append("text").attr("class","dir").attr("x",d.gsvg.width-60).attr("y",15).text("--\x3e")):"-"==d.strands&&(d.svg.append("text").attr("class","dir").attr("x",5).attr("y",
15).text("<--"),d.svg.append("text").attr("class","dir").attr("x",d.gsvg.width-60).attr("y",15).text("<--"));if(e<d.dispCutoff&&1<b.length){for(var l=[],n=c;n<f;n++)l[n-c]=[],l[n-c].base=b.charAt(n),l[n-c].id=n,l[n-c].pos=n-c;n=d.textSize(e);var p=d.yPosition(e),t=27;1==d.includeAA&&"-"!=d.strands&&(t+=30);l=d.svg.selectAll(".base").data(l,keyID).attr("transform",function(A,C){return"translate("+A.pos*g+","+t+")"});b=l.enter().append("g").attr("class","base").attr("transform",function(A,C){return"translate("+
A.pos*g+","+t+")"});b.each(function(A){d3.select(this).append("text").text(function(C){return"-"!=d.strands?A.base:d.complement(A.base)});"both"==d.strands&&d3.select(this).append("text").attr("class","comp").attr("y",p).text(function(C){return d.complement(A.base)})});l.exit().remove();l.selectAll("text").attr("font-size",n)}else d.svg.append("g").attr("class","base").append("line").attr("stroke","#000000").attr("x1",0).attr("y1",57).attr("x2",d.gsvg.width).attr("y2",57);if(d.data&&1==d.includeAA){var v=
3*g,y=v/2-4,w=25;if("both"==d.strands||"+"==d.strands)for(n=a%3,b=c-n,l=[],l[0]=d.translateRegion(0,a-n,b,b+e),l[1]=d.translateRegion(1,a-n-2,b-2,b-2+e),l[2]=d.translateRegion(2,a-n-1,b-1,b-1+e),w=25,n=0;3>n;n++)f=d.svg.selectAll(".aa"+n).data(l[n],keyID).attr("transform",function(A,C){return"translate("+d.xScale(A.pos)+","+w+")"}).each(function(A){d3.select(this).select("rect").attr("width",v);e<d.dispCutoff?0==d3.select(this).select("text").size()?d3.select(this).append("text").attr("x",y).attr("font-size",
h).text(function(C){return A.aa}):d3.select(this).select("text").attr("x",y).attr("font-size",h):d3.select(this).select("text").remove()}),f.enter().append("g").attr("class","aa"+n).attr("transform",function(A,C){return"translate("+d.xScale(A.pos)+","+w+")"}).each(function(A){d3.select(this).append("rect").attr("y",-10).attr("height",10).attr("width",v).attr("stroke",d.colorAA(A)).attr("fill",d.colorAA(A));e<d.dispCutoff&&d3.select(this).append("text").attr("x",y).attr("font-size",h).text(function(){return A.aa})}),
f.exit().remove(),w+=11;w="both"==d.strands?80:45;if("both"==d.strands||"-"==d.strands)for(n=a%3,b=c-n,l=[],l[0]=d.translateRegion(0,a-n,b+e,b),l[1]=d.translateRegion(1,a-n-1,b-1+e,b-1),l[2]=d.translateRegion(2,a-n-2,b-2+e,b-2),n=0;3>n;n++)f=d.svg.selectAll(".aarev"+n).data(l[n],keyID).attr("transform",function(A,C){return"translate("+d.xScale(A.pos)+","+w+")"}),b=f.enter().append("g").attr("class","aarev"+n).attr("transform",function(A,C){return"translate("+d.xScale(A.pos)+","+w+")"}),b.each(function(A){d3.select(this).append("rect").attr("y",
-10).attr("height",10).attr("width",v).attr("stroke",d.colorAA(A)).attr("fill",d.colorAA(A));e<d.dispCutoff&&d3.select(this).append("text").attr("x",y).attr("font-size",h).text(function(C){return A.aa})}),f.exit().remove(),w+=11;"both"==d.strands?d.svg.attr("height",125):d.svg.attr("height",75)}else"both"==d.strands?d.svg.attr("height",45):d.svg.attr("height",30);d.prevStrand=d.strands;d.prevIncldAA=d.includeAA;$("li.draggable"+d.gsvg.levelNumber+"#li"+d.trackClass).show()}else d.svg.attr("height",
0),$("li.draggable"+d.gsvg.levelNumber+"#li"+d.trackClass).hide()};d.textSize=function(b){var a="9px";100>=b?a="11px":150>=b?a="8px":200>=b?a="6.8px":250>=b?a="5.8px":300>=b&&(a="4.8px");return a};d.yPosition=function(b){var a=12;100>=b?a=12:150>=b?a=10:200>=b?a=8:250>=b?a=6:300>=b&&(a=5);return a};d.updateData=function(b){var a=(new Date).getTime();if(25E3<a-d.lastUpdate||0<b)0===b&&(0===d.lastUpdate||25E3>a-d.lastUpdate)&&(d.tmpseqRegionMin=d.xScale.domain()[0]-d.seqRegionSize,d.tmpseqRegionMax=
d.xScale.domain()[1]+d.seqRegionSize,0>d.tmpseqRegionMin&&(d.tmpseqRegionMin=0)),d.xScale.domain()[1]-d.xScale.domain()[0]<d.aaDispCutoff&&(d.lastUpdate=a,d.svg&&30>d.svg.attr("height")&&d.svg.attr("height",30),0===b&&d.showLoading(),d3.text(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+d.gsvg.folderName+"/"+d.tmpseqRegionMin+"_"+d.tmpseqRegionMax+".seq",function(e,c){if(e){if(0===b){var h="/"+pathPrefix;pathPrefix||(h="");$.ajax({url:h+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,
data:{chromosome:chr,minCoord:d.tmpseqRegionMin,maxCoord:d.tmpseqRegionMax,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:d.trackClass,folder:d.gsvg.folderName},dataType:"json",success:function(f){gtag("event","generateTrackSequence",{event_category:"browser"})},error:function(f,g,l){}})}3>b?(h=1E4,1===b&&(h=15E3),setTimeout(function(){d.updateData(b+1)},h)):(d.seqRegionMin=0,d.seqRegionMax=0,d.hideLoading(),d3.select("#Level"+d.gsvg.levelNumber+
d.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+d.trackClass),d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).attr("height",15),d.gsvg.addTrackErrorRemove(d.svg,"#Level"+d.gsvg.levelNumber+d.trackClass),d.lastUpdate=0)}else d.seqRegionMin=d.tmpseqRegionMin,d.seqRegionMax=d.tmpseqRegionMax,d.hideLoading(),d.draw(c),d.lastUpdate=0,setTimeout(function(){DisplayRegionReport()},300)}))};d.updateSettingsFromUI=function(){0<$("#"+d.trackClass+d.level+"Select").length&&(d.strands=
$("#"+d.trackClass+d.level+"Select").val());0<$("#"+d.trackClass+"CBX"+d.level+"dispAA").length&&($("#"+d.trackClass+"CBX"+d.level+"dispAA").is(":checked")?d.includeAA=1:d.includeAA=0)};d.savePrevious=function(){d.prevSetting={};d.prevSetting.strands=d.strands;d.prevSetting.includeAA=d.includeAA};d.revertPrevious=function(){d.strands=d.prevSetting.strands;d.includeAA=d.prevSetting.includeAA};d.generateTrackSettingString=function(){return d.trackClass+","+d.strands+","+d.includeAA+";"};d.generateSettingsDiv=
function(b){var a=trackInfo[d.trackClass];d.savePrevious();d3.select(b).select("table").select("tbody").html("");if(0<a.Controls.length&&"null"!=a.Controls){var e=(new String(a.Controls)).split(",");b=d3.select(b).select("table").select("tbody");b.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+a.Name);for(a=0;a<e.length;a++)if(e[a]&&""!=e[a]){var c=e[a].split(";"),h=b.append("tr").append("td"),f=c[0].substr(5);3<c.length&&0===c[3].indexOf("Default=")&&c[3].substr(8);
if(0===c[1].toLowerCase().indexOf("select")){h.append("text").text(f+": ");f=c[1].split(":");c=c[2].split("}");for(var g=d.trackClass+d.level+"Select",l=h.append("select").attr("id",g).attr("name",f[1]),n=0;n<c.length;n++){var p=c[n].substr(1).split(":");2==p.length&&(h=l.append("option").attr("value",p[1]).text(p[0]),p[1]==d.strands&&h.attr("selected","selected"))}d3.select("select#"+g).on("change",function(){d.updateSettingsFromUI();d.redraw()})}else if(0===c[1].toLowerCase().indexOf("cbx"))for(h.append("text").text(f),
f=c[1].split(":"),c=c[2].split("}"),n=0;n<c.length;n++)if(p=c[n].substr(1).split(":"),2===p.length){g=h.append("div").style("display","inline-block");var t="",v="";2<f.length&&(v=f[2]);3<f.length&&(t=f[3]);l=g.append("input").attr("type","checkbox").attr("id",d.trackClass+v+"CBX"+d.level+t).attr("name",f[1]).style("margin-left","5px");g.append("text").text(p[0]);1==d.includeAA?$("#"+d.trackClass+v+"CBX"+d.level+t).prop("checked",!0):$("#"+d.trackClass+v+"CBX"+d.level+t).prop("checked",!1);d3.select("input#"+
d.trackClass+v+"CBX"+d.level+t).on("change",function(){d.updateSettingsFromUI();d.redraw()})}}e=b.append("tr").append("td");e.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");d.gsvg.removeTrack(d.trackClass);d.gsvg.setCurrentViewModified();var y=svgList[d.gsvg.levelNumber].currentView.ViewID,w=viewMenu[d.gsvg.levelNumber].findTrackByClass(d.trackClass,y);w=viewMenu[d.gsvg.levelNumber].findTrackIndexWithViewID(w.TrackID,
y);viewMenu[d.gsvg.levelNumber].removeTrackWithIDIdx(w,y)});e.append("input").attr("type","button").attr("value","Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");d.strands==d.prevSetting.strands&&d.includeAA==d.prevSetting.includeAA||d.gsvg.setCurrentViewModified()});e.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){d.revertPrevious();d.draw(d.data);
$("#trackSettingDialog").fadeOut("fast")})}else b=d3.select(b).select("table").select("tbody"),b.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+a.Name),b.append("tr").append("td").html("Sorry no settings for this track."),e=b.append("tr").append("td"),e.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")}),e.append("input").attr("type","button").attr("value",
"Cancel").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")})};d.createCodon();d.updateData(0);d.draw(u);return d}
function GeneTrack(q,m,r,u,d){var b=Track(q,m,r,u);b.counts=[{value:0,names:"Ensembl"},{value:0,names:"Brain RNA-Seq"}];q=new String(d);b.drawAs="Gene";b.trxCutoff=1E5;q=new String(d);b.xScale.domain();b.xScale.domain();-1<q.indexOf("DrawTrx")&&(b.drawAs="Trx");b.density=3;b.dataVer=0;b.reqDataVer=0;b.ttTrackList=[];-1===b.trackClass.indexOf("smallnc")?(b.ttTrackList.push("ensemblcoding"),b.ttTrackList.push("braincoding"),b.ttTrackList.push("brainTotal"),b.ttTrackList.push("liverTotal"),b.ttTrackList.push("heartTotal"),
b.ttTrackList.push("mergedTotal"),b.ttTrackList.push("refSeq"),b.ttTrackList.push("ensemblnoncoding"),b.ttTrackList.push("brainnoncoding")):(b.ttTrackList.push("ensemblsmallnc"),b.ttTrackList.push("brainsmallnc"),b.ttTrackList.push("liversmallnc"),b.ttTrackList.push("heartsmallnc"),b.ttTrackList.push("refSeq"));b.ttTrackList.push("repeatMask");b.ttTrackList.push("snpSHRH");b.ttTrackList.push("snpBNLX");b.ttTrackList.push("snpF344");b.ttTrackList.push("snpSHRJ");"braincoding"===r?(b.ttTrackList.push("spliceJnct"),
b.ttTrackList.push("illuminaPolyA")):0===r.indexOf("liverTotal")?(b.ttTrackList.push("liverspliceJnct"),b.ttTrackList.push("liverilluminaTotalPlus"),b.ttTrackList.push("liverilluminaTotalMinus")):"heartTotal"===r?(b.ttTrackList.push("heartspliceJnct"),b.ttTrackList.push("heartilluminaTotalPlus"),b.ttTrackList.push("heartilluminaTotalMinus")):0===r.indexOf("brainTotal")?(b.ttTrackList.push("brainspliceJnct"),b.ttTrackList.push("brainilluminaTotalPlus"),b.ttTrackList.push("brainilluminaTotalMinus")):
"brainsmallnc"===r?b.ttTrackList.push("illuminaSmall"):"heartsmallnc"===r?b.ttTrackList.push("heartilluminaSmall"):"liversmallnc"===r&&b.ttTrackList.push("liverilluminaSmall");b.pieColorPalette=d3.scaleOrdinal(d3.schemeCategory20);b.cleanID=function(a){return a=a.replace(/\./g,"_")};b.color=function(a){var e="#000000";"ensemblcoding"===b.trackClass?e="#DFC184":"braincoding"===b.trackClass?(e="#7EB5D6",null!==a.getAttribute("strain")&&"undefined"!==typeof a.getAttribute("strain")&&"All"!==a.getAttribute("strain")&&
(e=b.strainSpecColor(e,a))):"ensemblnoncoding"===b.trackClass?e="#B58AA5":"brainnoncoding"===b.trackClass?(e="#CECFCE",null!==a.getAttribute("strain")&&"undefined"!==typeof a.getAttribute("strain")&&"BNLX"===a.getAttribute("strain").toUpperCase()?e="#3E75FF":null===a.getAttribute("strain")||"undefined"===typeof a.getAttribute("strain")||"SHR"!==a.getAttribute("strain").toUpperCase()&&"SHRH"!==a.getAttribute("strain").toUpperCase()||(e="#FE7596")):"ensemblsmallnc"===b.trackClass?e="#FFCC00":"brainsmallnc"===
b.trackClass?(e="#3E7596",null!==a.getAttribute("strain")&&"undefined"!==typeof a.getAttribute("strain")&&"All"!==a.getAttribute("strain")&&(e=b.strainSpecColor(e,a))):0===b.trackClass.indexOf("liverTotal")?(e="#bbbedd",0<b.trackClass.indexOf("_F344Stm")?e="#abaefd":0<b.trackClass.indexOf("_LEStm")&&(e="#dbaecd"),null!==a.getAttribute("strain")&&"undefined"!==typeof a.getAttribute("strain")&&"All"!==a.getAttribute("strain")&&(e=b.strainSpecColor(e,a))):"heartTotal"===b.trackClass?(e="#DC7252",null!==
a.getAttribute("strain")&&"undefined"!==typeof a.getAttribute("strain")&&"All"!==a.getAttribute("strain")&&(e=b.strainSpecColor(e,a))):0===b.trackClass.indexOf("brainTotal")?(e="#7EB5D6",0<b.trackClass.indexOf("_F344Stm")?e="#6EA5F6":0<b.trackClass.indexOf("_LEStm")&&(e="#9EA5C6"),null!==a.getAttribute("strain")&&"undefined"!==typeof a.getAttribute("strain")&&"All"!==a.getAttribute("strain")&&(e=b.strainSpecColor(e,a))):"liversmallnc"===b.trackClass?(e="#7b7e9d",null!==a.getAttribute("strain")&&"undefined"!==
typeof a.getAttribute("strain")&&"All"!==a.getAttribute("strain")&&(e=b.strainSpecColor(e,a))):"heartsmallnc"===b.trackClass?(e="#9C3212",null!==a.getAttribute("strain")&&"undefined"!==typeof a.getAttribute("strain")&&"All"!==a.getAttribute("strain")&&(e=b.strainSpecColor(e,a))):"mergedTotal"===b.trackClass&&(e="#9F4F92");return e=d3.rgb(e)};b.strainSpecColor=function(a,e){var c=parseInt(a.substr(1,2),16),h=parseInt(a.substr(3,2),16),f=parseInt(a.substr(5),16);"BNLX"===e.getAttribute("strain").toUpperCase()?
(f+=64,c-=32,h-=32):"SHR"===e.getAttribute("strain").toUpperCase()||"SHRH"===e.getAttribute("strain").toUpperCase()?(c+=64,f-=32,h-=32):"F344_ST"===e.getAttribute("strain").toUpperCase()?(f+=32,c-=16,h-=16):"LE_ST"===e.getAttribute("strain").toUpperCase()&&(c+=32,f-=16,h-=16);255<c&&(c=255);255<h&&(h=255);255<f&&(f=255);return"#"+c.toString(16)+h.toString(16)+f.toString(16)};b.pieStrainSpecColor=function(a,e){var c=parseInt(a.substr(1,2),16),h=parseInt(a.substr(3,2),16),f=parseInt(a.substr(5),16);
if("BNLX"===e.toUpperCase())f+=64,c-=32,h-=32;else if("SHR"===e.toUpperCase()||"SHRH"===e.toUpperCase())c+=64,f-=32,h-=32;255<c&&(c=255);255<h&&(h=255);255<f&&(f=255);return a="#"+c.toString(16)+h.toString(16)+f.toString(16)};b.pieColor=function(a,e){var c="#000000";"ensemblcoding"===b.trackClass?c="#DFC184":"braincoding"===b.trackClass?c=b.pieStrainSpecColor("#7EB5D6",a.data.names):"ensemblnoncoding"===b.trackClass?c="#B58AA5":"brainnoncoding"===b.trackClass?(c="#CECFCE",null!==a.data.names&&"undefined"!==
typeof a.data.names&&"BNLX"===a.data.names.toUpperCase()?c="#3E75FF":null===a.data.names||"undefined"===typeof a.data.names||"SHR"!==a.data.names.toUpperCase()&&"SHRH"!==a.data.names.toUpperCase()||(c="#FE7596")):"ensemblsmallnc"===b.trackClass?c=b.pieColorPalette(a.data.names):"brainsmallnc"===b.trackClass?c=b.pieStrainSpecColor("#99CC99",a.data.names):0===b.trackClass.indexOf("liverTotal")?c=b.pieStrainSpecColor("#bbbedd",a.data.names):"heartTotal"===b.trackClass?c=b.pieStrainSpecColor("#DC7252",
a.data.names):0===b.trackClass.indexOf("brainTotal")?c=b.pieStrainSpecColor("#7EB5D6",a.data.names):"liversmallnc"===b.trackClass?c=b.pieStrainSpecColor("#8b8ead",a.data.names):"heartsmallnc"===b.trackClass?c=b.pieStrainSpecColor("#BC5232",a.data.names):"mergedTotal"===b.trackClass&&(c="#9F4F92");return c=d3.rgb(c)};b.getDisplayID=function(a){-1<b.trackClass.indexOf("smallnc")||-1<a.indexOf("_")&&(a=a.substr(a.indexOf("_")+1));return a};b.createToolTip=function(a){var e="";if(-1<b.trackClass.indexOf("smallnc")){e=
"Known - "+a.getAttribute("biotype");var c=".";1==a.getAttribute("strand")?c="+":-1==a.getAttribute("strand")&&(c="-");if(0===(new String(a.getAttribute("ID"))).indexOf("P")){var h=getAllChildrenByName(getFirstChildByName(a,"TranscriptList"),"Transcript");getAllChildrenByName(getFirstChildByName(a,"StrainQuantList"),"Strains")[1].getAttribute("strain");e=h[0].getAttribute("category")+" - "+h[0].getAttribute("source")}h='<BR><div id="ttSVG" style="background:#FFFFFF;"></div>ID: '+a.getAttribute("ID");
-1===b.trackClass.indexOf("ensembl")&&(h=h+"<BR>PhenoGen ID: "+a.getAttribute("intGeneID"));h=h+"<BR>Length: "+(a.getAttribute("stop")-a.getAttribute("start"))+"<BR>Type:"+e+"<BR>Location: "+a.getAttribute("chromosome")+":"+numberWithCommas(a.getAttribute("start"))+"-"+numberWithCommas(a.getAttribute("stop"))+"<BR>Strand: "+c+"<BR>"}else{var f=a.getAttribute("ID");f=b.getDisplayID(f);var g="";a.getAttribute("geneSymbol")?g=a.getAttribute("geneSymbol"):a.parent&&a.parent.getAttribute("geneSymbol")&&
(g=a.parent.getAttribute("geneSymbol"));c=".";1==a.getAttribute("strand")?c="+":-1==a.getAttribute("strand")&&(c="-");if(a.parent){h=getAllChildrenByName(getFirstChildByName(a.parent,"TranscriptList"),"Transcript");for(var l=0;l<h.length;l++){var n=new String(h[l].getAttribute("ID"));f!=n&&(-1<(new String(h[l].getAttribute("ID"))).indexOf("ENS")?e+="<B>"+n+"</B>":(e+="<B>"+n+"</B>",-1==(new String(h[l].getAttribute("ID"))).indexOf("ENS")&&(n=getFirstChildByName(getFirstChildByName(h[l],"annotationList"),
"annotation"),null!=n&&(e+=" - "+n.getAttribute("reason")))),e+="<br>");if(""==g){n=getAllChildrenByName(getFirstChildByName(h[l],"annotationList"),"annotation");for(var p=0;p<n.length&&""==g;p++)"AKA"==n[p].getAttribute("source")&&(g=n[p].getAttribute("annot_value"),g=(new String(g)).split(":"),g=0!=(new String(g[g.length-1])).indexOf("ENS")?g[g.length-1]:g[0])}}h='<BR><div id="ttSVG" style="background:#FFFFFF;overflow:"></div><BR>Transcript ID: '+f+"<BR>Location: "+a.getAttribute("chromosome")+
":"+numberWithCommas(a.getAttribute("start"))+"-"+numberWithCommas(a.getAttribute("stop"))+"<BR>Strand: "+c;h=h+"<BR><BR>Gene Symbol: "+g+"<BR>Gene ID: "+b.getDisplayID(a.parent.getAttribute("ID"))+"<BR><BR>Other Transcripts:<BR>"+e+"<BR>"}else{h=getAllChildrenByName(getFirstChildByName(a,"TranscriptList"),"Transcript");for(l=0;l<h.length;l++)if(n=new String(h[l].getAttribute("ID")),-1<(new String(h[l].getAttribute("ID"))).indexOf("ENS")?e+="<B>"+n+"</B>":(e+="<B>"+n+"</B>",-1===(new String(h[l].getAttribute("ID"))).indexOf("ENS")&&
(n=getFirstChildByName(getFirstChildByName(h[l],"annotationList"),"annotation"),null!=n&&(e+=" - "+n.getAttribute("reason")))),e+="<br>",0===g.length)for(n=getAllChildrenByName(getFirstChildByName(h[l],"annotationList"),"annotation"),p=0;p<n.length&&0===g.length;p++)"AKA"===n[p].getAttribute("source")&&(g=n[p].getAttribute("annot_value"),g=(new String(g)).split(":"),g=0!==(new String(g[g.length-1])).indexOf("ENS")?g[g.length-1]:g[0]);h='<BR><div id="ttSVG" style="background:#FFFFFF;overflow:scroll;max-height:400px;"></div>Gene ID: '+
f+"<BR>Gene Symbol: "+g+"<BR>Location: "+a.getAttribute("chromosome")+":"+numberWithCommas(a.getAttribute("start"))+"-"+numberWithCommas(a.getAttribute("stop"))+"<BR>Strand: "+c+"<BR><BR>Transcripts:<BR>"+e+"<BR>"}"brainTotal"!==b.trackClass&&"liverTotal"!==b.trackClass||!(-1<a.getAttribute("ID").indexOf("PRN6T")||-1<a.getAttribute("ID").indexOf("PRN6G"))||(c="Gene",-1<a.getAttribute("ID").indexOf("PRN6T")&&(c="Transcript"),h=h+'<div>Heritability: <span id="ttsingleHerit"></span></div>'+c+' Expression:<BR><div style="text-align:center;">Median Estimated Counts Per Million</div><div id="ttChart"></div>',
e="Brain",f="Whole Brain","liverTotal"===b.trackClass&&(f=e="Liver"),tmpChart=chart({data:"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/"+e+"expr.json",selector:"#ttChart",allowResize:!1,type:"scatter",width:"400",height:"275",displayHerit:!1,displayControls:!1,title:c+" Expression",titlePrefix:f,filterID:a.getAttribute("ID")}))}return h};b.redraw=function(){b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(var a=0;a<b.gsvg.width;a++)b.yMaxArr[a]=0,b.yArr[0][a]=0;b.trackYMax=0;a=b.xScale.domain()[0];
a=b.xScale.domain()[1]-a;var e=0;if(b.reqDataVer!==b.dataVer)b.updateDataVersion(b.reqDataVer,0);else if("undefined"!==typeof b.prevSetting&&b.prevSetting.density!==b.density)b.draw(b.data);else if(a<b.trxCutoff&&"Gene"===b.drawnAs||a>=b.trxCutoff&&"Trx"===b.drawnAs&&"Trx"!==b.drawAs||"Gene"===b.drawnAs&&$("#forceTrxCBX"+b.gsvg.levelNumber).is(":checked"))b.draw(b.data);else if(a<b.trxCutoff&&"Trx"===b.drawnAs&&"Trx"!==b.drawAs&&(e=1),"Gene"===b.drawAs&&0===e||-1<b.trackClass.indexOf("smallnc"))b.svg&&
(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").attr("transform",function(c,h){return"translate("+b.xScale(c.getAttribute("start"))+","+b.calcY(parseInt(c.getAttribute("start"),10),parseInt(c.getAttribute("stop"),10),h)+")"}),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene rect").attr("width",function(c){var h=1;1<b.xScale(c.getAttribute("stop"))-b.xScale(c.getAttribute("start"))&&(h=b.xScale(c.getAttribute("stop"))-b.xScale(c.getAttribute("start")));
return h}).attr("stroke",b.colorStroke),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").each(function(c){var h=d3.select(this),f=parseInt(c.getAttribute("strand"),10);if(-1===f||1===f){var g=">";-1===f&&(g="<");f="";var l=h.select("rect").attr("width");if(8.3<=l&&15.8>=l)f=g;else for(;8.5<l;)f+=g,l-=8.5;h.select("text#strandTxt").text(f)}if(2===b.density){var n=c.getAttribute("ID");c.getAttribute("geneSymbol")&&0<c.getAttribute("geneSymbol").length&&(n=n+" ("+c.getAttribute("geneSymbol")+
")");0===h.select("text#lblTxt").size()?h.append("svg:text").attr("dx",function(){var p=b.xScale(c.getAttribute("start"));return p=p<$(window).width()/2?b.xScale(c.getAttribute("stop"))-b.xScale(c.getAttribute("start"))+5:-9*n.length}).attr("dy",10).attr("id","lblTxt").text(n):h.select("text#lblTxt").attr("dx",function(){var p=b.xScale(c.getAttribute("start"));return p=p<$(window).width()/2?b.xScale(c.getAttribute("stop"))-b.xScale(c.getAttribute("start"))+5:-9*n.length})}else h.select("text#lblTxt").remove()})),
1===b.density?b.svg.attr("height",30):2===b.density?b.svg.attr("height",15*(b.trackYMax+1)):3===b.density&&b.svg.attr("height",15*(b.trackYMax+1));else if(1===e||"Trx"===b.drawAs)b.svg.selectAll(".trx"+b.gsvg.levelNumber).attr("transform",function(c,h){return"translate(0,"+b.calcY(parseInt(c.getAttribute("start"),10),parseInt(c.getAttribute("stop"),10),h)+")"}).each(function(c,h){var f=parseInt(c.getAttribute("start"),10),g=parseInt(c.getAttribute("stop"),10);c.getAttribute("cdsStart")&&c.getAttribute("cdsStop")&&
(f=parseInt(c.getAttribute("cdsStart"),10),g=parseInt(c.getAttribute("cdsStop"),10));exList=getAllChildrenByName(getFirstChildByName(c,"exonList"),"exon");var l="";1===b.gsvg.levelNumber?l="tx":99===b.gsvg.levelNumber&&(l="ttTx");for(var n=0;n<exList.length;n++){var p=exList[n].getAttribute("start"),t=exList[n].getAttribute("stop");if(p<f&&f<t||t>g&&g>p){var v=p,y=f;t>g?(v=g,y=t,t=g):p=f;d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g#"+l+b.cleanID(c.getAttribute("ID"))+b.gsvg.levelNumber+
" rect#ExNC"+exList[n].getAttribute("ID")).attr("x",function(B){return b.xScale(v)}).attr("width",function(B){return b.xScale(y)-b.xScale(v)})}d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g#"+l+b.cleanID(c.getAttribute("ID"))+b.gsvg.levelNumber+" rect#Ex"+exList[n].getAttribute("ID")).attr("x",function(B){return b.xScale(p)}).attr("width",function(B){return b.xScale(t)-b.xScale(p)});if(0<n){var w=">";"-1"==c.getAttribute("strand")&&(w="<");var A=w,C=b.xScale(exList[n-1].getAttribute("stop")),
F=b.xScale(exList[n].getAttribute("start")),E=F-C,D=0;if(7>E||"0"==c.getAttribute("strand")||"."==c.getAttribute("strand"))A="";else for(E-=7;8<E;)0===D?(A+=" ",D=1):(A+=w,D=0),E-=7;d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g.trx"+b.gsvg.levelNumber+"#"+l+b.cleanID(c.getAttribute("ID"))+b.gsvg.levelNumber+" line#Int"+exList[n-1].getAttribute("ID")+"_"+exList[n].getAttribute("ID")).attr("x1",C).attr("x2",F);d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g.trx"+b.gsvg.levelNumber+"#"+
l+b.cleanID(c.getAttribute("ID"))+b.gsvg.levelNumber+" #IntTxt"+exList[n-1].getAttribute("ID")+"_"+exList[n].getAttribute("ID")).attr("dx",C+1).text(A)}}if(2===b.density){var z=c.getAttribute("ID");c.getAttribute("geneSymbol")&&0<c.getAttribute("geneSymbol").length&&(z=z+" ("+c.getAttribute("geneSymbol")+")");0===d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g.trx"+b.gsvg.levelNumber+"#"+l+b.cleanID(c.getAttribute("ID"))+b.gsvg.levelNumber+" text#lblTxt").size()?d3.select("#Level"+b.gsvg.levelNumber+
b.trackClass+" g.trx"+b.gsvg.levelNumber+"#"+l+b.cleanID(c.getAttribute("ID"))+b.gsvg.levelNumber).append("svg:text").attr("dx",function(){var B=b.xScale(c.parent.getAttribute("start"));return B=B<$(window).width()/2?b.xScale(c.parent.getAttribute("stop"))-b.xScale(c.parent.getAttribute("start"))+5:-9*z.length}).attr("dy",10).attr("id","lblTxt").text(z):d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g.trx"+b.gsvg.levelNumber+"#"+l+b.cleanID(c.getAttribute("ID"))+b.gsvg.levelNumber+" text#lblTxt").attr("dx",
function(){var B=b.xScale(c.getAttribute("start"));return B=B<$(window).width()/2?b.xScale(c.getAttribute("stop"))-b.xScale(c.getAttribute("start"))+5:-9*z.length})}else d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g.trx"+b.gsvg.levelNumber+"#"+l+b.cleanID(c.getAttribute("ID"))+b.gsvg.levelNumber+" text#lblTxt").remove()}),1===b.density?b.svg.attr("height",30):2===b.density?b.svg.attr("height",15*(b.trackYMax+1)):3===b.density&&b.svg.attr("height",15*(b.trackYMax+1));b.redrawSelectedArea()};
b.setSelected=function(a){if(a)if(0<d3.selectAll("g.gene").size()){if(d3.selectAll("rect.selected").each(function(){d3.select(this).attr("class","").style("fill",b.color)}),a=d3.select("g.gene rect#"+a))a.attr("class","selected").style("fill","green"),b.setupDetailedView(a.data()[0]),selectGene=""}else 0<d3.selectAll("g.trx"+b.gsvg.levelNumber).size()&&(a=(new String(a)).replace(".","_"),b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("line").style("stroke",b.color),b.svg.selectAll("g.trx"+
b.gsvg.levelNumber+".selected").selectAll("rect").style("fill",b.color),b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("text").style("opacity","0.6").style("fill",b.color),b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").each(function(){var e=new String($(this).attr("class"));e=e.replace(" selected","");$(this).attr("class",e)}),b.svg.selectAll("g.gene"+a).each(function(){var e=$(this).attr("class")+" selected";$(this).attr("class",e)}),b.svg.selectAll("g.gene"+a).selectAll("line").style("stroke",
"green"),b.svg.selectAll("g.gene"+a).selectAll("rect").style("fill","green"),b.svg.selectAll("g.gene"+a).selectAll("text").style("opacity","0.3").style("fill","green"),b.svg.selectAll("g.gene"+a)&&((a=b.svg.selectAll("g.gene"+a).data())&&0<a.length?b.setupDetailedView(a[0].parent):(console.log("tmp[0]"),console.log(a))),selectGene="")};b.clearSelection=function(){b.selectionStart=-1;b.selectionEnd=-1;b.svg.selectAll("rect.selectedArea").remove();0<b.svg.selectAll("g.gene").size()?b.svg.selectAll("rect.selected").each(function(a){d3.select(this).attr("class",
"").style("fill",b.color)}):0<b.svg.selectAll("g.trx"+b.gsvg.levelNumber).size()&&(b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("line").style("stroke",b.color),b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("rect").style("fill",b.color),b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("text").style("opacity","0.6").style("fill",b.color),b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").each(function(){var a=new String($(this).attr("class"));
a=a.replace(" selected","");$(this).attr("class",a)}))};b.setupDetailedView=function(a){if(a){b.gsvg.clearSelection();jQuery.Event("keyup").which=32;var e=b.gsvg.levelNumber+1;$("div#collapsableReport").is(":hidden")||($("div#collapsableReport").hide(),$("span[name='collapsableReport']").removeClass("less"));$("div#selectedDetailHeader").is(":hidden")&&$("div#selectedDetailHeader").show();$("div#selectedDetail").is(":hidden")&&$("div#selectedDetail").show();var c="none";0===b.trackClass.indexOf("liverTotal")?
c=b.trackClass:"heartTotal"===b.trackClass?c="heartTotal":0===b.trackClass.indexOf("brainTotal")?c=b.trackClass:"mergedTotal"===b.trackClass?c="mergedTotal":"protein_coding"===a.getAttribute("biotype")&&200<=a.getAttribute("stop")-a.getAttribute("start")?c="protein":"protein_coding"!==a.getAttribute("biotype")&&200<=a.getAttribute("stop")-a.getAttribute("start")?c="long":200>a.getAttribute("stop")-a.getAttribute("start")&&(c="small");var h=0,f=0;if("protein"===c||"long"===c||0===c.indexOf("liverTotal")||
"heartTotal"===c||0===c.indexOf("brainTotal")||"mergedTotal"===c||"small"===c&&"rn5"!==genomeVer||"small"===c&&-1<(new String(a.getAttribute("ID"))).indexOf("ENS")){console.log("totalType");h=a.getAttribute("ID");var g="";if(a.getAttribute("geneSymbol")&&0<a.getAttribute("geneSymbol").length)h=h+" ("+a.getAttribute("geneSymbol")+")";else{f=getAllChildrenByName(getFirstChildByName(a,"TranscriptList"),"Transcript");for(var l=0;l<f.length&&""===g;l++)if(""===g)for(var n=getAllChildrenByName(getFirstChildByName(f[l],
"annotationList"),"annotation"),p=0;p<n.length&&0===g.length;p++)if("AKA"===n[p].getAttribute("source")){var t=n[p].getAttribute("annot_value");t=(new String(t)).split(":");1<=t.length?(g=t[0],h=h+" ("+g+")"):2<=t.length&&(g=t[0],t=t[1],h=h+" ("+t+")")}}f=parseInt(a.getAttribute("start"),10);n=parseInt(a.getAttribute("stop"),10);a.getAttribute("extStart")&&a.getAttribute("extStop")&&(f=parseInt(a.getAttribute("extStart"),10),n=parseInt(a.getAttribute("extStop"),10));svgViewIDList[e]||(svgViewIDList[e]=
b.gsvg.currentView?b.gsvg.currentView.ViewID:defaultView);l=GenomeSVG("div#selectedImage",b.gsvg.width,f,n,e,h,"transcript");l.xMin=f-.05*(n-f);l.xMax=n+.05*(n-f);h=l.xMin;f=l.xMax;svgList[e]=l;svgList[e].txType=c;svgList[e].selectedData=a;selectedGeneSymbol=a.getAttribute("geneSymbol");b.gsvg.selectedGeneSymbol=a.getAttribute("geneSymbol");selectedID=new String(a.getAttribute("ID"));-1===selectedID.indexOf("ENS")&&0<g.length&&(selectedID=g);$("div#selectedImage").show();console.log("here");-1<(new String(selectedID)).indexOf("ENS")&&
-1<b.trackClass.indexOf("ensembl")?(console.log("geneReport"),$("div#selectedReport").show(),e=pathPrefix+"geneReport.jsp",a={id:selectedID,geneSymbol:selectedGeneSymbol,chromosome:chr,species:organism,genomeVer:genomeVer},DisplaySelectedDetailReport(e,a)):"small"!==c?$("div#selectedReport").html("<BR><BR>Detailed Gene Reports are not currently provided for RNA-Seq(Cufflinks) generated genes that are novel and have not been matched to an existing annotated gene.  In the future overlapping probesets and SNPs will be summarized in the same manner.  This feature should be added by December 2014.  Please keep checking back or let us know you'd like to see it sooner."):
"rn6"===genomeVer&&(a=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/"+b.trackClass+".xml",e=pathPrefix+"smallRNAReport.jsp",a={dataPath:a,id:selectedID},DisplaySelectedDetailReport(e,a))}else"small"===c&&-1===(new String(a.getAttribute("ID"))).indexOf("ENS")&&"rn5"===genomeVer&&($("div#selectedImage").hide(),$("div#selectedReport").show(),h=a.getAttribute("start"),f=a.getAttribute("stop"),e=pathPrefix+"viewSmallNonCoding.jsp",a={id:a.getAttribute("ID"),name:"smRNA_"+
a.getAttribute("ID")},DisplaySelectedDetailReport(e,a));b.gsvg&&b.gsvg.selectSvg&&b.gsvg.selectSvg.changeSelection(h,f);$("html, body").animate({scrollTop:$("#selectedDetail").offset().top},200)}};b.getDisplayedData=function(){var a=[],e=0,c=[];if(-1<b.trackClass.indexOf("smallnc")){var h=0;b.counts=[];b.trackClass.indexOf("ensembl");"Gene"===b.drawnAs?c=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene"):"Trx"===b.drawnAs&&(c=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.trx"));
c.each&&c.each(function(g){var l=b.xScale(g.getAttribute("start")),n=b.xScale(g.getAttribute("stop"));if(0<=l&&l<=b.gsvg.width||0<=n&&n<=b.gsvg.width||0>=l&&n>=b.gsvg.width)l="Ensembl","undefined"!==typeof g.getAttribute("strain")?l=g.getAttribute("strain"):"undefined"!==typeof g.getAttribute("biotype")&&(l=g.getAttribute("biotype")),"undefined"===typeof b.counts[l]?(b.counts[l]={},b.counts[h]=b.counts[l],h++,b.counts[l].value=1,b.counts[l].names=l):b.counts[l].value++,a[e]=g,e++,f++})}else if("Gene"===
b.drawnAs)c=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene"),b.counts=[{value:0,names:"Ensembl"},{value:0,names:"Brain RNA-Seq"},{value:0,names:"Liver RNA-Seq"},{value:0,names:"Heart RNA-Seq"},{value:0,names:"Merged RNA-Seq"}],c.each(function(g){var l=b.xScale(g.getAttribute("start")),n=b.xScale(g.getAttribute("stop"));if(0<=l&&l<=b.gsvg.width||0<=n&&n<=b.gsvg.width)-1<(new String(g.childNodes[0].id)).indexOf("ENS")?b.counts[0].value++:-1<b.trackClass.indexOf("brain")?b.counts[1].value++:
-1<b.trackClass.indexOf("liver")?b.counts[2].value++:-1<b.trackClass.indexOf("heart")?b.counts[3].value++:-1<b.trackClass.indexOf("merged")&&b.counts[4].value++,a[e]=g,e++}),0===c.size()&&(b.counts=[]);else if("Trx"===b.drawnAs){c=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.trx"+b.gsvg.levelNumber);b.counts=[];var f=h=0;c.each(function(g){var l=b.xScale(g.getAttribute("start")),n=b.xScale(g.getAttribute("stop"));if(0<=l&&l<=b.gsvg.width||0<=n&&n<=b.gsvg.width||0>=l&&n>=b.gsvg.width)l=
"Ensembl","undefined"!==typeof g.getAttribute("strain")&&(l=g.getAttribute("strain")),"undefined"===typeof b.counts[l]?(b.counts[l]={},b.counts[h]=b.counts[l],h++,b.counts[l].value=1,b.counts[l].names=l):b.counts[l].value++,a[e]=g,e++,f++})}return a};b.updateData=function(a){d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/"+b.trackClass+".xml",function(e,c){if(e){if(0===a&&(0===b.trackClass.indexOf("heartTotal")||0===b.trackClass.indexOf("liverTotal")||0===b.trackClass.indexOf("brainTotal")||
"mergedTotal"===b.trackClass||-1<b.trackClass.indexOf("smallnc"))){var h="/"+pathPrefix;pathPrefix||(h="");var f=b.trackClass,g=panel;(0===b.trackClass.indexOf("liverTotal")||0===b.trackClass.indexOf("brainTotal"))&&0<b.trackClass.indexOf("_")&&(g=track.substr(track.indexOf("_")+1),"LEStm"===g&&(g="LE-Stm"),"F344Stm"===g&&(g="F344-Stm"));$.ajax({url:h+"generateTrackXML.jsp",type:"GET",cache:!1,asyn:!0,data:{chromosome:chr,minCoord:b.gsvg.xScale.domain()[0],maxCoord:b.gsvg.xScale.domain()[1],panel:g,
rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:f,folder:b.gsvg.folderName},dataType:"json",success:function(p){gtag("event","generateTrackGene",{event_category:"browser"})},error:function(p,t,v){}})}10>a?(h=2E3,1===a&&(h=5E3),setTimeout(function(){b.updateData(a+1)},h)):(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+b.trackClass),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).attr("height",
15),b.gsvg.addTrackErrorRemove(b.svg,"#Level"+b.gsvg.levelNumber+b.trackClass))}else if(c){h=c.documentElement.getElementsByTagName("Gene");f=[];g=[];for(var l=0,n=0;n<h.length;n++)h[n]&&(f[l]=h[n],g[h[n].getAttribute("ID")]=1,l++);for(n=0;n<b.data.length;n++)b.data[n]&&!g[b.data[n].getAttribute("ID")]&&(f[l]=b.data[n],l++);b.draw(f);b.hideLoading();setTimeout(function(){DisplayRegionReport()},300)}else b.hideLoading()})};b.updateDataVersion=function(a,e){var c=b.trackClass+"_"+a;d3.xml(dataPrefix+
"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/"+c+".xml",function(h,f){if(h){if(0===e){var g="/"+pathPrefix;pathPrefix||(g="");var l=panel;(0===track.indexOf("liverTotal")||0===track.indexOf("brainTotal"))&&0<track.indexOf("_")&&(l=track.substr(track.indexOf("_")+1),"LEStm"===l&&(l="LE-Stm"),"F344Stm"===l&&(l="F344-Stm"));$.ajax({url:g+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:b.gsvg.xScale.domain()[0],maxCoord:b.gsvg.xScale.domain()[1],
panel:l,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:c,folder:b.gsvg.folderName},dataType:"json",success:function(n){gtag("event","generateTrackGene",{event_category:"browser"})},error:function(n,p,t){}})}5>e?(g=1E4,0===e&&(g=5E3),setTimeout(function(){b.updateDataVersion(a,e+1)},g)):(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+b.trackClass),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).attr("height",
15),b.gsvg.addTrackErrorRemove(b.svg,"#Level"+b.gsvg.levelNumber+b.trackClass))}else g=f.documentElement.getElementsByTagName("Gene"),l=parseInt(a),b.dataVer=l,b.draw(g),b.hideLoading(),setTimeout(function(){DisplayRegionReport()},300)})};b.drawTrx=function(a,e){var c=parseInt(a.getAttribute("start"),10),h=parseInt(a.getAttribute("stop"),10);a.getAttribute("cdsStart")&&a.getAttribute("cdsStop")&&(c=parseInt(a.getAttribute("cdsStart"),10),h=parseInt(a.getAttribute("cdsStop"),10));var f="";1===b.gsvg.levelNumber?
f="tx":99===b.gsvg.levelNumber&&(f="ttTx");f=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" #"+f+b.cleanID(a.getAttribute("ID"))+b.gsvg.levelNumber);exList=getAllChildrenByName(getFirstChildByName(a,"exonList"),"exon");for(var g=0;g<exList.length;g++){var l=parseInt(exList[g].getAttribute("start"),10),n=parseInt(exList[g].getAttribute("stop"),10);if(l<c&&c<n||n>h&&h>l){var p=0,t=0,v=0,y=0;l<c?(p=b.xScale(l),t=b.xScale(c)-b.xScale(l),v=b.xScale(c),y=b.xScale(n)-b.xScale(c)):n>h&&(v=b.xScale(l),
y=b.xScale(h)-b.xScale(l),p=b.xScale(h),t=b.xScale(n)-b.xScale(h));f.append("rect").attr("x",p).attr("y",2.5).attr("height",5).attr("width",t).attr("title",function(A){return exList[g].getAttribute("ID")}).attr("id",function(A){return"ExNC"+exList[g].getAttribute("ID")}).style("fill",b.color).style("cursor","pointer");f.append("rect").attr("x",v).attr("height",10).attr("width",y).attr("title",function(A){return exList[g].getAttribute("ID")}).attr("id",function(A){return"Ex"+exList[g].getAttribute("ID")}).style("fill",
b.color).style("cursor","pointer")}else{p=10;t=0;if(l<c&&n<c||n>h&&l>h)p=5,t=2.5;f.append("rect").attr("x",function(A){return b.xScale(exList[g].getAttribute("start"))}).attr("y",t).attr("id",function(A){return"Ex"+exList[g].getAttribute("ID")}).attr("height",p).attr("width",function(A){return b.xScale(exList[g].getAttribute("stop"))-b.xScale(exList[g].getAttribute("start"))}).attr("title",function(A){return exList[g].getAttribute("ID")}).style("fill",b.color).style("cursor","pointer")}if(0<g&&(f.append("line").attr("x1",
function(A){return b.xScale(exList[g-1].getAttribute("stop"))}).attr("x2",function(A){return b.xScale(exList[g].getAttribute("start"))}).attr("y1",5).attr("y2",5).attr("id",function(A){return"Int"+exList[g-1].getAttribute("ID")+"_"+exList[g].getAttribute("ID")}).attr("stroke",b.color).attr("stroke-width","2"),"1"==a.getAttribute("strand")||"-1"==a.getAttribute("strand"))){l=">";if("-1"==a.getAttribute("strand")||"-"==a.getAttribute("strand"))l="<";n=l;p=b.xScale(exList[g-1].getAttribute("stop"));
t=b.xScale(exList[g].getAttribute("start"))-p;v=0;if(7>t)n="";else for(t-=7;8<t;)0==v?(n+=" ",v=1):(n+=l,v=0),t-=7;f.append("svg:text").attr("id",function(A){return"IntTxt"+exList[g-1].getAttribute("ID")+"_"+exList[g].getAttribute("ID")}).attr("dx",p+1).attr("dy","11").style("pointer-events","none").style("opacity","0.5").style("fill",b.color).style("font-size","16px").text(n)}}if(2==b.density){var w=a.getAttribute("ID");"undefined"!==typeof a.getAttribute("geneSymbol")&&0<a.getAttribute("geneSymbol").length&&
(w=w+" ("+a.getAttribute("geneSymbol")+")");f.append("svg:text").attr("dx",function(){var A=b.xScale(a.getAttribute("start"));return A=A<$(window).width()/2?b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start"))+5:-9*w.length}).attr("dy",10).attr("id","lblTxt").text(w)}else f.select("text#lblTxt").remove()};b.getSVGID=function(a){return b.getDisplayID(a.getAttribute("ID"))+" ("+a.getAttribute("geneSymbol")+")"};b.setupToolTipSVG=function(a,e){if("undefined"!==typeof a.getAttribute("extStart")&&
null!==a.getAttribute("extStart")){var c=parseInt(a.getAttribute("extStart"),10);var h=parseInt(a.getAttribute("extStop"),10)}else c=parseInt(a.getAttribute("start"),10),h=parseInt(a.getAttribute("stop"),10);var f=Math.floor((h-c)*e);10>f&&(f=10);c-=f;h+=f;f=toolTipSVG("div#ttSVG",450,c,h,99,b.getSVGID(a),"transcript");f.xMin=c;f.xMax=h;var g="none";0===b.trackClass.indexOf("liverTotal")?g=b.trackClass:"heartTotal"==b.trackClass?g="heartTotal":0===b.trackClass.indexOf("brainTotal")?g=b.trackClass:
"mergedTotal"==b.trackClass?g="mergedTotal":200>parseInt(a.getAttribute("stop"),10)-parseInt(a.getAttribute("start"),10)?g="small":"protein_coding"==a.getAttribute("biotype")&&200<=parseInt(a.getAttribute("stop"),10)-parseInt(a.getAttribute("start"),10)?g="protein":"protein_coding"!=a.getAttribute("biotype")&&200<=parseInt(a.getAttribute("stop"),10)-parseInt(a.getAttribute("start"),10)&&(g="long");f.txType=g;f.selectedData=a;g=[];g[0]=a;"undefined"!==typeof a.parent&&(g[0]=a.parent);f.addTrack(b.trackClass,
2,"DrawTrx",g);for(g=0;g<b.ttTrackList.length;g++)if(b.trackClass!==b.ttTrackList[g]){var l=b.gsvg.getTrackData(b.ttTrackList[g]),n=[];if("undefined"!==typeof l&&0<l.length){for(var p=0,t=0;t<l.length;t++)if(c<=parseInt(l[t].getAttribute("start"),10)&&parseInt(l[t].getAttribute("start"),10)<=h||c<=parseInt(l[t].getAttribute("stop"),10)&&parseInt(l[t].getAttribute("stop"),10)<=h||parseInt(l[t].getAttribute("start"),10)<=c&&parseInt(l[t].getAttribute("stop"),10)>=c)n[p]=l[t],p++;0<n.length&&f.addTrack(b.ttTrackList[g],
3,"DrawTrx",n)}}};b.draw=function(a){b.data=a;b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(var e=0;e<b.gsvg.width;e++)b.yMaxArr[e]=0,b.yArr[0][e]=0;b.svg.selectAll(".gene").remove();e=b.drawAs;var c=b.xScale.domain()[0];if(b.xScale.domain()[1]-c<b.trxCutoff||$("#forceTrxCBX"+b.gsvg.levelNumber).is(":checked"))b.drawAs="Trx";c="Genes";"Trx"==b.drawAs&&(c="Transcripts");var h="Protein Coding",f=" / PolyA+";-1<b.trackClass.indexOf("noncoding")?(h="Long Non-Coding",f=" / Non-PolyA+"):-1<b.trackClass.indexOf("smallnc")?
(h="Brain",-1<b.trackClass.indexOf("liver")?h="Liver":-1<b.trackClass.indexOf("heart")&&(h="Heart"),h+=" Small RNA",f=""):0===b.trackClass.indexOf("liverTotal")?(h="Liver RNA-Seq Reconstruction ",f="Total RNA"):"heartTotal"==b.trackClass?(h="Heart RNA-Seq Reconstruction ",f="Total RNA"):0===b.trackClass.indexOf("brainTotal")?(h="Whole Brain RNA-Seq Reconstruction ",f="Total RNA"):"mergedTotal"==b.trackClass&&(h="Merged (Brain,Heart,Liver) Reconstructed",f="Total RNA");h=-1<b.trackClass.indexOf("ensembl")?
"Ensembl "+h+" "+c:-1===b.trackClass.indexOf("brainTotal")&&-1===b.trackClass.indexOf("liverTotal")&&"heartTotal"!=b.trackClass&&"mergedTotal"!=b.trackClass?"Reconstruction "+h+f+" "+c:h+f+" "+c;(0===b.trackClass.indexOf("liverTotal")||0===b.trackClass.indexOf("brainTotal"))&&0<b.trackClass.indexOf("_")&&(c=b.trackClass.substr(b.trackClass.indexOf("_")+1),"LEStm"===c&&(c="LE-Stm"),"F344Stm"===c&&(c="F344-Stm"),h=c+" Filtered (>=1.0TPM) "+h);b.updateLabel(h);b.redrawLegend();c=a;if("Trx"===b.drawAs&&
-1===b.trackClass.indexOf("smallnc"))for(c=[],f=h=0;f<a.length;f++)if("undefined"!==typeof a[f])for(var g=getAllChildrenByName(getFirstChildByName(a[f],"TranscriptList"),"Transcript"),l=0;l<g.length;l++)c[h]=g[l],c[h].parent=a[f],h++;0<c.length&&("Gene"===b.drawAs||-1<b.trackClass.indexOf("smallnc")?(b.drawnAs="Gene",b.svg.selectAll(".trx0").each(function(){d3.select(this).remove()}),a=b.svg.selectAll(".gene").data(c,key).attr("transform",function(n,p){return"translate("+b.xScale(n.getAttribute("start"))+
","+b.calcY(parseInt(n.getAttribute("start"),10),parseInt(n.getAttribute("stop"),10),p)+")"}),a.enter().append("g").attr("class","gene").attr("transform",function(n,p){return"translate("+b.xScale(n.getAttribute("start"))+","+b.calcY(parseInt(n.getAttribute("start"),10),parseInt(n.getAttribute("stop"),10),p)+")"}).merge(a).append("rect").attr("height",10).attr("rx",1).attr("ry",1).attr("width",function(n){return b.xScale(n.getAttribute("stop"))-b.xScale(n.getAttribute("start"))}).attr("title",function(n){return n.getAttribute("ID")}).attr("stroke",
b.colorStroke).attr("stroke-width","1").attr("id",function(n){return b.cleanID(n.getAttribute("ID"))}).style("fill",b.color).style("cursor","pointer").on("click",function(n){setTimeout(function(){b.setupDetailedView(n);d3.select(this).attr("class","selected").style("fill","green")}.bind(this),10)}).on("dblclick",b.zoomToFeature).on("mouseover",function(n){0===b.gsvg.isToolTip&&(overSelectable=1,$("#mouseHelp").html("<B>Click</B> to see additional details. <B>Double Click</B> to zoom in on this feature."),
d3.select(this).style("fill","green"),tt.transition().duration(200).style("opacity",1).style("top",function(){return b.positionTTTop(d3.event.pageY)}).style("left",function(){return b.positionTTLeft(d3.event.pageX)}),tt.html(b.createToolTip(n)),n&&(b.triggerTableFilter(n),-1===b.trackClass.indexOf("smallnc")?"Trx"===b.drawAs?b.setupToolTipSVG(n.parent,.05):b.setupToolTipSVG(n,.05):b.setupToolTipSVG(n,.05),tt.style("top",function(){return b.positionTTTop(d3.event.pageY)})))}).on("mouseout",function(n){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");
"selected"!==d3.select(this).attr("class")&&d3.select(this).style("fill",b.color);tt.transition().delay(500).duration(200).style("opacity",0);b.clearTableFilter(n)}),a.exit().remove(),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").each(function(n){if(n){var p=d3.select(this);if("-1"==n.getAttribute("strand")||"1"==n.getAttribute("strand")){var t=">";"-1"==n.getAttribute("strand")&&(t="<");var v=t,y=p.select("rect").attr("width");if(8.5>y)v="";else for(y-=8.5,v=t;8.7<y;)v+=
t,y-=8.5;p.append("svg:text").attr("dx","1").attr("dy","10").attr("id","strandTxt").style("pointer-events","none").text(v)}if(2===b.density){var w=n.getAttribute("ID");n.getAttribute("geneSymbol")&&0<n.getAttribute("geneSymbol").length&&(w=w+" ("+n.getAttribute("geneSymbol")+")");p.append("svg:text").attr("dx",function(){var A=b.xScale(n.getAttribute("start"));return A=A<$(window).width()/2?b.xScale(n.getAttribute("stop"))-b.xScale(n.getAttribute("start"))+5:-9*w.length}).attr("dy",10).attr("id",
"lblTxt").text(w)}else p.select("text#lblTxt").remove()}}),1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").size()+1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1))):"Trx"==b.drawAs&&(b.drawnAs="Trx",b.svg.selectAll(".gene").each(function(){d3.select(this).remove()}),b.svg.selectAll(".trx"+b.gsvg.levelNumber).remove(),a=b.svg.selectAll(".trx"+b.gsvg.levelNumber).data(c,key).attr("transform",function(n,
p){return"translate("+b.xScale(n.getAttribute("start"))+","+b.calcY(parseInt(n.getAttribute("start"),10),parseInt(n.getAttribute("stop"),10),p)+")"}),a.enter().append("g").attr("class",function(n){n=new String(n.parent.getAttribute("ID"));return"trx"+b.gsvg.levelNumber+" gene"+n.replace(".","_")}).attr("transform",function(n,p){return"translate(0,"+b.calcY(parseInt(n.getAttribute("start"),10),parseInt(n.getAttribute("stop"),10),p)+")"}).attr("id",function(n){var p="";1==b.gsvg.levelNumber&&(p="tx");
99==b.gsvg.levelNumber&&(p="ttTx");return p+b.cleanID(n.getAttribute("ID"))+b.gsvg.levelNumber}).style("cursor","pointer").on("click",function(n){setTimeout(function(){if(0==b.gsvg.levelNumber){var p=(new String(n.parent.getAttribute("ID"))).replace(".","_");b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("line").style("stroke",b.color);b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("rect").style("fill",b.color);b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").selectAll("text").style("opacity",
"0.6").style("fill",b.color);b.svg.selectAll("g.trx"+b.gsvg.levelNumber+".selected").each(function(){var t=new String($(this).attr("class"));t=t.replace(" selected","");$(this).attr("class",t)});b.svg.selectAll("g.gene"+p).each(function(){var t=$(this).attr("class")+" selected";$(this).attr("class",t)});b.svg.selectAll("g.gene"+p).selectAll("line").style("stroke","green");b.svg.selectAll("g.gene"+p).selectAll("rect").style("fill","green");b.svg.selectAll("g.gene"+p).selectAll("text").style("opacity",
"0.3").style("fill","green");b.setupDetailedView(n.parent)}},10)}).on("dblclick",b.zoomToFeature).on("mouseover",function(n){if(0===b.gsvg.isToolTip){if(0===b.gsvg.levelNumber&&"undefined"!==typeof n.parent){var p=(new String(n.parent.getAttribute("ID"))).replace(".","_");b.svg.selectAll("g.gene"+p).selectAll("line").style("stroke","green");b.svg.selectAll("g.gene"+p).selectAll("rect").style("fill","green");b.svg.selectAll("g.gene"+p).selectAll("text").style("opacity","0.3").style("fill","green")}else d3.select(this).selectAll("line").style("stroke",
"green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green");tt.transition().duration(200).style("opacity",1);tt.html(b.createToolTip(n)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)});b.triggerTableFilter(n);if("undefined"!==typeof n){if(-1===b.trackClass.indexOf("smallnc"))b.setupToolTipSVG(n,.05);else{p=toolTipSVG("div#ttSVG",450,
parseInt(n.getAttribute("start"),10)-10,parseInt(n.getAttribute("stop"),10)+10,99,b.getDisplayID(n.getAttribute("ID")),"");p.xMin=parseInt(n.getAttribute("start"),10)-20;p.xMax=parseInt(n.getAttribute("stop"),10)+20;var t=[];t[0]=n;p.addTrack(b.trackClass,2,"",t)}tt.style("top",function(){return b.positionTTTop(d3.event.pageY)})}}}).on("mouseout",function(n){if(-1==(new String(d3.select(this).attr("class"))).indexOf("selected"))if(0==b.gsvg.levelNumber){var p=(new String(n.parent.getAttribute("ID"))).replace(".",
"_");b.svg.selectAll("g.gene"+p).selectAll("line").style("stroke",b.color);b.svg.selectAll("g.gene"+p).selectAll("rect").style("fill",b.color);b.svg.selectAll("g.gene"+p).selectAll("text").style("opacity","0.6").style("fill",b.color)}else d3.select(this).selectAll("line").style("stroke",b.color),d3.select(this).selectAll("rect").style("fill",b.color),d3.select(this).selectAll("text").style("opacity","0.6").style("fill",b.color);tt.transition().delay(500).duration(200).style("opacity",0);b.clearTableFilter(n)}).merge(a).each(b.drawTrx),
a.exit().remove(),a,1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.trx"+b.gsvg.levelNumber).size()+1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1))));""!=selectGene&&b.setSelected(selectGene);b.redrawSelectedArea();b.drawAs=e};b.redrawLegend=function(){var a=[],e=0;"Trx"===b.drawAs&&("braincoding"===b.trackClass?"Rn"===organism&&(a[e]={color:"#7EB5D6",label:"All"},e++,a[e]={color:"#5E95FF",label:"BN-Lx"},
e++,a[e]={color:"#BE95B6",label:"SHR"},e++):"brainnoncoding"===b.trackClass?"Rn"===organism&&(a[e]={color:"#CECFCE",label:"All"},e++,a[e]={color:"#3E75FF",label:"BN-Lx"},e++,a[e]={color:"#FE7596",label:"SHR"},e++):"liverTotal"===b.trackClass?(a[e]={color:"#bbbedd",label:"All"},e++,a[e]={color:"#9b9eFF",label:"BN-Lx"},e++,a[e]={color:"#Fb9eBd",label:"SHR"},e++):"heartTotal"===b.trackClass?(a[e]={color:"#DC7252",label:"All"},e++,a[e]={color:"#BC5292",label:"BN-Lx"},e++,a[e]={color:"#FF5232",label:"SHR"},
e++):"mergedTotal"!==b.trackClass&&"brainTotal"===b.trackClass&&(a[e]={color:"#7EB5D6",label:"All"},e++,a[e]={color:"#5E95FF",label:"BN-Lx"},e++,a[e]={color:"#BE95B6",label:"SHR"},e++));"brainsmallnc"===b.trackClass?(a[e]={color:"#3E7596",label:"All"},e++,a[e]={color:"#1E55D6",label:"BN-Lx"},e++,a[e]={color:"#7E5576",label:"SHR"}):"heartsmallnc"===b.trackClass?(a[e]={color:"#9C3212",label:"All"},e++,a[e]={color:"#7C1252",label:"BN-Lx"},e++,a[e]={color:"#DC1200",label:"SHR"}):"liversmallnc"===b.trackClass&&
(a[e]={color:"#7b7e9d",label:"All"},e++,a[e]={color:"#5b5eDd",label:"BN-Lx"},e++,a[e]={color:"#bb5e7d",label:"SHR"});b.drawLegend(a)};b.triggerTableFilter=function(a){var e=jQuery.Event("keyup");e.which=32;var c="";"undefined"!==typeof a.getAttribute&&"undefined"!==typeof a.getAttribute("ID")&&(c=b.getDisplayID(a.getAttribute("ID")));-1==b.trackClass.indexOf("smallnc")?$("#tblGenes"+b.trackClass+"_filter input").val(c).trigger(e):$("#tblsmGenes_filter input").val(c).trigger(e)};b.clearTableFilter=
function(a){a=jQuery.Event("keyup");a.which=32;"smallnc"!=b.trackClass?$("#tblGenes"+b.trackClass+"_filter input").val("").trigger(a):$("#tblsmGenes_filter input").val("").trigger(a)};b.updateSettingsFromUI=function(){0<$("#"+b.trackClass+"Dense"+b.level+"Select").length&&(b.density=$("#"+b.trackClass+"Dense"+b.level+"Select").val(),"string"===typeof b.density&&(b.density=parseInt(b.density)));0<$("#"+b.trackClass+"Version"+b.level+"Select").length&&(b.reqDataVer=$("#"+b.trackClass+"Version"+b.level+
"Select").val())};b.savePrevious=function(){b.prevSetting={};b.prevSetting.density=b.density;b.prevSetting.dataVer=b.dataVer};b.revertPrevious=function(){b.density=b.prevSetting.density;b.dataVer=b.prevSetting.dataVer};b.updateSettings=function(a){};b.generateTrackSettingString=function(){return b.trackClass+","+b.density+","+b.dataVer+";"};b.redrawLegend();b.draw(m);return b}
function RefSeqTrack(q,m,r,u,d){var b=GeneTrack(q,m,r,u);b.counts=[{value:0,names:"Ensembl"},{value:0,names:"RNA-Seq"}];b.drawAs="Gene";b.trxCutoff=1E5;b.density=3;-1<(new String(d)).indexOf("DrawTrx")&&(b.drawAs="Trx");b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(q=0;q<b.gsvg.width;q++)b.yMaxArr[q]=0,b.yArr[0][q]=0;b.ttTrackList=[];b.ttTrackList.push("ensemblcoding");b.ttTrackList.push("braincoding");b.ttTrackList.push("liverTotal");b.ttTrackList.push("heartTotal");b.ttTrackList.push("mergedTotal");b.ttTrackList.push("ensemblnoncoding");
b.ttTrackList.push("brainnoncoding");b.ttTrackList.push("repeatMask");b.ttTrackList.push("snpSHRH");b.ttTrackList.push("snpBNLX");b.ttTrackList.push("snpF344");b.ttTrackList.push("snpSHRJ");b.cleanID=function(a){return a=a.replace(/\./g,"_")};b.color=function(a){var e=d3.rgb("#000000");if("Gene"==b.drawnAs){a=getAllChildrenByName(getFirstChildByName(a,"TranscriptList"),"Transcript");for(var c=-1,h=0;h<a.length;h++){var f=new String(a[h].getAttribute("category")),g=-1;"Reviewed"==f?g=5:"Validated"==
f?g=4:"Provisional"==f?g=3:"Inferred"==f?g=2:"Predicted"==f?g=1:"Model"==f?g=1:"Unknown"==f&&(g=0);c<g&&(c=g)}5===c&&(e=d3.rgb("#18814F"));4===c?e=d3.rgb("#38A16F"):3===c?e=d3.rgb("#78E1AF"):2===c?e=d3.rgb("#A8FFDF"):1===c?e=d3.rgb("#A8DFFF"):0===c&&(e=d3.rgb("#C8FFFF"))}else"Trx"==b.drawnAs&&(f=new String(a.getAttribute("category")),"Reviewed"==f?e=d3.rgb("#18814F"):"Validated"==f?e=d3.rgb("#38A16F"):"Provisional"==f?e=d3.rgb("#78E1AF"):"Inferred"==f?e=d3.rgb("#A8FFDF"):"Predicted"==f?e=d3.rgb("#A8DFFF"):
"Model"===f?e=d3.rgb("#A8DFFF"):"Unknown"===f&&(e=d3.rgb("#C8FFFF")));return e};b.pieColor=function(a,e){var c=d3.rgb("#000000"),h=new String(a.data.names);-1<h.indexOf("Reviewed")?c=d3.rgb("#18814F"):-1<h.indexOf("Validated")?c=d3.rgb("#38A16F"):-1<h.indexOf("Provisional")?c=d3.rgb("#78E1AF"):-1<h.indexOf("Inferred")?c=d3.rgb("#A8FFDF"):-1<h.indexOf("Predicted")?c=d3.rgb("#A8DFFF"):-1<h.indexOf("Model")?c=d3.rgb("#A8DFFF"):-1<h.indexOf("Unknown")&&(c=d3.rgb("#C8FFFF"));return c};b.getDisplayedData=
function(){var a=[],e=0,c=0;if("Gene"==b.drawnAs){var h=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".gene");b.counts=[];var f=0;h.each(function(g){var l=b.xScale(g.getAttribute("start")),n=b.xScale(g.getAttribute("stop"));if(0<=l&&l<=b.gsvg.width||0<=n&&n<=b.gsvg.width||0>=l&&n>=b.gsvg.width){n=getAllChildrenByName(getFirstChildByName(g,"TranscriptList"),"Transcript");l=-1;for(var p=0;p<n.length;p++){var t=new String(n[p].getAttribute("category")),v=-1;"Reviewed"==t?v=5:"Validated"==
t?v=4:"Provisional"==t?v=3:"Inferred"==t?v=2:"Predicted"==t?v=1:"Model"==t?v=1:"Unknown"==t&&(v=1);l<v&&(l=v)}n="Unknown";5==l?n="Reviewed":4==l?n="Validated":3==l?n="Provisional":2==l?n="Inferred":1==l&&(n="Predicted/Model");"undefined"===typeof b.counts[n]?(b.counts[n]={},b.counts[f]=b.counts[n],f++,b.counts[n].value=1,b.counts[n].names=n):b.counts[n].value++;a[e]=g;e++;c++}})}else b.counts=[],f=0,b.svg.selectAll("g.trx"+b.gsvg.levelNumber).each(function(g){var l=b.xScale(g.getAttribute("start")),
n=b.xScale(g.getAttribute("stop"));if(0<=l&&l<=b.gsvg.width||0<=n&&n<=b.gsvg.width||0>=l&&n>=b.gsvg.width)l=new String(g.getAttribute("category")),"undefined"===typeof b.counts[l]?(b.counts[l]={},b.counts[f]=b.counts[l],f++,b.counts[l].value=1,b.counts[l].names=l):b.counts[l].value++,a[e]=g,e++,c++});return a};b.createToolTip=function(a){var e="",c=a.getAttribute("strand");c="1"==c||"+"==c?"+":"-1"==c||"-"==c?"-":".";if("Gene"===b.drawnAs){e="";for(var h=getAllChildrenByName(getFirstChildByName(a,
"TranscriptList"),"Transcript"),f=0;f<h.length;f++){var g=new String(h[f].getAttribute("ID"));e+="<B>"+g+"</B> - "+h[f].getAttribute("category");e+="<br>"}e='<BR><div id="ttSVG" style="background:#FFFFFF;"></div>Gene Symbol: '+a.getAttribute("geneSymbol")+"<BR>Location: "+a.getAttribute("chromosome")+":"+numberWithCommas(a.getAttribute("start"))+"-"+numberWithCommas(a.getAttribute("stop"))+"<BR>Strand: "+c+"<BR>Transcripts:<BR>"+e}else"Trx"===b.drawnAs&&(g=new String(a.getAttribute("ID")),e='<BR><div id="ttSVG" style="background:#FFFFFF;"></div>RefSeq ID:<B>'+
(g+"</B><BR>Status: ")+a.getAttribute("category")+"<BR>Gene Symbol: "+a.getAttribute("geneSymbol")+"<BR>Location: "+a.getAttribute("chromosome")+":"+numberWithCommas(a.getAttribute("start"))+"-"+numberWithCommas(a.getAttribute("stop"))+"<BR>Strand: "+c);return e};b.getSVGID=function(a){return a.getAttribute("geneSymbol")};b.setupToolTipSVG=function(a,e){var c=parseInt(a.getAttribute("start"),10),h=parseInt(a.getAttribute("stop"),10),f=Math.floor((h-c)*e);20>f&&(f=20);var g=c-f;f=h+f;1>g&&(g=1);"undefined"!==
typeof b.ttSVGMinWidth&&f-g<b.ttSVGMinWidth&&(g=c-b.ttSVGMinWidth/2,f=h+b.ttSVGMinWidth/2);c=toolTipSVG("div#ttSVG",450,g,f,99,b.getSVGID(a),"transcript");c.forLevel=b.gsvg.levelNumber;h=[];h.push(a);c.addTrack(b.trackClass,3,"DrawTrx",h);for(h=0;h<b.ttTrackList.length;h++){var l=b.gsvg.getTrackData(b.ttTrackList[h]),n=[];if("undefined"!==typeof l&&0<l.length){for(var p=0,t=0;t<l.length;t++)if(g<=parseInt(l[t].getAttribute("start"),10)&&parseInt(l[t].getAttribute("start"),10)<=f||parseInt(l[t].getAttribute("start"),
10)<=g&&parseInt(l[t].getAttribute("stop"),10)>=g)n[p]=l[t],p++;0<n.length&&c.addTrack(b.ttTrackList[h],3,"DrawTrx",n)}}};b.calcY=function(a,e,c){if(3==b.density)if(a>=b.xScale.domain()[0]&&a<=b.xScale.domain()[1]||e>=b.xScale.domain()[0]&&e<=b.xScale.domain()[1]||a<=b.xScale.domain()[0]&&e>=b.xScale.domain()[1]){a=Math.floor(b.xScale(a));0>a&&(a=0);e=Math.floor(b.xScale(e))+1;e>=b.gsvg.width&&(e=b.gsvg.width-1);c=a-5;0>c&&(c=0);var h=e+5;h>=b.gsvg.width&&(h=b.gsvg.width-1);for(var f=0,g=c;g<=h;g++)b.yMaxArr[g]>
f&&(f=b.yMaxArr[g]);f++;var l=f;if(b.yArr.length<=f)for(b.yArr[l]=[],g=0;g<b.gsvg.width;g++)b.yArr[l][g]=0;g=f-12;1>g&&(g=1);l=0;for(var n=g;n<f&&0==l;n++){var p=0;for(g=c;g<=h&&0==p;g++)b.yArr[n][g]>p&&(p=1);0==p&&(f=n,l=1)}f>b.trackYMax&&(b.trackYMax=f);for(g=a;g<=e;g++)b.yMaxArr[g]<f&&(b.yMaxArr[g]=f),b.yArr[f][g]=1;a=15*f}else a=15;else a=2==b.density?15*(c+1):15;b.trackYMax<a/15&&(b.trackYMax=a/15);return a};b.redraw=function(){var a=b.xScale.domain()[0];a=b.xScale.domain()[1]-a;var e=0;b.yMaxArr=
[];b.yArr=[];b.yArr[0]=[];for(var c=0;c<b.gsvg.width;c++)b.yMaxArr[c]=0,b.yArr[0][c]=0;b.trackYMax=0;if(a<b.trxCutoff&&"Gene"==b.drawnAs||a>=b.trxCutoff&&"Trx"==b.drawnAs&&"Trx"!=b.drawAs||"Gene"==b.drawnAs&&$("#forceTrxCBX"+b.gsvg.levelNumber).is(":checked"))b.draw(b.data);else if(a<b.trxCutoff&&"Trx"==b.drawnAs&&"Trx"!=b.drawAs&&(e=1),"Gene"==b.drawAs&&0==e)b.svg.node()&&(b.svg.selectAll(".trx").each(function(){d3.select(this).remove()}),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").attr("transform",
function(h,f){return"translate("+b.xScale(h.getAttribute("start"))+","+b.calcY(parseInt(h.getAttribute("start"),10),parseInt(h.getAttribute("stop"),10),f)+")"}),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene rect").attr("width",function(h){var f=1;1<b.xScale(h.getAttribute("stop"))-b.xScale(h.getAttribute("start"))&&(f=b.xScale(h.getAttribute("stop"))-b.xScale(h.getAttribute("start")));return f}).attr("stroke",b.colorStroke),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").each(function(h){var f=
d3.select(this);if("1"==h.getAttribute("strand")||"-1"==h.getAttribute("strand")||"-"==h.getAttribute("strand")||"+"==h.getAttribute("strand")){var g=">";if("-1"==h.getAttribute("strand")||"-"==h.getAttribute("strand"))g="<";h="";var l=f.select("rect").attr("width");if(8.5<=l&&15.8>=l)h=g;else for(;8.7<l;)h+=g,l-=8.5;f.select("text").text(h)}})),1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").size()+
1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1));else if(1==e||"Trx"==b.drawAs)b.svg.selectAll("g.trx"+b.gsvg.levelNumber).attr("transform",function(h,f){return"translate(0,"+b.calcY(parseInt(h.getAttribute("start"),10),parseInt(h.getAttribute("stop"),10),f)+")"}).each(function(h,f){var g=parseInt(h.getAttribute("cdsStart"),10),l=parseInt(h.getAttribute("cdsStop"),10);exList=getAllChildrenByName(getFirstChildByName(h,"exonList"),"exon");var n="";1==b.gsvg.levelNumber&&(n="tx");for(var p=
0;p<exList.length;p++){var t=parseInt(exList[p].getAttribute("start"),10),v=parseInt(exList[p].getAttribute("stop"),10);if(t<g&&g<v||v>l&&l>t){var y=t,w=g;v>l?(y=l,w=v,v=l):t=g;d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).select("g#"+n+b.cleanID(h.getAttribute("ID"))+" rect#ExNC"+exList[p].getAttribute("ID")).attr("x",function(B){return b.xScale(y)}).attr("width",function(B){return b.xScale(w)-b.xScale(y)})}d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).select("g#"+n+b.cleanID(h.getAttribute("ID"))+
" rect#Ex"+exList[p].getAttribute("ID")).attr("x",function(B){return b.xScale(t)}).attr("width",function(B){return b.xScale(v)-b.xScale(t)});if(0<p){var A=b.xScale(exList[p-1].getAttribute("stop")),C=b.xScale(exList[p].getAttribute("start"));if("1"==h.getAttribute("strand")||"-1"==h.getAttribute("strand")||"-"==h.getAttribute("strand")||"+"==h.getAttribute("strand")){var F=">";"-1"==h.getAttribute("strand")&&(F="<");var E=F,D=C-A,z=0;if(7>D)E="";else for(D-=7;8<D;)0==z?(E+=" ",z=1):(E+=F,z=0),D-=
7;d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).select("g#"+n+b.cleanID(h.getAttribute("ID"))+" #IntTxt"+exList[p-1].getAttribute("ID")+"_"+exList[p].getAttribute("ID")).attr("dx",A+1).text(E)}d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).select("g#"+n+b.cleanID(h.getAttribute("ID"))+" line#Int"+exList[p-1].getAttribute("ID")+"_"+exList[p].getAttribute("ID")).attr("x1",A).attr("x2",C)}}}),1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(d3.select("#Level"+b.gsvg.levelNumber+
b.trackClass).selectAll("g.trx"+b.gsvg.levelNumber).size()+1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1));b.redrawSelectedArea()};b.updateData=function(a){var e=b.xScale.domain()[0],c=b.xScale.domain()[1];d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/refSeq.xml",function(h,f){if(h){if(0==a){var g=contextPath+"/"+pathPrefix;pathPrefix||(g="");$.ajax({url:g+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:e,maxCoord:c,
rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,track:b.trackClass,folder:b.gsvg.folderName,panel:panel},dataType:"json",success:function(v){},error:function(v,y,w){}})}10>a?(g=2500,1==a&&(g=1E4),setTimeout(function(){b.updateData(a+1)},g)):(d3.select("#Level"+b.levelNumber+b.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+b.trackClass),d3.select("#Level"+b.levelNumber+b.trackClass).attr("height",15),b.gsvg.addTrackErrorRemove(b.svg,"#Level"+b.gsvg.levelNumber+
b.trackClass))}else if(f){g=f.documentElement.getElementsByTagName("Gene");for(var l=[],n=[],p=0,t=0;t<g.length;t++)g[t]&&(l[p]=g[t],l[p].setAttribute("ID",p),n[g[t].getAttribute("geneSymbol")]=1,p++);for(t=0;t<b.data.length;t++)b.data[t]&&!n[b.data[t].getAttribute("geneSymbol")]&&(l[p]=b.data[t],l[p].setAttribute("ID",p),p++);b.draw(l);b.hideLoading();b.getDisplayedData();setTimeout(function(){DisplayRegionReport()},300)}else b.updateData(a+1),b.hideLoading()})};b.drawTrx=function(a,e){var c=parseInt(a.getAttribute("cdsStart"),
10),h=parseInt(a.getAttribute("cdsStop"),10),f="";1==b.gsvg.levelNumber&&(f="tx");f=b.svg.select("#"+f+b.cleanID(a.getAttribute("ID")));exList=getAllChildrenByName(getFirstChildByName(a,"exonList"),"exon");for(var g=0;g<exList.length;g++){var l=parseInt(exList[g].getAttribute("start"),10),n=parseInt(exList[g].getAttribute("stop"),10);if(l<c&&c<n||n>h&&h>l){var p=0,t=0,v=0,y=0;l<c?(p=b.xScale(l),t=b.xScale(c)-b.xScale(l),v=b.xScale(c),y=b.xScale(n)-b.xScale(c)):n>h&&(v=b.xScale(l),y=b.xScale(h)-b.xScale(l),
p=b.xScale(h),t=b.xScale(n)-b.xScale(h));f.append("rect").attr("x",p).attr("y",2.5).attr("height",5).attr("width",t).attr("title",function(w){return exList[g].getAttribute("ID")}).attr("id",function(w){return"ExNC"+exList[g].getAttribute("ID")}).style("fill",b.color).style("cursor","pointer");f.append("rect").attr("x",v).attr("height",10).attr("width",y).attr("title",function(w){return exList[g].getAttribute("ID")}).attr("id",function(w){return"Ex"+exList[g].getAttribute("ID")}).style("fill",b.color).style("cursor",
"pointer")}else{p=10;t=0;if(l<c&&n<c||n>h&&l>h)p=5,t=2.5;f.append("rect").attr("x",function(w){return b.xScale(exList[g].getAttribute("start"))}).attr("y",t).attr("height",p).attr("width",function(w){return b.xScale(exList[g].getAttribute("stop"))-b.xScale(exList[g].getAttribute("start"))}).attr("title",function(w){return exList[g].getAttribute("ID")}).attr("id",function(w){return"Ex"+exList[g].getAttribute("ID")}).style("fill",b.color).style("cursor","pointer")}if(0<g&&(f.append("line").attr("x1",
function(w){return b.xScale(exList[g-1].getAttribute("stop"))}).attr("x2",function(w){return b.xScale(exList[g].getAttribute("start"))}).attr("y1",5).attr("y2",5).attr("id",function(w){return"Int"+exList[g-1].getAttribute("ID")+"_"+exList[g].getAttribute("ID")}).attr("stroke",b.color).attr("stroke-width","2"),"1"==a.getAttribute("strand")||"-1"==a.getAttribute("strand")||"-"==a.getAttribute("strand")||"+"==a.getAttribute("strand"))){l=">";if("-"==a.getAttribute("strand")||"-1"==a.getAttribute("strand"))l=
"<";n=l;p=b.xScale(exList[g-1].getAttribute("stop"));t=b.xScale(exList[g].getAttribute("start"))-p;v=0;if(7>t)n="";else for(t-=7;8<t;)0==v?(n+=" ",v=1):(n+=l,v=0),t-=7;f.append("svg:text").attr("id",function(w){return"IntTxt"+exList[g-1].getAttribute("ID")+"_"+exList[g].getAttribute("ID")}).attr("dx",p+1).attr("dy","11").style("pointer-events","none").style("opacity","0.5").style("fill",b.color).style("font-size","16px").text(n)}}};b.draw=function(a){b.data=a;b.trackYMax=0;b.yArr=[];b.yArr[0]=[];
for(var e=0;e<b.gsvg.width;e++)b.yMaxArr[e]=0,b.yArr[0][e]=0;b.svg.selectAll(".gene").remove();b.svg.selectAll(".trx"+b.gsvg.levelNumber).remove();var c=b.drawAs;e=b.xScale.domain()[0];if(b.xScale.domain()[1]-e<b.trxCutoff||$("#forceTrxCBX"+b.gsvg.levelNumber).is(":checked"))b.drawAs="Trx";if(0!=a&&"Gene"===b.drawAs)b.drawnAs="Gene",b.label="Ref Seq Genes",b.updateLabel(b.label),b.redrawLegend(),a=b.svg.selectAll(".gene").data(a,key).attr("transform",function(n,p){return"translate("+b.xScale(n.getAttribute("start"))+
","+b.calcY(parseInt(n.getAttribute("start"),10),parseInt(n.getAttribute("stop"),10),p)+")"}),a.enter().append("g").attr("class","gene").attr("transform",function(n,p){return"translate("+b.xScale(n.getAttribute("start"))+","+b.calcY(parseInt(n.getAttribute("start"),10),parseInt(n.getAttribute("stop"),10),p)+")"}).append("rect").attr("height",10).attr("rx",1).attr("ry",1).attr("width",function(n){return b.xScale(n.getAttribute("stop"))-b.xScale(n.getAttribute("start"))}).attr("title",function(n){return n.getAttribute("ID")}).attr("stroke",
b.colorStroke).attr("stroke-width","1").attr("id",function(n){return b.cleanID(n.getAttribute("ID"))}).style("fill",b.color).on("dblclick",b.zoomToFeature).on("mouseover",function(n){0==b.gsvg.isToolTip&&(overSelectable=1,$("#mouseHelp").html("<B>Double Click</B> to zoom in on this feature."),d3.select(this).style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(b.createToolTip(n)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)}),
b.setupToolTipSVG(n,.05));return!1}).on("mouseout",function(n){overSelectable=0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");"selected"!=d3.select(this).attr("class")&&d3.select(this).style("fill",b.color);tt.transition().delay(500).duration(200).style("opacity",0)}),a.exit().remove(),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").each(function(n){if("undefined"!==typeof n){var p=d3.select(this);if("1"==n.getAttribute("strand")||
"-1"==n.getAttribute("strand")||"-"==n.getAttribute("strand")||"+"==n.getAttribute("strand")){var t=">";if("-"==n.getAttribute("strand")||"-1"==n.getAttribute("strand"))t="<";var v=p.select("rect").attr("width");if(8.5>v)n="";else for(v-=8.5,n=t;8.7<v;)n+=t,v-=8.5;p.append("svg:text").attr("dx","1").attr("dy","10").style("pointer-events","none").text(n)}}}),1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.gene").size()+
1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1));else if(0!=a&&"Trx"===b.drawAs){b.drawnAs="Trx";b.label="Ref Seq Transcripts";b.updateLabel(b.label);b.redrawLegend();var h=[],f=0;for(e=0;e<a.length;e++)for(var g=getAllChildrenByName(getFirstChildByName(a[e],"TranscriptList"),"Transcript"),l=0;l<g.length;l++)h[f]=g[l],h[f].parent=a[e],f++;d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".trx"+b.gsvg.levelNumber).remove();a=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".trx"+
b.gsvg.levelNumber).data(h,key).attr("transform",function(n,p){return"translate("+b.xScale(n.getAttribute("start"))+","+b.calcY(parseInt(n.getAttribute("start"),10),parseInt(n.getAttribute("stop"),10),p)+")"});a.enter().append("g").attr("class","trx"+b.gsvg.levelNumber).attr("transform",function(n,p){return"translate(0,"+b.calcY(parseInt(n.getAttribute("start"),10),parseInt(n.getAttribute("stop"),10),p)+")"}).attr("id",function(n){var p="";1==b.gsvg.levelNumber&&(p="tx");return p+b.cleanID(n.getAttribute("ID"))}).on("mouseover",
function(n){0==b.gsvg.isToolTip&&(d3.select(this).selectAll("line").style("stroke","green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(b.createToolTip(n)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)}),"undefined"!==typeof n&&b.setupToolTipSVG(n.parent,.05))}).on("mouseout",
function(n){d3.select(this).selectAll("line").style("stroke",function(p){return b.color(p)});d3.select(this).selectAll("rect").style("fill",function(p){return b.color(p)});d3.select(this).selectAll("text").style("opacity","0.6").style("fill",function(p){return b.color(p)});tt.transition().delay(500).duration(200).style("opacity",0)}).each(b.drawTrx);a.exit().remove();2==b.density?b.svg.attr("height",15*(d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.trx"+b.gsvg.levelNumber).size()+
1)):3==b.density?b.svg.attr("height",15*(b.trackYMax+1)):b.svg.attr("height",30)}b.redrawSelectedArea();b.drawAs=c};b.redrawLegend=function(){b.drawLegend([{color:"#18814F",label:"Reviewed"},{color:"#38A16F",label:"Validated"},{color:"#78E1AF",label:"Provisional"},{color:"#A8FFDF",label:"Inferred"},{color:"#A8DFFF",label:"Predicted/Model"},{color:"#C8FFFF",label:"Unknown"}])};b.redrawLegend();b.draw(m);DisplayRegionReport();return b}
function ProbeTrack(q,m,r,u,d){var b=Track(q,m,r,u);q=(new String(d)).split(",");0<q.length?(b.density=q[0],"string"===typeof b.density&&(b.density=parseInt(b.density)),b.colorSelect=1<q.length?q[1]:"annot",2<q.length?b.tissues=q[2].split(":"):(b.tissues=["Brain"],"Rn"==organism&&(b.tissues=["Brain","BrownAdipose","Heart","Liver"]))):(b.density=3,b.colorSelect="annot",b.tissues=["Brain"],"Rn"==organism&&(b.tissues=["Brain","BrownAdipose","Heart","Liver"]));1E6<b.gsvg.xScale.domain()[1]-b.gsvg.xScale.domain()[0]&&
(b.density=1);b.tissuesAll=["Brain"];"Rn"==organism&&(b.tissuesAll=["Brain","BrownAdipose","Heart","Liver"]);b.xPadding=1;b.scanBackYLines=75;b.curColor=b.colorSelect;b.ttTrackList=[];b.ttTrackList.push("ensemblcoding");b.ttTrackList.push("braincoding");b.ttTrackList.push("liverTotal");b.ttTrackList.push("heartTotal");b.ttTrackList.push("mergedTotal");b.ttTrackList.push("ensemblnoncoding");b.ttTrackList.push("brainnoncoding");b.ttTrackList.push("repeatMask");b.color=function(a,e){var c=d3.rgb("#000000");
"annot"==b.colorSelect?c=b.colorAnnotation(a):"herit"==b.colorSelect?(c=getFirstChildByName(a,"herit").getAttribute(e),c=Math.floor(255*c),c=d3.rgb(c,0,0)):"dabg"==b.colorSelect&&(c=getFirstChildByName(a,"dabg").getAttribute(e),c=Math.floor(2.55*c),c=d3.rgb(0,c,0));return c};b.colorAnnotation=function(a){var e=d3.rgb("#000000");"core"==a.getAttribute("type")?e=d3.rgb(255,0,0):"extended"==a.getAttribute("type")?e=d3.rgb(0,0,255):"full"==a.getAttribute("type")?e=d3.rgb(0,100,0):"ambiguous"==a.getAttribute("type")&&
(e=d3.rgb(0,0,0));return e};b.pieColor=function(a,e){var c=d3.rgb("#000000"),h=new String(a.data.names);"Core"==h?c=d3.rgb(255,0,0):"Extended"==h?c=d3.rgb(0,0,255):"Full"==h?c=d3.rgb(0,100,0):"Ambiguous"==h&&(c=d3.rgb(0,0,0));return c};b.createToolTip=function(a){var e=".";1==a.getAttribute("strand")?e="+":-1==a.getAttribute("strand")&&(e="-");var c=parseInt(a.getAttribute("stop"),10)-parseInt(a.getAttribute("start"),10);e='<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>Affy Probe Set ID: '+
a.getAttribute("ID")+"<BR>Strand: "+e+"<BR>Location: "+a.getAttribute("chromosome")+":"+numberWithCommas(a.getAttribute("start"))+"-"+numberWithCommas(a.getAttribute("stop"))+" ("+c+"bp)<BR>";e=e+"Type: "+a.getAttribute("type")+"<BR><BR>";c=getFirstChildByName(a,"herit");a=getFirstChildByName(a,"dabg");e+='<table class="tooltipTable" width="100%" colSpace="0"><tr><TH>Tissue</TH><TH>Heritability</TH><TH>DABG</TH></TR>';b.tissues.length<b.tissuesAll.length&&(e+='<TR><TD colspan="3">Displayed Tissues:</TD></TR>');
for(var h={},f=0;f<b.tissues.length;f++){var g=new String(b.tissues[f]);-1<g.indexOf("Affy")&&(g=g.substr(0,g.indexOf("Affy")));h[g]=1;var l=Math.floor(255*c.getAttribute(g));l=d3.rgb(l,0,0);var n=Math.floor(2.55*a.getAttribute(g));n=d3.rgb(0,n,0);e=e+"<TR><TD>"+g+'</TD><TD style="background:'+l+';color:white;">'+c.getAttribute(g)+'</TD><TD style="background:'+n+';color:white;">'+a.getAttribute(g)+"%</TD></TR>"}if(b.tissues.length<b.tissuesAll.length)for(e+='<TR><TD colspan="3">Other Tissues:</TD></TR>',
f=0;f<b.tissuesAll.length;f++)g=new String(b.tissuesAll[f]),-1<g.indexOf("Affy")&&(g=g.substr(0,g.indexOf("Affy"))),1!=h[g]&&(l=Math.floor(255*c.getAttribute(g)),l=d3.rgb(l,0,0),n=Math.floor(2.55*a.getAttribute(g)),n=d3.rgb(0,n,0),e=e+"<TR><TD>"+g+'</TD><TD style="background:'+l+';color:white;">'+c.getAttribute(g)+'</TD><TD style="background:'+n+';color:white;">'+a.getAttribute(g)+"%</TD></TR>");return e+"</table>"};b.updateSettingsFromUI=function(){0<$("#"+b.trackClass+"Dense"+b.level+"Select").length?
b.density=$("#"+b.trackClass+"Dense"+b.level+"Select").val():b.density||(b.density=1);b.curColor=b.colorSelect;0<$("#"+b.trackClass+b.level+"colorSelect").length?b.curColor=$("#"+b.trackClass+b.level+"colorSelect").val():b.curColor||(b.curColor="annot");var a=0;if(0<$("#affyTissues"+b.level+' input[name="tissuecbx"]').length){b.tissues=[];for(var e=$("#affyTissues"+b.level+' input[name="tissuecbx"]:checked'),c=0;c<e.length;c++){var h=new String(e[c].id);h=h.substr(0,h.indexOf("Affy"));b.tissues[a]=
h;a++}}};b.savePrevious=function(){b.prevSetting={};b.prevSetting.density=b.density;b.prevSetting.curColor=b.curColor;b.prevSetting.tissues=b.tissues};b.revertPrevious=function(){b.density=b.prevSetting.density;b.curColor=b.prevSetting.curColor;b.tissues=b.prevSetting.tissues};b.calcY=function(a,e,c,h){var f=8*h+5;if(3===b.density||"3"===b.density)if(a>=b.xScale.domain()[0]&&a<=b.xScale.domain()[1]||e>=b.xScale.domain()[0]&&e<=b.xScale.domain()[1]||a<=b.xScale.domain()[0]&&e>=b.xScale.domain()[1]){a=
Math.round(b.xScale(a));0>a&&(a=0);e=Math.round(b.xScale(e));e>=b.gsvg.width&&(e=b.gsvg.width-1);c=a-b.xPadding;0>c&&(c=0);h=e+b.xPadding;h>=b.gsvg.width&&(h=b.gsvg.width-1);h+f<b.gsvg.width?(h+=f,e+=f):0<c-f&&(c-=f,a-=f);f=0;for(var g=c;g<=h;g++)b.yMaxArr[g]>f&&(f=b.yMaxArr[g]);f++;var l=f;if(b.yArr.length<=f)for(b.yArr[l]=[],g=0;g<b.gsvg.width;g++)b.yArr[l][g]=0;g=f-b.scanBackYLines;1>g&&(g=1);l=0;for(var n=g;n<f&&0==l;n++){var p=0;for(g=c;g<=h&&0==p;g++)b.yArr[n][g]>p&&(p=1);0==p&&(f=n,l=1)}f>
b.trackYMax&&(b.trackYMax=f);for(g=a;g<=e;g++)b.yMaxArr[g]<f&&(b.yMaxArr[g]=f),b.yArr[f][g]=1;a=15*f}else a=15;else a=2===b.density||"2"===b.density?15*(c+1):15;b.trackYMax<a/15&&(b.trackYMax=a/15);return a};b.redraw=function(){var a=b.tissues.length;if(b.curColor!=b.colorSelect||("herit"===b.colorSelect||"dabg"===b.colorSelect)&&a!=b.tissueLen)b.tissueLen=a,b.draw(b.data);else{b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(var e=0;e<b.gsvg.width;e++)b.yMaxArr[e]=0,b.yArr[0][e]=0;b.colorSelect=
b.curColor;b.tissueLen=a;if("dabg"==b.colorSelect||"herit"==b.colorSelect){"dabg"==b.colorSelect?b.drawScaleLegend("0%","100%","of Samples DABG","#000000","#00FF00",0):"herit"==b.colorSelect&&b.drawScaleLegend("0","1.0","Probeset Heritability","#000000","#FF0000",0);var c=1;for(a=0;a<b.tissues.length;a++){var h=new String(b.tissues[a]);b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(e=0;e<b.gsvg.width;e++)b.yMaxArr[e]=0,b.yArr[0][e]=0;c++;b.svg.select("text."+h).attr("y",15*c);b.svg.selectAll("g.probe."+
h).attr("transform",function(f,g){var l=b.gsvg.xScale(f.getAttribute("start")),n=b.calcY(parseInt(f.getAttribute("start"),10),parseInt(f.getAttribute("stop"),10),g,f.getAttribute("ID").length)+15*c-10;return"translate("+l+","+n+")"}).each(function(f){var g=d3.select(this),l=1;1<b.gsvg.xScale(f.getAttribute("stop"))-b.gsvg.xScale(f.getAttribute("start"))&&(l=b.gsvg.xScale(f.getAttribute("stop"))-b.gsvg.xScale(f.getAttribute("start")));g.selectAll("rect").attr("width",l).attr("fill",b.color(f,h));var n=
">";"-1"==f.getAttribute("strand")&&(n="<");var p="";if(7.5<=l&&15>=l)p=n;else if(15<l)for(l-=7.5;7.5<l;)p+=n,l-=7.5;g.select("text#strand").text(p);if(2==b.density||3==b.density){var t=f.getAttribute("ID");0===g.select("text#lblTxt").size()?g.append("svg:text").attr("dx",function(){var v=b.xScale(f.getAttribute("stop"))+8*t.length+5,y=b.xScale(f.getAttribute("stop"))-b.xScale(f.getAttribute("start"))+5;v>b.gsvg.width&&(y=-8*t.length);return y}).attr("dy",10).attr("id","lblTxt").text(t):g.select("text#lblTxt").attr("dx",
function(){var v=b.xScale(f.getAttribute("stop"))+8*t.length+5,y=b.xScale(f.getAttribute("stop"))-b.xScale(f.getAttribute("start"))+5;v>b.gsvg.width&&(y=-8*t.length);return y})}else g.selectAll("text#lblTxt").remove()});c+=b.trackYMax}b.trackYMax=15*c;b.svg.attr("height",b.trackYMax)}else if("annot"===b.colorSelect){b.drawLegend([{color:"#FF0000",label:"Core"},{color:"#0000FF",label:"Extended"},{color:"#006400",label:"Full"},{color:"#000000",label:"Ambiguous"}]);b.trackYMax=0;b.yMaxArr=[];b.yArr=
[];b.yArr[0]=[];for(e=0;e<b.gsvg.width;e++)b.yMaxArr[e]=0,b.yArr[0][e]=0;b.svg.selectAll("g.probe").attr("transform",function(f,g){return"translate("+b.xScale(f.getAttribute("start"))+","+b.calcY(parseInt(f.getAttribute("start"),10),parseInt(f.getAttribute("stop"),10),g,f.getAttribute("ID").length)+")"});b.svg.selectAll("g.probe rect").attr("width",function(f){var g=1;1<b.xScale(f.getAttribute("stop"))-b.xScale(f.getAttribute("start"))&&(g=b.xScale(f.getAttribute("stop"))-b.xScale(f.getAttribute("start")));
return g}).attr("fill",function(f){return b.color(f,"")});b.svg.selectAll("g.probe").each(function(f){var g=d3.select(this),l=">";"-1"==f.getAttribute("strand")&&(l="<");var n="",p=g.select("rect").attr("width");if(7.5<=p&&15>=p)n=l;else if(15<p)for(p-=7.5;7.5<p;)n+=l,p-=7.5;g.select("text").text(n);if(2==b.density||3==b.density){var t=f.getAttribute("ID");0===g.select("text#lblTxt").size()?g.append("svg:text").attr("dx",function(){var v=b.xScale(f.getAttribute("stop"))+8*t.length+5,y=b.xScale(f.getAttribute("stop"))-
b.xScale(f.getAttribute("start"))+5;v>b.gsvg.width&&(y=-8*t.length);return y}).attr("dy",10).attr("id","lblTxt").text(t):g.select("text#lblTxt").attr("dx",function(){var v=b.xScale(f.getAttribute("stop"))+8*t.length+5,y=b.xScale(f.getAttribute("stop"))-b.xScale(f.getAttribute("start"))+5;v>b.gsvg.width&&(y=-8*t.length);return y})}else g.selectAll("text#lblTxt").remove()});1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(b.trackYMax+1)):3==b.density&&b.svg.attr("height",15*
(b.trackYMax+1))}}b.redrawSelectedArea()};b.update=function(a){b.redraw()};b.updateData=function(a){d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/probe.xml",function(e,c){if(e)if(3>a){var h=5E3;1==a&&(h=1E4);setTimeout(function(){b.updateData(a+1)},h)}else 3<=a&&(d3.select("#Level"+b.levelNumber+b.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+b.trackClass),d3.select("#Level"+b.levelNumber+b.trackClass).attr("height",15),b.gsvg.addTrackErrorRemove(b.svg,
"#Level"+b.gsvg.levelNumber+b.trackClass));else{if(c){h=c.documentElement.getElementsByTagName("probe");for(var f=[],g=[],l=0,n=0;n<b.data.length;n++)"undefined"!==typeof b.data[n]&&(f[l]=b.data[n],g[b.data[n].getAttribute("ID")]=1,l++);for(n=0;n<h.length;n++)"undefined"!==typeof h[n]&&"undefined"===typeof g[h[n].getAttribute("ID")]&&(f[l]=h[n],l++);b.draw(f)}b.hideLoading()}})};b.draw=function(a){b.data=a;b.colorSelect=b.curColor;b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(var e=0;e<b.gsvg.width;e++)b.yMaxArr[e]=
0,b.yArr[0][e]=0;if("dabg"==b.colorSelect||"herit"==b.colorSelect){"dabg"==b.colorSelect?b.drawScaleLegend("0%","100%","of Samples DABG","#000000","#00FF00",0):"herit"==b.colorSelect&&b.drawScaleLegend("0","1.0","Probeset Heritability","#000000","#FF0000",0);b.svg.selectAll(".probe").remove();b.svg.selectAll(".tissueLbl").remove();b.tissueLen=b.tissues.length;for(var c=1,h=0;h<b.tissues.length;h++){var f=new String(b.tissues[h]);0<f.indexOf(";")&&(f=f.substr(0,f.indexOf(";")));0<f.indexOf(":")&&(f=
f.substr(0,f.indexOf(":")));b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(e=0;e<b.gsvg.width;e++)b.yMaxArr[e]=0,b.yArr[0][e]=0;e=f;"BrownAdipose"==e?e="Brown Adipose":"Brain"==e&&(e="Whole Brain");e=new String("Tissue: "+e);c++;b.svg.append("text").attr("class","tissueLbl "+f).attr("x",b.gsvg.width/2-e.length/2*7.5).attr("y",15*c).text(e);0<a.length&&(e=b.svg.selectAll(".probe."+f).data(a,function(g){return keyTissue(g,f)}).attr("transform",function(g,l){return"translate("+b.xScale(g.getAttribute("start"))+
","+(b.calcY(parseInt(g.getAttribute("start"),10),parseInt(g.getAttribute("stop"),10),l,g.getAttribute("ID").length)+15*c-10)+")"}),e.enter().append("g").attr("class","probe "+f).attr("transform",function(g,l){return"translate("+b.xScale(g.getAttribute("start"))+","+(b.calcY(parseInt(g.getAttribute("start"),10),parseInt(g.getAttribute("stop"),10),l,g.getAttribute("ID").length)+15*c-10)+")"}).append("rect").attr("height",10).attr("rx",1).attr("ry",1).attr("width",function(g){var l=1;1<b.xScale(g.getAttribute("stop"))-
b.xScale(g.getAttribute("start"))&&(l=b.xScale(g.getAttribute("stop"))-b.xScale(g.getAttribute("start")));return l}).attr("id",function(g){return g.getAttribute("ID")+f}).style("fill",function(g){return b.color(g,f)}).style("cursor","pointer").on("dblclick",b.zoomToFeature).on("mouseover",function(g){if(0==b.gsvg.isToolTip){overSelectable=1;$("#mouseHelp").html("<B>Double Click</B> to zoom in on this feature.");var l=d3.select(this);b.curTTColor=l.style("fill");0<l.style("opacity")&&(l.style("fill",
"green"),tt.transition().duration(200).style("opacity",1),tt.html(b.createToolTip(g)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)}),b.setupToolTipSVG(g,.2))}}).on("mouseout",function(g){overSelectable=0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");g=d3.select(this);0<g.style("opacity")&&(g.style("fill",b.curTTColor),tt.transition().delay(500).duration(200).style("opacity",
0))}),b.svg.selectAll("g.probe."+f).each(function(g){var l=d3.select(this),n=">";"-1"==g.getAttribute("strand")&&(n="<");var p=n,t=l.select("rect").attr("width");if(7.5>t)p="";else for(t-=7.5;8.5<t;)p+=n,t-=7.5;l.append("svg:text").attr("dx","1").attr("id","strand").attr("dy","10").style("pointer-events","none").style("fill","white").text(p);if(2==b.density||3==b.density){var v=g.getAttribute("ID");l.append("svg:text").attr("dx",function(){var y=b.xScale(g.getAttribute("stop"))+8*v.length+5,w=b.xScale(g.getAttribute("stop"))-
b.xScale(g.getAttribute("start"))+5;y>b.gsvg.width&&(w=-8*v.length);return w}).attr("dy",10).attr("id","lblTxt").text(v)}else l.selectAll("text#lblTxt").remove()}),c=c+b.trackYMax+1)}b.trackYMax=c;b.svg.attr("height",15*c+45)}else if("annot"==b.colorSelect){b.drawLegend([{color:"#FF0000",label:"Core"},{color:"#0000FF",label:"Extended"},{color:"#006400",label:"Full"},{color:"#000000",label:"Ambiguous"}]);b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(e=0;e<b.gsvg.width;e++)b.yMaxArr[e]=0,b.yArr[0][e]=
0;b.svg.selectAll(".probe").remove();b.svg.selectAll(".tissueLbl").remove();e=b.svg.selectAll(".probe.annot").data(a,key).attr("transform",function(g,l){return"translate("+b.xScale(g.getAttribute("start"))+","+b.calcY(parseInt(g.getAttribute("start"),10),parseInt(g.getAttribute("stop"),10),l,g.getAttribute("ID").length)+")"});e.enter().append("g").attr("class","probe annot").attr("transform",function(g,l){return"translate("+b.xScale(g.getAttribute("start"))+","+b.calcY(parseInt(g.getAttribute("start"),
10),parseInt(g.getAttribute("stop"),10),l,g.getAttribute("ID").length)+")"}).append("rect").attr("height",10).attr("rx",1).attr("ry",1).attr("width",function(g){var l=1;1<b.xScale(g.getAttribute("stop"))-b.xScale(g.getAttribute("start"))&&(l=b.xScale(g.getAttribute("stop"))-b.xScale(g.getAttribute("start")));return l}).attr("id",function(g){return g.getAttribute("ID")}).style("fill",function(g){return b.color(g,"")}).style("cursor","pointer").on("dblclick",b.zoomToFeature).on("mouseover",function(g){if(0==
b.gsvg.isToolTip){overSelectable=1;$("#mouseHelp").html("<B>Double Click</B> to zoom in on this feature.");var l=d3.select(this);0<l.style("opacity")&&(l.style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(b.createToolTip(g)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)}),b.setupToolTipSVG(g,.2))}}).on("mouseout",function(g){overSelectable=0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");
g=d3.select(this);0<g.style("opacity")&&(g.style("fill",b.color),tt.transition().delay(500).duration(200).style("opacity",0))});b.svg.selectAll("g.probe").each(function(g){var l=d3.select(this),n=">";"-1"==g.getAttribute("strand")&&(n="<");var p=n,t=l.select("rect").attr("width");if(7.5>t)p="";else for(t-=7.5;15<t;)p+=n,t-=7.5;l.append("svg:text").attr("dx","1").attr("dy","10").style("pointer-events","none").style("fill","white").text(p);if(2==b.density||3==b.density){var v=g.getAttribute("ID");l.append("svg:text").attr("dx",
function(){var y=b.xScale(g.getAttribute("stop"))+8*v.length+5,w=b.xScale(g.getAttribute("stop"))-b.xScale(g.getAttribute("start"))+5;y>b.gsvg.width&&(w=-8*v.length);return w}).attr("dy",10).attr("id","lblTxt").text(v)}else l.select("text#lblTxt").remove()});1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(b.trackYMax+1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1))}b.redrawSelectedArea()};b.getDisplayedData=function(){var a=d3.select("#Level"+b.gsvg.levelNumber+
b.trackClass).selectAll("g.probe");b.counts=[{value:0,names:"Core"},{value:0,names:"Extended"},{value:0,names:"Full"},{value:0,names:"Ambiguous"}];var e=[],c=0;a.each(function(h){var f=b.xScale(h.getAttribute("start")),g=b.xScale(h.getAttribute("stop"));if(0<=f&&f<=b.gsvg.width||0<=g&&g<=b.gsvg.width)"core"==h.getAttribute("type")?b.counts[0].value++:"extended"==h.getAttribute("type")?b.counts[1].value++:"full"==h.getAttribute("type")?b.counts[2].value++:"ambiguous"==h.getAttribute("type")&&b.counts[3].value++,
e[c]=h,c++});0===a.size()&&(b.counts=[]);return e};b.generateSettingsDiv=function(a){var e=trackInfo[b.trackClass];b.savePrevious();d3.select(a).select("table").select("tbody").html("");if("undefined"!==typeof e&&"undefined"!==typeof e.Controls&&"null"!=e.Controls&&0<e.Controls.length){var c=(new String(e.Controls)).split(",");a=d3.select(a).select("table").select("tbody");a.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+e.Name);for(e=0;e<c.length;e++)if("undefined"!==
typeof c[e]&&""!=c[e]){var h=c[e].split(";"),f=a.append("tr").append("td"),g=h[0].substr(5);3<h.length&&0==h[3].indexOf("Default=")&&h[3].substr(8);if(0==h[1].toLowerCase().indexOf("select")){f.append("text").text(g+": ");g=h[1].split(":");h=h[2].split("}");var l=b.trackClass+"Dense"+b.level+"Select";"colorSelect"==g[1]&&(l=b.trackClass+b.level+"colorSelect");for(var n=f.append("select").attr("id",l).attr("name",g[1]),p=0;p<h.length;p++){var t=h[p].substr(1).split(":");2==t.length&&(f=n.append("option").attr("value",
t[1]).text(t[0]),"colorSelect"==g[1]&&t[1]==b.curColor?f.attr("selected","selected"):t[1]==b.density&&f.attr("selected","selected"))}d3.select("select#"+l).on("change",function(){"dabg"==$(this).val()||"herit"==$(this).val()?$("div#affyTissues"+b.level).show():$("div#affyTissues"+b.level).hide();b.updateSettingsFromUI();b.redraw()})}else if(0==h[1].toLowerCase().indexOf("cbx"))for(f=f.append("div").attr("id","affyTissues"+b.level).style("display","none"),f.append("text").text(g+": "),g=h[1].split(":"),
h=h[2].split("}"),p=0;p<h.length;p++)t=h[p].substr(1).split(":"),2==t.length&&(l=f.append("div").style("display","inline-block"),n=l.append("input").attr("type","checkbox").attr("id",t[1]+"CBX"+b.level).attr("name",g[1]).style("margin-left","5px"),l.append("text").text(t[0]),d3.select("input#"+t[1]+"CBX"+b.level).on("change",function(){b.updateSettingsFromUI();b.redraw()}))}"dabg"==b.curColor||"herit"==b.curColor?$("div#affyTissues"+b.level).show():$("div#affyTissues"+b.level).hide();for(c=0;c<b.tissues.length;c++)$("#"+
b.tissues[c]+"AffyCBX"+b.level).prop("checked",!0);c=a.append("tr").append("td");c.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");b.gsvg.removeTrack(b.trackClass);var v=svgList[b.gsvg.levelNumber].currentView.ViewID,y=viewMenu[b.gsvg.levelNumber].findTrackByClass(b.trackClass,v);y=viewMenu[b.gsvg.levelNumber].findTrackIndexWithViewID(y.TrackID,v);viewMenu[b.gsvg.levelNumber].removeTrackWithIDIdx(y,
v)});c.append("input").attr("type","button").attr("value","Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");b.density==b.prevSetting.density&&b.curColor==b.prevSetting.curColor&&b.tissues==b.prevSetting.tissues||b.gsvg.setCurrentViewModified()});c.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){b.revertPrevious();b.draw(b.data);$("#trackSettingDialog").fadeOut("fast")})}else a=
d3.select(a).select("table").select("tbody"),a.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+e.Name),a.append("tr").append("td").html("Sorry no settings for this track."),c=a.append("tr").append("td"),c.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")}),c.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left",
"5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")})};b.generateTrackSettingString=function(){for(var a="",e=0;e<b.tissues.length;e++)0<e&&(a+=":"),a+=b.tissues[e];return b.trackClass+","+b.density+","+b.curColor+","+a+";"};b.draw(m);return b}
function SNPTrack(q,m,r,u,d){var b=Track(q,m,r,a);q=(new String(r)).substr(3);d=(new String(d)).split(",");b.include=0<d.length?d[0]:4;b.density=u;var a=q;"SHRH"==a?a="SHR/OlaPrin":"BNLX"==a?a="BN-Lx/CubPrin":"SHRJ"==a&&(a="SHR/NCrlPrin");b.displayStrain=a;1==b.include?a+=" SNPs":2==b.include?a+=" Insertions":3==b.include?a+=" Deletions":4==b.include&&(a+=" SNPs/Indels");b.counts=[{value:0,perc:0,names:"SNP "+b.displayStrain},{value:0,perc:0,names:"Insertion "+b.displayStrain},{value:0,perc:0,names:"Deletion "+
b.displayStrain}];b.strain=q;b.ttTrackList=[];b.ttTrackList.push("ensemblcoding");b.ttTrackList.push("braincoding");b.ttTrackList.push("liverTotal");b.ttTrackList.push("heartTotal");b.ttTrackList.push("mergedTotal");b.ttTrackList.push("refSeq");b.ttTrackList.push("ensemblnoncoding");b.ttTrackList.push("brainnoncoding");b.ttTrackList.push("ensemblsmallnc");b.ttTrackList.push("brainsmallnc");b.ttTrackList.push("probe");b.ttTrackList.push("repeatMask");b.xPadding=1;b.scanBackYLines=50;b.updateSettingsFromUI=
function(){0<$("#"+b.trackClass+"Dense"+b.level+"Select").length&&(b.density=$("#"+b.trackClass+"Dense"+b.level+"Select").val());0<$("#"+b.trackClass+b.level+"Select").length&&(b.include=$("#"+b.trackClass+b.level+"Select").val())};b.savePrevious=function(){b.prevSetting={};b.prevSetting.density=b.density;b.prevSetting.include=b.include};b.revertPrevious=function(){b.density=b.prevSetting.density;b.include=b.prevSetting.include};b.generateTrackSettingString=function(){return b.trackClass+","+b.density+
","+b.include+";"};b.generateSettingsDiv=function(e){var c=trackInfo[b.trackClass];b.savePrevious();d3.select(e).select("table").select("tbody").html("");if(0<c.Controls.length&&"null"!=c.Controls){var h=(new String(c.Controls)).split(",");e=d3.select(e).select("table").select("tbody");e.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name);for(c=0;c<h.length;c++)if("undefined"!==typeof h[c]&&""!=h[c]){var f=h[c].split(";"),g=e.append("tr").append("td"),l=f[0].substr(5);
g.append("text").text(l+": ");3<f.length&&0==f[3].indexOf("Default=")&&f[3].substr(8);if(0==f[1].toLowerCase().indexOf("select")){var n=f[1].split(":");f=f[2].split("}");var p=l="";2<n.length&&(l=n[2]);3<n.length&&(p=n[3]);g=g.append("select").attr("id",b.trackClass+l+b.level+p).attr("name",n[1]);for(n=0;n<f.length;n++){var t=f[n].substr(1).split(":");if(2==t.length){var v=g.append("option").attr("value",t[1]).text(t[0]);("Dense"==l&&t[1]==b.density||""==l&&t[1]==b.include)&&v.attr("selected","selected")}}d3.select("#"+
b.trackClass+l+b.level+p).on("change",function(){b.updateSettingsFromUI();b.updateData()})}else console.log("Undefined track settings:  "+h[c])}h=e.append("tr").append("td");h.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");b.gsvg.removeTrack(b.trackClass);var y=svgList[b.gsvg.levelNumber].currentView.ViewID,w=viewMenu[b.gsvg.levelNumber].findTrackByClass(b.trackClass,
y);w=viewMenu[b.gsvg.levelNumber].findTrackIndexWithViewID(w.TrackID,y);viewMenu[b.gsvg.levelNumber].removeTrackWithIDIdx(w,y)});h.append("input").attr("type","button").attr("value","Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");b.density==b.prevSetting.density&&b.include==b.prevSetting.include||b.gsvg.setCurrentViewModified()});h.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left",
"5px").on("click",function(){b.revertPrevious();b.draw(b.data);$("#trackSettingDialog").fadeOut("fast")})}else e=d3.select(e).select("table").select("tbody"),e.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name),e.append("tr").append("td").html("Sorry no settings for this track."),h=e.append("tr").append("td"),h.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")}),
h.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")})};b.redraw=function(){b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(var e=0;e<b.gsvg.width;e++)b.yMaxArr[e]=0,b.yArr[0][e]=0;b.svg.selectAll("g.snp").attr("transform",function(c,h){return"translate("+b.xScale(c.getAttribute("start"))+","+b.calcY(parseInt(c.getAttribute("start"),10),parseInt(c.getAttribute("stop"),10),
h)+")"});b.svg.selectAll("g.snp rect").attr("width",function(c){var h=1;1<b.xScale(c.getAttribute("stop"))-b.xScale(c.getAttribute("start"))&&(h=b.xScale(c.getAttribute("stop"))-b.xScale(c.getAttribute("start")));return h});6<b.xScale(b.xScale.domain()[0]+1)?b.svg.selectAll(".snp").each(function(c){var h=b.xScale(c.getAttribute("stop"))-b.xScale(c.getAttribute("start")),f=new String(c.getAttribute("strainSeq")),g="8px",l=3.2,n=8;"SNP"!=c.getAttribute("type")&&(g="7px",l=3,n=7);0==d3.select(this).selectAll("text").size()&&
f.length*l<h?d3.select(this).append("text").attr("y",n).attr("x",function(p){p=0;7<h&&(p=h/2-f.length/2*l);return p}).attr("font-size",g).attr("stroke",d3.rgb("#FFFFFF")).attr("class","snpLbl").text(f):d3.select(this).selectAll(".snpLbl").attr("x",function(p){p=0;7<h&&(p=h/2-f.length/2*l);return p})}):b.svg.selectAll("text.snpLbl").remove();1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(b.trackYMax+1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1));b.redrawSelectedArea()};
b.color=function(e){d3.rgb("#000000");return"SNP"===e.getAttribute("type")?"BNLX"===e.getAttribute("strain")?d3.rgb(0,0,255):"SHRH"===e.getAttribute("strain")?d3.rgb(255,0,0):"SHRJ"===e.getAttribute("strain")?d3.rgb("#00FF00"):"F344"===e.getAttribute("strain")?d3.rgb("#00FFFF"):d3.rgb(100,100,100):"BNLX"===e.getAttribute("strain")?d3.rgb(0,0,150):"SHRH"===e.getAttribute("strain")?d3.rgb(150,0,0):"SHRJ"===e.getAttribute("strain")?d3.rgb("#009600"):"F344"===e.getAttribute("strain")?d3.rgb("#009696"):
d3.rgb(50,50,50)};b.getDisplayID=function(e){return e.getAttribute("type")+"_"+keySNP(e)};b.createToolTip=function(e){var c=e.getAttribute("strain");"SHRH"==c&&(c="SHR");c='<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>Type: '+e.getAttribute("type")+"<BR>Strain: "+c+"<BR>Sequence: "+e.getAttribute("refSeq")+"->"+e.getAttribute("strainSeq")+"<BR>Location: chr"+e.getAttribute("chromosome")+":"+numberWithCommas(e.getAttribute("start"));"SNP"!=e.getAttribute("type")&&(c=c+"-"+numberWithCommas(e.getAttribute("stop")));
return c};b.update=function(e){b.redraw()};b.updateData=function(e){d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/snp"+b.strain+".xml",function(c,h){if(c)if(3>e){var f=1E4;1==e&&(f=15E3);setTimeout(function(){b.updateData(e+1)},f)}else 3<=e&&(d3.select("#Level"+b.levelNumber+b.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+b.trackClass),d3.select("#Level"+b.levelNumber+b.trackClass).attr("height",15),b.gsvg.addTrackErrorRemove(b.svg,
"#Level"+b.gsvg.levelNumber+b.trackClass));else{f=h.documentElement.getElementsByTagName("Snp");for(var g=[],l=[],n=0,p=0;p<f.length;p++)"undefined"!==typeof f[p]&&(g[n]=f[p],l[keySNP(f[p])]=1,n++);for(p=0;p<b.data.length;p++)"undefined"!==typeof b.data[p]&&"undefined"===typeof l[keySNP(b.data[p])]&&(g[n]=b.data[p],n++);b.draw(g);b.hideLoading()}})};b.getDisplayedData=function(){var e=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".snp");b.counts=[{value:0,perc:0,names:"SNP"},{value:0,
perc:0,names:"Insertion"},{value:0,perc:0,names:"Deletion"}];var c=[],h=0,f=0;e.each(function(g){var l=b.xScale(g.getAttribute("start")),n=b.xScale(g.getAttribute("stop"));if(0<=l&&l<=b.gsvg.width||0<=n&&n<=b.gsvg.width)l=0,"Insertion"==g.getAttribute("type")?l++:"Deletion"==g.getAttribute("type")&&(l+=2),b.counts[l].value++,c[h]=g,h++,f++});return c};b.draw=function(e){b.data=e;b.trackYMax=0;b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(var c=0;c<b.gsvg.width;c++)b.yMaxArr[c]=0,b.yArr[0][c]=0;c=b.strain;
"SHRH"==c?c="SHR/OlaPrin":"BNLX"==c?c="BN-Lx/CubPrin":"SHRJ"==c&&(c="SHR/NCrlPrin");1==b.include?c+=" SNPs":2==b.include?c+=" Insertions":3==b.include?c+=" Deletions":4==b.include&&(c+=" SNPs/Indels");b.updateLabel(c);b.redrawLegend();if(4>b.include){c=[];for(var h=0,f=0;f<e.length;f++)"undefined"!==typeof e[f]&&(1==b.include&&"SNP"==e[f].getAttribute("type")?(c[h]=e[f],h++):2==b.include&&"Insertion"==e[f].getAttribute("type")?(c[h]=e[f],h++):3==b.include&&"Deletion"==e[f].getAttribute("type")&&(c[h]=
e[f],h++));b.data=c}b.svg.selectAll(".snp").remove();0<b.data.length&&(e=b.svg.selectAll(".snp").data(e,keySNP).attr("transform",function(g,l){return"translate("+b.xScale(g.getAttribute("start"))+","+b.calcY(parseInt(g.getAttribute("start"),10),parseInt(g.getAttribute("stop"),10),l)+")"}),e.enter().append("g").attr("class","snp").attr("transform",function(g,l){return"translate("+b.xScale(g.getAttribute("start"))+","+b.calcY(parseInt(g.getAttribute("start"),10),parseInt(g.getAttribute("stop"),10),
l)+")"}).append("rect").attr("height",10).attr("rx",1).attr("ry",1).attr("width",function(g){var l=1;1<b.xScale(g.getAttribute("stop"))-b.xScale(g.getAttribute("start"))&&(l=b.xScale(g.getAttribute("stop"))-b.xScale(g.getAttribute("start")));return l}).attr("id",keySNP).style("fill",b.color).on("mouseover",function(g){0==b.gsvg.isToolTip&&(d3.select(this).style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(b.createToolTip(g)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",
function(){return b.positionTTTop(d3.event.pageY)}),b.setupToolTipSVG(g,.2))}).on("mouseout",function(g){d3.select(this).style("fill",b.color);tt.transition().delay(500).duration(200).style("opacity",0)}),1==b.density?b.svg.attr("height",30):2==b.density?b.svg.attr("height",15*(b.trackYMax+1)):3==b.density&&b.svg.attr("height",15*(b.trackYMax+1)),e.merge(e),e.exit().remove());b.redrawSelectedArea()};b.pieColor=function(e,c){var h=d3.rgb("#000000"),f=new String(e.data.names);"BNLX"==b.strain?h=-1<
f.indexOf("SNP")?d3.rgb(0,0,255):-1<f.indexOf("Insertion")?d3.rgb(0,0,175):d3.rgb(0,0,125):"SHRJ"==b.strain?h=-1<f.indexOf("SNP")?d3.rgb(0,255,0):-1<f.indexOf("Insertion")?d3.rgb(0,175,0):d3.rgb(0,125,0):"F344"==b.strain?h=-1<f.indexOf("SNP")?d3.rgb(0,255,255):-1<f.indexOf("Insertion")?d3.rgb(0,175,175):d3.rgb(0,125,125):"SHRH"==b.strain&&(h=-1<f.indexOf("SNP")?d3.rgb(255,0,0):-1<f.indexOf("Insertion")?d3.rgb(175,0,0):d3.rgb(125,0,0));return h};b.redrawLegend=function(){var e=[];4==b.include?e="BNLX"==
b.strain?[{color:"#0000FF",label:"SNP"},{color:"#000096",label:"Insertion/Deletion"}]:"SHRH"==b.strain?[{color:"#FF0000",label:"SNP"},{color:"#960000",label:"Insertion/Deletion"}]:"SHRJ"==b.strain?[{color:"#00FF00",label:"SNP"},{color:"#009600",label:"Insertion/Deletion"}]:"F344"==b.strain?[{color:"#00FFFF",label:"SNP"},{color:"#009696",label:"Insertion/Deletion"}]:[{color:"#DEDEDE",label:"SNP"},{color:"#969696",label:"Insertion/Deletion"}]:3==b.include||2==b.include?e="BNLX"==b.strain?[{color:"#000096",
label:"Insertion/Deletion"}]:"SHRH"==b.strain?[{color:"#960000",label:"Insertion/Deletion"}]:"SHRJ"==b.strain?[{color:"#009600",label:"Insertion/Deletion"}]:"F344"==b.strain?[{color:"#009696",label:"Insertion/Deletion"}]:[{color:"#969696",label:"Insertion/Deletion"}]:1==b.include&&(e="BNLX"==b.strain?[{color:"#0000FF",label:"SNP"}]:"SHRH"==b.strain?[{color:"#FF0000",label:"SNP"}]:"SHRJ"==b.strain?[{color:"#00FF00",label:"SNP"}]:"F344"==b.strain?[{color:"#00FFFF",label:"SNP"}]:[{color:"#DEDEDE",label:"SNP"}]);
b.drawLegend(e)};b.strain=q;b.redrawLegend();b.draw(m);return b}
function QTLTrack(q,m,r,u){var d=Track(q,m,r,"QTLs Overlapping Region");d.color=function(b){return d.pieColorPalette(b)};d.redraw=function(){d.yCount=0;d.idList=[];d.svg.selectAll("g.qtl").attr("transform",function(b,a){return"translate("+d.xScale(b.getAttribute("start"))+","+d.calcY(b,a)+")"});d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).selectAll("g.qtl rect").attr("width",function(b){var a=1;1<d.xScale(b.getAttribute("stop"))-d.xScale(b.getAttribute("start"))&&(a=d.xScale(b.getAttribute("stop"))-
d.xScale(b.getAttribute("start")));return a});d.svg.attr("height",15*d.yCount);d.redrawSelectedArea()};d.createToolTip=function(b){return"Name: "+b.getAttribute("name")+"<BR>Location: "+b.getAttribute("chromosome")+":"+numberWithCommas(b.getAttribute("start"))+"-"+numberWithCommas(b.getAttribute("stop"))+"<BR>Trait:<BR>"+b.getAttribute("trait")+"<BR><BR>Phenotype:<BR>"+b.getAttribute("phenotype")+"<BR><BR>Candidate Genes:<BR>"+b.getAttribute("candidate")};d.pieColorPalette=d3.scaleOrdinal(d3.schemeCategory20);
d.pieColor=function(b){return d.pieColorPalette(b.data.names)};d.triggerTableFilter=function(b){var a=jQuery.Event("keyup");a.which=32;var e="";"undefined"===typeof b.getAttribute||"undefined"===typeof b.getAttribute("ID")?"undefined"!==typeof b.data&&"undefined"!==typeof b.data.names&&(e=b.data.names):e=b.getAttribute("ID");$("#tblBQTL_filter input").val(e).trigger(a)};d.clearTableFilter=function(b){b=jQuery.Event("keyup");b.which=32;$("#tblBQTL_filter input").val("").trigger(b)};d.getDisplayedData=
function(){var b=d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).selectAll(".qtl");d.counts=[];var a=0,e=b.data();console.log(b);console.log(e);b=[];var c=0,h=0;if("undefined"!==typeof e)for(var f=0;f<e.length;f++){var g=d.xScale(e[f].getAttribute("start")),l=d.xScale(e[f].getAttribute("stop"));if(0<=g&&g<=d.gsvg.width||0<=l&&l<=d.gsvg.width||0>=g&&l>=d.gsvg.width)g=new String(e[f].getAttribute("name")),l=/[0-9]+\s*$/g,l=g.search(l),-1<l&&(g=g.substr(0,l)),l=/QTL\s*$/g,l=g.search(l),-1<l&&(g=
g.substr(0,l)),l=/traits+\s*$/g,l=g.search(l),-1<l&&(g=g.substr(0,l+5)),"undefined"===typeof d.counts[g]?(d.counts[g]={},d.counts[a]=d.counts[g],a++,d.counts[g].value=1,d.counts[g].names=g):d.counts[g].value++,b[c]=e[f],c++,h++}return b};d.setupDetailedView=function(b){$("div#collapsableReport").is(":hidden")||($("div#collapsableReport").hide(),$("span[name='collapsableReport']").removeClass("less"));$("div#selectedDetailHeader").is(":hidden")&&$("div#selectedDetailHeader").show();$("div#selectedDetail").is(":hidden")&&
$("div#selectedDetail").show();$("div#selectedImage").hide();$("div#selectedReport").show();var a=pathPrefix+"bQTLReport.jsp";b={id:b.getAttribute("ID"),species:organism,genomeVer:genomeVer};DisplaySelectedDetailReport(a,b)};d.updateData=function(b){d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+d.gsvg.folderName+"/qtl.xml",function(a,e){if(a)if(3>b){var c=1E4;1==b&&(c=15E3);setTimeout(function(){d.updateData(b+1)},c)}else d3.select("#Level"+d.levelNumber+d.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+
d.trackClass),d3.select("#Level"+d.levelNumber+d.trackClass).attr("height",15),d.gsvg.addTrackErrorRemove(d.svg,"#Level"+d.gsvg.levelNumber+d.trackClass);else{if(e){c=e.documentElement.getElementsByTagName("QTL");for(var h=[],f=[],g=0,l=0;l<c.length;l++)"undefined"!==typeof c[l]&&(h[g]=c[l],f[c[l].getAttribute("ID")]=1,g++);for(l=0;l<d.data.length;l++)"undefined"!==typeof d.data[l]&&"undefined"===typeof f[d.data[l].getAttribute("ID")]&&(h[g]=d.data[l],g++);d.draw(h)}d.hideLoading()}})};d.calcY=function(b,
a){var e=0;"undefined"===typeof d.idList[b.getAttribute("ID")]&&(e=d.yCount++);return 15*(e+1)};d.draw=function(b){d.data=b;d.yCount=0;d.idList=[];d.data&&0<d.data.length?(console.log(d.svg),console.log(d.svg.selectAll(".qtl")),b=d.svg.selectAll(".qtl").data(b,key),console.log(b),b.enter().append("g").attr("class","qtl").attr("transform",function(a,e){return"translate("+d.xScale(a.getAttribute("start"))+","+d.calcY(a,e)+")"}).append("rect").attr("height",10).attr("rx",1).attr("ry",1).attr("width",
function(a){var e=1;1<d.xScale(a.getAttribute("stop"))-d.xScale(a.getAttribute("start"))&&(e=d.xScale(a.getAttribute("stop"))-d.xScale(a.getAttribute("start")));return e}).attr("id",function(a){return a.getAttribute("id")}).style("fill","blue").style("cursor","pointer").on("click",d.setupDetailedView).on("mouseover",function(a){0==d.gsvg.isToolTip&&(overSelectable=1,$("#mouseHelp").html("<B>Click</B> to see additional details. <B>Double Click</B> to zoom in on this feature."),d3.select(this).style("fill",
"green"),tt.transition().duration(200).style("opacity",1),tt.html(d.createToolTip(a)).style("left",function(){return d.positionTTLeft(d3.event.pageX)}).style("top",function(){return d.positionTTTop(d3.event.pageY)}),d.triggerTableFilter(a))}).on("mouseout",function(a){overSelectable=0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");var e=a.getAttribute("name"),c=/[0-9]+\s*$/g;c=e.search(c);-1<c&&(e=e.substr(0,c));c=/QTL\s*$/g;c=e.search(c);-1<c&&
(e=e.substr(0,c));c=/traits?\s*$/g;c=e.search(c);-1<c&&(e=e.substr(0,c+5));d3.select(this).style("fill",d.color(e));tt.transition().delay(500).duration(200).style("opacity",0);d.clearTableFilter(a)}).merge(b),b.exit().remove(),"undefined"!==typeof b[0]&&b[0].forEach(function(a){if("undefined"!==typeof a){var e=new String(a.data().getAttribute("name")),c=/[0-9]+\s*$/g;c=e.search(c);-1<c&&(e=e.substr(0,c));c=/QTL\s*$/g;c=e.search(c);-1<c&&(e=e.substr(0,c));c=/traits?\s*$/g;c=e.search(c);-1<c&&(e=e.substr(0,
c+5));d3.select(a).select("rect").style("fill",d.color(e))}}),d.svg.attr("height",15*d.yCount)):d.svg.attr("height",15);d.redrawSelectedArea()};d.draw(m);d.redraw();return d}
function TranscriptTrack(q,m,r,u){var d=Track(q,m,r,"Selected Gene Transcripts");d.createToolTip=function(b){var a=".";1==b.getAttribute("strand")?a="+":-1==b.getAttribute("strand")&&(a="-");a="ID: "+b.getAttribute("ID")+"<BR>Location: chr"+b.getAttribute("chromosome")+":"+numberWithCommas(b.getAttribute("start"))+"-"+numberWithCommas(b.getAttribute("stop"))+"<BR>Strand: "+a;-1==(new String(b.getAttribute("ID"))).indexOf("ENS")&&(b=getFirstChildByName(getFirstChildByName(b,"annotationList"),"annotation"),
null!=b&&(a+="<BR>Matching: "+b.getAttribute("reason")));return a};d.color=function(b){var a=d3.rgb("#000000");"protein"==d.gsvg.txType?a=-1<(new String(b.getAttribute("ID"))).indexOf("ENS")?d3.rgb("#DFC184"):d3.rgb("#7EB5D6"):"long"==d.gsvg.txType?a=-1<(new String(b.getAttribute("ID"))).indexOf("ENS")?d3.rgb("#B58AA5"):d3.rgb("#CECFCE"):"small"==d.gsvg.txType?a=-1<(new String(b.getAttribute("ID"))).indexOf("ENS")?d3.rgb("#FFCC00"):d3.rgb("#99CC99"):"liverTotal"==d.gsvg.txType?a=d3.rgb("#bbbedd"):
"heartTotal"==d.gsvg.txType?a=d3.rgb("#DC7252"):"mergedTotal"==d.gsvg.txType&&(a=d3.rgb("#9F4F92"));return a};d.drawTrx=function(b,a){var e=parseInt(b.getAttribute("start"),10),c=parseInt(b.getAttribute("stop"),10);"undefined"!==typeof b.getAttribute("cdsStart")&&"undefined"!==typeof b.getAttribute("cdsStop")&&(e=parseInt(b.getAttribute("cdsStart"),10),c=parseInt(b.getAttribute("cdsStop"),10));var h=d3.select("#Level"+d.gsvg.levelNumber+d.trackClass+" #tx"+b.getAttribute("ID"));exList=getAllChildrenByName(getFirstChildByName(b,
"exonList"),"exon");for(var f=0;f<exList.length;f++){var g=parseInt(exList[f].getAttribute("start"),10),l=parseInt(exList[f].getAttribute("stop"),10);if(g<e&&e<l||l>c&&c>g){var n=0,p=0,t=0,v=0;g<e?(n=d.xScale(exList[f].getAttribute("start")),p=d.xScale(e)-d.xScale(exList[f].getAttribute("start")),t=d.xScale(e),v=d.xScale(exList[f].getAttribute("stop"))-d.xScale(e)):l>c&&(t=d.xScale(exList[f].getAttribute("start")),v=d.xScale(c)-d.xScale(exList[f].getAttribute("start")),n=d.xScale(c),p=d.xScale(exList[f].getAttribute("stop"))-
d.xScale(c));h.append("rect").attr("x",n).attr("y",2.5).attr("height",5).attr("width",p).attr("title",function(y){return exList[f].getAttribute("ID")}).attr("id",function(y){return"ExNC"+exList[f].getAttribute("ID")}).style("fill",d.color).style("cursor","pointer");h.append("rect").attr("x",t).attr("height",10).attr("width",v).attr("title",function(y){return exList[f].getAttribute("ID")}).attr("id",function(y){return"Ex"+exList[f].getAttribute("ID")}).style("fill",d.color).style("cursor","pointer")}else{n=
10;p=0;if(g<e&&l<e||l>c&&g>c)n=5,p=2.5;h.append("rect").attr("x",function(y){return d.xScale(exList[f].getAttribute("start"))}).attr("y",p).attr("height",n).attr("width",function(y){return d.xScale(exList[f].getAttribute("stop"))-d.xScale(exList[f].getAttribute("start"))}).attr("title",function(y){return exList[f].getAttribute("ID")}).attr("id",function(y){return"Ex"+exList[f].getAttribute("ID")}).style("fill",d.color).style("cursor","pointer")}if(0<f){h.append("line").attr("x1",function(y){return d.xScale(exList[f-
1].getAttribute("stop"))}).attr("x2",function(y){return d.xScale(exList[f].getAttribute("start"))}).attr("y1",5).attr("y2",5).attr("id",function(y){return"Int"+exList[f-1].getAttribute("ID")+"_"+exList[f].getAttribute("ID")}).attr("stroke",d.color).attr("stroke-width","2");g=">";"-1"==b.getAttribute("strand")&&(g="<");l=g;n=d.xScale(exList[f-1].getAttribute("stop"));p=d.xScale(exList[f].getAttribute("start"))-n;t=0;if(7>p)l="";else for(p-=7;8<p;)0==t?(l+=" ",t=1):(l+=g,t=0),p-=7;h.append("svg:text").attr("id",
function(y){return"IntTxt"+exList[f-1].getAttribute("ID")+"_"+exList[f].getAttribute("ID")}).attr("dx",n+1).attr("dy","11").style("pointer-events","none").style("opacity","0.5").style("fill",d.color).style("font-size","16px").text(l)}}};d.redraw=function(){d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).selectAll("g.trx"+d.gsvg.levelNumber).each(function(b,a){var e=parseInt(b.getAttribute("start"),10),c=parseInt(b.getAttribute("stop"),10);"undefined"!==typeof b.getAttribute("cdsStart")&&"undefined"!==
typeof b.getAttribute("cdsStop")&&(e=parseInt(b.getAttribute("cdsStart"),10),c=parseInt(b.getAttribute("cdsStop"),10));exList=getAllChildrenByName(getFirstChildByName(b,"exonList"),"exon");for(var h=0;h<exList.length;h++){var f=parseInt(exList[h].getAttribute("start"),10),g=parseInt(exList[h].getAttribute("stop"),10);if(f<e&&e<g||g>c&&c>f){var l=f,n=e;g>c?(l=c,n=g,g=c):f=e;d3.select("#Level"+d.gsvg.levelNumber+d.trackClass+" g#tx"+b.getAttribute("ID")+" rect#ExNC"+exList[h].getAttribute("ID")).attr("x",
function(C){return d.xScale(l)}).attr("width",function(C){return d.xScale(n)-d.xScale(l)})}d3.select("#Level"+d.gsvg.levelNumber+d.trackClass+" g#tx"+b.getAttribute("ID")+" rect#Ex"+exList[h].getAttribute("ID")).attr("x",function(C){return d.xScale(f)}).attr("width",function(C){return d.xScale(g)-d.xScale(f)});if(0<h){var p=">";"-1"==b.getAttribute("strand")&&(p="<");var t=p,v=d.xScale(exList[h-1].getAttribute("stop")),y=d.xScale(exList[h].getAttribute("start")),w=y-v,A=0;if(7>w)t="";else for(w-=
7;8<w;)0==A?(t+=" ",A=1):(t+=p,A=0),w-=7;d3.select("#Level"+d.gsvg.levelNumber+d.trackClass+" g#tx"+b.getAttribute("ID")+" line#Int"+exList[h-1].getAttribute("ID")+"_"+exList[h].getAttribute("ID")).attr("x1",v).attr("x2",y);d3.select("#Level"+d.gsvg.levelNumber+d.trackClass+" g#tx"+b.getAttribute("ID")+" #IntTxt"+exList[h-1].getAttribute("ID")+"_"+exList[h].getAttribute("ID")).attr("dx",v+1).text(t)}}});d.redrawSelectedArea()};d.update=function(){var b=getAllChildrenByName(getFirstChildByName(d.gsvg.selectedData,
"TranscriptList"),"Transcript"),a=parseInt(d.gsvg.selectedData.getAttribute("start"),10),e=parseInt(d.gsvg.selectedData.getAttribute("stop"),10);"undefined"!==typeof d.gsvg.selectedData.getAttribute("extStart")&&"undefined"!==typeof d.gsvg.selectedData.getAttribute("extStop")&&(a=parseInt(d.gsvg.selectedData.getAttribute("extStart"),10),e=parseInt(d.gsvg.selectedData.getAttribute("extStop"),10));d.txMin=a;d.txMax=e;d.svg.attr("height",15*(1+b.length));d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).selectAll(".trx"+
d.gsvg.levelNumber).remove();b=d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).selectAll(".trx"+d.gsvg.levelNumber).data(b,key).attr("transform",function(c,h){return"translate("+d.xScale(c.getAttribute("start"))+","+d.calcY(c,h)+")"});b.enter().append("g").attr("class","trx"+d.gsvg.levelNumber).attr("transform",function(c,h){return"translate(0,"+d.calcY(c,h)+")"}).attr("id",function(c){return c.getAttribute("ID")}).style("cursor","pointer").on("mouseover",function(c){0==d.gsvg.isToolTip&&(d3.select(this).selectAll("line").style("stroke",
"green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(d.createToolTip(c)).style("left",function(){return d.positionTTLeft(d3.event.pageX)}).style("top",function(){return d.positionTTTop(d3.event.pageY)}))}).on("mouseout",function(c){d3.select(this).selectAll("line").style("stroke",d.color);d3.select(this).selectAll("rect").style("fill",d.color);d3.select(this).selectAll("text").style("opacity",
"0.6").style("fill",d.color);tt.transition().delay(500).duration(200).style("opacity",0)}).each(d.drawTrx);b.exit().remove();d.svg.selectAll(".legend").remove();b=[];"protein"==d.gsvg.txType?b=[{color:"#DFC184",label:"Ensembl"},{color:"#7EB5D6",label:"RNA-Seq"}]:"long"==d.gsvg.txType?b=[{color:"#B58AA5",label:"Ensembl"},{color:"#CECFCE",label:"RNA-Seq"}]:"small"==d.gsvg.txType?b=[{color:"#FFCC00",label:"Ensembl"},{color:"#99CC99",label:"RNA-Seq"}]:"liverTotal"==d.gsvg.txType?b=[{color:"#bbbedd",label:"Liver RNA-Seq"}]:
"mergedTotal"==d.gsvg.txType&&(b=[{color:"#9F4F92",label:"Merged RNA-Seq"}]);d.drawLegend(b)};d.calcY=function(b,a){return 15*(a+1)};d.redrawLegend=function(){};"undefined"!==typeof d.gsvg.selectedData.getAttribute("extStart")?(d.txMin=parseInt(d.gsvg.selectedData.getAttribute("extStart"),10),d.txMax=parseInt(d.gsvg.selectedData.getAttribute("extStop"),10)):(d.txMin=parseInt(d.gsvg.selectedData.getAttribute("start"),10),d.txMax=parseInt(d.gsvg.selectedData.getAttribute("stop"),10));d3.select("#Level"+
d.gsvg.levelNumber+d.trackClass).attr("height",15*(1+m.length));d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).selectAll(".trx"+d.gsvg.levelNumber).remove();q=d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).selectAll(".trx"+d.gsvg.levelNumber).data(m,key).attr("transform",function(b,a){return"translate("+d.xScale(b.getAttribute("start"))+","+d.calcY(b,a)+")"});q.enter().append("g").attr("class","trx"+d.gsvg.levelNumber).attr("transform",function(b,a){return"translate(0,"+d.calcY(b,a)+")"}).attr("id",
function(b){return"tx"+b.getAttribute("ID")}).style("cursor","pointer").on("mouseover",function(b){0==d.gsvg.isToolTip&&(d3.select(this).selectAll("line").style("stroke","green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(d.createToolTip(b)).style("left",function(){return d.positionTTLeft(d3.event.pageX)}).style("top",function(){return d.positionTTTop(d3.event.pageY)}))}).on("mouseout",
function(b){d3.select(this).selectAll("line").style("stroke",d.color);d3.select(this).selectAll("rect").style("fill",d.color);d3.select(this).selectAll("text").style("opacity","0.6").style("fill",d.color);tt.transition().delay(500).duration(200).style("opacity",0)}).each(d.drawTrx);q.exit().remove();d.redrawLegend();d.scaleSVG.transition().duration(300).style("opacity",1);d.svg.transition().duration(300).style("opacity",1);d.redraw();return d}
function HelicosTrack(q,m,r,u){q=CountTrack(q,m,r,u);q.graphColorText="#DD0000";q.updateLabel("Brain Helicos RNA Read Counts");q.redrawLegend();q.redraw();return q}function IlluminaSmallTrack(q,m,r,u){q=CountTrack(q,m,r,u);q.graphColorText="#99CC99";q.updateLabel("Brain Illumina Small RNA Read Counts");q.redrawLegend();q.redraw();q.redraw();return q}
function IlluminaTotalTrack(q,m,r,u){q=CountTrack(q,m,r,u);q.updateLabel("BNLx/SHR Brain Illumina Total-RNA(rRNA depleted) Read Counts");q.redrawLegend();return q}function LiverIlluminaTotalPlusTrack(q,m,r,u){q=CountTrack(q,m,r,u);q.graphColorText="#abaecd";q.updateLabel("BNLx/SHR Liver + Strand Total-RNA Read Counts");q.redrawLegend();q.redraw();return q}
function LiverIlluminaTotalMinusTrack(q,m,r,u){q=CountTrack(q,m,r,u);q.graphColorText="#dbdefd";q.updateLabel("BNLx/SHR Liver - Strand Total-RNA Read Counts");q.redrawLegend();q.redraw();return q}function LiverIlluminaSmallTrack(q,m,r,u){q=CountTrack(q,m,r,u);q.graphColorText="#7b7e9d";q.updateLabel("Liver  Illumina Small RNA Read Counts");q.redrawLegend();q.redraw();return q}
function HeartIlluminaTotalPlusTrack(q,m,r,u){q=CountTrack(q,m,r,u);q.graphColorText="#CC6242";q.updateLabel("BNLx/SHR Heart + Strand Total-RNA Read Counts");q.redrawLegend();q.redraw();return q}function HeartIlluminaTotalMinusTrack(q,m,r,u){q=CountTrack(q,m,r,u);q.graphColorText="#FC9272";q.updateLabel("BNLx/SHR Heart - Strand Total-RNA Read Counts");q.redrawLegend();q.redraw();return q}
function HeartIlluminaSmallTrack(q,m,r,u){q=CountTrack(q,m,r,u);q.graphColorText="#9C3212";q.updateLabel("Heart Illumina Small RNA Read Counts");q.redrawLegend();q.redraw();return q}function BrainIlluminaTotalPlusTrack(q,m,r,u){q=CountTrack(q,m,r,u);q.graphColorText="#7EB5D6";q.updateLabel("Brain + Strand Total-RNA Read Counts");q.redrawLegend();q.redraw();return q}
function BrainIlluminaTotalMinusTrack(q,m,r,u){q=CountTrack(q,m,r,u);q.updateLabel("Brain - Strand Total-RNA Read Counts");q.redrawLegend();q.redraw();return q}
function StrainSpecificIlluminaTotalTrack(q,m,r,u){m=CountTrack(q,m,r,u);u=r.substr(r.indexOf("-")+1);var d=".";0<r.indexOf("Plus")?d="+":0<r.indexOf("Minus")&&(d="-");r=r.substr(0,r.indexOf("illumina"));"brain"===r?r="Whole Brain":"liver"===r&&(r="Liver");m.graphColorText=q.strainSpecificCountColors(u);m.updateLabel(u+" "+r+" "+d+" Strand Total-RNA Read Counts");m.redrawLegend();m.redraw();return m}
function IlluminaPolyATrack(q,m,r,u){q=CountTrack(q,m,r,u);q.graphColorText="#7EB5D6";q.updateLabel("Brain Illumina PolyA+ RNA Read Counts");q.redrawLegend();q.redraw();return q}
function SpliceJunctionTrack(q,m,r,u,d,b){q=GenericTranscriptTrack(q,m,r,u,d,b);q.dataFileName=r+".xml";q.xmlTag="Feature";q.xmlTagBlockElem="block";q.idPrefix="splcJnct";"liverspliceJnct"===r?q.idPrefix="lvrsplcJnct":"heartspliceJnct"===r&&(q.idPrefix="hrtsplcJnct");q.ttSVG=1;q.ttTrackList=[];q.ttTrackList.push(r);q.ttTrackList.push("ensemblcoding");q.ttTrackList.push("braincoding");q.ttTrackList.push("brainTotal");q.ttTrackList.push("liverTotal");q.ttTrackList.push("heartTotal");q.ttTrackList.push("mergedTotal");
q.ttTrackList.push("refSeq");q.ttTrackList.push("repeatMask");"splcJnct"===r?q.ttTrackList.push("illuminaPolyA"):"liverspliceJnct"===r?(q.ttTrackList.push("liverilluminaTotalPlus"),q.ttTrackList.push("liverilluminaTotalMinus")):"heartspliceJnct"===r?(q.ttTrackList.push("heartilluminaTotalPlus"),q.ttTrackList.push("heartilluminaTotalMinus")):"brainspliceJnct"===r&&(q.ttTrackList.push("brainilluminaTotalPlus"),q.ttTrackList.push("brainilluminaTotalMinus"));q.colorValueField="readCount";q.colorScale=
d3.scaleLinear().domain([1,1E3]).range(["#E6E6E6","#000000"]);q.legendLbl="Read Depth";q.density=3;q.getDisplayID=function(a){return a.getAttribute("name")};q.createToolTip=function(a){var e='<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>ID: '+a.getAttribute("name");e=e+"<BR>Read Counts="+numberWithCommas(a.getAttribute("readCount"));e=e+"<BR>Splice Junction in "+a.getAttribute("sampleCount")+" of ";"Rn"===organism?e+="6 samples(3 BN-Lx, 3 SHR)":"Mm"===organism&&(e+="6 samples(3 ILS, 3 ISS)");
var c=getAllChildrenByName(getFirstChildByName(a,"blockList"),"block"),h=0,f=1,g="start",l="stop";-1==a.getAttribute("strand")&&(h=1,f=0,g="stop",l="start");e=e+"<BR><BR>Coverage Exon 1: "+numberWithCommas(c[h].getAttribute(g))+"-"+numberWithCommas(c[h].getAttribute(l))+" ("+(parseInt(c[h].getAttribute("stop"),10)-parseInt(c[h].getAttribute("start"),10))+" bp)";e=e+"<BR>Coverage Exon 2: "+numberWithCommas(c[f].getAttribute(g))+"-"+numberWithCommas(c[f].getAttribute(l))+" ("+(parseInt(c[f].getAttribute("stop"),
10)-parseInt(c[f].getAttribute("start"),10))+" bp)";return e=e+"<BR>Intron: "+numberWithCommas(parseInt(c[1].getAttribute("start"),10)-parseInt(c[0].getAttribute("stop"),10))+" bp<BR>"};q.drawScaleLegend("1","1000+","Read Counts","#E6E6E6","#000000",0);q.draw(m);return q}
function CustomCountTrack(q,m,r,u,d){var b=CountTrack(q,m,r,u);b.graphColorText="#4E85A6";b.updateControl=0;q="Custom Count Track";d=d.split(",");if(0<d.length)for(m=0;m<d.length;m++)0==m?b.dataFileName=d[m].substr(9):d[m].indexOf("Name=")&&(q=d[m].substr(5));b.updateFullData=function(a,e){if(b.updateControl==a){b.updateControl=a+1;var c=b.xScale.domain()[0],h=b.xScale.domain()[1],f=h-c;b.showLoading();b.bin=b.calculateBin(f);var g=dataPrefix+"tmpData/trackXML/"+b.gsvg.folderName+"/tmp/"+c+"_"+h+
".count."+b.trackClass+".xml",l=dataPrefix+"tmpData/trackUpload/"+b.trackClass.substr(6),n="bg",p="";0<b.bin&&(c-=2*b.bin,c-=c%(2*b.bin),h+=2*b.bin,h+=2*b.bin-h%(2*b.bin),g=dataPrefix+"tmpData/trackXML/"+b.gsvg.folderName+"/"+c+"_"+h+".bincount."+b.bin+"."+b.trackClass+".xml");-1<b.dataFileName.indexOf("http")&&(p=l=b.dataFileName,n="bw");d3.xml(g,function(t,v){if(t){if(0==a||1==e){var y="/"+pathPrefix;pathPrefix||(y="");$.ajax({url:y+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,
minCoord:c,maxCoord:h,myOrganism:organism,genomeVer:genomeVer,track:b.trackClass,bedFile:l,outFile:g,folder:b.gsvg.folderName,binSize:b.bin,type:n,web:p},dataType:"json",success:function(w){gtag("event","generateTrackCount",{event_category:"browser"})},error:function(w,A,C){}})}8>a?b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1)},500):30>a?b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1)},1E3):32>a?b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+
1)},1E4):(d3.select("#Level"+b.levelNumber+b.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+b.trackClass),d3.select("#Level"+b.levelNumber+b.trackClass).attr("height",15),b.gsvg.addTrackErrorRemove(b.svg,"#Level"+b.gsvg.levelNumber+b.trackClass),b.hideLoading(),b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1,0)},15E3))}else null==v?32<=a?(y=[],b.draw(y)):b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1,0)},5E3):(b.fullDataTimeOutHandle=
0,b.loadedDataMin=c,b.loadedDataMax=h,y=v.documentElement.getElementsByTagName("Count"),b.draw(y),b.updateControl=0)})}};b.updateLabel(q);b.redrawLegend();b.redraw();return b}
function CountTrack(q,m,r,u){var d=Track(q,m,r,"Generic Counts");d.loadedDataMin=d.xScale.domain()[0];d.loadedDataMax=d.xScale.domain()[1];d.dataFileName=d.trackClass;d.scaleMin=1;d.scaleMax=5E3;d.graphColorText="steelblue";d.colorScale=d3.scaleLinear().domain([d.scaleMin,d.scaleMax]).range(["#EEEEEE","#000000"]);d.ttSVG=1;d.data=m;d.density=u;d.prevDensity=u;d.displayBreakDown=null;q=d.gsvg.xScale.domain()[0];q=d.gsvg.xScale.domain()[1]-q;d.fullDataTimeOutHandle=0;d.ttTrackList=[];-1<r.indexOf("illuminaSmall")?
(d.ttTrackList.push("ensemblsmallnc"),d.ttTrackList.push("brainsmallnc"),d.ttTrackList.push("liversmallnc"),d.ttTrackList.push("heartsmallnc")):(d.ttTrackList.push("ensemblcoding"),d.ttTrackList.push("braincoding"),d.ttTrackList.push("liverTotal"),d.ttTrackList.push("heartTotal"),d.ttTrackList.push("mergedTotal"),d.ttTrackList.push("refSeq"),d.ttTrackList.push("ensemblnoncoding"),d.ttTrackList.push("brainnoncoding"),d.ttTrackList.push("probe"),d.ttTrackList.push("polyASite"),d.ttTrackList.push("spliceJnct"),
d.ttTrackList.push("liverspliceJnct"),d.ttTrackList.push("heartspliceJnct"));d.ttTrackList.push("repeatMask");d.calculateBin=function(b){b=new String(Math.floor(b/d.gsvg.width));b=b.substr(0,1)*Math.pow(10,b.length-1);b=Math.floor(b/2);5>b&&(b=0);return b};d.bin=d.calculateBin(q);d.color=function(b){var a="#FFFFFF";b.getAttribute("count")>=d.scaleMin&&(a=d3.rgb(d.colorScale(b.getAttribute("count"))));return a};d.redraw=function(){var b=d.gsvg.xScale.domain()[0],a=d.gsvg.xScale.domain()[1];d.xScale(b+
d.bin);d.xScale(b);d.prevMinCoord=b;d.prevMaxCoord=a;b=d.xScale.domain()[0];a=d.xScale.domain()[1];for(var e=[],c=0,h=0,f=0;f<d.data.length;f++)if("undefined"!==typeof d.data[f]){var g=parseInt(d.data[f].getAttribute("start"),10),l=parseInt(d.data[f].getAttribute("stop"),10),n=parseInt(d.data[f].getAttribute("count"),10);if(1!=d.density||1==d.density&&g!=l)if(f+1<d.data.length){if(l=parseInt(d.data[f+1].getAttribute("start"),10),g>=b&&g<=a||l>=b&&l<=a)e[c]=d.data[f],n>h&&(h=n),c++}else g>=b&&g<=a&&
(e[c]=d.data[f],n>h&&(h=n),c++)}1==d.density?(d.density!=d.prevDensity?(d.redrawLegend(),a=d.gsvg.xScale.domain()[1],d.prevDensity=d.density,d.svg.selectAll(".area").remove(),d.svg.selectAll("g.y").remove(),d.svg.selectAll(".grid").remove(),d.svg.selectAll(".leftLbl").remove(),b=d.svg.selectAll("."+d.trackClass).data(e,keyStart),b.enter().append("rect").attr("x",function(p){return d.xScale(p.getAttribute("start"))}).attr("y",15).attr("class",d.trackClass).attr("height",10).attr("width",function(p,
t){return d.xScale(p.getAttribute("stop"))-d.xScale(p.getAttribute("start"))}).attr("fill",d.color).on("mouseover",function(p){0==d.gsvg.isToolTip&&(d3.select(this).style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(d.createToolTip(p)).style("left",function(){return d.positionTTLeft(d3.event.pageX)}).style("top",function(){return d.positionTTTop(d3.event.pageY)}))}).on("mouseout",function(p){d3.select(this).style("fill",d.color);tt.transition().delay(500).duration(200).style("opacity",
0)}),b.exit().remove()):d.svg.selectAll("."+d.trackClass).attr("x",function(p){return d.xScale(p.getAttribute("start"))}).attr("width",function(p,t){return d.xScale(p.getAttribute("stop"))-d.xScale(p.getAttribute("start"))}).attr("fill",d.color),d.svg.attr("height",30)):2==d.density&&(d.svg.selectAll("."+d.trackClass).remove(),d.svg.select(".y.axis").remove(),d.svg.select("g.grid").remove(),d.svg.selectAll(".leftLbl").remove(),d.yScale.domain([0,h]),d.svg.select(".area").remove(),d.area=d3.area().x(function(p){return d.xScale(p.getAttribute("start"))}).y0(140).y1(function(p){return d.yScale(p.getAttribute("count"))}),
d.redrawLegend(),d.prevDensity=d.density,d.svg.append("g").attr("class","y axis").call(d.yAxis),d.svg.append("g").attr("class","grid").call(d.yAxis.tickSize(-d.gsvg.width+10,0,0).tickFormat("")),d.svg.select("g.y").selectAll("text").each(function(p){var t=new String(p);d3.select(this).attr("x",function(){return 7.7*t.length+5}).attr("dy","0.05em");d.svg.append("svg:text").attr("class","leftLbl").attr("x",d.gsvg.width-(7.8*t.length+5)).attr("y",function(){return d.yScale(p)}).attr("dy","0.01em").style("font-weight",
"bold").text(numberWithCommas(p))}),d.svg.append("path").datum(e).attr("class","area").attr("stroke",d.graphColorText).attr("fill",d.graphColorText).attr("d",d.area),d.svg.attr("height",140));d.redrawSelectedArea()};d.createToolTip=function(b){var a='<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>Read Count='+numberWithCommas(b.getAttribute("count"));if(0<d.bin){var e=parseInt(b.getAttribute("start"),10)+parseInt(d.bin,10);a=a+"*<BR><BR>*Data compressed for display. Using 90th percentile of<BR>region:"+
numberWithCommas(b.getAttribute("start"))+"-"+numberWithCommas(e)+"<BR><BR>Zoom in further to see raw data(roughly a region <1000bp). The bin size will decrease as you zoom in thus the resolution of the count data will improve as you zoom in."}return a};d.update=function(b){b=d.xScale.domain()[0];var a=d.xScale.domain()[1];d.loadedDataMin<=b&&a<=d.loadedDataMax?d.redraw():d.updateFullData(0,1)};d.updateFullData=function(b,a){var e=d.xScale.domain()[0],c=d.xScale.domain()[1],h=c-e;d.showLoading();
d.bin=d.calculateBin(h);h=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+d.gsvg.folderName+"/tmp/"+e+"_"+c+".count."+d.trackClass+".xml";0<d.bin&&(e-=2*d.bin,e-=e%(2*d.bin),c+=2*d.bin,c+=2*d.bin-c%(2*d.bin),h=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+d.gsvg.folderName+"/tmp/"+e+"_"+c+".bincount."+d.bin+"."+d.trackClass+".xml");d3.xml(h,function(f,g){if(f){if(0==b||1==a){var l="/"+pathPrefix;pathPrefix||(l="");tmpPanel=panel;-1<d.trackClass.indexOf("-")&&(tmpPanel=d.trackClass.substr(d.trackClass.indexOf("-")+
1));$.ajax({url:l+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:e,maxCoord:c,panel:tmpPanel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:d.trackClass,folder:d.gsvg.folderName,binSize:d.bin},dataType:"json",success:function(n){gtag("event","generateTrackCount",{event_category:"browser"})},error:function(n,p,t){}})}8>b?d.fullDataTimeOutHandle=setTimeout(function(){d.updateFullData(b+1,0)},500):30>b?d.fullDataTimeOutHandle=
setTimeout(function(){d.updateFullData(b+1,0)},1E3):32>b?d.fullDataTimeOutHandle=setTimeout(function(){d.updateFullData(b+1,0)},1E4):(d3.select("#Level"+d.levelNumber+d.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+d.trackClass),d3.select("#Level"+d.levelNumber+d.trackClass).attr("height",15),d.gsvg.addTrackErrorRemove(d.svg,"#Level"+d.gsvg.levelNumber+d.trackClass),d.hideLoading(),d.fullDataTimeOutHandle=setTimeout(function(){d.updateFullData(b+1,1)},15E3))}else null==g?
32<=b?(l=[],d.draw(l)):d.fullDataTimeOutHandle=setTimeout(function(){d.updateFullData(b+1,0)},5E3):(d.fullDataTimeOutHandle=0,d.loadedDataMin=e,d.loadedDataMax=c,l=g.documentElement.getElementsByTagName("Count"),d.draw(l))})};d.updateCountScale=function(b,a){d.scaleMin=b;d.scaleMax=a;d.colorScale=d3.scaleLinear().domain([d.scaleMin,d.scaleMax]).range(["#EEEEEE","#000000"]);1==d.density&&(d.redrawLegend(),d.redraw())};d.setupToolTipSVG=function(b,a){var e=d.xScale.domain()[0],c=d.xScale.domain()[1],
h=parseInt(b.getAttribute("start"),10),f=parseInt(b.getAttribute("stop"),10);c=Math.floor((c-e)*a);20>c&&(c=20);e=h-c;c=f+c;1>e&&(e=1);"undefined"!==typeof d.ttSVGMinWidth&&c-e<d.ttSVGMinWidth&&(e=h-d.ttSVGMinWidth/2,c=f+d.ttSVGMinWidth/2);h=toolTipSVG("div#ttSVG",450,e,c,99,b.getAttribute("ID"),"transcript");h.addTrack(d.trackClass,3,"",d.data);for(f=0;f<d.ttTrackList.length;f++){var g=d.gsvg.getTrackData(d.ttTrackList[f]),l=[];if("undefined"!==typeof g&&0<g.length){for(var n=0,p=0;p<g.length;p++)if(e<=
parseInt(g[p].getAttribute("start"),10)&&parseInt(g[p].getAttribute("start"),10)<=c||parseInt(g[p].getAttribute("start"),10)<=e&&parseInt(g[p].getAttribute("stop"),10)>=e)l[n]=g[p],n++;0<l.length&&h.addTrack(d.ttTrackList[f],3,"DrawTrx",l)}}};d.draw=function(b){d.hideLoading();d.data=b;var a=d.gsvg.xScale.domain()[0],e=d.gsvg.xScale.domain()[1];d.xScale(a+d.bin);d.xScale(a);d.redrawLegend();for(var c=[],h=0,f=0,g=0;g<b.length;g++)if("undefined"!==typeof b[g]){var l=parseInt(b[g].getAttribute("start"),
10),n=parseInt(b[g].getAttribute("stop"),10),p=parseInt(b[g].getAttribute("count"),10);if(1!=d.density||1==d.density&&l!=n)if(g+1<b.length){if(n=parseInt(b[g+1].getAttribute("start"),10),l>=a&&l<=e||n>=a&&n<=e)c[h]=b[g],p>f&&(f=p),h++}else l>=a&&l<=e&&(c[h]=b[g],p>f&&(f=p),h++)}b=c;d.svg.selectAll("."+d.trackClass).remove();d.svg.select(".y.axis").remove();d.svg.select("g.grid").remove();d.svg.selectAll(".leftLbl").remove();d.svg.select(".area").remove();d.svg.selectAll(".area").remove();1==d.density?
(e=d.gsvg.xScale.domain()[1],d.svg.selectAll("."+d.trackClass).data(b,keyStart).enter().append("rect").attr("x",function(t){return d.xScale(t.getAttribute("start"))}).attr("y",15).attr("class",d.trackClass).attr("height",10).attr("width",function(t,v){return d.xScale(t.getAttribute("stop"))-d.xScale(t.getAttribute("start"))}).attr("fill",d.color).on("mouseover",function(t){0==d.gsvg.isToolTip&&(d3.select(this).style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(d.createToolTip(t)).style("left",
function(){return d.positionTTLeft(d3.event.pageX)}).style("top",function(){return d.positionTTTop(d3.event.pageY)}),1==d.ttSVG&&d.setupToolTipSVG(t,.005))}).on("mouseout",function(t){d3.select(this).style("fill",d.color);tt.transition().delay(500).duration(200).style("opacity",0)}),d.svg.attr("height",30)):2==d.density&&(d.yScale.domain([0,f]),d.yAxis=d3.axisLeft(d.yScale).ticks(5),d.svg.select("g.grid").remove(),d.svg.select(".y.axis").remove(),d.svg.selectAll(".leftLbl").remove(),d.svg.append("g").attr("class",
"y axis").call(d.yAxis),d.svg.select("g.y").selectAll("text").each(function(t){var v=new String(t);d.svg.append("svg:text").attr("class","leftLbl").attr("x",d.gsvg.width-(7.8*v.length+5)).attr("y",function(){return d.yScale(t)}).attr("dy","0.01em").style("font-weight","bold").text(numberWithCommas(t));d3.select(this).attr("x",function(){return 7.7*v.length+5}).attr("dy","0.05em")}),d.svg.append("g").attr("class","grid").call(d.yAxis.tickSize(-d.gsvg.width+10,0,0).tickFormat("")),d.svg.select(".area").remove(),
d.area=d3.area().x(function(t){return d.xScale(t.getAttribute("start"))}).y0(140).y1(function(t,v){return d.yScale(t.getAttribute("count"))}),d.svg.append("path").datum(b).attr("class","area").attr("stroke",d.graphColorText).attr("fill",d.graphColorText).attr("d",d.area),d.svg.attr("height",140));d.redrawSelectedArea()};d.redrawLegend=function(){if(2==d.density)d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).selectAll(".legend").remove();else if(1==d.density){var b=new String(d.label);b=d.gsvg.width/
2+b.length/2*7.5-10;var a=new String("<"+d.scaleMin);d.drawScaleLegend(d.scaleMin,numberWithCommas(d.scaleMax)+"+","Read Counts","#EEEEEE","#00000",15+7.6*a.length);d.svg.append("text").text("<"+d.scaleMin).attr("class","legend").attr("x",b).attr("y",12);d.svg.append("rect").attr("class","legend").attr("x",b+7.6*a.length+5).attr("y",0).attr("rx",2).attr("ry",2).attr("height",12).attr("width",15).attr("fill","#FFFFFF").attr("stroke","#CECECE")}};d.redrawSelectedArea=function(){if(1<d.density){var b=
d.svg.attr("height");d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).selectAll(".selectedArea").remove();if(-1<d.selectionStart&&-1<d.selectionEnd){var a=d.xScale(d.selectionStart),e=d.xScale(d.selectionEnd)-a;1>e&&(e=1);d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).append("rect").attr("class","selectedArea").attr("x",a).attr("y",0).attr("height",b).attr("width",e).attr("fill","#CECECE").attr("opacity",.3).attr("pointer-events","none")}}else d3.select("#Level"+d.gsvg.levelNumber+d.trackClass).selectAll(".selectedArea").remove()};
d.savePrevious=function(){d.prevSetting={};d.prevSetting.density=d.density;d.prevSetting.scaleMin=d.scaleMin;d.prevSetting.scaleMax=d.scaleMax};d.revertPrevious=function(){d.density=d.prevSetting.density;d.scaleMin=d.prevSetting.scaleMin;d.scaleMax=d.prevSetting.scaleMax};d.generateTrackSettingString=function(){return d.trackClass+","+d.density+","+d.include+";"};d.generateSettingsDiv=function(b){var a=trackInfo[d.trackClass];d.savePrevious();d3.select(b).select("table").select("tbody").html("");
if(a&&a.Controls&&0<a.Controls.length){var e=(new String(a.Controls)).split(",");b=d3.select(b).select("table").select("tbody");b.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+a.Name);for(a=0;a<e.length;a++)if("undefined"!==typeof e[a]&&""!=e[a]){var c=e[a].split(";"),h=b.append("tr").append("td"),f=c[0].substr(5),g="";3<c.length&&0==c[3].indexOf("Default=")&&(g=c[3].substr(8));if(0==c[1].toLowerCase().indexOf("select")){h.append("text").text(f+": ");var l=c[1].split(":");
c=c[2].split("}");f=d.trackClass+"Dense"+d.level+"Select";"colorSelect"==l[1]&&(f=d.trackClass+d.level+"colorSelect");h=h.append("select").attr("id",f).attr("name",l[1]);for(l=0;l<c.length;l++){var n=c[l].substr(1).split(":");if(2==n.length){var p=h.append("option").attr("value",n[1]).text(n[0]);-1<f.indexOf("Dense")?n[1]==d.density&&p.attr("selected","selected"):n[1]==g&&p.attr("selected","selected")}}d3.select("select#"+f).on("change",function(){$(this).attr("id")==d.trackClass+"Dense"+d.level+
"Select"&&1==$(this).val()?$("#scaleControl"+d.level).show():$("#scaleControl"+d.level).hide();d.updateSettingsFromUI();d.redraw()})}else 0==c[1].toLowerCase().indexOf("slider")&&(g="none",1==d.density&&(g="inline-block"),h=h.append("div").attr("id","scaleControl"+d.level).style("display",g),h.append("text").text(f+": "),h.append("input").attr("type","text").attr("id","amount").attr("value",d.scaleMin+"-"+d.scaleMax).style("border",0).style("color","#f6931f").style("font-weight","bold").style("background-color",
"#EEEEEE"),l=c[1].split(":"),c=c[2].split("}"),h=h.append("div"),h.append("text").text("Min:"),h.append("div").attr("id","min-"+l[1]).style("width","60%").style("display","inline-block").style("float","right"),h.append("br"),h.append("text").text("Max:"),h.append("div").attr("id","max-"+l[1]).style("width","60%").style("display","inline-block").style("float","right"),$("#min-"+l[1]).slider({min:1,max:1E3,step:1,value:d.scaleMin,slide:d.processSlider}),$("#max-"+l[1]).slider({min:1E3,max:2E4,step:100,
value:d.scaleMax,slide:d.processSlider}),d.updateSettingsFromUI(),d.redraw())}e=b.append("tr").append("td");e.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");d.gsvg.setCurrentViewModified();d.gsvg.removeTrack(d.trackClass);var t=svgList[d.gsvg.levelNumber].currentView.ViewID,v=viewMenu[d.gsvg.levelNumber].findTrackByClass(d.trackClass,t);v=viewMenu[d.gsvg.levelNumber].findTrackIndexWithViewID(v.TrackID,
t);viewMenu[d.gsvg.levelNumber].removeTrackWithIDIdx(v,t)});e.append("input").attr("type","button").attr("value","Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");d.density==d.prevSetting.density&&d.scaleMin==d.prevSetting.scaleMin&&d.scaleMax==d.prevSetting.scaleMax||d.gsvg.setCurrentViewModified()});e.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){d.revertPrevious();
d.updateCountScale(d.scaleMin,d.scaleMax);d.draw(d.data);$("#trackSettingDialog").fadeOut("fast")})}else b=d3.select(b).select("table").select("tbody"),b.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+a.Name),b.append("tr").append("td").html("Sorry no settings for this track."),e=b.append("tr").append("td"),e.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){d.gsvg.setCurrentViewModified();
$("#trackSettingDialog").fadeOut("fast")}),e.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")})};d.processSlider=function(b,a){var e=$("#min-rangeslider").slider("value"),c=$("#max-rangeslider").slider("value");$("#amount").val(e+" - "+c);d.updateCountScale(e,c)};d.yScale=d3.scaleLinear().range([140,20]).domain([0,d3.max(m,function(b){return b.getAttribute("count")})]);d.area=
d3.area().x(function(b){return d.xScale(b.getAttribute("start"))}).y0(140).y1(function(b){return b.getAttribute("count")});d.yAxis=d3.axisLeft(d.yScale).ticks(5);d.redrawLegend();d.draw(m);return d}
function PolyATrack(q,m,r,u,d,b){var a=GenericTranscriptTrack(q,m,r,u,d,b);a.dataFileName="polyASite.xml";a.density=3;a.minFeatureWidth=1;a.colorBy="Color";a.ttSVG=1;a.ttTrackList=[];a.ttTrackList.push("ensemblcoding");a.ttTrackList.push("braincoding");a.ttTrackList.push("liverTotal");a.ttTrackList.push("heartTotal");a.ttTrackList.push("mergedTotal");a.ttTrackList.push("refSeq");a.ttTrackList.push("repeatMask");a.ttSVGMinWidth=200;a.createToolTip=function(e){var c=".";1==e.getAttribute("strand")?
c="+":-1==e.getAttribute("strand")&&(c="-");var h="0";1==e.getAttribute("pvalue")&&(h="");return'<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>Motif:'+e.getAttribute("motif")+"<BR>Strand:"+c+"<BR>Location: chr"+e.getAttribute("chromosome")+":"+e.getAttribute("start")+"-"+e.getAttribute("stop")+"<BR>Probability of site: "+h+e.getAttribute("pvalue")};a.updateData=function(e){d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+a.gsvg.folderName+"/"+a.dataFileName,function(c,
h){if(c)if(3>e){var f=1E4;1==e&&(f=15E3);setTimeout(function(){a.updateData(e+1)},f)}else 3<=e&&(d3.select("#Level"+a.levelNumber+a.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+a.trackClass),d3.select("#Level"+a.levelNumber+a.trackClass).attr("height",15),a.gsvg.addTrackErrorRemove(a.svg,"#Level"+a.gsvg.levelNumber+a.trackClass));else{f=h.documentElement.getElementsByTagName(a.xmlTag);for(var g=[],l=[],n=0,p=0;p<f.length;p++)"undefined"!==typeof f[p]&&(g[n]=f[p],l[f[p].getAttribute("ID")]=
1,n++);for(p=0;p<a.data.length;p++)"undefined"!==typeof a.data[p]&&"undefined"===typeof l[a.data[p].getAttribute("ID")]&&(g[n]=a.data[p],n++);a.draw(g);a.hideLoading()}})};a.redrawLegend=function(){a.drawLegend([{color:"#FF8000",label:"+ Strand >>>"},{color:"#330570",label:"- Strand <<<"}])};a.updateFullData=void 0;a.draw(m);return a}
function CustomTranscriptTrack(q,m,r,u,d,b){var a=GenericTranscriptTrack(q,m,r,u,d,b);q=b.split(",");a.xmlTag="Feature";a.xmlTagBlockElem="block";a.density=d;1!==a.density&&2!==a.density&&3!==a.density&&(a.density=3);0<q.length&&(a.dataFileName=q[0].substr(9));a.colorBy=1<q.length?q[1]:"Score";2<q.length&&(a.minValue=q[2]);3<q.length&&(a.maxValue=q[3]);4<q.length&&(a.minColor=q[4]);5<q.length&&(a.maxColor=q[5]);a.colorValueField="score";a.minFeatureWidth=1;a.updateControl=0;"Score"==a.colorBy&&a.createColorScale();
a.updateFullData=function(e,c){if(a.updateControl==e){a.updateControl=e+1;var h=a.xScale.domain()[0],f=a.xScale.domain()[1],g=dataPrefix+"tmpData/trackXML/"+a.gsvg.folderName+"/"+a.dataFileName+".xml",l=dataPrefix+"tmpData/trackUpload/"+a.dataFileName,n="",p=new Date,t="bed";-1<a.dataFileName.indexOf("http")&&(n=a.dataFileName,l="tmpData/tmpDownload/"+p.getTime()+"_"+a.trackClass,g=dataPrefix+"tmpData/trackXML/"+a.gsvg.folderName+"/"+a.trackClass+".xml",t="bb");d3.xml(g,function(v,y){if(v){console.log(v);
if(0==e||1==c){var w="/"+pathPrefix;pathPrefix||(w="");$.ajax({url:w+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:h,maxCoord:f,folder:a.gsvg.folderName,bedFile:l,outFile:g,track:a.trackClass,web:n,type:t},dataType:"json",success:function(A){gtag("event","generateTrackCustomTranscript",{event_category:"browser"})},error:function(A,C,F){console.log(F)}})}3>e?(w=1E4,1==e&&(w=15E3),setTimeout(function(){a.updateFullData(e+1,0)},w)):(d3.select("#Level"+a.gsvg.levelNumber+
a.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+a.trackClass),d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).attr("height",15),a.gsvg.addTrackErrorRemove(a.svg,"#Level"+a.gsvg.levelNumber+a.trackClass),a.hideLoading())}else w=y.documentElement.getElementsByTagName(a.xmlTag),a.draw(w),a.hideLoading(),a.updateControl=0})}};a.updateSettingsFromUI=function(){0<$("#"+a.trackClass+"Dense"+a.level+"Select").length&&(a.density=$("#"+a.trackClass+"Dense"+a.level+"Select").val());
0<$("#"+a.trackClass+a.level+"colorSelect").length&&(a.colorBy=$("#"+a.trackClass+a.level+"colorSelect").val());"Score"==a.colorBy&&(a.minValue=$("#"+a.trackClass+"minData"+a.level).val(),a.maxValue=$("#"+a.trackClass+"maxData"+a.level).val(),testIE||testSafari?(a.minColor=$("#"+a.trackClass+"minColor"+a.level).spectrum("get").toHexString(),a.maxColor=$("#"+a.trackClass+"maxColor"+a.level).spectrum("get").toHexString()):(a.minColor=$("#"+a.trackClass+"minColor"+a.level).val(),a.maxColor=$("#"+a.trackClass+
"maxColor"+a.level).val()),a.createColorScale())};a.generateSettingsDiv=function(e){var c=trackInfo[a.trackClass];a.savePrevious();d3.select(e).select("table").select("tbody").html("");if(0<c.Controls.length&&"null"!=c.Controls){var h=(new String(c.Controls)).split(",");e=d3.select(e).select("table").select("tbody");e.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name);for(c=0;c<h.length;c++)if("undefined"!==typeof h[c]&&""!=h[c]){var f=h[c].split(";"),g=e.append("tr").append("td"),
l=f[0].substr(5);3<f.length&&0==f[3].indexOf("Default=")&&f[3].substr(8);if(0==f[1].toLowerCase().indexOf("select")){g.append("text").text(l+": ");l=f[1].split(":");f=f[2].split("}");var n=a.trackClass+"Dense"+a.level+"Select";"colorSelect"==l[1]&&(n=a.trackClass+a.level+"colorSelect");g=g.append("select").attr("id",n).attr("name",l[1]);for(l=0;l<f.length;l++){var p=f[l].substr(1).split(":");if(2==p.length){var t=g.append("option").attr("value",p[1]).text(p[0]);(-1<n.indexOf("Dense")&&p[1]==a.density||
-1<n.indexOf("colorSelect")&&p[1]==a.colorBy)&&t.attr("selected","selected")}}d3.select("select#"+n).on("change",function(){"Score"==$(this).val()?$("div."+a.trackClass+"Scale"+a.level).show():"Color"==$(this).val()&&$("div."+a.trackClass+"Scale"+a.level).hide();a.updateSettingsFromUI();a.draw(a.data)})}else 0==f[1].toLowerCase().indexOf("txt")&&(g=0==$("#colorTrack"+a.level).size()?g.append("div").attr("class",a.trackClass+"Scale"+a.level).style("display","none"):d3.select("#"+a.trackClass+"Scale"+
a.level),g.append("text").text(l+": "),l=f[1].split(":"),f=f[2].split("}"),f="Data",n="text",p=a.minValue,t=a.maxValue,"color"==l[1]&&(n=f="Color",p=a.minColor,t=a.maxColor),g.append("input").attr("type",n).attr("id",a.trackClass+"min"+f+a.level).attr("class",l[1]).style("margin-left","5px").attr("value",p),g.append("text").text(" - "),g.append("input").attr("type",n).attr("id",a.trackClass+"max"+f+a.level).attr("class",l[1]).style("margin-left","5px").attr("value",t),"Color"==f&&(testIE||testSafari)?
($("#"+a.trackClass+"min"+f+a.level).spectrum({change:function(v){a.updateSettingsFromUI();a.draw(a.data)}}),$("#"+a.trackClass+"max"+f+a.level).spectrum({change:function(v){a.updateSettingsFromUI();a.draw(a.data)}})):($("input#"+a.trackClass+"min"+f+a.level).on("change",function(){a.updateSettingsFromUI();a.draw(a.data)}),$("input#"+a.trackClass+"max"+f+a.level).on("change",function(){a.updateSettingsFromUI();a.draw(a.data)})))}"Score"==$("#"+a.trackClass+a.level+"colorSelect").val()?$("div."+a.trackClass+
"Scale"+a.level).show():"Color"==$("#"+a.trackClass+a.level+"colorSelect").val()&&$("div."+a.trackClass+"Scale"+a.level).hide();h=e.append("tr").append("td");h.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");a.gsvg.removeTrack(a.trackClass);var v=svgList[a.gsvg.levelNumber].currentView.ViewID,y=viewMenu[a.gsvg.levelNumber].findTrackByClass(a.trackClass,v);y=viewMenu[a.gsvg.levelNumber].findTrackIndexWithViewID(y.TrackID,
v);viewMenu[a.gsvg.levelNumber].removeTrackWithIDIdx(y,v)});h.append("input").attr("type","button").attr("value","Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")});h.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){a.revertPrevious();a.draw(a.data);$("#trackSettingDialog").fadeOut("fast")})}else e=d3.select(e).select("table").select("tbody"),
e.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name),e.append("tr").append("td").html("Sorry no settings for this track."),h=e.append("tr").append("td"),h.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")}),h.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")})};
a.generateTrackSettingString=function(){return a.trackClass+","+a.density+","+a.colorBy+","+a.minValue+","+a.maxValue+","+a.minColor+","+a.maxColor+";"};return a}
function RepeatMaskTrack(q,m,r,u,d,b){var a=GenericTranscriptTrack(q,m,r,u,d,b);a.dataFileName="repeatMask.xml";a.density=1;a.xmlTag="Feature";a.xmlTagBlockElem="Block";a.minFeatureWidth=1;a.ttSVG=1;a.ttTrackList=[];a.ttTrackList.push("ensemblcoding");a.ttTrackList.push("braincoding");a.ttTrackList.push("liverTotal");a.ttTrackList.push("heartTotal");a.ttTrackList.push("mergedTotal");a.ttTrackList.push("refSeq");a.ttTrackList.push("spliceJnct");a.ttTrackList.push("liverspliceJnct");a.ttTrackList.push("heartspliceJnct");
a.ttTrackList.push("brainspliceJnct");a.ttTrackList.push("illuminaPolyA");a.ttTrackList.push("liverilluminaTotalPlus");a.ttTrackList.push("liverilluminaTotalMinus");a.ttTrackList.push("heartilluminaTotalPlus");a.ttTrackList.push("heartilluminaTotalMinus");a.ttTrackList.push("brainilluminaTotalPlus");a.ttTrackList.push("brainilluminaTotalMinus");a.ttSVGMinWidth=200;a.legendLbl="Smith-Waterman Alignment Score";a.typeList=[];a.typeList[0]={name:"SINE",clss:"SINE"};a.typeList[1]={name:"LINE",clss:"LINE"};
a.typeList[2]={name:"LTR",clss:"LTR"};a.typeList[3]={name:"DNA",clss:"DNA"};a.typeList[4]={name:"Simple",clss:"Simple_repeat"};a.typeList[5]={name:"Low Comp.",clss:"Low_complexity"};a.typeList[6]={name:"Satellite",clss:"Satellite"};a.typeList[7]={name:"RNA",clss:"RNA"};a.typeList[8]={name:"Other",clss:"Other"};a.typeList[9]={name:"Unknown",clss:"Unknown"};a.yList={};for(q=0;q<a.typeList.length;q++)a.yList[a.typeList[q].clss]=15+15*q;a.createToolTip=function(e){var c='<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>Name: '+
e.getAttribute("name")+"&nbsp&nbsp&nbsp&nbsp&nbspClass: "+e.getAttribute("class");c=c+"&nbsp&nbsp&nbsp&nbsp&nbspFamily: "+e.getAttribute("family")+"<BR><BR>Location: "+e.getAttribute("chromosome")+":"+e.getAttribute("start")+"-"+e.getAttribute("stop");c=c+"<BR><BR>Alignment Score: "+e.getAttribute("score")+"<BR>Mismatches(parts/thousand): "+e.getAttribute("mis")+"<BR>Insertions(parts/thousand): "+e.getAttribute("ins");return c=c+"<BR>Deletions(parts/thousand): "+e.getAttribute("del")};a.pieColor=
function(e,c){var h=d3.rgb("#000000"),f=e.data.names;"LINE"===f?h=d3.rgb("#27e5e5"):"SINE"===f?h=d3.rgb("#e57927"):"LTR"===f?h=d3.rgb("#27e527"):"DNA"===f?h=d3.rgb("#e52727"):"Simple_repeat"===f?h=d3.rgb("#e51ba2"):"Low_complexity"===f?h=d3.rgb("#9029e5"):"RNA"===f?h=d3.rgb("#005be5"):"Satellite"===f?h=d3.rgb("#cccc00"):"Other"===f&&(h=d3.rgb("#007f24"));return h};a.calcY=function(e,c,h,f){e=3===a.density||"3"===a.density?a.calcYPack(e,c,h):2===a.density||"2"===a.density?a.calcYFull(f):a.calcYDense();
a.trackYMax<e/15&&(a.trackYMax=e/15);return e};a.calcYFull=function(e){e=e.getAttribute("class");-1<e.indexOf("RNA")&&(e="RNA");return a.yList[e]};a.redraw=function(){if(a.prevDensity!=a.density)a.draw(a.data);else{a.yMaxArr=[];a.yArr=[];a.yArr[0]=[];for(var e=0;e<a.gsvg.width;e++)a.yMaxArr[e]=0,a.yArr[0][e]=0;a.trackYMax=0;d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g."+a.idPrefix+"trx"+a.gsvg.levelNumber).attr("transform",function(c,h){return"translate("+a.xScale(c.getAttribute("start"))+
","+a.calcY(parseInt(c.getAttribute("start"),10),parseInt(c.getAttribute("stop"),10),h,c)+")"}).each(function(c,h){for(var f=getAllChildrenByName(getFirstChildByName(c,a.xmlTagBlockElem+"List"),a.xmlTagBlockElem),g=0;g<f.length;g++){var l=a.idPrefix+"Ex"+f[g].getAttribute("ID");null==f[g].getAttribute("ID")&&(l=a.idPrefix+"Ex"+c.getAttribute("ID")+"_"+g);a.svg.select("g#"+a.idPrefix+"tx"+c.getAttribute("ID")+" rect#"+l).attr("x",function(w){return a.xScale(f[g].getAttribute("start"))-a.xScale(c.getAttribute("start"))}).attr("width",
function(w){return a.xScale(f[g].getAttribute("stop"))-a.xScale(f[g].getAttribute("start"))});if(0<g){l=">";"-1"==c.getAttribute("strand")&&(l="<");var n=l,p=a.xScale(f[g-1].getAttribute("stop"))-a.xScale(c.getAttribute("start")),t=a.xScale(f[g].getAttribute("start"))-a.xScale(c.getAttribute("start")),v=t-p,y=0;if(7>v)n="";else for(v-=7;8<v;)0==y?(n+=" ",y=1):(n+=l,y=0),v-=7;l=f[g-1].getAttribute("ID")+"_"+f[g].getAttribute("ID");null==f[g].getAttribute("ID")&&(l=c.getAttribute("ID")+"_"+(g-1)+"_"+
g);a.svg.select("g#"+a.idPrefix+"tx"+c.getAttribute("ID")+" line#"+a.idPrefix+"Int"+l).attr("x1",p).attr("x2",t);a.svg.select("g#"+a.idPrefix+"tx"+c.getAttribute("ID")+" #"+a.idPrefix+"IntTxt"+l).attr("dx",p+1).text(n)}}});1==a.density?a.svg.attr("height",30):2==a.density?a.svg.attr("height",15*(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g."+a.idPrefix+"trx"+a.gsvg.levelNumber).size()+1)):3==a.density&&a.svg.attr("height",15*(a.trackYMax+1));a.redrawSelectedArea()}};a.drawTrx=
function(e,c){var h=d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).select("#"+a.idPrefix+"tx"+e.getAttribute("ID"));exList=getAllChildrenByName(getFirstChildByName(e,a.xmlTagBlockElem+"List"),a.xmlTagBlockElem);1===exList.length&&h.append("rect").attr("x",function(f){return a.xScale(exList[0].getAttribute("start"))-a.xScale(f.getAttribute("start"))}).attr("rx",1).attr("ry",1).attr("height",10).attr("width",function(f){f=a.xScale(exList[0].getAttribute("stop"))-a.xScale(exList[0].getAttribute("start"));
0<a.minFeatureWidth&&f<a.minFeatureWidth&&(f=a.minFeatureWidth);return f}).attr("id",function(f,g){var l=a.idPrefix+"Ex"+exList[0].getAttribute("ID");null==exList[0].getAttribute("ID")&&(l=a.idPrefix+"Ex"+f.getAttribute("ID")+"_0");return l}).style("fill",a.color).style("cursor","pointer")};a.draw=function(e){a.data=e;a.prevDensity=a.density;a.trackYMax=0;a.yArr=[];a.yArr[0]=[];for(var c=0;c<a.gsvg.width;c++)a.yMaxArr[c]=0,a.yArr[0][c]=0;a.svg.selectAll(".repeatLine"+a.gsvg.levelNumber).remove();
a.svg.selectAll(".repeatLbl"+a.gsvg.levelNumber).remove();if(2==a.density)for(c=0;c<a.typeList.length;c++)a.svg.append("line").attr("class","repeatLine"+a.gsvg.levelNumber).attr("x1",0).attr("x2",a.gsvg.width).attr("y1",12+15*(c+1)).attr("y2",12+15*(c+1)).attr("stroke","#000000").attr("stroke-width","1px"),a.svg.append("text").attr("x",5).attr("class","repeatLbl"+a.gsvg.levelNumber).attr("y",10+15*(c+1)).style("pointer-events","none").style("opacity","0.5").style("fill","#000000").style("font-size",
"11px").text(a.typeList[c].name),a.svg.append("text").attr("class","repeatLbl"+a.gsvg.levelNumber).attr("x",a.gsvg.width-5).attr("y",10+15*(c+1)).style("text-anchor","end").style("pointer-events","none").style("opacity","0.5").style("fill","#000000").style("font-size","11px").text(a.typeList[c].name);d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("."+a.idPrefix+"trx"+a.gsvg.levelNumber).remove();a.redrawLegend();e=d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("."+a.idPrefix+
"trx"+a.gsvg.levelNumber).data(e,key).attr("transform",function(h,f){return"translate("+a.xScale(h.getAttribute("start"))+","+a.calcY(parseInt(h.getAttribute("start"),10),parseInt(h.getAttribute("stop"),10),f,h)+")"});e.enter().append("g").attr("class",a.idPrefix+"trx"+a.gsvg.levelNumber).attr("transform",function(h,f){return"translate("+a.xScale(h.getAttribute("start"))+","+a.calcY(parseInt(h.getAttribute("start"),10),parseInt(h.getAttribute("stop"),10),f,h)+")"}).attr("id",function(h){return a.idPrefix+
"tx"+h.getAttribute("ID")}).style("cursor","move").on("mouseover",function(h){0==a.gsvg.isToolTip&&0!=a.trackClass.indexOf("custom")&&(d3.select(this).selectAll("line").style("stroke","green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(a.createToolTip(h)).style("left",function(){return a.positionTTLeft(d3.event.pageX)}).style("top",function(){return a.positionTTTop(d3.event.pageY)}),
1==a.ttSVG&&a.setupToolTipSVG(h,.05))}).on("mouseout",function(h){d3.select(this).selectAll("line").style("stroke",a.color);d3.select(this).selectAll("rect").style("fill",a.color);d3.select(this).selectAll("text").style("opacity","0.6").style("fill",a.color);tt.transition().delay(100).duration(200).style("opacity",0)}).each(a.drawTrx);e.exit().remove();1==a.density?a.svg.attr("height",30):2==a.density?a.svg.attr("height",15*a.typeList.length+15):3==a.density&&a.svg.attr("height",15*(a.trackYMax+2));
a.redrawSelectedArea()};a.getDisplayedData=function(){var e=d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("."+a.idPrefix+"trx"+a.gsvg.levelNumber);a.counts=[];var c={};e=e[0];var h=[],f=0;if("undefined"!==typeof e){for(var g=0;g<e.length;g++){var l=a.xScale(e[g].__data__.getAttribute("start")),n=a.xScale(e[g].__data__.getAttribute("stop"));if(0<=l&&l<=a.gsvg.width||0<=n&&n<=a.gsvg.width)"undefined"===typeof c[e[g].__data__.getAttribute("class")]?(c[e[g].__data__.getAttribute("class")]=
{},c[e[g].__data__.getAttribute("class")].value=1,c[e[g].__data__.getAttribute("class")].names=e[g].__data__.getAttribute("class")):c[e[g].__data__.getAttribute("class")].value=c[e[g].__data__.getAttribute("class")].value+1,h[f]=e[g].__data__,f++}a.counts=[];for(x in c)a.counts.push(c[x])}else a.counts=[];return h};a.draw(m);return a}
function GenericTranscriptTrack(q,m,r,u,d,b){var a=Track(q,m,r,u);a.dataFileName=r+".xml";a.xmlTag="Feature";a.xmlTagBlockElem="block";a.idPrefix="genTrx";a.ttSVG=0;a.ttTrackList=[];a.colorValueField="score";a.colorBy="Score";a.minValue=1;a.maxValue=1E3;a.minColor="#E6E6E6";a.maxColor="#000000";a.minFeatureWidth=-1;a.ttSVGMinWidth=0;a.legendLbl="";q=new String(b);if("undefined"!==typeof b&&0<q.length)for(b=q.split(","),q=0;q<b.length;q++)m=new String(b[q]),0==m.indexOf("colorBy=")?a.colorBy=m.substr(m.indexOf("=")+
1):0==m.indexOf("minColor=")?a.minColor=m.substr(m.indexOf("=")+1):0==m.indexOf("maxColor=")?a.maxColor=m.substr(m.indexOf("=")+1):0==m.indexOf("minValue=")?a.minValue=m.substr(m.indexOf("=")+1):0==m.indexOf("maxValue=")&&(a.maxValue=m.substr(m.indexOf("=")+1));a.createColorScale=function(){"undefined"!==typeof a.minColor&&"undefined"!==typeof a.maxColor&&(a.colorScale=d3.scaleLinear().domain([a.minValue,a.maxValue]).range([a.minColor,a.maxColor]))};a.createColorScale();a.setMinColor=function(e){a.minColor=
"#"+e;a.createColorScale();a.draw(a.data)};a.setMaxColor=function(e){a.maxColor="#"+e;a.createColorScale();a.draw(a.data)};a.setMinValue=function(e){a.minValue=e;a.createColorScale();a.draw(a.data)};a.setMaxValue=function(e){a.maxValue=e;a.createColorScale();a.draw(a.data)};a.setColorBy=function(e){a.colorBy=e;a.createColorScale();a.draw(a.data)};a.getDisplayID=function(e){return e.getAttribute("ID")};a.createToolTip=function(e){return""};a.getColorValue=function(e){return e.getAttribute(a.colorValueField)};
a.color=function(e){var c=d3.rgb("#FFFFFF");"Score"==a.colorBy?c=a.colorScale(a.getColorValue(e)):"Color"==a.colorBy&&(e=(new String(e.getAttribute("color"))).split(","),3==e.length&&(c=d3.rgb(e[0],e[1],e[2])));return c};a.savePrevious=function(){a.prevSetting={};a.prevSetting.density=a.density;a.prevSetting.colorValueField=a.colorValueField;a.prevSetting.colorBy=a.colorBy;a.prevSetting.minValue=a.minValue;a.prevSetting.maxValue=a.maxValue;a.prevSetting.minColor=a.minColor;a.prevSetting.maxColor=
a.maxColor};a.revertPrevious=function(){a.density=a.prevSetting.density;a.colorValueField=a.prevSetting.colorValueField;a.colorBy=a.prevSetting.colorBy;a.minValue=a.prevSetting.minValue;a.maxValue=a.prevSetting.maxValue;a.minColor=a.prevSetting.minColor;a.maxColor=a.prevSetting.maxColor;"Score"==a.colorBy&&a.createColorScale()};a.drawTrx=function(e,c){var h=d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).select("#"+a.idPrefix+"tx"+e.getAttribute("ID"));exList=getAllChildrenByName(getFirstChildByName(e,
a.xmlTagBlockElem+"List"),a.xmlTagBlockElem);for(var f=0;f<exList.length;f++)if(h.append("rect").attr("x",function(v){return a.xScale(exList[f].getAttribute("start"))-a.xScale(v.getAttribute("start"))}).attr("rx",1).attr("ry",1).attr("height",10).attr("width",function(v){v=a.xScale(exList[f].getAttribute("stop"))-a.xScale(exList[f].getAttribute("start"));0<a.minFeatureWidth&&v<a.minFeatureWidth&&(v=a.minFeatureWidth);return v}).attr("id",function(v,y){var w=a.idPrefix+"Ex"+exList[f].getAttribute("ID");
null==exList[f].getAttribute("ID")&&(w=a.idPrefix+"Ex"+v.getAttribute("ID")+"_"+f);return w}).style("fill",a.color).style("cursor","pointer"),0<f){var g=a.xScale(exList[f-1].getAttribute("stop"))-a.xScale(e.getAttribute("start")),l=a.xScale(exList[f].getAttribute("start"))-a.xScale(e.getAttribute("start"));h.append("line").attr("x1",g).attr("x2",l).attr("y1",5).attr("y2",5).attr("stroke",a.color).attr("stroke-width","2").attr("id",function(v,y){var w=a.idPrefix+"Int"+exList[f-1].getAttribute("ID")+
"_"+exList[f].getAttribute("ID");null==exList[f].getAttribute("ID")&&(w=a.idPrefix+"Int"+v.getAttribute("ID")+"_"+(f-1)+"_"+f);return w});var n=">";"-1"==e.getAttribute("strand")&&(n="<");var p=n;l-=g;var t=0;if(7>l)p="";else for(l-=7;8<l;)0==t?(p+=" ",t=1):(p+=n,t=0),l-=7;h.append("svg:text").attr("id",function(v){var y=a.idPrefix+"IntTxt"+exList[f-1].getAttribute("ID")+"_"+exList[f].getAttribute("ID");null==exList[f].getAttribute("ID")&&(y=a.idPrefix+"IntTxt"+v.getAttribute("ID")+"_"+(f-1)+"_"+
f);return y}).attr("dx",g+1).attr("dy","11").style("pointer-events","none").style("opacity","0.5").style("fill",a.color).style("font-size","16px").text(p)}};a.redraw=function(){if(a.prevDensity!=a.density)a.draw(a.data);else{a.yMaxArr=[];a.yArr=[];a.yArr[0]=[];for(var e=0;e<a.gsvg.width;e++)a.yMaxArr[e]=0,a.yArr[0][e]=0;a.trackYMax=0;d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g."+a.idPrefix+"trx"+a.gsvg.levelNumber).attr("transform",function(c,h){return"translate("+a.xScale(c.getAttribute("start"))+
","+a.calcY(parseInt(c.getAttribute("start"),10),parseInt(c.getAttribute("stop"),10),h)+")"}).each(function(c,h){for(var f=getAllChildrenByName(getFirstChildByName(c,a.xmlTagBlockElem+"List"),a.xmlTagBlockElem),g=0;g<f.length;g++){var l=a.idPrefix+"Ex"+f[g].getAttribute("ID");null==f[g].getAttribute("ID")&&(l=a.idPrefix+"Ex"+c.getAttribute("ID")+"_"+g);a.svg.select("g#"+a.idPrefix+"tx"+c.getAttribute("ID")+" rect#"+l).attr("x",function(w){return a.xScale(f[g].getAttribute("start"))-a.xScale(c.getAttribute("start"))}).attr("width",
function(w){return a.xScale(f[g].getAttribute("stop"))-a.xScale(f[g].getAttribute("start"))});if(0<g){l=">";"-1"==c.getAttribute("strand")&&(l="<");var n=l,p=a.xScale(f[g-1].getAttribute("stop"))-a.xScale(c.getAttribute("start")),t=a.xScale(f[g].getAttribute("start"))-a.xScale(c.getAttribute("start")),v=t-p,y=0;if(7>v)n="";else for(v-=7;8<v;)0==y?(n+=" ",y=1):(n+=l,y=0),v-=7;l=f[g-1].getAttribute("ID")+"_"+f[g].getAttribute("ID");null==f[g].getAttribute("ID")&&(l=c.getAttribute("ID")+"_"+(g-1)+"_"+
g);a.svg.select("g#"+a.idPrefix+"tx"+c.getAttribute("ID")+" line#"+a.idPrefix+"Int"+l).attr("x1",p).attr("x2",t);a.svg.select("g#"+a.idPrefix+"tx"+c.getAttribute("ID")+" #"+a.idPrefix+"IntTxt"+l).attr("dx",p+1).text(n)}}});1==a.density?a.svg.attr("height",30):2==a.density?a.svg.attr("height",15*(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g."+a.idPrefix+"trx"+a.gsvg.levelNumber).size()+1)):3==a.density&&a.svg.attr("height",15*(a.trackYMax+1));a.redrawSelectedArea()}};a.update=function(e){a.redraw()};
a.updateFullData=function(e,c){var h=a.xScale.domain()[0],f=a.xScale.domain()[1];a.showLoading();d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+a.gsvg.folderName+"/"+a.dataFileName,function(g,l){if(g){if(0==e||1==c){var n="/"+pathPrefix;pathPrefix||(n="");$.ajax({url:n+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:h,maxCoord:f,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:a.trackClass,
folder:a.gsvg.folderName},dataType:"json",success:function(p){gtag("event","generateTrackTranscript",{event_category:"browser"})},error:function(p,t,v){}})}3>e?(n=1E4,1==e&&(n=15E3),setTimeout(function(){a.updateFullData(e+1,0)},n)):(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+a.trackClass),d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).attr("height",15),a.gsvg.addTrackErrorRemove(a.svg,"#Level"+a.gsvg.levelNumber+a.trackClass),
a.hideLoading())}else null==l?4<=e?(n=[],a.draw(n),a.hideLoading()):setTimeout(function(){a.updateFullData(e+1,0)},5E3):(n=l.documentElement.getElementsByTagName(a.xmlTag),a.draw(n),a.hideLoading())})};a.redrawLegend=function(){var e=[];"Score"==a.colorBy?a.drawScaleLegend(a.minValue,a.maxValue+"+",a.legendLbl,a.minColor,a.maxColor,0):"Color"==a.colorBy&&(e[0]={color:"#FFFFFF",label:"User assigned color from track file."},a.drawLegend(e))};a.draw=function(e){a.data=e;a.prevDensity=a.density;a.trackYMax=
0;a.yArr=[];a.yArr[0]=[];for(var c=0;c<a.gsvg.width;c++)a.yMaxArr[c]=0,a.yArr[0][c]=0;d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("."+a.idPrefix+"trx"+a.gsvg.levelNumber).remove();a.redrawLegend();e&&(e=d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("."+a.idPrefix+"trx"+a.gsvg.levelNumber).data(e,key),e.enter().append("g").attr("class",a.idPrefix+"trx"+a.gsvg.levelNumber).attr("transform",function(h,f){return"translate("+a.xScale(h.getAttribute("start"))+","+a.calcY(parseInt(h.getAttribute("start"),
10),parseInt(h.getAttribute("stop"),10),f)+")"}).attr("id",function(h){return a.idPrefix+"tx"+h.getAttribute("ID")}).style("cursor","move").on("mouseover",function(h){0==a.gsvg.isToolTip&&0!=a.trackClass.indexOf("custom")&&(d3.select(this).selectAll("line").style("stroke","green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(a.createToolTip(h)).style("left",
function(){return a.positionTTLeft(d3.event.pageX)}).style("top",function(){return a.positionTTTop(d3.event.pageY)}),1==a.ttSVG&&a.setupToolTipSVG(h,.05))}).on("mouseout",function(h){d3.select(this).selectAll("line").style("stroke",a.color);d3.select(this).selectAll("rect").style("fill",a.color);d3.select(this).selectAll("text").style("opacity","0.6").style("fill",a.color);tt.transition().delay(100).duration(200).style("opacity",0)}).merge(e).each(a.drawTrx),e.exit().remove());1==a.density?a.svg.attr("height",
30):2==a.density?a.svg.attr("height",15*(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g."+a.idPrefix+"trx"+a.gsvg.levelNumber).size()+1)):3==a.density&&a.svg.attr("height",15*(a.trackYMax+2));a.redrawSelectedArea()};return a}
function CircRNATrack(q,m,r,u,d,b){var a=GenericTranscriptTrack(q,m,r,u,d,b);q=b.split(",");a.density=d;0<q.length&&(a.dataFileName=q[0].substr(9));a.colorBy=1<q.length?q[1]:"Score";2<q.length&&(a.minValue=q[2]);3<q.length&&(a.maxValue=q[3]);4<q.length&&(a.minColor=q[4]);5<q.length&&(a.maxColor=q[5]);a.colorValueField="score";a.minFeatureWidth=1;a.updateControl=0;a.xmlTag="Gene";a.xmlTagBlockElem="Block";a.idPrefix="cirRNA";a.xCirLineWidth=4;a.xPadding=7;a.featureHeight=30;"Score"==a.colorBy&&a.createColorScale();
a.color=function(e){var c=d3.rgb("#000000");"1"===e.getAttribute("Array")&&"1"===e.getAttribute("Ciri")&&"1"===e.getAttribute("Circexplorer")?c=d3.rgb("#DD9C56"):"0"===e.getAttribute("Array")&&"1"===e.getAttribute("Ciri")&&"1"===e.getAttribute("Circexplorer")?c=d3.rgb("#0f4c75"):"0"!==e.getAttribute("Array")||"1"!==e.getAttribute("Ciri")&&"1"!==e.getAttribute("Circexplorer")?"1"===e.getAttribute("Array")&&"0"===e.getAttribute("Ciri")&&"0"===e.getAttribute("Circexplorer")?c=d3.rgb("#5D576B"):"1"!==
e.getAttribute("Array")||"1"!==e.getAttribute("Ciri")&&"1"!==e.getAttribute("Circexplorer")||(c=d3.rgb("#7A9D98")):c=d3.rgb("#3282b8");return c};a.calcY=function(e,c,h){e=3===a.density||"3"===a.density?a.calcYPack(e,c,h):2===a.density||"2"===a.density?a.calcYFull(h):a.calcYDense();a.trackYMax<e/a.featureHeight&&(a.trackYMax=e/a.featureHeight);return e};a.calcYPack=function(e,c,h){if(e>=a.xScale.domain()[0]&&e<=a.xScale.domain()[1]||c>=a.xScale.domain()[0]&&c<=a.xScale.domain()[1]||e<=a.xScale.domain()[0]&&
c>=a.xScale.domain()[1]){e=Math.round(a.xScale(e));0>e&&(e=0);c=Math.round(a.xScale(c));c>=a.gsvg.width&&(c=a.gsvg.width-1);h=e-a.xPadding;0>h&&(h=0);var f=c+a.xPadding;f>=a.gsvg.width&&(f=a.gsvg.width-1);for(var g=0,l=h;l<=f;l++)a.yMaxArr[l]>g&&(g=a.yMaxArr[l]);g++;var n=g;if(a.yArr.length<=g)for(a.yArr[n]=[],l=0;l<a.gsvg.width;l++)a.yArr[n][l]=0;l=g-a.scanBackYLines;1>l&&(l=1);n=0;for(var p=l;p<g&&0==n;p++){var t=0;for(l=h;l<=f&&0==t;l++)a.yArr[p][l]>t&&(t=1);0==t&&(g=p,n=1)}g>a.trackYMax&&(a.trackYMax=
g);for(l=e;l<=c;l++)a.yMaxArr[l]<g&&(a.yMaxArr[l]=g),a.yArr[g][l]=1;e=g*a.featureHeight}else e=a.featureHeight;return e};a.calcYFull=function(e){return(e+1)*a.featureHeight};a.draw=function(e){a.data=e;a.prevDensity=a.density;a.trackYMax=0;a.yArr=[];a.yArr[0]=[];for(var c=0;c<a.gsvg.width;c++)a.yMaxArr[c]=0,a.yArr[0][c]=0;d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("."+a.idPrefix+"trx"+a.gsvg.levelNumber).remove();a.redrawLegend();e&&(e=d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("."+
a.idPrefix+"trx"+a.gsvg.levelNumber).data(e,key),e.enter().append("g").attr("class",a.idPrefix+"trx"+a.gsvg.levelNumber).attr("transform",function(h,f){return"translate("+a.xScale(h.getAttribute("start"))+","+a.calcY(parseInt(h.getAttribute("start"),10),parseInt(h.getAttribute("stop"),10),f)+")"}).attr("id",function(h){return a.idPrefix+"tx"+h.getAttribute("ID")}).style("cursor","move").on("mouseover",function(h){0==a.gsvg.isToolTip&&0!=a.trackClass.indexOf("custom")&&(d3.select(this).selectAll("line").style("stroke",
"green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(a.createToolTip(h)).style("left",function(){return a.positionTTLeft(d3.event.pageX)}).style("top",function(){return a.positionTTTop(d3.event.pageY)}),1==a.ttSVG&&a.setupToolTipSVG(h,.05))}).on("mouseout",function(h){d3.select(this).selectAll("line").style("stroke",a.color);d3.select(this).selectAll("rect").style("fill",
a.color);d3.select(this).selectAll("text").style("opacity","0.6").style("fill",a.color);tt.transition().delay(100).duration(200).style("opacity",0)}).merge(e).each(a.drawTrx),e.exit().remove());1==a.density?a.svg.attr("height",30):2==a.density?a.svg.attr("height",15*(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g."+a.idPrefix+"trx"+a.gsvg.levelNumber).size()+1)):3==a.density&&a.svg.attr("height",30*(a.trackYMax+2));a.redrawSelectedArea()};a.drawTrx=function(e,c){var h=d3.select("#Level"+
a.gsvg.levelNumber+a.trackClass).select("#"+a.idPrefix+"tx"+e.getAttribute("ID"));exList=getAllChildrenByName(getFirstChildByName(e,a.xmlTagBlockElem+"List"),a.xmlTagBlockElem);minStart=a.xScale(e.getAttribute("start"));maxEnd=a.xScale(e.getAttribute("stop"));h.append("line").attr("id",function(){return"l"+e.getAttribute("ID")+"_x1"}).attr("x1",function(){return a.calcXLine(exList,0,-1,"start",minStart)}).attr("x2",function(){return a.calcXLine(exList,0,-1,"start",minStart)}).attr("y1",5).attr("y2",
20).attr("stroke",a.color).attr("stroke-width","1");h.append("line").attr("id",function(){return"l"+e.getAttribute("ID")+"_x2"}).attr("x1",function(){return a.calcXLine(exList,exList.length-1,1,"stop",minStart)}).attr("x2",function(){return a.calcXLine(exList,exList.length-1,1,"stop",minStart)}).attr("y1",5).attr("y2",20).attr("stroke",a.color).attr("stroke-width","1");h.append("line").attr("id",function(){return"l"+e.getAttribute("ID")+"_x3"}).attr("x1",function(){return a.calcXLine(exList,0,-1,
"start",minStart)}).attr("x2",function(){return a.calcXLine(exList,exList.length-1,1,"stop",minStart)}).attr("y1",5).attr("y2",5).attr("stroke",a.color).attr("stroke-width","1");h.append("line").attr("id",function(){return"l"+e.getAttribute("ID")+"_x4"}).attr("x1",function(){return a.calcXLine(exList,0,-1,"start",minStart)}).attr("x2",function(){return a.calcXLine(exList,0,0,"start",minStart)}).attr("y1",20).attr("y2",20).attr("stroke",a.color).attr("stroke-width","1");h.append("line").attr("id",
function(){return"l"+e.getAttribute("ID")+"_x5"}).attr("x1",function(){return a.calcXLine(exList,exList.length-1,0,"stop",minStart)}).attr("x2",function(){return a.calcXLine(exList,exList.length-1,1,"stop",minStart)}).attr("y1",20).attr("y2",20).attr("stroke",a.color).attr("stroke-width","1");for(var f=0;f<exList.length;f++)if(h.append("rect").attr("x",function(v){return a.xScale(exList[f].getAttribute("start"))-a.xScale(v.getAttribute("start"))}).attr("y",15).attr("rx",1).attr("ry",1).attr("height",
10).attr("width",function(v){v=a.xScale(exList[f].getAttribute("stop"))-a.xScale(exList[f].getAttribute("start"));0<a.minFeatureWidth&&v<a.minFeatureWidth&&(v=a.minFeatureWidth);return v}).attr("id",function(v,y){var w=a.idPrefix+"Ex"+exList[f].getAttribute("ID");null==exList[f].getAttribute("ID")&&(w=a.idPrefix+"Ex"+v.getAttribute("ID")+"_"+f);return w}).style("fill",a.color).style("cursor","pointer"),0<f){var g=a.xScale(exList[f-1].getAttribute("stop"))-a.xScale(e.getAttribute("start")),l=a.xScale(exList[f].getAttribute("start"))-
a.xScale(e.getAttribute("start"));h.append("line").attr("x1",g).attr("x2",l).attr("y1",20).attr("y2",20).attr("stroke",a.color).attr("stroke-width","2").attr("id",function(v,y){var w=a.idPrefix+"Int"+exList[f-1].getAttribute("ID")+"_"+exList[f].getAttribute("ID");null==exList[f].getAttribute("ID")&&(w=a.idPrefix+"Int"+v.getAttribute("ID")+"_"+(f-1)+"_"+f);return w});var n=">";"-"===e.getAttribute("strand")&&(n="<");var p=n;l-=g;var t=0;if(7>l)p="";else for(l-=7;8<l;)0==t?(p+=" ",t=1):(p+=n,t=0),l-=
7;h.append("svg:text").attr("id",function(v){var y=a.idPrefix+"IntTxt"+exList[f-1].getAttribute("ID")+"_"+exList[f].getAttribute("ID");null==exList[f].getAttribute("ID")&&(y=a.idPrefix+"IntTxt"+v.getAttribute("ID")+"_"+(f-1)+"_"+f);return y}).attr("y",15).attr("dx",g+1).attr("dy","11").style("pointer-events","none").style("opacity","0.5").style("fill",a.color).style("font-size","16px").text(p)}};a.calcXLine=function(e,c,h,f,g){h*=a.xCirLineWidth;return 0<e.length?a.xScale(e[c].getAttribute(f))-g+
h:0+h};a.redraw=function(){if(a.prevDensity!=a.density)a.draw(a.data);else{a.yMaxArr=[];a.yArr=[];a.yArr[0]=[];for(var e=0;e<a.gsvg.width;e++)a.yMaxArr[e]=0,a.yArr[0][e]=0;a.trackYMax=0;d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g."+a.idPrefix+"trx"+a.gsvg.levelNumber).attr("transform",function(c,h){return"translate("+a.xScale(c.getAttribute("start"))+","+a.calcY(parseInt(c.getAttribute("start"),10),parseInt(c.getAttribute("stop"),10),h)+")"}).each(function(c,h){minStart=a.xScale(c.getAttribute("start"));
maxEnd=a.xScale(c.getAttribute("stop"));var f=getAllChildrenByName(getFirstChildByName(c,a.xmlTagBlockElem+"List"),a.xmlTagBlockElem);a.svg.select("#l"+c.getAttribute("ID")+"_x1").attr("x1",function(){return a.calcXLine(f,0,-1,"start",minStart)}).attr("x2",function(){return a.calcXLine(f,0,-1,"start",minStart)});a.svg.select("#l"+c.getAttribute("ID")+"_x2").attr("x1",function(){return a.calcXLine(f,f.length-1,1,"stop",minStart)}).attr("x2",function(){return a.calcXLine(f,f.length-1,1,"stop",minStart)});
a.svg.select("#l"+c.getAttribute("ID")+"_x3").attr("x1",function(){return a.calcXLine(f,0,-1,"start",minStart)}).attr("x2",function(){return a.calcXLine(f,f.length-1,1,"stop",minStart)});a.svg.select("#l"+c.getAttribute("ID")+"_x4").attr("x1",function(){return a.calcXLine(f,0,-1,"start",minStart)}).attr("x2",function(){return a.calcXLine(f,0,0,"start",minStart)});a.svg.select("#l"+c.getAttribute("ID")+"_x5").attr("x1",function(){return a.calcXLine(f,f.length-1,0,"stop",minStart)}).attr("x2",function(){return a.calcXLine(f,
f.length-1,1,"stop",minStart)});for(var g=0;g<f.length;g++){var l=a.idPrefix+"Ex"+f[g].getAttribute("ID");null==f[g].getAttribute("ID")&&(l=a.idPrefix+"Ex"+c.getAttribute("ID")+"_"+g);a.svg.select("g#"+a.idPrefix+"tx"+c.getAttribute("ID")+" rect#"+l).attr("x",function(w){return a.xScale(f[g].getAttribute("start"))-a.xScale(c.getAttribute("start"))}).attr("width",function(w){return a.xScale(f[g].getAttribute("stop"))-a.xScale(f[g].getAttribute("start"))});if(0<g){l=">";"-"===c.getAttribute("strand")&&
(l="<");var n=l,p=a.xScale(f[g-1].getAttribute("stop"))-a.xScale(c.getAttribute("start")),t=a.xScale(f[g].getAttribute("start"))-a.xScale(c.getAttribute("start")),v=t-p,y=0;if(7>v)n="";else for(v-=7;8<v;)0==y?(n+=" ",y=1):(n+=l,y=0),v-=7;l=f[g-1].getAttribute("ID")+"_"+f[g].getAttribute("ID");null==f[g].getAttribute("ID")&&(l=c.getAttribute("ID")+"_"+(g-1)+"_"+g);a.svg.select("g#"+a.idPrefix+"tx"+c.getAttribute("ID")+" line#"+a.idPrefix+"Int"+l).attr("x1",p).attr("x2",t);a.svg.select("g#"+a.idPrefix+
"tx"+c.getAttribute("ID")+" #"+a.idPrefix+"IntTxt"+l).attr("dx",p+1).text(n)}}});1==a.density?a.svg.attr("height",40):2==a.density?a.svg.attr("height",25*(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g."+a.idPrefix+"trx"+a.gsvg.levelNumber).size()+1)):3==a.density&&a.svg.attr("height",25*(a.trackYMax+1));a.redrawSelectedArea()}};a.updateFullData=function(e,c){if(a.updateControl==e){a.updateControl=e+1;var h=a.xScale.domain()[0],f=a.xScale.domain()[1];d3.xml(dataPrefix+"tmpData/browserCache/"+
genomeVer+"/regionData/"+a.gsvg.folderName+"/"+a.trackClass+".xml",function(g,l){if(g){console.log(g);if(0==e||1==c){var n="/"+pathPrefix;pathPrefix||(n="");$.ajax({url:n+"generateTrackXML.jsp",type:"GET",cache:!1,async:!0,data:{chromosome:chr,minCoord:h,maxCoord:f,folder:a.gsvg.folderName,track:a.trackClass,myOrganism:organism,genomeVer:genomeVer},dataType:"json",success:function(p){gtag("event","generateTrackCustomTranscript",{event_category:"browser"})},error:function(p,t,v){console.log(v)}})}3>
e?(n=1E4,1==e&&(n=15E3),setTimeout(function(){a.updateFullData(e+1,0)},n)):(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+a.trackClass),d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).attr("height",15),a.gsvg.addTrackErrorRemove(a.svg,"#Level"+a.gsvg.levelNumber+a.trackClass),a.hideLoading())}else n=l.documentElement.getElementsByTagName(a.xmlTag),a.draw(n),a.hideLoading(),a.updateControl=0})}};a.updateSettingsFromUI=function(){0<
$("#"+a.trackClass+"Dense"+a.level+"Select").length&&(a.density=$("#"+a.trackClass+"Dense"+a.level+"Select").val());0<$("#"+a.trackClass+a.level+"colorSelect").length&&(a.colorBy=$("#"+a.trackClass+a.level+"colorSelect").val())};a.generateSettingsDiv=function(e){var c=trackInfo[a.trackClass];a.savePrevious();d3.select(e).select("table").select("tbody").html("");if(0<c.Controls.length&&"null"!=c.Controls){var h=(new String(c.Controls)).split(",");e=d3.select(e).select("table").select("tbody");e.append("tr").append("td").style("font-weight",
"bold").html("Track Settings: "+c.Name);for(c=0;c<h.length;c++)if("undefined"!==typeof h[c]&&""!=h[c]){var f=h[c].split(";"),g=e.append("tr").append("td"),l=f[0].substr(5);3<f.length&&0==f[3].indexOf("Default=")&&f[3].substr(8);if(0==f[1].toLowerCase().indexOf("select")){g.append("text").text(l+": ");l=f[1].split(":");f=f[2].split("}");var n=a.trackClass+"Dense"+a.level+"Select";"colorSelect"==l[1]&&(n=a.trackClass+a.level+"colorSelect");g=g.append("select").attr("id",n).attr("name",l[1]);for(l=0;l<
f.length;l++){var p=f[l].substr(1).split(":");if(2==p.length){var t=g.append("option").attr("value",p[1]).text(p[0]);(-1<n.indexOf("Dense")&&p[1]==a.density||-1<n.indexOf("colorSelect")&&p[1]==a.colorBy)&&t.attr("selected","selected")}}d3.select("select#"+n).on("change",function(){"Score"==$(this).val()?$("div."+a.trackClass+"Scale"+a.level).show():"Color"==$(this).val()&&$("div."+a.trackClass+"Scale"+a.level).hide();a.updateSettingsFromUI();a.draw(a.data)})}else 0==f[1].toLowerCase().indexOf("txt")&&
(g=0==$("#colorTrack"+a.level).size()?g.append("div").attr("class",a.trackClass+"Scale"+a.level).style("display","none"):d3.select("#"+a.trackClass+"Scale"+a.level),g.append("text").text(l+": "),l=f[1].split(":"),f=f[2].split("}"),f="Data",n="text",p=a.minValue,t=a.maxValue,"color"==l[1]&&(n=f="Color",p=a.minColor,t=a.maxColor),g.append("input").attr("type",n).attr("id",a.trackClass+"min"+f+a.level).attr("class",l[1]).style("margin-left","5px").attr("value",p),g.append("text").text(" - "),g.append("input").attr("type",
n).attr("id",a.trackClass+"max"+f+a.level).attr("class",l[1]).style("margin-left","5px").attr("value",t),"Color"==f&&(testIE||testSafari)?($("#"+a.trackClass+"min"+f+a.level).spectrum({change:function(v){a.updateSettingsFromUI();a.draw(a.data)}}),$("#"+a.trackClass+"max"+f+a.level).spectrum({change:function(v){a.updateSettingsFromUI();a.draw(a.data)}})):($("input#"+a.trackClass+"min"+f+a.level).on("change",function(){a.updateSettingsFromUI();a.draw(a.data)}),$("input#"+a.trackClass+"max"+f+a.level).on("change",
function(){a.updateSettingsFromUI();a.draw(a.data)})))}"Score"==$("#"+a.trackClass+a.level+"colorSelect").val()?$("div."+a.trackClass+"Scale"+a.level).show():"Color"==$("#"+a.trackClass+a.level+"colorSelect").val()&&$("div."+a.trackClass+"Scale"+a.level).hide();h=e.append("tr").append("td");h.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");a.gsvg.removeTrack(a.trackClass);
var v=svgList[a.gsvg.levelNumber].currentView.ViewID,y=viewMenu[a.gsvg.levelNumber].findTrackByClass(a.trackClass,v);y=viewMenu[a.gsvg.levelNumber].findTrackIndexWithViewID(y.TrackID,v);viewMenu[a.gsvg.levelNumber].removeTrackWithIDIdx(y,v)});h.append("input").attr("type","button").attr("value","Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")});h.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left",
"5px").on("click",function(){a.revertPrevious();a.draw(a.data);$("#trackSettingDialog").fadeOut("fast")})}else e=d3.select(e).select("table").select("tbody"),e.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name),e.append("tr").append("td").html("Sorry no settings for this track."),h=e.append("tr").append("td"),h.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")}),
h.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")})};a.generateTrackSettingString=function(){return a.trackClass+","+a.density+","+a.colorBy+","+a.minValue+","+a.maxValue+","+a.minColor+","+a.maxColor+";"};a.updateFullData(0,0);a.redrawLegend=function(){a.drawLegend([{color:"#DD9C56",label:"All"},{color:"#0f4c75",label:"Predicted(Multi)"},{color:"#3282b8",label:"Predicted(Single)"},
{color:"#5D576B",label:"Array"},{color:"#7A9D98",label:"Array/Predicted"}])};return a}window.GenomeSVG=GenomeSVG;var reportSelectedTrack=null,loadedTrackTable=null,regionDetailLoaded={};$(document).on("click","span.detailMenu",function(q){q=$(this).attr("name");var m=$("span.detailMenu.selected").attr("name");$("div#"+m).hide();$("span.detailMenu.selected").removeClass("selected");$("span[name='"+q+"']").addClass("selected");$("div#"+q).show();if("undefined"!==typeof svgList[0]){m=svgList[0].xScale.domain()[0];var r=svgList[0].xScale.domain()[1];loadRegionReport(q,chr,m,r)}});
function loadRegionReport(q,m,r,u){m=m+":"+r+"-"+u;"regionTable"===q&&(m=m+":"+reportSelectedTrack);regionDetailLoaded[q]&&regionDetailLoaded[q]===m?"regionWGCNAEQTL"===q&&""===$("div#regionWGCNAEQTL").html()&&loadRegionWGCNA():("regionTable"==q&&null!=reportSelectedTrack?loadTrackTable():"regionEQTLTable"==q?($("div#regionEQTLTable").html('<span style="text-align:center;width:100%;"><img src="web/images/ucsc-loading.gif"><BR>Loading...</span>'),setTimeout(function(){loadEQTLTable()},750)):"regionWGCNAEQTL"==
q&&loadRegionWGCNA(),regionDetailLoaded[q]=m);gtag("event",q,{event_category:"loadRegionReport"})}
function loadTrackTable(){var q=svgList[0].xScale.domain()[0],m=svgList[0].xScale.domain()[1],r=chr+":"+minCoord+"-"+maxCoord+":"+reportSelectedTrack.trackClass;loadedTrackTable&&loadedTrackTable===r||(loadedTrackTable=r,r="",q={species:organism,minCoord:q,maxCoord:m,chromosome:chr,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,forwardPvalueCutoff:forwardPValueCutoff,folderName:regionfolderName,genomeVer:genomeVer,track:reportSelectedTrack.trackClass},-1<reportSelectedTrack.trackClass.indexOf("noncoding")?
(q.type="noncoding",q.source="ensembl",-1<reportSelectedTrack.trackClass.indexOf("brain")&&(q.source="brain"),r="web/GeneCentric/geneTable.jsp"):-1<reportSelectedTrack.trackClass.indexOf("coding")?(r="web/GeneCentric/geneTable.jsp",q.type="coding",q.source="ensembl",-1<reportSelectedTrack.trackClass.indexOf("brain")&&(q.source="brain")):"liverTotal"===reportSelectedTrack.trackClass||"heartTotal"===reportSelectedTrack.trackClass||"brainTotal"===reportSelectedTrack.trackClass||"mergedTotal"===reportSelectedTrack.trackClass?
(r="web/GeneCentric/geneTable.jsp",q.type="all",q.source="liver","heartTotal"===reportSelectedTrack.trackClass?q.source="heart":"brainTotal"===reportSelectedTrack.trackClass?q.source="brain":"mergedTotal"===reportSelectedTrack.trackClass&&(q.source="merged")):-1<reportSelectedTrack.trackClass.indexOf("smallnc")?(q.source="ensembl",-1<reportSelectedTrack.trackClass.indexOf("brain")?q.source="brain":-1<reportSelectedTrack.trackClass.indexOf("heart")&&(q.source="heart"),-1<reportSelectedTrack.trackClass.indexOf("liver")&&
(q.source="liver"),r="web/GeneCentric/smallGeneTable.jsp"):-1<(new String(reportSelectedTrack.trackClass)).indexOf("snp")||"qtl"===reportSelectedTrack.trackClass&&(r="web/GeneCentric/bqtlTable.jsp"),r&&loadDivWithPage("div#regionTable",r,!1,q,'<span style="text-align:center;width:100%;"><img src="web/images/ucsc-loading.gif"><BR>Loading...</span>'));gtag("event",reportSelectedTrack.trackClass,{event_category:"loadTrackTable"})}
function loadEQTLTable(){var q=svgList[0].xScale.domain()[0],m=svgList[0].xScale.domain()[1];transcriptome=$("#transriptome").val();cisOnly=$("#cisTrans").val();pValueCutoff=$("#pvalueCutoffSelect2").val();loadDivWithPage("div#regionEQTLTable","web/GeneCentric/regionEQTLTableSeq.jsp",!1,{species:organism,minCoord:q,maxCoord:m,chromosome:chr,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,pValueCutoff:pValueCutoff,folderName:regionfolderName,genomeVer:genomeVer,transcriptome:transcriptome,cisOnly:cisOnly},
'<span style="text-align:center;width:100%;"><img src="web/images/ucsc-loading.gif"><BR>Loading...</span>');gtag("event","eQTLTable",{event_category:"loadEQTLTable"})}
function loadRegionWGCNA(){$("div#geneWGCNA").html("");var q=svgList[0].xScale.domain()[0],m=svgList[0].xScale.domain()[1];loadDivWithPage("div#regionWGCNAEQTL","web/GeneCentric/wgcnaGene.jsp",!0,{region:chr+":"+q+"-"+m},'<span style="text-align:center;width:100%;"><img src="web/images/ucsc-loading.gif"><BR>Loading...</span>');gtag("event","wgcna",{event_category:"loadWGCNA"})}
function loadEQTLTableWParams(q,m,r,u,d){q=svgList[0].xScale.domain()[0];u=svgList[0].xScale.domain()[1];transcriptome=$("#transriptome").val();cisOnly=$("#cisTrans").val();pValueCutoff=$("#pvalueCutoffSelect2").val();loadDivWithPage("div#regionEQTLTable","web/GeneCentric/regionEQTLTableSeq.jsp",!1,{genomeVer:genomeVer,species:organism,minCoord:q,maxCoord:u,chromosome:chr,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,pValueCutoff:pValueCutoff,tissues:r,chromosomes:m,folderName:regionfolderName,
transcriptome:transcriptome,cisOnly:cisOnly},'<span style="text-align:center;width:100%;"><img src="web/images/ucsc-loading.gif"><BR>Loading...</span>');gtag("event","eqtlwparams",{event_category:"loadEQTLTableWParams"})}
function loadDivWithPage(q,m,r,u,d){$(q).html(d);$.ajax({url:m,type:"GET",cache:!1,data:u,dataType:"html",async:!0,success:function(b){$(q).html(b);r&&setTimeout(function(){$("html, body").animate({scrollTop:$(q).offset().top},200)},300)},error:function(b,a,e){$(q).html('<span style="color:#FF0000;">An error occurred generating this page.  Please try back later.</span>')}})}function trKey(q){var m="";q&&(m=q.trackClass);return m}
function DisplayRegionReport(){if(0<d3.select("#collapsableReportList").size()){var q=svgList[0].trackList;if(reportSelectedTrack)for(var m=0;m<q.length&&!reportSelectedTrack;m++)q[m]&&q[m].getDisplayedData&&(reportSelectedTrack=q[m]);q=d3.select("#collapsableReportList").selectAll("li.report").data(q,trKey).html(function(u){var d="";u&&u.getDisplayedData&&(d=u.getDisplayedData(),d=u.label+": "+d.length);return d});q.enter().append("li").attr("class",function(u){return u?"report "+u.trackClass:"report"}).html(function(u){var d=
"";u&&u.getDisplayedData&&(d=u.getDisplayedData(),d=u.label+": "+d.length);return d}).on("click",displayDetailedView);q.exit().remove();!$("div#collapsableReport").is(":hidden")&&reportSelectedTrack&&displayDetailedView(reportSelectedTrack)}q=$("span.detailMenu.selected").attr("name");m=svgList[0].xScale.domain()[0];var r=svgList[0].xScale.domain()[1];loadRegionReport(q,chr,m,r);gtag("event","regionReport",{event_category:"loadRegionReport"})}
function displayDetailedView(q){reportSelectedTrack=q;$("li.report").removeClass("selected");$("li."+q.trackClass).addClass("selected");q.displayBreakDown&&setTimeout(function(){$("div#trackGraph").html("");q.displayBreakDown("div#collapsableReport div#trackGraph")},50);var m=new String(q.trackClass);-1<m.indexOf("coding")||-1<m.indexOf("noncoding")||-1<m.indexOf("smallnc")||-1<m.indexOf("liverTotal")||-1<m.indexOf("heartTotal")||-1<m.indexOf("brainTotal")||-1<m.indexOf("mergedTotal")||"qtl"==m?($("#regionTableSubHeader").show(),
$("#regionTable").show()):($("#regionTableSubHeader").hide(),$("#regionTable").hide());$("div#regionTable").is(":hidden")||loadTrackTable();gtag("event",q,{event_category:"loaddetailedView"})}function DisplaySelectedDetailReport(q,m){loadDivWithPage("div#selectedReport",q,!1,m,'<span style="text-align:center;width:100%;"><img src="web/images/ucsc-loading.gif"><BR>Loading...</span>')};function ViewMenu(q){var m={};m.level=q;m.viewList=[];m.selectedTrackSetting=0;m.previewLevel=100;m.previewSVG=NaN;m.curOrg=(new String(organism)).toUpperCase();m.initialized=0;m.generatePreview=function(r){$("div#previewOuter"+m.level+" div#previewContent").html("");var u=(new String(organism)).toUpperCase();if("AA"===r.Organism||r.Organism===u){u=svgList[m.level].xScale.domain()[0];var d=svgList[m.level].xScale.domain()[1];m.previewSVG=toolTipSVG("div#previewOuter"+m.level+" div#previewContent",
555,u,d,m.previewLevel,chr,svgList[m.level].type);$("div#ScrollLevel"+m.previewLevel).css("overflow","auto").css("max-height","360px");if(r=m.generateSettingsString(r))loadStateFromString(r,"",m.previewLevel,m.previewSVG),m.previewSVG.updateData(),m.previewSVG.updateFullData()}else $("div#previewOuter"+m.level+" div#previewContent").html("No Preview Available: The current organism doesn't match the tracks included in this view.")};m.removeTrackWithID=function(r){r=m.findTrackIndex(r);var u=m.findSelectedView().ViewID;
m.removeTrackWithIDIdx(r,u);gtag("event","deleteTrack",{event_category:"BrowserViews"})};m.removeTrackWithIDIdx=function(r,u){var d=m.findViewWithID(u),b=m.findViewIndexByID(u);"undefined"!==typeof d&&"undefined"!==typeof d.TrackList&&(d.TrackList.splice(r,1),m.generateTrackList(d),m.findSelectedView().modified=1,m.generateViewList(),m.generatePreview(d),$("#viewSelect"+m.level).prop("selectedIndex",b))};m.generateTrackList=function(r){var u=[];d3.select("table#trackListTbl"+m.level).select("tbody").selectAll("tr").remove();
if("undefined"!==typeof r.TrackList)for(var d=0;d<r.TrackList.length;d++)"AA"!==r.TrackList[d].Organism&&r.TrackList[d].Organism!==m.curOrg||u.push(r.TrackList[d]);d3.select("table#trackListTbl"+m.level).select("tbody").selectAll("tr").data(u).enter().append("tr").attr("class",function(b,a){return 0===a%2?"even":"odd"}).attr("id",function(b){return"trk"+b.TrackID}).each(function(b,a){var e='<img src="'+iconPath+'grab_flat.png" style="cursor: move; cursor: -webkit-grab; cursor: -moz-grab; " class="handle'+
m.level+'">';d3.select(this).append("td").attr("class","ind").html(e+(a+1));e='  <span class="listtooltip'+m.level+'" title= "'+b.Description+'"><img src="'+iconPath+'info.gif"></span>';d3.select(this).append("td").html(b.Name+e);e="";"AA"!==b.Organism&&(e=b.Organism,"RN"===e?e="Rat":"MM"===e&&(e="Mouse"),e+=" only");d3.select(this).append("td").html(e);e='<span class="moveUp'+m.level+'" name="'+b.TrackID+'" style="cursor:pointer;" ><img src="'+iconPath+'up_flat.png"></span>';e=e+' <span class="moveDown'+
m.level+'" name="'+b.TrackID+'" style="cursor:pointer;"><img src="'+iconPath+'down_flat.png"></span>';b.Controls&&5<b.Controls.length&&(e=e+'&nbsp&nbsp&nbsp<span class="trackSetting'+m.level+'" name="'+b.TrackID+'" style="cursor:pointer;"><img src="'+iconPath+'gear_flat.png"></span>');e=e+'&nbsp&nbsp&nbsp<span class="delete'+m.level+'" name="'+b.TrackID+'" style="cursor:pointer;"><img src="'+iconPath+'del_flat.png"></span>';d3.select(this).append("td").html(e);d3.select("table#trackListTbl"+m.level).selectAll(".trackSetting"+
m.level).on("click",function(){var c=d3.select(this).attr("name");c!==m.selectedTrackSetting?(m.previewSVG.getTrack(m.findTrack(c).TrackClass).generateSettingsDiv("div#trackSettingContent"),m.selectedTrackSetting=c,c=$(this).position(),$("#trackSettingDialog").css("top",c.top+240).css("left",$(window).width()-415),$("#trackSettingDialog").fadeIn("fast")):$("#trackSettingDialog").fadeOut("fast")}).on("mouseover",function(){$("#controlInfo"+m.level).html("Click to edit track settings.")}).on("mouseout",
function(){$("#controlInfo"+m.level).html("")});d3.select("table#trackListTbl"+m.level).selectAll(".moveUp"+m.level).on("click",function(){var c=$(this).attr("name");$("tr#trk"+c).insertBefore($("table#trackListTbl"+m.level+" tbody tr:first"));m.findSelectedView().modified=1;m.updateTrackNumber("",$("tr#trk"+c))}).on("mouseover",function(){$("#controlInfo"+m.level).html("Click to move the track to the top of the list.")}).on("mouseout",function(){$("#controlInfo"+m.level).html("")});d3.select("table#trackListTbl"+
m.level).selectAll(".moveDown"+m.level).on("click",function(){var c=$(this).attr("name");$("tr#trk"+c).insertAfter($("table#trackListTbl"+m.level+" tbody tr:last"));m.findSelectedView().modified=1;m.updateTrackNumber("",$("tr#trk"+c))}).on("mouseover",function(){$("#controlInfo"+m.level).html("Click to move the track to the end of the list.")}).on("mouseout",function(){$("#controlInfo"+m.level).html("")});d3.select("table#trackListTbl"+m.level).selectAll(".delete"+m.level).on("click",function(){var c=
d3.select(this).attr("name");m.removeTrackWithID(c)}).on("mouseover",function(){$("#controlInfo"+m.level).html("Click to remove the track from the view.")}).on("mouseout",function(){$("#controlInfo"+m.level).html("")})});$("#trackListTbl"+m.level+" tbody").sortable({handle:".handle"+m.level,stop:m.updateTrackNumber}).disableSelection();$(".listtooltip"+m.level).tooltipster({position:"top-right",maxWidth:250,offsetX:10,offsetY:5,contentAsHTML:!0,interactive:!0,interactiveTolerance:350});gtag("event",
"generateTrackList",{event_category:"BrowserViews"})};m.applyView=function(){var r=m.findSelectedView(),u=m.generateSettingStringFromUI();m.setupImage(u,r);$("div.viewsLevel"+m.level).hide();$("div.trackLevel"+m.level).hide();u="/"+pathPrefix;"db"===r.Source&&(pathPrefix||(u=""),$.ajax({url:u+"addBrowserCount.jsp",type:"GET",cache:!1,data:{viewID:r.ViewID},dataType:"json",success:function(d){},error:function(d,b,a){},async:!0}));gtag("event","applyView",{event_category:"BrowserViews"})};m.applySelectedView=
function(r){for(var u=NaN,d=-1,b=0;b<m.filterList.length&&isNaN(u);b++)m.filterList[b].ViewID===r&&(u=m.filterList[b],d=b);r=m.generateSettingStringFromView(u);m.setupImage(r,u);$("#viewSelect"+m.level).prop("selectedIndex",d);m.selectChange();gtag("event","applySelectedView",{event_category:"BrowserViews"})};m.setupImage=function(r,u){svgList[m.level].removeAllTracks();svgList[m.level].currentView=u;svgViewIDList[m.level]=u.ViewID;loadStateFromString(r,u.imgSettings,m.level,svgList[m.level]);$("span#viewLbl"+
m.level).html("View: "+u.Name);0===u.UserID?($("li#menusaveView"+m.level).addClass("ui-state-disabled"),$("li#menudeleteView"+m.level).addClass("ui-state-disabled")):($("li#menusaveView"+m.level).removeClass("ui-state-disabled"),$("li#menudeleteView"+m.level).removeClass("ui-state-disabled"))};m.updateTrackNumber=function(r,u){$("td.ind",$("table#trackListTbl"+m.level)).each(function(b){var a='<img src="'+iconPath+'grab_flat.png" style="cursor: move; cursor: -webkit-grab; cursor: -moz-grab; " class="handle'+
m.level+'">    ';$(this).html(a+(b+1))});d3.select("table#trackListTbl"+m.level).select("tbody").selectAll("tr").attr("class",function(b,a){return 0===a%2?"even":"odd"});var d=m.findSelectedView();m.generatePreview(d)};m.generateSettingsString=function(r){var u="";d3.select("table#trackListTbl"+m.level).select("tbody").selectAll("tr").each(function(d){u=u+d.TrackClass+","+d.Settings+";"});return u};m.generateSettingStringFromUI=function(){return m.previewSVG.generateSettingsString()};m.getViewData=
function(){var r="/"+pathPrefix;pathPrefix||(r="");$.ajax({url:r+"getBrowserViews.jsp",type:"GET",data:{genomeVer:genomeVer},dataType:"json",success:function(u){m.viewList=[];for(var d=0;d<u.length;d++)if("AA"===u[d].Organism||u[d].Organism===m.curOrg){for(var b=0,a=0;a<u[d].TrackList.length;a++){var e=u[d].TrackList[a];"AA"!==e.Organism&&e.Organism!==m.curOrg||b++}u[d].orgCount=b;m.viewList.push(u[d])}trackInfo&&m.readCookieViews();m.generateViewList();0===m.initialized&&0===m.level?setTimeout(function(){m.initialized=
1;m.applySelectedView($("#defaultView").val())},500):1===m.level&&(m.initialized=1,m.applySelectedView(svgViewIDList[m.level]));gtag("event","getViews",{event_category:"BrowserViews"})},error:function(u,d,b){}})};m.readCookieViews=function(){var r="";if(!0===isLocalStorage()){var u=localStorage.getItem("phenogenCustomViews");u&&(r=u)}else $.cookie("phenogenCustomViews")&&(r=$.cookie("phenogenCustomViews"));if(r&&-1<r.indexOf("<///>"))for(r=r.split("<///>"),u=0;u<r.length;u++){var d=r[u].split("</>"),
b={};for(g=0;g<d.length;g++){var a=d[g].split("=");if("TrackSettingList"===a[0]){a=a[1].split(";");b.TrackList=[];for(var e=0;e<a.length;e++)if(0<a[e].length){var c=a[e].substr(0,a[e].indexOf(",")),h=a[e].substr(a[e].indexOf(",")+1),f={};f.TrackClass=c;f.Settings=h;f.Order=e;b.TrackList.push(f)}}else 2>=a.length?b[a[0]]=a[1]:2<a.length&&(a=d[g].substr(0,d[g].indexOf("=")),e=d[g].substr(d[g].indexOf("=")+1),b[a]=e)}b.Source="local";if(3<d.length){for(var g=d=0;g<b.TrackList.length;g++){if(a=trackInfo[b.TrackList[g].TrackClass])b.TrackList[g].TrackID=
a.TrackID,b.TrackList[g].UserID=a.UserID,b.TrackList[g].Name=a.Name,b.TrackList[g].Description=a.Description,b.TrackList[g].Organism=a.Organism,b.TrackList[g].Controls=a.Controls;a=b.TrackList[g];"AA"!==a.Organism&&a.Organism!==m.curOrg||d++}b.orgCount=d;m.viewList.push(b)}}};m.generateSettingStringFromView=function(r){var u="";r=r.TrackList;if("undefined"!==typeof r)for(var d=0;d<r.length;d++)u=u+r[d].TrackClass+","+r[d].Settings+";";return u};m.selectChange=function(){var r="",u=m.findSelectedView();
"AA"!==u.Organism&&("RN"===u.Organism?r="<BR><BR>Available for Rat Only":"MM"===u.Organism&&(r="<BR><BR>Available for Mouse Only"));0===u.UserID?$("#deleteView"+m.level).hide():$("#deleteView"+m.level).show();$("div#descOuter"+m.level+" div#descContent").html(u.Description+r);m.generateTrackList(u);m.generatePreview(u);$(".trackLevel"+m.level).is(":visible")&&trackMenu[m.level].generateTrackTable();$("#trackSettingDialog").hide()};m.setSelectedView=function(r){$("#viewTypeSelect"+m.level).val("all");
m.generateViewList();r=m.findDisplayedIndex(r);$("#viewSelect"+m.level).prop("selectedIndex",r)};m.findSelectedView=function(){for(var r=$("#viewSelect"+m.level).val(),u=NaN,d=0;d<m.viewList.length&&isNaN(u);d++)m.viewList[d].ViewID===r&&(u=m.viewList[d]);return u};m.findViewWithID=function(r){for(var u=NaN,d=0;d<m.viewList.length&&isNaN(u);d++)m.viewList[d].ViewID===r&&(u=m.viewList[d]);return u};m.findViewIndexByID=function(r){for(var u=NaN,d=0;d<m.viewList.length&&isNaN(u);d++)m.viewList[d].ViewID===
r&&(u=d);return u};m.findSelectedViewIndex=function(){for(var r=$("#viewSelect"+m.level).val(),u=NaN,d=0;d<m.viewList.length&&isNaN(u);d++)m.viewList[d].ViewID===r&&(u=d);return u};m.findDisplayedIndex=function(r){for(var u=NaN,d=0;d<m.filterList.length&&isNaN(u);d++)m.filterList[d].ViewID===r&&(u=d);return u};m.findTrackByClass=function(r,u){for(var d=m.findViewWithID(u).TrackList,b=NaN,a=0;a<d.length&&isNaN(b);a++)d[a].TrackClass===r&&(b=d[a]);return b};m.findTrack=function(r){for(var u=m.findSelectedView().TrackList,
d=NaN,b=0;b<u.length&&isNaN(d);b++)u[b].TrackID===r&&(d=u[b]);return d};m.findTrackIndex=function(r){var u=m.findSelectedView().TrackList,d=NaN;if("undefined"!==typeof u)for(var b=0;b<u.length&&isNaN(d);b++)u[b].TrackID===r&&(d=b);return d};m.findTrackIndexWithViewID=function(r,u){for(var d=m.findViewWithID(u).TrackList,b=NaN,a=0;a<d.length&&isNaN(b);a++)d[a].TrackID===r&&(b=a);return b};m.setupControls=function(){-1<q&&($(".control"+m.level+"#addTrack"+m.level).on("click",function(){if($(".trackLevel"+
m.level).is(":visible"))$(".trackLevel"+m.level).fadeOut("fast");else{var r=$("div.viewsLevel"+m.level).position(),u=0;1200<=$(window).width()&&(u=-601);trackMenu[m.level].standalone=!1;$(".trackLevel"+m.level).css("top",r.top).css("left",r.left+u);r=m.findSelectedView();$(".trackLevel"+m.level+" span#selectedViewName").html(r.Name);$(".trackLevel"+m.level).fadeIn("fast");$("div#selectTrack"+m.level).show();$("div#addUsrTrack"+m.level).hide();$("div#addUsrTrack"+m.level).hide();$("div#deleteUsrTrack"+
m.level).hide();setTimeout(function(){trackMenu[m.level].generateTrackTable()},250)}}).on("mouseover",function(){$("#controlInfo"+m.level).html("Click to add a track to the current view.")}).on("mouseout",function(){$("#controlInfo"+m.level).html("")}),$(".control"+m.level+"#addView"+m.level).on("click",function(){$("div#nameView"+m.level).show();$("div#selection"+m.level).hide();$("span#viewMenuLbl"+m.level).text("Create View");$("input#createType"+m.level).val("blank");$("input#function"+m.level).val("create")}).on("mouseover",
function(){$("#topcontrolInfo"+m.level).html("Click to create a new view with no tracks.")}).on("mouseout",function(){$("#topcontrolInfo"+m.level).html("")}),$(".control"+m.level+"#copyView"+m.level).on("click",function(){$("div#nameView"+m.level).show();$("div#selection"+m.level).hide();$("span#viewMenuLbl"+m.level).text("Create View");$("input#createType"+m.level).val("copy");$("input#function"+m.level).val("create")}).on("mouseover",function(){$("#topcontrolInfo"+m.level).html("Click to create a new view copied from the selected view.")}).on("mouseout",
function(){$("#topcontrolInfo"+m.level).html("")}),$(".control"+m.level+"#saveView"+m.level).on("click",function(){var r=m.findSelectedView();0===r.UserID?($("#predefinedSaveAs"+m.level).show(),m.saveAsView(r,m.previewSVG)):m.saveView(r.ViewID,m.previewSVG,!1)}).on("mouseover",function(){$("#topcontrolInfo"+m.level).html("Click to save changes to the currently selected view.")}).on("mouseout",function(){$("#topcontrolInfo"+m.level).html("")}),$(".control"+m.level+"#deleteView"+m.level).on("click",
function(){var r=m.findSelectedViewIndex();m.confirmDeleteView(m.viewList[r])}).on("mouseover",function(){$("#topcontrolInfo"+m.level).html("Click to delete current view.")}).on("mouseout",function(){$("#topcontrolInfo"+m.level).html("")}),$(".applyView"+m.level).on("click",function(){m.applyView()}),d3.select("#viewTypeSelect"+m.level).on("change",m.generateViewList).on("mouseover",function(){$("#topcontrolInfo"+m.level).html("Change to filter the view list by category.")}).on("mouseout",function(){$("#topcontrolInfo"+
m.level).html("")}))};m.generateViewList=function(){d3.select("#viewSelect"+m.level).html("");m.filterList=[];for(var r=$("#viewTypeSelect"+m.level).val(),u=0;u<m.viewList.length;u++)("all"===r||"predefined"===r&&0===m.viewList[u].UserID||"custom"===r&&0!==m.viewList[u].UserID)&&m.filterList.push(m.viewList[u]);d3.select("#viewSelect"+m.level).on("change",m.selectChange).on("mouseover",function(){$("#topcontrolInfo"+m.level).html("Click on a view to select it and view preview/details.")}).on("mouseout",
function(){$("#topcontrolInfo"+m.level).html("")}).selectAll("option").data(m.filterList).enter().append("option").attr("value",function(d){return d.ViewID}).text(function(d){var b=d.Name;b=0===d.UserID?b+"      (Predefined)":b+"     (Custom"+("local"===d.Source?" local":" server")+")";b=b+"     ("+d.orgCount+" tracks)";"AA"!==d.Organism&&("RN"===d.Organism?b+="      (Rat Only)":"MM"===d.Organism&&(b+="     (Mouse Only)"));d.modified&&1===d.modified&&(b+="   (Modified)");return b})};m.addTrackToView=
function(r){var u=m.findSelectedView(),d=m.findSelectedViewIndex();u.TrackList.push(r);m.generateTrackList(u);m.generatePreview(u);m.generateViewList();$("#viewSelect"+m.level).prop("selectedIndex",d);ga&&ga("send","event","BrowserViews","addTrackToView")};m.addTrackToViewWithID=function(r,u){var d=m.findViewWithID(r);d.TrackList.push(u);m.generateTrackList(d);m.generatePreview(d);m.generateViewList()};m.createNewView=function(){$("#predefinedSaveAs"+m.level).hide();if(0<uid)if("create"===$("#function"+
m.level).val()){var r=$("input#viewNameTxt"+m.level).val(),u=$("#viewDescTxt"+m.level).val(),d=$("input#createType"+m.level).val(),b=-1;"copy"===d&&(b=m.findSelectedView().ViewID);var a="/"+pathPrefix;pathPrefix||(a="");$.ajax({url:a+"createBrowserViews.jsp",type:"GET",cache:!1,data:{name:r,description:u,type:d,copyFrom:b,organism:organism},dataType:"json",success:function(e){m.getViewData();$("div#nameView"+m.level).hide();$("div#selection"+m.level).show();$("span#viewMenuLbl"+m.level).html("Select/Edit Views")},
error:function(e,c,h){console.log(h)},async:!1})}else"saveAs"===$("#function"+m.level).val()&&(r=$("input#viewNameTxt"+m.level).val(),u=$("#viewDescTxt"+m.level).val(),a="/"+pathPrefix,pathPrefix||(a=""),$.ajax({url:a+"createBrowserViews.jsp",type:"GET",cache:!1,data:{name:r,description:u,type:"blank",copyFrom:-1,organism:organism},dataType:"json",success:function(e){m.saveView(e.viewID,m.saveAsImg,!1);$("div#nameView"+m.level).hide();$("div#selection"+m.level).show();$("span#viewMenuLbl"+m.level).html("Select/Edit Views")},
error:function(e,c,h){console.log(h)},async:!1}));else{r=$("input#viewNameTxt"+m.level).val();u=$("#viewDescTxt"+m.level).val();d=$("input#createType"+m.level).val();b="";b=$.cookie("JSESSIONID");a=(new Date).getTime();b="ViewID="+(b+"_"+a)+"</>UserID=-999</>Name="+r+"</>Description="+u+"</>Organism="+organism.toUpperCase()+"</>imgSettings=displaySelect0=700;</>TrackSettingList=";if("saveAs"===$("#function"+m.level).val())r=m.saveAsImg.generateSettingsString(),b+=r;else if("copy"===d){r="";u=m.findSelectedView().TrackList;
for(d=0;d<u.length;d++)r=r+u[d].TrackClass+","+u[d].Settings+";";b+=r}b+="<///>";!0===isLocalStorage()?(r=localStorage.getItem("phenogenCustomViews"))?localStorage.setItem("phenogenCustomViews",r+b):localStorage.setItem("phenogenCustomViews",b):(r="",r=$.cookie("phenogenCustomViews")?$.cookie("phenogenCustomViews")+b:b,$.cookie("phenogenCustomViews",r));m.getViewData();$("div#nameView"+m.level).hide();$("div#selection"+m.level).show();$("span#viewMenuLbl"+m.level).html("Select/Edit Views")}$("input#viewNameTxt"+
m.level).val("");$("#viewDescTxt"+m.level).val("");$("input#createType"+m.level).val("blank");getMainViewData(1);gtag("event","createView",{event_category:"BrowserViews"})};m.saveView=function(r,u,d){if(0<uid){u=u.generateSettingsString();var b="/"+pathPrefix;pathPrefix||(b="");0<r&&$.ajax({url:b+"updateBrowserView.jsp",type:"GET",cache:!1,data:{viewID:r,trackList:u},dataType:"json",success:function(h){m.getViewData()},error:function(h,f,g){console.log(g)},async:d})}else{d=b="";if(!0===isLocalStorage()){var a=
localStorage.getItem("phenogenCustomViews");a&&(b=a)}else $.cookie("phenogenCustomViews")&&(b=$.cookie("phenogenCustomViews"));b=b.split("<///>");for(a=0;a<b.length;a++)if(10<b[a].length)if(-1<b[a].indexOf("ViewID="+r)){var e=b[a].substr(0,b[a].indexOf("</>TrackSettingList=")),c=u.generateSettingsString();d=d+e+"</>TrackSettingList="+c+"<///>"}else d=d+b+"<///>";!0===isLocalStorage()?localStorage.setItem("phenogenCustomViews",d):$.cookie("phenogenCustomViews",d);m.getViewData()}getMainViewData(1);
gtag("event","saveView",{event_category:"BrowserViews"})};m.saveAsView=function(r,u){m.saveAs=r;m.saveAsImg=u;$("div#nameView"+m.level).show();$("div#selection"+m.level).hide();$("span#viewMenuLbl"+m.level).text("Save As...");$("input#createType"+m.level).val("blank");$("input#function"+m.level).val("saveAs");gtag("event","saveAsView",{event_category:"BrowserViews"})};m.confirmDeleteView=function(r){m.findSelectedView().ViewID!==r.ViewID&&m.setSelectedView(r.ViewID);0<r.UserID||-999===Number(r.UserID)?
($("div#selection"+m.level).hide(),$("#deleteViewName"+m.level).html(r.Name+"    ("+r.orgCount+" tracks)"),$("#confirmDeleteView"+m.level).show()):$("#topcontrolInfo"+m.level).html("This is a predefined view, you may not delete it.")};m.cancelDeleteView=function(){$("#confirmDeleteView"+m.level).hide();$("div#selection"+m.level).show()};m.deleteView=function(){var r=m.findSelectedViewIndex(),u=m.viewList[r];if("db"===u.Source){var d="/"+pathPrefix;pathPrefix||(d="");$.ajax({url:d+"deleteView.jsp",
type:"GET",data:{viewID:u.ViewID},dataType:"json",cache:!1,success:function(e){"Deleted Successfully"===e.status&&(m.viewList.splice(r,1),m.generateViewList());$("#topcontrolInfo"+m.level).html(e.status)},error:function(e,c,h){console.log(h);$("#topcontrolInfo"+m.level).html("There was an error deleting this view.")},async:!0})}else{var b="";d="";if(!0===isLocalStorage()){var a=localStorage.getItem("phenogenCustomViews");a&&(b=a)}else $.cookie("phenogenCustomViews")&&(b=$.cookie("phenogenCustomViews"));
b=b.split("<///>");for(a=0;a<b.length;a++)-1<b[a].indexOf("ViewID="+u.ViewID)||10<b[a].length&&(d=d+b[a]+"<///>");!0===isLocalStorage()?localStorage.setItem("phenogenCustomViews",d):$.cookie("phenogenCustomViews",d);m.viewList.splice(r,1);m.generateViewList()}$("#confirmDeleteView"+m.level).hide();$("div#selection"+m.level).show();$("#viewSelect"+m.level).prop("selectedIndex",0);m.selectChange();svgList[m.level].currentView.ViewID===u.ViewID&&m.applyView();getMainViewData(1);gtag("event","deleteView",
{event_category:"BrowserViews"})};m.cancelView=function(){$("div#nameView"+m.level).hide();$("div#selection"+m.level).show();$("#predefinedSaveAs"+m.level).hide();$("span#viewMenuLbl"+m.level).html("Select/Edit Views")};m.getViewData();m.setupControls();return m};function TrackMenu(q){var m={};m.level=q;m.trackList=[];m.previewLevel=101;m.previewSVG=NaN;m.dataInitialized=0;m.trackDataTable;m.generateTrackTable=function(){for(var r=$("#trackTypeSelect"+m.level).val(),u=[],d=0,b=0;b<m.trackList.length;b++)!("all"===r||"allpublic"===r&&0===m.trackList[b].UserID||"custom"===r&&0!==m.trackList[b].UserID||"genome"===r&&"Genome"===m.trackList[b].GenericCategory||"trxome"===r&&"Transcriptome"===m.trackList[b].GenericCategory)||"AA"!==m.trackList[b].Organism.toUpperCase()&&
m.trackList[b].Organism.toUpperCase()!==organism.toUpperCase()&&m.trackList[b].Organism.toUpperCase()!==organism.toUpperCase()&&m.trackList[b].Organism.substring(0,2).toUpperCase()!==organism.toUpperCase()||0!==$("table#trackListTbl"+m.level+" tr#trk"+m.trackList[b].TrackID).length||(u[d]=m.trackList[b],d++);try{$.fn.DataTable.isDataTable("table#trkSelList"+m.level)&&m.trackDataTable.destroy()}catch(a){}"custom"===r&&0===u.length?($("#noCustomTracks").show(),0===uid?$("#notSignedIn1").show():$("#notSignedIn1").hide()):
($("#noCustomTracks").hide(),$("#notSignedIn1").hide());d3.select("table#trkSelList"+m.level).select("tbody").selectAll("tr").remove();d3.select("table#trkSelList"+m.level).select("tbody").selectAll("tr").data(u).enter().append("tr").attr("id",function(a){return"trk"+a.TrackID}).attr("class",function(a,e){var c="odd";0===e%2&&(c="even");return c}).each(function(a,e){var c="",h="";"local"===a.Source&&(h=" (Local)");0!==a.UserID&&(c=new String(a.SetupDate),c=c.substr(0,c.indexOf(":",c.indexOf(":")+
1)),c="<BR><BR>File:"+a.OriginalFile+"<BR><BR>Setup Date:"+c+"<BR><BR>Type:"+a.Type,"local"===a.Source&&(c+="<BR><BR>Local Track only available on this computer."));c='  <span class="trlisttooltip'+m.level+'" title= "'+a.Description+c+'"><img src="'+iconPath+'info.gif"></span>';d3.select(this).append("td").html(a.Name+h+c);h="";"RN"===a.Organism?h="Rat":"MM"===a.Organism&&(h="Mouse");c="Public";0!==a.UserID&&(c="Custom");d3.select(this).append("td").html(h);d3.select(this).append("td").html(a.GenericCategory);
d3.select(this).append("td").html(a.Category);d3.select(this).append("td").html(c)});$.fn.DataTable.isDataTable("table#trkSelList"+m.level)||(r=m.getInitTrackTableHeight(u),m.trackDataTable=$("table#trkSelList"+m.level).DataTable({bPaginate:!1,aaSorting:[[3,"asc"]],sScrollY:r,sDom:'<"rightSearch"fr><t>',columnDefs:[{width:"45%",targets:0}]}));m.trackDataTable.draw();$("td#selectedTrack"+m.level).hide();$("table#trkSelList"+m.level+" tbody").on("click","tr",function(){if(!$(this).hasClass("selected")){$("table#trkSelList"+
m.level+" tbody tr.selected").removeClass("selected");$(this).addClass("selected");$(this).attr("id");var a=m.findSelectedTrack(),e="Selected Track Name: "+a.Name+'  <span class="trInfotooltip'+m.level+'" title= "'+a.Description+'"><img src="'+iconPath+'info.gif"></span>';$("div#trackHeaderOuter"+m.level+" #trackHeaderContent").html(e);e=m.getTrackTableHeight(u);m.trackDataTable.settings()[0].oScroll.sy=e;try{m.trackDataTable.columns.adjust().draw()}catch(c){}$("#trkSelList"+m.level+"_wrapper div.dataTables_scroll div.dataTables_scrollBody").css("height",
e);$("td#selectedTrack"+m.level).show();$(".trInfotooltip"+m.level).tooltipster({position:"top-right",maxWidth:250,offsetX:10,offsetY:5,contentAsHTML:!0,interactive:!0,interactiveTolerance:350});m.generatePreview(a);(e=m.previewSVG.getTrack(a.TrackClass))&&e.generateSettingsDiv&&e.generateSettingsDiv("td#selectedTrack"+m.level);$("td#selectedTrack"+m.level+" #trackListTbl"+m.level+" tbody tr:first").remove();$("td#selectedTrack"+m.level+" #trackListTbl"+m.level+" tbody tr:last").remove();0!==a.UserID?
$("span#deleteCustomTrack"+m.level).show():$("span#deleteCustomTrack"+m.level).hide();e.updateSettingsFromUI()}});$(".trlisttooltip"+m.level).tooltipster({position:"top-right",maxWidth:250,offsetX:10,offsetY:5,contentAsHTML:!0,interactive:!0,interactiveTolerance:350})};m.getInitTrackTableHeight=function(r){var u="750px";0===r.length?u="30px":15>r.length&&(u=30*r.length+"px");return u};m.getTrackTableHeight=function(r){var u="300px";0===r.length?u="20px":10>r.length&&(u=30*r.length+"px");return u};
m.getTrackData=function(){var r="/"+pathPrefix;""===pathPrefix&&(r="");$.ajax({url:r+"getBrowserTracks.jsp",type:"GET",data:{genomeVer:genomeVer},dataType:"json",success:function(u){m.trackList=u;if(0===m.level)for(trackInfo=[],u=0;u<m.trackList.length;u++)trackInfo[m.trackList[u].TrackClass]=m.trackList[u];m.readCookieTracks();m.dataInitialized=1;m.generateTrackTable();trackMenu[m.level]&&trackMenu[m.level].readCookieViews&&(trackMenu[m.level].readCookieViews(),trackMenu[m.level].generateViewList())},
error:function(u,d,b){console.log(b)}})};m.readCookieTracks=function(){var r="";if(!0===isLocalStorage()){var u=localStorage.getItem("phenogenCustomTracks");u&&(r=u)}else $.cookie("phenogenCustomTracks")&&(r=$.cookie("phenogenCustomTracks"));if(r&&-1<r.indexOf("<;>"))for(r=r.split("<;>"),u=0;u<r.length;u++){var d=r[u].split("<->"),b={};for(k=0;k<d.length;k++){var a=d[k].split("=");if(2>=a.length)b[a[0]]=a[1];else if(2<a.length){a=d[k].substr(0,d[k].indexOf("="));var e=d[k].substr(d[k].indexOf("=")+
1);if("TrackID"===a||"TrackClass"===a)e=e.replace(/\./g,"_");b[a]=e}}b.Source="local";3<d.length&&(m.trackList.push(b),0===m.level&&(trackInfo[b.TrackClass]=b))}};m.findSelectedTrack=function(){var r=NaN;if(0<$("table#trkSelList"+m.level+" tbody tr.selected").length){var u=$("table#trkSelList"+m.level+" tbody tr.selected").attr("id");u=u.substr(3);for(var d=0;d<m.trackList.length&&isNaN(r);d++)m.trackList[d].TrackID===u&&(r=m.trackList[d])}return r};m.generateSettingsString=function(r){return r.TrackClass+
","+r.Settings+";"};m.generatePreview=function(r){$("div#trackPreviewOuter"+m.level+" div#trackPreviewContent").html("");var u=(new String(organism)).toUpperCase();if("AA"===r.Organism.substring(0,2)||r.Organism.substring(0,2)===u){u=svgList[m.level].xScale.domain()[0];var d=svgList[m.level].xScale.domain()[1];m.previewSVG=toolTipSVG("div#trackPreviewOuter"+m.level+" div#trackPreviewContent",565,u,d,m.previewLevel,chr,svgList[m.level].type);m.previewSVG.folderName=svgList[m.level].folderName;r=m.generateSettingsString(r);
loadStateFromString(r,"",m.previewLevel,m.previewSVG);m.previewSVG.updateData();m.previewSVG.updateFullData();$("div#trackPreviewContent div#ScrollLevel"+m.previewLevel).css("max-height","250px").css("overflow","auto")}else $("div#previewOuter"+m.level+" div#previewContent").html("No Preview Available: The current organism doesn't match the tracks included in this view.")};m.removeTrack=function(r){m.generateTrackTable()};m.confirmdeleteCustomTrack=function(){var r=m.findSelectedTrack();$("#deleteUsrTrack"+
m.level).show();$("#selectTrack"+m.level).hide();r="Name: <B>"+r.Name+"</B><BR>Description: <B>"+r.Description+"</B><BR>Original File: <B>"+r.OriginalFile+"</B><BR>Setup Date: <B>"+r.SetupDate+"</b>";$("span#customTrackInfo"+m.level).html(r);gtag("event","deleteCustomTrack",{event_category:"BrowserTracks"})};m.cancelDeleteTrack=function(){$("#deleteUsrTrack"+m.level).hide();$("#selectTrack"+m.level).show()};m.deleteTrack=function(){var r=m.findSelectedTrack();if("local"===r.Source){var u="TrackClass="+
r.TrackClass+"<->",d="";if(!0===isLocalStorage()){var b=localStorage.getItem("phenogenCustomTracks");b&&(d=b)}else $.cookie("phenogenCustomTracks")&&(d=$.cookie("phenogenCustomTracks"));if(d&&-1<d.indexOf("<;>")){var a="";d=d.split("<;>");for(b=0;b<d.length;b++)-1===d[b].indexOf(u)&&(a=a+d[b]+"<;>");u="/"+pathPrefix;pathPrefix||(u="");$.ajax({url:u+"removeCustomTrack.jsp",type:"GET",data:{trackID:r.TrackID},dataType:"json",success:function(e){!0===isLocalStorage()?localStorage.setItem("phenogenCustomTracks",
a):$.cookie("phenogenCustomTracks",a)},error:function(e,c,h){console.log(h)},async:!1})}}else"db"===r.Source&&(u="/"+pathPrefix,pathPrefix||(u=""),$.ajax({url:u+"deleteTrack.jsp",type:"GET",data:{trackID:r.TrackID},dataType:"json",success:function(e){"true"===e.success?$(".uploadStatus").html("<B>Track Setup Successfully</B>"):$(".uploadStatus").html("<B>Track Setup Failed</B>")},error:function(e,c,h){console.log(h)},async:!1}));m.getTrackData();$("#deleteUsrTrack"+m.level).hide();$("#selectTrack"+
m.level).show();m.generateTrackTable();gtag("event","deleteTrack",{event_category:"BrowserTracks"})};m.confirmUpload=function(){$("div#confirmUpload"+m.level).show();$("div#uploadBtn"+m.level).hide()};m.confirmBed=function(){$("input#hasconfirmBed"+m.level).val(1);m.createCustomTrack(m.level)};m.cancelUpload=function(){$("div#confirmUpload"+m.level).hide();$("div#confirmBed"+m.level).hide();$("div#uploadBtn"+m.level).show()};m.createCustomTrack=function(){$("div#confirmUpload"+m.level).hide();customTrackLevel=
m.level;var r=$("#usrtrkFileTypeSelect"+m.level).val();"bed"===r||"bg"===r?m.createUploadedCustomTrack():("bb"===r||"bw"===r)&&m.createRemoteCustomTrack();gtag("event","createCustomTrack",{event_category:"BrowserTracks"})};m.createUploadedCustomTrack=function(){var r=$("input#customUploadFile"+m.level)[0].files[0],u=$("#usrtrkFileTypeSelect"+m.level).val(),d=r.name,b=r.size/1024/1024;$(".uploadStatus").show();var a="";if(0<d.indexOf(".")){for(var e=d;-1<e.indexOf(".");)e=e.substr(e.indexOf(".")+1);
""!==e&&e!==d&&(a=e)}20>b?a!==u?"gz"===a||"tar"===a||"zip"===a||"exe"===a||"bin"===a?(setTimeout(function(){$("div#uploadBtn"+customTrackLevel).show();$(".progressInd").hide()},5E3),$(".uploadStatus").html("Error: Selected File Type is not supported.")):0===$("input#hasconfirmBed"+m.level).val()?$("div#confirmBed"+customTrackLevel).show():1===$("input#hasconfirmBed"+m.level).val()&&($("div#confirmBed"+customTrackLevel).hide(),m.createTrack(r)):m.createTrack(r):($("div#uploadBtn"+customTrackLevel).show(),
$(".progressInd").hide(),$(".uploadStatus").html("File is too large.  20MB is the current limit."))};m.createTrack=function(r){m.readFile(r)};m.createRemoteCustomTrack=function(){$(".uploadStatus").html("Setting up track...");$(".uploadStatus").show();var r=$("#customFileURL"+m.level).val(),u="",d=new Date;$.cookie("JSESSIONID")&&(u=$.cookie("JSESSIONID"),u=u+"_"+d.getTime());m.saveTrack(u,r)};m.saveTrack=function(r,u){var d=$("#usrtrkNameTxt"+m.level).val(),b=$("#usrtrkDescTxt"+m.level).val(),a=
$("#usrtrkOrgSelect"+m.level).val(),e=$("#usrtrkGenCatSelect"+m.level).val(),c=$("#usrtrkCatTxt"+m.level).val(),h="",f=$("#usrtrkFileTypeSelect"+m.level).val(),g="";if("bed"===f||"bg"===f)g=$("input#customUploadFile"+m.level)[0].files[0].name;var l="Color";0<$("#usrtrkColorSelect"+m.level).length&&(l=$("#usrtrkColorSelect"+m.level).val());if("Score"===l){var n="000000",p="FFFFFF",t=1,v=1E3;testIE||testSafari?(n=$("#usrtrkColorMin"+m.level).spectrum("get").toHexString(),p=$("#usrtrkColorMax"+m.level).spectrum("get").toHexString()):
(n=$("#usrtrkColorMin"+m.level).val(),p=$("#usrtrkColorMax"+m.level).val());n=n.substr(1);p=p.substr(1);t=$("#usrtrkScoreMinTxt"+m.level).val();v=$("#usrtrkScoreMaxTxt"+m.level).val()}"bed"===f?h="Name=View Density;Select:trackSelect:Dense:Select;{Dense:1}{Pack:3}{Full:2};Default=3,Name=Color by;Select:colorSelect::colorSelect;{Feature Defined:Color}{Score based scale:Score};Default="+l+",Name=Scale Range;Txt:tissuecbx;{min:1}{max:1000};Default="+t+":"+v+",Name=Color Range;Txt:color;{min:FFFFFF}{max:000000};Default="+
n+":"+p:"bg"===f?h="Name=View Density;Select:trackSelect:Dense:Select;{Dense:1}{Full:2};Default=1,Name=Scale Range;Slider:rangeslider;{min:1-1000}{max:1000-20000};Default=1:5000":"bw"===f?h="Name=View Density;Select:trackSelect:Dense:Select;{Dense:1}{Full:2};Default=1,Name=Scale Range;Slider:rangeslider;{min:1-1000}{max:1000-20000};Default=1:5000":"bb"===f&&(h="Name=View Density;Select:trackSelect:Dense:Select;{Dense:1}{Pack:3}{Full:2};Default=3,Name=Color by;Select:colorSelect::colorSelect;{Feature Defined:Color}{Score based scale:Score};Default="+
l+",Name=Scale Range;Txt:tissuecbx;{min:1}{max:1000};Default="+t+":"+v+",Name=Color Range;Txt:color;{min:FFFFFF}{max:000000};Default="+n+":"+p);r="custom"+r;0<uid?(l="/"+pathPrefix,pathPrefix||(l=""),$.ajax({url:l+"addTrack.jsp",type:"GET",data:{trackClass:r,trackName:d,trackDesc:b,trackOrg:a,genericCategory:e,category:c,controls:h,location:u,type:f,file:g},dataType:"json",success:function(y){"true"===y.success?$(".uploadStatus").html("<B>Track Setup Successfully</B>"):$(".uploadStatus").html("<B>Track Setup Failed</B>")},
error:function(y,w,A){console.log(A)},async:!1})):(l=new Date,d="TrackID="+r+"<->UserID=-999<->TrackClass="+r+"<->Name="+d+"<->Description="+b+"<->Organism="+a.toUpperCase(),d=d+"<->Settings=<->Order=0<->GenericCategory="+e+"<->Category="+c+"<->Controls="+h+"<->SetupDate="+l+"<->Type="+f+"<->OriginalFile="+g+"<->Location="+u,d=d+"<->genomeVer="+genomeVer,d+="<;>",!0===isLocalStorage()?((e=localStorage.getItem("phenogenCustomTracks"))&&(d=e+d),localStorage.setItem("phenogenCustomTracks",d)):($.cookie("phenogenCustomTracks")&&
(d=$.cookie("phenogenCustomTracks")+d),$.cookie("phenogenCustomTracks",d)),$(".uploadStatus").html("<B>Track Setup Successfully</B>"));$("div#finished"+m.level).show();$("input#customUploadFile"+m.level).val("");$("input#customURL"+m.level).val("");$("input#usrtrkNameTxt"+m.level).val("");$("#usrtrkDescTxt"+m.level).val("");$("input#usrtrkOrgSelect"+m.level).val("Rn");$("input#usrtrkGenCatSelect"+m.level).val("Genome");$("input#usrtrkCatTxt"+m.level).val("");$("#usrtrkColorSelect"+m.level).val("Color");
$("#customFileURL"+m.level).val("");m.getTrackData();gtag("event","saveTrack",{event_category:"BrowserTracks"})};m.readFile=function(r){var u=new FileReader;u.readAsText(r,"UTF-8");u.onload=m.sendFile};m.sendFile=function(r){$.ajax({url:pathPrefix+"trackUpload.jsp",type:"POST",contentType:"text/plain",xhr:function(){var u=$.ajaxSettings.xhr();u.upload.addEventListener("progress",m.progressHandlingFunction,!1);return u},data:r.target.result,processData:!1,cache:!1,dataType:"json",success:function(u){$(".uploadStatus").html("<B>Upload Completed Successfully</b>");
m.saveTrack(u.trackFile,u.trackFile);gtag("event","customTrackUploaded",{event_category:"BrowserTracks"})},error:function(u,d,b){console.log(b);$(".uploadStatus").html("Error:"+b);$("div#uploadBtn"+customTrackLevel).show()}})};m.progressHandlingFunction=function(r){$(".progressInd").show();$(".uploadStatus").html("Uploading...");r.lengthComputable&&$("progress").attr({value:r.loaded,max:r.total})};m.getTrackData();return m};$(window).resize(function(){"undefined"!==typeof wgcna&&("undefined"!==typeof wgcna.multiImage?wgcna.multiImage.draw():"undefined"!==typeof wgcna.singleImage&&wgcna.singleImage.draw())});function replaceDot(q){return q.replace(/\./g,"_")}function replaceUnderscore(q){return q.replace(/_/g,".")}function removeColon(q){return q.replace(/:/g,"")}
function WGCNABrowser(q,m,r,u,d,b){that={};that.singleID=q;that.region=m;that.dispType=u;that.viewType=d;that.geneList=r;that.moduleList=[];that.moduleGenes={};that.modules={};that.tissue=b;that.panel="";that.requests=0;that.skipGrey=1;that.chrLen=19;that.selSource="seq";that.version="5";that.moduleRequestList=[];that.modSelect="gene";that.modSelectCutoff=2;"Mm"===organism?(that.panel="ILS/ISS",that.wDSID=1):"Rn"===organism&&("rn5"===genomeVer?(that.panel="BNLx/SHR",that.chrLen=20,that.wDSID=2):(that.panel=
"BNLx/SHR",that.chrLen=20,"seq"===that.selSource?"5"===that.version?"Whole Brain"===b?that.wDSID=11:"Liver"===b&&(that.wDSID=12):"2"===that.version?"Whole Brain"===b?that.wDSID=8:"Liver"===b&&(that.wDSID=9):"Whole Brain"===b?that.wDSID=6:"Liver"===b&&(that.wDSID=7):"Whole Brain"===b?that.wDSID=3:"Heart"===b?that.wDSID=4:"Liver"===b&&(that.wDSID=5)));that.eQTLKey=function(a){return"Link_"+a.Snp};that.mirKey=function(a){return a.ID};that.modKey=function(a){return a.MODULE};that.removeInvalidIDChars=
function(a){"undefined"!==typeof a&&(-1<a.indexOf("*")&&(a=a.replace(/\*/g,"star")),-1<a.indexOf(" ")&&(a=a.replace(/\s/g,"_")),-1<a.indexOf(".")&&(a=a.replace(/\./g,"_")));return a};that.setup=function(){that.requestModuleList();that.createImageControls();that.createViewControls();that.createDataControls();$(".wgcnaControltooltip").tooltipster({position:"top-right",maxWidth:250,offsetX:5,offsetY:5,contentAsHTML:!0,interactive:!0,interactiveTolerance:350});gtag("event","setupWGCNA",{event_category:"setupWGCNA"})};
that.requestModuleList=function(){that.moduleGenes={};that.moduleList=[];that.modules={};var a=that.modSelect;"eQTL"==that.modSelect&&(a=a+":"+that.modSelectCutoff);$.ajax({url:pathPrefix+"getWGCNAModules.jsp",type:"GET",async:!0,data:{source:that.selSource,modFileType:that.viewtype,id:that.singleID,organism:organism,panel:that.panel,tissue:that.tissue,region:that.region,geneList:that.geneList,genomeVer:genomeVer,version:that.version,modSelection:a},dataType:"json",beforeSend:function(){$("#waitCircos").show();
for(var e=0;e<that.moduleRequestList.length;e++)that.moduleRequestList[e].abort();that.moduleRequestList=[];console.log(that.modSelect+":"+that.modSelectCutoff);console.log(a);console.log("request mod list:"+that.wDSID+":"+that.selSource)},success:function(e){$("#wgcnaGeneImage #message").hide();that.moduleList=[];0<e.length&&(1!==e.length||"grey"!==e[0].ModuleID)?setTimeout(function(){for(var c=0;c<e.length;c++)"grey"!==e[c].ModuleID&&(that.moduleList.push(e[c].ModuleID),that.requests++,that.requestModule(e[c].ModuleID),
"undefined"!==typeof e[c].GeneList&&(that.moduleGenes[e[c].ModuleID]=e[c].GeneList));that.refreshRegion(1E3);setTimeout(function(){$("html, body").animate({scrollTop:$("#multiWGCNAScroll").offset().top},100)},1200)},1):0===e.length?that.displayMessage("There are no transcripts with Affymetrix Probesets that represent this gene."):1===e.length&&"grey"===e[0].ModuleID&&that.displayMessage("Only the Grey module contains transcripts for this gene.  The Grey module contains all transcripts that did not have a high enough correlation with any other transcripts to be included in another module.");
gtag("event","requestModuleList",{event_category:"requestModuleList"})},error:function(e,c,h){}})};that.displayMessage=function(a){$("#waitCircos").hide();$("#wgcnaGeneImage #message").html("<BR><BR><h2>"+a+"</h2><BR><BR>").show()};that.refreshRegion=function(a){setTimeout(function(){that.createMultiWGCNAImage();0<that.requests?that.refreshRegion(2E3):1!==a&&(that.refreshRegion(1),$("#waitCircos").hide())},a)};that.requestModule=function(a,e){xhr=$.ajax({url:contextRoot+"tmpData/browserCache/"+genomeVer+
"/modules/ds"+that.wDSID+"/"+a+".json",type:"GET",async:!0,data:{},dataType:"json",success:function(c){console.log("success:"+contextRoot+"tmpData/browserCache/"+genomeVer+"/modules/ds"+that.wDSID+"/"+a+".json");setTimeout(function(){console.log("countingGeneInstances");console.log(a);if(0<that.singleID.length)that.countGeneInstance(that.singleID,c);else{var h=that.moduleGenes[a].split(",");c.GroupedGenes=h.length;that.countGeneInstance(that.moduleGenes[a],c)}that.modules[a]=c;that.requests--;e&&
e(a)},20);gtag("event",a,{event_category:"requestModule"})},error:function(c,h,f){console.log(f);that.requests--}});that.moduleRequestList.push(xhr)};that.scanFilter=function(a,e){var c=[];if(a)for(var h=0;h<a.length;h++)e(a[h])&&c.append(a[h]);return c};that.countGeneInstance=function(a,e){var c=e.TCList,h=0;e.selectGeneTC={};for(var f=0;f<c.length;f++)-1<a.indexOf(c[f].Gene.ID)&&h++;e.GeneCount=h};that.createImageControls=function(){that.imageBar=d3.select("#imageControl").append("span").style("float",
"left");that.imageBar.append("span").attr("class","saveImage control").style("display","inline-block").attr("id","saveImage").style("cursor","pointer").append("img").attr("src",contextRoot+"web/images/icons/savePic_dark.png").attr("pointer-events","all").attr("cursor","pointer").on("click",function(){var a="";if(that.singleImage){"eqtl"===that.viewType&&"eqtl"===that.singleImage.type?a=$("div#circos").html():"gene"===that.viewType&&"gene"===that.singleImage.type?a=$("div#viewGene").html():"mir"===
that.viewType&&"mir"===that.singleImage.type?a=$("div#viewGene").html():"go"===that.viewType&&"go"===that.singleImage.type&&(a=$("div#viewGene").html());var e=$(window).width();a=a.replace('width="100%"','width="'+e+'px"');$.ajax({url:pathPrefix+"saveBrowserImage.jsp",type:"POST",contentType:"text/html",data:a+"\n",processData:!1,dataType:"json",success:function(c){var h=new Date;h=h.getMonth()+1+"_"+h.getDate()+"_"+h.getFullYear();var f="http://";"https:"===location.protocol&&(f="https://");var g=
f+urlprefix+"/tmpData/download/"+c.imageFile;c="";that.selectedModule&&(c=new String(that.selectedModule.MOD_NAME));c=c+"_"+that.viewType;var l=c+"_"+h+".png",n=new XMLHttpRequest;n.open("GET",g);n.responseType="blob";n.send();n.onreadystatechange=function(){if(4!=n.readyState||200!=n.status)return!1;var p=document.createElement("a");p.href=window.URL.createObjectURL(n.response);p.download=l;p.style.display="none";document.body.appendChild(p);try{p.click()}catch(t){$("#wgcnaMouseHelp").html("<span style='color:#FF0000;'>Your browser will not save the image directly. Image will open in a popup, in the new window right click to save image.</span>"),
window.open(g)}return!0}},error:function(c,h,f){console.log(f)}});gtag("event","saveWGCNAView",{event_category:"saveWGCNAView"})}}).on("mouseover",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/savePic_white.png");$("#wgcnaMouseHelp").html("Click to download a PNG image of the current view.")}).on("mouseout",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/savePic_dark.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});
that.imageBar.append("span").attr("class","reset control").style("display","inline-block").attr("id","wgcnaresetImage").style("cursor","pointer").append("img").attr("src",contextRoot+"web/images/icons/reset_dark.png").attr("pointer-events","all").attr("cursor","pointer").on("click",function(){that.singleImage&&("eqtl"===that.viewType?that.singleImage.panZoomCircos.reset():"undefined"!==typeof that.singleImage&&that.singleImage.panZoom.reset());gtag("event","resetWGCNAView",{event_category:"resetWGCNAView"})}).on("mouseover",
function(){d3.select(this).attr("src",contextRoot+"web/images/icons/reset_white.png");$("#wgcnaMouseHelp").html("Click to reset image zoom to initial region.")}).on("mouseout",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/reset_dark.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});that.imageBar.append("span").attr("class","zoomIn control").style("display","inline-block").style("cursor","pointer").style("position",
"relative").style("top","7px").attr("id","wgcnazoomInImage").append("img").attr("src",contextRoot+"web/images/icons/magPlus_dark_32.png").attr("pointer-events","all").attr("cursor","pointer").style("position","relative").style("top","-5px").on("click",function(){"eqtl"===that.viewType&&that.singleImage?that.singleImage.panZoomCircos.zoomIn():void 0==that.singleImage&&that.multiImage?that.multiImage.zoomIn():"undefined"!==typeof that.singleImage&&that.singleImage&&that.singleImage.panZoom.zoomIn();
gtag("event","zoomInWGCNAView",{event_category:"zoomInWGCNAView"})}).on("mouseover",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/magPlus_light_32.png");$("#wgcnaMouseHelp").html("Click to zoom in.")}).on("mouseout",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/magPlus_dark_32.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});that.imageBar.append("span").attr("class","zoomOut control").style("display",
"inline-block").style("cursor","pointer").style("position","relative").style("top","7px").attr("id","wgcnazoomOutImage").append("img").attr("src",contextRoot+"web/images/icons/magMinus_dark_32.png").attr("pointer-events","all").attr("cursor","pointer").style("position","relative").style("top","-5px").on("click",function(){"eqtl"===that.viewType&&that.singleImage?that.singleImage.panZoomCircos.zoomOut():void 0==that.singleImage&&that.multiImage?that.multiImage.zoomOut():that.singleImage&&"undefined"!==
typeof that.singleImage&&"undefined"!==typeof that.singleImage.panZoom&&that.singleImage.panZoom.zoomOut();gtag("event","zoomOutWGCNAView",{event_category:"zoomOutWGCNAView"})}).on("mouseover",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/magMinus_light_32.png");$("#wgcnaMouseHelp").html("Click to zoom out.")}).on("mouseout",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/magMinus_dark_32.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});
that.imageBar.append("span").attr("class","back control").style("display","inline-block").style("cursor","pointer").style("position","relative").style("top","7px").attr("id","backModule").append("img").attr("src",contextRoot+"web/images/icons/back_dark_32.png").attr("pointer-events","all").attr("cursor","pointer").style("position","relative").style("top","-5px").on("click",function(){that.multiImage.backModule()}).on("mouseover",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/back_light_32.png");
$("#wgcnaMouseHelp").html("Click to move to the previous module.")}).on("mouseout",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/back_dark_32.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});that.imageBar.append("span").attr("class","forward control").style("display","inline-block").style("cursor","pointer").style("position","relative").style("top","7px").attr("id","forwardModule").append("img").attr("src",contextRoot+
"web/images/icons/forward_dark_32.png").attr("pointer-events","all").attr("cursor","pointer").style("position","relative").style("top","-5px").on("click",function(){that.multiImage.forwardModule()}).on("mouseover",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/forward_light_32.png");$("#wgcnaMouseHelp").html("Click to move to the next module.")}).on("mouseout",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/forward_dark_32.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")})};
that.createViewControls=function(){that.viewBar=d3.select("#viewControl").append("div").attr("id","wgcnaViewControls").style("float","right").style("margin-left","10px").style("margin-right","5px").style("text-align","left");that.viewBar.append("text").text("Views:");that.viewBar.append("span").attr("id","HelpWGCNAView").append("img").attr("src",contextRoot+"web/images/icons/help.png");that.viewBar.append("br");that.viewBar.append("input").attr("type","radio").attr("id","wgcnaGeneViewRB").attr("name",
"wgcnaViewRB").attr("value","gene").attr("checked","checked").style("margin-left","7px").style("margin-right","3px").on("click",function(){that.viewType="gene";that.createSingleWGCNAImage();gtag("event","moduleView",{event_category:"WGCNA"})});that.viewBar.append("text").text("Module");that.viewBar.append("span").attr("class","wgcnaControltooltip").attr("title",'View transcripts within the selected module and their connectivity based on correlation of expression.<BR><BR>Have a question about this view click the <img src="'+
contextRoot+'web/images/icons/help.png"> above for a detailed description of each view.').style("margin-left","5px").append("img").attr("src","/web/images/icons/info.gif");that.viewBar.append("br");that.viewBar.append("input").attr("type","radio").attr("id","wgcnaEQTLViewRB").attr("name","wgcnaViewRB").attr("value","eqtl").style("margin-left","7px").style("margin-right","3px").on("click",function(){that.viewType="eqtl";that.createSingleWGCNAImage();gtag("event","eQTLView",{event_category:"WGCNA"})});
that.viewBar.append("text").text("Eigengene eQTL");that.viewBar.append("span").attr("class","wgcnaControltooltip").attr("title",'View Circos plot of the module Eigengene eQTLs.<BR><BR>Have a question about this view click the <img src="'+contextRoot+'web/images/icons/help.png"> above for a detailed description of each view.').style("margin-left","5px").append("img").attr("src","/web/images/icons/info.gif");that.viewBar.append("br");that.viewBar.append("input").attr("type","radio").attr("id","wgcnaGOViewRB").attr("name",
"wgcnaViewRB").attr("value","go").style("margin-left","7px").style("margin-right","3px").attr("disabled",function(){return 10<that.wDSID?!0:!1}).on("click",function(){that.viewType="go";that.createSingleWGCNAImage();gtag("event","goView",{event_category:"WGCNA"})});that.viewBar.append("text").text("Gene Ontology");that.viewBar.append("span").attr("class","wgcnaControltooltip").attr("title",'TEMPORARILY DISABLED PLEASE CHECK BACK. View a summary of Gene Ontology terms assigned to transcripts in the selected module.<BR><BR>Have a question about this view click the <img src="'+
contextRoot+'web/images/icons/help.png"> above for a detailed description of each view.').style("margin-left","5px").append("img").attr("src","/web/images/icons/info.gif");that.viewBar.append("br");that.viewBar.append("input").attr("type","radio").attr("id","wgcnaMirViewRB").attr("name","wgcnaViewRB").attr("value","mir").style("margin-left","7px").style("margin-right","3px").on("click",function(){that.viewType="mir";that.createSingleWGCNAImage();gtag("event","mirView",{event_category:"WGCNA"})});
that.viewBar.append("text").text("miRNA Targets");that.viewBar.append("span").attr("class","wgcnaControltooltip").attr("title",'View a summary of miRNAs that target genes in this module.<BR><BR>Have a question about this view click the <img src="'+contextRoot+'web/images/icons/help.png"> above for a detailed description of each view.').style("margin-left","5px").append("img").attr("src","/web/images/icons/info.gif");that.viewBar.append("br");that.viewBar.append("input").attr("type","radio").attr("id",
"wgcnaMetaViewRB").attr("name","wgcnaViewRB").attr("value","meta").style("margin-left","7px").style("margin-right","3px").attr("disabled",function(){return 10<that.wDSID?!0:!1}).on("click",function(){that.viewType="meta";that.createSingleWGCNAImage();gtag("event","metaView",{event_category:"WGCNA"})});that.viewBar.append("text").text("Meta Module (nearest neighbors)");that.viewBar.append("span").attr("class","wgcnaControltooltip").attr("title",'View most closely correlated modules and browse those modules.<BR><BR>Have a question about this view click the <img src="'+
contextRoot+'web/images/icons/help.png"> above for a detailed description of each view.').style("margin-left","5px").append("img").attr("src","/web/images/icons/info.gif");$("#HelpWGCNAView").on("click",function(a){var e=$(this).attr("id");$("#"+e+"Content").dialog("option","position",{my:"right top",at:"left bottom",of:$(this)});$("#"+e+"Content").dialog("open").css({"font-size":12});a.stopPropagation()})};that.createDataControls=function(){that.dataBar=d3.select("#dataControl").append("span").attr("id",
"wgcnaDataControls").style("margin-left","10px").style("margin-right","5px").append("table").append("tr");var a=that.dataBar.append("td");a.append("text").text("Data Source:");var e=a.append("select").attr("id","wgcnaSourceSelect").on("change",function(){$("#singleWGCNASVG").hide();d3.select("#multiWGCNASVG").remove();$("#circosModule").hide();$("#wgcnaModuleTable").hide();$("#wgcnaMirTable").hide();$("#wgcnaMirGeneTable").hide();$("#wgcnaGoTable").hide();$("#wgcnaEqtlTable").hide();that.selSource=
$("#wgcnaSourceSelect").val();that.tissue=$("#wgcnaTissueSelect").val();"array"===that.selSource?($("span#spanVersion").hide(),"Whole Brain"===that.tissue?that.wDSID=3:"Heart"===that.tissue?that.wDSID=4:"Liver"===that.tissue&&(that.wDSID=5),d3.select("#wgcnaTissueSelect").append("option").attr("value","Heart").text("Heart")):"seq"===that.selSource&&($("span#spanVersion").show(),"Whole Brain"===that.tissue?(that.wDSID=11,"2"===that.version?that.wDSID=8:"1"===that.version&&(that.wDSID=6)):"Liver"===
that.tissue?(that.wDSID=12,"2"===that.version?that.wDSID=9:"1"===that.version&&(that.wDSID=7)):(that.wDSID=11,that.version="5",d3.select("#wgcnaTissueSelect").select('option[value="Brain"]').attr("selected","selected"),d3.select("#wgcnaVersionSelect").select('option[value="2"]').attr("selected","selected")),d3.select("#wgcnaTissueSelect").select('option[value="Heart"]').remove());that.requestModuleList()});that.sources=["array"];that.dispSources=["Arrays"];"Rn"===organism&&"rn6"===genomeVer&&(that.sources=
["seq","array"],that.dispSources=["RNA-Seq","Arrays"]);for(var c=0;c<that.sources.length;c++)e.append("option").attr("value",that.sources[c]).text(that.dispSources[c]);a.append("br");a.append("text").text("Tissue:");e=a.append("select").attr("id","wgcnaTissueSelect").on("change",function(){$("#singleWGCNASVG").hide();d3.select("#multiWGCNASVG").remove();$("#circosModule").hide();$("#wgcnaModuleTable").hide();$("#wgcnaMirTable").hide();$("#wgcnaMirGeneTable").hide();$("#wgcnaGoTable").hide();$("#wgcnaEqtlTable").hide();
that.selSource=$("#wgcnaSourceSelect").val();that.tissue=$("#wgcnaTissueSelect").val();"array"===that.selSource?"Whole Brain"===that.tissue?that.wDSID=3:"Heart"===that.tissue?that.wDSID=4:"Liver"===that.tissue&&(that.wDSID=5):"seq"===that.selSource&&("Whole Brain"===that.tissue?(that.wDSID=11,"2"===that.version?that.wDSID=8:"1"===that.version&&(that.wDSID=6)):"Liver"===that.tissue&&(that.wDSID=12,"2"===that.version?that.wDSID=9:"1"===that.version&&(that.wDSID=7)));that.requestModuleList()});that.tissues=
["Brain"];that.dispTissues=["Whole Brain"];"Rn"===organism&&"rn6"===genomeVer&&(that.source&&"arrays"===that.source?(that.tissues=["Whole Brain","Heart","Liver"],that.dispTissues=["Whole Brain","Heart","Liver"]):(that.tissues=["Whole Brain","Liver"],that.dispTissues=["Whole Brain","Liver"]));for(c=0;c<that.tissues.length;c++)e.append("option").attr("value",that.tissues[c]).text(that.dispTissues[c]);a.append("br");c=a.append("span").attr("id","spanVersion");c.append("text").text("Version:");e=c.append("select").attr("id",
"wgcnaVersionSelect").on("change",function(){that.version=$("#wgcnaVersionSelect").val();"Whole Brain"===that.tissue?(that.wDSID=11,"2"===that.version?that.wDSID=8:"1"===that.version&&(that.wDSID=6)):"Liver"===that.tissue&&(that.wDSID=12,"2"===that.version?that.wDSID=9:"1"===that.version&&(that.wDSID=7));that.requestModuleList()});that.ver=["5","2","1"];that.dispVer=["HRDP v5","HRDP v4","HRDP v3"];for(c=0;c<that.ver.length;c++)e.append("option").attr("value",that.ver[c]).text(that.dispVer[c]);d3.select("#wgcnaVersionSelect").select('option[value="'+
that.version+'"]').attr("selected","selected");a.append("br");c=a.append("span").attr("id","spanReturnType");c.append("text").text("Module selection by:");e=c.append("select").attr("id","wgcnaModuleSelect").on("change",function(){that.modSelect=$("#wgcnaModuleSelect").val();that.requestModuleList();"eQTL"===that.modSelect?$("#spaneQTLCutoff").show():$("#spaneQTLCutoff").hide()});c.append("text").text("in this region");a.append("br");a=a.append("span").attr("id","spaneQTLCutoff").style("display","none");
a.append("text").text("eQTL Cutoff P-value:");var h=["gene","eQTL"],f=["genes","module Eigengene QTL"];for(c=0;c<h.length;c++)e.append("option").attr("value",h[c]).text(f[c]);d3.select("#wgcnaModuleSelect").select('option[value="'+that.modSelect+'"]').attr("selected","selected");$("span#spanReturnType").show();e=a.append("select").attr("id","wgcnaModuleEQTLCutoff").on("change",function(){that.modSelectCutoff=$("#wgcnaModuleEQTLCutoff").val();that.requestModuleList()});h=["1","2","3","4"];f=["0.1",
"0.01","0.001","0.0001"];for(c=0;c<h.length;c++)e.append("option").attr("value",h[c]).text(f[c]);d3.select("#wgcnaModuleEQTLCutoff").select('option[value="'+that.modSelectCutoff+'"]').attr("selected","selected");c=that.dataBar.append("td").append("div").attr("id","goCtls").attr("class","goCTL").style("display","none").style("margin-left","10px");c.append("text").text("GO Domain:");e=c.append("select").attr("id","goDomainSelect").on("change",function(){that.singleImage.goDomain=$("#goDomainSelect").val();
that.singleImage.draw();gtag("event","changeDomain",{event_category:"WGCNA_go"})});e.append("option").attr("value","cc").text("Cellular Component");e.append("option").attr("value","bp").text("Biological Process");e.append("option").attr("selected","selected").attr("value","mf").text("Molecular Function");c.append("br");c.append("text").text("Number of Levels to Display:");c.append("input").attr("name","value").attr("id","goSpinner");$("#goSpinner").spinner({min:1,max:100,step:1,change:function(g,
l){that.singleImage.displayDepth=l.value;that.singleImage.selectedNode!==that.singleImage.data.GOList[0]&&that.singleImage.selectedNode!==that.singleImage.data.GOList[1]&&that.singleImage.selectedNode!==that.singleImage.data.GOList[2]?that.singleImage.redraw():that.singleImage.draw();gtag("event","changeDepth",{event_category:"WGCNA_go"})},spin:function(g,l){that.singleImage.displayDepth=l.value;that.singleImage.selectedNode!==that.singleImage.data.GOList[0]&&that.singleImage.selectedNode!==that.singleImage.data.GOList[1]&&
that.singleImage.selectedNode!==that.singleImage.data.GOList[2]?that.singleImage.redraw():that.singleImage.draw();gtag("event","changeDepth",{event_category:"WGCNA_go"})}}).val(3);c=that.dataBar.append("td").append("div").attr("id","mirCtls").attr("class","mirCTL").style("display","none").style("margin-left","10px");e=c.append("table").append("tr");c.append("text").style("font-weight","bold").text("Filter miRNAs:");c.append("br");c.append("input").attr("type","checkbox").style("margin-right","5px").attr("id",
"mirValidatedCBX").on("click",function(){$(this).is(":checked")?that.singleImage.mirValid=1:that.singleImage.mirValid=0;that.singleImage.drawMiR();gtag("event","changeValidated",{event_category:"WGCNA_mir"})});c.append("text").text("only miRNAs with Validated Targets");c.append("br");c.append("text").style("margin-right","5px").text("# of targeted Genes: ");c.append("div").attr("id","minMirGeneSlider").style("display","inline-block").style("width","150px");c.append("span").attr("id","minMirGeneLabel").style("margin-left",
"5px").append("text").text("1");c.append("br");c.append("text").style("margin-right","5px").text("miRNAs targeting gene: ");c.append("input").attr("type","text").attr("id","mirGeneFilterTxt").on("keyup",function(g){that.singleImage.mirTargetID=$(this).val().toLowerCase();that.singleImage.drawMiR();gtag("event","geneFilter",{event_category:"WGCNA_mir"})});c.append("br");c.append("text").style("margin-right","5px").text("miRNA(ID or Accession): ");c.append("input").attr("type","text").attr("id","mirIDFilterTxt").on("keyup",
function(g){that.singleImage.mirID=$(this).val().toLowerCase();that.singleImage.drawMiR();gtag("event","geneFilter",{event_category:"WGCNA_mir"})});c=that.dataBar.append("td").append("div").attr("id","mirCtls2").attr("class","mirCTL").style("display","none").style("margin-left","10px");c.append("text").style("font-weight","bold").text("Display Options:");c.append("br");c.append("input").attr("type","checkbox").attr("id","mirSortCBX").style("margin-right","5px").on("click",function(){$(this).prop("checked")?
that.singleImage.sortMir=$("#mirSortSelect").val():that.singleImage.sortMir=0;that.singleImage.drawMiR();gtag("event","mirSort",{event_category:"WGCNA_mir"})});c.append("text").text("Hovering over a node(miR or transcript):");c.append("br");c.append("input").attr("type","checkbox").attr("id","mirLinkCBX").attr("checked","checked").style("margin-left","12px").style("margin-right","3px").on("click",function(){$(this).prop("checked")?that.singleImage.showMirLinks=1:that.singleImage.showMirLinks=0;gtag("event",
"showLinks",{event_category:"WGCNA_mir"})});c.append("text").text("Display links between miRNAs and targeted transcripts");c.append("br");c.append("input").attr("type","checkbox").attr("id","mirgeneLinkCBX").style("margin-left","12px").style("margin-right","3px").on("click",function(){$(this).prop("checked")?(that.singleImage.showLinks=0,$("div#mirLinkColorSelect").show()):(that.singleImage.showLinks=1,$("div#mirLinkColorSelect").hide());that.singleImage.setupLegend();gtag("event","linkColor",{event_category:"WGCNA_mir"})});
c.append("text").text("Display links between correlated transcripts");e=c.append("div").attr("id","mirLinkColorSelect").style("display","none");e.append("text").style("margin-left","24px").text("Correlation Link Color Options:");c=e.append("select").attr("id","mirlinkColor").on("change",function(){that.singleImage.updateColor("mirlinkColor");that.singleImage.setupLegend();gtag("event","linkColor",{event_category:"WGCNA_mir"})});c.append("option").attr("selected","selected").attr("value","Green_Red").text("Green(+) / Red(-)");
c.append("option").attr("value","Blue_Yellow").text("Blue(+) / Yellow(-)");c.append("option").attr("value","Red_Green").text("Red(+) / Green(-)");e.append("br");e.append("input").attr("type","checkbox").style("margin-left","24px").style("margin-right","3px").on("click",function(){$(this).prop("checked")?that.singleImage.showAllFromTarget=1:that.singleImage.showAllFromTarget=0;gtag("event","linkColor",{event_category:"WGCNA_mir"})});e.append("text").text("Display all cor. transcript links from targeted transcripts.");
$("#minMirGeneSlider").slider({min:1,max:100,step:1,value:1,slide:function(g,l){that.singleImage.mirGeneCutoff=l.value;$("span#minMirGeneLabel").html(l.value);that.singleImage.drawMiR();gtag("event","minMir",{event_category:"WGCNA_mir"})}});c=that.dataBar.append("td").append("div").attr("id","linkCtls").attr("class","linkCTL").style("display","none").style("margin-left","10px");c.append("text").text("Link Correlation Values");c.append("span").style("cursor","pointer").on("click",function(){$("#linkSliderMin").slider("value",
.75);that.singleImage.CorCutoff_min=.75;$("span#minLabel").html(.75);$("#linkSliderMax").slider("value",1);that.singleImage.CorCutoff_max=1;$("span#maxLabel").html(1);that.singleImage.draw();gtag("event","resetCorrelation",{event_category:"WGCNA_mir"})}).append("img").attr("src",contextRoot+"/web/images/icons/reset_16.png");a=c.append("table");e=a.append("tr");e.append("td").append("text").text("Min:");e.append("td").append("div").attr("id","linkSliderMin").style("width","100px");e.append("td").append("span").attr("id",
"minLabel").style("margin-left","5px").append("text").text("0.75");e=a.append("tr");e.append("td").append("text").text("Max:");e.append("td").append("div").attr("id","linkSliderMax").style("width","100px");e.append("td").append("span").attr("id","maxLabel").style("margin-left","5px").append("text").text("1");c.append("input").attr("type","checkbox").attr("id","hideLinkExceptNode").on("click",function(){that.singleImage.showLinks=!$(this).is(":checked");that.singleImage.draw();that.singleImage.panZoom=
svgPanZoom("#singleWGCNASVG",{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,minZoom:.1,maxZoom:4,fit:!0,center:!0})});c.append("text").text("Hide Links Except Selected Node");e=that.dataBar.append("td").append("div").attr("id","linkCtl2").attr("class","linkCTL").style("display","none").style("margin-left","10px");e.append("text").text("Correlation Link Color Options:");e.append("br");e=e.append("select").attr("id","linkColor").on("change",function(){that.singleImage.draw();
that.singleImage.panZoom=svgPanZoom("#singleWGCNASVG",{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,minZoom:.1,maxZoom:4,fit:!0,center:!0})});e.append("option").attr("selected","selected").attr("value","Green_Red").text("Green(+) / Red(-)");e.append("option").attr("value","Blue_Yellow").text("Blue(+) / Yellow(-)");e.append("option").attr("value","Red_Green").text("Red(+) / Green(-)");$("#linkSliderMin").slider({min:.05,max:.95,step:.05,value:.75,
slide:function(g,l){that.singleImage.CorCutoff_min=l.value;$("span#minLabel").html(l.value);that.singleImage.draw()}});$("#linkSliderMax").slider({min:.1,max:1,step:.05,value:1,slide:function(g,l){that.singleImage.CorCutoff_max=l.value;$("span#maxLabel").html(l.value);that.singleImage.draw()}});c=that.dataBar.append("td").append("div").attr("class","eqtlCtls").attr("id","eqtlCtl").style("display","none").style("margin-left","10px");c.append("text").text("Select Chromosomes");c.append("br");e=c.append("select").attr("id",
"eqtlChr").attr("multiple","multiple").attr("size","4").style("width","100px");for(c=1;c<=that.chrLen;c++)e.append("option").attr("selected","selected").attr("value",organism.toLowerCase()+c).text("chr"+c);e.append("option").attr("selected","selected").attr("value",organism.toLowerCase()+"X").text("chrX");c=that.dataBar.append("td").append("div").attr("class","eqtlCtls").attr("id","eqtlCtl2").style("display","none").style("margin-left","10px");c.append("text").text("P-value cutoff:");e=c.append("select").attr("id",
"eqtlPval");e.append("option").attr("value","1").text("0.1");e.append("option").attr("selected","selected").attr("value","2").text("0.01");e.append("option").attr("value","3").text("0.001");e.append("option").attr("value","4").text("0.0001");e.append("option").attr("value","5").text("0.00001");c.append("br");c.append("br");c.append("br");c.append("br");c.append("input").attr("type","button").attr("value","Apply Selections").on("click",function(){for(var g=$("#eqtlPval").val(),l=$("#eqtlChr").val(),
n="",p=0;p<l.length;p++)n=n+l[p]+";";$.ajax({url:pathPrefix+"runCircosModule.jsp",type:"GET",async:!0,data:{cutoffValue:g,organism:organism,module:that.selectedModule.MOD_NAME,modColor:that.selectedModule.ModRGB,chrList:n,genomeVer:genomeVer,tissue:that.tissue},dataType:"json",beforeSend:function(){$("#waitCircos").show()},success:function(t){$("#waitCircos").hide();that.singleImage.update(t.URL)},error:function(t,v,y){}})})};that.positionTTLeft=function(a){a+=20;a>$(window).width()/2&&(a-=250);return a+
"px"};that.positionTTTop=function(a){a+="px";d3.event.clientY>.6*window.innerHeight&&(a=d3.event.pageY-2.2*$(".testToolTip").height()+"px");return a};that.createMultiWGCNAImage=function(){that.multiImage=that.multiWGCNAImageGeneView();that.multiImage.draw();that.img=that.multiImage};that.multiWGCNAImage=function(){var a={maxWidth:200};a.totalWidth=$(window).width();a.modPerLine=Math.floor($(window).width()/a.maxWidth);a.calcWidth=Math.floor($(window).width()/a.modPerLine);a.data=[];if(0===d3.select("#multiWGCNASVG").size()){var e=
d3.select("#wgcnaGeneImage").append("div").attr("id","multiWGCNAScroll").style("overflow","auto").style("max-height","430px");a.svg=e.append("svg").attr("id","multiWGCNASVG").attr("height","430px").attr("width","100%");e=a.svg.append("linearGradient").attr("id","lgrad").attr("x1","11%").attr("y1","0%").attr("x2","89%").attr("y2","100%");e.append("stop").attr("offset","0%").attr("style","stop-color:rgb(153,218,255);stop-opacity:1");e.append("stop").attr("offset","100%").attr("style","stop-color:rgb(0,128,128);stop-opacity:1");
e=a.svg.append("linearGradient").attr("id","selectGrad").attr("x1","11%").attr("y1","0%").attr("x2","89%").attr("y2","100%");e.append("stop").attr("offset","0%").attr("style","stop-color:rgb(0,163,55);stop-opacity:1");e.append("stop").attr("offset","100%").attr("style","stop-color:rgb(0,75,20);stop-opacity:1")}else a.svg=d3.select("#multiWGCNASVG");a.modKey=function(c){return c.MOD_NAME};a.calcX=function(c,h){return h%a.modPerLine*a.calcWidth};a.calcY=function(c,h){return Math.floor(h/a.modPerLine)*
a.maxWidth};a.sizing=function(c){c=a.size(c.TCList.length);c>a.maxWidth/2&&(c=a.maxWidth/2);return c};a.zoomIn=function(){a.maxWidth<$(window).width()/2&&(a.maxWidth*=2,a.draw())};a.zoomOut=function(){var c=a.maxWidth;a.maxWidth=Math.floor(a.maxWidth/2);25>a.maxWidth?a.maxWidth=c:a.draw()};a.sortTCLenDesc=function(c,h){return h.TCList.length<c.TCList.length?-1:h.TCList.length>c.TCList.length?1:0};a.sortGeneInstanceDesc=function(c,h){return h.GeneCount<c.GeneCount?-1:h.GeneCount>c.GeneCount?1:a.sortTCLenDesc(c,
h)};a.draw=function(){};a.redraw=function(){};return a};that.multiWGCNAImageGeneView=function(){var a=that.multiWGCNAImage();a.createToolTip=function(e){var c="Module Name: "+e.MOD_NAME+"<BR>Transcript Size: "+e.TCList.length;"undefined"!==typeof e.GroupedGenes?(c=c+"<BR>Genes in Region/List: "+e.GroupedGenes,c=c+"<BR>Transcripts in Region/List: "+e.GeneCount):c=c+"<BR>Selected Gene Transcripts in Module: "+e.GeneCount;return c};a.draw=function(){"undefined"!==typeof that.selectedModule&&(a.maxWidth=
85);a.svg.selectAll(".modules").remove();a.svg.selectAll(".moduleGradient").remove();a.totalWidth=$(window).width();a.modPerLine=Math.floor($(window).width()/a.maxWidth);a.calcWidth=Math.floor($(window).width()/a.modPerLine);var e=[];a.dataList={};for(var c=0,h=0;h<that.moduleList.length;h++)if(("grey"!==that.moduleList[h]||"grey"===that.moduleList[h]&&0===that.skipGrey)&&"undefined"!==typeof that.modules[that.moduleList[h]]){e[c]=that.modules[that.moduleList[h]];var f=e[c].ModRGB.split(","),g="";
for(g=0;g<f.length;g++)f[g]-=70,0>f[g]&&(f[g]=0);g=f[0]+","+f[1]+","+f[2];f=a.svg.append("linearGradient").attr("id","grad"+e[c].MOD_NAME).attr("class","moduleGradient").attr("x1","11%").attr("y1","0%").attr("x2","89%").attr("y2","100%");f.append("stop").attr("offset","0%").attr("style","stop-color:rgb("+e[c].ModRGB+");stop-opacity:1");f.append("stop").attr("offset","100%").attr("style","stop-color:rgb("+g+");stop-opacity:1");c++}c=a.maxWidth+15;e.length>a.modPerLine&&(h=Math.floor(e.length/a.modPerLine),
0<e.length%a.modPerLine&&h++,c*=h);a.svg.attr("height",c+"px");e.sort(a.sortGeneInstanceDesc);a.data=e;for(h=0;h<e.length;h++)a.dataList[e[h].MOD_NAME]=h;c=d3.min(e,function(l){return l.TCList.length});h=d3.max(e,function(l){return l.TCList.length});a.size=d3.scaleLinear().domain([c,h]).range([10,a.maxWidth/2]);e=a.svg.selectAll(".modules").data(e,a.modKey).attr("transform",function(l,n){return"translate("+a.calcX(l,n)+","+a.calcY(l,n)+")"});e.enter().append("g").attr("class","modules").attr("id",
function(l){return l.MOD_NAME}).attr("transform",function(l,n){return"translate("+a.calcX(l,n)+","+a.calcY(l,n)+")"}).merge(e).each(function(l){var n=d3.select("g#"+l.MOD_NAME);n.append("circle").attr("cx",a.calcWidth/2).attr("cy",a.maxWidth/2).attr("r",a.sizing).attr("stroke",function(p){var t="#FFFFFF";"undefined"!==typeof that.selectedModule&&that.selectedModule===p&&(t="#000000");return t}).attr("stroke-width",function(p){var t="1px";"undefined"!==typeof that.selectedModule&&that.selectedModule===
p&&(t="3px");return t}).attr("fill",function(p){var t="url(#grad"+p.MOD_NAME+")";"undefined"!==typeof that.selectedModule&&that.selectedModule===p&&(t="url(#selectGrad)");return t}).on("click",function(){a.maxWidth=85;that.selectedModule=l;a.draw();d3.select("#multiWGCNAScroll").style("max-height","110px");a.svg.select("g#"+l.MOD_NAME).style("background","#CECECE");a.svg.select("g#"+l.MOD_NAME).select("circle").attr("fill","url(#selectGrad)").attr("stroke","#000000").attr("stroke-width","3px");a.svg.select("g#"+
l.MOD_NAME).select("text.txtLbl").style("font-weight","bold");that.selectedGene={};for(var p=0;p<l.TCList.length;p++)"undefined"===typeof that.selectedGene[l.TCList[p].Gene.ID]&&(that.selectedGene[l.TCList[p].Gene.ID]={},that.selectedGene[l.TCList[p].Gene.ID].geneSymbol=l.TCList[p].Gene.geneSymbol,that.selectedGene[l.TCList[p].Gene.ID].tcList=[]),that.selectedGene[l.TCList[p].Gene.ID].tcList.push(l.TCList[p]);setTimeout(that.createSingleWGCNAImage,20)}).on("mouseover",function(){$("#wgcnaMouseHelp").html("<B>Click</B> to select this module and see additional details.");
d3.select(this).style("fill","url(#selectGrad)");tt.transition().duration(200).style("opacity",1);tt.html(a.createToolTip(l)).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",function(){return that.positionTTTop(d3.event.pageY)})}).on("mouseout",function(){var p=d3.select(this).data()[0];"undefined"!==typeof that.selectedModule&&p.MOD_NAME===that.selectedModule.MOD_NAME||d3.select(this).style("fill","url(#grad"+p.MOD_NAME+")");tt.transition().duration(500).style("opacity",
0)});"undefined"!==typeof that.selectedModule&&that.selectedModule===l?n.append("text").attr("class","txtLbl").attr("y",a.maxWidth+12).attr("x",function(p){return a.calcWidth/2-p.MOD_NAME.length/2*6.5}).style("font-weight","bold").text(replaceUnderscore(l.MOD_NAME)):6.5*l.MOD_NAME.length<a.calcWidth&&n.append("text").attr("class","txtLbl").attr("y",a.maxWidth+12).attr("x",function(p){return a.calcWidth/2-p.MOD_NAME.length/2*6.5}).text(replaceUnderscore(l.MOD_NAME));n.append("text").attr("y",a.maxWidth/
2+5).attr("x",a.calcWidth/2-3).attr("pointer-events","none").attr("fill",function(p){var t="#000000";p=p.ModRGB.split(",");360>p[0]+p[1]+p[2]&&(t="#FFFFFF");return t}).text(function(p){var t=p.GeneCount;"undefined"!==typeof p.GroupedGenes&&(t=p.GroupedGenes);return t})})};a.backModule=function(){if(that.selectedModule){var e=a.dataList[that.selectedModule.MOD_NAME];if(0<e){e=a.data[e-1];var c=a.svg.select("g#"+that.selectedModule.MOD_NAME);c.select("circle").attr("fill","url(#grad"+that.selectedModule.MOD_NAME+
")").attr("stroke","#FFFFFF").attr("stroke-width","1px");c.select("text.txtLbl").style("font-weight","normal");that.selectedModule=e;e=a.svg.select("g#"+e.MOD_NAME);e.select("circle").attr("fill","url(#selectGrad)").attr("stroke","#000000").attr("stroke-width","3px");e.select("text.txtLbl").style("font-weight","bold");setTimeout(that.createSingleWGCNAImage,20)}}};a.forwardModule=function(){if(that.selectedModule){var e=a.dataList[that.selectedModule.MOD_NAME];if(e<a.data.length-1){e=a.data[e+1];var c=
a.svg.select("g#"+that.selectedModule.MOD_NAME);c.select("circle").attr("fill","url(#grad"+that.selectedModule.MOD_NAME+")").attr("stroke","#FFFFFF").attr("stroke-width","1px");c.select("text.txtLbl").style("font-weight","normal");that.selectedModule=e;e=a.svg.select("g#"+e.MOD_NAME);e.select("circle").attr("fill","url(#selectGrad)").attr("stroke","#000000").attr("stroke-width","3px");e.select("text.txtLbl").style("font-weight","bold");setTimeout(that.createSingleWGCNAImage,20)}}};return a};that.createSingleWGCNAImage=
function(){d3.select("#viewGene").remove();d3.select("#circos").remove();$("#wgcnaresetImage").show();$("#wgcnazoomInImage").show();$("#wgcnazoomOutImage").show();"gene"===that.viewType?($("#linkSliderMin").slider("value",.01),$("span#minLabel").html(.01),$("#linkSliderMax").slider("value",1),$("span#maxLabel").html(1),$("#hideLinkExceptNode").prop("checked",!1),setTimeout(function(){that.singleImage=that.singleWGCNAImageGeneView(that.modules);that.singleImage.draw();that.img=that.singleImage;that.singleWGCNATableGeneView();
setTimeout(function(){that.singleImage.panZoom=svgPanZoom("#singleWGCNASVG",{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,minZoom:.1,maxZoom:4,fit:!0,center:!0})},500)},50)):"go"===that.viewType?($("#wgcnaresetImage").hide(),$("#wgcnazoomInImage").hide(),$("#wgcnazoomOutImage").hide(),$("#goDomainSelect").val("mf"),$("#goSpinner").val(3),setTimeout(function(){that.singleImage=that.singleWGCNAImageGoView(that.modules);that.singleImage.goDomain=
$("#goDomainSelect").val();that.singleImage.draw();that.img=that.singleImage},50)):"eqtl"===that.viewType?($("#eqtlChr option").prop("selected",!0),$("#eqtlPval").val(2),setTimeout(function(){that.singleImage=that.singleWGCNAImageEQTLView(that.modules);that.singleImage.displayDefault();that.img=that.singleImage},50)):"mir"===that.viewType?($("#mirValidatedCBX").prop("checked",!1),$("#minMirGeneSlider").slider("value",1),$("span#minMirGeneLabel").html(1),$("#mirGeneFilterTxt").val(""),$("#mirIDFilterTxt").val(""),
$("#mirSortCBX").prop("checked",!1),$("#mirLinkCBX").prop("checked",!0),$("#mirgeneLinkCBX").prop("checked",!1),$("div#mirLinkColorSelect").hide(),setTimeout(function(){that.singleImage=that.singleWGCNAImageGeneView(that.modules);that.singleImage.draw();that.img=that.singleImage;setTimeout(function(){that.singleImage.panZoom=svgPanZoom("#singleWGCNASVG",{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,minZoom:.1,maxZoom:4,fit:!0,center:!0})},500)},
50)):"meta"===that.viewType&&setTimeout(function(){that.singleImage=that.singleWGCNAImageMetaView(that.modules);that.singleImage.requestMeta();that.img=that.singleImage;setTimeout(function(){that.singleImage.panZoom=svgPanZoom("#singleWGCNASVG",{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,minZoom:.1,maxZoom:4,fit:!0,center:!0})},500)},50);gtag("event",that.viewType,{event_category:"changedWGCNAView"})};that.singleWGCNAImage=function(){var a={};
a.width=$(window).width();a.height=Math.floor(.9*window.innerHeight);a.r=a.height>a.width?Math.floor(a.width/2*.95):Math.floor(a.height/2*.95);a.maxPerLevel=150;a.CorCutoff_min=.75;a.CorCutoff_max=1;a.showLinks=!0;a.data=[];a.maxNodeR=28;a.negColor="#DD0000";a.negDarkColor="#770000";a.posColor="#00DD00";a.posDarkColor="#007700";a.mirVal="#FFFF00";a.mirPred="#0000CC";0===d3.select("#singleWGCNASVG").size()?a.svg=d3.select("#wgcnaGeneImage").append("div").attr("id","viewGene").append("svg").attr("id",
"singleWGCNASVG").attr("height",a.height+"px").attr("width","100%"):a.svg=d3.select("#singleWGCNASVG");a.geneKey=function(e){return e.ID};a.linkKey=function(e){return that.removeInvalidIDChars(e.TC1)+that.removeInvalidIDChars(e.TC2)};a.calcX=function(e,c){return c%a.modPerLine*a.calcWidth};a.calcY=function(e,c){return Math.floor(c/a.modPerLine)*a.maxWidth};a.sizing=function(e){e=a.size(e.TCList.length);e>a.maxWidth/2&&(e=a.maxWidth/2);return e};a.colorCircle=function(e){e=e.Gene.ID;var c="#DFC184";
if(0==e.indexOf("PRN")||0==e.indexOf("PMM")||0==e.indexOf("Unannotated"))"Whole Brain"===that.tissue?c="#7EB5D6":"Heart"===that.tissue?c="#DC7252":"Liver"===that.tissue&&(c="#bbbedd");return c};a.colorLink=function(e){var c=a.negColor;0<e.Cor&&(c=a.posColor);return c};a.colorLinkHighlight=function(e){var c=a.negDarkColor;0<e.Cor&&(c=a.posDarkColor);return c};a.updateColor=function(e){e=$("#"+e).val();"Red_Green"===e?(a.posColor="#DD0000",a.posDarkColor="#770000",a.negColor="#00DD00",a.negDarkColor=
"#007700",a.mirVal="#FFFF00",a.mirPred="#0000CC"):"Blue_Yellow"===e?(a.posColor="#0000DD",a.posDarkColor="#000077",a.negColor="#ffef16",a.negDarkColor="#b7ae2a",a.mirVal="#FF9C2A",a.mirPred="#BA49FF"):(a.negColor="#DD0000",a.negDarkColor="#770000",a.posColor="#00DD00",a.posDarkColor="#007700",a.mirVal="#FFFF00",a.mirPred="#0000CC")};a.nodeRadiusSum=function(e,c){var h=3+20*e.LinkSum;h>a.maxNodeR&&(h=a.maxNodeR);return h};a.zoomIn=function(){a.maxWidth<$(window).width()/2&&(a.maxWidth*=2,a.draw())};
a.zoomOut=function(){var e=a.maxWidth;a.maxWidth=Math.floor(a.maxWidth/2);25>a.maxWidth?a.maxWidth=e:a.draw()};a.draw=function(){};a.redraw=function(){};a.setupLegend=function(){a.svg.select("#legend").remove();a.svg.select("#legendDisp").remove();a.legendG=a.svg.append("g").attr("id","legend").attr("transform","translate(10,60)").style("cursor","pointer").on("mouseover",function(){a.legendDispG.transition().duration(300).style("opacity",1);gtag("event","viewLegend",{event_category:"wgcna"})}).on("mouseleave",
function(){a.legendDispG.transition().duration(300).style("opacity",0)});a.legendG.append("image").attr("x",0).attr("y",-20).attr("width","24px").attr("height","24px").attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAJI0lEQVRIDQEYCef2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABVVVVAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAq6ur/wAAAP4AAAAAAQAAAAAAAAAAAAAAAFtynWv/AgFSAP//BAEBAgAAAP8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/95/Plx4sH/fPbq6ur8QQAAAAAAAAAAEBAQAT/AgOLAQEACQABAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAgAJDRgG/O7xiAAAAMkEAAAAAAAAAADz8/MB/vv1pgMEBVb///4JAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//Pb+/fLiJgAAAB8AAADJBAAAAAAAAAAADQ0N//nivJACAgLfAQEBOwEBARH///8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/gAAAOoAAADxAAAAAAQAAAAAAAAAAMDAwPxAQEDkEhISuv///9wCAgIN////AQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////4AAADxAAAA2AAAAAAEAAAAAAAAAAAAAAAAFS1XJgQDAk4B//wK/gD9BQIAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//fro+OXExvj4+O8AAAAABAAAAAAAAAAAAFVVAwUHCLcBAQESAAAHAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8A/wYTKxsC79eVAAAA1QIAAAAAAAAAADPe3gIA//3Z///+/AD//v7//v7///7+///+/v///v7///7+///+/v///v7///7+///+/v///v7///7+///+/v///v7///7+/wH++v/+9+k6////JgAAAAAEAAAAAAAAAAANDQ3/9+LCcwMIDGEB/vs1AAD/DgIBAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD+/fn9//v18wAAAAAAAAAABAAAAAAAAAAAwMDA/UZGRt0N/g2q/wAA0gEBAQ39AAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////gAAAPD////YAAAAAAQAAAAAAAAAAAAAAP8LIkUAAwT9AwD8+uoCAP/x////AQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP779vD+8d3a/f395QAAAAAEAAAAAAAAAAAAAAABCQwVtQEBADQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/4+gABewTw260AAADzAgAAAAAAAAAAM2ZmBAEA/xsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8BBwD++FYBAQErAAAAAAQAAAAAAAAAAADNzQD5MRBsAwIIagD++igAAP4K////AQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAH7+PwA9+gIAAAADAAAAAAEAAAAAAAAAADNzc39FxcXzQYGBqACAgIwAgICDv///wIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAf/////+AAAA7gICAuAAAAAABAAAAAAAAAAAAAAA/uHh4ecfHx+8AwMDzAYGBgb+/v4BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/f39/wMDA/j29vboAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAA/gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAApkUqF3zKmm8AAAAASUVORK5CYII=");
a.legendG.append("text").attr("x","25").style("font-size","18").text("Legend");a.legendDispG=a.svg.append("g").attr("id","legendDisp").attr("transform","translate(10,70)").style("opacity",1);a.drawLegend();setTimeout(function(){a.legendDispG.transition().duration(750).style("opacity",0)},8E3)};a.drawLegend=function(){};a.createToolTip=function(e){var c="Gene: "+e.Gene.geneSymbol+" ("+e.Gene.ID+")<BR><BR>Transcript:"+e.ID+"<BR>";c=c+"<BR>Link Count:"+e.LinkCount;c=c+"<BR>Link Sum:"+e.LinkSum.toFixed(2);
var h=that.selectedGene[e.Gene.ID].tcList;if(1<h.length){"<BR><BR>Additional Transcripts in this Module:<BR>";h=that.selectedGene[e.Gene.ID].tcList;for(var f=0;f<h.length;f++)h[f].ID!==e.ID&&(c=c+h[f].ID+"<BR>")}e.PSList&&"array"===that.selSource&&(c=c+"<BR><BR>"+e.PSList.length+" Probe Sets in Transcript<BR>");return c};return a};that.singleWGCNAImageGeneView=function(){var a=that.singleWGCNAImage();$(".goCTL").hide();$(".eqtlCtls").hide();if("gene"===that.viewType)$(".linkCTL").show(),$(".mirCTL").hide(),
a.showMirLinks=0;else{$(".mirCTL").show();$(".linkCTL").hide();a.showLinks=1;a.geneList={};a.geneMirList={};for(var e=that.selectedModule.TCList,c=0;c<e.length;c++)a.geneList[that.selectedModule.TCList[c].Gene.ID]=that.selectedModule.TCList[c].Gene.geneSymbol;a.showMirLinks=1;a.showAllFromTarget=0}a.CorCutoff_min=.75;a.CorCutoff_max=1;a.type=that.viewType;a.truncated=0;a.filterOneDB=1;a.mirGeneCutoff=1;a.mirValid=0;a.mirTargetID="";a.mirID="";a.miRcolor=d3.scaleOrdinal(d3.schemeCategory20b);a.sortMir=
0;a.maxCorWidth=5;a.drawLinks=function(h){"gene"===that.viewType?a.updateColor("linkColor"):"mir"===that.viewType&&a.updateColor("mirlinkColor");a.svg.selectAll(".link").remove();for(var f=that.selectedModule.LinkList,g=[],l=0,n=0;n<f.length;n++)(f[n].TC1===h.ID||f[n].TC2===h.ID)&&a.CorCutoff_min<=Math.abs(f[n].Cor)&&Math.abs(f[n].Cor)<=a.CorCutoff_max&&(g[l]=f[n],l++);f=g;1E4>f.length&&(h=a.topG.selectAll(".link").data(f,a.linkKey),h.enter().append("line").attr("class","link").attr("pointer-events",
"none").attr("id",function(p){return"ln_"+that.removeInvalidIDChars(p.TC1)+that.removeInvalidIDChars(p.TC2)}).attr("x1",function(p){return d3.select("#tc_"+that.removeInvalidIDChars(p.TC1)).attr("cx")}).attr("y1",function(p){return d3.select("#tc_"+that.removeInvalidIDChars(p.TC1)).attr("cy")}).attr("x2",function(p){return d3.select("#tc_"+that.removeInvalidIDChars(p.TC2)).attr("cx")}).attr("y2",function(p){return d3.select("#tc_"+that.removeInvalidIDChars(p.TC2)).attr("cy")}).attr("stroke",a.colorLink).attr("stroke-width",
function(p){return Math.abs(p.Cor)*a.maxCorWidth}).merge(h))};a.drawLinksBetween=function(h){for(var f={},g=0;g<h.length;g++)f[h[g]]=1;"gene"===that.viewType?a.updateColor("linkColor"):"mir"===that.viewType&&a.updateColor("mirlinkColor");a.svg.selectAll(".link").remove();h=that.selectedModule.LinkList;g=[];for(var l=0,n=0;n<h.length;n++)(0===a.showAllFromTarget&&"undefined"!==typeof f[h[n].TC1]&&"undefined"!==typeof f[h[n].TC2]||1===a.showAllFromTarget&&("undefined"!==typeof f[h[n].TC1]||"undefined"!==
typeof f[h[n].TC2]))&&a.CorCutoff_min<=Math.abs(h[n].Cor)&&Math.abs(h[n].Cor)<=a.CorCutoff_max&&(g[l]=h[n],l++);h=g;1E4>h.length&&(f=a.svg.select("g.svg-pan-zoom_viewport").selectAll(".link").data(h,a.linkKey),f.enter().append("line").attr("class","link").attr("pointer-events","none").attr("id",function(p){return"ln_"+that.removeInvalidIDChars(p.TC1)+that.removeInvalidIDChars(p.TC2)}).attr("x1",function(p){return d3.select("#tc_"+that.removeInvalidIDChars(p.TC1)).attr("cx")}).attr("y1",function(p){return d3.select("#tc_"+
that.removeInvalidIDChars(p.TC1)).attr("cy")}).attr("x2",function(p){return d3.select("#tc_"+that.removeInvalidIDChars(p.TC2)).attr("cx")}).attr("y2",function(p){return d3.select("#tc_"+that.removeInvalidIDChars(p.TC2)).attr("cy")}).attr("stroke",a.colorLink).attr("stroke-width",function(p){return Math.abs(p.Cor)*a.maxCorWidth}).merge(f))};a.nodeX=function(h,f){var g=50,l=Math.floor(f/a.maxPerLevel)+1;1<l&&(g=60*l);return a.width/2+(a.r-g)*Math.cos(f%a.maxPerLevel*a.angle-1.57079633)};a.nodeY=function(h,
f){var g=50;f>a.maxPerLevel&&(g=60*(Math.floor(f/a.maxPerLevel)+1));return a.height/2+(a.r-g)*Math.sin(f%a.maxPerLevel*a.angle-1.57079633)};a.nodeXLbl=function(h,f){var g=f%a.maxPerLevel*a.angle-1.57079633,l=1;if(Math.PI/2<g&&g<1.5*Math.PI){var n=0;"undefined"!==typeof h.Gene.geneSymbol&&(n=h.Gene.geneSymbol.length);l+=7.5*n}return a.width/2+(a.r+l)*Math.cos(g)};a.nodeYLbl=function(h,f){var g=f%a.maxPerLevel*a.angle-1.57079633,l=1;if(Math.PI/2<g&&g<1.5*Math.PI){var n=0;"undefined"!==typeof h.Gene.geneSymbol&&
(n=h.Gene.geneSymbol.length);l+=7.5*n}return a.height/2+(a.r+l)*Math.sin(g)};a.drawCorLegend=function(h){a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",h).text("Positive Correlation");a.legendDispG.append("rect").attr("x","0").attr("y",h-10).attr("width","30").attr("height","10").style("fill",a.posColor);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",h+20).text("Negative Correlation");a.legendDispG.append("rect").attr("x","0").attr("y",h+
10).attr("width","30").attr("height","10").style("fill",a.negColor);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",h+40).text("Lower Correlation");a.legendDispG.append("line").attr("x1","0").attr("y1",h+30).attr("x2","30").attr("y2",h+30).style("stroke","#000000").style("stroke-width","0");a.legendDispG.append("line").attr("x1","0").attr("y1",h+35).attr("x2","30").attr("y2",h+35).style("stroke","#000000").style("stroke-width","0.5");a.legendDispG.append("line").attr("x1",
"0").attr("y1",h+40).attr("x2","30").attr("y2",h+40).style("stroke","#000000").style("stroke-width","1");a.legendDispG.append("line").attr("x1","0").attr("y1",h+45).attr("x2","30").attr("y2",h+45).style("stroke","#000000").style("stroke-width","2");a.legendDispG.append("line").attr("x1","0").attr("y1",h+55).attr("x2","30").attr("y2",h+55).style("stroke","#000000").style("stroke-width","3");a.legendDispG.append("line").attr("x1","0").attr("y1",h+65).attr("x2","30").attr("y2",h+65).style("stroke","#000000").style("stroke-width",
"5");a.legendDispG.append("line").attr("x1","0").attr("y1",h+75).attr("x2","30").attr("y2",h+75).style("stroke","#000000").style("stroke-width","7");a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",h+80).text("Higher Correlation")};a.drawMirSupportLegend=function(h){a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",h).text("Validated miRNA Target");a.legendDispG.append("rect").attr("x","0").attr("y",h-10).attr("width","30").attr("height","10").style("fill",
a.mirVal);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",h+20).text("Predicted miRNA Target");a.legendDispG.append("rect").attr("x","0").attr("y",h+10).attr("width","30").attr("height","10").style("fill",a.mirPred);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",h+40).text("Lower support of targeting");a.legendDispG.append("line").attr("x1","0").attr("y1",h+30).attr("x2","30").attr("y2",h+30).style("stroke","#000000").style("stroke-width",
"0");a.legendDispG.append("line").attr("x1","0").attr("y1",h+35).attr("x2","30").attr("y2",h+35).style("stroke","#000000").style("stroke-width","0.5");a.legendDispG.append("line").attr("x1","0").attr("y1",h+40).attr("x2","30").attr("y2",h+40).style("stroke","#000000").style("stroke-width","1");a.legendDispG.append("line").attr("x1","0").attr("y1",h+45).attr("x2","30").attr("y2",h+45).style("stroke","#000000").style("stroke-width","2");a.legendDispG.append("line").attr("x1","0").attr("y1",h+55).attr("x2",
"30").attr("y2",h+55).style("stroke","#000000").style("stroke-width","3");a.legendDispG.append("line").attr("x1","0").attr("y1",h+65).attr("x2","30").attr("y2",h+65).style("stroke","#000000").style("stroke-width","5");a.legendDispG.append("line").attr("x1","0").attr("y1",h+75).attr("x2","30").attr("y2",h+75).style("stroke","#000000").style("stroke-width","7");a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",h+80).text("Higher support of targeting")};a.drawLegend=function(){"gene"===
that.viewType?a.drawCorLegend(20):(a.drawMirSupportLegend(20),a.showLinks||a.drawCorLegend(130))};a.draw=function(){"mir"===that.viewType?(a.requestMiR(),a.updateColor("mirlinkColor")):"gene"===that.viewType&&a.updateColor("linkColor");a.width=$(window).width();a.height=Math.floor(.9*window.innerHeight);a.r=a.height>a.width?Math.floor(a.width/2*.95):Math.floor(a.height/2*.95);a.svg.attr("height",a.height+"px");a.svg.selectAll("circle").remove();a.svg.selectAll("text").remove();a.svg.selectAll("line").remove();
a.svg.selectAll(".geneTC").remove();"undefined"!==typeof a.panZoom&&(a.panZoom.destroy(),delete a.panZoom);a.svg.selectAll(".svg-pan-zoom_viewport").remove();setTimeout(function(){a.svg.append("text").style("font-size","20").attr("y",22).attr("x",5).text(function(){return that.selectedModule?replaceUnderscore(that.selectedModule.MOD_NAME):""});a.setupLegend();a.data=that.selectedModule.TCList;a.angle=2*Math.PI/a.data.length;a.angleDeg=360/a.data.length;a.data.length>a.maxPerLevel&&(a.angle=2*Math.PI/
a.maxPerLevel,a.angleDeg=360/a.maxPerLevel);a.data.sort(function(n,p){return n.LinkSum===p.LinkSum?0:n.LinkSum>p.LinkSum?-1:1});if(150<a.data.length){a.truncated=1;a.maxNodeR=15;for(var h=[],f=0;150>f;f++)h[f]=a.data[f];a.data=h;a.dataIndex={};for(f=0;f<a.data.length;f++)a.dataIndex[a.data[f].ID]=1;a.CorCutoff_min=.85;$("#linkSliderMin").slider("value",.85);$("span#minLabel").html(.85);a.svg.append("image").attr("x",7.8*that.selectedModule.MOD_NAME.length+20).attr("y",1).attr("width","24px").attr("height",
"24px").attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAJI0lEQVRIDQEYCef2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAAH/gAACcAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAADwAAALkCAABoFDEx0gIzM+/b29v4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGIAAAAvAgAAHDnn54QGBgY3SUlJBwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8AAB0AAAChAAAADAAAAAAU9vYY4RER/ecNDdLZ2dnvAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB5AAAAFgAAAAAAAAAABv7+BFHZ2UgFAgI4Ozs7DAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAtAAAAmAAAAAQAAAAAAAAAAAAAAAAU9/cM7AoKAOYYGNTZ2dnqAAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAFAAAAnQAAACf8AgIAzhgY/uIODv4V9vYBBP//AR3z8xrKHBzjDhwc2uDg4PYAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASwAAAEUAAAAB+AMDAJwyMveSODjT9QUF+AAAAAAY9PQOTN3dTxISEipAQEAEAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAADAAAAIAAAAAEAAAAAAAAAAAC/v7vAv7+tQn7+/IAAAAAAAAAAT/g4DQd8/NHCgoKFAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGcAAAAuAAAAAAAAAAAAAAAAAAEB+gP//+QF///7AAAAAAAAAAAQ+voIVtfXUggICDM5OTkJAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAP8AABYAAAB4AAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAATXm5iYt6+tMExMTHAAAAAEAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB7AAAAEwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAF/v4CVdfXSw0EBDdAQEALAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAD/AAAzAAAAkwAAAAYAAAAAAAAAAAAAAAAAAQEAAAAA/kDh4QAb8/MpAgAACAAAAAAAAAAAAAAAABT29g7vCAgB4RYW1NnZ2eoAAAD/AAAAAAAAAAAAAAAAAAAAAAD/AAAE/wAAtf8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD/5Q0N7WNKSnFHR0cSAAAAAAAAAAADAAAAAAAAAAAAAAAAgAAATAAAAHkAAAADAAAAAAAAAAAAAAAAAAAAAPgEBP+XMzP7xR8f7ivq6gcH/f0CAAAAAAAAAAAAAAAAAAAAAAz6+gj9AgIM2Bsb0QoKCujn5+f+AgAAAAAAAAAA/wAABwAAAIkAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAD9AQEA1hUV9MwZGccAAAD2AAAAAAAAAAAAAAAAAAAAAAAAAAABAAABR97eNhb390ceHh4RAAAAAAAAAAAAAAAAAP8AAG//AAD+/wAA//8AAP//AAD//wAA//8AAP//AAD//gAA/u4ICPvzBQXw/gAA/P8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP/CHR3SVVBQNgAAAAACAAAAAP8AAAgAAABfAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAER+PgEDPv7DwEAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMOnpJyHy8icAAAAABAAAAAABAAD42BMTgdUTE2buCwsz/QICCQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8BAAD/AAEBAf8AAAEAAAAAAAAAAAAAAAAAAAAAAAAAAPEHB/vhEBANAAAAAAQAAAAAAAAAAHU6OrsDAwPnAgICIQEBAQUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQH//f39zgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAs0IPw6I24JoAAAAASUVORK5CYII=").attr("pointer-events",
"all").style("cursor","pointer").on("mouseover",function(){$("#wgcnaMouseHelp").html("Warning: Transcripts displayed are truncated to the top 150 most connected transcripts due to the size of the module.")}).on("mouseout",function(){$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")})}else a.maxNodeR=28;a.topG=a.svg.append("g").attr("class","svg-pan-zoom_viewport");if("gene"===that.viewType){h=a.topG.selectAll(".geneTC").data(a.data,a.geneKey);
h.enter().append("circle").attr("class","geneTC").attr("id",function(n){return"tc_"+that.removeInvalidIDChars(n.ID)}).attr("cx",a.nodeX).attr("cy",a.nodeY).attr("r",3).attr("stroke","#000000").attr("fill","#FF0000").merge(h);h=that.selectedModule.LinkList;f=[];for(var g=0,l=0;l<h.length;l++)a.CorCutoff_min<=Math.abs(h[l].Cor)&&Math.abs(h[l].Cor)<=a.CorCutoff_max&&(0===a.truncated||"undefined"!==typeof a.dataIndex[h[l].TC1]&&"undefined"!==typeof a.dataIndex[h[l].TC2])&&(f[g]=h[l],g++);h=f;a.showLinks&&
1E4>h.length&&a.topG.selectAll(".link").data(h,a.linkKey).enter().append("line").attr("class","link").attr("id",function(n){return"ln_"+that.removeInvalidIDChars(n.TC1)+that.removeInvalidIDChars(n.TC2)}).attr("x1",function(n){return d3.select("#tc_"+that.removeInvalidIDChars(n.TC1)).attr("cx")}).attr("y1",function(n){return d3.select("#tc_"+that.removeInvalidIDChars(n.TC1)).attr("cy")}).attr("x2",function(n){return d3.select("#tc_"+that.removeInvalidIDChars(n.TC2)).attr("cx")}).attr("y2",function(n){return d3.select("#tc_"+
that.removeInvalidIDChars(n.TC2)).attr("cy")}).attr("stroke",a.colorLink).attr("stroke-width",function(n){return Math.abs(n.Cor)*a.maxCorWidth})}a.topG.selectAll(".geneTC").remove();h=a.topG.selectAll(".geneTC").data(a.data,a.geneKey);h.enter().append("g").append("circle").attr("cx",a.nodeX).attr("cy",a.nodeY).attr("r",a.nodeRadiusSum).attr("stroke","#000000").attr("fill",a.colorCircle).attr("class",function(n){return"geneTC "+n.Gene.ID}).attr("id",function(n){return"tc_"+that.removeInvalidIDChars(n.ID)}).on("click",
function(){}).on("mouseover",a.mouseoverGene).on("mouseout",a.mouseleaveGene).merge(h).each(function(n,p){d3.select(this.parentNode).append("g").attr("class","label").attr("id",function(t){return"txt_"+that.removeInvalidIDChars(t.ID)}).attr("transform",function(){var t=a.nodeXLbl(n,p),v=a.nodeYLbl(n,p);return"translate("+t+","+v+")"}).append("text").attr("transform",function(){var t=-90+p%a.maxPerLevel*a.angleDeg;90<t&&(t-=180);return"rotate("+t+")"}).text(function(){return n.Gene.geneSymbol})});
h.exit().remove();"mir"===that.viewType&&a.drawMiR()},250)};a.requestMiR=function(){$.ajax({url:contextRoot+"tmpData/browserCache/"+genomeVer+"/modules/ds"+that.wDSID+"/"+replaceUnderscore(that.selectedModule.MOD_NAME)+".miR.json",type:"GET",async:!0,data:{},dataType:"json",success:function(h){setTimeout(function(){a.mirData=h;a.geneMirList={};for(var f=0;f<a.mirData.MIRList.length;f++)for(var g=a.mirData.MIRList[f],l=g.GeneList,n=0;n<l.length;n++)if("undefined"===typeof a.geneMirList[l[n].ID])a.geneMirList[l[n].ID]=
[],a.geneMirList[l[n].ID].push(g);else{for(var p=0,t=0;t<a.geneMirList[l[n].ID].length&&0===p;t++)g.ID===a.geneMirList[l[n].ID][t].ID&&(p=1);0===p&&a.geneMirList[l[n].ID].push(g)}a.drawMiR();that.singleWGCNATableMirView()},50)},error:function(h,f,g){setTimeout(function(){a.requestMiR()},2E3)}})};a.drawMiR=function(){if("undefined"!==typeof a.topG&&"undefined"!==typeof a.mirData){a.svg.select("#mirG").remove();a.miRdiameter=1.5*a.r;a.miRformat=d3.format(",d");a.miRbubble=d3.pack().size([a.miRdiameter,
a.miRdiameter]).padding(1.5);var h=a.runMirFilter(a.mirData.MIRList);a.hierarch=d3.hierarchy({children:h}).sum(function(f){return f.filterGLSize});a.mirNode=a.miRbubble(a.hierarch.sort());h=a.topG.append("g").attr("id","mirG").attr("transform",function(){return"translate("+(a.width/2-a.miRdiameter/2)+","+(a.height/2-a.miRdiameter/2)+")"}).selectAll(".node").data(a.hierarch.leaves(),that.mirKey);h.enter().append("g").attr("class","node").attr("id",function(f){return that.removeInvalidIDChars(f.ID)}).attr("transform",
function(f){return"translate("+f.x+","+f.y+")"}).merge(h).on("mouseover",a.mouseoverMir).on("mouseleave",a.mouseleaveMir);h.exit().remove();d3.selectAll(".node").each(function(f){var g=f.data;if(0<f.depth){d3.select(this).append("circle").attr("r",function(n){return n.r}).style("fill",function(n){return a.miRcolor(g.ID)});var l=g.ID.substring(8);l.length<f.r/3&&d3.select(this).append("text").attr("dy",".2em").attr("pointer-events","none").style("text-anchor","middle").style("cursor","pointer").append("tspan").attr("x",
0).attr("dy","-0.5em").text("miR").append("tspan").attr("x",0).attr("dy","1em").text(l)}})}};a.sortMirFunction=function(h,f){return 0<a.sortMir?h.value-f.value:0>a.sortMir?f.value-h.value:0};a.runMirFilter=function(h){var f=h;if(1===a.filterOneDB||1<a.mirGeneCutoff||1===a.mirValid||0<a.mirID.length||0<a.mirTargetID.length){var g=0;f=[];for(var l=0;l<h.length;l++)a.filterMiR(h[l])&&(f[g]=h[l],g++)}return f};a.filterMiR=function(h){val=!0;h.GeneList.length<a.mirGeneCutoff&&(val=!1);val&&1===a.mirValid&&
0===h.vC&&(val=!1);val&&0<a.mirID.length&&(-1<h.ID.toLowerCase().indexOf(a.mirID)||-1<h.ACC.toLowerCase().indexOf(a.mirID)||(val=!1));if(val&&0<a.mirTargetID.length){for(var f=!1,g=0;g<h.GeneList.length&&!f;g++)if(1===a.filterOneDB)(1<h.GeneList[g].P||0<h.GeneList[g].V)&&(-1<h.GeneList[g].ID.toLowerCase().indexOf(a.mirTargetID)||-1<a.geneList[h.GeneList[g].ID].toLowerCase().indexOf(a.mirTargetID))&&(f=!0);else if(-1<h.GeneList[g].ID.toLowerCase().indexOf(a.mirTargetID)||-1<a.geneList[h.GeneList[g].ID].toLowerCase().indexOf(a.mirTargetID))f=
!0;f||(val=!1)}if(val&&1===a.filterOneDB&&"undefined"===typeof h.filterGLSize){for(g=f=0;g<h.GeneList.length;g++)(1<h.GeneList[g].P||0<h.GeneList[g].V)&&f++;h.filterGLSize=f;0===h.filterGLSize&&0===h.vC&&(val=!1)}else val&&1===a.filterOneDB&&0===h.filterGLSize&&0===h.vC&&(val=!1);return val};a.filterRevMiR=function(h){var f=[];if("undefined"!==typeof h)if(1===a.filterOneDB)for(var g=0;g<h.length;g++)(0<h[g].filterGLSize||0<h[g].vC)&&f.push(h[g]);else f=h;return f};a.filterMiRGenes=function(h){var f=
[];if(1===a.filterOneDB)for(var g=0;g<h.length;g++)(1<h[g].P||0<h[g].V)&&f.push(h[g]);else f=h;return f};a.createMirToolTip=function(h){return'<div id="ttSVG"></div>ID: '+h.ID+"<BR>Accession: "+h.ACC+"<BR><BR>Genes Targeted within Module: "+h.filterGLSize+"<BR>"};a.mouseoverMir=function(){var h=d3.select(this).data()[0],f=h.data,g=f.GeneList;g=a.filterMiRGenes(g);d3.select(this).style("opacity","0.3");tt.transition().duration(200).style("opacity",1);tt.html(a.createMirToolTip(f)).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",
function(){return that.positionTTTop(d3.event.pageY)});f=a.svg.select("g.svg-pan-zoom_viewport").selectAll(".mirlink").data(g,that.mirKey);f.enter().append("line").attr("class","mirlink").attr("pointer-events","none").attr("id",function(t){return"ln_"+t.ID}).attr("x1",function(t){return h.x+a.width/2-a.miRdiameter/2}).attr("y1",function(t){return h.y+a.height/2-a.miRdiameter/2}).attr("x2",function(t){var v=h.x+a.width/2-a.miRdiameter/2;0<d3.select("."+t.ID).size()&&(v=d3.select("."+t.ID).attr("cx"));
return v}).attr("y2",function(t){var v=h.y+a.height/2-a.miRdiameter/2;0<d3.select("."+t.ID).size()&&(v=d3.select("."+t.ID).attr("cy"));return v}).attr("stroke",function(t){var v=a.mirPred;0<t.V&&(v=a.mirVal);return v}).attr("stroke-width",function(t){return t.P+3*t.V}).merge(f);if(!a.showLinks){f=[];for(var l=0;l<g.length;l++)for(var n=d3.selectAll("."+g[l].ID).nodes(),p=0;p<n.length;p++)"undefined"!==typeof n[p]&&f.push(d3.select(n[p].parentNode).datum().ID);a.drawLinksBetween(f)}gtag("event","mouseOverMir",
{event_category:"wgcna"})};a.mouseleaveMir=function(){d3.select(this).style("opacity","1");tt.transition().duration(200).style("opacity",0);a.svg.selectAll(".mirlink").remove();a.svg.selectAll(".link").remove()};a.mouseoverGene=function(){$("#wgcnaMouseHelp").html("<B>Click</B> to select this gene cluster and see additional details.");d3.select(this).style("fill","url(#selectGrad)");tt.transition().duration(200).style("opacity",1);tt.html(a.createToolTip(d3.select(this).data()[0])).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",
function(){return that.positionTTTop(d3.event.pageY)});var h=d3.select(this.parentNode).datum();"mir"===that.viewType?(a.mirTargetID=h.Gene.ID.toLowerCase(),that.singleImage.drawMiR(),a.svg.selectAll(".link").remove()):($("[id^=ln_"+that.removeInvalidIDChars(h.ID)+"]").each(function(){var n=$(this).attr("id");d3.select("line#"+n).attr("stroke",a.colorLinkHighlight)}),$("[id$="+that.removeInvalidIDChars(h.ID)+"]").each(function(){var n=$(this).attr("id");d3.select("line#"+n).attr("stroke",a.colorLinkHighlight)}));
a.showLinks||a.drawLinks(h);d3.select("#txt_"+that.removeInvalidIDChars(h.ID)).select("text").attr("fill","#00A347");for(var f=that.selectedGene[h.Gene.ID].tcList,g=0;g<f.length;g++)d3.select("#tc_"+that.removeInvalidIDChars(f[g].ID)).attr("fill","#FEFF49");if("mir"===that.viewType&&a.showMirLinks){var l=h.Gene.ID;h=a.geneMirList[h.Gene.ID];h=a.filterRevMiR(h);h=a.svg.select("g.svg-pan-zoom_viewport").selectAll(".mirlink").data(h,that.mirKey);h.enter().append("line").attr("class","mirlink").attr("pointer-events",
"none").attr("id",function(n){return"ln_"+n.ID}).attr("x1",function(n){var p=d3.select("."+l).attr("cx");0<d3.select("#"+that.removeInvalidIDChars(n.ID)).size()&&(p=d3.select("#"+that.removeInvalidIDChars(n.ID))[0][0].__data__.x+a.width/2-a.miRdiameter/2);return p}).attr("y1",function(n){var p=d3.select("."+l).attr("cy");0<d3.select("#"+that.removeInvalidIDChars(n.ID)).size()&&(p=d3.select("#"+that.removeInvalidIDChars(n.ID))[0][0].__data__.y+a.height/2-a.miRdiameter/2);return p}).attr("x2",function(n){return d3.select("."+
l).attr("cx")}).attr("y2",function(n){return d3.select("."+l).attr("cy")}).attr("stroke",function(n){var p=a.mirPred;0<n.V&&(p=a.mirVal);return p}).attr("stroke-width",function(n){return n.P+3*n.V}).merge(h)}gtag("event","mouseOverGene",{event_category:"wgcna"})};a.mouseleaveGene=function(){var h=d3.select(this.parentNode).datum();$("[id^=ln_"+that.removeInvalidIDChars(h.ID)+"]").each(function(){var f=$(this).attr("id");d3.select("line#"+f).attr("stroke",a.colorLink)});$("[id$="+that.removeInvalidIDChars(h.ID)+
"]").each(function(){var f=$(this).attr("id");d3.select("line#"+f).attr("stroke",a.colorLink)});d3.select(this).style("fill",a.colorCircle);d3.select("#txt_"+that.removeInvalidIDChars(h.ID)).select("text").attr("fill","#000000");tt.transition().duration(500).style("opacity",0);a.showLinks||a.svg.selectAll(".link").remove();"mir"===that.viewType&&(a.mirTargetID=$("#mirGeneFilterTxt").val().toLowerCase(),a.svg.selectAll(".mirLink").remove(),that.singleImage.drawMiR())};return a};that.singleWGCNATableGeneView=
function(){"undefined"!==typeof that.selectedModule?($("div#waitModuleTable").hide(),$("div#wgcnaEqtlTable").hide(),$("div#wgcnaMirTable").hide(),$("div#wgcnaMirGeneTable").hide(),$("div#wgcnaGoTable").hide(),$("div#wgcnaModuleTable").show(),$("span#modTableName").html(that.selectedModule.MOD_NAME),d3.select("div#tableExportCtl").selectAll("span").remove(),d3.select("div#tableExportCtl").append("span").attr("class","button").style("margin-right","10px").on("click",function(){$("#moduleTable").tableExport({type:"csv",
escape:"false"})}).html("Export CSV"),$.fn.DataTable.isDataTable("table#moduleTable")&&$("table#moduleTable").DataTable().destroy(),d3.select("table#moduleTable").select("tbody").selectAll("tr").remove(),d3.select("table#moduleTable").select("tbody").selectAll("tr").data(that.selectedModule.TCList,that.geneKey).enter().append("tr").attr("id",function(a){return"modtrx"+a.ID}).attr("class",function(a,e){var c="odd";0===e%2&&(c="even");return c}).each(function(a,e){d3.select(this).append("td").html(a.Gene.geneSymbol);
d3.select(this).append("td").html(a.Gene.ID);d3.select(this).append("td").html(a.ID);a.PSList?d3.select(this).append("td").html(a.PSList.length):d3.select(this).append("td").html("0");d3.select(this).append("td").html(a.LinkSum.toFixed(2))}),$("table#moduleTable").DataTable({bPaginate:!1,aaSorting:[[4,"desc"]],sDom:"fiB<t>",buttons:["copy","excel","pdf"]})):($("div#waitModuleTable").hide(),$("div#wgcnaEqtlTable").hide(),$("div#wgcnaModuleTable").hide(),$("div#wgcnaGoTable").hide())};that.singleWGCNATableMirView=
function(){var a={orgPref:"mmu-",runMirFilter:function(h){for(var f=[],g=0,l=0;l<h.length;l++)if(0<h[l].filterGLSize||0<h[l].vC)f[g]=h[l],g++;return f},createMirTable:function(){$("div#waitMirTable").hide();$("div#wgcnaMirGeneTable").hide();$("div#wgcnaMirTable").show();$("span#mirTableName").html(that.selectedModule.MOD_NAME);$.fn.DataTable.isDataTable("table#mirTable")&&$("table#mirTable").DataTable().destroy();d3.select("table#mirTable").select("tbody").selectAll("tr").remove();var h=a.runMirFilter(that.singleImage.mirData.MIRList);
d3.select("table#mirTable").select("tbody").selectAll("tr").data(h,that.mirKey).enter().append("tr").attr("id",function(f){return"mirTR"+that.removeInvalidIDChars(f.ID)}).attr("class",function(f,g){var l="odd";0===g%2&&(l="even");return l}).each(function(f,g){for(var l=0,n=[],p=0,t=[],v=f.GeneList,y=0;y<v.length;y++)0<v[y].V?(l++,n.push(v[y])):1<v[y].P&&(p++,t.push(v[y]));d3.select(this).append("td").html(f.ID);d3.select(this).append("td").html(f.ACC);d3.select(this).append("td").html(function(){if(0<
p){var w='<span class="triggerpL" name="pl'+g+'">'+p+"</span><BR>";w=w+'<span id="pl'+g+'" style="display:none;" >';for(var A=0;A<t.length;A++){0<A&&(w+=", ");var C=t[A].ID;"undefined"!==typeof that.singleImage.geneList[C]&&(C=that.singleImage.geneList[C]);w+=C}w+="</span>"}else w=p;return w});d3.select(this).append("td").html(function(){if(0<l){var w='<span class="triggervL" name="vl'+g+'">'+l+"</span><BR>";w=w+'<span id="vl'+g+'" style="display:none;" >';for(var A=0;A<n.length;A++){0<A&&(w+=", ");
var C=n[A].ID;"undefined"!==typeof that.singleImage.geneList[C]&&(C=that.singleImage.geneList[C]);w+=C}w+="</span>"}else w=l;return w});d3.select(this).append("td").html(function(){var w=p+l;if(0<w){w='<span class="triggerMiL" name="mil'+g+'">'+w+"</span><BR>";w=w+'<span id="mil'+g+'" style="display:none;" >';if(0<n.length){w+="Validated: ";for(var A=0;A<n.length;A++){0<A&&(w+=", ");var C=n[A].ID;"undefined"!==typeof that.singleImage.geneList[C]&&(C=that.singleImage.geneList[C]);w+=C}}if(0<t.length)for(0<
n.length&&(w+="<BR><BR>"),w+="Predicted: ",A=0;A<t.length;A++)0<A&&(w+=", "),C=t[A].ID,"undefined"!==typeof that.singleImage.geneList[C]&&(C=that.singleImage.geneList[C]),w+=C;w+="</span>"}return w})});$("#mirTable .triggerMiL").on("click",function(f){var g=this.getAttribute("name");$("#"+g).is(":hidden")?($(this).addClass("less"),$("span#"+g).show()):($(this).removeClass("less"),$("span#"+g).hide());f.stopPropagation()});$("#mirTable .triggerpL").on("click",function(f){var g=this.getAttribute("name");
$("#"+g).is(":hidden")?($(this).addClass("less"),$("span#"+g).show()):($(this).removeClass("less"),$("span#"+g).hide());f.stopPropagation()});$("#mirTable .triggervL").on("click",function(f){var g=this.getAttribute("name");$("#"+g).is(":hidden")?($(this).addClass("less"),$("span#"+g).show()):($(this).removeClass("less"),$("span#"+g).hide());f.stopPropagation()});$("table#mirTable").DataTable({bPaginate:!1,aaSorting:[[4,"desc"]],sDom:'fB<"rightTable"i><t>',buttons:["copy","excel","pdf"]})},createMirGeneTable:function(){$("div#waitMirGeneTable").hide();
$("div#wgcnaMirGeneTable").show();$("div#wgcnaMirTable").hide();$("span#mirGeneTableName").html(that.selectedModule.MOD_NAME);d3.select("table#mirGeneTable").select("tbody").selectAll("tr").remove();d3.select("table#mirGeneTable").select("tbody").selectAll("tr").data(that.selectedModule.TCList,that.geneKey).enter().append("tr").attr("id",function(h){return"mirg"+that.removeInvalidIDChars(h.ID)}).attr("class",function(h,f){var g="odd";0===f%2&&(g="even");return g}).each(function(h,f){var g=that.singleImage.geneMirList[h.Gene.ID],
l=0,n=[],p=0,t=[];if("undefined"!==typeof g)for(var v=0;v<g.length;v++)for(var y=g[v].GeneList,w=0,A=0;A<y.length&&0===w;A++)y[A].ID===h.Gene.ID&&(0<y[A].V?(l++,n.push(g[v])):1<y[A].P&&(p++,t.push(g[v])),w=1);d3.select(this).append("td").html(h.Gene.geneSymbol);d3.select(this).append("td").html(h.Gene.ID);d3.select(this).append("td").html(function(C,F){if(0<p){var E='<span class="triggerpL" name="pl'+f+'">'+p+"</span><BR>";E=E+'<span id="pl'+f+'" style="display:none;" >';for(var D=0;D<t.length;D++){0<
D&&(E+=", ");var z=t[D].ID.replace(a.orgPref,"");E+=z}E+="</span>"}else E=p;return E});d3.select(this).append("td").html(function(C,F){if(0<l){var E='<span class="triggervL" name="vl'+f+'">'+l+"</span><BR>";E=E+'<span id="vl'+f+'" style="display:none;" >';for(var D=0;D<n.length;D++){0<D&&(E+=", ");var z=n[D].ID.replace(a.orgPref,"");E+=z}E+="</span>"}else E=l;return E});d3.select(this).append("td").html(function(C,F){var E=l+p;if(0<E){E='<span class="triggerMiL" name="mil'+f+'">'+E+"</span><BR>";
E=E+'<span id="mil'+f+'" style="display:none;" >';if(0<n.length){E+="Validated: ";for(var D=0;D<n.length;D++){0<D&&(E+=", ");var z=n[D].ID.replace(a.orgPref,"");E+=z}}if(0<t.length)for(0<n.length&&(E+="<BR><BR>"),E+="Predicted: ",D=0;D<t.length;D++)0<D&&(E+=", "),z=t[D].ID.replace(a.orgPref,""),E+=z;E+="</span>"}return E})});$("#mirGeneTable .triggerMiL").on("click",function(h){var f=this.getAttribute("name");$("#"+f).is(":hidden")?($(this).addClass("less"),$("span#"+f).show()):($(this).removeClass("less"),
$("span#"+f).hide());h.stopPropagation()});$("#mirGeneTable .triggerpL").on("click",function(h){var f=this.getAttribute("name");$("#"+f).is(":hidden")?($(this).addClass("less"),$("span#"+f).show()):($(this).removeClass("less"),$("span#"+f).hide());h.stopPropagation()});$("#mirGeneTable .triggervL").on("click",function(h){var f=this.getAttribute("name");$("#"+f).is(":hidden")?($(this).addClass("less"),$("span#"+f).show()):($(this).removeClass("less"),$("span#"+f).hide());h.stopPropagation()});$.fn.DataTable.isDataTable("table#mirGeneTable")&&
$("table#mirGeneTable").DataTable().destroy();$("table#mirGeneTable").DataTable({bPaginate:!1,aaSorting:[[4,"desc"]],sDom:'<"rightTable"i><"leftTable"fB><t>',buttons:["copy","excel","pdf"]})}};if("undefined"!==typeof that.selectedModule){$("div#wgcnaEqtlTable").hide();$("div#wgcnaModuleTable").hide();$("div#wgcnaGoTable").hide();d3.select("div#tableExportCtl").selectAll("span").remove();var e=d3.select("div#tableExportCtl"),c=e.append("span").style("display","inline-block").style("text-align","left").style("margin-left",
"20px").style("margin-right","10px");c.append("text").text("View by:");c.append("br");c.append("input").attr("type","radio").attr("checked","checked").attr("name","wgcnaMirTableRB").on("click",function(){a.createMirTable()});c.append("text").text(" miRNA");c.append("br");c.append("input").attr("type","radio").attr("name","wgcnaMirTableRB").on("click",function(){a.createMirGeneTable()});c.append("text").text(" Gene");e.append("span").attr("class","button").style("display","inline-block").style("margin-right",
"10px").on("click",function(){$("#moduleTable").tableExport({type:"csv",escape:"false"})}).html("Export CSV");a.createMirTable()}else $("div#waitModuleTable").hide(),$("div#wgcnaEqtlTable").hide(),$("div#wgcnaModuleTable").hide(),$("div#wgcnaMirTable").hide(),$("div#wgcnaMirGeneTable").hide(),$("div#wgcnaGoTable").hide();return a};that.singleWGCNAImageGoView=function(){var a=that.singleWGCNAImage();$(".goCTL").show();$(".linkCTL").hide();$(".mirCTL").hide();$(".eqtlCtls").hide();a.type=that.viewType;
a.goDomain="mf";a.lastDrawn="mf";a.selectedNode;a.displayedLevel="d1";a.width=$(window).width();a.height=Math.floor(.92*window.innerHeight);a.padding=5;a.radius=(Math.min(a.width,a.height)-2*a.padding)/2;a.duration=1E3;a.xScale=d3.scaleLinear().range([0,2*Math.PI]);a.yScale=d3.scalePow().exponent(1.3).domain([0,1]).range([0,a.radius]);a.colorGO=d3.scaleOrdinal(d3.schemeCategory20);a.displayDepth=3;a.geneList={};var e=[];if(that.selectedModule){e=that.selectedModule.TCList;for(var c=0;c<e.length;c++)a.geneList[that.selectedModule.TCList[c].Gene.ID]=
that.selectedModule.TCList[c].Gene.geneSymbol}a.pathColor=function(h){return h&&h.data?h.data.name&&0==h.data.name.indexOf("ENS")?"#DFC184":h.data.name?a.colorGO(h.data.name):"#000000":h&&h.name&&0==h.name.indexOf("ENS")?"#DFC184":h&&h.name?a.colorGO(h.name):"#000000"};a.addLabels=function(h,f,g,l,n,p,t){p=a.radius/(t+1)*h.depth+a.radius/(t+1)-12;var v=a.radius/(t+1)*h.depth,y=(n-g)/360*Math.PI*v*2;t=Math.floor((n-g)/360*Math.PI*p*2/7)-1;p=Math.floor((p-v)/12);var w=h.data.name;0===h.data.name.indexOf("ENS")&&
"undefined"!==typeof a.geneList[w]&&(w=a.geneList[w],25<n-g&&(w=w+" ("+h.data.name+")"));var A=w.split(" ")[0].split("-")[0];if(A.length<=t||-1===h.data.name.indexOf("ENS")&&A.length/2<=t&&10<n-g){y=[];A=0;if(w.length>t)for(;0<w.length;){var C=w.indexOf(" ");if(-1===C)w.length>t?(y[A]=w.substr(0,t),A++,w=w.substr(t)):(y[A]=w,A++,w="");else{for(var F=0;C<t&&1>F;){var E=w.indexOf(" ",C+1);-1!==E&&E<=t?C=E:F=1}C>t?-1<w.indexOf("-")&&w.indexOf("-")<t?(C=w.indexOf("-"),y[A]=w.substr(0,C+1),A++,w=w.substr(C+
1)):(y[A]=w.substr(0,t),A++,w=w.substr(t)):(y[A]=w.substr(0,C),A++,w=w.substr(C+1))}}else y[A]=w;A=a.topG.append("text").style("fill-opacity",1).style("fill","#000").attr("pointer-events","none").attr("class","txt"+removeColon(h.data.id)).attr("text-anchor",function(D){return"start"}).attr("dy","1em").style("opacity",function(D){return 1}).append("textPath").attr("xlink:href",function(D){return"#ap"+f}).attr("startOffset",function(D){return 0===g&&360===n?90:5});for(h=0;h<y.length&&h<p;h++)h<p&&(h===
p-1&&y.length>p&&(y[h]+="...",y[h].length>t&&(y[h]=y[h].substr(0,t-4)+"...")),A.append("tspan").attr("x",0).attr("dy","1em").text(y[h]))}else if(12<=y&&0===h.data.name.indexOf("ENS"))for(A=a.topG.append("text").style("fill-opacity",1).style("fill","#000").attr("pointer-events","none").attr("class","txt"+removeColon(h.data.id)).attr("text-anchor",function(D){D="start";180<=n&&(D="end");return D}).attr("dy",".2em").attr("transform",function(D){D=l-2.5;var z=v;0===g&&360===n&&(z=20);180<=n&&(D=l+2.5);
return"rotate("+(D-90)+")translate("+z+")rotate("+(180<D?-180:0)+")"}).style("opacity",function(D){return 1}),w=h.data.name,0===h.data.name.indexOf("ENS")&&"undefined"!==typeof a.geneList[w]&&(w=a.geneList[w]),t=w.split(" "),h=0;h<t.length;h++)A.append("tspan").attr("x",0).attr("dy","1em").text(t[h])};a.redraw=function(){a.svg.selectAll("path").remove();a.svg.select("#center").remove();var h=a.partition(a.rootN).descendants().filter(a.filterNodes),f=a.displayDepth;a.arc=d3.arc().startAngle(function(l){return Math.max(0,
Math.min(2*Math.PI,l.x0))}).endAngle(function(l){return Math.max(0,Math.min(2*Math.PI,l.x1))}).innerRadius(function(l){return l===a.selectedNode&&a.selectedNode!==a.data.GOList[0]&&a.selectedNode!==a.data.GOList[1]&&a.selectedNode!==a.data.GOList[2]?20:Math.max(0,a.radius/(f+1)*(l.depth-a.rootN.depth))}).outerRadius(function(l){return Math.max(0,a.radius/(f+1)*(l.depth-a.rootN.depth)+a.radius/(f+1))});a.topG.selectAll("path").remove();a.topG.selectAll("text").remove();var g=180/Math.PI;a.path=a.topG.selectAll("path").data(h);
a.path.enter().append("path").merge(a.path).attr("d",a.arc).attr("id",function(l,n){return"ap"+n}).attr("class",function(l,n){return removeColon(l.data.id)}).attr("fill-rule","evenodd").attr("fill",a.pathColor).attr("pointer-events","all").on("mouseover",a.mouseover).on("click",a.click).each(function(l,n){if(l.depth<a.rootN.depth+a.displayDepth){var p=Math.max(0,Math.min(2*Math.PI,l.x0))*g,t=Math.max(0,Math.min(2*Math.PI,l.x1))*g,v=p+(t-p)/2;0===p&&360===t&&(v=90);a.addLabels(l,n,p,v,t,l.depth-a.rootN.depth,
f)}});if(a.selectedNode!==a.data.GOList[0]&&a.selectedNode!==a.data.GOList[1]&&a.selectedNode!==a.data.GOList[2])a.svg.append("circle").attr("id","center").attr("cx",a.width/2+a.padding).attr("cy",a.height/2+a.padding).attr("r","20").attr("fill-rule","evenodd").attr("fill",function(){return a.pathColor(a.rootN.parent)}).attr("pointer-events","all").on("click",function(){if(a.rootN.parent.data===a.data.GOList[0]||a.rootN.parent.data===a.data.GOList[1]||a.rootN.parent.data===a.data.GOList[2])a.selectedNode=
null,a.draw();else{if(a.rootN.parent.data!==a.data.GOList[0]&&a.rootN.parent.data!==a.data.GOList[1]&&a.rootN.parent.data!==a.data.GOList[2])a.selectedNode=a.rootN.parent.data,a.rootN=a.rootN.parent,a.mouseover(a.rootN.parent);else{var l=a.data.GOList[0];"mf"===a.goDomain?l=a.data.GOList[2]:"bp"===a.goDomain&&(l=a.data.GOList[1]);a.selectedNode=l}a.redraw();d3.event.stopPropagation();gtag("event","mouseClickGO",{event_category:"wgcna"})}}).on("mouseover",function(l){"undefined"!==typeof a.selectedNode&&
a.selectedNode.parent!==a.data.GOList[0]&&a.selectedNode.parent!==a.data.GOList[1]&&a.selectedNode.parent!==a.data.GOList[2]?a.mouseover(a.selectedNode.parent):(tt.transition().duration(200).style("opacity",1),tt.html(a.createToolTip(a.selectedNode)).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",function(){return that.positionTTTop(d3.event.pageY)}));d3.event.stopPropagation();gtag("event","mouseOverGO",{event_category:"wgcna"})}).on("mouseleave",function(l){tt.transition().duration(200).style("opacity",
0)})};a.getModuleGOFile=function(h){"undefined"!==typeof that.selectedModule&&"undefined"!==typeof that.selectedModule.MOD_NAME&&$.ajax({url:contextRoot+"tmpData/browserCache/"+genomeVer+"/modules/ds"+that.wDSID+"/"+replaceUnderscore(that.selectedModule.MOD_NAME)+".GO.json",type:"GET",async:!0,data:{},dataType:"json",success:function(f){a.data=f;f=a.data.GOList[0];for(var g=0,l=0;l<f.length;l++)f[l].UnqID=g,g++;f=a.data.GOList[1];for(l=0;l<f.length;l++)f[l].UnqID=g,g++;f=a.data.GOList[2];for(l=0;l<
f.length;l++)f[l].UnqID=g,g++;a.draw()},error:function(f,g,l){console.log(l);25>h&&setTimeout(function(){a.getModuleGOFile(h+1)},1E3)}})};a.draw=function(){a.svg.attr("width",a.width).attr("height",a.height);a.initializeBreadcrumbTrail();a.topG=a.svg.append("g").attr("transform","translate("+[a.width/2+a.padding,a.height/2+a.padding]+")");a.partition=d3.partition().size([2*Math.PI,a.radius]);if("undefined"===typeof a.data.MOD_NAME||"undefined"!==typeof that.selectedModule.MOD_NAME&&replaceUnderscore(a.data.MOD_NAME)!==
replaceUnderscore(that.selectedModule.MOD_NAME))a.getModuleGOFile(0),a.selectedNode=null;else{if(a.goDomain!==a.lastDrawn||"undefined"===typeof a.selectedNode||null===a.selectedNode){var h=a.data.GOList[0];"mf"===a.goDomain?h=a.data.GOList[2]:"bp"===a.goDomain&&(h=a.data.GOList[1]);a.selectedNode=h;a.rootN=d3.hierarchy(h).sum(function(l){return l&&l.name&&-1<l.name.indexOf("ENS")?1:l.uniqueGene}).sort(function(l,n){return n.value-l.value})}h=a.partition(a.rootN).descendants().filter(a.filterNodes);
a.lastDrawn=a.goDomain;if(a.selectedNode===a.data.GOList[0]||a.selectedNode===a.data.GOList[1]||a.selectedNode===a.data.GOList[2])a.totalSize=a.selectedNode.uniqueGene;var f=a.displayDepth;a.arc=d3.arc().startAngle(function(l){return Math.max(0,Math.min(2*Math.PI,l.x0))}).endAngle(function(l){return Math.max(0,Math.min(2*Math.PI,l.x1))}).innerRadius(function(l){return Math.max(0,a.radius/(f+1)*l.depth)}).outerRadius(function(l){return Math.max(0,a.radius/(f+1)*l.depth+a.radius/(f+1))});setTimeout(function(){that.singleWGCNATableGoView()},
50);a.vis=a.topG.append("svg:circle").attr("r",a.radius+30).style("opacity",0).on("mouseover",a.mouseleave);var g=180/Math.PI;a.path=a.topG.selectAll("path").data(h);a.path.enter().append("path").attr("d",a.arc).attr("id",function(l,n){return"ap"+n}).attr("fill-rule","evenodd").attr("fill",a.pathColor).attr("pointer-events","all").on("mouseover",a.mouseover).on("click",a.click).each(function(l,n){var p=Math.max(0,Math.min(2*Math.PI,l.x0))*g,t=Math.max(0,Math.min(2*Math.PI,l.x1))*g,v=p+(t-p)/2;0===
p&&360===t&&(v=90);a.addLabels(l,n,p,v,t,l.depth-a.rootN.depth,f)});a.path.exit().remove();a.svg.append("g").attr("transform","translate(0,15)").append("text").style("fill-opacity",1).style("fill","#000").attr("pointer-events","none").attr("text-anchor","start").style("opacity",function(l){return 1}).text(a.selectedNode.uniqueGene+" genes in module with GO annotation")}};a.filterNodes=function(h,f){return h.depth<a.rootN.depth+a.displayDepth?!0:!1};a.click=function(h){a.selectedNode=h.data;a.rootN=
h;h.data!==a.data.GOList[0]&&h.data!==a.data.GOList[1]&&h.data!==a.data.GOList[2]?a.redraw():a.draw();d3.event.stopPropagation()};a.mouseover=function(h){if("undefined"!==typeof h&&null!==h){var f=a.data.GOList[0];"mf"===a.goDomain?f=a.data.GOList[2]:"bp"===a.goDomain&&(f=a.data.GOList[1]);var g=0;g="undefined"!==typeof h&&"undefined"!==typeof h.data.value?(100*h.data.value/f.uniqueGene).toPrecision(3):"undefined"!==typeof h?(100*h.data.uniqueGene/f.uniqueGene).toPrecision(3):100;f=g+"%";.1>g&&(f=
"< 0.1%");"undefined"!==typeof h.data.name&&-1===h.data.name.indexOf("ENS")&&(f=h.data.uniqueGene+" genes ("+f+")");d3.select("#percentage").text(f);d3.select("#explanation").style("visibility","");var l=a.getAncestors(h);a.updateBreadcrumbs(l,f);d3.selectAll("path").style("opacity",.3);a.topG.selectAll("text").style("opacity",.3);a.topG.selectAll("path").filter(function(n){return 0<=l.indexOf(n)}).style("opacity",1).each(function(n){a.topG.selectAll(".txt"+removeColon(n.data.id)).style("opacity",
1)});a.topG.selectAll("."+removeColon(h.data.id)).style("opacity",1);tt.transition().duration(200).style("opacity",1);tt.html(a.createToolTip(h)).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",function(){return that.positionTTTop(d3.event.pageY)})}d3.event.stopPropagation()};a.createToolTip=function(h){h.data&&(h=h.data);var f="Name:"+h.name+" ("+h.id+")<BR><BR>Definition: "+h.definition+"<BR><BR>Unique Genes in this module with this term: "+h.uniqueGene+"<BR>";if(0<
h.uniqueGene)for(var g=0;g<h.uniqueGenes.length;g++){0<g&&(f+=", ");var l=h.uniqueGenes[g].id;"undefined"!==typeof a.geneList[l]&&(l=a.geneList[l]);f+=l}return f};a.mouseleave=function(h){d3.select("#trail").style("visibility","hidden");d3.selectAll("text").style("opacity",1);d3.selectAll("path").transition().duration(500).style("opacity",1);d3.select("#explanation").style("visibility","hidden");tt.transition().duration(200).style("opacity",0)};a.getAncestors=function(h){for(var f=[];h.parent;)f.unshift(h),
h=h.parent;return f};a.isParentOf=function(h,f){return h===f?!0:h.children?h.children.some(function(g){return a.isParentOf(g,f)}):!1};a.b={w:250,h:30,s:3,t:10,runW:0,runH:0};a.initializeBreadcrumbTrail=function(){d3.select("#singleWGCNASVG").remove();d3.select("#trail").remove();d3.select("#viewGene").append("svg:svg").attr("width",a.width).attr("height",68).attr("id","trail").append("svg:text").attr("id","endlabel").style("fill","#000");a.svg=d3.select("#viewGene").append("svg").attr("id","singleWGCNASVG").attr("height",
a.height+"px").attr("width","100%")};a.breadcrumbPoints=function(h,f){var g=7.5*h.data.name.length+25,l=[];l.push("0,0");l.push(g+",0");l.push(g+a.b.t+","+a.b.h/2);l.push(g+","+a.b.h);l.push("0,"+a.b.h);0<f&&l.push(a.b.t+","+a.b.h/2);return l.join(" ")};a.updateBreadcrumbs=function(h,f){var g=d3.select("#trail").selectAll("g").data(h,function(l){return l.data.name+l.depth});g.exit().remove();a.b.runW=0;a.b.runH=0;g=g.enter().append("svg:g").merge(g).attr("transform",function(l,n){var p=7.5*l.data.name.length+
25,t=a.b.runW;t+p>a.width&&(t=0,a.b.runH=a.b.runH+a.b.h+a.b.s,a.b.runW=0);a.b.runW=a.b.runW+p+a.b.s;return"translate("+t+", "+a.b.runH+")"});g.append("svg:polygon").attr("points",a.breadcrumbPoints).style("fill",a.pathColor);g.append("svg:text").attr("x",function(l){return(7.5*l.data.name.length+25+a.b.t)/2}).attr("y",a.b.h/2).attr("dy","0.35em").attr("text-anchor","middle").text(function(l){l=l.data.name;0===l.indexOf("ENS")&&"undefined"!==typeof a.geneList[l]&&(l=a.geneList[l]);return l});d3.select("#trail").select("#endlabel").attr("x",
a.b.runW+15).attr("y",a.b.h/2+a.b.runH).attr("dy","0.35em").attr("text-anchor","start").text(f);d3.select("#trail").attr("height",function(){var l=a.b.runH+a.b.h+5;68>l&&(l=68);return l}).style("visibility","")};return a};that.flattenTree=function(a,e){-1===e.data.name.indexOf("ENS")&&a.push(e);if(e.children)for(var c=0;c<e.children.length;c++)that.flattenTree(a,e.children[c])};that.singleWGCNATableGoView=function(){$("div#waitGoTable").hide();$("div#wgcnaModuleTable").hide();$("div#wgcnaMirTable").hide();
$("div#wgcnaMirGeneTable").hide();$("div#wgcnaEqtlTable").hide();$("div#wgcnaGoTable").show();$("span#GoTableName").html(that.selectedModule.MOD_NAME);d3.select("div#tableExportCtl").selectAll("span").remove();d3.select("div#tableExportCtl").append("span").attr("class","button").style("margin-right","10px").on("click",function(){$("#GoTable").tableExport({type:"csv",escape:"false"})}).html("Export CSV");$.fn.DataTable.isDataTable("table#GoTable")&&$("table#GoTable").DataTable().destroy();d3.select("#GoTable").select("tbody").selectAll("tr").remove();
var a=[];that.flattenTree(a,that.singleImage.rootN);a=d3.select("#GoTable").select("tbody").selectAll("tr").data(a,function(e,c){return c});a.exit().remove();a.enter().append("tr").style("background-color",that.singleImage.pathColor).style("display",function(e){var c="none";e.depth<=that.singleImage.rootN.depth?c="":e.depth===that.singleImage.rootN.depth+1&&(c="");return c}).style("cursor","pointer").merge(a).attr("id",function(e){return e.id}).attr("class",function(e){return" d"+e.depth}).on("mouseover",
function(e){d3.select(this).style("background-color","#FFFFFF");gtag("event","mouseOverGOTbl",{event_category:"wgcna"})}).on("mouseleave",function(e){d3.select(this).style("background-color",that.singleImage.pathColor(e))}).on("click",function(e){that.singleImage.selectedNode=e.data;that.singleImage.rootN=e;$("span[name=d"+e.depth+"]").addClass("less");$("tr.d"+e.depth).show();that.singleImage.redraw();gtag("event","wgcna",{event_category:"mouseClickGOTbl"})}).each(function(e,c){var h=d3.select(this);
h.append("td").style("padding-left",function(){return 20*e.depth+"px"}).html(function(){var f=e.data.name+" ("+e.data.id+")";-1<e.data.name.indexOf("ENS")&&(f=that.singleImage.geneList[e.data.name]+" ("+e.data.id+")");var g=f;if("undefined"!==typeof e.children&&0<e.children.length){g="";e.depth<=that.singleImage.rootN.depth&&(g=" less");for(var l=0,n=0;n<e.children.length&&0===l;n++)-1===e.children[n].data.name.indexOf("ENS")&&(l=1);g=1===l?'<span class="trigger'+g+'" name="d'+(e.depth+1)+'">'+f+
"</span>":f}return g});h.append("td").html(e.data.definition);h.append("td").html(function(){if(0<e.data.uniqueGene){var f='<span class="triggerGL" name="gl'+c+'">'+e.data.uniqueGene+"</span><BR>";f=f+'<span id="gl'+c+'" style="display:none;" >';for(var g=0;g<e.data.uniqueGenes.length;g++){0<g&&(f+=", ");var l=e.data.uniqueGenes[g].id;"undefined"!==typeof that.singleImage.geneList[l]&&(l=that.singleImage.geneList[l]);f+=l}f+="</span>"}else f="0";return f})});$("#GoTable .trigger").on("click",function(e){var c=
this.getAttribute("name");if($("."+c).is(":hidden"))$("span[name="+c+"]").addClass("less"),$("tr."+c).show();else for(c=parseInt(c.substr(1));0<$("tr.d"+c).length;)$("span[name=d"+c+"]").removeClass("less"),$("tr.d"+c).hide(),c++;e.stopPropagation()});$("#GoTable .triggerGL").on("click",function(e){var c=this.getAttribute("name");$("#"+c).is(":hidden")?($(this).addClass("less"),$("span#"+c).show()):($(this).removeClass("less"),$("span#"+c).hide());e.stopPropagation()});$("#GoTable").DataTable({bPaginate:!1,
bSort:!1,asStripClasses:[],sDom:"f<t>"})};that.singleWGCNAImageEQTLView=function(){var a=that.singleWGCNAImage();$(".linkCTL").hide();$(".mirCTL").hide();$(".goCTL").hide();$(".eqtlCtls").show();a.type="eqtl";a.createToolTip=function(e){var c=that.selectedGene[e];return c.geneSymbol?"<BR>Gene: "+c.geneSymbol+"("+e+")":"<BR>Gene: "+e};a.colorGene=function(e){var c="#DFC184";if(0===e.indexOf("Brain")||0===e.indexOf("Unannotated"))c="#7EB5D6";return c};a.displayDefault=function(){d3.select("#viewGene").remove();
d3.select("#circos").remove();that.selectedModule&&(a.update(contextRoot+"tmpData/browserCache/"+genomeVer+"/circos/ds"+that.wDSID+"/"+replaceUnderscore(that.selectedModule.MOD_NAME)+"/"+replaceUnderscore(that.selectedModule.MOD_NAME)+"_1/svg/circos_new.svg"),that.singleWGCNATableEQTLView())};a.draw=function(){};a.update=function(e){$.ajax({url:e,type:"GET",data:{},dataType:"html",success:function(c){d3.select("#circos").remove();d3.select("#wgcnaGeneImage").append("div").attr("id","circos");$("#circos").html(c);
$("#circosModule").css("width","100%");$("#circosModule").css("height",Math.floor(.9*window.innerHeight)+"px");a.panZoomCircos=svgPanZoom("#circosModule",{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,minZoom:.1,maxZoom:4,fit:!0,center:!0});d3.select("#circosModule").selectAll(".circosGene").style("cursor","pointer").on("mouseover",function(){d3.select(this).style("fill","#000000").attr("font-size","50px");tt.transition().duration(200).style("opacity",
1);tt.html(a.createToolTip(d3.select(this).attr("id"))).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",function(){return that.positionTTTop(d3.event.pageY)});gtag("event","mouseOverEQTL",{event_category:"wgcna"})}).on("mouseout",function(){var h=a.colorGene(d3.select(this).attr("id"));d3.select(this).style("fill",h).attr("font-size","26px");tt.transition().duration(500).style("opacity",0)});that.singleWGCNATableEQTLView()}})};return a};that.singleWGCNATableEQTLView=
function(){$("div#waitEqtlTable").hide();$("div#wgcnaModuleTable").hide();$("div#wgcnaMirTable").hide();$("div#wgcnaMirGeneTable").hide();$("div#wgcnaGoTable").hide();$("div#wgcnaEqtlTable").show();$("span#eqtlTableName").html(that.selectedModule.MOD_NAME);d3.select("div#tableExportCtl").selectAll("span").remove();d3.select("div#tableExportCtl").append("span").attr("class","button").style("margin-right","10px").on("click",function(){$("#eqtlTable").tableExport({type:"csv",escape:"false"})}).html("Export CSV");
$.ajax({url:contextRoot+"tmpData/browserCache/"+genomeVer+"/modules/ds"+that.wDSID+"/"+replaceUnderscore(that.selectedModule.MOD_NAME)+".eQTL.json",type:"GET",async:!0,data:{},dataType:"json",beforeSend:function(){$("div#waitEqtlTable").show()},success:function(a){setTimeout(function(){$.fn.DataTable.isDataTable("table#eqtlTable")&&$("table#eqtlTable").DataTable().destroy();for(var e=[],c=1*$("#eqtlPval").val(),h="",f=0,g=0;g<a.length;g++)a[g].Pval>=c&&(a[g].Pval>f&&(h=a[g].Snp,f=a[g].Pval),e.push(a[g]));
d3.select("#eqtlTable").select("tbody").selectAll("tr").remove();d3.select("#eqtlTable").select("tbody").selectAll("tr").data(e,that.eQTLKey).enter().append("tr").attr("id",function(l){return"tblLink_"+l.Snp}).attr("class",function(l,n){var p="odd";0===n%2&&(p="even");return p}).each(function(l,n){var p=l.Start/1E6;d3.select(this).append("td").html(l.Chr);d3.select(this).append("td").html(p.toFixed(1));d3.select(this).append("td").html(l.Snp);d3.select(this).append("td").html(l.Pval.toFixed(2))});
$("#eqtlTable").DataTable({bPaginate:!1,aaSorting:[[3,"desc"]],sDom:"fiB<t>",buttons:["copy","excel","pdf"]});$("div#waitEqtlTable").hide();d3.select("#circosModule").select("g#Link_"+h).select("path").style("stroke","#FFF450")},20)},error:function(a,e,c){}})};that.singleWGCNAImageMetaView=function(){var a=that.singleWGCNAImage();$(".goCTL").hide();$(".eqtlCtls").hide();$(".linkCTL").show();$(".mirCTL").hide();a.CorCutoff_min=.75;a.CorCutoff_max=1;a.type=that.viewType;a.truncated=0;a.filterOneDB=
1;a.mirGeneCutoff=1;a.mirValid=0;a.mirTargetID="";a.mirID="";a.miRcolor=d3.scaleOrdinal(d3.schemeCategory20b);a.sortMir=0;a.maxCorWidth=5;a.mlinkKey=function(e){return that.removeInvalidIDChars(e.MOD1)+"_"+that.removeInvalidIDChars(e.MOD2)};a.colorCircle=function(e){return e.COLOR};a.colorLink=function(e){var c=a.negColor;0<e.COR&&(c=a.posColor);return c};a.colorLinkHighlight=function(e){var c=a.negDarkColor;0<e.COR&&(c=a.posDarkColor);return c};a.drawLinks=function(e){a.updateColor("linkColor");
a.svg.selectAll(".link").remove();for(var c=a.metaData.LINKS,h=[],f=0,g=0;g<c.length;g++)(c[g].MOD1===e.MODULE||c[g].MOD2===e.MODULE)&&a.CorCutoff_min<=Math.abs(c[g].COR)&&Math.abs(c[g].COR)<=a.CorCutoff_max&&(h[f]=c[g],f++);c=h;1E4>c.length&&(e=a.topG.selectAll(".link").data(c,a.mlinkKey),e.enter().append("line").attr("class","link").attr("pointer-events","none").attr("id",function(l){return"ln_"+that.removeInvalidIDChars(l.MOD1)+that.removeInvalidIDChars(l.MOD2)}).attr("x1",function(l){return d3.select("#mod_"+
that.removeInvalidIDChars(l.MOD1)).attr("cx")}).attr("y1",function(l){return d3.select("#mod_"+that.removeInvalidIDChars(l.MOD1)).attr("cy")}).attr("x2",function(l){return d3.select("#mod_"+that.removeInvalidIDChars(l.MOD2)).attr("cx")}).attr("y2",function(l){return d3.select("#mod_"+that.removeInvalidIDChars(l.MOD2)).attr("cy")}).attr("stroke",a.colorLink).attr("stroke-width",function(l){return Math.abs(l.COR)*a.maxCorWidth}).merge(e))};a.drawLinksBetween=function(e){a.updateColor("linkColor");for(var c=
{},h=0;h<e.length;h++)c[e[h]]=1;a.svg.selectAll(".link").remove();e=a.metaData.LINKS;h=[];for(var f=0,g=0;g<e.length;g++)(0===a.showAllFromTarget&&"undefined"!==typeof c[e[g].MOD1]&&"undefined"!==typeof c[e[g].MOD2]||1===a.showAllFromTarget&&("undefined"!==typeof c[e[g].MOD1]||"undefined"!==typeof c[e[g].MOD2]))&&a.CorCutoff_min<=Math.abs(e[g].COR)&&Math.abs(e[g].COR)<=a.CorCutoff_max&&(h[f]=e[g],f++);e=h;1E4>e.length&&(c=a.topG.selectAll(".link").data(e,a.mlinkKey),c.enter().append("line").attr("class",
"link").attr("pointer-events","none").attr("id",function(l){return"ln_"+that.removeInvalidIDChars(l.MOD1)+that.removeInvalidIDChars(l.MOD2)}).attr("x1",function(l){return d3.select("#mod_"+that.removeInvalidIDChars(l.MOD1)).attr("cx")}).attr("y1",function(l){return d3.select("#mod_"+that.removeInvalidIDChars(l.MOD1)).attr("cy")}).attr("x2",function(l){return d3.select("#mod_"+that.removeInvalidIDChars(l.MOD2)).attr("cx")}).attr("y2",function(l){return d3.select("#mod_"+that.removeInvalidIDChars(l.MOD2)).attr("cy")}).attr("stroke",
a.colorLink).attr("stroke-width",function(l){return Math.abs(l.COR)*a.maxCorWidth}).merge(c))};a.nodeX=function(e,c){var h=50,f=Math.floor(c/a.maxPerLevel)+1;1<f&&(h=60*f);return a.width/2+(a.r-h)*Math.cos(c%a.maxPerLevel*a.angle-1.57079633)};a.nodeY=function(e,c){var h=50;c>a.maxPerLevel&&(h=60*(Math.floor(c/a.maxPerLevel)+1));return a.height/2+(a.r-h)*Math.sin(c%a.maxPerLevel*a.angle-1.57079633)};a.nodeXLbl=function(e,c){var h=c%a.maxPerLevel*a.angle-1.57079633,f=1;if(Math.PI/2<h&&h<1.5*Math.PI){var g=
0;"undefined"!==typeof e.MODULE&&(g=e.MODULE.length);f+=7.5*g}return a.width/2+(a.r+f)*Math.cos(h)};a.nodeYLbl=function(e,c){var h=c%a.maxPerLevel*a.angle-1.57079633,f=1;if(Math.PI/2<h&&h<1.5*Math.PI){var g=0;"undefined"!==typeof e.MODULE&&(g=e.MODULE.length);f+=7.5*g}return a.height/2+(a.r+f)*Math.sin(h)};a.drawCorLegend=function(e){a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",e).text("Positive Correlation");a.legendDispG.append("rect").attr("x","0").attr("y",e-10).attr("width",
"30").attr("height","10").style("fill",a.posColor);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",e+20).text("Negative Correlation");a.legendDispG.append("rect").attr("x","0").attr("y",e+10).attr("width","30").attr("height","10").style("fill",a.negColor);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",e+40).text("Lower Correlation");a.legendDispG.append("line").attr("x1","0").attr("y1",e+30).attr("x2","30").attr("y2",e+30).style("stroke",
"#000000").style("stroke-width","0");a.legendDispG.append("line").attr("x1","0").attr("y1",e+35).attr("x2","30").attr("y2",e+35).style("stroke","#000000").style("stroke-width","0.5");a.legendDispG.append("line").attr("x1","0").attr("y1",e+40).attr("x2","30").attr("y2",e+40).style("stroke","#000000").style("stroke-width","1");a.legendDispG.append("line").attr("x1","0").attr("y1",e+45).attr("x2","30").attr("y2",e+45).style("stroke","#000000").style("stroke-width","2");a.legendDispG.append("line").attr("x1",
"0").attr("y1",e+55).attr("x2","30").attr("y2",e+55).style("stroke","#000000").style("stroke-width","3");a.legendDispG.append("line").attr("x1","0").attr("y1",e+65).attr("x2","30").attr("y2",e+65).style("stroke","#000000").style("stroke-width","5");a.legendDispG.append("line").attr("x1","0").attr("y1",e+75).attr("x2","30").attr("y2",e+75).style("stroke","#000000").style("stroke-width","7");a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",e+80).text("Higher Correlation")};
a.drawLegend=function(){a.drawCorLegend(20)};a.selectMetaMod=function(e){that.topselectedModule=that.selectedModule;that.selectedModule=that.modules[e];that.topselectedGene=that.selectedGene;that.selectedGene={};for(e=0;e<that.selectedModule.TCList.length;e++)"undefined"===typeof that.selectedGene[that.selectedModule.TCList[e].Gene.ID]&&(that.selectedGene[that.selectedModule.TCList[e].Gene.ID]={},that.selectedGene[that.selectedModule.TCList[e].Gene.ID].geneSymbol=that.selectedModule.TCList[e].Gene.geneSymbol,
that.selectedGene[that.selectedModule.TCList[e].Gene.ID].tcList=[]),that.selectedGene[that.selectedModule.TCList[e].Gene.ID].tcList.push(that.selectedModule.TCList[e]);that.viewType="gene";d3.select("#wgcnaGeneViewRB").property("checked",!0);that.createSingleWGCNAImage()};a.draw=function(){a.updateColor("linkColor");a.width=$(window).width();a.height=Math.floor(.9*window.innerHeight);a.r=a.height>a.width?Math.floor(a.width/2*.95):Math.floor(a.height/2*.95);a.svg.attr("height",a.height+"px");a.svg.selectAll("circle").remove();
a.svg.selectAll("text").remove();a.svg.selectAll("line").remove();a.svg.selectAll(".mod").remove();"undefined"!==typeof a.panZoom&&(a.panZoom.destroy(),delete a.panZoom);a.svg.selectAll(".svg-pan-zoom_viewport").remove();setTimeout(function(){a.svg.append("text").style("font-size","20").attr("y",22).attr("x",5).text(function(){return that.selectedModule?"Meta Module for "+replaceUnderscore(that.selectedModule.MOD_NAME):""});a.setupLegend();a.data=a.metaData.MODULES;a.angle=2*Math.PI/a.data.length;
a.angleDeg=360/a.data.length;a.data.length>a.maxPerLevel&&(a.angle=2*Math.PI/a.maxPerLevel,a.angleDeg=360/a.maxPerLevel);if(150<a.data.length){a.truncated=1;a.maxNodeR=15;for(var e=[],c=0;150>c;c++)e[c]=a.data[c];a.data=e;a.dataIndex={};for(c=0;c<a.data.length;c++)a.dataIndex[a.data[c].ID]=1;a.CorCutoff_min=.75;$("#linkSliderMin").slider("value",.75);$("span#minLabel").html(.75);a.svg.append("image").attr("x",7.8*that.selectedModule.MOD_NAME.length+20).attr("y",1).attr("width","24px").attr("height",
"24px").attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAJI0lEQVRIDQEYCef2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAAH/gAACcAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAADwAAALkCAABoFDEx0gIzM+/b29v4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGIAAAAvAgAAHDnn54QGBgY3SUlJBwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8AAB0AAAChAAAADAAAAAAU9vYY4RER/ecNDdLZ2dnvAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB5AAAAFgAAAAAAAAAABv7+BFHZ2UgFAgI4Ozs7DAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAtAAAAmAAAAAQAAAAAAAAAAAAAAAAU9/cM7AoKAOYYGNTZ2dnqAAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAFAAAAnQAAACf8AgIAzhgY/uIODv4V9vYBBP//AR3z8xrKHBzjDhwc2uDg4PYAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASwAAAEUAAAAB+AMDAJwyMveSODjT9QUF+AAAAAAY9PQOTN3dTxISEipAQEAEAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAADAAAAIAAAAAEAAAAAAAAAAAC/v7vAv7+tQn7+/IAAAAAAAAAAT/g4DQd8/NHCgoKFAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGcAAAAuAAAAAAAAAAAAAAAAAAEB+gP//+QF///7AAAAAAAAAAAQ+voIVtfXUggICDM5OTkJAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAP8AABYAAAB4AAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAATXm5iYt6+tMExMTHAAAAAEAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB7AAAAEwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAF/v4CVdfXSw0EBDdAQEALAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAD/AAAzAAAAkwAAAAYAAAAAAAAAAAAAAAAAAQEAAAAA/kDh4QAb8/MpAgAACAAAAAAAAAAAAAAAABT29g7vCAgB4RYW1NnZ2eoAAAD/AAAAAAAAAAAAAAAAAAAAAAD/AAAE/wAAtf8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD/5Q0N7WNKSnFHR0cSAAAAAAAAAAADAAAAAAAAAAAAAAAAgAAATAAAAHkAAAADAAAAAAAAAAAAAAAAAAAAAPgEBP+XMzP7xR8f7ivq6gcH/f0CAAAAAAAAAAAAAAAAAAAAAAz6+gj9AgIM2Bsb0QoKCujn5+f+AgAAAAAAAAAA/wAABwAAAIkAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAD9AQEA1hUV9MwZGccAAAD2AAAAAAAAAAAAAAAAAAAAAAAAAAABAAABR97eNhb390ceHh4RAAAAAAAAAAAAAAAAAP8AAG//AAD+/wAA//8AAP//AAD//wAA//8AAP//AAD//gAA/u4ICPvzBQXw/gAA/P8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP/CHR3SVVBQNgAAAAACAAAAAP8AAAgAAABfAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAER+PgEDPv7DwEAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMOnpJyHy8icAAAAABAAAAAABAAD42BMTgdUTE2buCwsz/QICCQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8BAAD/AAEBAf8AAAEAAAAAAAAAAAAAAAAAAAAAAAAAAPEHB/vhEBANAAAAAAQAAAAAAAAAAHU6OrsDAwPnAgICIQEBAQUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQH//f39zgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAs0IPw6I24JoAAAAASUVORK5CYII=").attr("pointer-events",
"all").style("cursor","pointer").on("mouseover",function(){$("#wgcnaMouseHelp").html("Warning: Modules displayed are truncated to the top 150 most connected modules due to the size of the meta module.")}).on("mouseout",function(){$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")})}else a.maxNodeR=28;a.topG=a.svg.append("g").attr("class","svg-pan-zoom_viewport");e=a.topG.selectAll(".mod").data(a.data,a.modKey);e.enter().append("circle").attr("class",
"mod").attr("id",function(g){return"mod_"+that.removeInvalidIDChars(g.MODULE)}).attr("cx",a.nodeX).attr("cy",a.nodeY).attr("r",3).attr("stroke","#000000").attr("fill","#FF0000").merge(e);e=a.metaData.LINKS;c=[];for(var h=0,f=0;f<e.length;f++)a.CorCutoff_min<=Math.abs(e[f].COR)&&Math.abs(e[f].COR)<=a.CorCutoff_max&&(0===a.truncated||"undefined"!==typeof a.dataIndex[e[f].MOD1]&&"undefined"!==typeof a.dataIndex[e[f].MOD2])&&(c[h]=e[f],h++);e=c;a.showLinks&&1E4>e.length&&(e=a.topG.selectAll(".link").data(e,
a.mlinkKey),e.enter().append("line").attr("class","link").attr("id",function(g){return"ln_"+that.removeInvalidIDChars(g.MOD1)+that.removeInvalidIDChars(g.MOD2)}).attr("x1",function(g){return d3.select("#mod_"+that.removeInvalidIDChars(g.MOD1)).attr("cx")}).attr("y1",function(g){return d3.select("#mod_"+that.removeInvalidIDChars(g.MOD1)).attr("cy")}).attr("x2",function(g){return d3.select("#mod_"+that.removeInvalidIDChars(g.MOD2)).attr("cx")}).attr("y2",function(g){return d3.select("#mod_"+that.removeInvalidIDChars(g.MOD2)).attr("cy")}).attr("stroke",
a.colorLink).attr("stroke-width",function(g){return Math.abs(g.COR)*a.maxCorWidth}).merge(e));a.topG.selectAll(".mod").remove();e=a.topG.selectAll(".mod").data(a.data,a.geneKey);e.enter().append("g").append("circle").attr("cx",a.nodeX).attr("cy",a.nodeY).attr("r",20).attr("stroke","#000000").attr("fill",a.colorCircle).attr("class",function(g){return"mod "+that.removeInvalidIDChars(g.MODULE)}).attr("id",function(g){return"mod_"+that.removeInvalidIDChars(g.MODULE)}).on("click",function(g){that.moduleGenes[g.MODULE]||
(that.moduleGenes[g.MODULE]="",that.requestModule(g.MODULE,a.selectMetaMod))}).on("mouseover",a.mouseoverModule).on("mouseout",a.mouseleaveModule).merge(e).each(function(g,l){d3.select(this.parentNode).append("g").attr("class","label").attr("id",function(n){return"txt_"+that.removeInvalidIDChars(n.MODULE)}).attr("transform",function(){var n=a.nodeXLbl(g,l),p=a.nodeYLbl(g,l);return"translate("+n+","+p+")"}).append("text").attr("transform",function(){var n=-90+l%a.maxPerLevel*a.angleDeg;90<n&&(n-=180);
return"rotate("+n+")"}).text(function(){return g.MODULE})});e.exit().remove()},250)};a.requestMeta=function(){$.ajax({url:pathPrefix+"getWGCNAMetaModules.jsp",type:"GET",async:!0,data:{source:that.selSource,id:replaceUnderscore(that.selectedModule.MOD_NAME),organism:organism,panel:that.panel,tissue:that.tissue,region:that.region,geneList:that.geneList,genomeVer:genomeVer},dataType:"json",success:function(e){setTimeout(function(){a.metaData=e[0];a.draw();that.singleWGCNATableMetaView()},50)},error:function(e,
c,h){setTimeout(function(){a.requestMeta()},2E3)}})};a.mouseoverModule=function(){$("#wgcnaMouseHelp").html("<B>Click</B> to select this module and see additional details.");d3.select(this).style("fill","url(#selectGrad)");tt.transition().duration(200).style("opacity",1);tt.html(a.createToolTip(d3.select(this).datum())).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",function(){return that.positionTTTop(d3.event.pageY)});var e=d3.select(this.parentNode).datum();$("[id^=ln_"+
that.removeInvalidIDChars(e.MODULE)+"]").each(function(){var c=$(this).attr("id");d3.select("line#"+c).attr("stroke",a.colorLinkHighlight)});$("[id$="+that.removeInvalidIDChars(e.MODULE)+"]").each(function(){var c=$(this).attr("id");d3.select("line#"+c).attr("stroke",a.colorLinkHighlight)});a.showLinks||a.drawLinks(e);d3.select("#txt_"+that.removeInvalidIDChars(e.MODULE)).select("text").attr("fill","#00A347");gtag("event","mouseOverModule",{event_category:"wgcna"})};a.mouseleaveModule=function(){var e=
d3.select(this.parentNode).datum();$("[id^=ln_"+that.removeInvalidIDChars(e.MODULE)+"]").each(function(){var c=$(this).attr("id");d3.select("line#"+c).attr("stroke",a.colorLink)});$("[id$="+that.removeInvalidIDChars(e.MODULE)+"]").each(function(){var c=$(this).attr("id");d3.select("line#"+c).attr("stroke",a.colorLink)});d3.select(this).style("fill",a.colorCircle);d3.select("#txt_"+that.removeInvalidIDChars(e.MODULE)).select("text").attr("fill","#000000");tt.transition().duration(500).style("opacity",
0);a.showLinks||a.svg.selectAll(".link").remove();"mir"===that.viewType&&(a.mirTargetID=$("#mirGeneFilterTxt").val().toLowerCase(),a.svg.selectAll(".mirLink").remove(),that.singleImage.drawMiR())};a.createToolTip=function(e){return"Module: "+e.MODULE};return a};that.singleWGCNATableMetaView=function(){$("div#wgcnaModuleTable").hide();$("div#wgcnaMirTable").hide();$("div#wgcnaMirGeneTable").hide();$("div#wgcnaGoTable").hide();$("div#wgcnaEqtlTable").hide()};return that};